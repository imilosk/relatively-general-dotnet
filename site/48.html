
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 48 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-471">
            <a href="https://ayende.com/blog/200675-A/walkthrough-turning-a-raspberry-pi-into-an-appliance" target="_blank">
                <h2 class="title mb-6" id="article-471">Walkthrough: Turning a Raspberry Pi into an appliance</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 26, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x2019;m currently playing with a Secret Project (code-named Hugin right now) and for that purpose, I literally ordered all the available Raspberry Pi in Israel. That last statement sounds&#xA0;like a joke, but we checked six to eight places, and our order quantity exceeds the inventory in the country. They are flying the units to us as you read this.I would love to hear what you think I&#x2019;m doing, by the way.&#xA0;Please share &#xA0;your thoughts on the matter in the comments.For Hugin, I&#x2019;m playing with Pi Zero 2 W, which is about the size of a lighter. They are small, and somewhat underpowered, but really cool. They also run RavenDB surprisingly well, but I&#x2019;ll touch on that in a later post.The drawback of the Zero is that basically it has two ports: a micro USB and a mini-HDMI. There is also a micro USB for power, but for doing stuff with it, just those two ports. If you are like me, you have more micro USB power cables than you know what to do with. However, micro USB on-the-go connectors or mini-HDMI are far rarer these days. I want this to be useful&#xA0;and easy, so I started thinking about how I could make it simpler to work with. Then I realized that the Zero model I&#x2019;m using (2 W) has built-in wifi, and that meant that I could start getting smart. The idea is that we can turn the Zero into an access point, so all you&#x2019;ll need is to plug it into power (using a micro USB cable you likely already have), wait half a minute, and connect to the machine. Once I had the idea, I delved deep&#xA0;into figuring out how to make it work. I managed, and the entire process is pretty simple from a user perspective,&#xA0;but it was anything&#xA0;but to make it work. For the rest of this post, I will be working with the Raspberry Pi Zero 2 W, using Raspberry Pi OS Lite (Legacy, 32 bits) (Debian Bullseye). I tested this on a range of Pis (I apparently got lots, from Raspberry Pi 3 B to the Raspberry Pi 400), and it worked on everything I tried.I actually tried quite hard to get it working on the Raspberry Pi OS (the non-legacy, which is Debian Bookworm). However, I couldn&#x2019;t get it to behave the way I wanted it to. Setting up a wifi hotspot on Bookworm is easy, but getting&#xA0;it to bind DNS and DHCP to a particular device was beyond my capabilities.From my reading, it doesn&#x2019;t look like I&#x2019;m the only one running into issues here.The basic idea is that on connecting to a WiFi network, most devices will check connectivity and display the captive portal page if needed. In this case, we simply provide the captive portal page to our application. Hence, the only thing you need to do is to connect to the hotspot, and everything else is handled for you.This blog post&#xA0;was really helpful figuring things out.How this works, however, is a whole other matter. I&#x2019;m assuming that you are running on a clean slate, booting for the first time on the clean image of Raspberry Pi Lite (Bullseye). The first thing to do is to set up the wifi, DNS, and DHCP, like so:sudo raspi-config nonint do_wifi_country IL&#xA;sudo rfkill unblock wifi&#xA;sudo apt-get install -y nginx dnsmasq dhcpcdWe first set up the country for wifi, unblock it, and install nginx,dnsmasq and dhcpcd. Our next step it update /etc/wpa_supplicant/wpa_supplicant.conf&#xA0;to create the actual hotspot:ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev&#xA;update_config=1&#xA;country=IL&#xA;network={&#xA;    ssid=&quot;MyHotSpot&quot;&#xA;    mode=2&#xA;    key_mgmt=NONE&#xA;    frequency=2412&#xA;}We define the MyHotSpot&#xA0;network as an open (key_mgmt=NONE)&#xA0;access point (mode=2). We need to plug this into the DHCP configuration in /etc/dhcpcd.conf:hostname&#xA;clientid&#xA;persistent&#xA;option rapid_commit&#xA;option domain_name_servers, domain_name, domain_search, host_name&#xA;option classless_static_routes&#xA;option interface_mtu&#xA;require dhcp_server_identifier&#xA;slaac private&#xA;&#xA;&#xA;env wpa_supplicant_conf=/etc/wpa_supplicant/wpa_supplicant.conf&#xA;interface wlan0&#xA;static ip_address=10.1.1.1/24The last part is the most important bit. We pull the wpa_supplicant&#xA0;configuration that we previously defined, apply it to the WiFi device (wlan0), and register a static IP 10.1.1.1 for that interface. Basically, the WiFi interface will use that IP address as the gateway for clients connecting to it. Those clients need to get their own IP addresses, and that is the role of dnsmasq (no idea why it isn&#x2019;t a dhcpcd&#xA0;that does it, it&#x2019;s literally in the name). Here is the relevant configuration file /etc/dnsmasq.conf:listen-address=10.1.1.1&#xA;no-hosts&#xA;log-queries&#xA;log-facility=/var/log/dnsmasq.log&#xA;dhcp-range=10.1.1.2,10.1.1.254,72h&#xA;dhcp-option=option:router,10.1.1.1&#xA;dhcp-authoritative&#xA;dhcp-option=114,http://awesome.appliance/&#xA;dhcp-option=160,http://awesome.appliance/&#xA;&#xA;&#xA;# Resolve everything to the portal&#x27;s IP address.&#xA;address=/#/10.1.1.1&#xA;&#xA;&#xA;# Android Internet Conectivity Test Domains&#xA;address=/clients1.google.com/127.0.0.1&#xA;address=/clients3.google.com/127.0.0.1&#xA;address=/connectivitycheck.android.com/127.0.0.1&#xA;address=/connectivitycheck.gstatic.com/127.0.0.1There is a lot going on here. We define the DHCP range from which clients will get their IPs and set the router for this connection. We also define option 114 (and 160, which is a legacy one) to instruct the client that it needs to first visit that URL before it connecting to the wider internet. Finally, we set up DNS in such a way that all&#xA0;DNS entries go to the server, except for a certain set of known domains used by some Android phones to check for an internet connection. We&#x2019;ll touch on that in a bit.In short, all of this configuration basically tells the Zero to create a WiFi hotspot with IP 10.1.1.1, assign connected devices IP addresses in the range 10.1.1.2 .. 10.1.1.254, set &#xA0;the DNS server for those devices to 10.1.1.1, and resolve any DNS query &#xA0;to IP 10.1.1.1. Also, if they care to, there is a specific URL users need to visit to get things started. In short, we are trying to guide the user to take us to the right place. One problem we have, however, is that we didn&#x2019;t set up anything to respond to HTTP requests. That is why we installed nginx earlier. We configure it using /etc/nginx/sites-available/default:server {&#xA;    listen 80 default_server;&#xA;    listen [::]:80 default_server;&#xA;    server_name _;&#xA;    location / {&#xA;        return 302 http://awesome.appliance;&#xA;    }&#xA;}&#xA;server {&#xA;  listen *:80;&#xA;  server_name awesome.appliance;&#xA;&#xA;&#xA;  root /var/appliance/web;&#xA;  autoindex on;&#xA;}The idea here is simple. Everything before basically directs the client to the server, all domains go to it, etc. So when a connection comes, we tell nginx that it should return a 302 response (redirect) to the portal endpoint we have. If the client is requesting the http://awesome.applianceaddress, however, we serve an actual website.All of this together ends up with an open access point that, upon connection, will direct you to a web page. This is a walled garden, of course, since we assume that the Zero is connected only to the power. Now that this is solved, you need to figure out what function you want the appliance to actually have.</p>
        </article>
        <article id="article-472">
            <a href="https://devblogs.microsoft.com/dotnet/office-rtc-dotnet-migration/" target="_blank">
                <h2 class="title mb-6" id="article-472">Microsoft Office&#x2019;s RTC (Real-Time Channel) migration to modern .NET</h2>
            </a>
            <p class="mb-2">by Gilad Oren</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 25, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Real-Time Channel is Microsoft Office Online&#x27;s service that powers real time collaboration and coauthoring. This blog post describes the journey to migrate the service from .NET Framework to modern .NET.</p>
        </article>
        <article id="article-473">
            <a href="https://ayende.com/blog/200609-B/corax-lucene-benchmarks-and-lies" target="_blank">
                <h2 class="title mb-6" id="article-473">Corax, Lucene, Benchmarks and lies!</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 24, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">When we started working on Corax (10 years ago!), we had a pretty simple mission statement for that: &#x201C;Lucene, but 10 times faster for our use case&#x201D;. When we actually started implementing this in code (early 2020), we had a few more rules about the direction we wanted to take.Corax had to be faster than Lucene in all scenarios, and 10 times faster for common indexing and querying scenarios. Corax design is meant for online indexing, not batch-oriented like Lucene. We favor moving work to indexing time and ensuring that our data structures on disk can work with no additional processing time.Lucene was created at a time when data size was much smaller and disks were far more expensive. It shows in the overall design in many ways, but one of the critical aspects is that the file design for Lucene is compressed, meaning that you need to read the data, decode that into the in-memory data structure, and then process it. For RavenDB&#x2019;s use case, that turned out to be a serious problem. In particular, the issue of cold queries, where you query the database for the first time and have to pay the initialization cost, was particularly difficult. Now, cold queries aren&#x2019;t really that interesting, from a benchmark perspective, you have to warm things up in every software (caches are everywhere, from your disk to your CPU). I like to say that even memory&#xA0;has caches (yes, plural) because it is so slow (L1, L2, L3 caches). With Lucene&#x2019;s design, however, whenever it runs an indexing batch, it creates a new file, and to start querying after that means that you have a &#x201C;cold start&#x201D; for that file. Usually, those files are small, but every now and then Lucene needs to merge several files together and then we have to pay the cold start price for a large amount of data.The issue is that this sometimes introduces a high latency spike (hitting us in the P999 targets), which is really hard to smooth over. We spent a lot of time and engineering resources ensuring that this doesn&#x2019;t have a big impact on our users. One of the design goals for Corax was to ensure that this doesn&#x2019;t happen. That we are able to get consistent performance from the system without periodic maintenance tasks. That led us to a very different internal design. The persistent data structures that we use are meant to be used as is, without initial processing. Everything has a cost, and in this case, it means that the size of Corax on disk is typically somewhat larger than Lucene. The big advantage is that the amount of memory&#xA0;being used by Corax tends to be significantly lower. And in today&#x2019;s world, disks are far cheaper than memory. Corax&#x2019;s cold start time is orders of magnitude&#xA0;faster than Lucene&#x2019;s cold start time. It turns out that there is a huge impact in another scenario as well, completely unexpected. We continuously run performance tests on our system, and we got some ridiculous results when testing query performance using encrypted databases.When you use encryption at rest, RavenDB ensures that the only time that your data is decrypted is when there is an active transaction using the data. In other words, even in-memory buffers are encrypted. That applies to documents as well as indexes. It does not&#xA0;apply to the in-memory data that Lucene holds in its cache, though. For Corax, however, all&#xA0;of its state is encrypted.When we run our benchmark on encrypted database queries, we expect to see either roughly the same performance between Corax and Lucene or see Lucene edging out Corax in this scenario, since it can use its cache without paying decryption costs.Instead, we got really puzzling results. I tried showing them in bar chart format, but I literally couldn&#x2019;t make the data fit in a reasonable size. The scenario is testing queries on an encrypted database, using an m5.xlarge instance on AWS. We are hitting the server with 500 queries/second, and testing for the 99.99 percentile performance.Indexing Engine99.99% percentile (ms)99.99% percentile (seconds)Lucene40,21040.21Corax1860.18Take a look at those numbers! Somehow Corax is absolutely smoking Lucene&#x2019;s lunch. And I was quite surprised about that. I mean, I&#x2019;m happy, I guess, that the indexing engine we spent so much time on is doing this well, but any time that we see a performance number that we cannot explain we need to figure out what is going on.Here is the profiler output for this benchmark, using Lucene.As you can see, the vast majority of the time is spent decrypting pages. And we are decrypting pages belonging to a stream. Those are the Lucene files, stored (encrypted in this case) inside of Voron. The issue is that the access pattern that Lucene is using forces us to touch large parts of the file. It usually reads a very small portion each time, but in various locations. Given that the data is encrypted, we have to decrypt each of those locations. Corax, on the other hand, keeps the persistent data structure in such a way that when we need to access specific pages only. That means that in terms of the number of pages touched by Corax or Lucene for this particular scenario, Lucene is using a lot more. You&#x2019;ll usually not notice that since Voron (our storage engine) is memory mapped and those accesses are cheap. When using encrypted storage, however, we need to decrypt the data first, so that was very noticeable. It&#x2019;s interesting to note that this also applies to instances where there is a memory pressure involved. Corax would tend to touch a lot less memory and have a smaller working set, while Lucene will generate more page faults. Really interesting results, and I&#x2019;m both happy and amused that totally different design decisions have led to such a big impact in this scenario. In short, Corax is fast, really fast, and in many more scenarios than we initially thought.</p>
        </article>
        <article id="article-474">
            <a href="https://devblogs.microsoft.com/dotnet/introducing-ms-test-runner/" target="_blank">
                <h2 class="title mb-6" id="article-474">Introducing the MSTest Runner &#x2013; CLI, Visual Studio, &amp; More</h2>
            </a>
            <p class="mb-2">by Amaury Lev&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 24, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">MSTest runner is a new, light-weight and portable runner for MSTest tests available in the .NET CLI, Visual Studio, and more!</p>
        </article>
        <article id="article-475">
            <a href="https://ayende.com/blog/200580-B/meta-blog-im-a-js-developer-now" target="_blank">
                <h2 class="title mb-6" id="article-475">Meta Blog</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 23, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Following my previous post&#xA0;about updating the publishing platform of this blog, I realized that I dug myself into a hole. The new workflow was pretty sweet. To the point where I wrote my blog posts a lot more frequently than before, as you can probably tell. The problem was that I wanted to edit and process the blog post inside Google Docs, where I have a great workflow for editing, reviews, collaboration, etc. And then I want to push that same document to the blog. The killer for me is that I want that to be a smooth process, and the end text should fit&#xA0;into the blog. That means, if I want to emphasize&#xA0;something, it should be seen in the blog as bold. And if I want to write some code, that should work as well. In fact, the&#xA0;reason that I started this process is that it got so annoying to post code to the blog.I&#x2019;m using Google Docs&#x2019; export functionality to get the HTML back, and I did some basic cleaning to get it blog-ready instead of being focused on visual fidelity. I was using HTML Agility Pack to do that, and it turned out to be the wrong tool for the job. The issue is that it processed the data as if it were an XML document. I actually got a lot of track record with XML, so that wasn&#x2019;t the issue. The problem is that I wanted to do a series of non-trivial things with the HTML, and there aren&#x2019;t any off-the-shelf facilities to do that in .NET that I could find. For example, given how important it is to me to show code snippets properly, I wanted to be able to grab them from the document, figure out what language I&#x2019;m actually using there and syntax highlight it properly. There isn&#x2019;t anything like that in .NET, all the libraries I found were for JavaScript. You know the adage about: Let&#x2019;s rewrite it in Rust? I rewrote my entire publishing process to JavaScript. Which then led me to another adventure. How can I do two contrary things? When I&#x2019;m writing this document, I want to be able to just write the code. When I publish it, I want to see the syntax highlighted code, properly formatted and working.Google Docs has support for writing code blocks inline (for some small number of languages), which is great for the editing process. However, &#xA0;the HTML that this generates is beyond atrocious. What is even worse, in HTML, it doesn&#x2019;t align things properly using fixed-sized fonts, etc. In other words, it is almost&#xA0;there, but not quite. When analyzing the Google Docs output, I noticed a couple of funny characters in the code output. Here is what it looks like. I believe this is a bug in the export process, probably related to the way code blocks work in Google Docs.Dear Googlers, if you are reading this, please make a note that this thing has just been Hyrum&#x27;s Law. It is an observable state, and I&#x2019;m relying on it to do important tasks. Don&#x2019;t break this in the future.It turns out these are actually a pair of Unicode characters. More specifically, they are Unicode characters that are marked for private use:0xEC03&#xA0;- appears to be used to mark the beginning of a code block0xEC02&#xA0;- appears to be used to mark the end of a code blockNote the &#x201C;appears&#x201D;, and my blatant disregard for things like software maintenance discipline and all things proper and good in the world of Computer Science. This is a project where there are no rules, there is one customer, and he can code &#x1F642;.As mentioned earlier, while extracting the Google Doc as HTML and processing it, I encounter those Unicode markers that delineate the code section. This is good, because in terms of HTML itself, what it is doing inside is a&#x2026; mess. Getting the actual text as it is supposed to be is not easy. So I exported the file again, as text. Those markers are showing up in the textual edition as well, which made things a lot easier for me. With all of this done, allow me to show you some truly horrifying&#xA0;beautiful code:let blocks = [];&#xA;for (const match of text.data.matchAll(/\uEC03(.*?)\uEC02/gs)) {&#xA;    const code = match[1].trim();&#xA;    const lang = flourite(code, { shiki: true, noUnkown: true }).language;&#xA;    const formattedCode = Prism.highlight(code, Prism.languages[lang], lang);&#xA;&#xA;&#xA;    blocks.push(&quot;&lt;hr/&gt;&lt;pre class=&#x27;line-numbers language-&quot; &#x2B; lang &#x2B; &quot;&gt;&quot; &#x2B;&#xA;        &quot;&lt;code class=&#x27;line-numbers language-&quot; &#x2B; lang &#x2B; &quot;&#x27;&gt;&quot; &#x2B;&#xA;        formattedCode &#x2B; &quot;&lt;/code&gt;&lt;/pre&gt;&lt;hr/&gt;&quot;);&#xA;}&#xA;&#xA;&#xA;let inCodeSegment = false;&#xA;htmlDoc.findAll().forEach(e =&gt; {&#xA;    var text = e.getText().trim();&#xA;    if (text == &quot;&amp;#60419;&quot;) {&#xA;        e.replaceWith(blocks[codeSegmentIndex&#x2B;&#x2B;]);&#xA;        inCodeSegment = true;&#xA;    }&#xA;    if (inCodeSegment) {&#xA;        e.extract();&#xA;    }&#xA;    if (text == &quot;&amp;#60418;&quot;) {&#xA;        inCodeSegment = false;&#xA;    }&#xA;})That isn&#x2019;t a lot of code, but it does plenty. We scan through the textual&#xA0;version of the document and find all the code blocks using a regular expression. We then try to figure out what language I&#x2019;m using and apply code formatting during the publication process (this saves the need to change anything on the blog, which is nice, especially since we have to take into account syndication).I push the code snippets into an array and then I process the actual HTML document using the DOM and find all the code snippets. I replace the start marker with the actual formatted code and continue to discard all the other elements until I hit the end of the code segment. The rest of the code remains pretty much the same as before.I was writing this in VS Code and copilot suggested the following code for handling images:htmlDoc.findAll(&#x27;img&#x27;).forEach(img =&gt; {&#xA;    if (img.attrs.hasOwnProperty(&#x27;src&#x27;)) {&#xA;        let src = img.attrs.src;&#xA;        let imgName = src.split(&#x27;/&#x27;).pop();&#xA;        let imgData = entries.find(e =&gt; e.entryName === &#x27;images/&#x27; &#x2B; imgName).getData();&#xA;        let imgType = imgName.split(&#x27;.&#x27;).pop();&#xA;        let imgSrc = &#x27;data:image/&#x27; &#x2B; imgType &#x2B; &#x27;;base64,&#x27; &#x2B; imgData.toString(&#x27;base64&#x27;);&#xA;        img.replaceWith(&#x27;&lt;img src=&quot;&#x27; &#x2B; imgSrc &#x2B; &#x27;&quot; style=&quot;float: right&quot;/&gt;&#x27;);&#xA;    }&#xA;})In other words, instead of uploading the images as separate files, I can just encode them into the blog post directly. I like that idea very much because it means that I don&#x2019;t have to store the images elsewhere. Given that I don&#x2019;t have any npm packages to abandon, I don&#x2019;t know if I can call myself a JavaScript developer, but I did put the full code up&#xA0;for people to take a peek and then recoil.</p>
        </article>
        <article id="article-476">
            <a href="https://ardalis.com/2023-year-in-review/" target="_blank">
                <h2 class="title mb-6" id="article-476">2023 Year in Review</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 23, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Now that CodeMash is over (I had a workshop and 2 talks, including a new one), I can focus enough to write up this review post. For those&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-477">
            <a href="https://devblogs.microsoft.com/dotnet/dotnet-framework-january-2024-cumulative-update-preview/" target="_blank">
                <h2 class="title mb-6" id="article-477">.NET Framework January 2024 Cumulative Update Preview</h2>
            </a>
            <p class="mb-2">by Salini Agarwal</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 23, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">January 2024 Cumulative Update Preview Updates for .NET Framework.</p>
        </article>
        <article id="article-478">
            <a href="https://andrewlock.net/creating-a-source-generator-part-10-testing-your-incremental-generator-pipeline-outputs-are-cacheable/" target="_blank">
                <h2 class="title mb-6" id="article-478">Testing your incremental generator pipeline outputs are cacheable</h2>
            </a>
            <p class="mb-2">by Andrew Lock</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 23, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Creating a source generator - Part 10</p>
        </article>
        <article id="article-479">
            <a href="https://ayende.com/blog/200578-B/non-fungible-money-in-cloud-accounting" target="_blank">
                <h2 class="title mb-6" id="article-479">Non fungible money in cloud accounting</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 22, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Fungible is a funny word, mostly because you are most likely familiar with the term from NFT (non-fungible tokens) and other similar scams. At its core, it is the idea that for certain things, the instance doesn&#x2019;t matter, just the amount.The classic example is that if I lend you a 50$ bill, and you give me back two 20$ bills and a 10$ bill, you&#x2019;ve still given me back my money. That is even though you very clearly didn&#x2019;t. I didn&#x2019;t get the same physical 50$ paper bill back, I got bills for that same amount. On the other hand, if I give you my dog for the weekend, I would be quite upset if I got back three different dogs, even if the total weight is the same.This is actually a lot more than I want&#xA0;to know about fungibility, to be honest. But it turns out that if you are running a cloud business&#xA0;or just use the cloud in general, you have to be well-versed in the matter. Because in the cloud, money isn&#x2019;t&#xA0;fungible. In fact, it doesn&#x2019;t behave a lot like money at all. Let&#x2019;s assume that we are a cloud company called cloud.example.com, offering VPS for ourr users. You are in charge of writing the billing code, and it is pretty simple, right? Here is some code that can compute the charges:function compute_charges(custId, start, end) {&#xA;  let total = 0;&#xA;  let predicate = instance =&gt;&#xA;    (instance.custId === custId  &amp;&amp; instance.started &lt; end) &amp;&amp;&#xA;    (instance.ended &gt; start      || instance.ended == null);&#xA;&#xA;&#xA;  for (let instance of query_instances(predicate)) {&#xA;    total &#x2B;= instance.hours_running(start, end) *&#xA;             instance.price_per_hour;&#xA;  }&#xA;&#xA;&#xA;  return total;&#xA;}As you can see, there isn&#x2019;t much there. We find all the instances that were running in the billing period and then calculate the total hours they ran during that period. Please note, this is a simplified model as we aren&#x2019;t dealing with stopping &amp; starting instances, etc. The output of the compute_charges()&#xA0;function is a number, which will presumably be handed over to be charged over a credit card. There are other things that we need to do as well (generate an invoice, have a usage report, etc), but I want to focus on the money issue here.The simplest model is that at the end of the billing period, we charge the customer (using a credit card, for example) and receive our payment. Everyone is happy and we can go home, hopefully richer. The challenge arises when we want to offer additional options to the customer. For example, we may be willing to give the customer a discount if they are going to commit to a minimum amount of money they&#x2019;ll spend each month. We may want to offer them upfront payment options or give monetary incentives to a particular aspect of the business (run on ARM instances instead of X64, for example).Each time that we make such an offer, we are going to be turning around and (significantly) complicating the way we bill the customer. Let&#x2019;s talk about something as simple as committing to run an instance for a whole year. No upfront payment, just a commitment to pay for a particular server for a year. In AWS or Azure, that would be Reserved Instances, so you are likely very familiar with the idea.How is that going to be expressed in code? Probably something like this:function compute_charges(custId, start, end) {&#xA;    let total = 0;&#xA;    let predicate = instance =&gt; /*..redacted.*/;&#xA;   &#xA;    var hrsPerIns = {};&#xA;    for (let i of this.instances(predicate)) {&#xA;        let hours = i.hours_running(start, end);&#xA;        hrsPerIns[i.type] = hours &#x2B; (hrsPerIns[i.type] || 0);&#xA;        total &#x2B;= hours * i.price_per_hour;&#xA;    }&#xA;&#xA;&#xA;    for (let c of this.commitmentsFor(custId, start, end)) {&#xA;        let hours = c.committed_time(start, end);&#xA;        let hoursUsed = hrsPerIns[c.type] || 0;&#xA;        let unusedCommittedHours = Math.max(0, hours - hoursUsed);&#xA;        total &#x2B;= unusedCommittedHours *&#xA;                this.instance(c.type).price_per_hour;&#xA;    }&#xA; &#xA;    return total;&#xA;  }To be clear, the code above is not&#xA0;a good way to handle such a task, but it does show in a pretty succinct way the hidden complexities. In this case, if you didn&#x2019;t meet your commitment, we&#x2019;ll charge you for the unused commitment as well. A more complex system would have to account for discounted rates while using the committed values, for example. And in that case, the priority of applying such rates between different matching commitments. Other aspects may be giving the user a discount for a particular level of usage. So the first 100GB are priced differently from the rest, applying a free tier and&#x2026; you get the point, I think. It gets complex.Note that at this point, we aren&#x2019;t even talking about money yet, we are discussing computing the charges. The situation is more interesting when we move to the next stage. On the face of it, this seems pretty simple, all you need to do is charge the credit card, no?Okay, maybe you need to send an invoice, but that is about it, right?Well&#x2026; what happens if the customer made an upfront payment for one of those commitments? Or just accidentally paid twice last month and now has credit on your system. I&#x2019;m going to leave aside the whole complexity around payments bouncing&#xA0;(which is a whole other interesting topic) and how to deal with the actual charging. Right now I want to focus on the nature of money itself.Imagine you have a commitment with a customer for an 8-core / 64 GB VPS server for a whole year. And they paid upfront, getting a nice discount along the way. How would you record that in your system?The easiest is to create the notion of credit for the user, which you deduct whenever you need to charge them. So we&#x2019;ll first compute the charges, then deduct the existing credits, and debit the customer if anything remains. This is simple, easy to work with, and wrong.Remember that discount the user received? They paid for that particular VPS type, and if you now need to charge them for anything else (such as storage charges), that money cannot come from the funds paid for the VPS. In other words, the money the customer paid is not fungible. It isn&#x2019;t applicable for any charge, it is colored. It is dedicated to a particular purpose. And managing that&#xA0;turns out to be pretty complex. Mostly because we are trying to fit everything into the debits and credits on the account. A better model is to avoid using&#xA0;money, in the same way that if you mix inches and centimeters you&#x2019;ll eventually end up in a bad place on Mars. The solution is to treat each individual charge as its own &#x201C;currency&#x201D;.In other words, when computing the charges, we aren&#x2019;t trying to find the cost of running a particular instance for the billing period. We are trying to find how many &#x201C;cost units&#x201D; we have for that time period.Instead of getting a single number that we&#x2019;ll charge the customer, we&#x2019;ll obtain a detailed set of the changes in question. Not as money, but as cost units. Think about those in a similar way to currency. &#xA0;Note that all the units are multiples of 730 hours (number of hours per month, on average).compute_charges(custId, start, end) =&gt; {&#xA;    custId: &#x27;customers/3291-B&#x27;,&#xA;    start: &#x27;2024-01-01&#x27;, end: &#x27;2024-01-31&#x27;,&#xA;    costs: [&#xA;      {type: &#x27;8Cores-64GB-hours&#x27;,  qty: 2190},&#xA;      {type: &#x27;4Cores-32GB-hours&#x27;,  qty:  730},&#xA;      {type: &#x27;disk-5000-iops&#x27;,     qty: 2920},&#xA;    ],&#xA;}The next step after that is to get your allocated budget for the same billing period, which will look something like this:compute_budget(custId, start, end) =&gt; {&#xA;    custId: &#x27;customers/3291-B&#x27;,&#xA;    start: &#x27;2024-01-01&#x27;, end: &#x27;2024-01-31&#x27;,&#xA;    commitments: [&#xA;      {type: &#x27;8Cores-64GB-hours&#x27;,  qty: 2190},&#xA;      {type: &#x27;4Cores-32GB-hours&#x27;,  qty: 1460},&#xA;      {type: &#x27;disk-5000-iops&#x27;,     qty: 730},&#xA;    ],&#xA;}In other words, just as we compute the charges based on the actual usage for that billing period, we apply the same approach on the commitments we have. The next stage is to just add all of those together. In this case, we&#x2019;ll end up with the following:8Cores-64GB-hours &#x21D2; 0 (we used as much as we committed to)4Cores-32GB-hours &#x21D2; -730 (we committed to more than we used)Disk-5000-iops &#x21D2; 2190 (remaining use after applying commitment, priced as you go)We aren&#x2019;t done yet, after commitments, there are other plans that we may need to run. For example, we&#x2019;ll provide you with some global discounts for VM rental (which doesn&#x2019;t apply to disks, however). Working at the level of cost units (or colors, or currency, whatever term you like) allows us to apply those things in a very fine-grained manner. More importantly, the end result and all its intermediate steps are very clear. That is quite important when you look at a six-figure bill with hundreds of line items and you want to see whether the billing matches your contract or not. As you can imagine, given the inherent complexity of the system, being able to clearly &#x201C;show your work&#x201D; is quite important. Especially when there is a misunderstanding or questions are being raised (and there will be).What we have done now is compute the actual charges based on their type, but we need to convert that to real money. There are several steps along this process:We need to charge all the active commitments. Those may have been pre-paid (in which case there is no current charge), but they may have a (fixed) monthly cost that we need to add to the current invoice.We need to perform a &#x201C;currency conversion&#x201D; between the units we have and actual money. In the example above, we have a negative number of units (for 4Cores-32GB-hours), as we committed to more hours than we actually used. We are still being charged for this by applying the rate from the commitment. On the other hand, when we examine the disk costs, we used more than we committed to. Here we need to make a decision about what price we&#x2019;ll charge the user. It can be the commitment price or the pay-as-you-go price. So even for the same currency&#xA0;we may have different rules. After all of this is done, we are now left with a final number. The actual amount of money that we need to charge the customer. This is the point at which we check if the customer has any credit already paid in the system or if we need to make an actual charge. That aspect is complicated by whether you are charging a credit card (same for any other automatic billing option) or issuing an invoice to be paid manually. For a manual invoice, you now have a whole other&#xA0;process. For example, you may offer discounts for the customer if they pay within 14 days versus the usual 30, or charge a fee for paying within 60 days, etc. I&#x2019;m not touching on collections or what to do when you fail to charge the customer. It is shockingly&#xA0;common to encounter payment failures. To the point where we never had a single payment run that didn&#x2019;t include at least several such cases. The reasons range from deal size too big to (temporary) lack of funds to suspicious-seeming activity. You need to be able to handle that as well. But those are topics for another post. In this post, my aim was to discuss just the issue of the complexity of money in the cloud business. I find the model of treating the charges as separate &#x201C;currencies&#x201D; to be a nice one overall, but I would love to hear about other people&#x2019;s experiences in this matter.</p>
        </article>
        <article id="article-480">
            <a href="https://www.meziantou.net/how-to-get-assembly-code-generated-by-the-jit-for-a-csharp-method.htm" target="_blank">
                <h2 class="title mb-6" id="article-480">How to get assembly code generated by the JIT for a C# method</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 22, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">When you execute a .NET method, the JIT compiles the method to native code. This native code is then executed by the CPU. In this post, I describe how you can inspect the generated assembly code.&#xA0;Table Of ContentsUsing the DOTNET_JitDisasm environment variableUsing DisasmoUsing Sharplab#Using the D</p>
        </article>
        <div class="button flex justify-between">
            <a href="47.html"><span class="back arrow"></span></a>

            <a href="49.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>