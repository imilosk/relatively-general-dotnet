
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Home â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<script>
    const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

    function getUserPref() {
        const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
        return storedTheme || (lightModePref.matches ? "light" : "dark");
    }

    function setTheme(newTheme) {
        if (newTheme !== "light" && newTheme !== "dark") {
            return console.warn(
                `Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
            );
        }

        const root = document.documentElement;

        // root already set to newTheme, exit early
        if (newTheme === root.getAttribute("data-theme")) {
            return;
        }

        root.setAttribute("data-theme", newTheme);

        const colorThemeMetaTag = document.querySelector("meta[name='theme-color']");
        const bgColour = getComputedStyle(document.body).getPropertyValue("--theme-bg");
        colorThemeMetaTag.setAttribute("content", `hsl(${bgColour})`);
        if (typeof localStorage !== "undefined") {
            localStorage.setItem("theme", newTheme);
        }
    }

    // initial setup
    setTheme(getUserPref());

    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("theme-toggle").addEventListener("click", () => {
            const theme = localStorage.getItem("theme");

            if (theme === "dark") {
                setTheme("light");
            } else {
                setTheme("dark");
            }
        });

        document.getElementById("toggle-navigation-menu").addEventListener("click", (e) => {
            const button = e.target;
            const ariaExpanded = button.getAttribute("aria-expanded");
            const header = document.getElementById("main-header");

            if (ariaExpanded === "true") {
                button.setAttribute("aria-expanded", "false");
                header.classList.remove("menu-open");
            } else {
                button.setAttribute("aria-expanded", "true");
                header.classList.add("menu-open");
            }
        });
    });
</script>

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <theme-toggle class="ms-auto">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main">
    <section aria-label="Blog post list">
        <a href="https://ayende.com/blog/173409/ravendb-passed-half-a-million-downloads" target="_blank"><h1 class="title mb-6">RavenDB passed half a million downloads</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 23, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We just noticed:</p>
        <a href="https://enterprisecraftsmanship.com/posts/partially-initialized-entities-anti-pattern/" target="_blank"><h1 class="title mb-6">Partially initialized entities anti-pattern</h1></a>
        <p class="mb-2">by Vladimir Khorikov</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 22, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The topic described in this article is a part of my Domain-Driven Design in Practice Pluralsight course.&#xA; In this post, I&#x2019;d like to talk about the partially initialized entities anti-pattern: anti-pattern that is often used in conjunction with repositories.&#xA; Partially initialized entities Partially initialized entities are entities which are not fully constructed and returned as a result of some operation, usually an operation of fetching them from the database.</p>
        <a href="https://ardalis.com/configure-nlog-with-structuremap/" target="_blank"><h1 class="title mb-6">Configure NLog with StructureMap</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 22, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In a couple of recent posts, I demonstratedhow to set up StructureMap 4 in a simple .NET console application, and how to configure NLog to&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ayende.com/blog/173377/dependencies-management-in-a-crisis" target="_blank"><h1 class="title mb-6">Dependencies management in a crisis</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 22, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Typically when people talk about dependencies they talk about how easy it is to version them, deploy them, change &amp; replace them, etc. There seems to be a very deep focus on the costs of dependencies during development. Today I want to talk about another aspect of that. The cost of dependencies when you have a crisis. In particular, consider the case of having a 2 AM support call that is rooted to one of your dependencies. What do you do then?  The customer see a problem in your software, so they call you, and you are asked to resolve it. After you narrowed the problem down to a particular dependency, you now need to check whatever this is your usage of the dependency that is broken, or whatever there is a genuine issue with the dependency. Let us take a case in point with a recent support call we had. When running RavenDB on a Windows Cluster with both nodes sharing the same virtual IP, authentication doesn&#x2019;t work. It took us a while to narrow it down to Windows authentication doesn&#x2019;t work, and that is where we got stuck. Windows authentication is a wonderfully convenient&#xA0; tool, but if there is an error, just finding out about it require specialized knowledge and skills. After verifying that our usage of the code looked correct, we ended up writing a minimal reproduction with about 20 lines of code, which also reproduced the issue.  At that point, we were able to escalate to Microsoft with the help of the customer. Apparently this is a Kerberos issue and you need to use NTLM and there was a workaround with some network configuration (check our docs if you really care about the details). But the key point here is that we would really have absolutely no way to figure it out on our own. Our usage of Windows authentication was according to the published best practices, but in this scenario you had to do something different to get it to work. The point here is that if we weren&#x2019;t able to escalate that to Microsoft, we would be in a pretty serious issue with the customer &#x201C;we can&#x2019;t fix this issue&#x201D; is something that no one wants to hear. As much as possible, we try to make sure that any dependencies that we take are either:  Stuff that we wrote and understand. Open source* components that are well understood. Have a support contract that we can fall back on, with the SLA we require. Non essential / able to be disabled without major loss of functionality. * Just taking OSS component from some GitHub repo is a bad idea. You need to be able to trust them, which means that you need to be sure that you can go into the code and either fix things or understand why they are broken.</p>
        <a href="https://www.stevejgordon.co.uk/how-to-send-emails-in-asp-net-core-1-0" target="_blank"><h1 class="title mb-6">How to Send Emails in ASP.NET Core 1.0</h1></a>
        <p class="mb-2">by Steve Gordon</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 20, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">ASP.NET Core 1.0 is a reboot of the ASP.NET framework which can target the traditional full .NET framework or the new .NET Core framework. Together ASP.NET Core and .NET Core have been designed to&#xA0;work cross platform and&#xA0;have a lighter, faster footprint&#xA0;compared to the current full .NET framework. Many of the .NET Core APIs are the [&#x2026;]</p>
        <a href="https://ardalis.com/using-structuremap-4-in-a-console-app/" target="_blank"><h1 class="title mb-6">Using StructureMap 4 in a Console App</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 20, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">If you&#x2019;re using an older version of StructureMap or want more of an introduction, please read A Gentle Introduction to StructureMap, which&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ayende.com/blog/173345/the-cost-of-async-i-o-false-assumptions-and-pride" target="_blank"><h1 class="title mb-6">The cost of async I/O, false assumptions and pride</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 19, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">As you might have noticed, we are doing a lot of performance work. We recently moved some of our code to use async I/O in the hope of getting even more performance from the system.&#xA;The result was decidedly not what we expected. On average we saw about 10% &#x2013; 30% reduction in speed, just from the use of aysnc operations. So we decided to test this.&#xA;The test is simple, make a read of a large file (1.4GB) from a network drive without buffering. The synchronous code is:&#xA;&#xA; private static void SyncWork(int pos)&#xA; {&#xA;     var sp = Stopwatch.StartNew();&#xA;     var buffer = new byte[1024 * 4];&#xA;     long size = 0;&#xA;     using (var sha = SHA1.Create())&#xA;     using (var stream = new FileStream(@&quot;p:\dumps\dump-raven.rar&quot;, FileMode.Open, FileAccess.Read, FileShare.Read, 4 * 1024,&#xA;         FileOptions.SequentialScan | FILE_FLAG_NO_BUFFERING))&#xA;     {&#xA;         stream.Seek(pos * ReportSize, SeekOrigin.Begin);&#xA;         int read;&#xA;         while ((read = stream.Read(buffer, 0, buffer.Length)) != 0)&#xA;         {&#xA;             sha.ComputeHash(buffer, 0, read);&#xA;             size &#x2B;= read;&#xA;             if (size &gt;= ReportSize)&#xA;             {&#xA;                 Console.WriteLine($&quot;Read {size / 1024 / 1024:#,#} mb sync {sp.ElapsedMilliseconds:#,#}&quot;);&#xA;                 return;&#xA;             }&#xA;         }&#xA;     }&#xA; }&#xA;&#xA;To make things interesting, we are reading 32 MB in 4KB chunks and computing their SHA1 hash. The idea is that this is a mix of both I/O and CPU operations. The machine I&#x2019;m testing this on has 8 cores, so I run 16 copies of this code, with different start positions.&#xA;&#xA;for (int i = 0; i &lt; 16; i&#x2B;&#x2B;)&#xA;{&#xA;    var copy = i;&#xA;    new Thread(state =&gt;&#xA;    {&#xA;        SyncWork(copy);&#xA;    }).Start();&#xA;    Thread.Sleep(250);&#xA;}&#xA;&#xA;&#xA;The basic idea was to simulate work coming in, doing different things, and to simulate slow I/O and computation. 16 threads means that I have more threads than CPU cores, so we&#x2019;ll have some context switches. Note that the use of unbuffered I/O means that we have to go over the network (slow).&#xA;The output of this code is:&#xA;&#xA;Read 32 mb sync 8,666&#xA;Read 32 mb sync 8,794&#xA;Read 32 mb sync 8,995&#xA;Read 32 mb sync 9,080&#xA;Read 32 mb sync 9,123&#xA;Read 32 mb sync 9,299&#xA;Read 32 mb sync 9,359&#xA;Read 32 mb sync 9,593&#xA;Read 32 mb sync 9,376&#xA;Read 32 mb sync 9,399&#xA;Read 32 mb sync 9,381&#xA;Read 32 mb sync 9,337&#xA;Read 32 mb sync 9,254&#xA;Read 32 mb sync 9,207&#xA;Read 32 mb sync 9,218&#xA;Read 32 mb sync 9,243&#xA;&#xA;Now, let us look at the equivalent async code:&#xA;&#xA;private static async Task AsyncWork(int pos)&#xA;{&#xA;    var sp = Stopwatch.StartNew();&#xA;    var buffer = new byte[1024 * 4];&#xA;    using (var sha = SHA1.Create())&#xA;    using (var stream = new FileStream(@&quot;p:\dumps\dump-raven.rar&quot;, FileMode.Open, FileAccess.Read, FileShare.Read, 4 * 1024,&#xA;        FileOptions.SequentialScan | FileOptions.Asynchronous | FILE_FLAG_NO_BUFFERING))&#xA;    {&#xA;        stream.Seek(pos * ReportSize, SeekOrigin.Begin);&#xA;        long size = 0;&#xA;        &#xA;        int read;&#xA;        while ((read = await stream.ReadAsync(buffer, 0, buffer.Length)) != 0)&#xA;        {&#xA;             sha.ComputeHash(buffer, 0, read);&#xA;             size &#x2B;= read;&#xA;             if (size &gt;= ReportSize)&#xA;             {&#xA;                 Console.WriteLine($&quot;Read {size / 1024 / 1024:#,#} mb async {sp.ElapsedMilliseconds:#,#}&quot;);&#xA;                 return;&#xA;             }&#xA;        }&#xA;    }&#xA;}&#xA;&#xA;Note that here I&#x2019;m using async handle, to allow for better concurrency. My expectation was that this code will interleave I/O and CPU together and result in less context switches, more CPU utilization and overall faster responses.&#xA;Here is the network utilization during the async test:&#xA;&#xA;And here is the network utilization during the sync test:&#xA;&#xA;Trying the async using 64Kb buffers gives better results:&#xA;&#xA;And output of:&#xA;&#xA;Read 32 mb async  8,290&#xA;Read 32 mb async 11,445&#xA;Read 32 mb async 13,327&#xA;Read 32 mb async 14,088&#xA;Read 32 mb async 14,569&#xA;Read 32 mb async 14,922&#xA;Read 32 mb async 15,053&#xA;Read 32 mb async 15,165&#xA;Read 32 mb async 15,188&#xA;Read 32 mb async 15,148&#xA;Read 32 mb async 15,040&#xA;Read 32 mb async 14,889&#xA;Read 32 mb async 14,764&#xA;Read 32 mb async 14,555&#xA;Read 32 mb async 14,365&#xA;Read 32 mb async 14,129&#xA;&#xA;So it is significantly worse than the sync version when using 4KB buffers. The bad thing is that when using 64Kb buffer in the sync version, we have:&#xA;&#xA;And the whole process completed in about 2 seconds.&#xA;I&#x2019;m pretty sure that I&#x2019;m doing everything properly, but it seems like the sync version is significantly cheaper.&#xA;Short summary, the solution is throw all of async code way in favor of pure sync code, because it is so much faster. Banish async, all hail to the synchronous overload.&#xA;However, the plot thickens!&#xA;Before before declaring death to asynchronicity, with thunderous applause, I decided to look further into things, and pulled out my trusty profiler.&#xA;Here is the sync version:&#xA;&#xA;As expected, most of the time is spent in actually doing I/O. The async version is a bit harder to look at:&#xA;&#xA;This is interesting, because no I/O actually occurs here. At first I thought that this is because we are only using async I/O, so all of the missing time (notice that this is just 625 ms) is lost to the I/O system. But then I realized that we are also missing the ComputeHash costs.&#xA;Profiling async code is a bit harder, because you can&#x2019;t just track the method calls. We found the missing costs here:&#xA;&#xA;And this is really interesting. As you can see, most of the cost is in the ReadAsync method. My first thought was that I accidently opened the file in sync mode, turning the async call into a sync call. That didn&#x2019;t explain the different in costs from the sync version, through, and I verified that the calls are actually async.&#xA;Then I looked deeper:&#xA;&#xA;Why do we have so many seeks?&#xA;The answer lies in this code. And that explained it, including a big comment on why this happens. I created an issue to discuss this.&#xA;Calling SetFilePointer is typically very fast, since the OS just need to update an internal structure. For some reason, it seems much more expensive on a remote share. I assume it need to communicate with the remote share to update it on its position. The sad thing is that this is all wasted anyway, since the file position isn&#x2019;t used in async calls, each actual call to ReadFileNative will be given the offset to read there.</p>
        <a href="https://ayende.com/blog/173313/trie-based-routing" target="_blank"><h1 class="title mb-6">Trie based routing</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 18, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In my previous post, I discussed the cost of routing in MVC vs. our own implementation. The MVC routing / infrastructure consumed about 90% of the time, while the code that actually does stuff is left with less than 10%. In our implementation, the actual request handling code gets about 85% of the time, while all the infrastructure is handled in the other 15%. Of that , a large portion of that time is actually spent on routing. In our tests, we saw something like 40% of the time spent in selecting the right controller action to execute, this is when there is just one such action that can be run. Now, to be fair, this is a scenario where we don&#x2019;t actually have any meaningful logic. We are just saying &#x201C;hello world&#x201D; over and over again, so the infrastructure costs are really noticeable in this benchmark. But that is the point, we want to see what are the fixed costs of the infrastructure we use. Now, in RavenDB we have several hundreds routes (last count was something upward of 400), and we noticed that routing take a lot of time to select the right action to run. We optimized the hell out of that to the point by specializing that to our own situation and based on our own knowledge. But when we started to look at moving our code to Kestrel, we took the time to move to a system that is a better fit for us. The major reason routing is such an expensive issue in MVC is that it does quite a lot. It needs to handle route selection, capturing values, coercing data to the right types and a lot more. All of that takes time, memory and cpu cycles. But as it turn out, we don&#x2019;t really need all of that. We have relatively simple routing needs. Here are a few example of RavenDB routes:  /admin/stats /databases/{databaseName}/docs /databases/{databaseName}/indexes/{*id} So we have the fixed routes, like /admin/stats. We have routes that contain a database name in the middle, and we have routes with a suffix. We can take advantage of that to create an optimal solution. In our case, we used a trie:  In computer science, a trie, also called digital tree and sometimes radix tree or prefix tree (as they can be searched by prefixes), is an ordered tree data structure that is used to store a dynamic set or associative array where the keys are usually strings. The cost of querying a trie is O(L), where L is the length of the key that we are querying. Here is how a very small trie looks in our tests.  We start from the route, matching each character against the trie node key. Once we have consumed the full key, we check if it has any children starting with the next character in the url. Note that the Children array here is of size 127. This allows us to index directly into the array (at cost of O(1)) to find the next trie node. We didn&#x2019;t want to use a dictionary here because of its size and its cost relative to an array access.  This has some interesting implications:  The route definition is limited to ASCII characters (but the actual urls are not, mind). Regardless of the number of routes, we are ensured of reliable performance.  But that still doesn&#x2019;t let us handle routes like the ones above. In order to do that, we had to extend the syntax a bit. /admin/stats would match exactly. That is easiest. /databases/*/docs is a route that has a capture. The * symbol says &#x201C;matches anything but /&#x201D;, so we can get the database name captured without complex matching. Note that by capture, I mean just record the start position and length, we don&#x2019;t want to pull a substring out of that and pay for an extra allocation. /databases/*/indexes/$ is another route that has special meaning. The $ symbol says &#x201C;the match is done, even if the url has additional characters&#x201D;. That way we can capture embedded ids easily (again, no allocations). The end result?  Or roughly a route match in 0.9 &#x3BC;s. Pretty good, even if I say so myself.</p>
        <a href="https://ayende.com/blog/173282/the-cost-of-routing" target="_blank"><h1 class="title mb-6">The cost of routing</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 17, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I was asked to see what is the cost of WebAPI on Kestrel, and it lines up nicely with a topic that I wanted to talk about, routing. So I thought I&#x2019;ll start with a small benchmark. Here is a small Kestrel based server, using MVC / WebAPI: public class Program&#xA;{&#xA;    public void ConfigureServices(IServiceCollection services)&#xA;    {&#xA;        services.AddMvc();&#xA;    }&#xA;&#xA;    public void Configure(IApplicationBuilder app, ILoggerFactory loggerfactory)&#xA;    {&#xA;        app.UseMvc();&#xA;    }&#xA;&#xA;    public static void Main(string[] args)&#xA;    {&#xA;        var configBuilder = new ConfigurationBuilder()&#xA;            .Add(new MemoryConfigurationProvider(new Dictionary&lt;string, string&gt;&#xA;            {&#xA;                [&quot;server.urls&quot;] = &quot;http://localhost:8080&quot;&#xA;            }));&#xA;&#xA;        IHostingEngine application = new WebHostBuilder(configBuilder.Build())&#xA;            .UseStartup&lt;Program&gt;()&#xA;            .UseServer(&quot;Microsoft.AspNet.Server.Kestrel&quot;)&#xA;            .Build();&#xA;&#xA;&#xA;        using (application.Start())&#xA;        {&#xA;            Console.WriteLine(&quot;ready&quot;);&#xA;            Console.ReadLine();&#xA;        }&#xA;    }&#xA;}&#xA;&#xA;&#xA;And here is a simple controller:&#xA;[Route(&quot;api/[controller]&quot;)]&#xA;public class ValuesController : Controller&#xA;{&#xA;    // GET api/values&#xA;    [HttpGet()]&#xA;    public string Get()&#xA;    {&#xA;        return &quot;Hello World&quot;;&#xA;    }&#xA;}&#xA;&#xA;&#xA;&#xA;As you can see, this couldn&#x2019;t really be any more trivial. I have tested this with release mode, using the following gobench command:&#xA;&#xA;.\gobench.exe -c 100 -r 25000 -u http://localhost:8080/api/values&#xA;This was run after running a couple thousand requests as warm up.&#xA0; In other words, we are going to do a 2.5 million requests. I intentionally choose that value, because it force the server to do enough work to be meaningful, and the test run is long enough to see other factors creeping in. Note that this isn&#x2019;t a &#x201C;real&#x201D; benchmark, both gobench and this code are actually running on the same machine. But it is a good baseline.&#xA;Requests:                          2,500,000 hits&#xA;Successful requests:               2,500,000 hits&#xA;Network failed:                            0 hits&#xA;Bad requests failed (!2xx):                0 hits&#xA;Successful requests rate:             56,818 hits/sec&#xA;Read throughput:                   9,261,363 bytes/sec&#xA;Write throughput:                  5,454,545 bytes/sec&#xA;Test time:                                44 sec&#xA;&#xA;&#xA;Those are good numbers. Now let us see that with my code:&#xA;[RavenAction(&quot;/api/values&quot;, &quot;GET&quot;)]&#xA;public Task ValuesGet()&#xA;{&#xA;    return HttpContext.Response.WriteAsync(&quot;Hello world&quot;);&#xA;}&#xA;&#xA;&#xA;&#xA;There is no funny business here. We just route the request using my code, and then just write it to the client. The results:&#xA;Requests:                          2,500,000 hits&#xA;Successful requests:               2,500,000 hits&#xA;Network failed:                            0 hits&#xA;Bad requests failed (!2xx):                0 hits&#xA;Successful requests rate:             86,206 hits/sec&#xA;Read throughput:                  10,517,241 bytes/sec&#xA;Write throughput:                  8,275,862 bytes/sec&#xA;Test time:                                29 sec&#xA;&#xA;&#xA;That is over 25% improvement. &#xA;Now, there are a couple of things that works out better for my code. To start with, it is calling Response.WriteAsync directly, while the standard WebAPI code needs to get the result, figure out how to write it, etc.&#xA;In the profiler, this looks really interesting:&#xA;&#xA;So the time for actually executing the action is less than 10% of the request time. Everything else is some sort of setup.&#xA;In fact, let us dig deeper, the time to run our action is 0.2% of the 10% that this method runs:&#xA;&#xA;&#xA;To be fair, the method just returns a constant string. I would be shocked if it wasn&#x2019;t really fast.&#xA;Most of the time happens in the CreateActionResult, in which we select how we write. Let us look at this a bit differently:&#xA;&#xA;The InvokeExceptionFilterAsync is the part responsible for actually calling our code and getting the result.&#xA;The InvokeAllResultFiltersAsync is responsible for figuring out how to write the output to the client. And this is the part where we actually write to the network:&#xA;&#xA;And here is how we do in the same scenario:&#xA;&#xA;You can note that 85% of the time we are spending in servicing the request, with just 15% dedicated to managing the infrastructure.&#xA;I&#x2019;ll discuss the details of that in my next post, though.</p>
        <a href="https://enterprisecraftsmanship.com/posts/3-ways-of-archiving-code-correctness/" target="_blank"><h1 class="title mb-6">3 ways of achieving code correctness</h1></a>
        <p class="mb-2">by Vladimir Khorikov</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 16, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Code correctness verification is not an easy task. At the same time, it&#x2019;s one of the most important problems we have when we build software projects. In this article, I&#x2019;ll compare 3 different ways of achieving code correctness.</p>
        <div class="button flex justify-between">
            <a href="221.html"><span class="back arrow"></span></a>

            <a href="223.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
</body>
</html>