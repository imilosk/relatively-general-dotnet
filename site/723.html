
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Home â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<script>
    const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

    function getUserPref() {
        const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
        return storedTheme || (lightModePref.matches ? "light" : "dark");
    }

    function setTheme(newTheme) {
        if (newTheme !== "light" && newTheme !== "dark") {
            return console.warn(
                `Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
            );
        }

        const root = document.documentElement;

        // root already set to newTheme, exit early
        if (newTheme === root.getAttribute("data-theme")) {
            return;
        }

        root.setAttribute("data-theme", newTheme);

        const colorThemeMetaTag = document.querySelector("meta[name='theme-color']");
        const bgColour = getComputedStyle(document.body).getPropertyValue("--theme-bg");
        colorThemeMetaTag.setAttribute("content", `hsl(${bgColour})`);
        if (typeof localStorage !== "undefined") {
            localStorage.setItem("theme", newTheme);
        }
    }

    // initial setup
    setTheme(getUserPref());

    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("theme-toggle").addEventListener("click", () => {
            const theme = localStorage.getItem("theme");

            if (theme === "dark") {
                setTheme("light");
            } else {
                setTheme("dark");
            }
        });

        document.getElementById("toggle-navigation-menu").addEventListener("click", (e) => {
            const button = e.target;
            const ariaExpanded = button.getAttribute("aria-expanded");
            const header = document.getElementById("main-header");

            if (ariaExpanded === "true") {
                button.setAttribute("aria-expanded", "false");
                header.classList.remove("menu-open");
            } else {
                button.setAttribute("aria-expanded", "true");
                header.classList.add("menu-open");
            }
        });
    });
</script>

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <theme-toggle class="ms-auto">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main">
    <section aria-label="Blog post list">
        <a href="https://ayende.com/blog/1773/link-love" target="_blank"><h1 class="title mb-6">Link love</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: October 15, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is kind of weird, take a look at this, I look at this and I hear in the background, &quot;Oren, this is your life.&quot; And as long as I&#x27;m dealing with link love, check this as well.    I&#x27;m going away to blush privately...</p>
        <a href="https://ayende.com/blog/1772/unit-testing-with-nhibernate-active-record" target="_blank"><h1 class="title mb-6">Unit testing with NHibernate / Active Record</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: October 14, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the more difficult regions to test in an application is the data access layer. It is difficult to test for several reasons:            It is usually complicated - fetching data effectively is not something trivial in many cases.            It can be highly dependant on the platform you are using, and moving between platforms can be a PITA.            It is usually hard to mock effectively.            Database by their natures keep state, tests should be isolated.            It is slow - we are talking out of process calls at best, remote system calls at worst.    I am a big fan of NHibernate, and I consider myself fairly proficent in mocking, and I find it very hard to mock data access code effectively, and that is when NHibernate already provides a very easy set of interfaces to work with.    The issue is not with calls like this:Post&#xA0;post&#xA0;=&#xA0;(Post)session.Load(typeof(Post),1);    This is very easy to mock.    The issue is with calls like this one:            Post&#xA0;post&#xA0;=&#xA0;(Post)session.CreateCriteria(typeof(Post))        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;.Add(Expresion.Like(&quot;Title&quot;,&#xA0;title))        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;.AddOrder(Order.Asc(&quot;PublishedAt&quot;))        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;.SetFirstResult(0)        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;.SetMaxResult(1)        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;.UniqueResult();        Trying to mock that is going to be... painful. And this is a relatively simple query. What is worse are a series of queries, which work together to return a common result. When my setup code crossed the 500 lines of highly recursive mocking just to give the test a reasonable place to work with, I knew that I had an issue.    I could break it up to more rigid interface, but that completely ignore the point of being flexible. The above query is hard coded, but pretty often I find myself building those dynamically, which is not possible using rigid (but more easily mockable) interfaces.Please note that I am not talking about the feasability of mocking those, I have done it, it is possible, if lenghty, I am talking about maintainability and the ability to read what was the intention after six months has passed. Bummer, isn&#x27;t it?    Then I thought about SQLite. SQLite, despite their documnetations shortcoming, is a lightwieght database engine that supports an in memory database. What is more, NHibernate already supports it natively (which saved me the effort :-) ). SQLite is an in-process database, and in-memory databases are wiped when their connections are closed. So far we removed two major obstacles, the statefulness of the databasess, and the inherent slowdowns we are going across process/machine boundaries. In fact, since we are using entirely in-memory database, we don&#x27;t even touch the file system :-).    But we have the issue of moving between platforms. We can&#x27;t just port the database to SQLite just for testing. Or can we?    First, let us define what we are talking about. I am not going to performance testing (except maybe SELECT N&#x2B;1 issues) on SQLite, this require the production (or staging) database with a set of tools to analyze and optimize what we are doing.    So, if we ruled perf testing from the set of scenarios we are looking for, we don&#x27;t need large amounts of data. NHibernate will create a schema for us, free of charge, and it can handle several databases transperantly. We don&#x27;t need to mock anything, it looks like we are golden.    I got the following code:            [TestFixture]                        public class InMemoryTests : NHibernateInMemoryTestFixtureBase                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; private ISession session;                                            &#xA0;                                &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [TestFixtureSetUp]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public void OneTimeTestInitialize()                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; OneTimeInitalize(typeof(SMS).Assembly);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [SetUp]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public void TestInitialize()                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; session = this.CreateSession();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                            &#xA0;                                            &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [TearDown]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public void TestCleanup()                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; session.Dispose();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Test]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public void CanSaveAndLoadSMS()                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SMS sms = new SMS();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; sms.Message = &quot;R U There?&quot;;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; session.Save(sms);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; session.Flush();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; session.Evict(sms);//remove from session cache                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SMS loaded = session.Load&lt;SMS&gt;(sms.Id);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(sms.Message, loaded.Message);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        }        Initialize the framework, create a session, and run. Notice that the test doesn&#x27;t care what it is working against. It just test that we can test/load an entity. Let us look at the base class:            public class NHibernateInMemoryTestFixtureBase                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; protected static ISessionFactory sessionFactory;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; protected static Configuration configuration;                                            &#xA0;                                &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /// &lt;summary&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /// Initialize NHibernate and builds a session factory                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /// Note, this is a costly call so it will be executed only one.                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /// &lt;/summary&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public static void OneTimeInitalize(params Assembly [] assemblies)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if(sessionFactory!=null)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Hashtable properties = new Hashtable();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; properties.Add(&quot;hibernate.connection.driver_class&quot;, &quot;NHibernate.Driver.SQLite20Driver&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; properties.Add(&quot;hibernate.dialect&quot;, &quot;NHibernate.Dialect.SQLiteDialect&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; properties.Add(&quot;hibernate.connection.provider&quot;, &quot;NHibernate.Connection.DriverConnectionProvider&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; properties.Add(&quot;hibernate.connection.connection_string&quot;, &quot;Data Source=:memory:;Version=3;New=True;&quot;);                                            &#xA0;                                &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; configuration = new Configuration();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; configuration.Properties = properties;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; foreach (Assembly assembly in assemblies)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; configuration = configuration.AddAssembly(assembly);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; sessionFactory = configuration.BuildSessionFactory();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public ISession CreateSession()                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ISession openSession = sessionFactory.OpenSession();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; IDbConnection connection = openSession.Connection;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; new SchemaExport(configuration).Execute(false,true,false,true,connection,null);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return openSession;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        }        Here we just initialize NHibernate with an in memory connection string and a SQLite provider. Then, when we need to grab a session, we make sure to initialize the database with our schema. Disposing the session closes the connection, which frees the database.    So far we handled the following issues: Slow, Stateful, Hard to mock, platform dependant. We have seen that none of them apply to the issue at hand. Now, what about the last one, testing complicate data fetching strategies?    Well, that is what we do here, aren&#x27;t we? In this case, true, we aren&#x27;t doing any queries, but it is the prinicpal that matters. Looking at a database through NHibernate tinted glasses, they look pretty much the same. And a querying strategy that works on one should certainly work on another (with some obvious exceptions). I am much more concerend about getting the correct data than how I get it.    The beauty here is that we don&#x27;t need to do anything special to make this happen. Just let the tools do their work.&#xA0;To use Active Record with this approach, you need replace the calls to the configuration with calls to ActiveRecordStarter, and that is about it.    Even though those tests execute code from the business logic to the database, they are still unit tests. To take Jeremy&#x27;s Qualities of a Unit Test&#xA0;as an example, unit tests should be:            Atomic - each test gets each own database instance, they can&#x27;t affect each other.            Order indepenent and isolated - same as above, once the test finished, its database is back to the Great Heap in the Sky.            Intention Revealing - throw new OutOfScopeException(&quot;Issue with test, not the technique&quot;);            Easy to setup - check above for the initial setup, afterward, it is merely an issue of shoving stuff into the database using NH&#x27;s facilities, which is very easy, in my opinion.            Fast - It is an in memory database, it is fast. For comparison, running this test on SQL Server (locahost) runs at about 4.8 seconds (reported from TestDrive.Net, and include all the initialization) running it on SQLite results in 3.4 seconds. Running an empty method on TestDriven.Net takes about 0.8 seconds. Most of the time is spent in the initial configuration of NHibernate, though.    Hope this helps....</p>
        <a href="https://ayende.com/blog/1771/didja-know-tasty-pita" target="_blank"><h1 class="title mb-6">Didja know? Tasty PITA</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: October 14, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">PITA is not just a curious sensation in your anal regions, it is a&#xA0;common food item in Israel.&#xA0;         For more informaiton, see the article.    Yum.</p>
        <a href="https://ayende.com/blog/1770/posting-habits" target="_blank"><h1 class="title mb-6">Posting habits</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: October 14, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I can&#x27;t figure out my own posting habits sometimes. I average on about 75 posts per month, but the actual post count vary pretty wildly. Last month I posted 54 posts through the month, the last two weeks I posted 55. This has to do with the amount of time that I spend at the office vs. the time that I spend at various client sites, I guess. I don&#x27;t get a lot of posts from clients (at least not the kind that they would want me to air :-) ).    On the other hand, I did read a lot of good books&#xA0;in spetember...</p>
        <a href="https://ayende.com/blog/1769/nhibernate-query-generator-1-5-is-done-time-with-magic" target="_blank"><h1 class="title mb-6">NHibernate Query Generator 1.5 Is Done! [Time With Magic]</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: October 14, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I have been working (and blogging about it) for a while, and I think that I finally hit the right combination of keys to make it compile, so I am&#xA0;shipping it :-)    If you fail to recall, it started as a simple way to generate criteria queries in strongly typed manner. The first version didn&#x27;t do much, and was fairly simple. As soon as I started using it, I began to want more, much more. If I was working with an open compiler (Boo), I could have written this as an extentions and be done with it. Unfortanetly, I am not :-(, so I had to resort to a vile trickery and back handed knavery in order to make csc.exe think that I am doing something valid.    At its basis, NHibernate Query Generator (from now on, NQG) is a code generator that works on a set of Hibernate Mapping Files (*.hbm.xml) or an Active Record assemblies. It spits out code that will allow you to perform OO queries against your database. I have posted about my progress several times in the past, but let us go over what it gives you.            This is the most basic example:                                    Where.User.Name == &quot;Ayende&quot;                                     Then there is a nice way to do multiply queries in a single statement, like this:                                     Where.Comment.Content == &quot;Active Record Rocks!&quot; ||                                 Where.Comment.Content.Like(&quot;NHibernate&quot;, MatchMode.Anywhere)                             Notice how we cleanly map between OO concepts to the operations that the database can handle...                 But once you have this, you start to want more. Automatic handling of joins between tables, like this:                                    Where.Post.Blog.Name == &quot;Ayende @ Blog&quot;                             It may not be obvious, be we need a join to answer this query.                 And if we have a single level of joins, why not several?                                    Where.Post.Blog.Author.Name == &quot;Ayende&quot;                             This is a three tables joins, as easy as anything.                 As long as we are at this, why are we querying against simple properties only? We can query against objects, like this sample:                                    Where.Comment.Post == post                                     And then you get stuck on the ternary logic of SQL and you want to have OO view of nulls, like this, which perform exactly as you think it should in C# and translated to &quot;is not null&quot; on the DB side:                                    Where.Post.Blog != null                                     Gettting Compiler Errors for some invalid queries was a lot harder though, but this code is illegal and will be caught at compile time:                                    Where.Post.Blog.Author == ayende &amp;&amp; Where.Blog.Name == &quot;Ayende&quot;                             One of the major issues that I had was enabling this feature.                 As long as we are taking care of querying, what about orderring? Can&#x27;t forget that, can we?                                     User.FindAll(OrderBy.User.Name)                             With Asc / Desc options, of course.    Extending the queries:    The generated classes are based on your mapping, but all the generated classes are marked partial so you can extend them with your own queries:            User.FindAll(Where.User.HasMoreThanThousandPosts)         Other features:            NQG supports C# and VB.Net                 It can work in two modes: command line tool, which can be run as part of the build or a custom tool for Visual Stuido that will generate code as you edit your mapping.                 It can work on Hibernate Mapping Files or Active Record Assemblies.                             Rich querying capabilities - above I showed just the showy stuff, but you got Like(), In(), and just about everything that you can think about.                                     It looks amazingly like real sentences in VB.Net                 How to Use:            From the command line:        &quot;NHQG cs *.hbm.xml .\queries&quot; - Process all the hbm.xml files in the directory and output the generated queries to the queries directory.        Note that you should include all the files in that directory, since the tool generates a QueryBuilder file that goes along with the generated code.                 From Visual Studio:        Go to the propeties of an hbm.xml file, and set the custom tool to: &quot;NHibernateQueryGenerator&quot;        Note, you still need the query builder file, which you can get from the zip or by running the tool from the command line manually (which will create it).                 If you are not using the recent vesion of Active Record or NHibernate (and I can assure you that you aren&#x27;t, unless by recent you mean Saturady 14/10/2006 - about half an hour before this is posted) you can use the versions that comes with the tool. By default it installs to:        C:\Program Files\Rhino\NHibernate Query Generator\ and you can get them from there.    Limitations:            Requires NHibernate 1.2 (from the trunk, at the moment) and the latest of                 The VB.Net support is mostly untested, and I would really like to hear from a developer working with this and NQG.    Reporting Bugs:    This is a small (the core generator is 600 Lines of code and the supporting query builders are another 400) piece of code, but it has to deal with a lot of conditions, I think that I made a good job in squashing them all, but you might hit a snag or two along the way. Usually in the more compelx/crazy mappings.    Download:    You can get the sources in the new repository, here&#xA0;(html view), or just grab the binaries from the usual place.    Special thanks:    Thanks to William Pierce for sending a patch to handle non qualified names and composite-id properties.</p>
        <a href="https://ayende.com/blog/1768/the-new-repository-rhino-tools" target="_blank"><h1 class="title mb-6">The New Repository: Rhino Tools</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: October 14, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Following the advice from the comments, I have managed to consolidate my various OSS SVN repositories into a single one, hosted at source forge.    I was quite suprised that it was so much, to tell you the truth.    The repository URL is:    https://svn.sourceforge.net/svnroot/rhino-tools/trunk/    To checkout, execute:svn co https://svn.sourceforge.net/svnroot/rhino-tools/trunk/&#xA0;rhino-tools    There is no password necceary for reads. I&#x27;ll be update the various links on the site to point to the correct location soon.</p>
        <a href="https://ayende.com/blog/1767/how-to-lamely-create-a-map-in-c" target="_blank"><h1 class="title mb-6">How to (lamely) create a map in C#</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: October 14, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">There are a lot of cases where I need to define in code some sort of a map that I would later want to modify. This is usually as simple as mapping a static list to be used in the code. This about mapping from System.Type to SqlType, for instance.    This is something that javascript can do very easily, and one of the reasons that I really like Boo. Check this out:            typeToSqlType = {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; System.Int32 : System.Data.SqlTypes.SqlInt32                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; System.Int64 : System.Data.SqlTypes.SqlInt64                        }        I am using those types of lists all over the place. In C#, you are forced to use a hashtable or a dictionary and manually create it. Bummer. Well, I gave it some though, and it looks like C# does support this syntax, although it is pretty aweful.             Type[][] typesToSqlType =                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; new Type[]{typeof(System.Int32), typeof(System.Data.SqlTypes.SqlInt32)},                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; new Type[]{typeof(System.Int32), typeof(System.Data.SqlTypes.SqlInt32)}                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; };        I will spare you what I have to do when it require different types of parameters. What is scary is that this is still more readable that the normal way to do this in C#</p>
        <a href="https://ayende.com/blog/1766/fighting-the-evil-xml-take-2" target="_blank"><h1 class="title mb-6">Fighting the Evil XML, Take 2</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: October 14, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">David Haydem&#xA0;posts about using Windsor, I thought that I would take a shot at duplicating his configuration using Binsor.     &#xA0;You can check his post for the XML configuration, but that was 25 lines of code. The Binsor code is 6 lines :-)            import BlogDataServices                        import DatabaseServices                                            &#xA0;                                 connectionString = &quot;Data Source=localhost;Initail Catalog=test;Trusted_Connection=Yes;&quot;                                            &#xA0;                                 Component(MyDatabase, IDatabase, SqlDatabase).connectionString = connectionString                        Component(MyBlogDataService, IBlogDataService, MyBlogDataService, Lifestyle.Transient)                        Component(HerBlogDataService, IBlogDataService, HerBlogDataService, Lifestyle.Transient)</p>
        <a href="https://ayende.com/blog/1765/usable-api" target="_blank"><h1 class="title mb-6">Usable API</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: October 14, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Here are a couple of suggestions when you design your API. They are mostly about dealing with passing collections:             &quot;params&quot; is your friend, it is much nicer to be able to write this:                                    foo.WithArgs(&quot;Bar&quot;,&quot;Foo&quot;,&quot;Fubar&quot;);                             That to write this:                                    foo.WithArgs( new string[] { &quot;Bar&quot;, &quot;Foo&quot;, &quot;Fubar&quot;} );                             The former is easier to read and to write.                One very important this to be aware of, try very hard not to write declarations like this one:                                     void WithArgs(string username, string password, params string[] optional);                             It is very confusing to read afterward, and removing a single parameter may change the intention of the code.                When you need a method that takes several collection parameters, try to ensure that the most commonly used argument at the end, so it would be easier to extend:                                    FindAll(Order[] orders, params ICriterion[] criterias)                             It is much easier to work with this method.                Finally, when you have code like the above, be sure to specify an overload that takes a single parameter of the first one, like this:                                     public static T FindFirst(Order order, params ICriterion[] criterias)                             This saves you the need to define an array for the simple cases.</p>
        <a href="https://ayende.com/blog/1764/what-is-wrong-with-the-builtin-help-is-visual-studio" target="_blank"><h1 class="title mb-6">What is wrong with the builtin help is Visual Studio</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: October 14, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just needed to findout what the exact parameters to #pragma warning were, so I hit F1, and at the same time, moved to Google and searched. By the time that I choose the site, found the information that I wanted and already copied it back to VS, the builtin help opened.    This making it useless. I probably should just map F1 to something else, since the Help is certainly isn&#x27;t helping...</p>
        <div class="button flex justify-between">
            <a href="722.html"><span class="back arrow"></span></a>

            <a href="724.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
</body>
</html>