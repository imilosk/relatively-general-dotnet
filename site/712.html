
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 712 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-7111">
            <a href="https://ayende.com/blog/2965/tasers" target="_blank">
                <h2 class="title mb-6" id="article-7111">Tasers</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 24, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Steve is talking about tasers and taser related deaths.&#xA0; I remember when we got a few tasers. The rules for using them were pretty strict, they were considered as firearm for all intents and purposes. Using them as a method to &quot;subdue&quot; people once they are handcuffed would fall under the category of torture. I can just imagine what I, personally, would do to anyone who tried that, and I would be the only first step in the chain. Then, of course, you have the nice legal situation where we literally had to get a doctor&#x27;s permit to use it. The open fire conditions where the same, but if the inmate had a heart problem, we were to shoot using old fashion bullets rather than use a taser. Old fashion firearms didn&#x27;t need a doctor&#x27;s permit to shoot. This is a screwed up world. Then again, we never gotten into a situation where we actually had to shoot someone, for which I am grateful. I abhor violence. It begets too much paperwork.</p>
        </article>
        <article id="article-7112">
            <a href="https://ayende.com/blog/2964/a-vision-of-enterprise-platform-hot-distributed-deployment" target="_blank">
                <h2 class="title mb-6" id="article-7112">A vision of enterprise platform</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 24, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">If deployment means a week with little sleep and beepers going off just as you nod to sleep, then you are doing it wrong. I am saying that as someone whose standard deployment procedure has two steps, &quot;svn up&quot; and &quot;build.cmd&quot;. Actually, I lied, I have a single step, deploy.cmd, which runs them both for me. Now, you can&#x27;t always get this procedure to work, this is especially true if you need to deploy several different parts of the same application at the same time. The classic example is making a change that requires modifying the database as well. More interesting examples consist of several layers of the same application, web servers, application servers, dedicated tasks servers and the database servers, all of whom need to be touched in order to deploy the new version of the application. One of my customers takes the simple approach of shutting down everything and systematically upgrading all the systems when the application itself is offline. That is probably the simplest approach, you don&#x27;t have to worry about concurrent state and multi versioning, but it is also the one that is harder to the business to deal with. In fact, service level agreements may very well limit or prevent doing that. Here is a simple table of the common SLA and their meaning, in terms of system maintenance:    Uptime Time for offline maintenance, monthly  99% 7 hours, 12 minutes  99.9% 43 minutes  99.99% 4 minutes  99.999% 26 seconds The last number is the one we should pay attention to, it is the magic 5 nines that SLA often revolves around. Now, SLA often talks about unplanned downtime, and in many systems, you can safely take it down outside of business hours and tinker as much as you like with it. Those are not the kind of systems that I want to talk about today. The system that you can take down safely are fairly easy to upgrade in a safe manner, as was previously mentioned. The systems that are more interesting are the ones that you want to be able to update on the fly, without a painfully long deployment cycle. This is directly related to the ability to meet required SLA, but it also has another critically important factor. Developer productivity. If making a change in the application is something that requires stopping the application, updating files, starting it up again and then being hit with the initial, it is painful, annoying and will lead developers to jump through all sorts of really nasty hops along the way. So easy deployment is critical both for the developer and for production, but the needs of each are vastly different. For developers, having it work &quot;most of the time&quot; is fine, having it consume more memory is also fine, because the application is not going to run for days on end. For production, it must work all the time, and you must watch your resource consumption very carefully. A typical hot deployment for production will usually look like this:   This assumes a typical production scenario in which you have duplicates of everything, for fail over and performance. This is just an extension of the previous cold deployment, since we are taking servers down, just not the application as a whole. This assumes that we actually can take vertical parts of the application down, which is not always the case, of course. But, basically, we start with both servers operational, move all traffic to the second server, and then perform a cold deploy to the first set of servers. Then we move all traffic to the new server and perform cold deployment on the second server.  In the end, this usually means that you can perform the entire thing upgrade without loss of service (although you may suffer loss of capacity. As I said, this is probably the ideal scenario for perform hot deployments, but it makes quite a few assumptions that are not always valid. The main one is that the application is structured vertically in such a way that we can close and open parts of it and there are no critical points along the way. I can think of one common scenario where this is not the case, several web servers sitting on top of the same database server, for instance. So, while this is a good approach, we probably want to consider others as well. Another option is to design the system with multiply&#xA0;concurrent versions from the get go. This gives us the following diagram:   We have several versions running at the same time, and we can migrate users slowly from one version to the next. This also gives us a nice rollback strategy if we have a botched version. The problem with this approach is that it is a complicated procedure. This is especially true if the application is composed of several independent services that needs to be upgraded separately. Again, database and web servers are common example, but even web services that needs to be upgraded requires some interesting mechanics when you have enough of them. I am going to talk about multi versioned databases in the next post in the series, so let us just take as a given that this is possible, and consider the implications. If I can run multiply versions at the same time, this means that I can probably propagate a change throughout a cluster of servers without having to worry about the change over semantics. (The time between the first server getting the change and the last one getting it). Before we go on with production deployments, I want to talk a bit about developer deployments. What do I mean by that? Well, deployment is probably the wrong term here, but this is the way most of the enterprise platforms make you go about it.&#xA0; And that is a problem. Deploying your changes just in order to run them is a problematic issue. It is problematic because it interferes with&#xA0;make-a-change/run approach, which is critically important for developer productivity.  As mentioned above, any multi step process is going to be painful as hell over any significant development. I often have to go through several dozens of change/run before I can say that I have finished with a particular feature. There is a strong incentive to make it as easy as possible, and as it turns out, we actually have the tools in place to do it very easily indeed. I have produced a screen cast that talks about hot deployment of compiled code, and applying the same principals to code in its textual form is demonstrated here.   Here is the directory structure that I envisioned for the platform. As you can guess, this is backed by source control, but more importantly, it is alive (queue mad laugher here). But what do I mean by that? I mean that any change whatsoever that is done to this directories will be automatically picked up and incorporated by the system as soon as the change is detected. This supports very nicely the idea of change &amp; run mentality. But what actually goes into these folders? The parts that are important to us are the entities, controllers and views. For discussing those, we will take the Account entity as an example. For the system, an Account entity is composed of the following files:   There is a reason why I choose to use boo as the primary language for extending the platform. Not just because of personal bias (which exists), but because it makes it so much easier to deal with quite a few issues. One of them is the ability to define my own syntax, so the content of the Account.boo file would be similar to this: entity Account:&#xA0;&#xA0;&#xA0; AccountId as int&#xA0;&#xA0;&#xA0; Name as string The ability to define entity as a keyword means that I don&#x27;t need to do anything more to define any persistence concerns, even though I intend to use this as an Active Record class, it is all handled by the framework. I do intend to allow extension using compiled code, that is why the binaries folder is there for, and you can certainly define C# classes, but the main idea here is to allow easy editing of the whole thing, which means that compilation is not necessarily a good thing. So, after this explanation, let us go back a bit and talk about what deployment means in this scenario? Well, the first thing that it means is that once a change is detected, you want to recompile the file and keep on moving without breaking your stride. Brail itself is a good example of it. Brail templates are instantly updated if changed, but they are usually compiled (thus supposedly faster). From the developer perspective, there isn&#x27;t any difference between the two. It works very well in practice, and the productivity boost means that it is encourage the small steps approach. All in all, I am quite happy with it. I am going to leave the technical details aside for now, let us just say that it is equally easy to do in both source and binary form, and you can either see the webcast or check the post&#xA0;about each one. There are a few things that we should be worried about, however, mainly, recompiling files all over the place will cause an assembly leak, which can have an adverse affect on memory consumption. Here we get to the some interesting design decisions. Batching compilation will help greatly here, so we can grab all the controllers and compile them into a single assembly, then recompile the changes into separated assemblies. This is the solution used by Brail, for instance. This seems like it can cause problems, and in theory, it will, but in practice, there are several mitigating factors:  During development, we can expect the application lifetime to be short enough that assembly leakage is rarely an issue, if it is, there is a small cost to restarting the application.  On production, we will rarely expect to have a lot of churn, so we can handle the extra memory requirement (in the order of a single megabyte or so, in most cases). More advance scenarios calls for either AppDomain restart (the way ASP.Net does it) or a separate AppDomain that can be safely loaded. Personally, I think that this would make the situation much harder, and I would like to avoid it if possible. The simplest solution works, in my experience. What this all means is that a developer can go and make a change to the Account controller, hit the page and immediately get the changes made. Deployment now means that we commit to the development branch, merge to the production branch, and then we request the production system to update itself from the source. A form of CI process is a valid idea in this scenario, and will probably be the default approach to updating changes in a single system scenario. We have to have a way to disable that, because we may want to upgrade only some of the servers at a time. This leaves us with the following issues: Debugging - How can we debug scripts? Especially dynamically changing scripts? Despite what some of the Ruby guys say, I want to have the best debugger that I can available. A platform with no or poor debugging support has a distinct disadvantage.  As it turns out, the problem isn&#x27;t that big. The Visual Studio debugger is a really smart one, and it is capable of handle this in most cases with aplomb. And since Boo code is compiled to IL, VS has few issues with debugging it. For the more complex scenarios, you can use C# and just direct the build path to the binaries folder. In any case, debugging would usually involve &quot;Attach to process&quot; rather than &quot;Start with debugger&quot;, but this is something that I can live with (Attach is faster anyway). Database modifications - let us just hand wave the way we are going to handle that for a minute. We will just assume we can do something like UpdateSchema() and it will happen, we still need to think about the implications of that. Now we need to think about how we are going to handle that when we update an entity. Do we want this update to the schema to be automatic, or do we want it to happen as a result of user input? Furthermore, changing the entity basically invalidate the ability to call the database, so how do we handle that?  Do we disable the usage of this entity until the DB is updated? Do we just let the user to run into errors? What do we do for production, for that matter? I definitely not going to let my system run with DDL permission for production, so that is another problem.  I can give arguments for each of those, but a decision still has to be reached. Right now I think that the following set of policies would serve well enough:  For production, all database changes must be handled after an explicit user action. Probably by going to a page and entering the credentials of a user that can execute DDL statements on the database.  For development, we will support the same manual approach, but we will also have a policy to auto update the database on entity change. We are still in somewhat muddy water with regards to deploying to production with regards to changes that affects the entire system, to wit, breaking database changes. I am going to discuss that in the next installment, this one got just a tad out of hand, I am afraid.</p>
        </article>
        <article id="article-7113">
            <a href="https://ayende.com/blog/2963/domain-specific-language-losing-the-original-language" target="_blank">
                <h2 class="title mb-6" id="article-7113">Domain Specific Language: Losing the original language</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 24, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Here is an interesting question, at what point you drive away&#xA0;so far from the original language that you lose the benefits of an internal DSL? The following examples are several ways to represent the same thing, going from the extreme DSL to the no DSL to C#. I think that they all have value, and neither cross that line, but I believe that they will help make the point. The example here is a a simple MonoRail Controller: #1:  controller Field:&#xA0;&#xA0;&#xA0; action Tag:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;@defaultTags =&#xA0;[ &quot;green&quot;, &quot;trees&quot;, &quot;growth&quot; ] #2:  controller Field:&#xA0;&#xA0;&#xA0; def Tag():&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; @defaultTags = [ &quot;green&quot;, &quot;trees&quot;, &quot;growth&quot; ] #3:  controller Field:&#xA0;&#xA0;&#xA0; def Tag():&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; PropertyBag[&quot;defaultTags&quot;] = [ &quot;green&quot;, &quot;trees&quot;, &quot;growth&quot; ] #4:  class FieldController(Controller):&#xA0;&#xA0; def Tag():&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; PropertyBag[&quot;defaultTags&quot;] = [ &quot;green&quot;, &quot;trees&quot;, &quot;growth&quot; ] #5: public class FieldController : Controller&#xA;{&#xA;&#x9;public void Tag()&#xA;&#x9;{&#xA;&#x9;&#x9;PropertyBag[&quot;defaultTags&quot;] = new string[] { &quot;green&quot;, &quot;trees&quot;, &quot;growth&quot; };&#xA;&#x9;}&#xA;}&#xA;&#xA;Any comments?</p>
        </article>
        <article id="article-7114">
            <a href="https://ayende.com/blog/2962/a-different-ui-approach" target="_blank">
                <h2 class="title mb-6" id="article-7114">A different UI approach</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 23, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I have been doing some work with MonoRail recently, and I noticed that I am structuring the UI in a completely different way than the way I would using WebForms. When I used WebForms, I at first tried to make significant use of the builtin controls and components, thinking that they would make my work easier. But it turned out that they added complexity instead of removing it. Then I tried to use WebForms in as pure HTML generation capacity as possible. I made very big use of repeaters and such controls, some of which I built myself. When I just started to use MonoRail, I had much the same style, but now I am finding out that I am doing things differently. The more recent solutions relies a lot more about generating JS for data, and then generating the UI using JS. The somewhat primitive approach outlined below represent a spike for a new feature, where we simply wanted to see how we can get it started, but I think that this makes the point fairly obvious. &lt;script type=&quot;text/javascript&quot;&gt;&#xA;&#x9;var orders = [];&#xA;&#x9;var lines = [];&#xA;&lt;% &#xA;&#x9;for order in orders: &#xA;%&gt;&#xA;&#x9;orders.push({&#xA;&#x9;&#x9;&#x9;id: &quot;!{order.Id}&quot;,&#xA;&#x9;&#x9;&#x9;name: &quot;!{order.Name}&quot;,&#xA;&#x9;&#x9;});&#xA;&lt;%&#xA;&#x9;&#x9;for orderLine in order.OrderLines: &#xA;%&gt;&#xA;&#x9;lines.push({&#xA;&#x9;&#x9;id: &quot;!{orderLine.Id}&quot;,&#xA;&#x9;&#x9;orderId: &quot;!{order.Id}&quot;,&#xA;&#x9;&#x9;orderName: &quot;!{order.name}&quot;,&#xA;&#x9;&#x9;cost:&#x9;&quot;!{orderLine.Cost}&quot;,&#xA;&#x9;&#x9;account: &quot;!{account.name}&quot; &#xA;&#x9;});&#xA;&lt;% &#xA;&#x9;end &#xA;end&#xA;%&gt;&#xA;&#xA;Event.observe(window, &#x27;load&#x27;, function(){&#xA;&#x9;for(var i = 0; i&lt; lines.length; i&#x2B;&#x2B;)&#xA;&#x9;{&#xA;&#x9;&#x9;var line = lines[i];&#xA;&#x9;&#x9;var td = $(&#x27;orderlinessTR&#x27;).down(&#x27;td&#x27;);&#xA;&#x9;&#x9;var div = document.createElement(&quot;div&quot;);&#xA;&#x9;&#x9;div.className = &quot;order&quot;;&#xA;&#x9;&#x9;div.tag = line;&#xA;&#x9;&#x9;div.innerHTML = line.orderName;&#xA;&#x9;&#x9;td.appendChild(div);&#xA;&#x9;}&#xA;&#x9;&#xA;&#x9;for(var i = 0;i&lt;orders.length; i&#x2B;&#x2B;)&#xA;&#x9;{&#xA;&#x9;&#x9;$(&#x27;ordersDDL&#x27;).options.add(new Option(orders[i].name, orders[i].id));&#xA;&#x9;}&#xA;&#xA;&#x9;Event.observe($(&#x27;ordersDDL&#x27;), &#x27;change&#x27;, function(){&#xA;&#x9;&#x9;var e = $(&#x27;ordersDDL&#x27;);&#xA;&#x9;&#x9;var id = e.options[e.selectedIndex].value;&#xA;&#x9;&#x9;var divs = $$(&#x27;div.line&#x27;);&#xA;&#x9;&#x9;for(var i = 0; i&lt; divs.length; i&#x2B;&#x2B;)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;if(divs[i].tag.orderId == id)&#xA;&#x9;&#x9;&#x9;&#x9;divs[i].style.background = &quot;red&quot;;&#xA;&#x9;&#x9;}&#xA;&#x9;});&#xA;});&#xA;&#xA;&lt;/script&gt;&#xA;As you can see, we start by generating JS for the data, and then process it somehow. I considered using JSON to serialize my entities directly to JSON strings, but I am absolutely against tying the javascript to my domain model. An explicit translation step is much more welcome in this case, although the one above it is not a very robust one, I will admit.&#xA;In fact, as a direct correlation of this trend, I find myself doing a lot more work that centers around creating javascript controls. Those are rich, incredibly easy to develop, frustrating at times (usually when I am working on explorer) and framework independent. I have completely buy into Prototype/JQuery (I really should post about that) as an underlying framework to work with, but I have yet to start working with the JS control libraries that I hear other peoples raving about. I made some use of scriptacolous, but that is about it.&#xA;Am I doing something strange? Or is it just a common trend that I missed?</p>
        </article>
        <article id="article-7115">
            <a href="https://ardalis.com/learn-vs-2008-and-net-3-5/" target="_blank">
                <h2 class="title mb-6" id="article-7115">Learn VS 2008 and .NET 3.5</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 21, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Guy pointed out a great resource for learning the newly released Visual Studio 2008 for free: the Visual Studio 2008 and .NET Framework 3.&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-7116">
            <a href="https://ardalis.com/visual-studio-team-suite-2008-available/" target="_blank">
                <h2 class="title mb-6" id="article-7116">Visual Studio Team Suite 2008 Available</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 19, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Visual Studio Team Suite 2008 is now available to MSDN Subscribers (a fact which is apparently well known, since the server seems to be&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-7117">
            <a href="https://ayende.com/blog/2961/geek-scripture" target="_blank">
                <h2 class="title mb-6" id="article-7117">Geek Scripture</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 19, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">At first, there was the bit. And the bit shifted left, and the bit shifted right, and there was the byte. The byte grew into a word, and then into double word. And the developer saw the work and it was good. And the evening and the morning were the first day. On the next day, the developer came back to the work and couldn&#x2019;t figure out what he was thinking last night, and spent the whole day figuring that out.</p>
        </article>
        <article id="article-7118">
            <a href="https://ayende.com/blog/2960/a-false-sense-of-security" target="_blank">
                <h2 class="title mb-6" id="article-7118">A false sense of security</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 18, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">After reading my post about enterprise security infrastructure, Comlin asks:  Ayende, What would you say if I give you a real world scenario:1. Server running Microsoft Windows hosts a web site which includes your security features.2. Separate server hosts database. Well, common thing isn&#x27;t it?We are pretty sure that the first server(it&#x27;s on the Internet) would be hacked sooner or later and the hacker will acquire admin privileges. And all we have is your &quot;entity security&quot; inside the BL, who needs it anyway, you will take the connection string and perform all the malicious actions inside the database! I see two ways to handle this situation: developing an app server to process queries or building security infrastructure inside DB using stored procedures or row-level security. What do you think? Let us go through several of those iterations&#xA0;in turn, shall we?  First, I disagree with the implicit assumption that it will essentially be broken, and broken with admin privileges. But even then... Well, getting admin access to the box doesn&#x27;t mean that you get my connection string, by no means.&#xA0;That connection string is DPAPI-ed encrypted and keyed to the user running the application. Even as admin, you have no way to get that out.  Nevertheless, let us assume that a nefarious person did get their hands on a connection string to my database, one that had read and write access. Well, what can it do? Well, doing something like &quot;UPDATE Sales SET TotalSales&#xA0;= TotalSales&#xA0;* 100 WHERE UserId = @myUserId&quot;, and get a hefty commission all of a sudden. But is there really a way to stop it at this point? It seems to me like at that point, anything more it basically pointless, it is closing the doors with the fox in the coop. Let us take into account the idea of using stored procedures, shall we. What extra security measure do we get from that? The user is already in possession of a connection string with privileges to do things in the database. They can now do things like &quot;while @count&#xA0; &lt; 100 exec AddSaleTo @myUserId&quot;. Oh, you solve that by using windows authentication all the way to the database, and validate permissions on the logged on user? Well, to do that, the web server must also be marked as trusted for delegation. Which means that if the &quot;hacked&quot; server tells the DB to think that it is Super Mario, it will believe it. Row level security is bad for the same reasoning as before,&#xA0; but it has an additional twist. Doing security in the database level utterly exclude the option to cache data. That is bad, really bad.  &#xA0; Then you have the idea of an application server in the middle. Now we have a bit more structure, we may even be able to do some business logic testing on the incoming requests, but, and this is the critical part. The application server has no way to know that the web server was hacked. As far as it is concerned, those requests now being made to it are valid ones, and it will try to honor the thousands AddSaleToUserMessage coming its way. Now, you could structure you application in such a way that nothing trusted anything else, but that is not a good way to structure an application. To be rather exact, the cost of untrusting the inner circle is very high. Both in terms of the effort involved and as a result of the design, which would be awkward to work with long term. Now, the diagram here is fairly typical, I would assume, in fact, this is how OS security is built, by having a trusted kernel. The kernel cannot protect itself from itself. That is why rootkits are possible. And, like rootkits demonstrate, it contains a very problematic flaw, you cannot ensure that all the nodes will remain trustworthy. And when one of them turns red, it is endgame. A better approach would be to go with the firewall approach, with the external application explicitly not trusted by the internal one, and all communication be inspected for suspicious activities.  &#xA0;  You can imagine it a little the diagram to the right. This is another typical architecture design. This time we are going with the application server route, with a firewall (or an application firewall) in the middle. That point of yellow is an inspection port, in addition to the usual checks a firewall will make, this inspection port will try to analyze the request with a more domain knowledge. It can then trigger alarms or deny access if it suspect that the external application is behaving strangely. Such things that might trigger it are malformed business requests, too much focus on a single item (such as trying to add sales to a salesperson), etc. Then again, something else that would trigger it might be a data entry clerk that is typing really fast, or a simply sale on the site that means that a lot of people are suddenly buying this one item, etc, etc. Something that I would definitely be interested to have is an audit trail, so I can revert changes if needed, or at least follow their logic. In the end, there really isn&#x27;t a one good way to secure an application, this requires cooperation from developers, IT, networking, etc. If there was, everyone was using it. And while I do believe in defense in depth, I also believe that once the king is taken, the game is over. Starting with the premise that the attacker has gained an admin control over one of your machine is not a start that you want to be in.</p>
        </article>
        <article id="article-7119">
            <a href="https://ayende.com/blog/2959/killer-applications-gmail-vs-outlook-web-access" target="_blank">
                <h2 class="title mb-6" id="article-7119">Killer Applications: Gmail vs. Outlook Web Access</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 18, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">It came up in a conversation today. Gmail &amp; OWA are doing much the same thing, using much the same technologies. Yet it was Gmail who was the Ajax killer application, not OWA. Why?</p>
        </article>
        <article id="article-7120">
            <a href="https://ayende.com/blog/2958/a-vision-of-enterprise-platform-security-infrastructure" target="_blank">
                <h2 class="title mb-6" id="article-7120">A vision of enterprise platform</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 17, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I have been asked how I would design a security infrastructure for my vision of an enterprise platform, and here is an initial draft of the ideas. As anything in this series, no actual code was written down to build them. What I am doing is going through the steps that I would usually go before I actually sit down and implement something.  While most systems goes for the Users &amp; Roles metaphor, I have found that this is rarely a valid approach in real enterprise scenarios. You often want to do more than just the users &amp; roles, such as granting and revoking permissions from individuals, business logic based permissions, etc.  What are the requirements for this kind of an infrastructure?  Performant Human understandable  Flexible Ability to specify permissions using the following scheme:  On a  Group Individual users Based on  Entity Type Specific Entity Entity group Let us give a few scenarios and then go over how we are going to solve them, shall we?  A helpdesk&#xA0;representative can view account data, cannot edit it. The helpdesk representative also cannot view the account&#x27;s projected revenue. Only managers can handle accounts marked as &quot;Special Care&quot; A team leader can handle all the cases handled by members in the team, team members can handle only their own cases. The security infrastructure revolves around this interface:   The IsAllowed purpose should be clear, I believe, but let us talk a bit about the AddPermissionsToQuery part, shall we? Once upon a time, I built a system that had a Security Service, that being a separate system running on a different machine. That meant that in order to find out if the user had permission to perform some action, I had to send the security service the entity type, id and the requested operation. This worked, but it was problematic when we wanted to display the user more than&#xA0;a single entity at a time. Because the system was external, we couldn&#x27;t involve it in the query directly, which meant that we had to send the entire result set to the external service for filtering. Beyond the performance issue, there is another big problem, we had no way to reliability perform paged queries, the service could&#xA0;decide to chop up 50% of the returned results, and we would need to compensate for that somehow. That wasn&#x27;t fun, let me tell you that. So,&#xA0;the next application that I&#xA0;built, I used a different&#xA0;approach. Instead of an external security service, I had an internal one,&#xA0;and I could send all my&#xA0;queries through it. The security service would enhance the query so permissions would be observed, and everything just worked. It was very&#xA0;good to observe. In that case, we had a lot of methods that did it, because we had a custom security infrastructure. In this case, I think we can get away with a single AddPermissionsToQuery method, since the security infrastructure in place is standardize. Now, why do we have a Why method there? Pretty strange method, that one, no? Well, yes, it is. But this is also something that came up through painful experience. In any security system of significant complexity, you would have to ask yourself questions such as: &quot;Why does this user see this information&quot; and &quot;Why can&#x27;t I see this information&quot; ?  I remember once getting a Priority Bug that some users were not seeing information that they should see, and I sat there and looked at it, and couldn&#x27;t figure out how they got to that point. After&#xA0;we gave up understanding on our own, we started debugging it, and we reproduced the &quot;error&quot; on our machines. After stepping through it for ten or twenty times, it suddenly hit me, the system was doing exactly what it was supposed to do. I stepped over the line that did it in each and every one of the times that I debugged it, but I never noticed it.  You really want transparency in such a system, because &quot;Access Denied&quot; is about the second most annoying error to debug, if the system will give you no further information. Now, I am going to show you the table structure, this is not fixed in stone, and don&#x27;t try to read too much into seeing a table model here. It simply make it easier to follow the connections that a class diagram would.   Let us go over some of the concepts that we have here, shall we? Users &amp; Groups should be immediately obvious, let us focus for a moment on the Operations and Permissions. What is an operation? Operation is an action that can happen in the application. Examples of operations are:  Account.View Account.Edit Account.ProjectedRevenue.View Account.ProjectedRevenue.Edit Account.Assign Account.SendEmail As you can see, we have a fairly simple convention here. [Entity].[Action] and [Entity].[Field].[Action], this allows me to specify granular permissions in a very easy to grok fashion. The above mentioned operations are entity-based operations, they operate on a single entity instance at a time. We also have feature-based operations, such as:  Features.HelpDesk Features.CustomerPortal Those operate without an object to verify on, and are a way to turn on/off permissions for an entire section of the application. Since some operations are naturally grouped together, we also have relations between operations, so we will have the &quot;Account&quot; operation, which will include the &quot;Account.Edit&quot;, &quot;Account.View&quot; as children. If you are granted the Account operation on an entity, you automatically get the &quot;Account.Edit&quot; and &quot;Account.View&quot; on the entity as well.  This makes the design somewhat more awkward, because now we need to go through two levels of operations to find the correct one, but it is not a big deal, since we are going to be smart about how we do it. Permissions are the set of allowed / revoked permissions for an operation on an EntitySecurityKey (will be immediately explained) which is associated with Group, User or EntityGroup. A simple example may be something like:  For User &quot;Ayende&quot;, Allow &quot;Account&quot; on the &quot;Account Entity&quot; EntitySecurityKey, Importance 1 For Group &quot;Managers&quot;, Revoke &quot;Case.Edit&quot; on &quot;Case Entity&quot; EntitySecurityKey, Importance 1 For Group &quot;Users&quot;, Revoke &quot;Account.Edit&quot; on &quot;Important Accounts Entity Group&quot; EntitySecurityKey, Importance 1 For Group &quot;Managers&quot;, Allow &quot;Account.Edit&quot; on &quot;Important Accounts Entity Group&quot; EntitySecurityKey, Importance 10 For User &quot;Bob from Northwind&quot;, Revoke &quot;Account&quot; on &quot;Northwind Account&quot;&#xA0; EntitySecurityKey, Importance 1 The algorithm for IsAllowed(account, &quot;Account.Edit&quot;, user) is something like this, get all the operations relevant to the current entity, default to deny access, then check operations. Revoke operation gets a &#x2B;1, so it is more important than an Allow operation in the same level. Or in pseudo code (ie, doesn&#x27;t really handle all the complexity involved): bool isAllowed = false;&#xA;int isAllowedImportance = 0;&#xA;foreach(Operation operation in GetAllOperationsForUser(user, operationName, entity.EntitySecurityKey))&#xA;{&#xA;&#x9;bool importance = operation.Importance;&#xA;&#x9;if(operation.Allow == false)&#xA;&#x9;&#x9;importance &#x2B; 1; &#xA;&#x9;if ( isAllowedimportance &lt;  )&#xA;&#x9;{&#xA;&#x9;&#x9;isAllowed = operation.Allow;&#xA;&#x9;&#x9;isAllowedimportance = operation.Importance;&#xA;&#x9;}&#xA;}&#xA;return isAllowed;&#xA;As you had probably noticed already, we have the notion of an Entity Security Key, what is that?&#xA;Well, when you define an entity you also need to define its default security, this way, you can specify who can view and edit it. Then, we we create an entity, its EntitySecurityKey is copied from the default one. If we want to set special permissions on a specific entity, we will create a copy of all the current permissions on the entity type, and then edit that, under a different EntitySecurityKey, which is related to its parent.&#xA;All the operations in the child EntitySecurityKey are automatically more important then the ones in the parent EntitySecurityKey, regardless of the important score that the parent operations has.&#xA;In addition to all of that, we also have the concept of an EntityGroup to consider. Permissions can be granted and revoked on an Entity Group, and those are applicable to all the entities that are member in this group. This way, business logic that touches permissions doesn&#x27;t need to be scattered all over the place, when a state change affects the permissions on an entity, it is added or removed to an entity group, which has a well known operations defined on it.&#xA;Now that you probably understand the overall idea, let us talk about what problem do we have with this approach.&#xA;Performance&#xA;The security scheme is complex, and of the top of my head, given all the variables, I can&#x27;t really think of a single query that will answer it for me. The solution for that, like in all things, it to not solve the complex problem, but to break it down to easier problems.&#xA;The first thing that we want to consider is what kind of question are we asking the security system. Right now, I am thinking that the IsAllowed method should have the following signatures:&#xA;&#xA;public bool IsAllowed(Operation, User, Entity);public bool IsAllowed(Operation, User);&#xA;This means that the question that we will always ask is &quot;Does &#x27;User&#x27; have &#x27;Operation&#x27; on &#x27;Entity&#x27;?&quot;, and &quot;Does &#x27;User&#x27; have &#x27;Operation&#x27;?&quot;. The last is applicable for feature based operations only, of course.&#xA;So, given that this is the question we have, how can we answer this efficiently? Let us try to take the above mentioned table structure and de-normalize it to make queries more efficient. My first attempt is this:&#xA; &#xA;This allows you to very easily query by the above semantics, and get all the required information in a single go. &#xA;A lot of the rules that I have previously mentioned will already be calculated in advance when we write to this table, so we have a far simpler scenario when we come to check the actual permissions.&#xA;For instance, the EntitySecurityKey that we send is always the one on the Entity, so the DenormalizedPermissions table will always have the permissions from the parent EntitySecurityKey copied with pre calculated values.&#xA;Since everything is based around the EntitySecurityKey, we also have&#xA0;a very simple time when it comes to updating this table.&#xA;All we need to do it rebuilt the permissions for this particular EntitySecurityKey. &#xA;This makes things much easier, all around.&#xA;&#xA0;&#xA;Querying&#xA;What this means, in turn, is that we have the following query to issue when we come to check permissions:&#xA;&#xA;SELECT dp.Allow, dp.Importance FROM DenormalizedPermission dpWHERE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;dp.EntitySecurityKey = :EntitySecurityKeyAND&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; dp.Operation = :OperationAND&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; (dp.User = :User OR dp.Group IN (@UserGroups)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; OR EntityGroup IN (@EntityGroups) )&#xA;All we need to do before the query is to find out all the groups that the user belongs to, directly or indirectly, and all the Entity Groups that the entity belongs to.&#xA;When it comes down to check a feature-base operation, we can issue the same query, sans the EntitySecurityKey, and we are done.&#xA;Another important consideration is the ability to cache this sort of query. Since we will probably make a lot of those, and since we are probably also going to want to have immediate response to changes in security, caching is important, and write-through caching layer can do wonder for making this optimized. &#xA;What is missing&#xA;Just to note: this is not complete, I can think of several scenarios that this has no answer for, from the Owner can do things other cannot&#xA0;to supporting permissions if the organization unit is identical for the entity and the user. However, adding those is fairly easy to build within the system, all we need to do is define an action that would add the owner&#x27;s permissions explicitly to the entity, and remove it when they are changed. The same can be done for entities in an organization unit, you would have the group of users in Organization Unit Foo and the Entity Group of entities in Organization Unit Foo, which will have a permission set for that group.&#xA;Final thoughts&#xA;This turned out to be quite a bit longer than anticipated, waiting expectantly for you, dear reader, to tell me how grossly off I am.&#xA;Next topics:&#xA;&#xA;Hot deployments and distributed deployments&#xA;A database that doesn&#x27;t make you cry&#xA;Supporting upgrades&#xA;Platform I/O - integration with the rest of the enterprise</p>
        </article>
        <div class="button flex justify-between">
            <a href="711.html"><span class="back arrow"></span></a>

            <a href="713.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>