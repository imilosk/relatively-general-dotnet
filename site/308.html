
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 308 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-3071">
            <a href="https://ardalis.com/how-to-change-drawing-scale-in-visio-professional/" target="_blank">
                <h2 class="title mb-6" id="article-3071">How to Change Drawing Scale in Visio Professional</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 14, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is much harder than it should be to find, especially when most of the help online is wrong and refers to previous versions. For&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-3072">
            <a href="https://andrewlock.net/loading-tenants-from-the-database-with-saaskit-in-asp-net-core/" target="_blank">
                <h2 class="title mb-6" id="article-3072">Loading tenants from the database with SaasKit in ASP.NET Core</h2>
            </a>
            <p class="mb-2">by Andrew Lock</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 14, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post I&#x27;ll show how to add multi-tenancy to an ASP.NET Core application using the open source SaasKit, and store tenant mappings in a database.&#x2026;</p>
        </article>
        <article id="article-3073">
            <a href="https://ayende.com/blog/174785/fast-transaction-log-windows" target="_blank">
                <h2 class="title mb-6" id="article-3073">Fast transaction log</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 13, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In my previous post, I have tested journal writing techniques on Linux, in this post, I want to do the same for Windows, and see what the impact of the various options are the system performance.&#xA;Windows has slightly different options than Linux. In particular, in Windows, the various flags and promises and very clear, and it is quite easy to figure out what is it that you are supposed to do.&#xA;We have tested the following scenarios&#xA;&#xA;Doing buffered writes (pretty useless for any journal file, which needs to be reliable, but good baseline metric).&#xA;Doing buffered writes and calling FlushFileBuffers after each transaction (which is pretty common way to handle committing to disk in databases), and the equivalent of calling fsync.&#xA;Using FILE_FLAG_WRITE_THROUGH flag and asking the kernel to make sure that after every write, everything will be flushed to disk. Note that the disk may or may not buffer things.&#xA;Using FILE_FLAG_NO_BUFFERING flag to bypass the kernel&#x2019;s caching and go directly to disk. This has special memory alignment considerations&#xA;Using FILE_FLAG_WRITE_THROUGH | FILE_FLAG_NO_BUFFERING flag to ensure that we don&#x2019;t do any caching, and actually force the disk to do its work. On Windows, this is guaranteed to ask the disk to flush to persisted medium (but the disk can ignore this request).&#xA;&#xA;Here is the code:&#xA;&#xA;&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          #include &quot;stdafx.h&quot;&#xA;        &#xA;        &#xA;          &#xA;          #include &lt;Windows.h&gt;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          #define FILE_SIZE  (1024 * 1024 * 1024L)&#xA;        &#xA;        &#xA;          &#xA;          #define CHUNK_SIZE (16 * 1024)&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          void simulate_journal_writes(HANDLE file, char* desc, int use_fsync)&#xA;        &#xA;        &#xA;          &#xA;          {&#xA;        &#xA;        &#xA;          &#xA;          &#x9;LARGE_INTEGER freq;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;int pos;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;LARGE_INTEGER start, stop;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;byte* buffer;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;HCRYPTPROV hProvider;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;if (file == INVALID_HANDLE_VALUE)&#xA;        &#xA;        &#xA;          &#xA;          &#x9;{&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;printf(&quot;Invalid file %i&quot;, GetLastError());&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;exit(1);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;}&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;buffer = (byte*)VirtualAlloc(NULL, CHUNK_SIZE, MEM_COMMIT, PAGE_READWRITE);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;if (buffer == NULL)&#xA;        &#xA;        &#xA;          &#xA;          &#x9;{&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;printf(&quot;Invalid memory allocation %i&quot;, GetLastError());&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;exit(1);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;}&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;if (!CryptAcquireContext(&amp;hProvider, NULL, NULL, PROV_RSA_FULL, CRYPT_VERIFYCONTEXT | CRYPT_SILENT))&#xA;        &#xA;        &#xA;          &#xA;          &#x9;{&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;printf(&quot;Invalid crypto context %i&quot;, GetLastError());&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;exit(1);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;}&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;if (!CryptGenRandom(hProvider, CHUNK_SIZE, buffer))&#xA;        &#xA;        &#xA;          &#xA;          &#x9;{&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;printf(&quot;Invalid crypto context %i&quot;, GetLastError());&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;exit(1);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;}&#xA;        &#xA;        &#xA;          &#xA;          &#x9;if (!CryptReleaseContext(hProvider, NULL)) &#xA;        &#xA;        &#xA;          &#xA;          &#x9;{&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;printf(&quot;Can&#x27;t release %i&quot;, GetLastError());&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;exit(1);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;}&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;QueryPerformanceFrequency(&amp;freq);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;QueryPerformanceCounter(&amp;start);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;for (pos = 0; pos&lt;FILE_SIZE; pos &#x2B;= CHUNK_SIZE)&#xA;        &#xA;        &#xA;          &#xA;          &#x9;{&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;if (!WriteFile(file, buffer, CHUNK_SIZE, NULL, NULL))&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;{&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;&#x9;printf(&quot;\ncan&#x27;t write %i&quot;, GetLastError());&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;&#x9;exit(2);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;}&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;if (use_fsync)&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;{&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;&#x9;if (!FlushFileBuffers(file))&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;&#x9;{&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;&#x9;&#x9;printf(&quot;\ncan&#x27;t fsync %i&quot;, GetLastError());&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;&#x9;&#x9;exit(2);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;&#x9;}&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;}&#xA;        &#xA;        &#xA;          &#xA;          &#x9;}&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;QueryPerformanceCounter(&amp;stop);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;printf(&quot;\nRunning %s took %f ms\n&quot;, desc,&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;((double)(stop.QuadPart - start.QuadPart)*1000.0 / (double)freq.QuadPart)&#xA;        &#xA;        &#xA;          &#xA;          &#x9;);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          int main()&#xA;        &#xA;        &#xA;          &#xA;          {&#xA;        &#xA;        &#xA;          &#xA;          &#x9;LPCWSTR filename = L&quot;journal.log&quot;;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;HANDLE file;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;DeleteFile(filename);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;file = CreateFile(filename, GENERIC_ALL, FILE_SHARE_READ, NULL, OPEN_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;if (file == INVALID_HANDLE_VALUE)&#xA;        &#xA;        &#xA;          &#xA;          &#x9;{&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;printf(&quot;Error creating file %i&quot;, GetLastError());&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;return 1;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;}&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;if (SetFilePointer(file, 1024 * 1024 * 1024L, NULL, FILE_BEGIN) == INVALID_SET_FILE_POINTER)&#xA;        &#xA;        &#xA;          &#xA;          &#x9;{&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;printf(&quot;Error setting file pointer %i&quot;, GetLastError());&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;return 1;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;}&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;if (!SetEndOfFile(file))&#xA;        &#xA;        &#xA;          &#xA;          &#x9;{&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;printf(&quot;Error setting end of file %i&quot;, GetLastError());&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;return 1;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;}&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;if (!CloseHandle(file))&#xA;        &#xA;        &#xA;          &#xA;          &#x9;{&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;printf(&quot;Error closing %i&quot;, GetLastError());&#xA;        &#xA;        &#xA;          &#xA;          &#x9;&#x9;return 1;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;}&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;printf(&quot;\nStarting\n&quot;);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;file = CreateFile(filename, GENERIC_ALL, FILE_SHARE_READ, NULL, OPEN_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;simulate_journal_writes(file, &quot; buffered &quot;, 0);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;CloseHandle(file);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;file = CreateFile(filename, GENERIC_ALL, FILE_SHARE_READ, NULL, OPEN_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;simulate_journal_writes(file, &quot; buffered &#x2B; fsync&quot;, 1);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;CloseHandle(file);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;file = CreateFile(filename, GENERIC_ALL, FILE_SHARE_READ, NULL, OPEN_ALWAYS, FILE_FLAG_WRITE_THROUGH, NULL);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;simulate_journal_writes(file, &quot; write_through &quot;, 0);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;CloseHandle(file);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;file = CreateFile(filename, GENERIC_ALL, FILE_SHARE_READ, NULL, OPEN_ALWAYS, FILE_FLAG_NO_BUFFERING, NULL);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;simulate_journal_writes(file, &quot; no_buffering &quot;, 0);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;CloseHandle(file);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;file = CreateFile(filename, GENERIC_ALL, FILE_SHARE_READ, NULL, OPEN_ALWAYS, FILE_FLAG_NO_BUFFERING | FILE_FLAG_WRITE_THROUGH, NULL);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;simulate_journal_writes(file, &quot; write_through | no_buffering &quot;, 0);&#xA;        &#xA;        &#xA;          &#xA;          &#x9;CloseHandle(file);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              return 0;&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          journal.c&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;&#xA;&#xA;We have tested this on an AWS macine ( i2.2xlarge &#x2013; 61 GB, 8 cores, 2x 800 GB SSD drive, 1GB /sec EBS), which was running Microsoft Windows Server 2012 R2 RTM 64-bits. The code was compiled for 64 bits with the default release configuration.&#xA;What we are doing is write 1 GB journal file, simulating 16 KB transactions and simulating 65,535 separate commits to disk. That is a lot of work that needs to be done.&#xA;First, again, I run it on the system drive, to compare how it behaves:&#xA;&#xA;&#xA;&#xA;Method&#xA;Time (ms)&#xA;Write cost (ms)&#xA;&#xA;&#xA;Buffered&#xA;&#xA;396&#xA;&#xA;&#xA;0.006&#xA;&#xA;&#xA;&#xA;Buffered &#x2B; FlushFileBuffers&#xA;&#xA;121,403&#xA;&#xA;&#xA;1.8&#xA;&#xA;&#xA;&#xA;FILE_FLAG_WRITE_THROUGH&#xA;&#xA;58,376&#xA;&#xA;&#xA;0.89&#xA;&#xA;&#xA;&#xA;FILE_FLAG_NO_BUFFERING&#xA;&#xA;56,162&#xA;&#xA;&#xA;0.85&#xA;&#xA;&#xA;&#xA;FILE_FLAG_WRITE_THROUGH | FILE_FLAG_NO_BUFFERING&#xA;&#xA;55,432&#xA;&#xA;&#xA;0.84&#xA;&#xA;&#xA;&#xA;&#xA;Remember, this is us running on the system disk, not on the SSD drive. Here are those numbers, which are much more interesting for us.&#xA;&#xA;&#xA;&#xA;Method&#xA;Time (ms)&#xA;Write cost (ms)&#xA;&#xA;&#xA;Buffered&#xA;&#xA;410&#xA;&#xA;&#xA;0.006&#xA;&#xA;&#xA;&#xA;Buffered &#x2B; FlushFileBuffers&#xA;&#xA;21,077&#xA;&#xA;&#xA;0.321&#xA;&#xA;&#xA;&#xA;FILE_FLAG_WRITE_THROUGH&#xA;&#xA;10,029&#xA;&#xA;&#xA;0.153&#xA;&#xA;&#xA;&#xA;FILE_FLAG_NO_BUFFERING&#xA;&#xA;8,491&#xA;&#xA;&#xA;0.129&#xA;&#xA;&#xA;&#xA;FILE_FLAG_WRITE_THROUGH | FILE_FLAG_NO_BUFFERING&#xA;&#xA;8,378&#xA;&#xA;&#xA;0.127&#xA;&#xA;&#xA;&#xA;&#xA;And those numbers are very significant. Unlike the system disk, where we basically get whatever spare cycles we have, in both Linux and Windows, the SSD disk provides really good performance. But even on identical machine, running nearly identical code, there are significant performance differences between them.&#xA;Let me draw it out to you:&#xA;&#xA;&#xA;&#xA;&#xA;Options&#xA;&#xA;&#xA;Windows&#xA;&#xA;&#xA;Linux&#xA;&#xA;&#xA;Difference&#xA;&#xA;&#xA;&#xA;&#xA;Buffered&#xA;&#xA;&#xA;0.006&#xA;&#xA;&#xA;0.03&#xA;&#xA;&#xA;80% Win&#xA;&#xA;&#xA;&#xA;&#xA;Buffered &#x2B; fsync() / FlushFileBuffers()&#xA;&#xA;&#xA;0.32&#xA;&#xA;&#xA;0.35&#xA;&#xA;&#xA;9% Win&#xA;&#xA;&#xA;&#xA;&#xA;O_DSYNC / FILE_FLAG_WRITE_THROUGH&#xA;&#xA;&#xA;0.153&#xA;&#xA;&#xA;0.29&#xA;&#xA;&#xA;48% Win&#xA;&#xA;&#xA;&#xA;&#xA;O_DIRECT / FILE_FLAG_NO_BUFFERING&#xA;&#xA;&#xA;0.129&#xA;&#xA;&#xA;0.14&#xA;&#xA;&#xA;8% Win&#xA;&#xA;&#xA;&#xA;&#xA;O_DIRECT | O_DSYNC / FILE_FLAG_WRITE_THROUGH | FILE_FLAG_NO_BUFFERING&#xA;&#xA;&#xA;0.127&#xA;&#xA;&#xA;0.31&#xA;&#xA;&#xA;60% Win&#xA;&#xA;&#xA;&#xA;&#xA;In pretty much all cases Windows has been able to out perform Linux on this specific scenario. In many cases by a significant margin. In particular, in the scenario that I actually really care about, we see 60% performance advantage to Windows.&#xA;One of the reasons for this blog post and the detailed code and scenario is the external verification of these numbers. I&#x2019;ll love to know that I missed something that would make Linux speed comparable to Windows, because right now this is pretty miserable.&#xA;I do have a hunch about those numbers, though. SQL Server is a major business for Microsoft, so they have a lot of pull in the company. And SQL Server uses FILE_FLAG_WRITE_THROUGH | FILE_FLAG_NO_BUFFERING internally to handle the transaction log it uses. Like quite a bit of other Win32 APIs (WriteGather, for example), it looks tailor made for database journaling. I&#x2019;m guessing that this code path has been gone over multiple times over the years, trying to optimize SQL Server by smoothing anything in the way.&#xA;As a result, if you know what you are doing, you can get some really impressive numbers on Windows in this scenario. Oh, and just to quite the nitpickers:</p>
        </article>
        <article id="article-3074">
            <a href="https://ayende.com/blog/174753/fast-transaction-log-linux" target="_blank">
                <h2 class="title mb-6" id="article-3074">Fast transaction log</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 12, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We were doing some perf testing recently, and we got some odd results when running a particular benchmark on Linux. So we decided to check this on a much deeper level. We got an AWS macine ( i2.2xlarge &#x2013; 61 GB, 8 cores, 2x 800 GB SSD drive, running Ubuntu 14.04, using kernel version 3.13.0-74-generic, 1GB/sec EBS drives ) and run the following code and run it. This tests the following scenarios on a 1GB file (pre allocated) and &#x201C;committing&#x201D; 65,536 (64K) transactions with 16KB of data in each. The idea is that we are testing how fast we can create write those transactions to the journal file, so we can consider them committed. We have tested the following scenarios  Doing buffered writes (pretty useless for any journal file, which needs to be reliable, but good baseline metric).  Doing buffered writes and calling fsync after each transaction (which is pretty common way to handle committing to disk in databases)  Doing buffered writes and calling fdatasync (which is supposed to be slightly more efficient than calling fsync in this scenario).  Using O_DSYNC flag and asking the kernel to make sure that after every write, everything will be synced to disk.  Using O_DIRECT flag to bypass the kernel&#x2019;s caching and go directly to disk.  Using O_DIRECT | O_DSYNC flag to ensure that we don&#x2019;t do any caching, and actually force the disk to do its work.  The code is written in C, and it is written to be pretty verbose and ugly. I apologize for how it looks, but the idea was to get some useful data out of this, not to generate beautiful code. It is only quite probable that I made some mistake in writing the code, which is partly why I&#x2019;m talking about this. Here is the code, and the results of execution are below: &#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          #define _GNU_SOURCE&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          #include &lt;time.h&gt;&#xA;        &#xA;        &#xA;          &#xA;          #include &lt;stdio.h&gt;&#xA;        &#xA;        &#xA;          &#xA;          #include &lt;stdlib.h&gt;&#xA;        &#xA;        &#xA;          &#xA;          #include &lt;fcntl.h&gt;&#xA;        &#xA;        &#xA;          &#xA;          #include &lt;malloc.h&gt;&#xA;        &#xA;        &#xA;          &#xA;          #include &lt;sys/uio.h&gt;&#xA;        &#xA;        &#xA;          &#xA;          #include &lt;sys/file.h&gt;&#xA;        &#xA;        &#xA;          &#xA;          #include &lt;unistd.h&gt;&#xA;        &#xA;        &#xA;          &#xA;          #include &lt;errno.h&gt;&#xA;        &#xA;        &#xA;          &#xA;          #include &lt;string.h&gt;&#xA;        &#xA;        &#xA;          &#xA;          #include &lt;sys/time.h&gt;&#xA;        &#xA;        &#xA;          &#xA;          #include &lt;sys/types.h&gt;&#xA;        &#xA;        &#xA;          &#xA;          #include &lt;sys/stat.h&gt;&#xA;        &#xA;        &#xA;          &#xA;          #include &lt;sys/resource.h&gt;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          #define FILE_SIZE  (1024 * 1024 * 1024L)&#xA;        &#xA;        &#xA;          &#xA;          #define CHUNK_SIZE (16 * 1024)&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          int simulate_journal_writes(int fd, char* desc, int use_fsync, int use_fdatasync)&#xA;        &#xA;        &#xA;          &#xA;          {&#xA;        &#xA;        &#xA;          &#xA;                  int rc;&#xA;        &#xA;        &#xA;          &#xA;                  int pos;&#xA;        &#xA;        &#xA;          &#xA;                  struct timeval start, end;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;long mtime, seconds, useconds;    &#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;void* buff = memalign(CHUNK_SIZE, CHUNK_SIZE);&#xA;        &#xA;        &#xA;          &#xA;                  int rand_fd = open(&quot;/dev/urandom&quot;, O_RDONLY);&#xA;        &#xA;        &#xA;          &#xA;                  if(rand_fd == -1)&#xA;        &#xA;        &#xA;          &#xA;                  {&#xA;        &#xA;        &#xA;          &#xA;                          printf(&quot;\nFailed to open random %i&quot;, errno);&#xA;        &#xA;        &#xA;          &#xA;                          exit(2);&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;                  rc = read(rand_fd, buff, CHUNK_SIZE);&#xA;        &#xA;        &#xA;          &#xA;                  if(rc != CHUNK_SIZE)&#xA;        &#xA;        &#xA;          &#xA;                  {&#xA;        &#xA;        &#xA;          &#xA;                          printf(&quot;\nFailed to read random %i&quot;, errno);&#xA;        &#xA;        &#xA;          &#xA;                          exit(2);  &#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;                  close(rand_fd);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  &#xA;        &#xA;        &#xA;          &#xA;          &#x9;gettimeofday(&amp;start, NULL);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;for (pos=0; pos&lt;FILE_SIZE; pos&#x2B;=CHUNK_SIZE)&#xA;        &#xA;        &#xA;          &#xA;                  {&#xA;        &#xA;        &#xA;          &#xA;                          int write_rc = write(fd, buff, CHUNK_SIZE);&#xA;        &#xA;        &#xA;          &#xA;                          if ( write_rc == -1 )&#xA;        &#xA;        &#xA;          &#xA;                          {&#xA;        &#xA;        &#xA;          &#xA;                                  printf(&quot;\ncan&#x27;t write %i&quot;, errno);&#xA;        &#xA;        &#xA;          &#xA;                                  exit(2);&#xA;        &#xA;        &#xA;          &#xA;                          }&#xA;        &#xA;        &#xA;          &#xA;                          if(use_fsync)&#xA;        &#xA;        &#xA;          &#xA;                          {&#xA;        &#xA;        &#xA;          &#xA;                                  write_rc = fsync(fd);&#xA;        &#xA;        &#xA;          &#xA;                                  if ( write_rc == -1 )&#xA;        &#xA;        &#xA;          &#xA;                                  {&#xA;        &#xA;        &#xA;          &#xA;                                          printf(&quot;\ncan&#x27;t fsync %i&quot;, errno);&#xA;        &#xA;        &#xA;          &#xA;                                          exit(2);&#xA;        &#xA;        &#xA;          &#xA;                                  }&#xA;        &#xA;        &#xA;          &#xA;                          }&#xA;        &#xA;        &#xA;          &#xA;                          if(use_fdatasync)&#xA;        &#xA;        &#xA;          &#xA;                          {&#xA;        &#xA;        &#xA;          &#xA;                                  write_rc = fdatasync(fd);&#xA;        &#xA;        &#xA;          &#xA;                                  if ( write_rc == -1 )&#xA;        &#xA;        &#xA;          &#xA;                                  {&#xA;        &#xA;        &#xA;          &#xA;                                          printf(&quot;\ncan&#x27;t fdatasync %i&quot;, errno);&#xA;        &#xA;        &#xA;          &#xA;                                          exit(2);&#xA;        &#xA;        &#xA;          &#xA;                                  }&#xA;        &#xA;        &#xA;          &#xA;                          }&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;gettimeofday(&amp;end, NULL);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              &#x9;seconds  = end.tv_sec  - start.tv_sec;&#xA;        &#xA;        &#xA;          &#xA;              &#x9;useconds = end.tv_usec - start.tv_usec;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              &#x9;mtime = ((seconds) * 1000 &#x2B; useconds/1000.0) &#x2B; 0.5;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              &#x9;printf(&quot;Elapsed time %s: %ld milliseconds\n&quot;, desc, mtime);&#xA;        &#xA;        &#xA;          &#xA;                 &#xA;        &#xA;        &#xA;          &#xA;                  free(buff);&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          int main()&#xA;        &#xA;        &#xA;          &#xA;          {&#xA;        &#xA;        &#xA;          &#xA;                  int fd;&#xA;        &#xA;        &#xA;          &#xA;                  int rc;&#xA;        &#xA;        &#xA;          &#xA;                  char* filename = &quot;journal.log&quot;;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  unlink(filename);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  fd = open(filename,O_WRONLY | O_CREAT,S_IWUSR | S_IRUSR);&#xA;        &#xA;        &#xA;          &#xA;                  if(fd == -1)&#xA;        &#xA;        &#xA;          &#xA;                  {&#xA;        &#xA;        &#xA;          &#xA;                          printf(&quot;Failed to open file %i&quot;, errno);&#xA;        &#xA;        &#xA;          &#xA;                          return 1;&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  rc = fallocate(fd, 0, 0, FILE_SIZE);&#xA;        &#xA;        &#xA;          &#xA;                  if(rc == -1)&#xA;        &#xA;        &#xA;          &#xA;                  {&#xA;        &#xA;        &#xA;          &#xA;                          printf(&quot;Failed to size file %i&quot;, errno);&#xA;        &#xA;        &#xA;          &#xA;                          return 1;  &#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;                  rc = close(fd);&#xA;        &#xA;        &#xA;          &#xA;                  if(rc == -1)&#xA;        &#xA;        &#xA;          &#xA;                  {&#xA;        &#xA;        &#xA;          &#xA;                          printf(&quot;\nFailed to close file %i&quot;, errno);&#xA;        &#xA;        &#xA;          &#xA;                          return 1;   &#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  printf(&quot;\nStarting\n&quot;);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#x9;fd = open(filename,O_WRONLY | O_CREAT , S_IWUSR | S_IRUSR);&#xA;        &#xA;        &#xA;          &#xA;                  simulate_journal_writes(fd, &quot; buffered &quot;, 0, 0 );&#xA;        &#xA;        &#xA;          &#xA;                  close(fd);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  fd = open(filename,O_WRONLY | O_CREAT , S_IWUSR | S_IRUSR);&#xA;        &#xA;        &#xA;          &#xA;                  simulate_journal_writes(fd, &quot; buffered &#x2B; fdatasync &quot;, 0, 1);&#xA;        &#xA;        &#xA;          &#xA;                  close(fd);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  fd = open(filename,O_WRONLY | O_CREAT , S_IWUSR | S_IRUSR);&#xA;        &#xA;        &#xA;          &#xA;                  simulate_journal_writes(fd, &quot; buffered &#x2B; fsync &quot;, 1, 0);&#xA;        &#xA;        &#xA;          &#xA;                  close(fd);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  fd = open(filename,O_WRONLY | O_CREAT | O_DSYNC, S_IWUSR | S_IRUSR);&#xA;        &#xA;        &#xA;          &#xA;                  simulate_journal_writes(fd, &quot; O_DSYNC &quot;,0,0);&#xA;        &#xA;        &#xA;          &#xA;                  close(fd);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  fd = open(filename,O_WRONLY | O_CREAT | O_DIRECT, S_IWUSR | S_IRUSR);&#xA;        &#xA;        &#xA;          &#xA;                  simulate_journal_writes(fd, &quot; O_DIRECT &quot;, 0, 0);&#xA;        &#xA;        &#xA;          &#xA;                  close(fd);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  fd = open(filename,O_WRONLY | O_CREAT | O_DIRECT | O_DSYNC, S_IWUSR | S_IRUSR);&#xA;        &#xA;        &#xA;          &#xA;                  simulate_journal_writes(fd, &quot; O_DIRECT | O_DSYNC &quot;, 0, 0);&#xA;        &#xA;        &#xA;          &#xA;                  close(fd);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  return 0;&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          journal.c&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA; It was compiled using: gcc journal.c &#x2013;o3 &#x2013;o run &amp;&amp; ./run The results are quite interesting:    Method Time (ms) Write cost (ms)  Buffered  525  0.03  Buffered &#x2B; fsync  72,116  1.10  Buffered &#x2B; fdatasync  56,227  0.85  O_DSYNC  48,668  0.74  O_DIRECT  47,065  0.71  O_DIRECT | O_DSYNC  47,877  0.73 The results are quite interesting. The buffered call, which is useless for a journal, but important as something to compare to. The rest of the options will ensure that the data reside on disk* after the call to write, and are suitable to actually get safety from the journal. * The caveat here is the use of O_DIRECT, the docs (and Linus) seems to be pretty much against it, and there are few details on how this works with regards to instructing the disk to actually bypass all buffers. O_DIRECT | O_DSYNC seems to be the recommended option, but that probably deserve more investigation. Of course, I had this big long discussion on the numbers planned. And then I discovered that I was actually running this on the boot disk, and not one of the SSD drives. That was a face palm of epic proportions that I was only saved from by the problematic numbers that I was seeing. Once I realized what was going on and fixed that, we got very different numbers.    Method Time (ms) Write cost (ms)  Buffered  522  0.03  Buffered &#x2B; fsync  23,094  0.35  Buffered &#x2B; fdatasync  23,022  0.35  O_DSYNC  19,555  0.29  O_DIRECT  9,371  0.14  O_DIRECT | O_DSYNC  20,595  0.31 There is about 10% difference between fsync and fdatasync when using the HDD, but there is barely any difference as far as the SSD is concerned. This is because the SSD can do random updates (such as updating both the data and the metadata) much faster, since it doesn&#x2019;t need to move the spindle. Of more interest to us is that D_SYNC is significantly faster in both SSD and HHD. About 15% can be saved by using it. But I&#x2019;m just drolling over O_DIRECT write profile performance on SSD. That is so good, unfortunately, it isn&#x2019;t safe to do. We need both it and O_DSYNC to make sure that we only get confirmation on the write when it hits the physical disk, instead of the drive&#x2019;s cache (that is why it is actually faster, we are writing directly to the disk&#x2019;s cache, basically). The tests were run using ext4. I played with some options (noatime, noadirtime, etc), but there wasn&#x2019;t any big difference between them that I could see. In my next post, I&#x2019;ll test the same on Windows.</p>
        </article>
        <article id="article-3075">
            <a href="https://ardalis.com/flexible-deployments-using-teamcity/" target="_blank">
                <h2 class="title mb-6" id="article-3075">Flexible Deployments Using TeamCity</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 12, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x2019;m a big fan of JetBrains TeamCity for continuous integration (CI). It has a great web-based user interface, is extremely easy to set up&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-3076">
            <a href="https://ardalis.com/check-in-often/" target="_blank">
                <h2 class="title mb-6" id="article-3076">Check In Often</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 12, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is post 1 of 2 in the series &#x201C;Developer Tips&#x201D; Tips for developers, archived from Dev Tips Weekly emails. Check in your code. Often. It&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-3077">
            <a href="https://andrewlock.net/adding-ef-core-to-a-project-on-os-x/" target="_blank">
                <h2 class="title mb-6" id="article-3077">Adding EF Core and PostgreSQL to an ASP.NET Core project on OS X</h2>
            </a>
            <p class="mb-2">by Andrew Lock</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 12, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post I describe how to add PostgreSQL and EF Core to your app, how to build a model, and run migrations to create your database.&#x2026;</p>
        </article>
        <article id="article-3078">
            <a href="https://ayende.com/blog/174594/the-guts-n-glory-of-database-internals-the-communication-protocol" target="_blank">
                <h2 class="title mb-6" id="article-3078">The Guts n&#x2019; Glory of Database Internals: The communication protocol</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 11, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">With all the focus on writing to disk and ensuring the high speed of the database, I almost missed a very important aspect of databases, how do we actually communicate with the outside world.&#xA;In many cases, there is no need for that. Many databases just run either embedded only (LevelDB, LMDB, etc) or just assume that this is someone else&#x2019;s problem, pretty much. But as it turn out, if you aren&#x2019;t an embedded database, there is quite a bit that you need to get right when you are working on the network code. For the rest of this post, I&#x2019;m going to assume that we are talking about a database that clients connect to through the network. It can be either locally (shared memory / pipes / UNIX sockets / TCP) or remotely (pretty much only TCP at this point).&#xA;The actual protocol format don&#x2019;t really matter. I&#x2019;m going to assume that there is some sort of a streaming connection (think TCP socket) and leave it at that. But the details of how the database communicate are quite important.&#xA;In particular, what kind of communication do we have between client and server. Is each request independent of one another, are there conversations, what kind of guarantees do we give for the lifetime of the connection, etc?&#xA;Relational databases use a session protocol, in which the client will have a conversation with the server, composed of multiple separate request / replies. Sometimes you can tell the server &#x201C;just process the requests as fast as you can, and send the replies as well, but don&#x2019;t stop for sending replies&#x201D;, which helps, but this is probably the worst possible way to handle this. The problem is that you need a connection per client, and those conversation can be pretty long, so you hold up to the connection for a fairly long duration, which means that you have to wait for the next part of the conversation to know what to do next.&#xA;A better approach is to dictate that all operations are strictly one way, so once the server has finished processing a request, it can send the reply to the client and move on to process the next request (from the same client or the other one) immediately. In this case, we have several options, we can pipeline multiple requests on the same channel (allowing out of order replies for requests / replies), we can use the serial nature of TCP connections and have a pool of connections that we can share among clients.&#xA;An even better method is if you can combine multiple requests from the server to a single reply from the server. This can be useful if you know that the shape of all the commands are going to be same (for example, if you are asked in insert a million records, you can process them as soon as possible, and only confirm that you accepted every ten thousands or so). It may sound silly, but those kind of things really add up, because the client can just pour the data in and the server will process it as soon as it can.&#xA;Other considerations that you have to take into account in the communication protocol is security and authentication. If you are allowing remote clients, then they need some way to authenticate. And that can be expensive (typically authentication required multiple round trips between server &amp; client to verify the credentials, and potentially and out of server check in something like LDAP directory), so you want to authenticate once and then keep on to the same connection for as long as you can.&#xA;A more problematic issues comes when talking about the content of your conversation with the database, you typically don&#x2019;t want to send everything over plain text, so you need to encrypt the channel, which has its own costs. For fun, this means dealing with things like certificates, SSL and pretty complex stuff that very few properly understand. If you can get away with letting something else do that for you, see if you can. Setting up a secured connection that cannot be easily bypassed (man in the middle, fake certs, just weak encryption, etc) is none trivial, and should be left for experts in their field.&#xA;Personally, I like to just go with HTTPS for pretty much all of that, because it take a lot of the complexity away, and it means that all the right choices has probably already been made for me. HTTPS, of course, is a request/reply, but things like connection pooling, keep-alive and pipelining can do quite a lot to mitigate that in the protocol level. And something like Web Sockets allows to have most of the benefits of TCP connections, with a lot of the complexity handled for you.</p>
        </article>
        <article id="article-3079">
            <a href="https://ayende.com/blog/174593/the-guts-n-glory-of-database-internals-the-enemy-of-thy-database-is" target="_blank">
                <h2 class="title mb-6" id="article-3079">The Guts n&#x2019; Glory of Database Internals: The enemy of thy database is&#x2026;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 08, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">You might have noticed a theme here in the past few posts. In order to achieve a good performance and ensure the stability of the system, most database engines has a pretty good relationship with the low level hardware and operating system internals.&#xA;You pretty much have to do that, because you want to be able to squeeze every last bit of performance of the system. And it works, quite well, until people start lying to you. And by people, I mean all sort of stuff.&#xA;The most obvious one is the hardware. If I&#x2019;m asking the hardware &#x201C;please make sure that this is on persisted medium&#x201D;, and the hardware tell me &#x201C;sure&#x201D;, but does not such thing. There is very little that the database engine can do. There are quite a lot of drives there that flat out lie about this. Typically enterprise grade drives will not do that unless you have them configured to survive power loss (maybe they have a battery backup?), but I have seen some production systems that were hard to deal with because of that.&#xA;Another common case is when administrators put the database on a remote server. This can be because they have a shared storage setup, or are used to putting all their eggs in one basket, or maybe they already have backup scripts running in that location. Whatever the actual reason, it means that every I/O operation we do (already quite expensive) is now turned into a network call (which still need to do I/O on the other side), so that mess up completely the cost benefit analysis the database does on when to actually call the hardware.&#xA;Sometimes you have an attached storage directly to the server, with high end connection that provides awesome I/O and allow you to stripe among multiple drives easily. Sometimes, that is the shared storage for the entire company, and you have to compete for I/O with everything else.&#xA;But by far the most nefarious enemy we have seen is Anti Virus of various kinds. This problem is mostly on Windows, where admins will deploy an Anti Virus almost automatically, and set it to the most intrusive levels possible, but I have seen similar cases on Linux with various kernel extensions that interfere with how the system works. In particular, timing and contracts are sometimes (often) are broken by such products, and because it is done in an extremely low level manner, the database engine typically has no idea that this happened, or how to recover. For fun, trying to figure out if an Anti Virus is installed (so you can warn the admin to set it up correctly) is one of the behaviors that most Anti Virus will look for and flag you as a virus.&#xA;Now, we have run into this with Anti Virus a lot, but the same applies for quite a lot of things. Allowing an indexing service to scan the database files, or putting them on something like Dropbox folder or pretty much anything that interfere with how the data gets persisted to disk will cause issues. And when that happens, it can be really tricky to figure out who is at fault.&#xA;Finally, and very common today, we have the cloud. The I/O rates in the cloud are typically metered, and in some clouds you get I/O rates that you would from a bad hard disk 10 years ago. What is worst, because the cloud environment is often shared, it means that you are very vulnerable to noisy neighbors. And that means that two identical I/O requests will complete, the first in 25ms, and the second in 5,000 ms (not a mistake, that is 5 seconds!).&#xA0; Same file, same system, same size of request, same everything, spaced two seconds apart, and you hit something, and your entire performance work goes down the drain. You can get reserved IOPS, which helps, but you need to check what you are getting. On some clouds you get concurrent IOPS, which is nice, but the cost of serial IOPS (critical for things like journals) remains roughly the same. This is especially true if you need to make unbuffered I/O, or use fsync() on those systems.&#xA;We have actually had to add features to the product to measure I/O rates independently, so we can put the blame where it belongs (your drives gives me 6 MB/sec on our standard load, this is the maximum performance I can give under this situation).</p>
        </article>
        <article id="article-3080">
            <a href="https://ardalis.com/static-code-analysis-and-quality-metrics/" target="_blank">
                <h2 class="title mb-6" id="article-3080">Static Code Analysis and Quality Metrics</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 08, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is post 1 of 1 in the series &#x201C;Measuring and Managing Software Quality&#x201D; Resources for measuring and assessing software quality&#x2026;Keep Reading &#x2192;</p>
        </article>
        <div class="button flex justify-between">
            <a href="307.html"><span class="back arrow"></span></a>

            <a href="309.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>