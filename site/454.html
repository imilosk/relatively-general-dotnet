
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 454 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-4531">
            <a href="https://ayende.com/blog/153665/searching-aint-simple" target="_blank">
                <h2 class="title mb-6" id="article-4531">Searching ain&#x2019;t simple</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 22, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The problem statement is best described using:  This seems like a nice and easy problem, right? We join the architects table to the designs table and we are done. select d.* from Designs d &#xA; join ArchitectsDesigns da on d.Id = da.DesignId&#xA; join Architects a on da.ArchitectId = a.Id&#xA;where a.Name = @name&#xA;&#xA;&#xA;This is a trivial solution, and shouldn&#x2019;t take a lot of time to build&#x2026; &#xA;It is also the entirely wrong approach for the problem, can you tell me why?</p>
        </article>
        <article id="article-4532">
            <a href="https://ayende.com/blog/155361/ravendb-sharding-map-reduce-in-a-cluster" target="_blank">
                <h2 class="title mb-6" id="article-4532">RavenDB Sharding&#x2013;Map/Reduce in a cluster</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 21, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In my previous post, I introduced RavenDB Sharding and discussed how we can use sharding in RavenDB. We discussed both blind sharding and data driven sharding. Today I want to introduce another aspect of RavenDB Sharding. The usage of Map/Reduce to&#xA0; gather information from multiple shards. We start by defining a map/reduce index. In this case, we want to look at the invoice totals per date. We define the index like this: public class InvoicesAmountByDate : AbstractIndexCreationTask&lt;Invoice, InvoicesAmountByDate.ReduceResult&gt;&#xA;{&#xA;    public class ReduceResult&#xA;    {&#xA;        public decimal Amount { get; set; }&#xA;        public DateTime IssuedAt { get; set; }&#xA;    }&#xA;&#xA;    public InvoicesAmountByDate()&#xA;    {&#xA;        Map = invoices =&gt;&#xA;              from invoice in invoices&#xA;              select new&#xA;              {&#xA;                  invoice.Amount,&#xA;                invoice.IssuedAt&#xA;              };&#xA;&#xA;        Reduce = results =&gt;&#xA;                 from result in results&#xA;                 group result by result.IssuedAt&#xA;                 into g&#xA;                 select new&#xA;                 {&#xA;                     Amount = g.Sum(x =&gt; x.Amount),&#xA;                    IssuedAt = g.Key&#xA;                 };&#xA;    }&#xA;}&#xA;&#xA;&#xA;And then we execute the following code:&#xA;using (var session = documentStore.OpenSession())&#xA;{&#xA;    var asian = new Company { Name = &quot;Company 1&quot;, Region = &quot;Asia&quot; };&#xA;    session.Store(asian);&#xA;    var middleEastern = new Company { Name = &quot;Company 2&quot;, Region = &quot;Middle-East&quot; };&#xA;    session.Store(middleEastern);&#xA;    var american = new Company { Name = &quot;Company 3&quot;, Region = &quot;America&quot; };&#xA;    session.Store(american);&#xA;&#xA;    session.Store(new Invoice { CompanyId = american.Id, Amount = 3, IssuedAt = DateTime.Today.AddDays(-1)});&#xA;    session.Store(new Invoice { CompanyId = asian.Id, Amount = 5, IssuedAt = DateTime.Today.AddDays(-1) });&#xA;    session.Store(new Invoice { CompanyId = middleEastern.Id, Amount = 12, IssuedAt = DateTime.Today });&#xA;    session.SaveChanges();&#xA;}&#xA;&#xA;&#xA;We use a three way sharding, based on the region of the company, so we actually have the following document sin three different servers:&#xA;First server, Asia:&#xA;&#xA;&#xA;Second server, Middle East:&#xA;&#xA;&#xA;Third server, America:&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;Now, let us see what happen when we use the map/reduce query:&#xA;using (var session = documentStore.OpenSession())&#xA;{&#xA;    var reduceResults = session.Query&lt;InvoicesAmountByDate.ReduceResult, InvoicesAmountByDate&gt;()&#xA;        .ToList();&#xA;&#xA;    foreach (var reduceResult in reduceResults)&#xA;    {&#xA;        string dateStr = reduceResult.IssuedAt.ToString(&quot;MMM dd, yyyy&quot;, CultureInfo.InvariantCulture);&#xA;        Console.WriteLine(&quot;{0}: {1}&quot;, dateStr, reduceResult.Amount);&#xA;    }&#xA;    Console.WriteLine();&#xA;}&#xA;&#xA;&#xA;&#xA;As you can see, again, we make no distinction in our code about using sharding, we just query it normally. The results, however, are quite interesting:&#xA;&#xA;&#xA;As you can see, we got the correct results, cluster wide.&#xA;RavenDB was able to query all the servers in the cluster for their results, reduce them again, and get us the total across all three servers.&#xA;And that, my friends, it truly awesome.</p>
        </article>
        <article id="article-4533">
            <a href="https://ayende.com/blog/155329/ravendb-sharding-data-driven-sharding" target="_blank">
                <h2 class="title mb-6" id="article-4533">RavenDB Sharding&#x2013;Data Driven Sharding</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 20, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In my previous post, I introduced RavenDB Sharding and discussed how we can use Blind Sharding to a good effect. I also mentioned that this approach is somewhat lacking, because we don&#x2019;t have enough information at hand to be able to really understand what is going on. Let me show you how we can define a proper sharding function that shards your documents based on their actual data.&#xA;&#xA;&#x9;We are still going to run the exact same code as we have done before:&#xA;&#xA;&#x9;string asianId, middleEasternId, americanId;&#xA;&#xA;using (var session = documentStore.OpenSession())&#xA;{&#xA;    var asian = new Company { Name = &quot;Company 1&quot;, Region = &quot;Asia&quot; };&#xA;    session.Store(asian);&#xA;    var middleEastern = new Company { Name = &quot;Company 2&quot;, Region = &quot;Middle-East&quot; };&#xA;    session.Store(middleEastern);&#xA;    var american = new Company { Name = &quot;Company 3&quot;, Region = &quot;America&quot; };&#xA;    session.Store(american);&#xA;&#xA;    asianId = asian.Id;&#xA;    americanId = american.Id;&#xA;    middleEasternId = middleEastern.Id;&#xA;&#xA;    session.Store(new Invoice { CompanyId = american.Id, Amount = 3 });&#xA;    session.Store(new Invoice { CompanyId = asian.Id, Amount = 5 });&#xA;    session.Store(new Invoice { CompanyId = middleEastern.Id, Amount = 12 });&#xA;    session.SaveChanges();&#xA;&#xA;}&#xA;&#xA;using (var session = documentStore.OpenSession())&#xA;{&#xA;    session.Query&lt;Company&gt;()&#xA;        .Where(x =&gt; x.Region == &quot;America&quot;)&#xA;        .ToList();&#xA;&#xA;    session.Load&lt;Company&gt;(middleEasternId);&#xA;&#xA;    session.Query&lt;Invoice&gt;()&#xA;        .Where(x =&gt; x.CompanyId == asianId)&#xA;        .ToList();&#xA;}&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;What is different now is how we initialize the document store:&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;What we have done is given RavenDB the information about how our entities are structured and how we should shard them. We should shard the companies based on their regions, and the invoices based on their company id.&#xA;&#xA;&#x9;Let us see how the code behaves now, shall we? As before, we will analyze the output of the HTTP logs from execute this code. Here is the first server output:&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;As before, we can see the first four request are there to handle the hilo generation, and they are only there for the first server.&#xA;&#xA;&#x9;The 5th request is saving two documents. Note that this is the Asia server, and unlike the previous example, we don&#x2019;t get companies/1 and invoices/1 in the first shard.&#xA;&#xA;&#x9;Instead, we have companies/1 and invoice/2. Why is that? Well, RavenDB detected that invoices/2 belongs to a company that is associated with this shard, so it placed it in the same shard. This ensures that we have good locality and that we can utilize features such as Includes or Live Projections even when using sharding.&#xA;&#xA;&#x9;Another interesting aspect is that we don&#x2019;t see a request for companies in the America region. Because this is what we shard on, RavenDB was able to figure out that there is no way that we will have a company in the America region in the Asisa shard, so we can skip this call.&#xA;&#xA;&#x9;Conversely, when we need to find an invoice for an asian company, we can see that this request gets routed to the proper shard.&#xA;&#xA;&#x9;Exciting, isn&#x2019;t it?&#xA;&#xA;&#x9;Let us see what we have in the other two shards.&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;In the second shard, we can see that we have just two requests, one to save two documents (again, a company and its associated invoice) and the second to load a particular company by id.&#xA;&#xA;&#x9;We were able to optimize all the other queries away, because we actually understand the data that you save.&#xA;&#xA;&#x9;And here is the final shard results:&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;Again, we got a save for the two documents, and then we can see that we routed the appropriate query to this shard, because this is the only place that can answer this question.&#xA;&#xA;&#x9;Data Driven Sharding For The Win!&#xA;&#xA;&#x9;But so far we have seen how RavenDB can optimize the queries made to the shards when it has enough information to do so. But what happens when it can&#x2019;t?&#xA;&#xA;&#x9;For example, let us say that I want to get the 2 highest value invoices. Since I didn&#x2019;t specify a region, what would RavenDB do? Let us look at the code:&#xA;&#xA;&#x9;var topInvoices = session.Query&lt;Invoice&gt;()&#xA;    .OrderByDescending(x =&gt; x.Amount)&#xA;    .Take(2)&#xA;    .ToList();&#xA;&#xA;foreach (var invoice in topInvoices)&#xA;{&#xA;    Console.WriteLine(&quot;{0}\t{1}&quot;, invoice.Amount, invoice.CompanyId);&#xA;}&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;This code outputs:&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;So we were actually able to get just the two highest invoices. But what actually happened?&#xA;&#xA;&#x9;Shard 1 (Asia):&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;Shard 2 (Middle-East):&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;Shard 3 (America):&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;As you can see, we have actually made 3 queries, asking the same question from each of the shards. Each shard returned its own results. On the client side, we merged those results, and gave you back exactly the information that requested, across the entire cluster.</p>
        </article>
        <article id="article-4534">
            <a href="https://ayende.com/blog/155297/ravendb-sharding-blind-sharding" target="_blank">
                <h2 class="title mb-6" id="article-4534">RavenDB Sharding &#x2013; Blind sharding</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 19, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">From the get go, RavenDB was designed with sharding in mind. We had a sharding client inside RavenDB when we shipped, and it made for some really cool demos. It also wasn&#x2019;t really popular, we didn&#x2019;t implement some things for sharding. We always intended to, but we had other things to do and no one was asking for it much. That was strange. I decided that we needed to do two major things.   First, to make sure that the experience for writing in a sharded environment was as close as we could get to the one you get with a non sharded environment.  Second, we had to make it simple to use sharding. Before our changes, in order to use sharding you had to do the following:  Setup multiple RavenDB server. Create a list of those servers urls. Implement IShardStrategy, which exposes  IShardAccesStrategy &#x2013; determine how we call to the servers. IShardSelectionStrategy &#x2013; determine how we select which server a new instance will go to, and what server an existing instance belongs on. IShardResolutionStrategy &#x2013; determine which servers we should query when we are querying for data (allow to optimize which servers we are actually hitting for particular queries) All in all, you would need to write a minimum of 3 classes, and have to write some sharding code that can be&#x2026; somewhat tricky. Oh, it works, and it is a great design. It is also complex, and it makes it harder to use sharding. Instead, we now have the following scenario:  As you can see, here we have three different servers, each running in a different port. Let us see what we need to do to get us working with this from the client code:  First, we need to define the servers (and their names), then we create a shard strategy and use that to create a sharded document store. Once that is done, we are home free, and can do pretty much whatever we want: string asianId, middleEasternId, americanId;&#xA;&#xA;using (var session = documentStore.OpenSession())&#xA;{&#xA;    var asian = new Company { Name = &quot;Company 1&quot;, Region = &quot;Asia&quot; };&#xA;    session.Store(asian);&#xA;    var middleEastern = new Company { Name = &quot;Company 2&quot;, Region = &quot;Middle-East&quot; };&#xA;    session.Store(middleEastern);&#xA;    var american = new Company { Name = &quot;Company 3&quot;, Region = &quot;America&quot; };&#xA;    session.Store(american);&#xA;&#xA;    asianId = asian.Id;&#xA;    americanId = american.Id;&#xA;    middleEasternId = middleEastern.Id;&#xA;&#xA;    session.Store(new Invoice { CompanyId = american.Id, Amount = 3 });&#xA;    session.Store(new Invoice { CompanyId = asian.Id, Amount = 5 });&#xA;    session.Store(new Invoice { CompanyId = middleEastern.Id, Amount = 12 });&#xA;    session.SaveChanges();&#xA;&#xA;}&#xA;&#xA;using (var session = documentStore.OpenSession())&#xA;{&#xA;    session.Query&lt;Company&gt;()&#xA;        .Where(x =&gt; x.Region == &quot;America&quot;)&#xA;        .ToList();&#xA;&#xA;    session.Load&lt;Company&gt;(middleEasternId);&#xA;&#xA;    session.Query&lt;Invoice&gt;()&#xA;        .Where(x =&gt; x.CompanyId == asianId)&#xA;        .ToList();&#xA;}&#xA;&#xA;&#xA;&#xA;What you see here is the code that saves both companies and invoices, and does this over multiple servers. Let us see the log output for this code:&#xA;&#xA;You can see a few interesting things here:&#xA;&#xA;The first four requests are to manage the document ids (hilos). By default, we use the first server as the one that will store all the hilo information.&#xA;Next (request #5) we are saving two documents, note that the shard id is now part of the document id.&#xA;Request 6 and 7 here are actually queries, we returned 1 results for the first query, and none for the second.&#xA;Let us look at another shard now:&#xA;&#xA;This is much shorter, since we don&#x2019;t have the hilo requests. The first request is there to store two documents, and then we see two queries, both of which return no results.&#xA;And the last shard:&#xA;&#xA;Here we again don&#x2019;t see the hilo requests (since they are all on the first server). We do see putting of the two docs, and request #2 is a query that returns no results.&#xA;Request #3 is interesting, because we did not see that anywhere else. Since we did a load by id, and since by default we store the shard id in the document id, we were able to optimize this operation and go directly to the relevant shard, bypassing the need to query anything other server.&#xA;The last request is a query, for which we have a result.&#xA;So what did we have so far?&#xA;We were able to easily configure RavenDB to use 3 ways sharding in a few lines of code. It automatically distributed writes and reads for us, and when it could, it optimized the data access so it would only access the relevant shards. Writes are distributed on a round robin basis, so it is pretty fair. And reads are optimized on whatever we can figure out a minimal number of shards to query. For example, when we do a load by id, we can figure out what the shard id is, and query that server directly, rather than all of them.&#xA;Pretty cool, if you ask me.&#xA;Now, you might have noticed that I called this post Blind Sharding. The reason this is called this name is that this is pretty much the lowest rung in the sharding ladder. It is good, it split your data and it tries to optimize things, but it isn&#x2019;t the best solution. I&#x2019;ll discuss a better solution in my next post.</p>
        </article>
        <article id="article-4535">
            <a href="https://ardalis.com/getting-started-with-single-page-applications-in-asp-net/" target="_blank">
                <h2 class="title mb-6" id="article-4535">Getting Started with Single Page Applications in ASP.NET</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 16, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the new features in ASP.NET MVC 4 (Beta) is a new project template for Single Page Applications (SPA). You can download the latest&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-4536">
            <a href="https://ardalis.com/make-iis-express-the-default-for-vs2010-web-projects/" target="_blank">
                <h2 class="title mb-6" id="article-4536">Make IIS Express the Default for VS2010 Web Projects</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 16, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Here&#x2019;s a quick tip that will help you leave Cassini in the past where it belongs. If you&#x2019;re using VS2010 SP1, you can configure your IDE so&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-4537">
            <a href="https://ardalis.com/how-to-use-system-web-in-a-console-application/" target="_blank">
                <h2 class="title mb-6" id="article-4537">How to use System.Web in a Console Application</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 16, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x2019;ve been bitten by this and have seen others run into it enough times that I thought I&#x2019;d blog about it. Let&#x2019;s say you&#x2019;re creating a new&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-4538">
            <a href="https://ardalis.com/kanban-book-review/" target="_blank">
                <h2 class="title mb-6" id="article-4538">Kanban Book Review</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 16, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">While researching material for my Kanban Fundamentals video training course on Pluralsight, I read Kanban: Successful Evolutionary Change&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-4539">
            <a href="https://ayende.com/blog/153704/composite-entities" target="_blank">
                <h2 class="title mb-6" id="article-4539">Composite entities</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 16, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In my previous post, I discussed some of the problems that you run into when you try to have a single source of truth with regards to an entity definition. The question here is, how do we manage something like a Customer across multiple applications / modules. For the purpose of discussion, I am going to assume that all of the data is either:  All sitting in the same physical database (common if we are talking about different modules in the same application). Spread across multiple databases with some data being replicate to all databases (common if we are talking about different applications). We will focus on the customer entity as an example, and we will deal with billing and help desk modules / applications. There are some things that everyone can agree on with regards to the customer. Most often, a customer has a id, which is shared across the entire system, as well as some descriptive details, such as a name. But even things that you would expect to be easily agreed upon aren&#x2019;t really that easy. For example, what about contact information? The person handling billing at a customer is usually different than the person that we contact for help desk inquires. And that is the stuff that we are supposed to agree on. We have much bigger problems when we have to deal with things like customer&#x2019; payment status vs. outstanding helpdesk calls this month. The way to resolve this is to forget about trying to shove everything into a single entity. Or, to be rather more exact, we need to forget about trying to thing about the Customer entity as a single physical thing. Instead, we are going to have the following:  There are several things to note here:  There is no inheritance relationship between the different aspect of a customer. We don&#x2019;t give in and try to put what appears to be shared properties (ContactDetails) in the root Customer. Those details have different meaning for each entity. There are several ways to handle actually storing this information. If we are using a single database, then we will usually have something like:  The advantage of that is that it makes it very easy to actually look at the entire customer entity for debugging purposes. I say for debugging specifically because for production usage, there really isn&#x2019;t anything that needs to look at the entire thing, every part of the system only care for its own details. You can easily load the root customer document and your own customer document whenever you need to. More to the point, because they are different physical things, that solves a lot of the problems that we had with the shared model. Versioning is not an issue, if billing needs to make a change, they can just go ahead and change things. They don&#x2019;t need to talk to anyone, because no one else is touching their data.  Concurrency is not an issue, if you make a concurrent modification to billing and help desk, that is not a problem, they are stored into two different locations. That is actually what you want, since it is perfectly all right for having those concurrent changes. It free us from having to have everyone&#x2019;s acceptance on any change for everything except on the root document. But as you can probably guess, the amount of information that we put on the root is minimal, precisely to avoid those sort of situations. This is how we handle things with a shared database, but what is going on when we have multiple applications, with multiple databases? As you can expect, we are going to have one database which contains all of the definitions of the root Customer (or other entities), and from there we replicate that information to all of the other databases. Why not have them access two databases? Simple, it makes things so much harder. It is easier to have a single database to access to and have replication take care of that. What about updates in that scenario? Well, updates to the local part is easy, you just do that, but updates to the root customer details have to be handled differently. The first thing to ask is whatever there really is any need for any of the modules to actually update the root customer details. I can&#x2019;t see any reason why you would want to do that (billing shouldn&#x2019;t update the customer name, for example). But even if you have this, the way to handle that is to have a part of the system that is responsible for the root entities database, and have it do the update, from where it will replicate to all of the other databases.</p>
        </article>
        <article id="article-4540">
            <a href="https://ayende.com/blog/153703/there-aint-no-such-thing-the-definitive-entity-definition" target="_blank">
                <h2 class="title mb-6" id="article-4540">There ain&#x2019;t no such thing, the definitive entity definition</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 15, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I was at a customer site, and we were talking about a problem they had with modeling their domain. Actually, we were discussing a proposed solution, a central and definitive definition for all of their entities, so all of the applications could use that. I had a minor seizure upon hearing that, but after I recovered, I was able to articulate my objections to this approach.  To start with, it breaks the Single Responsibility Principle, the Open Closed Principle and the Interface Segregation Principle. It also makes versioning hard, and introduce a central place where everyone must coordinate with. Think about the number of people that has to be involved whenever you make a change. Let us take the customer as the representative entity for this discussion. We can all agree that a customer has to have a name, an email and an id. But billing also need to know his credit card information, help desk needs to track what support contracts he has and sales needs to know what sort of products we sold the guy, so we can sell him upgrades. Now, would you care to be the guy who has to mediate between of all of those different concerns?  And what about changes and updates? Whenever you need to make a change, you have to wait for all of those teams and application to catch up and update and deploy their apps,. And what about actual usage? You actually don&#x2019;t want the help desk system to be able to access the billing information, and you most certainly don&#x2019;t want them to change anything there. And does it matter if we have concurrent modifications to the entity by both help desk and billing?  All of those things argue very strongly against having a single source of truth about what an entity is. In my next post, I&#x2019;ll discuss a solution for this problem, Composite Entities.</p>
        </article>
        <div class="button flex justify-between">
            <a href="453.html"><span class="back arrow"></span></a>

            <a href="455.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>