
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 16 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-151">
            <a href="https://devblogs.microsoft.com/dotnet/browserstack-appium-dotnet-maui/" target="_blank">
                <h2 class="title mb-6" id="article-151">Use BrowserStack App Automate with Appium UI Tests for .NET MAUI Apps</h2>
            </a>
            <p class="mb-2">by Sweeky,Gerald</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 26, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post, learn how to run your Appium UI Tests for .NET MAUI Apps on real devices on the cloud using BrowserStack App Automate.</p>
        </article>
        <article id="article-152">
            <a href="https://devblogs.microsoft.com/dotnet/dotnet-in-dev-container/" target="_blank">
                <h2 class="title mb-6" id="article-152">Exploring new .NET releases with Dev Containers</h2>
            </a>
            <p class="mb-2">by Mike Kistler</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 25, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Learn how to set up and use dev containers for experimenting with new .NET releases.</p>
        </article>
        <article id="article-153">
            <a href="https://andrewlock.net/creating-a-software-bill-of-materials-sbom-for-an-open-source-nuget-package/" target="_blank">
                <h2 class="title mb-6" id="article-153">Creating a software bill of materials (SBOM) for an open-source NuGet package</h2>
            </a>
            <p class="mb-2">by Andrew Lock</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 25, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post I discuss several tools you can use to create a software bill of materials (SBOM) for an application or a NuGet package&#x2026;</p>
        </article>
        <article id="article-154">
            <a href="https://ayende.com/blog/202212-C/ravendbs-discord-channel" target="_blank">
                <h2 class="title mb-6" id="article-154">RavenDB&#x27;s Discord channel</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 24, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">RavenDB now has a Discord Channel, where we share memes, have serious technical discussions, and sometimes even talk about RavenDB itself.&#xD;&#xA;You can talk about databases, performance, or your architecture with our community and the RavenDB team directly.&#xD;&#xA;We are kicking it off with a grand opening event, showing off the biggest feature in RavenDB 7.0: vector search and what you can do with it.&#xD;&#xA;You can join us tomorrow using the following link.</p>
        </article>
        <article id="article-155">
            <a href="https://devblogs.microsoft.com/dotnet/xboxs-usage-of-aspire-transforming-development-practices/" target="_blank">
                <h2 class="title mb-6" id="article-155">Xbox &#x2B; .NET Aspire: Transforming Local Development Practices</h2>
            </a>
            <p class="mb-2">by Craig Taylor (XBOX LIVE)</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 24, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Learn how the Xbox services team leveraged .NET Aspire to boost their team&#x27;s productivity.</p>
        </article>
        <article id="article-156">
            <a href="https://www.meziantou.net/nice-example-of-csharp-list-pattern-matching.htm" target="_blank">
                <h2 class="title mb-6" id="article-156">Nice example of C# list pattern matching</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 24, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This post is just me sharing a snippet of code where I&#x27;m glad C# has list pattern matching &#x1F642; You can see how concise the code is! Also, you can see the SplitAny method introduced in .NET 9 in action with the SearchValues&lt;char&gt;.This snippet is a simple version matcher that checks if a version</p>
        </article>
        <article id="article-157">
            <a href="https://ayende.com/blog/202147-A/optimizing-by-170-000-by-not-being-silly" target="_blank">
                <h2 class="title mb-6" id="article-157">Optimizing by 170,000%(!) by not being silly</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 20, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I care&#xA0;about the performance of RavenDB. Enough that I would go to epic lengths to fix them. Here I use &#x201C;epic&#x201D; both in terms of the Agile meaning of multi-month journeys and the actual amount of work required. See my recent posts about RavenDB 7.1 I/O work. There hasn&#x2019;t been a single release in the past 15 years that didn&#x2019;t improve the performance of RavenDB in some way. We have an entire team&#xA0;whose sole task is to find bottlenecks and fix them, to the point where assembly language&#xA0;is a high-level concept at times (yes, we design some pieces of RavenDB with CPU microcode for performance).When we ran into this issue, I was&#x2026; quite surprised, to say the least. The problem was that whenever we serialized a document in RavenDB, we would compile some LINQ expressions. That is expensive, and utterly wasteful. That is the sort of thing that we should never&#xA0;do, especially since there was no actual need for it.Here is the essence of this fix:We ran a performance test on the before &amp; after versions, just to know what kind of performance we left on the table.Before (ms)After (ms)33,78220The fixed version is 1,689 times&#xA0;faster, if you can believe that. So here is a fix that is both great to have and quite annoying. We focused so much effort on optimizing the server, and yet we missed something that obvious? How can that be?Well, the answer is that this isn&#x2019;t an actual benchmark. The problem is that this code is invoked per instance created instead of globally, and it is created once per thread. In any situation where the number of threads is more or less fixed (most production scenarios, where you&#x2019;ll be using a thread pool, as well as in most benchmarks), you are never going to see this problem.It is when you have threads dying and being created (such as when you handle spikes) that you&#x2019;ll run into this issue. Make no mistake, it is&#xA0;an actual issue. When your load spikes, the thread pool will issue new threads, and they will consume a lot of CPU initially for absolutely no reason. In short, we managed to miss this entirely (the code dates to 2017!) for a long time. It never appeared in any benchmark. The fix itself is trivial, of course, and we are unlikely to be able to show any real benefits from it in a benchmark, but that is yet another step in making RavenDB better.</p>
        </article>
        <article id="article-158">
            <a href="https://devblogs.microsoft.com/dotnet/mstest-3-8-highlights/" target="_blank">
                <h2 class="title mb-6" id="article-158">MSTest 3.8: Top 10 features to supercharge your .NET tests!</h2>
            </a>
            <p class="mb-2">by Youssef,Amaury</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 19, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">MSTest 3.8 is here! It&#x27;s built on your feedback and packed with powerful new features to simplify and smooth your testing experience.</p>
        </article>
        <article id="article-159">
            <a href="https://ayende.com/blog/202051-A/ravendb-7-1-one-io-ring-to-rule-them-all" target="_blank">
                <h2 class="title mb-6" id="article-159">RavenDB 7.1</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 18, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the more interesting developments in terms of kernel API surface is the IO Ring. On Linux, it is called IO Uring and Windows has copied it shortly afterward. The idea started as a way to batch multiple IO operations at once but has evolved into a generic mechanism to make system calls more cheaply. On Linux, a large portion of the kernel features is exposed as part of the IO Uring API, while Windows exposes a far less rich API (basically, just reading and writing). The reason this matters is that you can use IO Ring to reduce the cost of making system calls, using both batching and asynchronous programming. As such, most new database engines have jumped on that sweet nectar of better performance results.As part of the overall re-architecture of how Voron manages writes, we have done the same. I/O for Voron is typically composed of writes to the journals and to the data file, so that makes it a really good fit, sort of. An ironic aspect of IO Uring is that despite it being an asynchronous mechanism, it is inherently single-threaded. There are good reasons for that, of course, but that means that if you want to use the IO Ring API in a multi-threaded environment, you need to take that into account. A common way to handle that is to use an event-driven system, where all the actual calls are generated from a single &#x201C;event loop&#x201D; thread or similar. This is how the Node.js API works, and how .NET itself manages IO for sockets (there is a single thread that listens to socket events by default). The whole point&#xA0;of IO Ring is that you can submit multiple operations for the kernel to run in as optimal a manner as possible. Here is one such case to consider, this is the part of the code where we write the modified pages to the data file:using (fileHandle)&#xD;&#xA;{&#xD;&#xA;    for (int i = 0; i &lt; pages.Length; i&#x2B;&#x2B;)&#xD;&#xA;    {&#xD;&#xA;        int numberOfPages = pages[i].GetNumberOfPages();&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;        var size = numberOfPages * Constants.Storage.PageSize;&#xD;&#xA;        var offset = pages[i].PageNumber * Constants.Storage.PageSize;&#xD;&#xA;        var span = new Span&lt;byte&gt;(pages[i].Pointer, size);&#xD;&#xA;        RandomAccess.Write(fileHandle, span, offset);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;        written &#x2B;= numberOfPages * Constants.Storage.PageSize;&#xD;&#xA;    }&#xD;&#xA;}PID     LWP TTY          TIME CMD&#xD;&#xA;  22334   22345 pts/0    00:00:00 iou-wrk-22343&#xD;&#xA;  22334   22346 pts/0    00:00:00 iou-wrk-22343&#xD;&#xA;  22334   22347 pts/0    00:00:00 iou-wrk-22334&#xD;&#xA;  22334   22348 pts/0    00:00:00 iou-wrk-22334&#xD;&#xA;  22334   22349 pts/0    00:00:00 iou-wrk-22334&#xD;&#xA;  22334   22350 pts/0    00:00:00 iou-wrk-22334&#xD;&#xA;  22334   22351 pts/0    00:00:00 iou-wrk-22334&#xD;&#xA;  22334   22352 pts/0    00:00:00 iou-wrk-22334&#xD;&#xA;  22334   22353 pts/0    00:00:00 iou-wrk-22334&#xD;&#xA;  22334   22354 pts/0    00:00:00 iou-wrk-22334&#xD;&#xA;  22334   22355 pts/0    00:00:00 iou-wrk-22334&#xD;&#xA;  22334   22356 pts/0    00:00:00 iou-wrk-22334&#xD;&#xA;  22334   22357 pts/0    00:00:00 iou-wrk-22334&#xD;&#xA;  22334   22358 pts/0    00:00:00 iou-wrk-22334Actually, those aren&#x2019;t threads in the normal sense. Those are kernel tasks, generated by the IO Ring at the kernel level directly. It turns out that internally, IO Ring may spawn worker threads to do the async work at the kernel level. When we had a separate IO Ring per file, each one of them&#xA0;had its own pool of threads to do the work.The way it usually works is really interesting. The IO Ring will attempt to complete the operation in a synchronous manner. For example, if you are writing to a file and doing buffered writes, we can just copy the buffer to the page pool and move on, no actual I/O took place. So the IO Ring will run through that directly in a synchronous manner. However, if your operation requires actual blocking, it will be sent to a worker queue to actually execute it in the background. This is one way that the IO Ring is able to complete many operations so much more efficiently than the alternatives.In our scenario, we have a pretty simple setup, we want to write to the file, making fully buffered writes. At the very least, being able to push all the writes to the OS in one shot (versus many&#xA0;separate system calls) is going to reduce our overhead. More interesting, however, is that eventually,&#xA0;the OS will want to start writing to the disk, so if we write a lot of data, some of the requests will be blocked. At that point, the IO Ring will switch them to a worker thread and continue executing.The problem we had was that when we had a separate IO Ring per data file and put a lot&#xA0;of load on the system, we started seeing contention between the worker threads across all the files. Basically, each ring had its own separate pool, so there was a lot of work for each pool but no sharing.If the IO Ring is single-threaded, but many separate threads lead to wasted resources, what can we do? The answer is simple, we&#x2019;ll use a single global IO Ring and manage the threading concerns directly.Here is the setup code for that (I removed all error handling to make it clearer):void *do_ring_work(void *arg)&#xD;&#xA;{&#xD;&#xA;  int rc;&#xD;&#xA;  if (g_cfg.low_priority_io)&#xD;&#xA;  {&#xD;&#xA;    syscall(SYS_ioprio_set, IOPRIO_WHO_PROCESS, 0, &#xD;&#xA;        IOPRIO_PRIO_VALUE(IOPRIO_CLASS_BE, 7));&#xD;&#xA;  }&#xD;&#xA;  pthread_setname_np(pthread_self(), &quot;Rvn.Ring.Wrkr&quot;);&#xD;&#xA;  struct io_uring *ring = &amp;g_worker.ring;&#xD;&#xA;  struct workitem *work = NULL;&#xD;&#xA;  while (true)&#xD;&#xA;  {&#xD;&#xA;    do&#xD;&#xA;    {&#xD;&#xA;      // wait for any writes on the eventfd &#xD;&#xA;      // completion on the ring (associated with the eventfd)&#xD;&#xA;      eventfd_t v;&#xD;&#xA;      rc = read(g_worker.eventfd, &amp;v, sizeof(eventfd_t));&#xD;&#xA;    } while (rc &lt; 0 &amp;&amp; errno == EINTR);&#xD;&#xA;    &#xD;&#xA;    bool has_work = true;&#xD;&#xA;    while (has_work)&#xD;&#xA;    {&#xD;&#xA;      int must_wait = 0;&#xD;&#xA;      has_work = false;&#xD;&#xA;      if (!work) &#xD;&#xA;      {&#xD;&#xA;        // we may have _previous_ work to run through&#xD;&#xA;        work = atomic_exchange(&amp;g_worker.head, 0);&#xD;&#xA;      }&#xD;&#xA;      while (work)&#xD;&#xA;      {&#xD;&#xA;        has_work = true;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;        struct io_uring_sqe *sqe = io_uring_get_sqe(ring);&#xD;&#xA;        if (sqe == NULL)&#xD;&#xA;        {&#xD;&#xA;          must_wait = 1;&#xD;&#xA;          goto sumbit_and_wait; // will retry&#xD;&#xA;        }&#xD;&#xA;        io_uring_sqe_set_data(sqe, work);&#xD;&#xA;        switch (work-&gt;type)&#xD;&#xA;        {&#xD;&#xA;        case workitem_fsync:&#xD;&#xA;          io_uring_prep_fsync(sqe, work-&gt;filefd, IORING_FSYNC_DATASYNC);&#xD;&#xA;          break;&#xD;&#xA;        case workitem_write:&#xD;&#xA;          io_uring_prep_writev(sqe, work-&gt;filefd, work-&gt;op.write.iovecs,&#xD;&#xA;                               work-&gt;op.write.iovecs_count, work-&gt;offset);&#xD;&#xA;          break;&#xD;&#xA;        default:&#xD;&#xA;          break;&#xD;&#xA;        }&#xD;&#xA;        work = work-&gt;next;&#xD;&#xA;      }&#xD;&#xA;    sumbit_and_wait:&#xD;&#xA;      rc = must_wait ? &#xD;&#xA;        io_uring_submit_and_wait(ring, must_wait) : &#xD;&#xA;        io_uring_submit(ring);&#xD;&#xA;      struct io_uring_cqe *cqe;&#xD;&#xA;      uint32_t head = 0;&#xD;&#xA;      uint32_t i = 0;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;      io_uring_for_each_cqe(ring, head, cqe)&#xD;&#xA;      {&#xD;&#xA;        i&#x2B;&#x2B;;&#xD;&#xA;        // force another run of the inner loop, &#xD;&#xA;        // to ensure that we call io_uring_submit again&#xD;&#xA;        has_work = true; &#xD;&#xA;        struct workitem *cur = io_uring_cqe_get_data(cqe);&#xD;&#xA;        if (!cur)&#xD;&#xA;        {&#xD;&#xA;          // can be null if it is:&#xD;&#xA;          // *  a notification about eventfd write&#xD;&#xA;          continue;&#xD;&#xA;        }&#xD;&#xA;        switch (cur-&gt;type)&#xD;&#xA;        {&#xD;&#xA;        case workitem_fsync:&#xD;&#xA;          notify_work_completed(ring, cur);&#xD;&#xA;          break;&#xD;&#xA;        case workitem_write:&#xD;&#xA;          if (/* partial write */)&#xD;&#xA;          {&#xD;&#xA;            // queue again&#xD;&#xA;            continue;&#xD;&#xA;          }&#xD;&#xA;          notify_work_completed(ring, cur);&#xD;&#xA;          break;&#xD;&#xA;        }&#xD;&#xA;      }&#xD;&#xA;      io_uring_cq_advance(ring, i);&#xD;&#xA;    }&#xD;&#xA;  }&#xD;&#xA;  return 0;&#xD;&#xA;}What does this code do? We start by checking if we want to use lower-priority I/O, this is because we don&#x2019;t actually care how long those operations take. The purpose of writing the data to the disk is that it will reach it eventually. RavenDB has two types of writes:Journal writes (durable update to the write-ahead log, required to complete a transaction).Data flush / Data sync (background updates to the data file, currently buffered in memory, no user is waiting for that)As such, we are fine with explicitly prioritizing the journal writes (which users are waiting for) in favor of all other operations.What is this C code? I thought RavenDB was written in C#RavenDB is&#xA0;written in C#, but for very low-level system details, we found that it is far easier to write a Platform Abstraction Layer to hide system-specific concerns from the rest of the code. That way, we can simply submit the data to write and have the abstraction layer take care of all of that for us. This also ensures that we amortize the cost of PInvoke calls across many operations by submitting a big batch to the C code at once.After setting the IO priority, we start reading from what is effectively a thread-safe queue. We wait for eventfd()&#xA0;to signal that there is work to do, and then we grab the head of the queue and start running.The idea is that we fetch items from the queue, then we write those operations to the IO Ring as fast as we can manage. The IO Ring size is limited, however. So we need to handle the case where we have more work for the IO Ring than it can accept. When that happens, we will go to the submit_and_wait&#xA0;label and wait for something&#xA0;to complete. Note that there is some logic there to handle what is going on when the IO Ring is full. We submit all the work in the ring, wait for an operation to complete, and in the next&#xA0;run, we&#x2019;ll continue processing from where we left off. The rest of the code is processing the completed operations and reporting the result back to their origin. This is done using the following function, which I find absolutely hilarious:int32_t rvn_write_io_ring(&#xD;&#xA;    void *handle,&#xD;&#xA;    struct page_to_write *buffers,&#xD;&#xA;    int32_t count,&#xD;&#xA;    int32_t *detailed_error_code)&#xD;&#xA;{&#xD;&#xA;    int32_t rc = SUCCESS;&#xD;&#xA;    struct handle *handle_ptr = handle;&#xD;&#xA;    if (count == 0)&#xD;&#xA;        return SUCCESS;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;    if (pthread_mutex_lock(&amp;handle_ptr-&gt;global_state-&gt;writes_arena.lock))&#xD;&#xA;    {&#xD;&#xA;        *detailed_error_code = errno;&#xD;&#xA;        return FAIL_MUTEX_LOCK;&#xD;&#xA;    }&#xD;&#xA;    size_t max_req_size = (size_t)count * &#xD;&#xA;                      (sizeof(struct iovec) &#x2B; sizeof(struct workitem));&#xD;&#xA;    if (handle_ptr-&gt;global_state-&gt;writes_arena.arena_size &lt; max_req_size)&#xD;&#xA;    {&#xD;&#xA;        // allocate arena space&#xD;&#xA;    }&#xD;&#xA;    void *buf = handle_ptr-&gt;global_state-&gt;writes_arena.arena;&#xD;&#xA;    struct workitem *prev = NULL;&#xD;&#xA;    int eventfd = handle_ptr-&gt;global_state-&gt;writes_arena.eventfd;&#xD;&#xA;    for (int32_t curIdx = 0; curIdx &lt; count; curIdx&#x2B;&#x2B;)&#xD;&#xA;    {&#xD;&#xA;        int64_t offset = buffers[curIdx].page_num * VORON_PAGE_SIZE;&#xD;&#xA;        int64_t size = (int64_t)buffers[curIdx].count_of_pages *&#xD;&#xA;                       VORON_PAGE_SIZE;&#xD;&#xA;        int64_t after = offset &#x2B; size;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;        struct workitem *work = buf;&#xD;&#xA;        *work = (struct workitem){&#xD;&#xA;            .op.write.iovecs_count = 1,&#xD;&#xA;            .op.write.iovecs = buf &#x2B; sizeof(struct workitem),&#xD;&#xA;            .completed = 0,&#xD;&#xA;            .type = workitem_write,&#xD;&#xA;            .filefd = handle_ptr-&gt;file_fd,&#xD;&#xA;            .offset = offset,&#xD;&#xA;            .errored = false,&#xD;&#xA;            .result = 0,&#xD;&#xA;            .prev = prev,&#xD;&#xA;            .notifyfd = eventfd,&#xD;&#xA;        };&#xD;&#xA;        prev = work;&#xD;&#xA;        work-&gt;op.write.iovecs[0] = (struct iovec){&#xD;&#xA;            .iov_len = size, &#xD;&#xA;            .iov_base = buffers[curIdx].ptr&#xD;&#xA;        };&#xD;&#xA;        buf &#x2B;= sizeof(struct workitem) &#x2B; sizeof(struct iovec);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;        for (size_t nextIndex = curIdx &#x2B; 1; &#xD;&#xA;            nextIndex &lt; count &amp;&amp; work-&gt;op.write.iovecs_count &lt; IOV_MAX; &#xD;&#xA;            nextIndex&#x2B;&#x2B;)&#xD;&#xA;        {&#xD;&#xA;            int64_t dest = buffers[nextIndex].page_num * VORON_PAGE_SIZE;&#xD;&#xA;            if (after != dest)&#xD;&#xA;                break;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;            size = (int64_t)buffers[nextIndex].count_of_pages *&#xD;&#xA;                              VORON_PAGE_SIZE;&#xD;&#xA;            after = dest &#x2B; size;&#xD;&#xA;            work-&gt;op.write.iovecs[work-&gt;op.write.iovecs_count&#x2B;&#x2B;] = &#xD;&#xA;                (struct iovec){&#xD;&#xA;                .iov_base = buffers[nextIndex].ptr,&#xD;&#xA;                .iov_len = size,&#xD;&#xA;            };&#xD;&#xA;            curIdx&#x2B;&#x2B;;&#xD;&#xA;            buf &#x2B;= sizeof(struct iovec);&#xD;&#xA;        }&#xD;&#xA;        queue_work(work);&#xD;&#xA;    }&#xD;&#xA;    rc = wait_for_work_completion(handle_ptr, prev, eventfd, &#xD;&#xA;detailed_error_code);&#xD;&#xA;    pthread_mutex_unlock(&amp;handle_ptr-&gt;global_state-&gt;writes_arena.lock)&#xD;&#xA;    return rc;&#xD;&#xA;}Remember that when we submit writes to the data file, we must&#xA0;wait until they are all done. The async nature of IO Ring is meant to help us push the writes to the OS as soon as possible, as well as push writes to multiple separate files at once. For that reason, we use anothereventfd()&#xA0;to wait (as the submitter) for the IO Ring to complete the operation. I love the code above because it is actually using the IO Ring itself to do the work we need to do here, saving us an actual system call in most cases. Here is how we submit the work to the worker thread:void queue_work(struct workitem *work)&#xD;&#xA;{&#xD;&#xA;    struct workitem *head = atomic_load(&amp;g_worker.head);&#xD;&#xA;    do&#xD;&#xA;    {&#xD;&#xA;        work-&gt;next = head;&#xD;&#xA;    } while (!atomic_compare_exchange_weak(&amp;g_worker.head, &amp;head, work));&#xD;&#xA;}This function handles the submission of a set of pages to write to a file. Note that we protect against concurrent work on the same file. That isn&#x2019;t actually needed since the caller code already handles that, but an uncontended lock is cheap, and it means that I don&#x2019;t need to think about concurrency or worry about changes in the caller code in the future. We ensure that we have sufficient buffer space, and then we create a work item. A work item is a single write to the file at a given location. However, we are using vectored writes, so we&#x2019;ll merge writes to the consecutive pages into a single write operation. That is the purpose of the huge for loop in the code. The pages arrive already sorted, so we just need to do a single scan &amp; merge for this.Pay attention to the fact that the struct workitem&#xA0;actually belongs to two different&#xA0;linked lists. We have the next&#xA0;pointer, which is used to send work to the worker thread, and the prev&#xA0;pointer, which is used to iterate over the entire set of operations we submitted on completion (we&#x2019;ll cover this in a bit). Queuing work is done using the following method:int32_t&#xD;&#xA;wait_for_work_completion(struct handle *handle_ptr, &#xD;&#xA;    struct workitem *prev, &#xD;&#xA;    int eventfd, &#xD;&#xA;    int32_t *detailed_error_code)&#xD;&#xA;{&#xD;&#xA;    // wake worker thread&#xD;&#xA;    eventfd_write(g_worker.eventfd, 1);&#xD;&#xA;    &#xD;&#xA;    bool all_done = false;&#xD;&#xA;    while (!all_done)&#xD;&#xA;    {&#xD;&#xA;        all_done = true;&#xD;&#xA;        *detailed_error_code = 0;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;        eventfd_t v;&#xD;&#xA;        int rc = read(eventfd, &amp;v, sizeof(eventfd_t));&#xD;&#xA;        struct workitem *work = prev;&#xD;&#xA;        while (work)&#xD;&#xA;        {&#xD;&#xA;            all_done &amp;= atomic_load(&amp;work-&gt;completed);&#xD;&#xA;            work = work-&gt;prev;&#xD;&#xA;        }&#xD;&#xA;    }&#xD;&#xA;    return SUCCESS;&#xD;&#xA;}The idea is pretty simple. We first wake the worker thread by writing to its eventfd(),&#xA0;and then we wait on our own eventfd()&#xA0;for the worker to signal us that (at least some) of the work is done.Note that we handle the submission of multiple work items by iterating over them in reverse order, using the prev&#xA0;pointer. Only when all&#xA0;the work is done can we return to our caller. The end result of all this behavior is that we have a completely new way to deal with background I/O operations (remember, journal writes are handled differently). We can control both the volume of load we put on the system by adjusting the size of the IO Ring as well as changing its priority. The fact that we have a single global IO Ring means that we can get much better usage out of the worker thread pool that IO Ring utilizes. We also give the OS a lot more opportunities to optimize RavenDB&#x2019;s I/O.The code in this post shows the Linux implementation, but RavenDB also supports IO Ring on Windows if you are running a recent edition. We aren&#x2019;t&#xA0;done yet, mind, I still have more exciting things to tell you about how RavenDB 7.1 is optimizing writes and overall performance. In the next post, we&#x2019;ll discuss what I call the High Occupancy Lane vs. Critical Lane for I/O and its impact on our performance.</p>
        </article>
        <article id="article-160">
            <a href="https://devblogs.microsoft.com/dotnet/dotnet-10-preview-2/" target="_blank">
                <h2 class="title mb-6" id="article-160">.NET 10 Preview 2 is now available!</h2>
            </a>
            <p class="mb-2">by .NET Team</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 18, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Find out about the new features in .NET 10 Preview 2 across the .NET runtime, SDK, libraries, ASP.NET Core, Blazor, C#, .NET MAUI, and more!</p>
        </article>
        <div class="button flex justify-between">
            <a href="15.html"><span class="back arrow"></span></a>

            <a href="17.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
