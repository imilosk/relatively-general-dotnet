
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 529 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-5281">
            <a href="https://ayende.com/blog/4512/porting-mvc-music-store-to-raven-porting-the-homecontroller-the-map-reduce-way" target="_blank">
                <h2 class="title mb-6" id="article-5281">Porting MVC Music Store to Raven</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 21, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The current HomeController looks like this:     I really don&#x2019;t like the fact that the controller issues queries like that, but we will let it go for now.  This query (thanks to EF Prof) looks like this:       And here we run into a very interesting problem, we can&#x2019;t really replicate this query. The reason is that this query runs over multiple tables which our model says would be in different documents.  There are several ways in which we can fix this. One way of doing this would be to define a map / reduce index on top of orders.     Note: Yes, I am familiar with this comic.    The way that I am about to show you isn&#x2019;t the way I would recommend going for real, but I want to show it anyway. I&#x2019;ll discuss the idiomatic Raven way of handling this feature in my next post.   Map/reduce in Raven is just a couple of Linq queries, so it is nothing to be worried about. As a reminder, we have the following order documents in our database:       We define the index &#x201C;SoldAlbums&#x201D; using the following queries.     // map&#xA;from order in docs.Orders&#xA;from line in order.Lines&#xA;select new{ line.Album, line.Quantity }&#xA;&#xA;// reduce&#xA;from result in results&#xA;group result by result.Album into g&#xA;select new{ Album = g.Key, Quantity = g.Sum(x=&gt;x.Quantity) }&#xA;  &#xA;&#xA;As you can see, those are two very simple Linq queries.&#xA;&#xA;&#xA;&#xA;The result of which would be:&#xA;&#xA; &#xA;&#xA;Once we have that, it is trivial to derive the answer to GetTopSellingAlbums. Indeed, the following function implements the exact same logic and has the same output as the previous implementation:&#xA;&#xA; &#xA;&#xA;&#xA;&#xA;The way it work is pretty simple, we get the most sold albums (by sorting on descending quantity), then load them from the database. Because we might have less than count top selling albums, we need to top it off from regular albums. &#xA;&#xA;This mean that this code execute 2 &#x2013; 3 queries. I don&#x2019;t really like it, but on my machine, it takes about less than 10 ms to do all three requests, which is livable. &#xA;&#xA;The reason that I am posting this solution is that I want to show this as an approach to a problem, not as the recommended approach for how to solve it, I&#x2019;ll do that in my next post.</p>
        </article>
        <article id="article-5282">
            <a href="https://ayende.com/blog/4511/c-coding-challenge-what-will-this-code-do" target="_blank">
                <h2 class="title mb-6" id="article-5282">C# Coding Challenge: What will this code do?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 21, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">What is the output of this code?   IDictionary&lt;object,string&gt; instanceToKey = new Dictionary&lt;object, string&gt;();&#xA;&#xA; IDictionary&lt;string, int&gt; keyToCost = new Dictionary&lt;string, int&gt;();&#xA;&#xA; var inst1 = new object();&#xA; var inst2 = new object();&#xA;&#xA; instanceToKey[inst1] = &quot;one&quot;;&#xA; keyToCost[&quot;one&quot;] = 1;&#xA;&#xA; instanceToKey[inst2] = &quot;two&quot;;&#xA; keyToCost[&quot;two&quot;] = 2;&#xA;&#xA; string value = null;&#xA; foreach (var key&#xA;     in (from inst in new[]{inst1, inst2, new object()}&#xA;         where instanceToKey.TryGetValue(inst, out value) &#xA;         select value))&#xA; {&#xA;     int cost;&#xA;     if(keyToCost.TryGetValue(key, out cost))&#xA;         Console.WriteLine(&quot;Key: {0}, Cost: {1}&quot;, key, cost);&#xA; }</p>
        </article>
        <article id="article-5283">
            <a href="https://ayende.com/blog/4510/porting-mvc-music-store-to-raven-data-migration" target="_blank">
                <h2 class="title mb-6" id="article-5283">Porting MVC Music Store to Raven</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 20, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Here is the code required to take the data in the MVC Music Store database and turn into the appropriate Raven documents:     using (var documentStore = new DocumentStore { Url = &quot;http://localhost:8080&quot; })&#xA;{&#xA;    documentStore.Initialise();&#xA;    using (var session = documentStore.OpenSession())&#xA;    {&#xA;        foreach (var album in storeDB.Albums.Include(&quot;Artist&quot;).Include(&quot;Genre&quot;))&#xA;        {&#xA;            session.Store(new&#xA;            {&#xA;                Id = &quot;albums/&quot; &#x2B; album.AlbumId,&#xA;                album.AlbumArtUrl,&#xA;                Arist = new { album.Artist.Name, Id = &quot;artists/&quot; &#x2B; album.Artist.ArtistId },&#xA;                Genre = new { album.Genre.Name, Id = &quot;genres/&quot; &#x2B; album.Genre.GenreId },&#xA;                album.Price,&#xA;                album.Title,&#xA;            });&#xA;        }&#xA;        foreach (var genre in storeDB.Genres)&#xA;        {&#xA;            session.Store(new&#xA;            {&#xA;                genre.Description,&#xA;                genre.Name,&#xA;                Id = &quot;genres/&quot; &#x2B; genre.GenreId&#xA;            });&#xA;        }&#xA;        session.SaveChanges();&#xA;    }&#xA;}&#xA;  &#xA;&#xA;As you can see, it is pretty simple and, even if I say so myself, pretty slick. &#xA;&#xA;I use anonymous types here because I am only concerned with porting the data, I don&#x2019;t really care about how to deal types right now.</p>
        </article>
        <article id="article-5284">
            <a href="https://ayende.com/blog/4509/porting-mvc-music-store-to-raven-setting-up-the-application" target="_blank">
                <h2 class="title mb-6" id="article-5284">Porting MVC Music Store to Raven</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 19, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Just a few words about the way that I setup Raven to be used in the MVC Music Store application before we get to the actual code.     The model is (intentionally) very close to the one used by NHibernate. We initialize the document store in the application start.     We then open/close the session on request boundary, and create a way to access the current session.     If the application supported a container, I would make sure that the controllers got the session instance through that, but it doesn&#x2019;t, so I just used static gateway.             If you don&#x2019;t like, feel free to submit a patch.               public class MvcApplication : System.Web.HttpApplication&#xA;{&#xA;    private const string RavenSessionKey = &quot;Raven.Session&quot;;&#xA;    private static DocumentStore _documentStore;&#xA;&#xA;    protected void Application_Start()&#xA;    {&#xA;        _documentStore = new DocumentStore { Url = &quot;http://localhost:8080/&quot; };        _documentStore.Initialise();&#xA;&#xA;        AreaRegistration.RegisterAllAreas();&#xA;&#xA;        RegisterRoutes(RouteTable.Routes);&#xA;    }&#xA;&#xA;    public MvcApplication()&#xA;    {&#xA;        BeginRequest &#x2B;= (sender, args) =&gt; HttpContext.Current.Items[RavenSessionKey] = _documentStore.OpenSession();&#xA;        EndRequest &#x2B;= (o, eventArgs) =&gt;&#xA;        {&#xA;            var disposable = HttpContext.Current.Items[RavenSessionKey] as IDisposable;&#xA;            if (disposable != null)&#xA;                disposable.Dispose();&#xA;        };&#xA;    }&#xA;&#xA;    public static IDocumentSession CurrentSession&#xA;    {&#xA;        get { return (IDocumentSession) HttpContext.Current.Items[RavenSessionKey]; }&#xA;    }&#xA;}&#xA;  &#xA;&#xA;This is pretty much it, as far as Raven&#x2019;s initialization is concerned.</p>
        </article>
        <article id="article-5285">
            <a href="https://ayende.com/blog/4508/comments-on-ravendb-licensing" target="_blank">
                <h2 class="title mb-6" id="article-5285">Comments on RavenDB licensing</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 19, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">There appears to be some confusion with regards to RavenDB licensing terms. In part, this is because some people believe that it is priced too highly.  There is currently a debate going on in the mailing list, which I suggest you&#x2019;ll join. Yes, I am open sourcing the decision process for the pricing model :-)  That said, leaving the pricing aside, we still need to consider the licensing terms, and what they mean. RavenDB is dual licensed, which means that it is available under a standard commercial license and under the AGPLv3 license. The AGPL is one of the most restrictive OSS licenses. Interestingly enough, if you ask the authors of the AGPL they will probably say that it is one of the most free OSS licenses, but that is a discussion for another time.   The AGPL is similar to the GPL in that it is viral, but it has the additional property that it defines distribution as also including web requests and computer networks. (Oversimplifying a bit, I know, but that is why the AGPL FAQ exists).  RavenDB licensing terms are pretty simple:      You can use RavenDB with OSS projects (OSI approved licenses), and you don&#x2019;t have to modify your license to match RavenDB&#x2019;s licenses. The AGPL doesn&#x2019;t normally allow it, RavenDB contains a specific exception to allow that.    If you want to use RavenDB in commercial closed source software, you need to buy a commercial license.   The last statement is where most people have an issue with, so let me be even clearer:  If you are using RavenDB for an internal application that no external user will access, then the distribution clause never comes into effect.     Note, however, that distributing AGPL applications also include making them available to users / systems outside your own organization.    Well, the previous point isn&#x2019;t strictly true, even for internal users, in order to comply with the license, you must allow them a way to get the source.   What if you are using RavenDB as a backend server for your application? RavenDB is never accessed from the outside, so it is not distributed. And even the AGPL doesn&#x2019;t say that making a web request to an AGPL server forces you to be AGPL&#x2019;ed. That would be an accurate point, except that RavenDB comes in two pieces, one of which is the server, but the second is the client API. And if you use the client API (which is also licensed under the AGPL), your application now must be AGPL&#x2019;ed.  That is not a problem, right? RavenDB is a REST based system, you can just write your own client, and license that under the BSD.  Not quite.   Why is that? Because of something called a derived work. If you creating a standard HTTP client (PUT, GET, DELETE, etc) that can work against RavenDB, there is nothing that would stop you from doing that. If, however, your client is built to take advantage of RavenDB&#x2019;s specific features (replication, transactions, batching, patching, etc), then it stopped being a standard HTTP client and became a derived work of RavenDB. At which point, as you probably guessed, the AGPL kicks in again.  All the legalities aside, my intent is that if you use RavenDB commercially, you pay for a commercial license.</p>
        </article>
        <article id="article-5286">
            <a href="https://ayende.com/blog/4507/ravendb-goes-live" target="_blank">
                <h2 class="title mb-6" id="article-5286">RavenDB goes live!</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 18, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I have been talking about this for what seems like forever (over two years, if you really care to know), but it is finally out.    You can access our site at http://ravendb.net  What you will find there is:     Tutorials    Sample application    Extensive documentation    Commercial options &amp; support    An active community   Head on there, and please let us know what you think&#x2026;  But before you go, I would like to send my heartfelt thanks for the following people, for their help &amp; support:     Aaron Weiker    Andrew Stewart    Andrew Theken    Andy Stewart    Benny Thomas    Bjarte Skogoy    Bobby Johnson    Emil Cardell    Luke Hertert    Mark Henke    Paul B    Rob Ashton    Steve Strong   Heading to the launch event now. Fly Raven, Fly :-)</p>
        </article>
        <article id="article-5287">
            <a href="https://ayende.com/blog/4506/porting-mvc-music-store-to-raven-the-data-model" target="_blank">
                <h2 class="title mb-6" id="article-5287">Porting MVC Music Store to Raven</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 18, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The MVC Music Store release came as a fortunate surprise, I wanted to write a sample application for Raven, and having someone else write all the hard bits (the UI :-)) for me and leave to just replace the data access is just about ideal. The overall goal is to touch absolutely no JS/HTML code in the app, replacing just the controllers. It would be interesting to see if I&#x2019;ll manage to do that.  The database model for the application is:     You can see some interesting things in the schema immediately:     The Cart table should probably be called CartLineItem, because it stores a row per item in the cart.          The CartId is not an foreign key, but a reference to the user name or the session id.       The Artist table only hold the artist name, there is no other data.   With this information, I think that the following data model would be appropriate:  Albums        The album document contains a reference to the Genre as well as the Genre&#x2019;s name. This allows us to display the album without having to refer to the Genre document.    The album document contains the artist name and id, for much the same reason.    There isn&#x2019;t actually a set of Artist documents in the database. We don&#x2019;t keep any information about an artist, except its name, so I didn&#x2019;t see a reason to introduce it at this time.   Genre         The genre document is an exact duplicate of the Genre table, no surprises here.   Cart     The cart is a pretty common document format, we have a single document and it contains an array of elements where the relational model contained a set of rows. Note that the UserIdentifier is where we store the user id or the session id for the cart.  Order     Order is another pretty standard document format. We aggregate all the order information to a single document, and we aggregate related information (Address) to a specific node.  Artist  There is no artist document.  Why does Genre deserve a standalone document while Artist gets subsumed into Album?          For the simple reason that the application does something with Genres (if only just displaying their description) where the only thing that is done with Artists is displaying their name in the context of an album. At this point, I consider Artist to be wholly owned by album, so there is no reason to keep a separate document for it. The only reason that album&#x2019;s artist have and artist id is that I am assuming (based on the data) that the source for artist is an external system that does something a bit more meaningful with it than keep the artist name around.  This is just one half of the work we need to do, we have defined the data model, now we need to consider how this is used in a broader context, and add the query model using indexes. That will be covered in a future post.</p>
        </article>
        <article id="article-5288">
            <a href="https://ardalis.com/630/" target="_blank">
                <h2 class="title mb-6" id="article-5288">Dont Throw Duplicate Exceptions</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 17, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In your code, you&#x2019;ll sometimes have write code that validates input using a variety of checks. Assuming you haven&#x2019;t embraced AOP and done&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-5289">
            <a href="https://ayende.com/blog/4505/analyzing-the-mvc-music-store-data-access" target="_blank">
                <h2 class="title mb-6" id="article-5289">Analyzing the MVC Music Store: Data Access</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 17, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I thought that it would be a good idea to take EF Prof for a spin one the sample MVC Music Store. It can illustrate some things about EF Prof and about the sample app.   The first step is to download EF Prof, once that is completed, extract the files, there is no install necessary.  We need to reference the HibernatingRhinos.Profiler.Appender in the application:  &#xA0;   Then, from the Global.asax Application_Start, we initialize the profiler:       That is all the setup that you need to do :-)  Now, we go to http://localhost:1397/, and we can see the following in EF Prof:     There are several interesting this to see here.      We executed three queries to load the main page.     We actually opened four object contexts to handle this request.    We have a query that generate a warning.   Let us deal with each one in turn:  Multiple queries for the same request. This requires analysis because often we are querying too much. But in this instance there is no problem, we are querying different things and we are doing so efficiently.  Four object contexts to handle a single request is bad. We can see that each query was actually executed through a different object context (and one was idle). There are several problems with having multiple object contexts per request:     Each object context would open its own connection to the database. I am not sure, but I think that they do so lazily, which means that a single page request resulted in three connections to the database.    Each object context implements its own unit of work. You might get two different instances that represent the same row in the database.     You can&#x2019;t aggregate all your operations into a single SaveChanges() call, you have to make multiple trips to the database.    You require using System.Transactions and distributed transactions if you want to ensure a transaction boundary around your code.   In short, there are a lot of good reasons to go with request scoped object context, you should do so.  Now, let us look at that query with the warning:     EF Prof generated a warning about unbounded result set for this query. What does this mean? It means that if you had 100,000 genres, this query would attempt to load all of them. I am not an expert on music, but even I think that 100,000 genres are unlikely. The problem with these sort of queries is that it is likely that the number of genres will grow, and not adding a TOP or LIMIT clauses to the query means that you are open to problems when the data does grow.  And with that, let us see what happens when we look at a single album (http://127.0.0.1:1397/Store/Details/392):     This is pretty much the same as the before, with 5 queries required to process this required, but let us dig just a tiny bit deeper:     What we see here is that we have queries that are being generated from rendering the views. That usually trips a warning flag with me, because queries that are being generated from the view are likely to cause problems down the road, data access patterns should rarely change because of view changes, and that is usually and indication that at some point, we will have a SELECT N&#x2B;1 here.  Now, let us try to add a new item to the cart (http://127.0.0.1:1397/ShoppingCart/AddToCart/669):     We can see that adding an item to the cart is a two steps process, first, we go to /ShoppingCart/AddToCart/669, then we are redirected to /ShoppingCart. Overall, we require 8 queries in two requests.  Let us look at the actual queries required to process AddToCart (note, however, that we are talking about two different object contexts):     Look at the first query, I don&#x2019;t see us doing anything with the data here. Let us look a bit more closely on where it is generated:     And AddToCart looks like this:        It seems that the ShoppingCart.AddToCart requires an album instance, take a look at it, and see what it does with it. The only thing it does is to use the album id. But we already know the album id, we used that to get the album instance in the first place.  It seems that the first query is there solely to check that the value exists and throw an error from the Single() method. I think we can optimize that:      We removed that query, but we preserve the same behavior (if the application tries to save a new cart item with a missing album id, a FK violation would be thrown). Querying the database is one of the most expensive things that we can do, so it pays to watch out to where we can save in queries.   Now, let us add a few more items to the shopping cart and see what happens :-) I added 6 albums to my cart, and then went to (http://127.0.0.1:1397/ShoppingCart):     Wow! We require 10 queries to process this request, and you can see that EF Prof is urgently requesting that you&#x2019;ll take a closer look at the last three.     EF Prof has detected that we have a SELECT N&#x2B;1 error here, where we issue a query per album in the shopping cart. If we will look at the stack trace, we will find a familiar sight:     We have queries being generated from the views, in this case, from this code:     You can see that on line 47, as shown in the profiler, we are access the title property of the album, forcing a lazy load.  Tracking it further, we can see that Model.CartItems is set here:     And that GetCartItems is defined as:     And this generate the following query:     Well, that is easy enough to fix :-)     Which result in this query:     We now bring all the related albums in a single query. Which means that viewing the shopping cart result in:     Just four queries, instead of 10!  Not too shabby, for 15 minutes work with the profiler, even if I say so myself.             In general, when I am developing applications, the profiler is always running in the background, and I keep an eye on it to see if I am doing something that it warns me about, such as SELECT N &#x2B;1, multiple contexts in the same request, too many calls to the database, etc.</p>
        </article>
        <article id="article-5290">
            <a href="https://ayende.com/blog/4504/raven-replication-scenarios" target="_blank">
                <h2 class="title mb-6" id="article-5290">Raven Replication: Scenarios</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 16, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am currently writing the tests for the replication bundle. I managed to overcome the biggest problem (my stupidity), and we now have some passing tests :-)  What I am looking for is more scenarios like this, so we would have as many tested scenarios as possible. I don&#x2019;t want code, or anything like that, just give me a set scenario to try against the replication system.  Feel free to make them as complex as you wish.  Here is an example of how I think about he tests that we currently have:              &#xA0;        Command        Result                  Replicating PUT        PUT raven1/docs/ayende        200                  &#xA0;        GET raven2/docs/ayende        200                  Replicating DELETE        PUT raven1/docs/ayende        200                  &#xA0;        GET raven2/docs/ayende        200                  &#xA0;        DELETE raven1/docs/ayende        201                  &#xA0;        GET raven2/docs/ayende        404</p>
        </article>
        <div class="button flex justify-between">
            <a href="528.html"><span class="back arrow"></span></a>

            <a href="530.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>