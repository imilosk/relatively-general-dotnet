
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Home â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main">
    <section aria-label="Blog post list">
        <a href="https://www.stevejgordon.co.uk/asp-net-core-identity-token-providers" target="_blank"><h1 class="title mb-6">ASP.NET Core Identity Token Providers &#x2013; Under the Hood</h1></a>
        <p class="mb-2">by Steve Gordon</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 12, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Next up for my series on ASP.NET Core Identity I was interested in how the Identity library provides a way to create tokens which validate actions such as when a user first registers and we need to confirm their email address. This post took a lot longer to write than I expected it to as [&#x2026;]</p>
        <a href="https://ayende.com/blog/173250/playing-with-key-generators" target="_blank"><h1 class="title mb-6">Playing with key generators</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 12, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">For the past 6 years or so, Hibernating Rhinos is using a licensing component that I wrote after being burned by trying to use a commercial licensing component. This licensing scheme is based around signed XML files that we send to customers. It works, but it has a few issues. Sending files to customers turn out to be incredibly tricky. A lot of companies out there will flat out reject any email that has an attachment. So we ended up uploading the files to S3, and sending them a link to it. Dealing with files in this manner also means that there is a lot of relatively manual steps (take the file, rename it, place it in this dir, etc). With all the attendant issues that they entail. So we want something simpler. Here is a sample of the kind of information that I need to pass in the license:   Note that this is a pure property bag, no structure beyond that. An obvious solution for that is to throw it in JSON, and add a public key signature. This would look like this:  {&#xA;  &quot;id&quot;: &quot;cd6fff02-2aff-4fae-bc76-8abf1e673d3b&quot;,&#xA;  &quot;expiration&quot;: &quot;2017-01-17T00:00:00.0000000&quot;,&#xA;  &quot;type&quot;: &quot;Subscription&quot;,&#xA;  &quot;version&quot;: &quot;3.0&quot;,&#xA;  &quot;maxRamUtilization&quot;: &quot;12884901888&quot;,&#xA;  &quot;maxParallelism&quot;: &quot;6&quot;,&#xA;  &quot;allowWindowsClustering&quot;: &quot;false&quot;,&#xA;  &quot;OEM&quot;: &quot;false&quot;,&#xA;  &quot;numberOfDatabases&quot;: &quot;unlimited&quot;,&#xA;  &quot;fips&quot;: &quot;false&quot;,&#xA;  &quot;periodicBackup&quot;: &quot;true&quot;,&#xA;  &quot;quotas&quot;: &quot;false&quot;,&#xA;  &quot;authorization&quot;: &quot;true&quot;,&#xA;  &quot;documentExpiration&quot;: &quot;true&quot;,&#xA;  &quot;replication&quot;: &quot;true&quot;,&#xA;  &quot;versioning&quot;: &quot;true&quot;,&#xA;  &quot;maxSizeInMb&quot;: &quot;unlimited&quot;,&#xA;  &quot;ravenfs&quot;: &quot;true&quot;,&#xA;  &quot;encryption&quot;: &quot;true&quot;,&#xA;  &quot;compression&quot;: &quot;false&quot;,&#xA;  &quot;updatesExpiration&quot;: &quot;2017-Jan-17&quot;,&#xA;  &quot;name&quot;: &quot;Hibernating Rhinos&quot;,&#xA;  &quot;Signature&quot;: &quot;XorRcQEekjOOARwJwjK5Oi7QedKmXKdQWmO&#x2B;&#x2B;DvrqBSEUMPqVX4Ahg==&quot;&#xA;}&#xA;&#xA;This has the advantage of being simple, text friendly, easy to work send over email, paste, etc. It is also human readable (which means that it is easy for a customer to look at the license and see what is specified.&#xA;But it also means that a customer might try to change it (you&#x27;ll be surprised how often that happens), and be surprised when this fails. Other common issues include only pasting the &quot;relevant&quot; parts of the license, or pasting invalid JSON definition because of email client issues. And that doesn&#x27;t include the journey some licenses go through. (They get pasted into Word, which adds smart quotes, into various systems, get sent around on various chat programs, etc). If you have a customer name that include Unicode, it is easy to lose that information, which will result in invalid license (won&#x27;t match the signature).&#xA;There is also another issue, of professionalism. Not so much how you act, but how you appear to act. And something like the license above doesn&#x27;t feel right to certain people. It is a deviation from the common practice in the industry, and can send a message about not caring too much about this. Which lead to wondering whatever you care about the rest of the application&#x2026;&#xA;Anyway, I&#x27;m not sure that I like it, for all of those reasons. A simple way to avoid this is to just BASE64 the whole string. &#xA;What I want to have is something like this:&#xA;&#xA;eyJpZCI6ImNkNmZmZjAyLTJhZmYtNGZhZS1iYzc2LThhYmYxZ&#xA;TY3M2QzYiIsImV4cGlyYXRpb24iOiIyMDE3LTAxLTE3VDAwOj&#xA;AwOjAwLjAwMDAwMDAiLCJ0eXBlIjoiU3Vic2NyaXB0aW9uIiw&#xA;idmVyc2lvbiI6IjMuMCIsIm1heFJhbVV0aWxpemF0aW9uIjoi&#xA;MTI4ODQ5MDE4ODgiLCJtYXhQYXJhbGxlbGlzbSI6IjYiLCJhb&#xA;Gxvd1dpbmRvd3NDbHVzdGVyaW5nIjoiZmFsc2UiLCJPRU0iOi&#xA;JmYWxzZSIsIm51bWJlck9mRGF0YWJhc2VzIjoidW5saW1pdGV&#xA;kIiwiZmlwcyI6ImZhbHNlIiwicGVyaW9kaWNCYWNrdXAiOiJ0&#xA;cnVlIiwicXVvdGFzIjoiZmFsc2UiLCJhdXRob3JpemF0aW9uI&#xA;joidHJ1ZSIsImRvY3VtZW50RXhwaXJhdGlvbiI6InRydWUiLC&#xA;JyZXBsaWNhdGlvbiI6InRydWUiLCJ2ZXJzaW9uaW5nIjoidHJ&#xA;1ZSIsIm1heFNpemVJbk1iIjoidW5saW1pdGVkIiwicmF2ZW5m&#xA;cyI6InRydWUiLCJlbmNyeXB0aW9uIjoidHJ1ZSIsImNvbXByZ&#xA;XNzaW9uIjoiZmFsc2UiLCJ1cGRhdGVzRXhwaXJhdGlvbiI6Ij&#xA;IwMTctSmFuLTE3IiwibmFtZSI6IkhpYmVybmF0aW5nIFJoaW5&#xA;vcyIsIlNpZ25hdHVyZSI6IlhvclJjUUVla2pPT0FSd0p3aks1&#xA;T2k3UWVkS21YS2RRV21PKytEdnJxQlNFVU1QcVZYNEFoZz09I&#xA;n0=&#xA;&#xA;Note that this is just the same thing as above, with Base64 encoding. This is a bit big, and it gives me a chance to play with the Smaz library I made. The nice thing about the refactoring I made there is that we can provide our own custom term table.&#xA;In this case, the term table looks like this:&#xA;&#xA;&#xA;And with that, still using Base64, we get:&#xA;&#xA;AXICAAeTBQoLKA0NDWgsJAgNDSwmDQgMLAkKKSgsKggJDSMMK&#xA;CklCyUJBgwfFxAZCBsQFhUFhyxnLHeVVCIiAyIiAyIilS4iIi&#xA;IiIiIiBpIFjwZEB0oFNwZLBSgGTIxNjE4FSQZajE&#x2B;NUoxTjVS&#xA;NVY1WjVcFSQZZjVCNUYxYBYcsWyx3BpEFlUgQCQwZFQgbEBUO&#xA;liBSDxAVFhoGlVMQDhUIGxwZDAULFyYLlSsYJyUYC5VZJBUOl&#xA;U8hmFBRUkEXlVcrJxSVUSIQEZZDRRQplUEWECIhllBYEiEgIp&#xA;ZWTyUhlkpUGJZBRh6WPT0HAWzteBm/nZAfi4aI9mkbVowBmGV&#xA;PC0S0fXaHv1MUodMQdsS6TuuvmlU=&#xA;&#xA;This is much smaller (about 30%). And it has the property that it won&#x27;t be easily decoded by just throwing it into a Base64 decoder.&#xA;I decided to use plain hex encoding, and pretty format it, which gave me:&#xA;&#xA;0172020007 93050A0B28 0D0D0D682C 24080D0D2C&#xA;260D080C2C 090A29282C 2A08090D23 0C2829250B&#xA;2509060C1F 171019081B 1016150587 2C672C7795&#xA;5422220322 2203222295 2E22222222 2222220692&#xA;058F064407 4A0537064B 0528064C8C 4D8C4E0549&#xA;065A8C4F8D 528C538D54 8D558D568D 5705490659&#xA;8D508D518C 5805872C5B 2C77069105 954810090C&#xA;1915081B10 150E962052 0F1015161A 069553100E&#xA;15081B1C19 0C05954511 740C1C984D 4B4641270B&#xA;95560F1608 209841492F 4108962B58 0B9556120C&#xA;95590C954C 2195441695 5623954C29 2695482009&#xA;1D1C97514D 2B1117974E 492B150E96 3D3D070157&#xA;A9E859DD06 1EE0EC6210 674ED4CA88 C78FC61D20&#xA;B1650BF992 978871264B 57994E0CF3 EA99BFE9G1&#xA;&#xA;This make it look much better, I think. Even if it almost double the amount of space we take (we are still smaller than the original JSON, though). Mostly this is me playing around on Friday&#x27;s evening, to be honest. I needed something small to play with that had immediate feedback, so I started playing with this.&#xA;What do you think?</p>
        <a href="https://ayende.com/blog/173249/readability-matters" target="_blank"><h1 class="title mb-6">Readability matters</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 11, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In one of my recent posts about performance, a suggestion was raised:  Just spotted a small thing, you could optimise the call to: _buffer[pos&#x2B;&#x2B;] = (byte)&#x27;\&#x27;; with a constant as it&#x27;s always the same. There are two problems with this suggestion. Let us start with the obvious one first. Here is the disassembly of the code:  &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; b[0] = (byte) &#x27;/&#x27;;  00007FFC9DC84548&#xA0; mov&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; rcx,qword ptr [rbp&#x2B;8]&#xA0;&#xA0; 00007FFC9DC8454C&#xA0; mov&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; byte ptr [rcx],2Fh&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; b[0] = 47;  00007FFC9DC8454F&#xA0; mov&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; rcx,qword ptr [rbp&#x2B;8]&#xA0;&#xA0; 00007FFC9DC84553&#xA0; mov&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; byte ptr [rcx],2Fh&#xA0;&#xA0; As you can see, in both cases, the exact same instructions are carried out.  That is because we are no longer using compilers that had 4KB of memory to work with and required hand holding and intimate familiarity with how the specific compiler version we wrote the code for behaved.  The other problem is closely related. I&#x27;ve been working with code for the past 20 years. And while I remember the ASCII codes for some characters, when reading b[0] = 47, I would have to go and look it up. That puts a really high burden on the reader of a parser, where this is pretty much all that happens.  I recently saw it when I looked at the Smaz library. I ported that to C# and along the way I made sure that it was much more understandable (at least in my opinion). This resulted in a totally unexpected pull request that ported my C# port to Java. Making the code more readable made it accessible and possible to work with. Whereas before it was a impenetrable black box. Consider what this means for larger projects, where there are large sections that are marked with &quot;there be dragons and gnarly bugs&quot;&#x2026; This really kills systems and teams productivity. In the cas of the Smaz library port, because the code was easier to work with, Peter was able to not just port it to Java, but was able to repurpose it into a useful util for compressing mime types very efficiently.</p>
        <a href="https://ayende.com/blog/173217/ravendb-at-zap-group" target="_blank"><h1 class="title mb-6">RavenDB at ZAP Group</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 10, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We took this video a few weeks ago, tell us what you think.</p>
        <a href="https://ayende.com/blog/173186/answering-a-code-test-like-a-literature-pop-quiz" target="_blank"><h1 class="title mb-6">Answering a code test like a literature pop quiz</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 09, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We get some&#x2026; fascinating replies from candidates to our code tests. Some of them are so bad that I really wish that I could revoke some people&#x2019;s keyboard access: Case in point, we had a promising candidate from Israel&#x2019;s equivalent of MIT (Technion, which is in the top 25 engineering schools in the world). He submitted code that went something like this: var nameFirstChar = char.Parse(name.Substring(0,1).ToLower());&#xA;&#xA;switch (nameFirstChar)&#xA;{                                &#xA;    case &#x27;a&#x27;:&#xA;        using (StreamWriter indexFile = new StreamWriter(Path.Combine(basePath, &quot;Name_IndeX_A.csv&quot;), true))&#xA;        {&#xA;            indexFile.WriteLine(name);&#xA;        }&#xA;        break;&#xA;    case &#x27;b&#x27;:&#xA;        using (StreamWriter indexFile = new StreamWriter(Path.Combine(basePath, &quot;Name_IndeX_B.csv&quot;), true))&#xA;        {&#xA;            indexFile.WriteLine(name);&#xA;        }&#xA;        break;&#xA;    // ...&#xA;    // you can guess :-(&#xA;    // ...&#xA;    case &#x27;y&#x27;:&#xA;        using (StreamWriter indexFile = new StreamWriter(Path.Combine(basePath, &quot;Name_IndeX_Y.csv&quot;), true))&#xA;        {&#xA;            indexFile.WriteLine(name);&#xA;        }&#xA;        break;&#xA;    case &#x27;z&#x27;:&#xA;        using (StreamWriter indexFile = new StreamWriter(Path.Combine(basePath, &quot;Name_IndeX_Z.csv&quot;), true))&#xA;        {&#xA;            indexFile.WriteLine(name);&#xA;        }&#xA;        break;&#xA;}&#xA;&#xA;&#xA;And yes, he had the full A-Z there. This was part of a 1475 lines methods. And no, he didn&#x2019;t handle all the cases for Unicode.&#xA;Yes, he just graduated, but some things are expected. Like knowing about loops.</p>
        <a href="https://enterprisecraftsmanship.com/posts/specification-pattern-c-implementation/" target="_blank"><h1 class="title mb-6">Specification pattern: C# implementation</h1></a>
        <p class="mb-2">by Vladimir Khorikov</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 08, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The topic described in this article is a part of my Specification Pattern in C#&#xA0;Pluralsight course.&#xA; Specification pattern is not a new topic, there are many of its implementations on the Internet already. In this post, I&#x2019;d like to discuss the use cases for the pattern and compare several common implementations to each other.&#xA;  1. Specification pattern: what&#x2019;s that? Specification pattern is a pattern that allows us to encapsulate some piece of domain knowledge into a single unit - specification - and reuse it in different parts of the code base.</p>
        <a href="https://ayende.com/blog/173185/dynamic-code-generation-in-c" target="_blank"><h1 class="title mb-6">Dynamic code generation in C#</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 08, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Let us assume that we have the following simple task:  Given a Dictionary&lt;string, string&gt;, convert that dictionary into a type in as performant a manner as possible. The conversion will happen many time, and first time costs are acceptable. The answer we came up with is to dynamically generate the code based on the type. Basically, here is how it looks like: public static Func&lt;Dictionary&lt;string, string&gt;, T&gt; Generate&lt;T&gt;()&#xA;    where T : new()&#xA;{&#xA;    var dic = Expression.Parameter(typeof (Dictionary&lt;string, string&gt;), &quot;dic&quot;);&#xA;    var tmpVal = Expression.Parameter(typeof (string), &quot;tmp&quot;);&#xA;    var args = new List&lt;MemberAssignment&gt;();&#xA;    foreach (var propertyInfo in typeof(T).GetProperties())&#xA;    {&#xA;        var tryGet = Expression.Call(dic, &quot;TryGetValue&quot;, new Type[0], &#xA;            Expression.Constant(propertyInfo.Name),&#xA;            tmpVal);&#xA;&#xA;        Expression value = tmpVal;&#xA;        if (propertyInfo.PropertyType != typeof (string))&#xA;        {&#xA;            var convertCall = Expression.Call(typeof(Convert).GetMethod(&quot;ChangeType&quot;, &#xA;                new Type[] { typeof(object), typeof(Type) }), tmpVal,&#xA;                Expression.Constant(propertyInfo.PropertyType));&#xA;            value = Expression.Convert(convertCall, propertyInfo.PropertyType);&#xA;        }&#xA;&#xA;        var conditional = Expression.Condition(tryGet, value, &#xA;            Expression.Default(propertyInfo.PropertyType));&#xA;&#xA;        args.Add(Expression.Bind(propertyInfo, conditional));&#xA;        &#xA;    }&#xA;    var newExpression = Expression.New(typeof(T).GetConstructor(new Type[0]));&#xA;&#xA;    var expression = Expression.Lambda&lt;Func&lt;Dictionary&lt;string, string&gt;, T&gt;&gt;(&#xA;        Expression.Block(new[] { tmpVal },Expression.MemberInit(newExpression,args)),&#xA;        dic);&#xA;&#xA;    return expression.Compile();&#xA;}&#xA;&#xA;&#xA;&#xA;As an aside, this is an intimidating piece of code, but that is about bazillion time better than having to do this manually using IL manipulations.&#xA;What this code does is dynamically generate the following method:&#xA;(Dictionary&lt;string,string&gt; dic) =&gt; {&#xA;    string tmp;&#xA;    return new User&#xA;    {&#xA;        Name = dic.TryGetValue(&quot;Name&quot;, out tmp) ? tmp : default(string),&#xA;        Age = dic.TryGetValue(&quot;Age&quot;, out tmp) ? (int)Convert.ChangeType(tmp, typeof(int)) : default(int)&#xA;    };&#xA;}&#xA;&#xA;&#xA;This is pretty much the fastest way to do this, because this is how you would write it manually. And compiling the expression dynamically means that we don&#x2019;t have to do this for each and every type we run into.</p>
        <a href="https://ayende.com/blog/173025/production-postmortem-a-null-reference-in-our-abstraction" target="_blank"><h1 class="title mb-6">Production postmortem</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 05, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This little nugget has caused a database upgrade to fail. Consider the following code for a bit. We have CompoundKey, which has two versions, slow and fast. The idea is that we use this as keys into a cache, and there are two types because we can &#x201C;query&#x201D; the cache cheaply, but constructing the actual key for the cache is more expensive. Hence, the names. public class CompoundKey&#xA;{&#xA;    public int HashKey;&#xA;&#xA;}&#xA;&#xA;public sealed class FastCompoundKey : CompoundKey&#xA;{&#xA;    public int Val;&#xA;&#xA;}&#xA;&#xA;public sealed class SlowCompoundKey : CompoundKey&#xA;{&#xA;    public int SlowVal;&#xA;&#xA;}&#xA;public class CompoundKeyEqualityComparer : IEqualityComparer&lt;CompoundKey&gt;&#xA;{&#xA;    [MethodImpl(MethodImplOptions.AggressiveInlining)]&#xA;    public bool Equals(CompoundKey x, CompoundKey y)&#xA;    {&#xA;        if (x == null || y == null)&#xA;            return false;&#xA;&#xA;        SlowCompoundKey k;&#xA;        FastCompoundKey self;&#xA;        var key = x as FastCompoundKey;&#xA;        if (key != null)&#xA;        {&#xA;            self = key;&#xA;            k = y as SlowCompoundKey;&#xA;        }&#xA;        else&#xA;        {&#xA;            self = y as FastCompoundKey;&#xA;            k = x as SlowCompoundKey;&#xA;        }&#xA;&#xA;        return self.Val == k.SlowVal;&#xA;    }&#xA;&#xA;    [MethodImpl(MethodImplOptions.AggressiveInlining)]&#xA;    public int GetHashCode(CompoundKey obj)&#xA;    {&#xA;        return obj.HashKey;&#xA;    }&#xA;}&#xA;&#xA;&#xA;The problem was a null reference exception in the Equals method.&#xA0; And I believe the term for how I felt was:&#xA;&#xA;The problem is that it is obvious why a null reference exception can be thrown. If the values passed to this method are both SlowCompoundKey or both FastCompoundKey. But the reason the Equals method looks the way it does is that this is actually in a very performance sensitive portion of our code, and we have worked to make sure that it runs as speedily as possible. We considered the case where we would have both of them, but the code had a measured performance impact, and after checking the source of the dictionary class, we were certain that such comparisons were not possible.&#xA;We were wrong.&#xA;Boiling it all down, here is how we can reproduce this issue:&#xA; var dic = new Dictionary&lt;CompoundKey, object&gt;(new CompoundKeyEqualityComparer());&#xA; dic[new SlowCompoundKey { HashKey = 1 }] = null;&#xA; dic[new SlowCompoundKey { HashKey = 1 }] = null;&#xA;&#xA;&#xA;&#xA;What is going on here?&#xA;Well, it is simple. We add another value with the same hash code. That mean that the dictionary need to check if they are the same value, or just a hash collision. It does so by passing both the first key (slow) and the second key (slow) into the Equals method, and then hilarity enthused.&#xA;In retrospect, this is pretty much how it has to behave, and we should have considered that, but we were focused on looking at just the read side of the operation, and utterly forgot about how insert must work.&#xA;Luckily, this was an easy fix, although we still need to do regressive perf testing.</p>
        <a href="https://ardalis.com/speed-up-visual-studio-build-times/" target="_blank"><h1 class="title mb-6">Speed Up Visual Studio Build Times</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 04, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Although compiling is still the #1 programmer excuse for slacking off, you still probably don&#x2019;t want to spend more time on it than you&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ayende.com/blog/173121/good-fast-pretty-code-how-to-choose" target="_blank"><h1 class="title mb-6">Good, fast, pretty code: How to choose?</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 04, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I have a piece of code that does something on types. It is a whole complex thing that does a lot of stuff. And the code is really ugly, here is a small part from ~180 lines method.   The problem would have been much simpler if we could only switch on types, which is effectively what I want to do here. As it stands, however, the JIT is actually going to replace all those if statements with pointer comparisons to the method table, so this is pretty fast. Unpleasant to read, but really fast. I decided to see what it would take to create a more readable version:  public class TypeCounter&#xA;{&#xA;    public int Long;&#xA;&#xA;    public Dictionary&lt;Type, Action&lt;object&gt;&gt; Actions;&#xA;&#xA;    public TypeCounter()&#xA;    {&#xA;        Actions = new Dictionary&lt;Type, Action&lt;object&gt;&gt;&#xA;        {&#xA;            [typeof(long)] = o =&gt; Long&#x2B;&#x2B;,&#xA;            [typeof(int)] = o =&gt; Long&#x2B;&#x2B;,&#xA;        };&#xA;    }&#xA;    public void Dic(object instance)&#xA;    {&#xA;        if (instance == null)&#xA;            return;&#xA;        Action&lt;object&gt; value;&#xA;        if (Actions.TryGetValue(instance.GetType(), out value))&#xA;            value(instance);&#xA;&#xA;    }&#xA;    public void Explicit(object instance)&#xA;    {&#xA;        if (instance is int)&#xA;            Long&#x2B;&#x2B;;&#xA;        else if (instance is long)&#xA;            Long&#x2B;&#x2B;;&#xA;    }&#xA;}&#xA;&#xA;This is just a simpler case of the code above, focused on just the two options. The dictionary version is much more readable, especially once you get to more than a couple of types. The problem, I have tested this on both this two types option as well as 10 types, and in all cases, the explicit version is about twice as fast. &#xA;So this rules it out, and we are left with the sad looking code that can run.</p>
        <div class="button flex justify-between">
            <a href="317.html"><span class="back arrow"></span></a>

            <a href="319.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>