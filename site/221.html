
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Home â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<script>
    const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

    function getUserPref() {
        const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
        return storedTheme || (lightModePref.matches ? "light" : "dark");
    }

    function setTheme(newTheme) {
        if (newTheme !== "light" && newTheme !== "dark") {
            return console.warn(
                `Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
            );
        }

        const root = document.documentElement;

        // root already set to newTheme, exit early
        if (newTheme === root.getAttribute("data-theme")) {
            return;
        }

        root.setAttribute("data-theme", newTheme);

        const colorThemeMetaTag = document.querySelector("meta[name='theme-color']");
        const bgColour = getComputedStyle(document.body).getPropertyValue("--theme-bg");
        colorThemeMetaTag.setAttribute("content", `hsl(${bgColour})`);
        if (typeof localStorage !== "undefined") {
            localStorage.setItem("theme", newTheme);
        }
    }

    // initial setup
    setTheme(getUserPref());

    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("theme-toggle").addEventListener("click", () => {
            const theme = localStorage.getItem("theme");

            if (theme === "dark") {
                setTheme("light");
            } else {
                setTheme("dark");
            }
        });

        document.getElementById("toggle-navigation-menu").addEventListener("click", (e) => {
            const button = e.target;
            const ariaExpanded = button.getAttribute("aria-expanded");
            const header = document.getElementById("main-header");

            if (ariaExpanded === "true") {
                button.setAttribute("aria-expanded", "false");
                header.classList.remove("menu-open");
            } else {
                button.setAttribute("aria-expanded", "true");
                header.classList.add("menu-open");
            }
        });
    });
</script>

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <theme-toggle class="ms-auto">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main">
    <section aria-label="Blog post list">
        <a href="https://ayende.com/blog/173537/the-cost-of-dog-fooding" target="_blank"><h1 class="title mb-6">The cost of dog fooding</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: March 01, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">You might have noticed that there we a few errors on the blog recently.  That is related to a testing strategy that we employ for RavenDB. In particular, part of our test scenario is to shove a RavenDB build to our own production system, to see how it works in a live production system with real workloads. Our production systems are entirely running on RavenDB, and we have been playing with all sort of configuration and deployment options recently. The general idea is to give us good indication about the performance of RavenDB and make sure that we don&#x2019;t have any performance regression. Here is an example taken from our tracking system, for this blog:  You can see that we had a few periods with longer than usual response times. The actual reason for that was that we had some code that was throwing tremendous amount of work to RavenDB, and this is actually exhibiting noisy neighbor syndrome in this case (that is, the blog is behaving fine, but the machine it is on is very busy). That gave us indication about a possible optimization and some better internal metrics. At any rate, the downside of living on the bleeding edge in production is that we sometimes get a lemon build. That is the cost of dog fooding, something you need to clean up the results.</p>
        <a href="https://www.stevejgordon.co.uk/contributing-to-allready" target="_blank"><h1 class="title mb-6">Contributing to allReady</h1></a>
        <p class="mb-2">by Steve Gordon</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 29, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post I want to discuss a fantastic open source project called allReady that I highly encourage all ASP.NET developers to check out. I want to share my early experience with allReady and how I got started with contributing to an open source project for the first time. What is allReady? allReady is project [&#x2026;]</p>
        <a href="https://enterprisecraftsmanship.com/posts/mechanical-approach-to-domain-modeling/" target="_blank"><h1 class="title mb-6">Mechanical approach to domain modeling</h1></a>
        <p class="mb-2">by Vladimir Khorikov</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 29, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post, I&#x2019;d like to talk about a mechanical approach to domain modeling. It sometimes arises when teams start applying Domain-Driven Design (DDD) principles to their projects and when they don&#x2019;t have enough experience with it yet.</p>
        <a href="https://ayende.com/blog/173505/find-the-bug-when-you-cant-rely-on-your-own-identity" target="_blank"><h1 class="title mb-6">Find the bug</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 29, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We had a need to generate unique ids for connections in our db. We used the following code:  public class NotificationsClientConnection : IDisposable&#xA;{&#xA;    private static int _counter = 0;&#xA;&#xA;    private readonly WebSocket _webSocket;&#xA;    private readonly DocumentDatabase _documentDatabase;&#xA;    private readonly DateTime _startedAt;&#xA;&#xA;&#xA;    public NotificationsClientConnection(WebSocket webSocket, DocumentDatabase documentDatabase)&#xA;    {&#xA;        _webSocket = webSocket;&#xA;        _documentDatabase = documentDatabase;&#xA;        _startedAt = SystemTime.UtcNow;&#xA;    }&#xA;&#xA;    public int Id =&gt; Interlocked.Increment(ref _counter);&#xA;&#xA;    public TimeSpan Age =&gt; SystemTime.UtcNow - _startedAt;&#xA;}&#xA;&#xA;Do you see the bug? It is a subtle one.&#xA;When you are ready, peek below.&#xA;&#xA;.&#xA;.&#xA;.&#xA;.&#xA;.&#xA;.&#xA;.&#xA;.&#xA;.&#xA;.&#xA;.&#xA;.&#xA;.&#xA;The issue is in the following line:&#xA;&#xA;    public int Id =&gt; Interlocked.Increment(ref _counter);&#xA;&#xA;&#xA;The intent was to create a field that would be initialized on startup. Unfortunately, the usage of the lambda symbol &quot;=&gt;&quot; instead of assignment &quot;=&quot; turned that into a computed property, which will return a new value on every call.</p>
        <a href="https://ardalis.com/custom-software-craftsmanship-workshop/" target="_blank"><h1 class="title mb-6">Custom Software Craftsmanship Workshop</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 26, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Last month I was invited to put on a customized workshop for one of my mentoring clients. The group included developers, testers, and&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ayende.com/blog/173474/optimal-compression-rate" target="_blank"><h1 class="title mb-6">Optimal compression rate</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 26, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In the new blittable format we use in RavenDB, we make heavy use of compression to reduce the size of documents.  Compression has an unfortunate problem, though. It doesn&#x27;t work for all inputs. The proof of that is a very neat one:  We have a set of compression / decompression function: compress(plainText) &#x2013;&gt; compressedText and decompress(compressedText) &#x2013;&gt; plainText.  Those are lossless functions, that is, for any input decompress( compress(X) ) == X Let us assume that for any input, size(plainText) &gt; size(compressedText) But that causes a problem. Let us assume that our plain text size is N, and that the compression algorithm reduce that size by just one bit, so the size of the compressedText is N-1. We&#x27;ll compress all possible permutations of N bits using this algorithm. Given that the compression results in at least N-1&#xA0; bits, there must now be two different values of the plainText that result in the same compressedText. That breaks the ability to decompress them successfully. Because there isn&#x27;t a one to one mapping between them. Common compression algorithms rely on the source data to either have repetitions (LZ derivatives) or are based on shared dictionaries that match a particular set of data.  In practice, this has real world implications when you are designing a data format. For example, the blittable format compress strings using two different algorithms. For large strings, we use LZ4, because it has much higher compression rate and doesn&#x27;t require any special knowledge of the data. For small strings, we use a Smaz variants, which is a shared dictionary of common terms. Because the dictionary is small, we can&#x27;t put a lot of data into it, so we concentrated on common Latin character sequences. That means that if you are trying to compress a Unicode string like:   &#x5E8;&#x5D5;&#x5D7; &#x5E6;&#x5E4;&#x5D5;&#x5E0;&#x5D9;&#x5EA; You are going to use up more bytes than the original plain text. This is easy to experiment with using Smaz variant, because it is very simple. But it also happens using LZ4 for certain inputs.  That causes a problem for the blittable format, because we want to compress the data, but for certain inputs, that means that we are going to get more data. We solved that by doing conditional compression. We designate a buffer that is smaller than the plain text that we are compressing (this reflect the maximum amount of compression that is valuable for us), and compress to that buffer. If the compression routine was unable to compress to that buffer (because it needed more space), we fail the compression, and just store the plain text. Now we have an optimal compression rate, this is going to always be equal to or (hopefully usually) smaller than the original text.</p>
        <a href="https://ayende.com/blog/173473/fun-async-tricks-for-getting-better-performance" target="_blank"><h1 class="title mb-6">Fun async tricks for getting better performance</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 25, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I got into a discussion with Mark about the usefulness of async. In particular, Mark said:  Sync will always have less CPU usage because of less kernel transitions, less allocation, less synchronization. &#x2026; This effect only comes into play when after issuing the IO the thread pool can immediately process a queued task. This is only the case when the CPU is highly saturated. At 90% saturation you have a good chance that this is happening. But nobody runs their production systems that way. And while this is sort of correct, in the sense that a major benefit of async is that you free the working thread for someone else to work on, and that this is typically mostly useful under very high load, async is most certainly not useful just for high throughput situations. The fun part about having async I/O is the notion of interleaving both I/O and computation together. Mark assumes that this is only relevant if you have high rate of work, because if you are starting async I/O, you have to wait for it to complete before you can do something interesting, and if there isn&#x27;t any other task waiting, you are effectively blocked.  But that doesn&#x27;t have to be the case. Let us take the following simple code. It isn&#x27;t really doing something amazing, it is just filtering a text file:  public void FilterBadWords(string intputFile, string outputFile)&#xA;{&#xA;    var badWords = new[] { &quot;opps&quot;, &quot;blah&quot;, &quot;dang&quot; };&#xA;&#xA;    using (var reader = File.OpenText(intputFile))&#xA;    using (var writer = File.AppendText(outputFile))&#xA;    {&#xA;        string line;&#xA;        while ((line = reader.ReadLine()) != null)&#xA;        {&#xA;            bool hasBadWord = false;&#xA;            foreach (var word in badWords)&#xA;            {&#xA;                if (line.IndexOf(word, StringComparison.OrdinalIgnoreCase) != -1)&#xA;                {&#xA;                    hasBadWord = true;&#xA;                    break;&#xA;                }&#xA;            }&#xA;&#xA;            if(hasBadWord == false)&#xA;                writer.WriteLine(line);&#xA;        }&#xA;    }&#xA;}&#xA;&#xA;&#xA;Here is the async version of the same code:&#xA;&#xA;public async Task FilterBadWords(string intputFile, string outputFile)&#xA;{&#xA;    var badWords = new[] { &quot;opps&quot;, &quot;blah&quot;, &quot;dang&quot; };&#xA;&#xA;    using (var reader = File.OpenText(intputFile))&#xA;    using (var writer = File.AppendText(outputFile))&#xA;    {&#xA;        string line;&#xA;        while ((line = await reader.ReadLineAsync()) != null)&#xA;        {&#xA;            bool hasBadWord = false;&#xA;            foreach (var word in badWords)&#xA;            {&#xA;                if (line.IndexOf(word, StringComparison.OrdinalIgnoreCase) != -1)&#xA;                {&#xA;                    hasBadWord = true;&#xA;                    break;&#xA;                }&#xA;            }&#xA;&#xA;            if(hasBadWord == false)&#xA;                await writer.WriteLineAsync(line);&#xA;        }&#xA;    }&#xA;}&#xA;&#xA;&#xA;If we&#x27;ll assume that we are running on a slow I/O system (maybe large remote file), in both version of the code, we&#x27;ll see execution pattern like so:&#xA;&#xA;&#xA;In the sync case, the I/O is done in a blocking fashion, in the async case, we aren&#x27;t holding up a thread ,but the async version need to do a more complex setup, so it is likely to be somewhat slower.&#xA;But the key is, we don&#x27;t have to write the async version in this manner. Consider the following code:&#xA;&#xA; public async Task FilterBadWords(string intputFile, string outputFile)&#xA; {&#xA;     var badWords = new[] { &quot;opps&quot;, &quot;blah&quot;, &quot;dang&quot; };&#xA;&#xA;     using (var reader = File.OpenText(intputFile))&#xA;     using (var writer = File.AppendText(outputFile))&#xA;     {&#xA;         var lineTask = reader.ReadLineAsync();&#xA;         Task writeTask = Task.CompletedTask;&#xA;         while (true)&#xA;         {&#xA;             var currentLine = await lineTask;&#xA;             await writeTask;&#xA;             if (currentLine == null)&#xA;                 break;&#xA;             lineTask = reader.ReadLineAsync();&#xA;&#xA;             bool hasBadWord = false;&#xA;             foreach (var word in badWords)&#xA;             {&#xA;                 if (currentLine.IndexOf(word, StringComparison.OrdinalIgnoreCase) != -1)&#xA;                 {&#xA;                     hasBadWord = true;&#xA;                     break;&#xA;                 }&#xA;             }&#xA;&#xA;             if(hasBadWord == false)&#xA;                 writeTask = writer.WriteLineAsync(currentLine);&#xA;         }&#xA;     }&#xA; }&#xA;The execution pattern of this code is going to be:&#xA;&#xA;&#xA;The key point is that we start async I/O, but we aren&#x27;t going to await of it immediately. Instead, we are going to do some other work first (processing the current line while we fetch &amp; write the next line). &#xA;In other words, when we schedule the next bit of I/O to be done, we aren&#x27;t going to ask the system to find us some other piece of work to execute, we are the next piece of work to execute. &#xA;&#xA;Nitpicker corner: This code isn&#x27;t actually likely to have this usage pattern, this code is meant to illustrate a point.</p>
        <a href="https://ardalis.com/configure-nlog-to-log-application-specific-data/" target="_blank"><h1 class="title mb-6">Configure NLog to Log Application-Specific Data</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 24, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">NLog is one of my favorite .NET loggers. It has a bunch of great features, is easy to configure via a config file or programmatically, and&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ayende.com/blog/173441/the-cost-of-routing-in-nancyfx" target="_blank"><h1 class="title mb-6">The cost of routing in NancyFX</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 24, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I got the following feedback on this post on Twitter.   Using trie for routing isn&#x27;t new by a long shot. It is a fairly obvious optimization. But not all tries are equal to one another. I decided to see what it would look like using Nancy. Here is the code I run:   class Program&#xA; {&#xA;     static void Main(string[] args)&#xA;     {&#xA;         using (var host = new NancyHost(new Uri(&quot;http://localhost:8080&quot;)))&#xA;         {&#xA;             host.Start();&#xA;             Console.ReadLine();&#xA;         }&#xA;     }&#xA; }&#xA;&#xA; public class SampleModule : Nancy.NancyModule&#xA; {&#xA;     public SampleModule()&#xA;     {&#xA;         Get[&quot;/&quot;] = _ =&gt; &quot;Hello World!&quot;;&#xA;     }&#xA; }&#xA;&#xA;&#xA;And like before, we tested this by running it in Release mode using the following gobench command:&#xA;&#xA;.\gobench.exe -c 100 -r 25000 -u http://localhost:8080/&#xA;The results weren&#x27;t good.&#xA;&#xA;Requests:                          2,500,000 hits&#xA;Successful requests:               2,500,000 hits&#xA;Network failed:                            0 hits&#xA;Bad requests failed (!2xx):                0 hits&#xA;Successful requests rate:             23,364 hits/sec&#xA;Read throughput:                   3,785,046 bytes/sec&#xA;Write throughput:                  2,009,345 bytes/sec&#xA;Test time:                               107 sec&#xA;&#xA;On the same machine, similar tests using WebAPI gave me a 56,818 hits/sec and using my routing trie we get 86,206 hits/sec. Nancy also seems to be using a lot more CPU than the other two solutions.&#xA;Now, we could leave it like that, but that wouldn&#x27;t be fair. Let us dig a little bit further and see if we can figure out what is costing us there?&#xA;I run the same scenario under the profiler, and we got some interesting results.&#xA;&#xA;In terms of percentage, it compares favorably to my trie&#x27;s results. 1.91% compared to 1.02%. But it terms of absolute time (same load, both running under the profiler), we see 64.7 seconds for 2.5 million routes in the nancy implementation vs. 2.2 seconds for 2.5 million routes in my implementation. We&#x27;ll ignore the rest of the costs of Nancy, because there is quite a lot here that doesn&#x27;t matter. Let us focus specifically on the routing trie, shall we?&#xA;&#xA;Now, here is the really sad thing. This is running under a profiler, which slows things down tremendously.&#xA;Under those conditions, this code still manage to process a route in just 25 &#x3BC;s. That is pretty awesome, regardless of how you look at it. And for the vast majority of applications, that is way more than what you&#x27;ll see in most applications. The moment you start actually doing stuff, you aren&#x27;t even in the same territory. But one of the things that we have been focusing on is the need to speed RavenDB up by [not ready to divulge yet, but let us say&#x2026; a lot]. So we pay attention to every little bit.&#xA;Now, let us look in detail on this code in GetMatches, which at the time of this writing looked something like this:&#xA;&#xA;return this.routeTries[method].GetMatches(path.Split(splitSeparators, StringSplitOptions.RemoveEmptyEntries), context)&#xA;                                          .ToArray();&#xA;&#xA;I&#x27;m actually going to ignore the code we see here and just talk about the profiler output, because in this case, the code is misleading.&#xA;We can see a whole bunch of things that would fail our current code review. Here is a commonly called method that does a whole bunch of expensive allocations.&#xA;On each call, we:&#xA;&#xA;Split the string &#x2013; which is both expensive in computation&#xA0; and creates multiple sub strings and the array to contain them.&#xA;Create two dictionaries:&#xA;&#xA;one is done inside the TrieNode.GetMatches call:return this.GetMatches(segments, 0, new Dictionary&lt;string, object&gt;(this.AdditionalParameters), context);&#xA;one is done inside the TrieNode.BuildResults call:&#xA;&#xA;var parameters = new Dictionary&lt;string, object&gt;(capturedParameters);&#xA;Call ToArray &#x2013; which create another allocation for the results.&#xA;Uses Any &amp; Select &#x2013; which often requires allocation of a lambda instance.&#xA;There are also the dictionary lookup (which is actually done twice, once using ConstainsKey, then using the indexer):&#xA;&#xA;if (!this.routeTries.ContainsKey(method))&#xA;{&#xA;    return MatchResult.NoMatches;&#xA;}&#xA;&#xA;return this.routeTries[method] /* removed for clarity */;&#xA;Note that just replacing this with a TryGetValue is likely to give us about 8% improvement in this method.&#xA;It actually gets better, looking at the code, it looks like we hit the code path for the root route, while other routes need to do more work. I changed the route to be Get[&quot;/values&quot;], and run the benchmark under profiler again.&#xA;The only change I made is that now I have a non root route, the cost for routing is up by about 75%:&#xA;&#xA;&#xA0;&#xA;Now, I&#x27;m being utterly unfair here. NancyFX actually has a really sophisticated routing system, it does a lot. I mean, really a lot. &#xA;My routing trie, on the other hand, is intentionally dumb and require the request handling code to participate in some decisions. This is done intentionally, because it gives me the chance to do a whole bunch of optimizations cheaply. To start with, I don&#x27;t need to do any allocations whatsoever throughout the call, and the request handling code can also skip string allocations in most cases.&#xA;This isn&#x27;t an issue of algorithms. It is an issue of what you are trying to do.&#xA;For comparisons, doing the same amount of work in my current version (which was even further optimized), give us this:&#xA;&#xA;You can see what the cost of routing is for us. While the optimized root route cost for Nancy is 25 &#x3BC;s, we are able to route the request in 0.23 &#x3BC;s, that is two orders of magnitudes faster. My entire routing cost can fit 10 times in the cost of a single dictionary lookup in the NancyFX case.&#xA;So, to answer the original question, no, I really couldn&#x27;t just use NancyFX code to get &quot;this optimization&quot;. The algorithm is important, but the actual implementation details are far more interesting and relevant.</p>
        <a href="https://ayende.com/blog/173409/ravendb-passed-half-a-million-downloads" target="_blank"><h1 class="title mb-6">RavenDB passed half a million downloads</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 23, 2016
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We just noticed:</p>
        <div class="button flex justify-between">
            <a href="220.html"><span class="back arrow"></span></a>

            <a href="222.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
</body>
</html>