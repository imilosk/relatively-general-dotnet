
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 557 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-5561">
            <a href="https://ayende.com/blog/4259/core-nhibernate-persistence-with-nhibernate-coming-to-paris" target="_blank">
                <h2 class="title mb-6" id="article-5561">Core NHibernate</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 22, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">My 3 days course about NHibernate will be delivered at Paris , on 04 Nov 2009 by Sebastien Lambla.  This course is squeezing into 3 days everything that you need to go from an NHibernate newbie to a proficient craftsman.   An interesting tidbit, the last time that Sebastien gave the course, I got amazing feedback about the course.  You can register here.</p>
        </article>
        <article id="article-5562">
            <a href="https://ayende.com/blog/4258/challenge-can-you-spot-the-bug" target="_blank">
                <h2 class="title mb-6" id="article-5562">Challenge</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 21, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I have this piece of code:          public static string FirstCharacters(this string self, int numOfChars)&#xA;{&#xA;    if (self == null)&#xA;        return &quot;&quot;;&#xA;    if (self.Length &lt; numOfChars)&#xA;        return self;&#xA;    return self&#xA;        .Replace(Environment.NewLine, &quot; &quot;)&#xA;        .Substring(0, numOfChars - 3) &#x2B; &quot;...&quot;;&#xA;}&#xA;  &#xA;&#xA;&#xA;And the following exception was sent to me:&#xA;&#xA;&#xA;  &#xA;    System.ArgumentOutOfRangeException: Index and length must refer to a location within the string.&#xA;Parameter name: length&#xA;  at System.String.InternalSubStringWithChecks(Int32 startIndex, Int32 length, Boolean fAlwaysCopy)&#xA;  at StringExtensions.FirstCharacters(String self, Int32 numOfChars)&#xA;  &#xA;&#xA;&#xA;It actually took me a while to figure out what is going on. Partly that is because we have an &#x201C;impossible&#x201D; stack trace (the JIT seems to have inlined the Substring call). When I did figure what the bug was, i is a head slapping moment.</p>
        </article>
        <article id="article-5563">
            <a href="https://ardalis.com/a-first-pass-at-potterkata/" target="_blank">
                <h2 class="title mb-6" id="article-5563">A First Pass at PotterKata</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 20, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Tonight at Hudson Software Craftsmanship, I paired with another group member and worked on the PotterKata for the first time. I&#x2019;d seen&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-5564">
            <a href="https://ayende.com/blog/4257/jaoo-more-on-evolving-the-key-value-programming-model-to-a-higher-level-from-billy-newport" target="_blank">
                <h2 class="title mb-6" id="article-5564">JAOO</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 20, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">As I already mentioned, this presentation had me thinking. Billy presented a system called Redis, which is a Key/Value store which is intended for an attribute based storage.  That means that storing something like User { Id = 123, Name = &#x201C;billy&#x201D;, Email = &#x201C;billy@example.org&#x201D;} is actually stored as:          { &quot;uid:123:name&quot;: &quot;billy&quot; } &#xA;{ &quot;uid:123:email&quot;: &quot;billy@example.org&quot; }&#xA;{ &quot;uname:billy&quot;: &quot;123&quot; } &#xA;  &#xA;&#xA;&#xA;Each of those lines represent a different key/value pair in the Redis store. According to Billy, this has a lot of implications. On the advantage side, you get no schema and very easy support for just adding stuff as you go along. On the other hand, Redis supports not transactions and it is easy to &#x201C;corrupt&#x201D; the database during development (usually as a result of a programming bug).&#xA;&#xA;What actually bothered me the most was the implications on the number of remotes calls that are being made. The problem shows itself very well in this code sample, (a twitter clone), which show inserting a new twit:&#xA;&#xA;&#xA;  &#xA;    long postid = R.str_long.incr(&quot;nextPostId&quot;); &#xA;long userId = PageUtils.getUserID(request); &#xA;long time = System.currentTimeMillis(); &#xA;string post = Long.toString(userId)&#x2B;&quot;|&quot; &#x2B; Long.toString(time)&#x2B;&quot;|&quot;&#x2B;status; &#xA;R.c_str_str.set(&quot;p:&quot;&#x2B;Long.toString(postid), post);&#xA;List&lt;long&gt; followersList = R.str_long.smembers(Long.toString(userId)&#x2B;&quot;:followers&quot;); &#xA;if(followersList == null) &#xA;   followersList - new ArrayList&lt;Long&gt;(); &#xA;HashSet&lt;long&gt; followerSet = new HashSet&lt;long&gt;(followersList); &#xA;followerSet.add(userid); &#xA;long replyId = PageUtils.isReply(status); &#xA;if(replyId != -1) &#xA;   followerSet.add(replyId); &#xA;for(long i : followerSet) &#xA;    R.str_long.lpush(Long.toString(i)&#x2B;&quot;:posts&quot;, postid); &#xA;// -1 uid is global timeline &#xA;String globalKey = Long.toString(-l)&#x2B;&quot;:posts&quot;; &#xA;R.str_long.lpush(globalKey,postid); &#xA;R.str_long.ltrim(globolKey, 200);&#xA;  &#xA;&#xA;&#xA;I really don&#x2019;t like the API, mostly because it reminds me of C, but the conventions are pretty easy to figure out. &#xA;&#xA;&#xA;  R is the static gateway into the Redis API&#xA;&#xA;  str_long = store ong&#xA;&#xA;  c_str_str &#x2013; store string and keep it in nearby cache&#xA;&#xA;&#xA;The problem with this type of code is the number of remote calls and the locality of those calls. With a typical sharded set of servers, you are going to have lots of calls going all over the place. And when you get into people that have thousands and millions of followers, the application is simply going to die.&#xA;&#xA;A better solution is required. Billy suggested using async programming or sending code to the data store to execute there.&#xA;&#xA;I have a different variant on the solution.&#xA;&#xA;We will start from the assumption that we really want to reduce remote calls, and that the system performance in the face of large amount of writes (without impacting reads) is important. The benefits of using something like Redis is that it is very easy to get started, very easy to change things around and great for rapid development mode. We want to keep that for now, so I am going to focus on a solution based on the same premise.&#xA;&#xA;The first thing to go is the notion that a key can sit anywhere that it wants. In a key/value store, it is important to be able to control locality of reference. We change the key format so it is now: [server key]@[local key]. What does this mean? It means that for the previously mentioned user, this is the format it will be stored as:&#xA;&#xA;&#xA;  &#xA;    { &quot;uid:123@name&quot;: &quot;billy&quot; } &#xA;{ &quot;uid:123@email&quot;: &quot;billy@example.org&quot; }&#xA;{ &quot;uname@billy&quot;: &quot;123&quot; } &#xA;  &#xA;&#xA;&#xA;We use the first part of the key (before the @) to find the appropriate server. This means that everything with a prefix of &#x201C;uid:123&#x201D; is known to reside on the same server. This allow you to do things like transactions on a single operation of setting multiple keys.&#xA;&#xA;Once we have that, we can start adding to the API. Instead of getting a single key at a time, we can get a set of values in one remote call. That has the potential of significantly reducing the number of remote calls we will make.&#xA;&#xA;Next, we need to consider repeated operations. By that I mean anything where we have a look in which we call to the store. That is a killer when you are talking about any data of significant size. We need to find a good solution for this.&#xA;&#xA;Billy suggested sending JRuby script to the server (or similar) and executing it there, saving the network roundtrips. Which this is certainly possible, I think it would be a mistake. I have a much simpler solution. Teach the data store about repeated operations. Let us take as a good example the copying that we are doing of a new twit to all your followers. Instead of reading the entire list of followers into memory, and then writing the status to every single one of them, let us do something different:&#xA;&#xA;&#xA;  &#xA;    Redis.PushToAllListFoundIn(&quot;uid:&quot;&#x2B;user_id&#x2B;&quot;@followers&quot;, status, &quot;{0}@posts&quot;);&#xA;  &#xA;&#xA;&#xA;I am using the .NET conventions here because otherwise I would go mad. As you can see, we instruct Redis to go to a particular list, and copy the status that we pass it to all the keys found in the list ( after formatting the key with the pattern). This gives the data store enough information about this to be able to optimize this operation considerably.&#xA;&#xA;With just these few changes, I think that you gain enormously, and you retain the very simple model of using a key/value store.</p>
        </article>
        <article id="article-5565">
            <a href="https://ardalis.com/which-visual-studio-2010-is-team-suite/" target="_blank">
                <h2 class="title mb-6" id="article-5565">Which Visual Studio 2010 is Team Suite?</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 19, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The new VS 2010 has a new lineup of versions which you can find described on the Visual Studio 2010 Products page. Some things to note&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-5566">
            <a href="https://ayende.com/blog/4256/rant-compilers-parsers" target="_blank">
                <h2 class="title mb-6" id="article-5566">Rant</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 19, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is just something that really annoys me. There is a common misconception that compilers are mostly about parsing the code. This couldn&#x2019;t be further from the truth. About the easiest step in building a compiler is parsing the text into some form of machine readable format. There are great tools to help you there, and a lot of information.   It is the next stage that is complex, taking the machine readable format (AST) and turning that into executable. There is a lot less information about that, and that tends to be a pretty gnarly sort of a problem.  As the title says, this post is here just to make sure that people distinguish between the two.</p>
        </article>
        <article id="article-5567">
            <a href="https://ayende.com/blog/4255/linqtosql-profiler-nhibernate-profiler-what-is-happening" target="_blank">
                <h2 class="title mb-6" id="article-5567">LinqToSql Profiler &amp; NHibernate Profiler &#x2013; What is happening?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 18, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">About two weeks ago I posted my spike results of porting NHProf to Linq to SQL, a few moments ago I posted screenshots of the code that is going to private beta.&#xA;I spent most of the last week working on the never-ending book, but that is a subject for a different post. Most of the time that I actually spent on the profiler wasn&#x2019;t spent on integrating with Linq to SQL. To be frank, it took me two hours to do basic integration to Linq to SQL. That is quite impressive, considering that is from the point of view of someone who never did anything more serious with it than the hello world demo, and it was years ago. The Linq to SQL codebase is really nice.&#xA;Most of the time went into refactoring the profiler. I know that I am going to want to add additional OR/Ms (and other stuff) there, so I spent the time to make the OR/M into a concept in the profiler. That was a big change, but it was mostly mechanical. All the backend changes are done, and plugging in a new OR/M should take about two hours, I guess.&#xA;For Linq to SQL, however, the work is far from over, while we are now capable of intercepting, displaying and analyzing Linq to SQL output, the current Linq to SQL profiler, as you can see in the screen shots, is using the NHibernate Profiler skin, we need to adapt the skin to match Linq to SQL (different names, different options, etc).&#xA;That is the next major piece of work that we have left to do before we can call the idea of OR/Ms as a concept done, and release Linq to SQL as a public beta.</p>
        </article>
        <article id="article-5568">
            <a href="https://ayende.com/blog/4254/linqtosql-profiler-private-beta-the-screen-shot-gallery" target="_blank">
                <h2 class="title mb-6" id="article-5568">LinqToSql Profiler private Beta &#x2013; the screen shot gallery</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 18, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is just to give you some ideas about what the new LinqToSql Profiler can do.&#xA;It can track statements and associate them to their data context, gives you properly formatted and highlighted SQL, including the parameters, in a way that you can just copy and execute in SQL Server: &#xA; &#xA;The profiler can tell you when you are hitting the database too often.&#xA; &#xA;All the usual reports, what methods caused what queries to be executed?&#xA; &#xA;Reports about unique queries across the entire profiling session:&#xA; &#xA;And overall usage reports:</p>
        </article>
        <article id="article-5569">
            <a href="https://ayende.com/blog/4253/challenge-why-is-this-wrong" target="_blank">
                <h2 class="title mb-6" id="article-5569">Challenge</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 18, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Can you figure out why this is a horribly wrong thing to do?&#xA;&#xA;[ThreadStatic]private static readonly MySingleton mySingleton = CreateSingleInstance();&#xA;&#xA;A free license of Rhino Mocks will be raffled between the people who will correctly answer it.</p>
        </article>
        <article id="article-5570">
            <a href="https://ayende.com/blog/4252/nhibernate-shards-progress-report" target="_blank">
                <h2 class="title mb-6" id="article-5570">NHibernate Shards: Progress Report</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 18, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Since my last post about it, there has been a lot of changes to NHibernate Shards.      Update: I can&#x2019;t believe I forgot, I was so caught up in how cool this was that I did give the proper credits. Thanks to Dario Quintana and all the other contributors to NHibernate Shards.   The demo actually works :-) You can look at the latest code here: http://nhcontrib.svn.sourceforge.net/svnroot/nhcontrib/trunk/src/NHibernate.Shards/  You can read the documentation for the Java version (most of which is applicable for the .NET version) here: http://docs.jboss.org/hibernate/stable/shards/reference/en/html/  Let us go through how it works, okay?  We have the following class, which we want to shard.    The class mapping is almost standard:     As you can see, the only new thing is the primary key generator. Because entities are sharded based&#xA0; on their primary key, we have to encode the appropriate shard in the shard. The easiest way of doing that is using the SharedUUIDGenerator. This generator generates keys that looks like this:     00010000602647468c2ef2f10ded039a    000200006ba74626a564d147dc89f9ad    00030000eb934532b828601979036e3c   The first four characters are reserved for the shard id.   Next, we need to specify the configurations for each shard, we can do this normally, but we have to specify the shard id in the configuration.          cfg.SetProperty(ShardedEnvironment.ShardIdProperty, 1);&#xA;  &#xA;&#xA;&#xA;The shard id is an integer that is used to select the appropriate shard. It is also used to allow you to add new shards without breaking the ids of already existing shards.&#xA;&#xA;Next, you need to implement a shard strategy factory:&#xA;&#xA; &#xA;&#xA;This allows you to configure the shard strategy based on your needs. This is often where you would add custom behaviors. A shard strategy is composed of several components:&#xA;&#xA; &#xA;&#xA;The Shard Selection Strategy is used solely to select the appropriate shard for new entities. If you shard your entities based on the user name, this is where you&#x2019;ll implement that, by providing a shard selection strategy that is aware of this. On of the nice things about NH Shards is that it is aware of the graph as a whole, and if you have an association to a sharded entity, it knows that it needs to place you in the appropriate shard, without giving the burden to you.&#xA;&#xA;For new objects, assuming that you haven&#x2019;t provided your own shard selection strategy, NHibernate Shards will try to spread them evenly between the shards. The most common implementation is the Round Robin Load Balancer, which will give you a new shard for each new item that you save.&#xA;&#xA;The Shard Resolution Strategy is quite simple, given an entity and the entity id, in which shard should we look for them?&#xA;&#xA; &#xA;&#xA; &#xA;&#xA;If you are using a sharded id, such as the one that WeatherReport is using, NH Shards will know which shard to talk to automatically. But if you are using a non sharded id, you have to tell NHibernate how to figure out which shards to look at. By default, if you have non sharded id, it will look at all shards until it finds it.&#xA;&#xA;The shard access strategy specifies how NHibernate Shards talks to the shards when it needs to talk to more than a single shard. NHibernate Shards can do it either sequentially or in parallel. Using parallel access strategy means that NHibernate will hit all your databases at the same time, potentially saving quite a bit of time for you.&#xA;&#xA;The access strategy is also responsible for handling post processing the queries result, merging them and ordering them as needed.&#xA;&#xA;Let us look at the code, okay? As you can see, this is a pretty standard usage of NHibernate. &#xA;&#xA;&#xA;  using(ISession session = sessionFactory.OpenSession())using(session.BeginTransaction()){    session.Save(new WeatherReport                     {                         Continent = &quot;North America&quot;,                         Latitude = 25,                         Longitude = 30,                        ReportTime = DateTime.Now,                         Temperature = 44                     });    session.Save(new WeatherReport                 {                     Continent = &quot;Africa&quot;,                     Latitude = 44,                     Longitude = 99,                     ReportTime = DateTime.Now,                     Temperature = 31                 });    session.Save(new WeatherReport                 {                     Continent = &quot;Asia&quot;,                     Latitude = 13,                     Longitude = 12,                    ReportTime = DateTime.Now,                     Temperature = 104                 });    session.Transaction.Commit();}&#xA;&#xA;&#xA;Since we are using the defaults, each of those entities is going to go to a different shard. Here is the result:&#xA;&#xA;&#xA;   &#xA;&#xA;Our data was saved into three different databases. And obviously we could have saved them to three different servers as well.&#xA;&#xA;But saving the data is only part of things, what about querying? Well, let us look at the following query:&#xA;&#xA;&#xA;  &#xA;    session.CreateCriteria(typeof(WeatherReport), &quot;weather&quot;).List()&#xA;  &#xA;&#xA;&#xA;This query will give us:&#xA;&#xA; &#xA;&#xA;Note that we have three different sessions here, each for its own database, each executing a single query. What is really interesting is that NHibernate will take all of those results and merge them together. It can even handle proper ordering across different databases.&#xA;&#xA;Let us see the code:&#xA;&#xA;&#xA;  &#xA;    var reports =    session.CreateCriteria(typeof(WeatherReport), &quot;weather&quot;)        .Add(Restrictions.Gt(&quot;Temperature&quot;, 33))        .AddOrder(Order.Asc(&quot;Continent&quot;))        .List();foreach (WeatherReport report in reports){    Console.WriteLine(report.Continent);}&#xA;  &#xA;&#xA;&#xA;Which results in:&#xA;&#xA; &#xA;&#xA;And in the following printed to the console:&#xA;&#xA;&#xA;  Asia&#xA;    North America&#xA;&#xA;&#xA;We got the proper ordering, as we specified in the query, but note that we aren&#x2019;t handling ordering in the database. Because we are hitting multiple sources, it is actually cheaper to do the ordering in memory, rather than get partially ordered data and they trying to sort it.&#xA;&#xA;Well, that is about it from the point of view of the capabilities. &#xA;&#xA;One of the things that is holding NH Shards back right now is that only core code paths has been implemented. A lot of the connivance methods are currently not implemented.&#xA0; &#xA;&#xA; &#xA;&#xA;They are relatively low hanging fruits, and can be implemented without any deep knowledge of NHibernate or NHibernate Shards. Beyond that, the sharded HQL implementation is still not handling order properly, so if you care about ordering you can only query using ICriteria (at the moment). &#xA;&#xA;&#xA;&#xA;It isn&#x2019;t there yet, but it is much closer. You can get a working demo, and probably start working with this and implement things on the fly as you run into things. I strongly urge you to contribute the missing parts, at least the convenience methods, which should be pretty easy.&#xA;&#xA;Please submit patches to our JIRA and discuss the topic at: http://groups.google.com/group/nhcdevs</p>
        </article>
        <div class="button flex justify-between">
            <a href="556.html"><span class="back arrow"></span></a>

            <a href="558.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>