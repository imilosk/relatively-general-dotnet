
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 512 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-5111">
            <a href="https://ayende.com/blog/4737/happy-new-year-and-across-the-board-profiler-discount" target="_blank">
                <h2 class="title mb-6" id="article-5111">Happy New Year, and across the board profiler discount</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 31, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">To celebrate the new year, I decided to offer a single day coupon that will get you 35% discount for all my profiler products.  The coupon code is valid until the 1st of January 2011, but I won&#x2019;t mention in which timezone, so you might want to hurry up.  The coupon code is:  HNY-45K2D465DD  You can use it to buy:     NHibernate Profiler    Entity Framework Profiler    Linq to SQL Profiler    LLBLGen Profiler    Hibernate Profiler   Happy new year!</p>
        </article>
        <article id="article-5112">
            <a href="https://ayende.com/blog/4736/psychic-debugging" target="_blank">
                <h2 class="title mb-6" id="article-5112">Psychic Debugging</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 29, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I think that I am getting too much of those recently:</p>
        </article>
        <article id="article-5113">
            <a href="https://ayende.com/blog/4735/public-service-announcement-git-master-repositories-for-the-rhino-tools-projects" target="_blank">
                <h2 class="title mb-6" id="article-5113">Public Service Announcement</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 28, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">There have been some changes, and it seems that it is hard to track them. Here are where you can find the master repositories for the rhino tools projects:     Rhino Commons - https://github.com/lorenzomelato/rhino-commons    Rhino Service Bus- https://github.com/hibernating-rhinos/rhino-esb    Rhino Licensing - https://github.com/hibernating-rhinos/rhino-licensing    Rhino ETL - https://github.com/hibernating-rhinos/rhino-etl    Rhino Security - https://github.com/hibernating-rhinos/rhino-security    Rhino Persistent Hash Table - https://github.com/hibernating-rhinos/rhino-pht    Rhino Distributed Hash Table - https://github.com/hibernating-rhinos/rhino-dht    Rhino DSL - https://github.com/hibernating-rhinos/rhino-dsl    Rhino Mocks - https://github.com/hibernating-rhinos/rhino-mocks    Rhino Queues - https://github.com/hibernating-rhinos/rhino-queues</p>
        </article>
        <article id="article-5114">
            <a href="https://ayende.com/blog/4734/we-are-hiring" target="_blank">
                <h2 class="title mb-6" id="article-5114">We are hiring!</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 26, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In 2005, I got out of the army, and looked for a job. I felt that I had all the necessary qualifications (at the time, I had already written Rhino Mocks), but I run into an interesting problem. I didn&#x2019;t have any commercial experience. I am sure that you are familiar with the tale. All the jobs require at least 2 &#x2013; 3 years experience, and the list of qualification looked like someone just raided the TLA storage facilities.   That was pretty annoying at the time, and I wished I could do something about it. Now I can.  We aren&#x2019;t hiring additional full time employees (at least not right now), but we are hiring interns. The main idea is to enable people to gain commercial experience while working on cool software.  Some information that you probably need to know:     You have to know to program in C#. If you have OSS credentials, that is all for the better, but it is not required.    This is a paid position, you are not expected to work for free.    It is not a remote position, our offices are located in the Southern Industrial Area in&#xA0;Hadera, Israel.    I&#x2019;m not going to ask you to do all the annoying work. There is some annoying stuff to do (mostly docs), but look below to see what exactly I have in mind.   This position entails:  Working on our shipping products (the Uber Prof line of products and the Raven DB / Raven MQ line).  Among other things, I have earmarked the following features for you:     Raven DB&#x2019;s query optimizer.    Raven DB&#x2019;s auto sharding &amp; scaling.    Raven DB&#x2019;s clustering support.    Uber Prof&#x2019;s production profiling feature.   The other things that are involved include all the usual stuff, bug fixes, doc writing and standard (in other words, not that exciting) features.  Duration:  This is a three to six months position.  What is required:  Commercial experience is not required, but I would want to see code that you wrote.</p>
        </article>
        <article id="article-5115">
            <a href="https://ayende.com/blog/4733/answer-this-code-should-never-hit-production" target="_blank">
                <h2 class="title mb-6" id="article-5115">Answer</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 24, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Originally posted at 12/15/2010Yesterday I asked what is wrong with the following code:     public ISet&lt;string&gt; GetTerms(string index, string field)&#xA;{&#xA;    if(field == null) throw new ArgumentNullException(&quot;field&quot;);&#xA;    if(index == null) throw new ArgumentNullException(&quot;index&quot;);&#xA;    &#xA;    var result = new HashSet&lt;string&gt;();&#xA;    var currentIndexSearcher = database.IndexStorage.GetCurrentIndexSearcher(index);&#xA;    IndexSearcher searcher;&#xA;    using(currentIndexSearcher.Use(out searcher))&#xA;    {&#xA;        var termEnum = searcher.GetIndexReader().Terms(new Term(field));&#xA;        while (field.Equals(termEnum.Term().Field()))&#xA;        {&#xA;           result.Add(termEnum.Term().Text());&#xA;&#xA;            if (termEnum.Next() == false)&#xA;                break;&#xA;        }&#xA;    }&#xA;&#xA;    return result;&#xA;}&#xA;  &#xA;&#xA;The answer to that is quite simple, this code doesn&#x2019;t have any paging available. What this means is if we executes this piece of code on an field with very high number of unique items (such as, for example, email addresses), we would return all the results in one shot. That is, if we can actually fit all of them to memory. Anything that can run over potentially unbounded result set should have paging as part of its basic API. &#xA;&#xA;This is not optional.&#xA;&#xA;Here is the correct piece of code:&#xA;&#xA;&#xA;  public ISet&lt;string&gt; GetTerms(string index, string field, string fromValue, int pageSize)&#xA;{&#xA;    if(field == null) throw new ArgumentNullException(&quot;field&quot;);&#xA;    if(index == null) throw new ArgumentNullException(&quot;index&quot;);&#xA;    &#xA;    var result = new HashSet&lt;string&gt;();&#xA;    var currentIndexSearcher = database.IndexStorage.GetCurrentIndexSearcher(index);&#xA;    IndexSearcher searcher;&#xA;    using(currentIndexSearcher.Use(out searcher))&#xA;    {&#xA;        var termEnum = searcher.GetIndexReader().Terms(new Term(field, fromValue ?? string.Empty));&#xA;        if (string.IsNullOrEmpty(fromValue) == false)// need to skip this value&#xA;        {&#xA;            while(fromValue.Equals(termEnum.Term().Text()))&#xA;            {&#xA;                if (termEnum.Next() == false)&#xA;                    return result;&#xA;            }&#xA;        }&#xA;        while (field.Equals(termEnum.Term().Field()))&#xA;        {&#xA;            result.Add(termEnum.Term().Text());&#xA;&#xA;            if (result.Count &gt;= pageSize)&#xA;                break;&#xA;&#xA;            if (termEnum.Next() == false)&#xA;                break;&#xA;        }&#xA;    }&#xA;&#xA;    return result;&#xA;}&#xA;  &#xA;&#xA;And that is quite efficient, even for searching large data sets.&#xA;&#xA;For bonus points, the calling code ensures that pageSize cannot be too big :-)</p>
        </article>
        <article id="article-5116">
            <a href="https://ayende.com/blog/4732/challenge-this-code-should-never-hit-production" target="_blank">
                <h2 class="title mb-6" id="article-5116">Challenge</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 23, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This code should never have the chance to go to production, it is horribly broken in a rather subtle way, do you see it?     public ISet&lt;string&gt; GetTerms(string index, string field)&#xA;{&#xA;    if(field == null) throw new ArgumentNullException(&quot;field&quot;);&#xA;    if(index == null) throw new ArgumentNullException(&quot;index&quot;);&#xA;    &#xA;    var result = new HashSet&lt;string&gt;();&#xA;    var currentIndexSearcher = database.IndexStorage.GetCurrentIndexSearcher(index);&#xA;    IndexSearcher searcher;&#xA;    using(currentIndexSearcher.Use(out searcher))&#xA;    {&#xA;        var termEnum = searcher.GetIndexReader().Terms(new Term(field));&#xA;        while (field.Equals(termEnum.Term().Field()))&#xA;        {&#xA;           result.Add(termEnum.Term().Text());&#xA;&#xA;            if (termEnum.Next() == false)&#xA;                break;&#xA;        }&#xA;    }&#xA;&#xA;    return result;&#xA;}&#xA;  &#xA;&#xA;As usual, I&#x2019;ll post the answer tomorrow.</p>
        </article>
        <article id="article-5117">
            <a href="https://ayende.com/blog/4731/detailed-answer-your-own-threadlocal" target="_blank">
                <h2 class="title mb-6" id="article-5117">Detailed Answer: Your own ThreadLocal</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 22, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Originally posted at 12/15/2010In the last post, we have shown this code:     public class CloseableThreadLocal&#xA;{&#xA;    [ThreadStatic]&#xA;    public static Dictionary&lt;object, object&gt; slots;&#xA;&#xA;    private readonly object holder = new object();&#xA;    private Dictionary&lt;object, object&gt; capturedSlots;&#xA;&#xA;    private Dictionary&lt;object, object&gt; Slots&#xA;    {&#xA;        get&#xA;        {&#xA;            if (slots == null)&#xA;                slots = new Dictionary&lt;object, object&gt;();&#xA;            capturedSlots = slots;&#xA;            return slots;&#xA;        }&#xA;    }&#xA;&#xA;&#xA;    public /*protected internal*/ virtual Object InitialValue()&#xA;    {&#xA;        return null;&#xA;    }&#xA;&#xA;    public virtual Object Get()&#xA;    {&#xA;        object val;&#xA;&#xA;        lock (Slots)&#xA;        {&#xA;            if (Slots.TryGetValue(holder, out val))&#xA;            {&#xA;                return val;&#xA;            }&#xA;        }&#xA;        val = InitialValue();&#xA;        Set(val);&#xA;        return val;&#xA;    }&#xA;&#xA;    public virtual void Set(object val)&#xA;    {&#xA;        lock (Slots)&#xA;        {&#xA;            Slots[holder] = val;&#xA;        }&#xA;    }&#xA;&#xA;    public virtual void Close()&#xA;    {&#xA;        GC.SuppressFinalize(this);&#xA;        if (capturedSlots != null)&#xA;            capturedSlots.Remove(this);&#xA;    }&#xA;&#xA;    ~CloseableThreadLocal()&#xA;    {&#xA;        if (capturedSlots == null)&#xA;            return;&#xA;        lock (capturedSlots)&#xA;            capturedSlots.Remove(holder);&#xA;    }&#xA;}&#xA;  &#xA;&#xA;And then I asked whatever there are additional things that you may want to do here.&#xA;&#xA;The obvious one is to thing about locking. For one thing, we have now introduced locking for everything. Would that be expensive?&#xA;&#xA;The answer is that probably not. We can expect to have very little contention here, most of the operations are always going to be on the same thread, after all.&#xA;&#xA;I would probably just change this to be a ConcurrentDictionary, though, and remove all explicit locking. And with that, we need to think whatever it would make sense to make this a static variable, rather than a thread static variable.</p>
        </article>
        <article id="article-5118">
            <a href="https://ayende.com/blog/4730/answer-your-own-threadlocal" target="_blank">
                <h2 class="title mb-6" id="article-5118">Answer</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 21, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Originally posted at 12/15/2010Well, the problem on our last answer was that we didn&#x2019;t protect ourselves from multi threaded access to the slots variable. Here is the code with this fixed:     public class CloseableThreadLocal&#xA;{&#xA;    [ThreadStatic]&#xA;    public static Dictionary&lt;object, object&gt; slots;&#xA;&#xA;    private readonly object holder = new object();&#xA;    private Dictionary&lt;object, object&gt; capturedSlots;&#xA;&#xA;    private Dictionary&lt;object, object&gt; Slots&#xA;    {&#xA;        get&#xA;        {&#xA;            if (slots == null)&#xA;                slots = new Dictionary&lt;object, object&gt;();&#xA;            capturedSlots = slots;&#xA;            return slots;&#xA;        }&#xA;    }&#xA;&#xA;&#xA;    public /*protected internal*/ virtual Object InitialValue()&#xA;    {&#xA;        return null;&#xA;    }&#xA;&#xA;    public virtual Object Get()&#xA;    {&#xA;        object val;&#xA;&#xA;        lock (Slots)&#xA;        {&#xA;            if (Slots.TryGetValue(holder, out val))&#xA;            {&#xA;                return val;&#xA;            }&#xA;        }&#xA;        val = InitialValue();&#xA;        Set(val);&#xA;        return val;&#xA;    }&#xA;&#xA;    public virtual void Set(object val)&#xA;    {&#xA;        lock (Slots)&#xA;        {&#xA;            Slots[holder] = val;&#xA;        }&#xA;    }&#xA;&#xA;    public virtual void Close()&#xA;    {&#xA;        GC.SuppressFinalize(this);&#xA;        if (capturedSlots != null)&#xA;            capturedSlots.Remove(this);&#xA;    }&#xA;&#xA;    ~CloseableThreadLocal()&#xA;    {&#xA;        if (capturedSlots == null)&#xA;            return;&#xA;        lock (capturedSlots)&#xA;            capturedSlots.Remove(holder);&#xA;    }&#xA;}&#xA;  &#xA;&#xA;Is this it? Are there still issues that we need to handle?</p>
        </article>
        <article id="article-5119">
            <a href="https://ardalis.com/presentation-zen/" target="_blank">
                <h2 class="title mb-6" id="article-5119">Presentation Zen</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 20, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I picked up Presentation Zen by Garr Reynolds earlier this year, and finally managed to finish it. It comes highly recommended by many&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-5120">
            <a href="https://ayende.com/blog/4729/wrong-answer-3-your-own-thread-local" target="_blank">
                <h2 class="title mb-6" id="article-5120">Wrong Answer #3: Your own Thread Local</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 20, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Originally posted at 12/15/2010Last time, we forgot that the slots dictionary is a thread static variable, and that the finalizer is going to run on another thread&#x2026; Let us fix this, too:     public class CloseableThreadLocal&#xA;{&#xA;    [ThreadStatic]&#xA;    public static Dictionary&lt;object, object&gt; slots;&#xA;&#xA;    private readonly object holder = new object();&#xA;    private Dictionary&lt;object, object&gt; capturedSlots;&#xA;&#xA;    private Dictionary&lt;object, object&gt; Slots&#xA;    {&#xA;        get&#xA;        {&#xA;            if (slots == null)&#xA;                slots = new Dictionary&lt;object, object&gt;();&#xA;            capturedSlots = slots;&#xA;            return slots;&#xA;        }&#xA;    }&#xA;&#xA;&#xA;    public /*protected internal*/ virtual Object InitialValue()&#xA;    {&#xA;        return null;&#xA;    }&#xA;&#xA;    public virtual Object Get()&#xA;    {&#xA;        object val;&#xA;&#xA;        if (Slots.TryGetValue(holder, out val))&#xA;        {&#xA;            return val;&#xA;        }&#xA;        val = InitialValue();&#xA;        Set(val);&#xA;        return val;&#xA;    }&#xA;&#xA;    public virtual void Set(object val)&#xA;    {&#xA;        Slots[holder] = val;&#xA;    }&#xA;&#xA;    public virtual void Close()&#xA;    {&#xA;        GC.SuppressFinalize(this);&#xA;        if (capturedSlots != null)&#xA;            capturedSlots.Remove(this);&#xA;    }&#xA;&#xA;    ~CloseableThreadLocal()&#xA;    {&#xA;        if (capturedSlots == null)&#xA;            return;&#xA;        capturedSlots.Remove(holder);&#xA;    }&#xA;}&#xA;  &#xA;&#xA;And now it works!&#xA;&#xA;Except&#x2026; Under some very rare scenarios, it will not do so.&#xA;&#xA;What are those scenarios? Why do we care? And how do we fix this?</p>
        </article>
        <div class="button flex justify-between">
            <a href="511.html"><span class="back arrow"></span></a>

            <a href="513.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>