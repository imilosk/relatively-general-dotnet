
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 660 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-6591">
            <a href="https://ayende.com/blog/3581/persistent-dsl-caching" target="_blank">
                <h2 class="title mb-6" id="article-6591">Persistent DSL Caching</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 04, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is a note to myself, because I don&#x27;t have the time for a proper post. When you are dealing with a DSL that contains more than just a few scripts, you really being to care about compilation times. Even with caching, this can be a problem.  The solution is the same that we have been using for the last three to four decades, don&#x27;t compile if the source hasn&#x27;t changed.  The code to make this happen using Rhino DSL is here:     public override CompilerContext Compile(string[] urls)&#xA;{&#xA;    var outputAssemblyName = OutputAssemblyName(urls);&#xA;    if (CanUseCachedVersion(outputAssemblyName, urls))&#xA;        return new CompilerContext { GeneratedAssembly = Assembly.Load(File.ReadAllBytes(outputAssemblyName)) };&#xA;    return base.Compile(urls);&#xA;}&#xA;&#xA;private bool CanUseCachedVersion(string outputAssemblyName, string[] urls)&#xA;{&#xA;    var asm = new FileInfo(outputAssemblyName);&#xA;    if(asm.Exists==false)&#xA;        return false;&#xA;    foreach (var url in urls)&#xA;    {&#xA;        if(File.GetLastWriteTime(url) &gt; asm.LastWriteTime)&#xA;            return false;&#xA;    }&#xA;    return true;&#xA;}&#xA;&#xA;&#xA;And in the CustomizeCompiler method:&#xA;&#xA;&#xA;  protected override void CustomizeCompiler(BooCompiler compiler, CompilerPipeline pipeline, string[] urls)&#xA;{&#xA;    compiler.Parameters.OutputAssembly = OutputAssemblyName(urls);&#xA;    // add implicit base class here...&#xA;    if (pipeline.Find(typeof(SaveAssembly)) == -1)&#xA;        pipeline.Add(new SaveAssembly());}&#xA;&#xA;&#xA;It is impossible to overstate how big a difference this can make.</p>
        </article>
        <article id="article-6592">
            <a href="https://ayende.com/blog/3580/chapter-11-documenting-your-dsl" target="_blank">
                <h2 class="title mb-6" id="article-6592">Chapter 11 - Documenting your DSL</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 03, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am going to start writing this soon. Any suggestions?  As a bait, I am going to apply the techniques that I intend to describe to Binsor, which should give you incentive to say what you really want from a DSL documentation... :-)</p>
        </article>
        <article id="article-6593">
            <a href="https://ayende.com/blog/3579/chapter-10-is-done-happy" target="_blank">
                <h2 class="title mb-6" id="article-6593">Chapter 10 is done, happy</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 03, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A few hours ago I finished writing Chapter 10. Looking at the time on the calendar, it didn&#x27;t take too long, about a month. Looking at it from the point of view of effort involved, I feel about as tired as if it took three years.  Other chapters took longer, but didn&#x27;t take out quite as much effort. Not sure what this means... but I am happy I am done with it (for a given value of done, I will still need to review and read it at least three dozen times).</p>
        </article>
        <article id="article-6594">
            <a href="https://ayende.com/blog/3578/a-balancing-act" target="_blank">
                <h2 class="title mb-6" id="article-6594">A balancing act</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 03, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Probably one of the hardest challenges that I am facing with writing the book is to know what to say and what to leave unsaid.  Phrasing it another way, it is choosing at what level to talk to the reader. On the one hand, I really want the reader to be able to make immediate use of the concepts that I am talking about, which drive me to do more practical demonstrations, code samples and covering more common situations. On the other hand, those take up a lot of room, and they tend to be boring if you don&#x27;t need exactly what you need right this moment.   High level concepts, open ended possibilities and assuming a bit about the reader knowledge level makes for a book that is much more narrowly focused, and I think that it more valuable. However, it also tend to leave readers unsatisfied, because not everything is explained.  Currently I am writing a UI focused chapter, and to get a good experience from the UI you need to invest a lot of time. Metric tons of it. I am trying to chart the way and show how this can be done, but without getting mired in all the actual minute details.   This is a tough balancing act, and I am not sure if I am succeeding.</p>
        </article>
        <article id="article-6595">
            <a href="https://ayende.com/blog/3577/is-this-valuable" target="_blank">
                <h2 class="title mb-6" id="article-6595">Is this valuable?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 03, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Going back to the theme of visually editing a DSL, we have something like this:     The backend to this cutey is pattern recognition with custom UI on top. You have to teach it about each pattern that you use with it, but you can get pretty smart with how it works while using a fairly brute force (and simple) techniques.  Thoughts?</p>
        </article>
        <article id="article-6596">
            <a href="https://ayende.com/blog/3576/nullifying-null" target="_blank">
                <h2 class="title mb-6" id="article-6596">Nullifying Null</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 03, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the more annoying problems with&#xA0; building rules that are also code is that you have to deal with code related issues. One of the more common ones is NullReferenceException.   For example, let us say that we have the following rule:      when Order.Amount &gt; 10 and Customer.IsPreferred:&#xA;      ApplyDiscount 5.precent &#xA;&#xA;&#xA;We also support a mode in which a customer can create an order without actually registering on the site (anonymous checkout). &#xA;&#xA;In this scenario, the Customer property is null. We can rewrite the rule to look like this: &#xA;&#xA;&#xA;  when Order.Amount &gt; 10 and Customer is not null and Customer.IsPreferred:      ApplyDiscount 5.precent &#xA;&#xA;&#xA;But I think that this is extremely ugly. We can also decide to return a default instance of the customer when it is not there, but here I want to show you another way to handle this. We define the rule as invalid when Customer is not there, so it should not be run. The question is how we can know that.&#xA;&#xA;The dirty way is to do something like this:&#xA;&#xA;&#xA;  var referencesCustomer = File.ReadAllText(ruleName).Contains(&quot;Customer&quot;);&#xA;if(referencesCustomer &amp;&amp; Customer == null)&#xA;   return;&#xA;&#xA;&#xA;If you gagged when seeing this code, that is a good sign. Let us solve this properly. First, we want some help from the compiler, so let us inspect the when() meta method that we have seen in the previous post a little closer.&#xA;&#xA;&#xA;  [Meta]&#xA;public static ExpressionStatement when(Expression condition, BlockExpression action)&#xA;{&#xA;&#x9;var ctor = new BlockExpression();&#xA;&#xA;&#x9;var conditionFunc = new Block();&#xA;&#x9;conditionFunc.Add(new ReturnStatement(condition));&#xA;&#xA;&#x9;ctor.Body.Add(&#xA;&#x9;&#x9;new BinaryExpression(&#xA;&#x9;&#x9;&#x9;BinaryOperatorType.Assign,&#xA;&#x9;&#x9;&#x9;new ReferenceExpression(&quot;Condition&quot;),&#xA;&#x9;&#x9;&#x9;new BlockExpression(conditionFunc)&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;);&#xA;&#xA;&#x9;Expression serialize = new CodeSerializer().Serialize(condition);&#xA;&#x9;Builder.Revisit(serialize);&#xA;&#xA;&#x9;ctor.Body.Add(&#xA;&#x9;&#x9;new BinaryExpression(&#xA;&#x9;&#x9;&#x9;BinaryOperatorType.Assign,&#xA;&#x9;&#x9;&#x9;new ReferenceExpression(&quot;ConditionExpression&quot;),&#xA;&#x9;&#x9;&#x9;serialize&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;);&#xA;&#xA;&#x9;ctor.Body.Add(&#xA;&#x9;&#x9;new BinaryExpression(&#xA;&#x9;&#x9;&#x9;BinaryOperatorType.Assign,&#xA;&#x9;&#x9;&#x9;new ReferenceExpression(&quot;Action&quot;),&#xA;&#x9;&#x9;&#x9;action&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;);&#xA;&#xA;&#x9;return new ExpressionStatement(&#xA;&#x9;&#x9;new MethodInvocationExpression(&#xA;&#x9;&#x9;&#x9;ctor&#xA;&#x9;&#x9;&#x9;));&#xA;}&#xA;&#xA;&#xA;We take the cal to the when method and transform it to the following code:&#xA;&#xA;&#xA;  delegate&#xA;{&#xA;&#x9;Condition = () =&gt; Order.Amount &gt; 10 &amp;&amp; Customer.IsPreferred;&#xA;&#x9;ConditionExpression = (Expression&lt;Func&lt;bool&gt;&gt;)() =&gt; Order.Amount &gt; 10 &amp;&amp; Customer.IsPreferred;&#xA;&#x9;Action = delegate&#xA;&#x9;{&#xA;&#x9;&#x9;// not interesting for this post&#xA;&#x9;};&#xA;}();&#xA;&#xA;&#xA;I am translating to C# 3.0 here in order to make it easier to grasp the concept. The real code is in Boo, of course, and is more interesting. The most fascinating concept here is the use of CodeSerializer, which will turn the condition that we passed into an AST that we can access at runtime. I tried to simulate that by doing an explicit cast to expression tree, which would give similar result in C#).&#xA;&#xA;Having the AST of the code at runtime, even if we don&#x27;t want to change it (a totally different concept) is incredibly powerful. In this case, we are going to use this to detect when we are referencing a null property and marking the rule as invalid.&#xA;&#xA;Here is the code:&#xA;&#xA;&#xA;  public void Evaluate()&#xA;{&#xA;&#x9;var references = new List&lt;string&gt;();&#xA;&#x9;new InlineVisitor&#xA;&#x9;{&#xA;&#x9;&#x9;OnReferenceExpression = r =&gt; references.Add(r.Name);&#xA;&#x9;}.Visit(ConditionExpression);&#xA;&#x9;if(references.Contains(&quot;Customer&quot;) &amp;&amp; Customer == null)&#xA;&#x9;&#x9;return;// rule invalid&#xA;&#x9;if(Condition())&#xA;&#x9;&#x9;Action();&#xA;}&#xA;&#xA;&#xA;This is a very simple example of how you can add smarts to the way that your code behaves. This technique is the foundation for a whole host of options. I am using similar approaches for adaptive rules and for auditable actions. Fun stuff, if I say so myself.</p>
        </article>
        <article id="article-6597">
            <a href="https://ayende.com/blog/3575/how-to-execute-a-set-of-statements-in-an-expression" target="_blank">
                <h2 class="title mb-6" id="article-6597">How to execute a set of statements in an expression</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 02, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the most common problems with using Boo&#x27;s Meta Methods is that they can only return expressions. This is not good if what you want to return from the meta method is a set of statements to be executed.  The most common reason for that is to initialize a set of variables. Obviously, you can call a method that will do it for you, but there is a simpler way.  Method invocation is an expression, and anonymous delegate definition is also an expression. What does this tells you? That this is an expression as well:     // the whole thing is a single expression.&#xA;delegate (int x)&#xA;{&#xA;&#x9;Console.WriteLine(x);&#xA;&#x9;Console.WriteLine(&quot;another statement&quot;);&#xA;}(5);&#xA;&#xA;&#xA;You generally won&#x27;t use something like that in real code, but when you are working with the AST directly, expressions vs. statements require a wholly different world view.&#xA;&#xA;Anyway, let us see how we can implement this using Boo.&#xA;&#xA;&#xA;  [Meta]&#xA;public static ExpressionStatement when(Expression condition, BlockExpression action)&#xA;{&#xA;&#x9;var func = new BlockExpression();&#xA;&#xA;&#x9;var conditionFunc = new Block();&#xA;&#x9;conditionFunc.Add(new ReturnStatement(condition));&#xA;&#xA;&#x9;func .Body.Add(&#xA;&#x9;&#x9;new BinaryExpression(&#xA;&#x9;&#x9;&#x9;BinaryOperatorType.Assign,&#xA;&#x9;&#x9;&#x9;new ReferenceExpression(&quot;Condition&quot;),&#xA;&#x9;&#x9;&#x9;new BlockExpression(conditionFunc)&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;);&#xA;&#xA;&#x9;Expression serialize = new CodeSerializer().Serialize(condition);&#xA;&#x9;RuleBuilder.Revisit(serialize);&#xA;&#xA;&#x9;func .Body.Add(&#xA;&#x9;&#x9;new BinaryExpression(&#xA;&#x9;&#x9;&#x9;BinaryOperatorType.Assign,&#xA;&#x9;&#x9;&#x9;new ReferenceExpression(&quot;ConditionExpression&quot;),&#xA;&#x9;&#x9;&#x9;serialize&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;);&#xA;&#xA;&#x9;func .Body.Add(&#xA;&#x9;&#x9;new BinaryExpression(&#xA;&#x9;&#x9;&#x9;BinaryOperatorType.Assign,&#xA;&#x9;&#x9;&#x9;new ReferenceExpression(&quot;Action&quot;),&#xA;&#x9;&#x9;&#x9;action&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;);&#xA;&#xA;&#x9;return new MethodInvocationExpression(func);&#xA;}&#xA;&#xA;&#xA;This trick lets you use the meta method to return several statements, which allows to do several property assignments (something that you generally cannot do in a single expression). I&#x27;ll go over the actual meaning of the code (rather than the mechanics) in a future post.</p>
        </article>
        <article id="article-6598">
            <a href="https://ayende.com/blog/3574/inline-anonymous-visitors" target="_blank">
                <h2 class="title mb-6" id="article-6598">Inline Anonymous Visitors</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 02, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the most common chores when working with compilers is the need to create special visitors. I mean, I just need to get a list of all the variables in the code, but I need to create a visitor class and execute it in order to get the information out. This is not hard, the code is something like this:     public class ReferenceVisitor : DepthFirstVisitor&#xA;{&#xA;     public List&lt;string&gt; References = new List&lt;string&gt;();&#xA; &#xA;     public void OnReferenceExpression(ReferenceExpression re)&#xA;     {&#xA;            References.Add(re.Name); &#xA;     }&#xA;}&#xA;public bool IsCallingEmployeeProperty(Expression condition)&#xA;{ &#xA;    var visitor = new ReferenceVisitor();&#xA;    visitor.Visit(condition);&#xA;    return visitor.References.Contains(&quot;Employee&quot;); &#xA;}&#xA;&#xA;&#xA;Doing this is just annoying. Especially when you have to create several of those, and they make no sense outside of their call site. In many ways, they are to compilers what event handlers are to UI components.&#xA;&#xA;What would happen if we could create a special visitor inline, without going through the &quot;create whole new type&quot; crap? I think that this would be as valuable as anonymous delegates and lambdas turned out to be. With that in mind, let us see if I can make this work, shall we?&#xA;&#xA;&#xA;  public bool IsCallingEmployeeProperty(Expression condition)&#xA;{&#xA;&#x9;var references = new List&lt;string&gt;();&#xA;&#x9;new InlineVisitor&#xA;&#x9;{&#xA;&#x9;&#x9;OnRefefenceExpression = re =&gt; references.Add(re.Name) &#xA;&#x9;}.Visit(condition);&#xA;&#x9;return references.Contains(&quot;Employee&quot;); &#xA;}&#xA;&#xA;&#xA;Especially in the more moderately complex scenarios, such a thing is extremely useful.</p>
        </article>
        <article id="article-6599">
            <a href="https://ayende.com/blog/3573/the-implications-of-google-chrome" target="_blank">
                <h2 class="title mb-6" id="article-6599">The implications of Google Chrome</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 02, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">So, Google is coming out with a new browsers, while at the same time they are also responsible for a large part of both FireFox and Opera&#x27;s budgets.  I think that this is a very interesting development. In particular, because Google thinks about the browser as a complementary offer to what it does, or as a baseline platform, not as the actual end result.   This get really interesting when you think that in this scenario, Google can leverage what are effectively Killer Applications in order to migrate people from one browser to another. If YouTube worked better with Chrome than with IE, I think it would be a very powerful motivator to move. And Google has dozens of such high value assets.  I am pretty sure that Google will produce plugins for anything new it creates, so other browsers can work with it as well (to do otherwise is to risk monopoly charges), but if used properly, it will allow Google to leverage its own power to produce its own de facto standards, which browsers will have to follow.  The focus on creating a browser which is focused primarily on allowing application development and hosting (vs. mere browsing) is likely to aid in setting the new baseline standard of what a browser platform should provide for the web applications that are hosted in it.  From my point of view, I think that this is going to allow Google to take a much more active role in shaping the environment in which their applications are living. From that perspective, it seems like a very natural step for them.</p>
        </article>
        <article id="article-6600">
            <a href="https://ayende.com/blog/3572/review-hibernate-search-in-action" target="_blank">
                <h2 class="title mb-6" id="article-6600">Review</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 02, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just finished reading Hibernate Search in Action, and I loved it. I should point out that I was the porter of Hibernate Search to NHibernate Search, so I had some previous expertise in the topic. In addition to that, I approached this book at an angle completely orthogonal to the expected audience. Unlike most &quot;in Action&quot; books, I did not intend to make immediate use of the code and approaches suggested in the book. Instead, I looked to the book as a way to deepen my understanding of the tool and how it works.  I am impressed, massively so, that it did so well in this regard for someone who has gone through the entire source code of the project several times.  I&#x27;ll not bore you with the actual details, you can get the actual content summary of off the site. From my perspective, after reading this book I know that I am going to take a completely different approach for most complex search scenarios, and I think that I have the practical theoretical knowledge to deal with it.  I highly recommend the book if you actually need to deal with Hibernate Search, but I would recommend it to people who are not using it, because it contains some important eye opening concepts if you are not used to full text search tools capabilities. As a nice bonus, I was able to take the information in the book and use it to discuss a problem the customer was having, ending up with something that I consider far superior of the solution that they currently employ.  It is not out yet, and I reviewed a non final copy, but you can order the PDF right now, and just reading the freely available first chapter is valuable in itself.</p>
        </article>
        <div class="button flex justify-between">
            <a href="659.html"><span class="back arrow"></span></a>

            <a href="661.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;🚀&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
