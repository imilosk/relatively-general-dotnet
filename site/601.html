
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 601 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-6001">
            <a href="https://ayende.com/blog/3981/relying-on-hash-code-implementation-is-bad-part-ii" target="_blank">
                <h2 class="title mb-6" id="article-6001">Relying on hash code implementation is BAD &#x2013; part II</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 27, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">To be truthful, I never thought that I would have a following for this post 4 years later, but I run into that today.  The following is a part of an integration test for NH Prof:     Assert.AreEqual(47, alerts[new StatementAlert(new NHProfDispatcher())&#xA;{&#xA;&#x9;Title = &quot;SELECT N&#x2B;1&quot;&#xA;}]);&#xA;&#xA;&#xA;I am reviewing all our tests now, and I nearly choked on that one. I mean, who was stupid enough to write code like this?&#xA0; I mean, yes, I can understand what it is doing, sort of, but only because I have a dawning sense of horror when looking at it.&#xA;&#xA;I immediately decided that the miscreant that wrote that piece of code should be publically humiliated and&#xA0; chewed on by a large dog.&#xA;&#xA;SVN Blame is a wonderful thing, isn&#x2019;t it?&#xA;&#xA; &#xA;&#xA;Hm&#x2026; there is a problem here.&#xA;&#xA;Actually, there are a couple of problems here. One is that we have a pretty clear indication that we have a historic artifact here. Just look at the number of version that are shown in just this small blame window. This is good enough reason to start doing full fledged ancestory inspection. The test has started life as:&#xA;&#xA;&#xA;  [TestFixture]&#xA;public class AggregatedAlerts:IntegrationTestBase&#xA;{&#xA;&#x9;[Test]&#xA;&#x9;public void Can_get_aggregated_alerts_from_model()&#xA;&#x9;{&#xA;&#x9;&#x9;ExecuteScenarioInDifferentAppDomain&lt;Scenarios.ExecutingTooManyQueries&gt;();&#xA;&#xA;&#x9;&#x9;var alerts = observer.Model.Sessions[1].AggregatedAlerts;&#xA;&#x9;&#x9;Assert.AreEqual(47, alerts[&quot;SELECT N&#x2B;1&quot;]);&#xA;&#x9;&#x9;Assert.AreEqual(21, alerts[&quot;Too many database calls per session&quot;]);&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;Which I think is reasonable enough. Unfortunately, it looks like somewhere along the way, someone had taken the big hammer approach to this. The code now looks like this:&#xA;&#xA;&#xA;  Assert.AreEqual(47, alerts.First(x =&gt; x.Key.Title == &quot;SELECT N&#x2B;1&quot;));&#xA;&#xA;&#xA;Now this is readable.&#xA;&#xA;Oh, for the nitpickers, using hash code evaluation as the basis of any sort of logic is wrong. That is the point of this post. It is a non obvious side affect that will byte* you in the ass.&#xA;&#xA;* intentional misspelling</p>
        </article>
        <article id="article-6002">
            <a href="https://ayende.com/blog/3980/it-is-either-a-traveling-schedule-or-a-train-wreck" target="_blank">
                <h2 class="title mb-6" id="article-6002">It is either a traveling schedule or a train wreck&#x2026;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 27, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">So, after a delicious month at home, mostly spent resting I am back to traveling again. This time my traveling schedule is so complex that I need to write it down.  Next week (04 May &#x2013; 08 May), I am going to be in Vienna, Austria. Doing some work for a client. If someone want to organize a beer night, or something similar, I open for that :-)  The week after that (11 May &#x2013; 13 May), I am going to take part in Progressive.NET tutorials in London, UK. There are quite a few good speakers there, doing 12 half day workshops. I am going to be talking about NHibernate, doing an Intro to NHibernate and an Advanced NHibernate workshop. This is basically trying to squeeze my 3 days NHibernate course into one half day workshop (Intro) and then just directly to the advanced NHibernate (which goes beyond the stuff that I am talking about in both the workshop and the course).     The week after that, (18 May &#x2013; 20 May), I am giving the first NHibernate Course (London, UK). This is a three days course that is going to take you from no NHibernate knowledge to having a pretty good knowledge in NHibernate, including understanding all the knobs and how NHibernate thinks. This course is already full, but have no fear, because the weak after that&#x2026; I am giving the same course again (again in London, UK).  This time the dates are 26 May &#x2013; 28 May, and there are booking available there.  You might have noticed that this means that I am going to spend three weeks in London. There is already a beer night planned, thanks to Sebastian. A side affect of this schedule is that I am available in the holes between the scheduled workshops and courses. This means that if you are in London and would like me to have a short engagement in 14 May &#x2013; 15 May or 21 May &#x2013; 25 May, please drop me a line.  Next, 29 May &#x2013; 7 June I am spending in New Jersey, working. I might catch up the ALT.Net meeting there again, I seem to make a habit of that.  Following that, 8 June &#x2013; 12 June, it is time for DevTeach, my favorite conference on that side of the Atlantic.      I think that early bird registration is still open, so hurry up. I am going to talk about:     Advanced IoC     OR/M &#x2B;= 2 &#x2013; my advanced NHibernate workshop, squeezed into a single session     Producing production quality software     Writing Domain Specific Languages in Boo    And as usual for DevTeach, I am going to need a lot of coffee just to keep up with the content in the sessions and the fun happening in the hallways and in the bars. And as a pleasant bonus, ALT.Net Canada is going to follow up directly after DevTeach, so on 13 June &#x2013; 14 June I am going to be there.  Wait, it is not over yet!   17 June &#x2013; 19 June, Norwegian Developers Conference! Just from my interactions with the conference organizer I can feel that it is going to be a good one. I mean, just look at the speakers lineup.      For that matter, you might want to do better than that and check the unofficial NDC 2009 video:     If a conference has that much energy before it is even started, you can pretty much conclude that it is going to be good.  Here I am talking about building Multi Tenant Applications, Producing Production Quality Software and Writing Domain Specific Languages in Boo.  And as long as I am in Norway, why not give another NHibernate course (Oslo, Norway)? This one is on the 22 June &#x2013; 24 June,  By that time, assuming that I will survive all of that, I am heading home, and giving myself a course in hibernating, because I am pretty sure that this is what I would have to do to get my strength back.</p>
        </article>
        <article id="article-6003">
            <a href="https://ayende.com/blog/3979/nhibernate-futures" target="_blank">
                <h2 class="title mb-6" id="article-6003">NHibernate Futures</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 27, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the nicest new features in NHibernate 2.1 is the Future&lt;T&gt;() and FutureValue&lt;T&gt;() functions. They essentially function as a way to defer query execution to a later date, at which point NHibernate will have more information about what the application is supposed to do, and optimize for it accordingly. This build on an existing feature of NHibernate, Multi Queries, but does so in a way that is easy to use and almost seamless.  Let us take a look at the following piece of code:     using (var s = sf.OpenSession())&#xA;using (var tx = s.BeginTransaction())&#xA;{&#xA;&#x9;var blogs = s.CreateCriteria&lt;Blog&gt;()&#xA;&#x9;&#x9;.SetMaxResults(30)&#xA;&#x9;&#x9;.List&lt;Blog&gt;();&#xA;&#x9;var countOfBlogs = s.CreateCriteria&lt;Blog&gt;()&#xA;&#x9;&#x9;.SetProjection(Projections.Count(Projections.Id()))&#xA;&#x9;&#x9;.UniqueResult&lt;int&gt;();&#xA;&#xA;&#x9;Console.WriteLine(&quot;Number of blogs: {0}&quot;, countOfBlogs);&#xA;&#x9;foreach (var blog in blogs)&#xA;&#x9;{&#xA;&#x9;&#x9;Console.WriteLine(blog.Title);&#xA;&#x9;}&#xA;&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;This code would generate two queries to the database:&#xA;&#xA; &#xA;&#xA; &#xA;&#xA; &#xA;&#xA;Two queries to the database is a expensive, we can see that it took us 114ms to get the data from the database. We can do better than that, let us tell NHibernate that it is free to do the optimization in any way that it likes, I have marked the changes in red:&#xA;&#xA;&#xA;  using (var s = sf.OpenSession())&#xA;using (var tx = s.BeginTransaction())&#xA;{&#xA;&#x9;var blogs = s.CreateCriteria&lt;Blog&gt;()&#xA;&#x9;&#x9;.SetMaxResults(30)&#xA;&#x9;&#x9;.Future&lt;Blog&gt;();&#xA;&#x9;var countOfBlogs = s.CreateCriteria&lt;Blog&gt;()&#xA;&#x9;&#x9;.SetProjection(Projections.Count(Projections.Id()))&#xA;&#x9;&#x9;.FutureValue&lt;int&gt;();&#xA;&#xA;&#x9;Console.WriteLine(&quot;Number of blogs: {0}&quot;, countOfBlogs.Value);&#xA;&#x9;foreach (var blog in blogs)&#xA;&#x9;{&#xA;&#x9;&#x9;Console.WriteLine(blog.Title);&#xA;&#x9;}&#xA;&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;Now, we seem a different result:&#xA;&#xA; &#xA;&#xA; &#xA;&#xA;Instead of going to the database twice, we only go once, with both queries at once. The speed difference is quite dramatic, 80 ms instead of 114 ms, so we saved about 30% of the total data access time and a total of 34 ms.&#xA;&#xA;To make things even more interesting, it gets better the more queries that you use. Let us take the following scenario. We want to show the front page of a blogging site, which should have:&#xA;&#xA;&#xA;  A grid that allow us to page through the blogs. &#xA;&#xA;  Most recent posts. &#xA;&#xA;  All categories &#xA;&#xA;  All tags &#xA;&#xA;  Total number of comments &#xA;&#xA;  Total number of posts &#xA;&#xA;&#xA;For right now, we will ignore caching, and just look at the queries that we need to handle. I think that you can agree that this is not an unreasonable amount of data items to want to show on the main page. For that matter, just look at this page, and you can probably see as much data items or more.&#xA;&#xA;Here is the code using the Future options:&#xA;&#xA;&#xA;  using (var s = sf.OpenSession())&#xA;using (var tx = s.BeginTransaction())&#xA;{&#xA;&#x9;var blogs = s.CreateCriteria&lt;Blog&gt;()&#xA;&#x9;&#x9;.SetMaxResults(30)&#xA;&#x9;&#x9;.Future&lt;Blog&gt;();&#xA;&#xA;&#x9;var posts = s.CreateCriteria&lt;Post&gt;()&#xA;&#x9;&#x9;.AddOrder(Order.Desc(&quot;PostedAt&quot;))&#xA;&#x9;&#x9;.SetMaxResults(10)&#xA;&#x9;&#x9;.Future&lt;Post&gt;();&#xA;&#xA;&#x9;var tags = s.CreateCriteria&lt;Tag&gt;()&#xA;&#x9;&#x9;.AddOrder(Order.Asc(&quot;Name&quot;))&#xA;&#x9;&#x9;.Future&lt;Tag&gt;();&#xA;&#xA;&#x9;var countOfPosts = s.CreateCriteria&lt;Post&gt;()&#xA;&#x9;&#x9;.SetProjection(Projections.Count(Projections.Id()))&#xA;&#x9;&#x9;.FutureValue&lt;int&gt;();&#xA;&#xA;&#x9;var countOfBlogs = s.CreateCriteria&lt;Blog&gt;()&#xA;&#x9;&#x9;.SetProjection(Projections.Count(Projections.Id()))&#xA;&#x9;&#x9;.FutureValue&lt;int&gt;();&#xA;&#xA;&#x9;var countOfComments = s.CreateCriteria&lt;Comment&gt;()&#xA;&#x9;&#x9;.SetProjection(Projections.Count(Projections.Id()))&#xA;&#x9;&#x9;.FutureValue&lt;int&gt;();&#xA;&#xA;&#x9;Console.WriteLine(&quot;Number of blogs: {0}&quot;, countOfBlogs.Value);&#xA;&#xA;&#x9;Console.WriteLine(&quot;Listing of blogs&quot;);&#xA;&#x9;foreach (var blog in blogs)&#xA;&#x9;{&#xA;&#x9;&#x9;Console.WriteLine(blog.Title);&#xA;&#x9;}&#xA;&#xA;&#x9;Console.WriteLine(&quot;Number of posts: {0}&quot;, countOfPosts.Value);&#xA;&#x9;Console.WriteLine(&quot;Number of comments: {0}&quot;, countOfComments.Value);&#xA;&#x9;Console.WriteLine(&quot;Recent posts&quot;);&#xA;&#x9;foreach (var post in posts)&#xA;&#x9;{&#xA;&#x9;&#x9;Console.WriteLine(post.Title);&#xA;&#x9;}&#xA;&#xA;&#x9;Console.WriteLine(&quot;All tags&quot;);&#xA;&#x9;foreach (var tag in tags)&#xA;&#x9;{&#xA;&#x9;&#x9;Console.WriteLine(tag.Name);&#xA;&#x9;}&#xA;&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;This generates the following:&#xA;&#xA; &#xA;&#xA;And the actual SQL that is sent to the database is:&#xA;&#xA;&#xA;  SELECT top 30 this_.Id             as Id5_0_,&#xA;              this_.Title          as Title5_0_,&#xA;              this_.Subtitle       as Subtitle5_0_,&#xA;              this_.AllowsComments as AllowsCo4_5_0_,&#xA;              this_.CreatedAt      as CreatedAt5_0_&#xA;FROM   Blogs this_&#xA;SELECT   top 10 this_.Id       as Id7_0_,&#xA;                this_.Title    as Title7_0_,&#xA;                this_.Text     as Text7_0_,&#xA;                this_.PostedAt as PostedAt7_0_,&#xA;                this_.BlogId   as BlogId7_0_,&#xA;                this_.UserId   as UserId7_0_&#xA;FROM     Posts this_&#xA;ORDER BY this_.PostedAt desc&#xA;SELECT   this_.Id       as Id4_0_,&#xA;         this_.Name     as Name4_0_,&#xA;         this_.ItemId   as ItemId4_0_,&#xA;         this_.ItemType as ItemType4_0_&#xA;FROM     Tags this_&#xA;ORDER BY this_.Name asc&#xA;SELECT count(this_.Id) as y0_&#xA;FROM   Posts this_&#xA;SELECT count(this_.Id) as y0_&#xA;FROM   Blogs this_&#xA;SELECT count(this_.Id) as y0_&#xA;FROM   Comments this_&#xA;&#xA;&#xA;That is great, but what would happen if we would use List and UniqueResult instead of Future and FutureValue?&#xA;&#xA;I&#x2019;ll not show the code, since I think it is pretty obvious how it will look like, but this is the result:&#xA;&#xA; &#xA;&#xA;Now it takes 348ms to execute vs. 259ms using the Future pattern.&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;It is still in the 25% &#x2013; 30% speed increase, but take note about the difference in time. Before, we saved 34 ms. Now, we saved 89 ms. &#xA;&#xA;Those are pretty significant numbers, and those are against a very small database that I am running locally, against a database that is on another machine, the results would have been even more dramatic.</p>
        </article>
        <article id="article-6004">
            <a href="https://ayende.com/blog/3978/the-repositorys-daughter" target="_blank">
                <h2 class="title mb-6" id="article-6004">The Repository&#x2019;s Daughter</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 26, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Keeping up with the undead theme, this post is a response to Greg&#x2019;s. I&#x2019;ll just jump into the parts that I disagree with:     The boundary is not arbitrary or artificial. The boundary comes back to the reasons we were actually creating a domain model in the first place. it seems what Oren is actually arguing against is not whether &#x201C;advances in ORMs&#x201D; have changed things but that he questions the isolation at all. The whole point of the separation is to remove such details from our thinking when we deal with the domain and to make explicit the boundaries around the domain and the contracts of those boundaries.   As I understand Greg&#x2019;s interpretation of my points, I agree. For quite a few needs, there is no need to create an explicit boundary between the persistence medium and the code. Transparent lazy loading and persistence by reachability allow us to hand the entire problem to the infrastructure. The two things that we have to worry about it controlling the fetch paths and making sure that we aren&#x2019;t doing stupid things like calling the database in a loop.  Those things are the responsibilities of the controllers layer (not necessarily an MVC controller, by the way, I am talking about the highest level in the app that isn&#x2019;t actually about presentation concerns).     If we take Oren&#x2019;s advice, we can store our data anywhere &#x2026; so long as it looks and acts like a database. If that is not the case then oops we have to either         Make it look and act like a full database      Scrap our code that treated it as such and go back to the explicit route.       Just to be clear on this point &#x2026; He has baked in fetch paths, full criteria, and ordering into his Query objects so any new implementation would also have to support all of those things.Tell me how do you do this when you are getting your data now from an explicit service?   Well, duh! Of course they would need that. We need to be able to do that to be able to execute business logic. Going back to the example that I gave in the previous post, &#x201C;Add Product&#x201D; and &#x201C;Charge Order&#x201D; have drastically different data requirements, how are you going to handle that without having support for fetch paths?  The last statement there is quite telling, I think. I thought that my previous post made it clear that I am advocating doing this inside a service boundary. The problem that Greg is trying to state doesn&#x2019;t exist since you don&#x2019;t do that across a service boundary.     Its not just about YAGNI its about risk management. We make the decision early (Port/Adapter) that will allow us to delay other decisions. It also costs us next to nothing up front to allow for our change later. YAGNI should never be used without thought of risk management, we should always be able to quantify our initial cost, the probability of change, and the cost of the change in the future.   I call bull on that. Saying that it using an adapter cost &#x201C;next to nothing&#x201D; is wrong and misleading. Leaving aside the problems of trying to expose the advance functionality that you need aside, it also doesn&#x2019;t work. A good example would be using a repository using NHibernate, which take part in a Unit of Work and uses persistence by reachability and auto flush on dirty.  Chances are, the developers aren&#x2019;t even aware that they are taking advantage of all of that. Trying to switch that with a web service based repository introduce quite a lot of friction to the mix. I know, I was there, and I saw what it did.  That is leaving aside things like how do you expose concurrency violations or transaction deadlocks using different persistence options. You need to control that, and an adapter is generally either a very leaky abstract or a huge effort to write, and it is still leaky. Worse, using an adapter, you are forced to go with the lowest common denominator for features. Of course you would want to isolate that, you are working at a level so low you might as well be writing things to the disk without the benefit of even a file system. That doesn&#x2019;t mean that this is the smart choice.  Trying to abstract things away unless you have a firm requirement is just about the definition of YAGNI. And handwaving effort required to build this sort of infrastructure doesn&#x2019;t really make it go away.  Yes, the approach that I am advocating makes a lot of assumptions. If you remove any of them, the approach that I am advocating is invalid. But when the assumptions are valid (inside a service boundary, using a database, using a smart persistence framework), not making use of that is&#x2026; stealing from your client.  Arguments against my approach should be made in the context that I am establishing it.      Let me point out a large failure in logic here. You assume an impedance mismatch with a relational database that results in a much higher cost of getting the children with the parents. If I am using other mechanisms like say storing the ShoppingCart as a document in CouchDb that the cost will be nearly identical whether I bring back only the Cart or the Items.   Again, I am talking about something in context. Taking it out of context make the argument invalid. I am going to stop here, because I don&#x2019;t think that there is any value in parallel monologues. Arguments against the approach that I suggesting should be made in the context that I am outlying my suggestion, not outside it.</p>
        </article>
        <article id="article-6005">
            <a href="https://ayende.com/blog/3977/the-difference-between-infrastructure-application" target="_blank">
                <h2 class="title mb-6" id="article-6005">The difference between Infrastructure &amp; Application</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 25, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Recently I am finding myself writing more and more infrastructure level code. Now, there are several reasons for that, mostly because the architectural approaches that I advocate don&#x2019;t have a good enough infrastructure in the environment that I usually work with.  Writing infrastructure is both fun &amp; annoying. It is fun because usually you don&#x2019;t have business rules to deal with, it is annoying because it take time to get it to do something that will give the business some real value.  That said, there are some significant differences between writing application level code and infrastructure level code. For that matter, I usually think about this as:     Infrastructure code is usually the base, it provides basic services such as communication, storage, thread management, etc. It should also provide strong guarantees regarding what it is doing, it should be simple, understandable and provide the hooks to understand what happens when things go wrong.  Framework code is sitting on top of the infrastructure, and provide easy to use semantics on top of that. They usually take away some of the options that the infrastructure give you in order to present a more focused solution for a particular scenario.  App code is even more specific than that, making use of the underlying framework to deal with much of the complexities that we have to deal with.  Writing application code is easy, it is a single purpose piece of code. Writing framework and infrastructure code is harder, they have much more applicability.  So far, I don&#x2019;t believe that I said anything new.  What is important to understand is that practices that works for application level code does not necessarily work for infrastructure code. A good example would be this nasty bit of work. It doesn&#x2019;t read very well, and it has some really long methods, and&#x2026; it handle a lot of important infrastructure concerns that you have to deal with. For example, it is completely async, has good error handling and reporting and it has absolutely no knowledge about what exactly it is doing. That is left for higher level pieces of the code. Trying to apply application code level of practices to that will not really work, different constraints and different requirements.  By the same token, testing such code follow a different pattern than testing application level code. Tests are often more complex, requiring more behavior in the test to reproduce real world scenarios. And the tests can rarely be isolated bits, they usually have to include significant pieces of the infrastructure. And what they test can be complex enough as well.  Different constraints and different requirements.</p>
        </article>
        <article id="article-6006">
            <a href="https://ardalis.com/cloud-computing-with-force-com/" target="_blank">
                <h2 class="title mb-6" id="article-6006">Cloud Computing with Force.com</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 24, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Lake Quincy Media uses SalesForce.com as our CRM to manage our leads and customers and keep our salespeople organized. Overall we&#x2019;ve been&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-6007">
            <a href="https://ayende.com/blog/3976/nhibernate-2nd-level-cache" target="_blank">
                <h2 class="title mb-6" id="article-6007">NHibernate 2nd Level Cache</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 24, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">NHibernate has a builtin support for caching. It sounds like a trivial feature at first, until you realize how significant it is that the underlying data access infrastructure already implements it. It means that you don&#x2019;t have to worry about thread safety, propagating changes in a farm, built smart cache invalidation strategies or deal with all of the messy details that are usually along for the ride when you need to implement a non trivial infrastructure piece.  And no, it isn&#x2019;t as simple as just shoving a value to the cache.  I spent quite a bit of time talking about this here, so I wouldn&#x2019;t go about all the cache internals and how they work, but I&#x2019;ll mention the highlights. NHibernate internally has the following sub caches:     Entity Cache    Collection Cache    Query Cache    Timestamp Cache   NHibernate make use of all of them in a fairly complex way to ensure that even though we are using the cache, we are still presenting a consistent view of the cache as a mirror of the database. The actual details of how we do it can be found here.  Another thing that NHibernate does for us when we update the cache is try to maintain the consistent view of the world even when using replicated caches used in a farm scenarios. This requires some support from the caching infrastructure, such as the ability to perform a hard lock on the values. Of the free caching providers for NHibernate, only Velocity support this, which means that when we evaluate a cache provider for NHibernate to be used, we need to take this into account.  In general, we can pretty much ignore this, but it does have some interesting implications with regards to what are the isolation guarantees that we can make based on the cache implementation that we use, the number of machines we use and the cache concurrency strategy that we use.  You can read about this here and here.  One thing that you should be aware of is that NHibernate currently doesn&#x2019;t have transaction cache concurrency story, mostly because there is no cache provider that can give us that. As such, be aware that if you require serializable isolation level to work with your entities, you cannot use the 2nd level cache. The 2nd level cache currently guarantee only read committed (and almost guarantee repeatable read if this is the isolation level that you use in the database). Note that this guarantee is made for read-write cache concurrency mode only.</p>
        </article>
        <article id="article-6008">
            <a href="https://ayende.com/blog/3975/find-the-bug" target="_blank">
                <h2 class="title mb-6" id="article-6008">Find the bug</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 24, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Can you find the bug in here?     public void Receiver(object ignored)&#xA;{&#xA;&#x9;while (keepRunning)&#xA;&#x9;{&#xA;&#x9;&#x9;using (var tx = new TransactionScope())&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;Message msg;&#xA;&#x9;&#x9;&#x9;try&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;msg = receiver.Receive(&quot;uno&quot;, null, new TimeSpan(0, 0, 10));&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;catch (TimeoutException)&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;continue;&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;catch(ObjectDisposedException)&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;continue;&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;lock (msgs)&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;msgs.Add(Encoding.ASCII.GetString(msg.Data));&#xA;&#x9;&#x9;&#x9;&#x9;Console.WriteLine(msgs.Count);&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;tx.Complete();&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;And:&#xA;&#xA;&#xA;  [Fact]&#xA;public void ShouldOnlyGetTwoItems()&#xA;{&#xA;&#x9;ThreadPool.QueueUserWorkItem(Receiver);&#xA;&#xA;&#x9;Sender(4);&#xA;&#xA;&#x9;Sender(5);&#xA;&#xA;&#x9;while(true)&#xA;&#x9;{&#xA;&#x9;&#x9;lock (msgs)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;if (msgs.Count&gt;1)&#xA;&#x9;&#x9;&#x9;&#x9;break;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;Thread.Sleep(100);&#xA;&#x9;}&#xA;&#x9;Thread.Sleep(2000);//let it try to do something in addition to that&#xA;&#x9;receiver.Dispose();&#xA;&#x9;keepRunning = false;&#xA;&#xA;&#x9;Assert.Equal(2, msgs.Count);&#xA;&#x9;Assert.Equal(&quot;Message 4&quot;, msgs[0]);&#xA;&#x9;Assert.Equal(&quot;Message 5&quot;, msgs[1]);&#xA;}&#xA;&#xA;&#xA;I will hint that you cannot make any part of the receiver after it was disposed.</p>
        </article>
        <article id="article-6009">
            <a href="https://ayende.com/blog/3974/esent-identity-and-the-case-of-the-duplicate-key" target="_blank">
                <h2 class="title mb-6" id="article-6009">Esent, identity and the case of the duplicate key</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 24, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Following up on a bug report that I got from a user of Rhino Queues, I figured out something very annoying about the way Esent handles auto increment columns.  Let us take the following bit of code:     using (var instance = new Instance(&quot;test.esent&quot;))&#xA;{&#xA;&#x9;instance.Init();&#xA;&#xA;&#x9;using (var session = new Session(instance))&#xA;&#x9;{&#xA;&#x9;&#x9;JET_DBID dbid;&#xA;&#x9;&#x9;Api.JetCreateDatabase(session, &quot;test.esent&quot;, &quot;&quot;, out dbid, CreateDatabaseGrbit.OverwriteExisting);&#xA;&#xA;&#x9;&#x9;JET_TABLEID tableid;&#xA;&#x9;&#x9;Api.JetCreateTable(session, dbid, &quot;outgoing&quot;, 16, 100, out tableid);&#xA;&#x9;&#x9;JET_COLUMNID columnid;&#xA;&#xA;&#x9;&#x9;Api.JetAddColumn(session, tableid, &quot;msg_id&quot;, new JET_COLUMNDEF&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;coltyp = JET_coltyp.Long,&#xA;&#x9;&#x9;&#x9;grbit = ColumndefGrbit.ColumnNotNULL |&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ColumndefGrbit.ColumnAutoincrement |&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ColumndefGrbit.ColumnFixed&#xA;&#x9;&#x9;}, null, 0, out columnid);&#xA;&#xA;&#x9;&#x9;Api.JetCloseDatabase(session, dbid, CloseDatabaseGrbit.None);&#xA;&#x9;}&#xA;}&#xA;&#xA;for (int i = 0; i &lt; 3; i&#x2B;&#x2B;)&#xA;{&#xA;&#x9;using (var instance = new Instance(&quot;test.esent&quot;))&#xA;&#x9;{&#xA;&#x9;&#x9;instance.Init();&#xA;&#xA;&#x9;&#x9;using (var session = new Session(instance))&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;JET_DBID dbid;&#xA;&#x9;&#x9;&#x9;Api.JetAttachDatabase(session, &quot;test.esent&quot;, AttachDatabaseGrbit.None);&#xA;&#x9;&#x9;&#x9;Api.JetOpenDatabase(session, &quot;test.esent&quot;, &quot;&quot;, out dbid, OpenDatabaseGrbit.None);&#xA;&#xA;&#x9;&#x9;&#x9;using (var table = new Table(session, dbid, &quot;outgoing&quot;, OpenTableGrbit.None))&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;var cols = Api.GetColumnDictionary(session, table);&#xA;&#x9;&#x9;&#x9;&#x9;var bytes = new byte[Api.BookmarkMost];&#xA;&#x9;&#x9;&#x9;&#x9;int size;&#xA;&#x9;&#x9;&#x9;&#x9;using (var update = new Update(session, table, JET_prep.Insert))&#xA;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;update.Save(bytes, bytes.Length, out size);&#xA;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;&#x9;Api.JetGotoBookmark(session, table, bytes, size);&#xA;&#x9;&#x9;&#x9;&#x9;var i = Api.RetrieveColumnAsInt32(session, table, cols[&quot;msg_id&quot;]);&#xA;&#x9;&#x9;&#x9;&#x9;Console.WriteLine(i);&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;Api.JetDelete(session, table);&#xA;&#x9;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;&#x9;Api.JetCloseDatabase(session, dbid, CloseDatabaseGrbit.None);&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;What do you think is going to be the output of this code?&#xA;&#xA;If you guessed:&#xA;&#xA;&#xA;  1&#xA;    1&#xA;&#xA;    1&#xA;&#xA;&#xA;I have a cookie for you.&#xA;&#xA;One of the problems of working with low level libraries is that they are&#x2026; well, low level. As such, they don&#x2019;t provide all the features that you think they would. Most databases keep track of the auto incrementing columns outside of the actual table. But Esent keep it in memory, and read max(id) from the table on init.&#xA;&#xA;It is an&#x2026; interesting bug* to track down, I have to say.&#xA;&#xA;* Bug in my code, no in Esent, just to be clear.</p>
        </article>
        <article id="article-6010">
            <a href="https://ayende.com/blog/3973/night-of-the-living-repositories" target="_blank">
                <h2 class="title mb-6" id="article-6010">Night of the living Repositories</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 23, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is a response to Greg&#x2019;s post in reply to mine. I can&#x2019;t recall the last time I had a blog debate, they are usually fun to have. I am going to comment on Greg&#x2019;s post as I read it. So this part is written before I did anything but skim the first paragraph or so.  A few things that I want to clarify:          His post was originally intended to be an &#x201C;alternative to the repository pattern&#x201D; which he believes &#x201C;is dead&#x201D;.      Of course this is far from a new idea      First, careful re-reading of the actual post doesn&#x2019;t show me where I said that the repository pattern is dead. What I said was that the pattern doesn&#x2019;t take into account advances in the persistence frameworks, and that in many cases, applying it on top of existing persistence framework don&#x2019;t give us much.  The notion of query objects is also far from my invention, this is just to clear that out, it is a well established pattern that I am particularly fond of.  Now, let us move to the part that I really object to:     What is particularly annoying is the sensationalism associated with this post. It is extremely odd to argue against a pattern by suggesting to use the pattern eh? The suggested way to avoid the Repository pattern is to use the Repository pattern which shortening the definition he provided    Provides the domain collection semantics to a set of aggregate root objects.    So now that we have determined that he has not actually come up with anything new and is actually still using repositories let&#x2019;s reframe the original argument into what it really is.   I fail to see how I am suggesting the use of the repository pattern in my post. This seems to be a fairly important point in Greg&#x2019;s argument. And no, I don&#x2019;t follow how I did that. Using the approach that I outlined in the post, there is no such thing as repository. Persistence concerns are handled by the persistence framework directly (using ISession in NHibernate, for example), queries are handled using Query Objects.  The notion of providing in memory collection semantics is not needed anymore, because that responsibility is no longer in the user code, it is the responsibility of the underlying persistence framework. Also note that I explicitly targeted the general use of the repository, not just the DDD use of it.      The problem here is that the Repository interface is not necessarily Object Oriented. The Repository represents an architectural boundary, it is intended to be a LAYER/TIER boundary. Generally speaking when we define such interfaces we define them in a procedural manner (and with good cause).   Hm, I can see Greg&#x2019;s point here, but I am not sure that I agree with him here. I would specify it differently .Service boundaries are procedural (be it RPC or message based, doesn&#x2019;t matter). But a service spans both layers and tiers, and I am not going to try to create artificial boundaries inside my service. And yes, they are artificial. Remember: &#x201C;A Repository mediates between the domain and data mapping layers&#x2026;&#x201D;  A repository is a gateway to the actual persistence store. The persistence store itself may be another service, it is usually a remote machine, and the interface to that is by necessity pretty procedural. Trying to model a repository on top of that would by necessity lead us to procedural code. But that is a bad thing.   The problem is, again, we aren&#x2019;t attempting to take advantage on the capabilities of the persistence frameworks that we have. We can have OO semantics on top of persistence store, because the responsibility to handle that is in the hands of the persistence framework.      Analyzing the situation given of a CustomerRepository what would happen if we were to want to put the data access behind a remote facade?   I am going to call YAGNI on that. Until and unless I have that requirement, I am not going to think about that. There is a reason we have YAGNI. And there is a reason why I don&#x2019;t try to give architectural advice without having a lot more context. In this case, we have a future requirement that doesn&#x2019;t really make sense at all.     What would happen though if we used the &#x201C;other&#x201D; Repository interface that is being suggested? Well our remote facade would need to support the passing of any criteria dynamically across its contract, this is generally considered bad contract design as we then will have great trouble figuring out and optimizing what our service actually does.   If I need to make the data access remotely, then I am still within my own service (remember, services can span several machines, and multiple applications can take part of the same service). As such, I know exactly what the requirements and the queries that my remote data access is going to require. More than that, within a&#xA0; service, I want as much flexibility as I can get.  It is on a service boundary, that I start pouring out concrete and post the armed guards.  I also think that there is some sort of miscommunication, or perhaps, as usual, I split a thought across several posts, because a few posts after the post Greg is talking about, I suggested just what he is talking about.     If you don&#x2019;t want a LAYER/TIER boundary don&#x2019;t have one just use nhibernate directly &#x2026;   That is what I am advocating. Or Linq to Sql, or whatever ( as long as it has enough smarts to support what you need without doing nasty things to your code).  My whole argument is that the persistence framework is smart enough today that we don&#x2019;t need to roll this stuff by hand anymore!     At this point you probably shouldn&#x2019;t have a domain either though &#x2026;   And I call bull on that. Repositories != domain, and how you do data access has nothing to do with how you structure your application.  Something that me &amp; Greg &amp; Udi have discussed quite often in the past is the notion of Command Query Separation. I&#x2019;ll let Greg talk about that, and then add my comments:     I have had this smell in the past as well but instead of destroying the layering I am building into my domain (with good reason, see DDD by Evans for why) I went a completely different route. I noticed very quickly that it was by some random chance that my fetch plans were being different. I had a very distinct place where things were different, I needed very different fetching plans between when I was getting domain objects to perform a writing behaviour on them as opposed to when I was reading objects to say build a DTO.   Well, yes &amp; no. There are quite a few scenarios in which I want to have a different fetch plan for writing behavior even when using CQS. But before I show the example, I want to point out that it is just an example. Don&#x2019;t try to nitpick this example, talk about the generic principle.  A simple example would be a shopping cart, and the following commands:     AddProduct { ProductId = 12, Quantity = 2}         This require us to check if the product already exists in the cart, so we need to load the Items collections       Purchase         We can execute this with properties local to the shopping cart, so no need to load the items collection, this just charge the customer and change the cart status to Ordered      As I said, this is a simple example, and you could probably poke holes in it, that is not the point. The point is that this is a real example of real world issues. There is a reason why IFetchingStrategy is such an important concept.  That is leaving aside that like all architectural patterns, CQS is something that you shouldn&#x2019;t just apply blindly. You should make a decision base on additional complexity vs. required scope before using it. And in many applications, CQS, or a separate OLTP vs. Reporting models, are often not necessary.   And yes, they are not big applications, with a lot of users and a lot of data, but they are often important applications, with a lot of complexity and behavior.</p>
        </article>
        <div class="button flex justify-between">
            <a href="600.html"><span class="back arrow"></span></a>

            <a href="602.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>