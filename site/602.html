
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 602 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-6011">
            <a href="https://ayende.com/blog/3943/nhibernate-mapping-set" target="_blank">
                <h2 class="title mb-6" id="article-6011">NHibernate Mapping - &lt;set/&gt;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 13, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">And now it is time to go to the &lt;set/&gt; and explore it. Most of the collections in NHibernate follow much the same rules, so I am not going to go over them in details:     &lt;set&#xA;    name=&quot;propertyName&quot;                                         (1)&#xA;    table=&quot;table_name&quot;                                          (2)&#xA;    schema=&quot;schema_name&quot;                                        (3)&#xA;    lazy=&quot;true|false&quot;                                           (4)&#xA;    inverse=&quot;true|false&quot;                                        (5)&#xA;    cascade=&quot;all|none|save-update|delete|all-delete-orphan&quot;     (6)&#xA;    sort=&quot;unsorted|natural|comparatorClass&quot;                     (7)&#xA;    order-by=&quot;column_name asc|desc&quot;                             (8)&#xA;    where=&quot;arbitrary sql where condition&quot;                       (9)&#xA;    fetch=&quot;select|join|subselect&quot;                               (10)&#xA;    batch-size=&quot;N&quot;                                              (11)&#xA;    access=&quot;field|property|ClassName&quot;                           (12)&#xA;    optimistic-lock=&quot;true|false&quot;                                (13)&#xA;    outer-join=&quot;auto|true|false&quot;                                (14)&#xA;&gt;&#xA;&#xA;    &lt;key .... /&gt;&#xA;    &lt;one-to-many .... /&gt;&#xA;&lt;/set&gt;&#xA;&#xA;&#xA;1) is the collection property name, just like &lt;property/&gt; or &lt;many-to-one/&gt; are the value property names.&#xA;&#xA;2) table is obviously the table name in which the values for this association exists.&#xA;&#xA;3) schema is the schema in which that table lives.&#xA;&#xA;4) lazy controls whatever this collection will be lazy loaded or not. By default it is set to true. Let us see how this work:&#xA;&#xA;&#xA;  &lt;set name=&quot;Posts&quot; table=&quot;Posts&quot;&gt;&#xA;&#x9;&lt;key column=&quot;BlogId&quot;/&gt;&#xA;&#x9;&lt;one-to-many class=&quot;Post&quot;/&gt;&#xA;&lt;/set&gt;&#xA;&#xA;&#xA;With the following code:&#xA;&#xA;&#xA;  using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var blog = session.Get&lt;Blog&gt;(1);&#xA;&#x9;foreach (var post in blog.Posts)&#xA;&#x9;{&#xA;&#x9;&#x9;Console.WriteLine(post.Title);&#xA;&#x9;}&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;This produces the following statements:&#xA;&#xA; &#xA;&#xA; &#xA;&#xA;We need two select statements to load the data.&#xA;&#xA;However, if we change the set definition to:&#xA;&#xA;&#xA;  &lt;set name=&quot;Posts&quot; table=&quot;Posts&quot; lazy=&quot;false&quot;&gt;&#xA;&#x9;&lt;key column=&quot;BlogId&quot;/&gt;&#xA;&#x9;&lt;one-to-many class=&quot;Post&quot;/&gt;&#xA;&lt;/set&gt;&#xA;&#xA;&#xA;We&#x2026; would get the exact same output. Why is that? &#xA;&#xA;The answer is quite simple, lazy only control whatever the collection will be loaded lazily or not. It does not control how we load it. The default is to use a second select for that, because that tend to be more efficient in the general case, since this avoid the possibility of a Cartesian product. There are other options, of course.&#xA;&#xA;If we just set lazy to false, it means that when we load the entity, we load the collection. The reason that we see the same output from SQL perspective is that we don&#x2019;t have a time perspective of that. With lazy set to true, the collection will only be loaded in the foreach. With lazy set to true, the collection will be loaded on the Get call.&#xA;&#xA;You are probably interested in outer-join, which we can set to true, which will give us:&#xA;&#xA;&#xA;  &lt;set name=&quot;Posts&quot; table=&quot;Posts&quot; outer-join=&quot;true&quot;&gt;&#xA;&#x9;&lt;key column=&quot;BlogId&quot;/&gt;&#xA;&#x9;&lt;one-to-many class=&quot;Post&quot;/&gt;&#xA;&lt;/set&gt;&#xA;&#xA;&#xA;And would result in the following SQL:&#xA;&#xA; &#xA;&#xA;Here we get both the blog and its posts in a single query to the server. &#xA;&#xA;The reason that lazy is somewhat complicated is that there are quite a bit of options to select from when choosing the fetching strategy for the collection, and in general, it is suggested that you would not set this in the mapping, because that is usually too generic. It is preferred to control this at a higher level, when you are actually making use of the entities.&#xA;&#xA;5) inverse is something that I talk about extensively here, so I&#x2019;ll not repeat this.&#xA;&#xA;6) cascade is also something that I already talked about&#xA;&#xA;7) sort gives you a way to sort the values in the collection, by providing a comparator. Note that this is done in memory, not in the database. The advantage is that it will keep thing sorted even for values that you add to the collection in memory.&#xA;&#xA;8) order-by gives you the ability to sort the values directly from the database. &#xA;&#xA;Note that both 7 &amp; 8 does not work with generic sets and that in general, you don&#x2019;t want to rely on those ordering properties, you want to use the natural properties of the selected collection. Sets are, by definition, unordered set of unique elements. But generic sorted bags does work:&#xA;&#xA;&#xA;  &lt;bag name=&quot;Posts&quot; table=&quot;Posts&quot; order-by=&quot;Title ASC&quot;&gt;&#xA;&#x9;&lt;key column=&quot;BlogId&quot;/&gt;&#xA;&#x9;&lt;one-to-many class=&quot;Post&quot;/&gt;&#xA;&lt;/bag&gt;&#xA;&#xA;&#xA;And would produce in the following SQL:&#xA;&#xA;&#xA0;&#xA;&#xA;9) where allow us to use some arbitrary SQL expression to limit the values in the collection. Usually this is used to filter out things like logically deleted rows. Here is a silly example:&#xA;&#xA;&#xA;  &lt;set name=&quot;Posts&quot; table=&quot;Posts&quot;&#xA;&#x9;&#x9;  where=&quot;(len(Title) &gt; 6)&quot;&gt;&#xA;&#x9;&lt;key column=&quot;BlogId&quot;/&gt;&#xA;&#x9;&lt;one-to-many class=&quot;Post&quot;/&gt;&#xA;&lt;/set&gt;&#xA;&#xA;&#xA;Which would result in:&#xA;&#xA; &#xA;&#xA;Note that there is important subtlety here, if you intend to use this collection with eager loading, you must make sure that your where clause can handle null values appropriately (in the case of an outer join).&#xA;&#xA;10) fetch controls how we get the values from the database. There are three values, select, join and subselect. The default is select, and you are already familiar with it. Setting it to join would result in:&#xA;&#xA;&#xA;  &lt;set name=&quot;Posts&quot; table=&quot;Posts&quot; fetch=&quot;join&quot;&gt;&#xA;&#x9;&lt;key column=&quot;BlogId&quot;/&gt;&#xA;&#x9;&lt;one-to-many class=&quot;Post&quot;/&gt;&#xA;&lt;/set&gt;&#xA;&#xA;&#xA;And the following code:&#xA;&#xA;&#xA;  using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var blog = session.CreateCriteria(typeof(Blog))&#xA;&#x9;&#x9;.SetMaxResults(5)&#xA;&#x9;&#x9;.List&lt;Blog&gt;()[0];&#xA;&#x9;foreach (var post in blog.Posts)&#xA;&#x9;{&#xA;&#x9;&#x9;Console.WriteLine(post.Title);&#xA;&#x9;}&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;Will give us:&#xA;&#xA; &#xA;&#xA;Setting it to subselect will show something quite a bit more interesting:&#xA;&#xA; &#xA;&#xA;We have two queries, the first to load the blogs, and the second one:&#xA;&#xA; &#xA;&#xA;In this case, we load all the related posts using a subselect. This is probably one of the more efficient ways of doing this. We load all the posts for all the blogs in a single query. That assumes, of course, that we actually want to use all those posts. In the code seen above, this is actually a waste, since we only ever access the first blog Posts collection.&#xA;&#xA;11) batch-size is another way of controlling how we load data from the database. It is similar to fetch, but it gives us more control. Let us see how it actually work in action before we discuss it.&#xA;&#xA;&#xA;  &lt;set name=&quot;Posts&quot; table=&quot;Posts&quot; batch-size=&quot;5&quot;&gt;&#xA;&#x9;&lt;key column=&quot;BlogId&quot;/&gt;&#xA;&#x9;&lt;one-to-many class=&quot;Post&quot;/&gt;&#xA;&lt;/set&gt;&#xA;&#xA;&#xA;And this code:&#xA;&#xA;&#xA;  using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var blogs = session.CreateCriteria(typeof(Blog))&#xA;&#x9;&#x9;.SetMaxResults(30)&#xA;&#x9;&#x9;.List&lt;Blog&gt;();&#xA;&#x9;foreach (var post in blogs.SelectMany(x=&gt;x.Posts))&#xA;&#x9;{&#xA;&#x9;&#x9;Console.WriteLine(post.Title);&#xA;&#x9;}&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;Produces:&#xA;&#xA; &#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;Fist we load the blogs, and we load 30 of them. Now, when we access any of the unloaded collections, something very interesting is going to happen. NHibernate is going to search for up to batch-size unloaded collections of the same type and try to load them all in a single query. The idea is that we take a SELECT N&#x2B;1 situation and turn that into a SELECT N/batch-size &#x2B; 1 situation.&#xA;&#xA;In this case, it will turn a 31 queries situation into a 7 queries situation. And we can increase the batch size a bit to reduce this even further. As usual, we have to balance the difference between local and global optimizations. If we make batch-size too large, we load too much data, if we make it too small, we still have too many queries.&#xA;&#xA;This is one of the reasons that I consider those fancy options important, but not as important as setting the fetching strategy for each scenario independently. That is usually a much better strategy overall.&#xA;&#xA;12) access was already discussed elsewhere.&#xA;&#xA;13) optimistic-lock was already discussed elsewhere.&#xA;&#xA;14) outer-join was discussed above, when we talked about lazy.</p>
        </article>
        <article id="article-6012">
            <a href="https://ayende.com/blog/3942/nhibernate-mapping-dynamic-component" target="_blank">
                <h2 class="title mb-6" id="article-6012">NHibernate Mapping - &lt;dynamic-component/&gt;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 11, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Like the &lt;component/&gt; mapping, &lt;dynamic-component/&gt; allows us to treat parts of the entity table in a special way. In this case, it allow us to push properties from the mapping into a dictionary, instead of having to have the entity have properties for it.   This is very useful when we need to build dynamically extended entities, where the client can add columns on the fly.   Let us take this entity as an example:     And this table:    Where we want to have the SSN accessible from our entity, but without modifying its structure. We can do this using &lt;dynamic-component/&gt;:     &lt;class name=&quot;Person&quot;&#xA;&#x9;&#x9;table=&quot;People&quot;&gt;&#xA;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;identity&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;property name=&quot;Name&quot; /&gt;&#xA;&#xA;&#x9;&lt;dynamic-component name=&quot;Attributes&quot;&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;SSN&quot;&#xA;&#x9;&#x9;&#x9;type=&quot;System.String&quot;/&gt;&#xA;&#x9;&lt;/dynamic-component&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&#xA;And the query just treat this as yet another column in the table:</p>
        </article>
        <article id="article-6013">
            <a href="https://ayende.com/blog/3941/nhibernate-mapping-inheritance" target="_blank">
                <h2 class="title mb-6" id="article-6013">NHibernate Mapping &#x2013; Inheritance</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 10, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I wanted to explore a few options regarding the way we can map inheritance using NHibernate. Here is the model that we are going to use:   And the code that we are going to execute:     using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;session.CreateCriteria(typeof(Party)).List();&#xA;&#x9;session.CreateCriteria(typeof(Company)).List();&#xA;&#x9;session.CreateCriteria(typeof(Person)).List();&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;From now on we are going to simply play with the mapping options to see what we can come up with. We will start with a very simple discriminator based mapping (table per hierarchy):&#xA;&#xA;&#xA;  &lt;class name=&quot;Party&quot;&#xA;&#x9;&#x9;&#x9; abstract=&quot;true&quot;&#xA;&#x9;&#x9;&#x9; table=&quot;Parties&quot;&gt;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;identity&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;discriminator column=&quot;Discriminator&quot;&#xA;&#x9;&#x9;&#x9;not-null=&quot;true&quot;&#xA;&#x9;&#x9;&#x9;type=&quot;System.String&quot;/&gt;&#xA;&#xA;&#x9;&lt;subclass&#xA;&#x9;&#x9;name=&quot;Person&quot;&#xA;&#x9;&#x9;discriminator-value=&quot;Person&quot;&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;FirstName&quot;/&gt;&#xA;&#x9;&lt;/subclass&gt;&#xA;&#xA;&#x9;&lt;subclass&#xA;&#x9;&#x9;name=&quot;Company&quot;&#xA;&#x9;&#x9;discriminator-value=&quot;Company&quot;&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;CompanyName&quot;/&gt;&#xA;&#x9;&lt;/subclass&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&#xA;Which result in the following table structure:&#xA;&#xA; &#xA;&#xA;And the SQL that was generated is:&#xA;&#xA;Select Party&#xA;&#xA; &#xA;&#xA;Select Company&#xA;&#xA;&#xA;&#xA;Select Person&#xA;&#xA; &#xA;&#xA;But that is just one option. Let us see what happen if we try the table per concrete class option:&#xA;&#xA;&#xA;  &lt;class name=&quot;Person&quot;&#xA;&#x9;table=&quot;People&quot;&gt;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;identity&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;property name=&quot;FirstName&quot;/&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&lt;class name=&quot;Company&quot;&#xA;&#x9;table=&quot;Companies&quot;&gt;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;identity&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;property name=&quot;CompanyName&quot;/&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&#xA;Which result in the following table structure:&#xA;&#xA; &#xA;&#xA;And the following queries:&#xA;&#xA;Select Party&#xA;&#xA; &#xA;&#xA; &#xA;&#xA;No, that is not a mistake, we issue two SQL queries to load all possible parties.&#xA;&#xA;&#xA;&#xA;Select Company&#xA;&#xA; &#xA;&#xA;Select Person&#xA;&#xA; &#xA;&#xA;The inheritance strategy is table per subclass:&#xA;&#xA;&#xA;  &lt;class name=&quot;Party&quot;&#xA;&#x9;&#x9;abstract=&quot;true&quot;&#xA;&#x9;&#x9;table=&quot;Parties&quot;&gt;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;identity&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#xA;&#x9;&lt;joined-subclass&#xA;&#x9;&#x9;table=&quot;People&quot;&#xA;&#x9;&#x9;name=&quot;Person&quot;&gt;&#xA;&#x9;&#x9;&lt;key column=&quot;PartyId&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;FirstName&quot;/&gt;&#xA;&#x9;&lt;/joined-subclass&gt;&#xA;&#xA;&#x9;&lt;joined-subclass&#xA;&#x9;&#x9;table=&quot;Companies&quot;&#xA;&#x9;&#x9;name=&quot;Company&quot;&gt;&#xA;&#x9;&#x9;&lt;key column=&quot;PartyId&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;CompanyName&quot;/&gt;&#xA;&#x9;&lt;/joined-subclass&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&#xA;Which result in the following table structure:&#xA;&#xA; &#xA;&#xA;And the queries:&#xA;&#xA;Select Party&#xA;&#xA; &#xA;&#xA;This is slightly tricky, basically, we get the class based on whatever we have a row in the appropriate table.&#xA;&#xA;Select Company&#xA;&#xA; &#xA;&#xA;Select Person&#xA;&#xA; &#xA;&#xA;The final option is using unioned subclasses, which looks like this:&#xA;&#xA;&#xA;  &#xA0;&#xA;&#xA;  &lt;class name=&quot;Party&quot;&#xA;&#x9;&#x9;abstract=&quot;true&quot;&#xA;&#x9;&#x9;table=&quot;Parties&quot;&gt;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;hilo&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#xA;&#x9;&lt;union-subclass&#xA;&#x9;&#x9;table=&quot;People&quot;&#xA;&#x9;&#x9;name=&quot;Person&quot;&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;FirstName&quot;/&gt;&#xA;&#x9;&lt;/union-subclass&gt;&#xA;&#xA;&#x9;&lt;union-subclass&#xA;&#x9;&#x9;table=&quot;Companies&quot;&#xA;&#x9;&#x9;name=&quot;Company&quot;&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;CompanyName&quot;/&gt;&#xA;&#x9;&lt;/union-subclass&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&#xA;Note that it is not possible to use identity with union-subclasses, so I switched to hilo, which is generally much more recommended anyway.&#xA;&#xA;The table structure is similar to what we have seen before:&#xA;&#xA; &#xA;&#xA;But the querying is drastically different:&#xA;&#xA;Select Party&#xA;&#xA; &#xA;&#xA;Select Company&#xA;&#xA; &#xA;&#xA;Select Person&#xA;&#xA; &#xA;&#xA;The benefit over standard table per concrete class is that in this scenario, we can query over the entire hierarchy in a single query, rather than having to issue separate query per class.</p>
        </article>
        <article id="article-6014">
            <a href="https://ayende.com/blog/3940/an-allegory-of-an-optimization-story" target="_blank">
                <h2 class="title mb-6" id="article-6014">An allegory of an optimization story</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 09, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I got a call today from a team mate about a piece of software that we wrote. We initially planned it to work with data sizes of hundreds to thousands of records, and considering that we wrote that one in a day, I considered it a great success. We didn&#x2019;t pay one bit of attention to optimization, but the perf was great for what we needed.  However, a new requirement came up which require us to handle hundred thousand records, and our software was working&#x2026; well under the new constraints. As a matter of fact, it would take about 0.4 seconds to compute a result when the data size was hundred thousand records. That was probably well within acceptable range, but it had me worried, because 0.4 seconds may be acceptable for this single computation, but it was a CPU bound computation, and it was probably going to kill us when we start hammering the server with multiple requests for that.  Moreover, adding 0.4 to the clients of the system would add an unacceptable delay. So we sat down with dotTrace and tried to figure out what we were doing that could be better.  We spent several hours on that. At some point, a simple extraction of a variable from a loop reduced 7% of the total execution time, but we weren&#x2019;t really interesting in the small fish. We soon identified a O(N) operation in the code, which was taking about 20% of the total time of the calculation, and focused on that.  By changing the way that we worked with this, we changed this from an O(N) operation to O(1). We did it by introducing indexes and doing intersects of those indexes. The usual choice of time vs. memory has saved us again.  Current time for computing a result? 20 &#x2013; 50 ms, and that include network time.  I think that I&#x2019;ll find that acceptable.</p>
        </article>
        <article id="article-6015">
            <a href="https://ayende.com/blog/3939/how-dottrace-make-an-application-really-fast" target="_blank">
                <h2 class="title mb-6" id="article-6015">How dotTrace make an application REALLY fast</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 09, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I have to admit, I was sure that using Thread.Sleep(negativeInt) was an April&#x2019;s Fools joke, but It looks like some part of the framework are already taking advantage of this:     I must say, this make performance profiling somewhat of a challenge, since you don&#x2019;t generally expect to have to improve performance by making more calls.</p>
        </article>
        <article id="article-6016">
            <a href="https://ayende.com/blog/3938/nhibernate-mapping-many-to-one" target="_blank">
                <h2 class="title mb-6" id="article-6016">NHibernate Mapping - &lt;many-to-one/&gt;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 09, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Next up for inspection is the &lt;many-to-one/&gt; element. This element is defined as:     &lt;many-to-one&#xA;        name=&quot;PropertyName&quot;                                (1)&#xA;        column=&quot;column_name&quot;                               (2)&#xA;        class=&quot;ClassName&quot;                                  (3)&#xA;        cascade=&quot;all|none|save-update|delete&quot;              (4)&#xA;        fetch=&quot;join|select&quot;                                (5)&#xA;        update=&quot;true|false&quot;                                (6)&#xA;        insert=&quot;true|false&quot;                                (7)&#xA;        property-ref=&quot;PropertyNameFromAssociatedClass&quot;     (8)&#xA;        access=&quot;field|property|nosetter|ClassName&quot;         (9)&#xA;        unique=&quot;true|false&quot;                                (10)&#xA;        optimistic-lock=&quot;true|false&quot;                       (11)&#xA;        not-found=&quot;ignore|exception&quot;                       (12)&#xA;/&gt;&#xA;&#xA;&#xA;Much of the attributes on this element are identical to the ones that I outlined in the post about &lt;property/&gt;. 1, 2, 3, 6, 7, 9 and 11 are identical, and I am not going to cover them.&#xA;&#xA;4) cascade is interesting, it controls one of the more interesting NHibernate features, persistence by reachability.I outlined all the possible options in 2006, so I wouldn&#x2019;t repeat them again.&#xA;&#xA;5) fetch is really interesting. Let us take a look at an entity definition, and explore how modifying it can alter NHibernate&#x2019;s behavior.&#xA;&#xA;&#xA;  &lt;class name=&quot;Post&quot;&#xA;&#x9;&#x9; table=&quot;Posts&quot;&gt;&#xA;  &#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;identity&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;property name=&quot;Title&quot; /&gt;&#xA;&#x9;&lt;many-to-one name=&quot;Blog&quot; column=&quot;BlogId&quot;/&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&#xA;And we have the following code to exercise NHibernate:&#xA;&#xA;&#xA;  using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var post = session.Get&lt;Post&gt;(1);&#xA;&#x9;Console.WriteLine(post.Title);&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;This would result in the following SQL.&#xA;&#xA;&#xA0;&#xA;&#xA;But interesting things happen when we start playing with the fetch attribute. Note that by default the fetch attribute is defaulting to &#x201C;select&#x201D;, so setting it to that value is merely making things explicit, but setting it to fetch=&#x201D;join&#x201D;, like this:&#xA;&#xA;&#xA;  &lt;many-to-one name=&quot;Blog&quot; &#xA;&#x9;column=&quot;BlogId&quot;&#xA;&#x9;fetch=&quot;join&quot;/&gt;&#xA;&#xA;&#xA;Would result in the following SQL:&#xA;&#xA; &#xA;&#xA;&#xA;&#xA;We eagerly load the Blog association, in this case.&#xA;&#xA;8) property-ref is a legacy feature, it is meant to allow you to create many-to-one associations when the association is not done on the primary key of the association. In general, I would strongly suggest avoiding it.&#xA;&#xA;9) unique is relevant only if you use NHibernate to specify your schema. This would generate a unique constraint when we generate the DDL.&#xA;&#xA;12) not-found is another legacy feature, it controls how NHibernate behaves when it finds an invalid foreign key. That is, a value that points to an entity that doesn&#x2019;t exist. By default, this would trigger an error, as this generally indicate a problem with the database, but with legacy database, you can tell it to set the property value to null instead.</p>
        </article>
        <article id="article-6017">
            <a href="https://ayende.com/blog/3937/nhibernate-mapping-component" target="_blank">
                <h2 class="title mb-6" id="article-6017">NHibernate Mapping - &lt;component/&gt;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 08, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">&lt;component/&gt; is an interesting feature of NHibernate, which map more or less directly into the notion of a Value Type in DDD. This is a way to create an object model with higher granularity than the physical data model.  For example, let us take the following table:     And this object model:     They are quite different, where the physical data model put all the data in a single table, we want to treat them in our object model as two separate classes. This is where &lt;component/&gt; comes into play:  &lt;class name=&quot;Person&quot;&#xA;&#x9;table=&quot;People&quot;&gt;&#xA;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;identity&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;property name=&quot;Name&quot; /&gt;&#xA;&#x9;&lt;component name=&quot;Address&quot;&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;Line1&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;Line2&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;City&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;Country&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;ZipCode&quot;/&gt;&#xA;&#x9;&lt;/component&gt;&#xA;&lt;/class&gt;&#xA;&#xA;This mapping will translate between the physical data model and the object model. And the mapping is complete, so even queries are done in the way you would expect it:&#xA;&#xA; &#xA;&#xA;And then we let NHibernate sort it out and give us our pretty object graph.</p>
        </article>
        <article id="article-6018">
            <a href="https://ayende.com/blog/3936/nhibernate-mapping-property" target="_blank">
                <h2 class="title mb-6" id="article-6018">NHibernate Mapping - &lt;property/&gt;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 07, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am going to post a few things about NHibernate, going in depth into seemingly understood mapping. We will start with the most basic of them all: &lt;property/&gt; &lt;property&#xA;        name=&quot;propertyName&quot;                 (1)&#xA;        column=&quot;column_name&quot;                (2)&#xA;        type=&quot;typename&quot;                     (3)&#xA;        update=&quot;true|false&quot;                 (4)&#xA;        insert=&quot;true|false&quot;                 (4)&#xA;        formula=&quot;arbitrary SQL expression&quot;  (5)&#xA;        access=&quot;field|property|ClassName&quot;   (6)&#xA;        optimistic-lock=&quot;true|false&quot;        (7)&#xA;        generated=&quot;never|insert|always&quot;     (8)&#xA;/&gt;&#xA;1) is pretty obvious, it is the name of the property on the persistent class.&#xA;2) should be obvious as well, this is the column name in the database, which by default is the name of the property. This allows us to map a property to a column, and adds a small optimization if you have one to one mapping.&#xA;3) type is interesting. This is the CLR type of the property that we map, but it can also be used to customize the way that NHibernate works with our data types by specifying a custom IUserType.&#xA;4.1) should NHibernate update this property in the database when updating the object? Let us look at an example:&#xA;&lt;property name=&quot;Title&quot; update=&quot;false&quot;/&gt;&#xA;Given this mapping, and the following code:&#xA;using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var blog = session.Get&lt;Blog&gt;(6);&#xA;&#x9;blog.Title = &quot;changed&quot;;&#xA;&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;NHibernate will not try to update the row:&#xA; &#xA;Note that we have no update here, even though we updated the actual property value, and usually NHibernate will save that value.&#xA;4.2) insert behaves in much the same way, disabling inserts for a property. For example:&#xA;&lt;property name=&quot;AllowsComments&quot; insert=&quot;false&quot;/&gt;&#xA;And this code:&#xA;object id;&#xA;using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;id = session.Save(new Blog&#xA;&#x9;{&#xA;&#x9;&#x9;AllowsComments = true,&#xA;&#x9;&#x9;CreatedAt = DateTime.Now,&#xA;&#x9;&#x9;Subtitle = &quot;test&quot;,&#xA;&#x9;&#x9;Title = &quot;test&quot;&#xA;&#x9;});&#xA;&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;Produces:&#xA; &#xA;Note that we don&#x27;t insert the AllowComments column. And if we try to update this entity:&#xA;using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var blog = session.Get&lt;Blog&gt;(id);&#xA;&#x9;blog.AllowsComments = false;&#xA;&#x9;blog.Title = &quot;blah&quot;;&#xA;&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;We would get...&#xA; &#xA;An update of AllowComments, but not of Title.&#xA;5) formula is a way to specify any arbitrary SQL that we want to associate with a property. Obviously, this is a read only value, and it is something that we would use on fairly rare occasions. Nevertheless, it can be pretty useful at times. Let us take a look at the mapping:&#xA;&lt;property name=&quot;CountOfPosts&quot;&#xA;&#x9;formula=&quot;(select count(*) from Posts where Posts.Id = Id)&quot;/&gt;&#xA;And selecting an entity will now result in:&#xA;&#xA;Note that the formula was slightly preprocessed in order to make it work as a subquery.&#xA;6) access determines how we are going to actually set and get the actual value with NHibernate. We aren&#x27;t limited to a simple public property, in fact, we can use: private variables, private auto property variable, custom implementation, field, and many more. This isn&#x27;t actually very interesting at the moment to me, so I am just going to mention it and move on.&#xA;7) optimistic-lock is pretty complex, I am afraid. Mostly because it is a way to interact with the &lt;version/&gt; option of NHibernate. NHibernate has intrinsic support for optimistic concurrency, but sometimes there are reasons that you don&#x27;t want to change the value of the version of the entity if a particular value changed. This is the role that optimistic-lock plays. &#xA;It will probably be better when we see the code. Let us take the following entity definition:&#xA;&lt;class name=&quot;Blog&quot;&#xA;&#x9;   table=&quot;Blogs&quot;&gt;&#xA;  &#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;identity&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;version name=&quot;Version&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;Title&quot; update=&quot;false&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;Subtitle&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;AllowsComments&quot; insert=&quot;false&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;CreatedAt&quot; /&gt;&#xA;&#x9;&lt;property name=&quot;CountOfPosts&quot;&#xA;&#x9;&#x9;formula=&quot;(select count(*) from Posts where Posts.Id = Id)&quot;/&gt;&#xA;&lt;/class&gt;&#xA;And now execute the following code:&#xA;using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var blog = session.Get&lt;Blog&gt;(1);&#xA;&#x9;blog.Subtitle = &quot;new value 6&quot;;&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;The SQL that is going to be executed is:&#xA; &#xA;Note that we increment the value of the version column. But, if we specify optimistic-lock=&quot;false&quot;...&#xA;&lt;property name=&quot;Subtitle&quot;&#xA;&#x9;optimistic-lock=&quot;false&quot;/&gt;&#xA;We will get:&#xA; &#xA;Note that in this case, we do not increase the value of the version column.&#xA;8) generated is an instruction to NHibernate that the value of this property is set by the database, usually using a default value (in which case you&#x27;ll use &quot;insert&quot;) or a trigger (in which case you&#x27;ll use &quot;always&quot;).&#xA;When we use it like this:&#xA;&lt;property name=&quot;AllowsComments&quot; generated=&quot;insert&quot;/&gt;&#xA;And execute the following code:&#xA;using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;session.Save(new Blog&#xA;&#x9;{&#xA;&#x9;&#x9;CreatedAt = DateTime.Now,&#xA;&#x9;&#x9;Title = &quot;hello&quot;,&#xA;&#x9;&#x9;Subtitle = &quot;world&quot;,&#xA;&#x9;});&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;We will get an insert followed immediately by a select:&#xA; \&#xA;And the select is:&#xA; &#xA;So we have to get it back from the database before we can actually make any sort of use of it.&#xA;And that was my in depth tour into &lt;property/&gt;, more will probably follow...</p>
        </article>
        <article id="article-6019">
            <a href="https://ayende.com/blog/3935/reviewing-nchord-a-codebase-that-makes-me-twitch" target="_blank">
                <h2 class="title mb-6" id="article-6019">Reviewing NChord: A codebase that makes me twitch</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 07, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I was referred to NChord by one of the comments, and it looked very interesting on the surface, so I downloaded the code and took a peek.  It is not typically my style to criticize code openly, especially after a very brief glance, but I thought that it&#xA0; might be a good idea to point some of the things that made me decide that the codebase isn&#x27;t worth the time to pursue in details. Single Responsibility Principle doesn&#x27;t apply to the file level   What you see here are no less than 11(!) files that are all parts of the same class. That is.. bad, from a whole lot of reasons, not least of which is that you have to jump through a lot of files to understand what is going on, and that ChordInstance is at least a demi-god, rapidly moving upward. Then we have things like this:   Now, this is a matter of taste more than anything else, but it strongly hints that there is lack of threading experience going on here. Indeed, a brief look at the code shows numerous potential race conditions.  Code like this really make me twitch:   All of that trend toward making me doubt the maturity and stability of the codebase. In short, after a very brief scan, I find numerous issues that I really didn&#x27;t like in the code base. And I am not willing to put up the effort to try to make headway into this with so many early warning signs already in place.</p>
        </article>
        <article id="article-6020">
            <a href="https://ardalis.com/speaking-at-kent-state-university-acm-chapter/" target="_blank">
                <h2 class="title mb-6" id="article-6020">Speaking at Kent State University ACM Chapter</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 06, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x2019;m giving a talk this week at Kent State University on ASP.NET MVC and SOLID principles. It will be at 3:45pm on Wednesday, April 8th, in&#x2026;Keep Reading &#x2192;</p>
        </article>
        <div class="button flex justify-between">
            <a href="601.html"><span class="back arrow"></span></a>

            <a href="603.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>