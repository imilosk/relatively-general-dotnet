
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 525 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-5241">
            <a href="https://ayende.com/blog/4703/find-the-bug-a-broken-tree" target="_blank">
                <h2 class="title mb-6" id="article-5241">Find the bug</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 25, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Originally posted at 11/22/2010This method has a bug, a very subtle one. Can you figure it out?     public IBinarySearchTree&lt;TKey, TValue&gt; TryRemove(TKey key, out bool removed, out TValue value)&#xA;{&#xA;    IBinarySearchTree&lt;TKey, TValue&gt; result;&#xA;    int compare = comparer.Compare(key, theKey);&#xA;    if (compare == 0)&#xA;    {&#xA;        removed = true;&#xA;        value = theValue;&#xA;        // We have a match. If this is a leaf, just remove it &#xA;        // by returning Empty.  If we have only one child,&#xA;        // replace the node with the child.&#xA;        if (Right.IsEmpty &amp;&amp; Left.IsEmpty)&#xA;            result = new EmptyAVLTree&lt;TKey, TValue&gt;(comparer, deepCopyKey, deepCopyValue);&#xA;        else if (Right.IsEmpty &amp;&amp; !Left.IsEmpty)&#xA;            result = Left;&#xA;        else if (!Right.IsEmpty &amp;&amp; Left.IsEmpty)&#xA;            result = Right;&#xA;        else&#xA;        {&#xA;            // We have two children. Remove the next-highest node and replace&#xA;            // this node with it.&#xA;            IBinarySearchTree&lt;TKey, TValue&gt; successor = Right;&#xA;            while (!successor.Left.IsEmpty)&#xA;                successor = successor.Left;&#xA;            result = new AVLTree&lt;TKey, TValue&gt;(comparer, deepCopyKey, deepCopyValue, successor.Key, &#xA;                successor.Value, Left, Right.TryRemove(successor.Key, out removed, out value));&#xA;        }&#xA;    }&#xA;    else if (compare &lt; 0)&#xA;        result = new AVLTree&lt;TKey, TValue&gt;(comparer, deepCopyKey, deepCopyValue, &#xA;            theKey, theValue, Left.TryRemove(key, out removed, out value), Right);&#xA;    else&#xA;        result = new AVLTree&lt;TKey, TValue&gt;(comparer, deepCopyKey, deepCopyValue,&#xA;            theKey, theValue, Left, Right.TryRemove(key, out removed, out value));&#xA;    return MakeBalanced(result);&#xA;}</p>
        </article>
        <article id="article-5242">
            <a href="https://ayende.com/blog/4702/dallas-days-of-net-march-4-5" target="_blank">
                <h2 class="title mb-6" id="article-5242">Dallas Days of .NET &#x2013; March 4-5</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 25, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am going to be at Dallas Days of .NET on March next year.&#xA0; You can use the following link to get a discount if you order now: http://jointechies.eventbrite.com/?discount=OrenEini  This is going to be an interesting event, because there is one track in which I am going to be doing every other talk for 2 days. This is going to give me a wide enough scope to cover just about every topic that I am interested at, including some time to go in depth into several topics that I usually have the chance to only skim.</p>
        </article>
        <article id="article-5243">
            <a href="https://ayende.com/blog/4701/your-design-should-be-focused-on-your-competitive-advantage" target="_blank">
                <h2 class="title mb-6" id="article-5243">Your design should be focused on your competitive advantage</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 24, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Yesterday I had an interesting talk with a friend about being a Micro ISV. I am not sure how good a source I am for advice in the matter, but I did have some. Including one that I think is good enough to talk about here.  Currently my company have two products:     Uber Profiler (NHibernate Profiler, Entity Framework Profiler, Linq to SQL Profiler, Hibernate Profiler, LLBLGen Profiler)    RavenDB   Both of them came into a market that already had strong competitors.   In the case of Uber Prof, I am competing with SQL Profiler, which is &#x201C;free&#x201D; (you get that with SQL Server) and the Huagati suite of profilers which are significantly cheaper than Uber Prof. In the case of RavenDB, MongoDB and CouchDB already had the mindshare, and they are both free as in beer and as in speech.  One of the decisions that you have to be aware of when creating your product is what are the products that people are going to compare you to. It doesn&#x2019;t really matter whether that is an accurate comparison or whether they are comparing apples to camels, but you will be compared to them.  And early on, you have to decide what your answer is going to be like when someone will ask you &#x201C;why should I use your stuff instead of XYZ?&#x201D;.   Here is a general rule of the thumb. You never want to answer them &#x201C;because it is cheaper than XYZ&#x201D;. Pricing has a lot of implications, some of directly affect the perceived quality of your product. It is perfectly fine to point out that it has a much cheaper TCO, though, because then you are increasing the value of your product, not reducing it.  But those are general advices that you can get anywhere. My point here is somewhat different. Once you decide what you are doing with your product that gives you a good answer for that question, you have defined your competitive advantage. That thing that will make people choose your stuff over everyone else.     Remember, competing on pricing is a losing proposition &#x2013; and the pun is fully intended here!   But once you have the notion of what your competitive advantage is going to be, you have to design your product around that. In essence, that competitive advantage is going to be the thing that you are going to work on. Every decision that you have is going to have to be judged in light of the goal of increasing your competitive advantage.  Can you try to guess what I define as competitive advantages for Uber Prof and Raven DB?</p>
        </article>
        <article id="article-5244">
            <a href="https://ardalis.com/alternatives-to-singleton/" target="_blank">
                <h2 class="title mb-6" id="article-5244">Alternatives to the Singleton Design Pattern</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 23, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Introduction The Singleton Design Pattern is one of the simplest design patterns in software development, yet one of the easiest to misuse&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-5245">
            <a href="https://ardalis.com/9-ways-contract-lawyers-are-like-software-developers/" target="_blank">
                <h2 class="title mb-6" id="article-5245">9 Ways Contract Lawyers are Like Software Developers</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 22, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Lawyers. We love to hate them. But they&#x2019;ve been writing code since long before Ada Lovelace wrote the first computer program. Here are&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-5246">
            <a href="https://ayende.com/blog/4700/enough-is-enough-itunes-got-to-go" target="_blank">
                <h2 class="title mb-6" id="article-5246">Enough is enough: iTunes got to go</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 22, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Here is the story, the only reason that I am using iTunes is because I want to sync books that I buy from audible.com to my iPhone.   I am still fighting this problem. And I have installed / uninstalled, danced the mamba and even try some chicken sacrifice on the last full moon. Nothing helps, oh, it will works once, immediately after I install it, but on the next reboot, it will show the same error.  Right now I have uninstalled iTunes from my system, and I am currently building a VM specifically so I would be able to sync new audiobooks to my iPhones. I think that this is insane.  Anyone got a better option than that?</p>
        </article>
        <article id="article-5247">
            <a href="https://ayende.com/blog/4699/the-smallest-bugs-the-biggest-problems-part-i" target="_blank">
                <h2 class="title mb-6" id="article-5247">The smallest bugs, the biggest problems &#x2013; Part I</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 22, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We had the following (really nasty) bug in RavenDB&#x2019;s managed storage (which is still considered unstable, btw):     When deleting documents in a database that contains more than 2 documents, and&#xA0; the document(s) deleted are deleted in a certain order, RavenDB would go into 100% CPU. The server would still function, but it would always think that it had work to do, even if it didn&#x2019;t have any.   To call this annoying is an understatement. To understand the bug I have to explain a bit about how RavenDB&#x2019;s uses Munin, the managed storage engine. Munin gives you the notion of a primary key (which can be any json tuple) and secondary indexes. As expected, the PK is unique, but secondary indexes can contain duplicate values.  The problem that we had was that for some reason, removing values from the table wouldn&#x2019;t remove them from the secondary indexes. That drove me crazy. At first, I tried to debug the problem by running the following unit test:     public class CanHandleDocumentRemoval : LocalClientTest&#xA;{&#xA;    [Fact]&#xA;    public void CanHandleDocumentDeletion()&#xA;    {&#xA;        using(var store = NewDocumentStore())&#xA;        {&#xA;            using(var session = store.OpenSession())&#xA;            {&#xA;                for (int i = 0; i &lt; 3; i&#x2B;&#x2B;)&#xA;                {&#xA;                    session.Store(new User&#xA;                    {&#xA;                        Name = &quot;ayende&quot;&#xA;                    });&#xA;                }&#xA;                session.SaveChanges();&#xA;            }&#xA;         &#xA;            using (var session = store.OpenSession())&#xA;            {&#xA;                var users = session.Query&lt;User&gt;(&quot;Raven/DocumentsByEntityName&quot;)&#xA;                    .Customize(x =&gt; x.WaitForNonStaleResults())&#xA;                    .ToArray();&#xA;                Assert.NotEmpty(users);&#xA;                foreach (var user in users)&#xA;                {&#xA;                    session.Delete(user);&#xA;                }&#xA;                session.SaveChanges();&#xA;            }&#xA;           &#xA;            using (var session = store.OpenSession())&#xA;            {&#xA;                var users = session.Query&lt;User&gt;(&quot;Raven/DocumentsByEntityName&quot;)&#xA;                    .Customize(x =&gt; x.WaitForNonStaleResults(TimeSpan.FromSeconds(5)))&#xA;                    .ToArray();&#xA;                Assert.Empty(users);&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;  &#xA;&#xA;But, while this reproduced the problem, it was very hard to debug properly. Mostly, because this executes the entire RavenDB server, which means that I had to deal with such things as concurrency, multiple operations, etc.&#xA;&#xA;After a while, it became clear that I wouldn&#x2019;t be able to understand the root cause of the problem from that test, so I decided to take a different route. I started to add logging in the places where I thought the problem was, and then I turned that log into a test all of its own.&#xA;&#xA;&#xA;  [Fact]&#xA;public void CanProperlyHandleDeletingThreeItemsBothFromPK_And_SecondaryIndexes()&#xA;{&#xA;    var cmds = new[]&#xA;    {&#xA;        @&quot;{&quot;&quot;Cmd&quot;&quot;:&quot;&quot;Put&quot;&quot;,&quot;&quot;Key&quot;&quot;:{&quot;&quot;index&quot;&quot;:&quot;&quot;Raven/DocumentsByEntityName&quot;&quot;,&quot;&quot;id&quot;&quot;:&quot;&quot;AAAAAAAAAAEAAAAAAAAABQ==&quot;&quot;,&quot;&quot;time&quot;&quot;:&quot;&quot;\/Date(1290420997504)\/&quot;&quot;,           &quot;&quot;type&quot;&quot;:&quot;&quot;Raven.Database.Tasks.RemoveFromIndexTask&quot;&quot;,&quot;&quot;mergable&quot;&quot;:true},&quot;&quot;TableId&quot;&quot;:9,&quot;&quot;TxId&quot;&quot;:&quot;&quot;NiAAMOT72EC/We7rnZS/Fw==&quot;&quot;}&quot;,&#xA;        @&quot;{&quot;&quot;Cmd&quot;&quot;:&quot;&quot;Put&quot;&quot;,&quot;&quot;Key&quot;&quot;:{&quot;&quot;index&quot;&quot;:&quot;&quot;Raven/DocumentsByEntityName&quot;&quot;,&quot;&quot;id&quot;&quot;:&quot;&quot;AAAAAAAAAAEAAAAAAAAABg==&quot;&quot;,&quot;&quot;time&quot;&quot;:&quot;&quot;\/Date(1290420997509)\/&quot;&quot;,           &quot;&quot;type&quot;&quot;:&quot;&quot;Raven.Database.Tasks.RemoveFromIndexTask&quot;&quot;,&quot;&quot;mergable&quot;&quot;:true},&quot;&quot;TableId&quot;&quot;:9,&quot;&quot;TxId&quot;&quot;:&quot;&quot;NiAAMOT72EC/We7rnZS/Fw==&quot;&quot;}&quot;,&#xA;        @&quot;{&quot;&quot;Cmd&quot;&quot;:&quot;&quot;Put&quot;&quot;,&quot;&quot;Key&quot;&quot;:{&quot;&quot;index&quot;&quot;:&quot;&quot;Raven/DocumentsByEntityName&quot;&quot;,&quot;&quot;id&quot;&quot;:&quot;&quot;AAAAAAAAAAEAAAAAAAAABw==&quot;&quot;,&quot;&quot;time&quot;&quot;:&quot;&quot;\/Date(1290420997509)\/&quot;&quot;,           &quot;&quot;type&quot;&quot;:&quot;&quot;Raven.Database.Tasks.RemoveFromIndexTask&quot;&quot;,&quot;&quot;mergable&quot;&quot;:true},&quot;&quot;TableId&quot;&quot;:9,&quot;&quot;TxId&quot;&quot;:&quot;&quot;NiAAMOT72EC/We7rnZS/Fw==&quot;&quot;}&quot;,&#xA;        @&quot;{&quot;&quot;Cmd&quot;&quot;:&quot;&quot;Commit&quot;&quot;,&quot;&quot;TableId&quot;&quot;:9,&quot;&quot;TxId&quot;&quot;:&quot;&quot;NiAAMOT72EC/We7rnZS/Fw==&quot;&quot;}&quot;,&#xA;        @&quot;{&quot;&quot;Cmd&quot;&quot;:&quot;&quot;Del&quot;&quot;,&quot;&quot;Key&quot;&quot;:{&quot;&quot;index&quot;&quot;:&quot;&quot;Raven/DocumentsByEntityName&quot;&quot;,&quot;&quot;id&quot;&quot;:&quot;&quot;AAAAAAAAAAEAAAAAAAAABg==&quot;&quot;,&quot;&quot;time&quot;&quot;:&quot;&quot;\/Date(1290420997509)\/&quot;&quot;,           &quot;&quot;type&quot;&quot;:&quot;&quot;Raven.Database.Tasks.RemoveFromIndexTask&quot;&quot;,&quot;&quot;mergable&quot;&quot;:true},&quot;&quot;TableId&quot;&quot;:9,&quot;&quot;TxId&quot;&quot;:&quot;&quot;wM3q3VA0XkWecl5WBr9Cfw==&quot;&quot;}&quot;,&#xA;        @&quot;{&quot;&quot;Cmd&quot;&quot;:&quot;&quot;Del&quot;&quot;,&quot;&quot;Key&quot;&quot;:{&quot;&quot;index&quot;&quot;:&quot;&quot;Raven/DocumentsByEntityName&quot;&quot;,&quot;&quot;id&quot;&quot;:&quot;&quot;AAAAAAAAAAEAAAAAAAAABw==&quot;&quot;,&quot;&quot;time&quot;&quot;:&quot;&quot;\/Date(1290420997509)\/&quot;&quot;,           &quot;&quot;type&quot;&quot;:&quot;&quot;Raven.Database.Tasks.RemoveFromIndexTask&quot;&quot;,&quot;&quot;mergable&quot;&quot;:true},&quot;&quot;TableId&quot;&quot;:9,&quot;&quot;TxId&quot;&quot;:&quot;&quot;wM3q3VA0XkWecl5WBr9Cfw==&quot;&quot;}&quot;,&#xA;        @&quot;{&quot;&quot;Cmd&quot;&quot;:&quot;&quot;Del&quot;&quot;,&quot;&quot;Key&quot;&quot;:{&quot;&quot;index&quot;&quot;:&quot;&quot;Raven/DocumentsByEntityName&quot;&quot;,&quot;&quot;id&quot;&quot;:&quot;&quot;AAAAAAAAAAEAAAAAAAAABQ==&quot;&quot;,&quot;&quot;time&quot;&quot;:&quot;&quot;\/Date(1290420997504)\/&quot;&quot;,           &quot;&quot;type&quot;&quot;:&quot;&quot;Raven.Database.Tasks.RemoveFromIndexTask&quot;&quot;,&quot;&quot;mergable&quot;&quot;:true},&quot;&quot;TableId&quot;&quot;:9,&quot;&quot;TxId&quot;&quot;:&quot;&quot;wM3q3VA0XkWecl5WBr9Cfw==&quot;&quot;}&quot;,&#xA;        @&quot;{&quot;&quot;Cmd&quot;&quot;:&quot;&quot;Commit&quot;&quot;,&quot;&quot;TableId&quot;&quot;:9,&quot;&quot;TxId&quot;&quot;:&quot;&quot;wM3q3VA0XkWecl5WBr9Cfw==&quot;&quot;}&quot;,&#xA;    };&#xA;&#xA;    var tableStorage = new TableStorage(new MemoryPersistentSource());&#xA;&#xA;    foreach (var cmdText in cmds)&#xA;    {&#xA;        var command = JObject.Parse(cmdText);&#xA;        var tblId = command.Value&lt;int&gt;(&quot;TableId&quot;);&#xA;&#xA;        var table = tableStorage.Tables[tblId];&#xA;&#xA;        var txId = new Guid(Convert.FromBase64String(command.Value&lt;string&gt;(&quot;TxId&quot;)));&#xA;&#xA;        var key = command[&quot;Key&quot;] as JObject;&#xA;        if (key != null)&#xA;        {&#xA;            foreach (var property in key.Properties())&#xA;            {&#xA;                if(property.Value.Type != JTokenType.String)&#xA;                    continue;&#xA;                var value = property.Value.Value&lt;string&gt;();&#xA;                if (value.EndsWith(&quot;==&quot;) == false)&#xA;                    continue;&#xA;&#xA;                key[property.Name] = Convert.FromBase64String(value);&#xA;            }&#xA;        }&#xA;&#xA;        switch (command.Value&lt;string&gt;(&quot;Cmd&quot;))&#xA;        {&#xA;            case &quot;Put&quot;:&#xA;                table.Put(command[&quot;Key&quot;], new byte[] {1, 2, 3}, txId);&#xA;                break;&#xA;            case &quot;Del&quot;:&#xA;                table.Remove(command[&quot;Key&quot;], txId);&#xA;                break;&#xA;            case &quot;Commit&quot;:&#xA;                table.CompleteCommit(txId);&#xA;                break;&#xA;        }&#xA;    }&#xA;&#xA;    Assert.Empty(tableStorage.Tasks);&#xA;    Assert.Null(tableStorage.Tasks[&quot;ByIndexAndTime&quot;].LastOrDefault());&#xA;}&#xA;  &#xA;&#xA;The cmds variable that you see here was generated from the logs. What I did was generate the whole log, verify that this reproduce the bug, and then start trimming the commands until I had the minimal set that reproduced it.&#xA;&#xA;Using this approach, I was able to narrow the actual issue to a small set of API, which I was then able to go through in detail, and finally figure out what the bug was.&#xA;&#xA;This post isn&#x2019;t about the bug (I&#x2019;ll cover that in the next post), but about the idea of going from a &#x201C;there is a bug and I don&#x2019;t know how to reproduce it in to a small enough step to understand&#x201D; to &#x201C;here is the exact things that fail&#x201D;. A more sophisticated approach would be to do a dump of stack traces and parameters and execute that, but for my scenario, it was easy to just construct things from the log.</p>
        </article>
        <article id="article-5248">
            <a href="https://ayende.com/blog/4697/better-to-ask-forgiveness" target="_blank">
                <h2 class="title mb-6" id="article-5248">Better to ask forgiveness&#x2026;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 21, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Originally posted at 11/19/2010I am writing this post from the point of view of the one you might have to ask forgiveness from, not the one who has to ask forgiveness.   There are two common styles of building software, one of them is Bold Exploration, and the second is Detailed Survey.   Bold Exploration have a rough idea about what is required, and immediately set out to build something that matches the current understanding. Along the way, both the team and the client will continually triangulate toward where they want to be. This is in effect the old &#x201C;I&#x2019;ll know it when I see it&#x201D;. The problem from the point of view of the client (as in, me), is that I might be required to pay for those mistakes. For the most part, I don&#x2019;t mind too much. One of the best aspects of this approach is that the time to get a feature in my hands is very short. I had a few memorable cases where it took the team three or four days to get something out that I could immediately comment on. There is another very important aspect. For the most part, this approach means that from my perspective, this is fire &amp; forget. The way that I handle such things is usually by just having a phone call or two with the team, and then just getting their output and going over that, correcting the course if needed.  There were several times that mistakes where made, either because I didn&#x2019;t explain right, a difference in vision or just simply because the team didn&#x2019;t do things the way I wanted to. I asked for those to be fixed, and since we were operating on short time frames anyway, it didn&#x2019;t cost too much (and I paid for both the mistake and the fixing of it).  Detail Survey involves the same initial phone calls, but then the team goes away to plan, estimate and build a plan for building the project. They are very careful about the way that they are going about doing things, and get back to me multiple times asking for clarification for this or that. When they start building the project, they start by building the foundations, getting things to work from the bottom up.&#xA0; In many aspects, this is a very reasonable way to build software, expect for one very big problem. There is a long lead time until I get something that I can actually something with.  More importantly, this is me you are talking about, I am perfectly capable of looking at the code produce and estimate what they are doing. But, as impressive as a design is, it isn&#x2019;t really interesting to me at all. I want to see the end features. And this approach takes a long time until I have something that I can actually work with.  I experienced both options recently, and I have to say that my preference is strongly toward the first approach. If pressed, I could give you a whole lot of reasons why I want that, valid business reasons, enough to convince any CTO or CFO. But mostly, it is an issue of matching expectations. When someone goes off for a month or two to do stuff, I get very nervous. And if you start building from the bottom up, it gets progressively harder to truly evaluate what is going on. When you get a working feature in the first week, even if additional work would cause rewrites/changes to this feature, you can be much more confident that this is going somewhere you want.  The other side is that no matter how careful the team is, there are still going to be differences between the final product and what I want, so changes will be made, but it is far more likely that with the Detailed Survey team aren&#x2019;t used to those changes, and they are going to be harder to make.  In short, it all comes back to the fact that the shorter the feedback cycle is, the more happy I am.</p>
        </article>
        <article id="article-5249">
            <a href="https://ayende.com/blog/4696/raven-suggest" target="_blank">
                <h2 class="title mb-6" id="article-5249">Raven Suggest</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 20, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Originally posted at 11/18/2010 Since RavenDB&#x2019;s indexing is based on Lucene, we get a lot of advantages. One of them is supporting suggestions.   What is the Raven Suggest feature?&#xA0; Let us say that we give the user the option to perform some query, but the query that they sent us isn&#x2019;t returning enough results (or non at all).  We can ask RavenDB to figure out what the user meant. Here is the code:      var q = from user in session.Query&lt;User&gt;(&quot;Users/ByName&quot;)&#xA;         where user.Name == name&#xA;         select user;&#xA;  &#xA;&#xA;Now, we can call q.FirstOrDefault() on this query, and see if we got any results. If we didn&#x2019;t get a result, we can now ask RavenDB for help:&#xA;&#xA;&#xA;   var suggestionQueryResult = q.Suggest();&#xA; Console.WriteLine(&quot;Did you mean?&quot;);&#xA; foreach (var suggestion in suggestionQueryResult.Suggestions)&#xA; {&#xA;     Console.WriteLine(&quot;\t{0}&quot;, suggestion);&#xA; }&#xA;  &#xA;&#xA;This will produce the following output:&#xA;&#xA;&#xA;  Enter user name: oren&#xA;Found user: users/1&#xA;Enter user name: ore&#xA;Did you mean?&#xA;        oren&#xA;Enter user name: onre&#xA;Did you mean?&#xA;        oren&#xA;  &#xA;&#xA;&#xA;&#xA;This is a nice little feature, which can really make a difference in terms of your application&#x2019;s user experience.</p>
        </article>
        <article id="article-5250">
            <a href="https://ardalis.com/software-craftsmanship-2011-calendar/" target="_blank">
                <h2 class="title mb-6" id="article-5250">Software Craftsmanship 2011 Calendar</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 19, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The folks at NimblePros have put together a pretty sweet 2011 calendar showcasing principles of software craftsmanship and agile software&#x2026;Keep Reading &#x2192;</p>
        </article>
        <div class="button flex justify-between">
            <a href="524.html"><span class="back arrow"></span></a>

            <a href="526.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
