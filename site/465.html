
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 465 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-4641">
            <a href="https://ayende.com/blog/153281/what-is-wrong-here" target="_blank">
                <h2 class="title mb-6" id="article-4641">What is wrong here?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 24, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This case, it isn&#x2019;t code that I am going to show, rather, I am going to show the final UI and the database structure, and let you figure:  What is wrong. How to fix this. Here is the database schema:  And here is the problem:  Hints, this used to work for a long time, and suddenly it doesn&#x2019;t, and the customer is pissed, annoyed and threatening to sue.</p>
        </article>
        <article id="article-4642">
            <a href="https://ardalis.com/asus-zen-ultrabook-one-month-later/" target="_blank">
                <h2 class="title mb-6" id="article-4642">Asus Zen Ultrabook One Month Later</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 23, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I wrote a few weeks ago about my new Asus Zen Ultrabook computer. I&#x2019;ve been using it as my primary laptop computer since then, and thought I&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-4643">
            <a href="https://ayende.com/blog/153409/do-you-monitor-negative-events" target="_blank">
                <h2 class="title mb-6" id="article-4643">Do you monitor negative events?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 23, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">You are probably aware that you need to monitor your production systems for errors, and to add health monitoring for your servers. But are you monitoring negative events? What is a negative event, stuff that should have happened and didn&#x2019;t. For example, every week you have a process that runs to update the tax rates that applies to your customers. This is implemented as a scheduled process, but for some reason (computer was just being rebooted, the user&#x2019;s password expire, etc) that process didn&#x2019;t run. There isn&#x2019;t an error, pre se. You won&#x2019;t get an error because nothing actually had a chance to actually happen. Another example would be getting a callback confirmation that an order payment has been correctly processed. That usually happen within 1 &#x2013; 5 minutes, and you get an OK/Fail notification. But what happens if that notification just never came? This is a much more dangerous scenario, because you have to not only be prepared for handling errors, you have to be prepared for&#x2026; nothing to happen. What it means is that you have to have some way to setup expectations in the system, and act on them when you don&#x2019;t get a confirmation (negative or positive) within a given time frame.</p>
        </article>
        <article id="article-4644">
            <a href="https://ayende.com/blog/154849/ravendb-training-the-euro-tour" target="_blank">
                <h2 class="title mb-6" id="article-4644">RavenDB training: The euro tour</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 22, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We are planning of doing a lot of training on RavenDB, and I wanted to make sure that everyone is aware of it. Next week , we have a public event in London. Where Itamar will explain all about indexing:  RavenDB Indexes explained (public event) - Feb 28, London, UK Then there is the full 2 days workshop about RavenDB, here is the current schedule for the next few months.  RavenDB Training with Itamar Syn-Hershko - Feb 28 - 29, London, UK RavenDB Workshop - Ayende Rahien - 21 - 23 May, Stockholm, Sweden The RavenDB Workshop Part I &amp; II - Itamar Syn-Hershko - June 4th &amp; 5th, Oslo, Norway There is also going to be a course in the states around August, probably New York again and maybe around July in Berlin.</p>
        </article>
        <article id="article-4645">
            <a href="https://ayende.com/blog/154273/limit-your-abstractions-and-how-do-you-handle-testing" target="_blank">
                <h2 class="title mb-6" id="article-4645">Limit your abstractions</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 22, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">On my previous post, I explained about the value of pushing as much as possible to the infrastructure, and then show some code that showed how to do so. First, let us look at the business level code: [AcceptVerbs(HttpVerbs.Post)]&#xA;public ActionResult Register(string originUnlocode, string destinationUnlocode, DateTime arrivalDeadline)&#xA;{&#xA;    var trackingId = ExecuteCommand(new RegisterCargo&#xA;    {&#xA;        OriginCode = originUnlocode,&#xA;        DestinationCode = destinationUnlocode,&#xA;        ArrivalDeadline = arrivalDeadline&#xA;    });&#xA;&#xA;    return RedirectToAction(ShowActionName, new RouteValueDictionary(new { trackingId }));&#xA;}&#xA;&#xA;public class RegisterCargo : Command&lt;string&gt;&#xA;{&#xA;    public override void Execute()&#xA;    {&#xA;        var origin = Session.Load&lt;Location&gt;(OriginCode);&#xA;        var destination = Session.Load&lt;Location&gt;(DestinationCode);&#xA;&#xA;        var trackingId = Query(new NextTrackingIdQuery());&#xA;&#xA;        var routeSpecification = new RouteSpecification(origin, destination, ArrivalDeadline);&#xA;        var cargo = new Cargo(trackingId, routeSpecification);&#xA;        Session.Save(cargo);&#xA;&#xA;        Result = trackingId;&#xA;    }&#xA;&#xA;    public string OriginCode { get; set; }&#xA;&#xA;    public string DestinationCode { get; set; }&#xA;&#xA;    public DateTime ArrivalDeadline { get; set; }&#xA;}&#xA;&#xA;&#xA;And the infrastructure code, now:&#xA;protected void Default_ExecuteCommand(Command cmd)&#xA;{&#xA;    cmd.Session = Session;&#xA;    cmd.Execute();&#xA;}&#xA;&#xA;protected TResult Default_ExecuteCommand&lt;TResult&gt;(Command&lt;TResult&gt; cmd)&#xA;{&#xA;    ExecuteCommand((Command) cmd);&#xA;    return cmd.Result;&#xA;}&#xA;&#xA;&#xA;You might have noticed a problem in the way we are named things, the names on the action and the infrastructure code do not match. What is going on?&#xA;Well, the answer is quite simple. Let us look at how our controller looks like ( at least, the important parts ):&#xA;public class AbstractController : Controller&#xA;{&#xA;    public ISession Session;&#xA;&#xA;    public Action&lt;Command&gt; AlternativeExecuteCommand { get; set; }&#xA;    public Func&lt;Command, object&gt; AlternativeExecuteCommandWithResult { get; set; }&#xA;&#xA;    public void ExecuteCommand(Command cmd)&#xA;    {&#xA;        if (AlternativeExecuteCommand!= null)&#xA;            AlternativeExecuteCommand(cmd);&#xA;        else&#xA;            Default_ExecuteCommand(cmd);&#xA;    }&#xA;&#xA;    public TResult ExecuteCommand&lt;TResult&gt;(Command&lt;TResult&gt; cmd)&#xA;    {&#xA;        if (AlternativeExecuteCommandWithResult != null)&#xA;            return (TResult)AlternativeExecuteCommandWithResult(cmd);&#xA;        return Default_ExecuteCommand(cmd);&#xA;    }&#xA;&#xA;    protected void Default_ExecuteCommand(Command cmd)&#xA;    {&#xA;        cmd.Session = Session;&#xA;        cmd.Execute();&#xA;    }&#xA;&#xA;    protected TResult Default_ExecuteCommand&lt;TResult&gt;(Command&lt;TResult&gt; cmd)&#xA;    {&#xA;        ExecuteCommand((Command)cmd);&#xA;        return cmd.Result;&#xA;    }&#xA;}&#xA;&#xA;&#xA;What?! You do mocking by hand and inject them like that? That is horrible! It is much easier to use a mocking framework and &#x2026;.&#xA;Yes, it would be, if I was trying to mocking different things all the time. But given that I have very few abstractions, it make sense to not only build this sort of infrastructure, but to also build infrastructure for those things _in the tests_.&#xA;For example, let us write the test for the action:&#xA;[Fact]&#xA;public void WillRegisterCargo()&#xA;{&#xA;  ExecuteAction&lt;CargoAdminController&gt;( c=&gt; c.Register(&quot;US&quot;, &quot;UK&quot;, DateTime.Today) );&#xA;  &#xA;  Assert.IsType&lt;RegisterCargo&gt;( this.ExecutedCommands[0] );&#xA;}&#xA;&#xA;&#xA;The ExecuteAction method belongs to the test infrastructure, and it setups the controller to be run under the test scenario. Which allows me to not execute the command, but to actually get it.&#xA;From there, it is very easy to get to things like:&#xA;[Fact]&#xA;public void WillCreateNewCargoWithNewTrackingId()&#xA;{&#xA;  SetupQueryResponse&lt;NextTrackingIdQuery&gt;(&quot;abc&quot;);&#xA;  ExecuteCommand&lt;RegisterCargo&gt;( new RegisterCargo&#xA;  {&#xA;    OriginCode = &quot;US&quot;,&#xA;    DestinationCode= &quot;UK&quot;,&#xA;    ArrivalDeadline = DateTime.Today&#xA;  });&#xA;  &#xA;  var cargo = Session.Load&lt;Cargo&gt;(&quot;cargos/1&quot;);&#xA;  Assert.Equal(&quot;abc&quot;, cargo.TrackingId);&#xA;}&#xA;&#xA;&#xA;This is important, because now what you are testing is the actual interaction. You don&#x2019;t care about any of the actual dependencies, we just abstracted them out, but without creating ton of interfaces, abstractions on top of abstractions or any of that.&#xA;In fact, we kept the number of abstractions to a minimum, and we can change pretty much every part of the system with very little fear of cascading change.&#xA;We have similar lego pieces, all of them move together and interact with one another with complete freedom, and we don&#x2019;t have to have a Abstract Factory Factory Fa&#xE7;ade Factory.</p>
        </article>
        <article id="article-4646">
            <a href="https://ayende.com/blog/154241/limit-your-abstractions-the-key-is-in-the-infrastructure" target="_blank">
                <h2 class="title mb-6" id="article-4646">Limit your abstractions</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 21, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In my previous post, I discussed actual refactoring to reduce abstraction, and I showed two very interesting methods, Query() and ExecuteCommand(). Here is the code in question: [AcceptVerbs(HttpVerbs.Post)]&#xA;public ActionResult Register(string originUnlocode, string destinationUnlocode, DateTime arrivalDeadline)&#xA;{&#xA;    var trackingId = ExecuteCommand(new RegisterCargo&#xA;    {&#xA;        OriginCode = originUnlocode,&#xA;        DestinationCode = destinationUnlocode,&#xA;        ArrivalDeadline = arrivalDeadline&#xA;    });&#xA;&#xA;    return RedirectToAction(ShowActionName, new RouteValueDictionary(new { trackingId }));&#xA;}&#xA;&#xA;public class RegisterCargo : Command&lt;string&gt;&#xA;{&#xA;    public override void Execute()&#xA;    {&#xA;        var origin = Session.Load&lt;Location&gt;(OriginCode);&#xA;        var destination = Session.Load&lt;Location&gt;(DestinationCode);&#xA;&#xA;        var trackingId = Query(new NextTrackingIdQuery());&#xA;&#xA;        var routeSpecification = new RouteSpecification(origin, destination, ArrivalDeadline);&#xA;        var cargo = new Cargo(trackingId, routeSpecification);&#xA;        Session.Save(cargo);&#xA;&#xA;        Result = trackingId;&#xA;    }&#xA;&#xA;    public string OriginCode { get; set; }&#xA;&#xA;    public string DestinationCode { get; set; }&#xA;&#xA;    public DateTime ArrivalDeadline { get; set; }&#xA;}&#xA;&#xA;What are they so important? Mostly because those methods [and similar, like Raise(event) and ExecuteLater(task)] are actually the back bone of the application. They are the infrastructure on top of which everything rests.&#xA;Those methods basically accept an argument (and optionally return a value). Their responsibility are:&#xA;&#xA;Setup the given argument so it can run.&#xA;Execute it.&#xA;Return the result (if there is one).&#xA;Here is an example showing how to implement ExecuteCommand:&#xA;protected void Default_ExecuteCommand(Command cmd)&#xA;{&#xA;    cmd.Session = Session;&#xA;    cmd.Execute();&#xA;}&#xA;&#xA;protected TResult Default_ExecuteCommand&lt;TResult&gt;(Command&lt;TResult&gt; cmd)&#xA;{&#xA;    ExecuteCommand((Command) cmd);&#xA;    return cmd.Result;&#xA;}&#xA;&#xA;&#xA;&#xA;I have code very much like that in production, because I know that in this system, there are actually only one or two dependencies that a command may want.&#xA;There are very few other dependencies, because of the limited number of abstractions that we have. This makes things very simple to write and work with.&#xA;Because we abstract away any dependency management, and because we allow only very small number of abstractions, this works very well. The amount of complexity that you have is way down, code reviewing this is very easy, because there isn&#x2019;t much to review, and it all follows the same structure. The implementation of the rest are pretty much the same thing.&#xA;There is just one thing left to discuss, because it kept showing up on the comments for the other posts. How do you handle testing?</p>
        </article>
        <article id="article-4647">
            <a href="https://ayende.com/blog/154209/limit-your-abstractions-refactoring-toward-reduced-abstractions" target="_blank">
                <h2 class="title mb-6" id="article-4647">Limit your abstractions</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 20, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">So in my previous post I spoke about this code and the complexity behind it: public class CargoAdminController : BaseController&#xA;{&#xA;  [AcceptVerbs(HttpVerbs.Post)]&#xA;  public ActionResult Register(&#xA;      [ModelBinder(typeof (RegistrationCommandBinder))] RegistrationCommand registrationCommand)&#xA;  {&#xA;      DateTime arrivalDeadlineDateTime = DateTime.ParseExact(registrationCommand.ArrivalDeadline, RegisterDateFormat,&#xA;                                                             CultureInfo.InvariantCulture);&#xA;&#xA;      string trackingId = BookingServiceFacade.BookNewCargo(&#xA;          registrationCommand.OriginUnlocode, registrationCommand.DestinationUnlocode, arrivalDeadlineDateTime&#xA;          );&#xA;&#xA;      return RedirectToAction(ShowActionName, new RouteValueDictionary(new {trackingId}));&#xA;  }&#xA;}&#xA;&#xA;&#xA;In this post, I intend to show how we can refactor things. I am going to do that by flattening the architecture, removing useless abstractions and creating a simpler, easier to work with system.&#xA;The first thing to do is to refactor the method signature:&#xA;[AcceptVerbs(HttpVerbs.Post)]&#xA;public ActionResult Register(string originUnlocode, string destinationUnlocode, DateTime arrivalDeadline)&#xA;&#xA;&#xA;Those are three parameters that we need, there is no need to create a model binder, custom command, etc just for this. For that matter, if you already have a model binder, why on earth do you store the date as a string, and not a date time. The framework is quite happy to do the conversion for me, and if it can&#x2019;t, I can extend the infrastructure to do so. I don&#x2019;t need to patch this action with date parsing code.&#xA;Next, we have this notion of booking a new cargo, looking at the service, that looks like:&#xA;public string BookNewCargo(string origin, string destination, DateTime arrivalDeadline)&#xA;{&#xA;    try&#xA;    {&#xA;        TrackingId trackingId = BookingService.BookNewCargo(&#xA;            new UnLocode(origin),&#xA;            new UnLocode(destination),&#xA;            arrivalDeadline&#xA;            );&#xA;        return trackingId.IdString;&#xA;    }&#xA;    catch (Exception exception)&#xA;    {&#xA;        throw new NDDDRemoteBookingException(exception.Message);&#xA;    }&#xA;}&#xA;&#xA;The error handling alone sets my teeth on edge. Also, note that we have a complex type for TrackingId, which contains just a string (there is a lot of code there for IValueObject&lt;T&gt;, comparison, etc), all of which basically go away if you use an actual string. The same is true for UnLocode (UN Location Code, I assume), but at least this one has some validation code in it.&#xA;Then there is the lovely forwarding call, which translate to:&#xA;public TrackingId BookNewCargo(UnLocode originUnLocode,&#xA;                               UnLocode destinationUnLocode,&#xA;                               DateTime arrivalDeadline)&#xA;{&#xA;    using (var transactionScope = new TransactionScope())&#xA;    {&#xA;        TrackingId trackingId = cargoRepository.NextTrackingId();&#xA;        Location origin = locationRepository.Find(originUnLocode);&#xA;        Location destination = locationRepository.Find(destinationUnLocode);&#xA;&#xA;        Cargo cargo = CargoFactory.NewCargo(trackingId, origin, destination, arrivalDeadline);&#xA;&#xA;        cargoRepository.Store(cargo);&#xA;        logger.Info(&quot;Booked new cargo with tracking id &quot; &#x2B; cargo.TrackingId);&#xA;&#xA;        transactionScope.Complete();&#xA;        return cargo.TrackingId;&#xA;    }&#xA;}&#xA;&#xA;&#xA;And now we got somewhere, we actually have something there that is actually meaningful. I&#x2019;ll skip going deeper, I am pretty sure that you can understand what is going on. &#xA;From my point of view of the common abstractions in an application:&#xA;&#xA;Controllers &#xA;Views &#xA;Entities &#xA;Commands &#xA;Tasks &#xA;Events &#xA;Queries&#xA;Controllers are at the boundaries of the system, they orchestrate the entire system behavior. Note that I have no place for services or repositories in this list. That is quite intentional. Instead of going that route. &#xA;Take a look at the code that I ended up with:&#xA; [AcceptVerbs(HttpVerbs.Post)]&#xA; public ActionResult Register(string originUnlocode, string destinationUnlocode, DateTime arrivalDeadline)&#xA; {&#xA;     var origin = Session.Load&lt;Location&gt;(originUnlocode);&#xA;     var destination = Session.Load&lt;Location&gt;(destinationUnlocode);&#xA;&#xA;     var trackingId = Query(new NextTrackingIdQuery());&#xA;&#xA;     var routeSpecification = new RouteSpecification(origin, destination, arrivalDeadline);&#xA;     var cargo = new Cargo(trackingId, routeSpecification);&#xA;     Session.Store(cargo);&#xA;&#xA;     return RedirectToAction(ShowActionName, new RouteValueDictionary(new {trackingId}));&#xA; }&#xA;&#xA;&#xA;As you can see, the entire architecture was collapsed into a single method.&#xA;And what kind of abstractions do we have here?&#xA;Well, we have the usual things from MVC, Controller, Action, parameter binding. &#xA;We have the session that we are using to load data by id, and to store the newly create cargo. &#xA;And we have the notion of a query. Generating a new TrackingID is a query that happen on the database (actually implemented as a hilo sequence). That is something that is definitely not the responsibility of the controller action, so we moved it into a query. Note that we have the Query() method there. It is defined as:&#xA;protected TResult Query&lt;TResult&gt;(Query&lt;TResult&gt; query)&#xA;&#xA;&#xA;And NextTrackingIdQuery is defined as:&#xA;public class NextTrackingIdQuery : Query&lt;string&gt;&#xA;&#xA;&#xA;Pretty simple, overall. And I can hear the nitpickers climb over the fences, waving the pitchforks and torches. &#x201C;What happen when you need to reuse this logic? It is not in the UI and &#x2026;&#x201D;&#xA;There are a couple of things to note here. &#xA;First, there isn&#x2019;t anywhere else that needs to book a cargo. And saying &#x201C;and what happen when&#x2026;&#x201D; flies right into a wall of people shouting YAGNI.&#xA;Second, let us assume that there is such a need, to reuse the booking cargo scenario. How would we approach this?&#xA;Well, we can encapsulate the logic for the controller inside a Command. Which gives us:&#xA;[AcceptVerbs(HttpVerbs.Post)]&#xA;public ActionResult Register(string originUnlocode, string destinationUnlocode, DateTime arrivalDeadline)&#xA;{&#xA;    var trackingId = ExecuteCommand(new RegisterCargo&#xA;    {&#xA;        OriginCode = originUnlocode,&#xA;        DestinationCode = destinationUnlocode,&#xA;        ArrivalDeadline = arrivalDeadline&#xA;    });&#xA;&#xA;    return RedirectToAction(ShowActionName, new RouteValueDictionary(new { trackingId }));&#xA;}&#xA;&#xA;&#xA;And then we have the actual RegisterCargo command:&#xA;public abstract class Command&#xA;{&#xA;    public IDocumentSession Session { get; set; }&#xA;    public abstract void Execute();&#xA;&#xA;    protected TResult Query&lt;TResult&gt;(Query&lt;TResult&gt; query);&#xA;}&#xA;public abstract class Command&lt;T&gt; : Command&#xA;{&#xA;    public T Result { get; protected set; }&#xA;}&#xA;&#xA;public class RegisterCargo : Command&lt;string&gt;&#xA;{&#xA;    public override void Execute()&#xA;    {&#xA;        var origin = Session.Load&lt;Location&gt;(OriginCode);&#xA;        var destination = Session.Load&lt;Location&gt;(DestinationCode);&#xA;&#xA;        var trackingId = Query(new NextTrackingIdQuery());&#xA;&#xA;        var routeSpecification = new RouteSpecification(origin, destination, ArrivalDeadline);&#xA;        var cargo = new Cargo(trackingId, routeSpecification);&#xA;        Session.Save(cargo);&#xA;&#xA;        Result = trackingId;&#xA;    }&#xA;&#xA;    public string OriginCode { get; set; }&#xA;&#xA;    public string DestinationCode { get; set; }&#xA;&#xA;    public DateTime ArrivalDeadline { get; set; }&#xA;}&#xA;&#xA;&#xA;&#xA;Note that the Command class also have a way to execute queries, in fact, it is the exact same way that we use when we had the code in the controller. We just moved stuff around, not really made any major change, but we can easily start using the same functionality in another location.&#xA;I generally don&#x2019;t like doing this because most functionality is not reused, it is specific for a particular place and scenario, but I wanted to show how you can lift some part of the code and move it to a different location, otherwise people would complain about the &#x201C;lack of reuse opportunities&#x201D;.&#xA;On my next post I am going to talk about the Query() and ExecuteCommand() methods, and why they are so important.</p>
        </article>
        <article id="article-4648">
            <a href="https://ayende.com/blog/154785/ravenhq-goes-beta-ravendb-reaches-the-cloud" target="_blank">
                <h2 class="title mb-6" id="article-4648">RavenHQ goes beta&#x2013;RavenDB reaches the cloud</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 18, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the things that we have been doing lately was providing solutions for cloud hosted RavenDB. I am very proud to announce the public beta phase of RavenHQ, a cloud based, fully managed RavenDB service.&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;Currently it is available on AppHarbor only, and I must emphasis that this is still a beta, so you might run into some road bumps, but we have a really good team working on this.&#xA;&#xA;&#x9;Actually, here is an important detail, about this offering.&#xA;&#xA;&#x9;Hibernating Rhinos (the company who is actually doing the development of RavenDB) is at heart a development / consulting company. We didn&#x2019;t want to try to break apart something good, so we setup a new company dedicated for running RavenDB on the cloud, RavenHQ.&#xA;&#xA;&#x9;Why do you care about this? Because it means that while the RavenDB development team is available for any problem that you might run into, RavenHQ is actually stuffed by people whose job is merely to make sure that all your databases are humming along nicely, and not a developer who is 15% of watching what is going on in that server somewhere on the cloud.&#xA;&#xA;&#x9;I collaborated in RavenHQ with Jonathan Matheus (NSeviceBus Committer and an all around cool guy) to create something that I feel will be really awesome.&#xA;&#xA;&#x9;As I said before, we are currently offering RavenHQ on App Harbor only, but we will soon open it for general registration. In the meantime, this is called beta for a reason.&#xA;&#xA;&#x9;It is hard to test cloud based stuff in a lab, so after we have made sure that everything works, the next step is to see if you can break it. I am assuming the worse at that you will manage to break it in all sorts of creative ways. Please give us a short amount of grace period to make sure that we can match our internal workings to how people are actually using us.&#xA;&#xA;&#x9;Have an awesome weekend!</p>
        </article>
        <article id="article-4649">
            <a href="https://ayende.com/blog/153185/ravendb-index-boosting" target="_blank">
                <h2 class="title mb-6" id="article-4649">RavenDB</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 17, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Recently we added a really nice feature, boosting the results while indexing.  Boosting is a way to give documents or attributes in a document weights. Attribute level boosting is a way to tell RavenDB that a certain&#xA0; attribute in a document is more important than the others, so it will show up higher in queries when other properties are involved in a query. A document level boosting means that a certain document is more important than another (when using multi maps). Let us see a few examples where this is happening. The simplest scenario is when we have a multi field search, and we want one of the fields to be the more important one. For example, we decided that when you make a search for first name and last name, a match on the first name has higher relevance than a match on the last name. We can define this requirement with the following index: public class Users_ByName : AbstractIndexCreationTask&lt;User&gt;&#xA;{&#xA;    public Users_ByName()&#xA;    {&#xA;        Map = users =&gt; from user in users&#xA;                       select new&#xA;                       {&#xA;                           FirstName = user.FirstName.Boost(3),&#xA;                           user.LastName&#xA;                       };&#xA;    }&#xA;}&#xA;&#xA;&#xA;&#xA;And we can query the index using:&#xA;var matches = session.Query&lt;User,UsersByName&gt;()&#xA;      .Where(x=&gt;x.FirstName == &quot;Ayende&quot; || x.LastName == &quot;Eini&quot;)&#xA;      .ToList()&#xA;&#xA;&#xA;Assuming that we have a user with the first name &#x201C;Ayende&#x201D; and another user with the last name &#x201C;Eini&#x201D;, this will find both of them, but will rank the user with the name &#x201C;Ayende&#x201D; first.&#xA;Let us see another variant, we have a multi map index for users and accounts, both are searchable by name, but we want to ensure that accounts are more important than users. We can do that using the following index:&#xA;public class UsersAndAccounts : AbstractMultiMapIndexCreationTask&#xA;{&#xA;    public UsersAndAccounts()&#xA;    {&#xA;        AddMap&lt;User&gt;(users =&gt;&#xA;                     from user in users&#xA;                     select new {Name = user.FirstName}&#xA;            );&#xA;        AddMap&lt;Account&gt;(accounts =&gt;&#xA;                        from account in accounts&#xA;                        select new {account.Name}.Boost(3)&#xA;            );&#xA;    }&#xA;}&#xA;&#xA;&#xA;If we have query that has matches for users and accounts, this will make sure that the account comes first.&#xA;And finally, a really interesting use case is that based on the entity itself, you decide to rank it higher. For example, we want to rank customers that ordered a lot from us higher than other customers. We can do that using the following index:&#xA;public class Accounts_Search : AbstractIndexCreationTask&lt;Account&gt;&#xA;{&#xA;    public Accounts_Search()&#xA;    {&#xA;        Map = accounts =&gt;&#xA;              from account in accounts&#xA;              select new&#xA;              {&#xA;                  account.Name&#xA;              }.Boost(account.TotalIncome &gt; 10000 ? 3 : 1);&#xA;    }&#xA;}&#xA;&#xA;&#xA;&#xA;This way, we get the more important customers first. And this is really one of those things that brings up the polish in the system, the things that makes the users sit up and take notice.</p>
        </article>
        <article id="article-4650">
            <a href="https://benfoster.io/blog/aspnet-mvc-3-dependency-injection-structuremap/" target="_blank">
                <h2 class="title mb-6" id="article-4650">ASP.NET MVC 3 Dependency Injection with StructureMap</h2>
            </a>
            <p class="mb-2">by Ben Foster</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 17, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">StructureMap implementations of IDependencyResolver, FilterAttributeFilterProvider and IModelBinderProvider for dependency injection in ASP.NET MVC 3.</p>
        </article>
        <div class="button flex justify-between">
            <a href="464.html"><span class="back arrow"></span></a>

            <a href="466.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>