
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 558 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-5571">
            <a href="https://ayende.com/blog/4205/open-source-development-model" target="_blank">
                <h2 class="title mb-6" id="article-5571">Open Source development model</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 19, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">As someone who does a lot of Open Source stuff, I find myself in an interesting position in the CodePlex Foundation mailing list. I am the one who keep talking about letting things die on the vine if they aren&#x2019;t successful on their own.  I am going to try to put a lot of discussion into a single (hopefully) coherent post. Most of the points that I am going to bring up are from the point of view of an OSS project that got traction already (has multiple committers, community, outside contribution).  One of the oft repeated themes of the conversation in the CPF mailing list is that the aim is to encourage OSS adoption and contributions to OSS in businesses and corporations.  That sounds nice, but I don&#x2019;t really get why.   From the business side: if a business don&#x27;t want to use OSS, then it is in a competitive disadvantage compared to its competitors that do make use of it, since OSS projects tend to make great infrastructure and generate high quality base to work from. If you choose to develop things in house it is going to cost you a lot. And you are likely going to end up with an inferior quality solution.  This is not to disparage someone&#x2019;s effort, but a OSS project that got traction behind it is likely to have a lot more eyes &amp; attention on it than a one off solution. The Java side has demonstrated that quite clearly.  Even in the .Net world, I can tell you that I am aware of Fortune 50 companies making use of things like NHibernate or Castle. They can most certainly fund building a project of similar size, but it doesn&#x2019;t make economic sense to do so.  From the project side, if you got enough traction, you don&#x27;t generally worry about the OSS fearing businesses. It is their loss, none for the project.  It would be more accurate that the project won&#x27;t feel any pain if a business decide not to use it. Remember that unlike commercial software, OSS projects don&#x27;t really have an incentive to &quot;sell&quot; more &amp; more.   There is the incentive to grow bigger (for ego reason, if nothing else), get more people involved, add more features, etc. But unless there is some business model behind it (and in the .NET world, there are very few projects with a business model behind them), growing the project usually mean problems for the project team.  As a simple example, Rhino Mocks mailing list has an average of 140 messages per month. I had to scale down my own involvement in the mailing list because it took too much of my time. The NHibernate Users mailing list is crazy, averaging in a thousand messages a month this year alone.  That is even assuming that I want traction for a project, which isn&#x2019;t always the case. As a good example, I have a lot of stuff that I put out as one-use only solutions. Rhino Igloo is a good example of that, a WebForms MVC framework that we needed for a single project. I built it as OSS, we get contributions for it once in a while. But if it gets to be *very* active, I am going to find myself in a problem, because I don&#x27;t really want to maintain it anymore.   But in general, for most projects I do want to have more contributors. In the CPF mailing list the issue of getting contributions from companies was brought up as problematic. I disagree, since I don&#x27;t find that the problems that were brought up (getting corporate and legal sign up for contributing work, getting people to adopt OSS for commercial uses) has any relevance whatsoever to getting more contributors. By far, most contributions that we get for the projects I am involved at are from people making commercial use of them.   But usually, I don&#x2019;t really care about adoption.&#xA0; I have 15 - 20 OSS projects that I have either founded or am a member of, in exactly one of them I cared about adoption (Rhino Mocks), and that was 5 years ago, mainly because I thought it would give me some credentials when I was looking for a job (and it did).  For all the rest, I am working on those because I need them to solve a problem. I get the benefit that other people are going to look at them and contribute if they feel like it, but mostly, I am working on OSS to solve a problem, the number of users in a project isn&#x27;t something that I really care about.  There were three scenarios that were discussed in the mailing list that I want to address in particular.      A company would like to pay you 5 times your normal rates, but they have a &#x201C;no OSS&#x201D; policy, thus losing the contract.   I have to say that this scenario never happened to me.&#xA0; Oh, I had to talk with the business a lot of time. It is easy to show them why OSS is the safer choice.   Today, that is fairly easy. I can point out stats like this: http://www.ohloh.net/p/nhibernate and that trying to build something like NH is going to cost you in the order of 130 years and ~15 millions dollars. I can tell them that going with MS data access method is a good way to throw good money at upgrading their data access methodology every two years. I can point them to a whole host of people making good use of it.   I got lots of arguments to use. And they tend to work, quite well, in fact. I may need to talk to the lawyers, but that has generally been a pretty straightforward deal.&#xA0; So no, I don&#x27;t lose clients because of no OSS rule.   Beside, you know what, if they are willing to pay me 5 times my normal rate, I am going to be very explicit about making my preferences made and explaining the benefits. Afterward, they are the client, if they want to may me gobs of money, I am not going to complain even if I am going to use NIH as the root namespace.      Corporate developers have a problem getting permission to use OSS projects in their product or project.   I have seen it happen a few times in the past, but it is growing rarer now. The main problem was never legal, it was the .NET culture more than anything else. The acceptance of OSS as a viable source of software had more to do with team leads and architects accepting that than any legal team putting hurdles in the path.   Oh, you still need to talk to legal before, but you are going to do that when bringing a 3rd party component anyway. (You do make sure to run any commercial legal agreements through the legal department, right? You need to know that there aren&#x2019;t hooks involved there).     Corporate developers have a problem getting permission to contribute to OSS projects.   Once OSS is adopted, I never run into an issue where legal stopped the contribution of a patch. There are damn good reasons for the business to want this, after all.&#xA0; To that manager, I am going to say: &quot;look, we can maintain it, or we give it to the project, they maintain/fix/debug/improve it. we get great credits and we gain a lot for work we would have done anyway&quot;   A few final thoughts, OSS projects are a dime a dozen. In the .Net space alone there are thousands. Most of them, I have to say, aren&#x2019;t really that interesting. Out of those thousands of projects, there are going to be a few that would get traction, attract additional committers, outside contributions and a community.   I think it would be safe to say that there are around fifty such projects in the .Net space. There is nothing particularly noble or important in an OSS project that requires special treatment. If it gets enough attention, it will live on. If it doesn&#x2019;t, who cares (except maybe the author)?  The CodePlex Foundation, however it may end up as, is going to be dealing with the top fifty or so projects, simply because trying to reach the long tail of OSS projects is a futile task. I mentioned what I think would be good ways of helping the top projects (resources, coaching, money).  Another approach would be to turn it around, the CPF can focus on building a viable business model for OSS projects. A healthy OSS project is one that makes money for the people who contribute to it. It may be directly or indirectly, but if it isn&#x2019;t going to do that, it isn&#x2019;t going to live long. A labor of love would keep one or two committers working on a project, but it wouldn&#x2019;t generally sustain a team.  Finally, something that I think seems to get lost in all the noise around it, Open Source projects are about the code. I hear a lot about legal issues, making business adopt OSS, etc. I don&#x2019;t see discussion about the main thing.   Show me the code!</p>
        </article>
        <article id="article-5572">
            <a href="https://ayende.com/blog/4204/i-knew-there-were-reasons-for-those-multi-threading-warning-lists" target="_blank">
                <h2 class="title mb-6" id="article-5572">I knew there were reasons for those multi threading warning lists</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 19, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the warning signs for bad multi threaded code is calling code that you don&#x2019;t own while holding a lock. I just discovered a bug in NH Prof that is related to just that issue.  But I wasn&#x2019;t really stupid, and the story of this bug is a pretty interesting one.  Let us look at what happened. I have a deadlock in the application, where two threads are waiting for one another. In the UI thread, I have:     And on a background thread, I have:     This is actually code that happen in two separate classes. And it sounded very strange, until I walked up the stack and found:     All nice and tidy, and it looks good. Except that Sessions.Add invoke the SessionsCollectionChanged, which perform a block UI call, while the UI is trying to enter a lock that is currently being held.  Like I said, this is a classic threading issue, but it is pretty hard to see, unless you can actually get the stack trace.</p>
        </article>
        <article id="article-5573">
            <a href="https://ayende.com/blog/4203/two-strikes-and-you-are-out" target="_blank">
                <h2 class="title mb-6" id="article-5573">Two strikes, and you are out</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 18, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I don&#x2019;t have a lot of patience for repeated bugs. I just got a bug report that turn out to be in the result of the same feature as a previous bug I fixed.  I could have fixed the bug. But I didn&#x2019;t bother. A repeated bug in the same area for the same reason usually indicate a fragile design. In this particular case, the feature wasn&#x2019;t important, so I just ripped it all out, root &amp; branch.  If it was important, I would have still ripped the whole thing apart, and then I would rebuild it from scratch, using a different design.  Fragile designs are one of the worst enemies that you can have, they will keep dropping things in your lap until you finally fix them once and for all. And I find that usually just starting from scratch on a feature implementation is the best way of doing that.</p>
        </article>
        <article id="article-5574">
            <a href="https://ayende.com/blog/4202/optimizing-windsor" target="_blank">
                <h2 class="title mb-6" id="article-5574">Optimizing Windsor</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 18, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Recently we got a bug report about the performance of Windsor when registering large number of components (thousands). I decided to sit down and investigate this, and found out something that was troublesome.   Internally, registering a component would trigger a check for all registered components that are waiting for a dependency. If you had a lot of components that were waiting for dependency, registering a new component degenerated to an O(N^2) operation, where N was the number of components with waiting dependencies.  Luckily, there was no real requirement for an O(N^2) operation, and I was able to change that to an O(N) operation.  Huge optimization win, right?  In numbers, we are talking about 9.2 seconds to register 500 components with no matching dependencies. After the optimization, we dropped that to 500 milliseconds. And when we are talking about larger number of components, this is still a problem.  After optimization, registering 5,000 components with no matching dependencies took 44.5 seconds. That is better than before (where no one has the patience to try and figure out the number), but I think we can improve up it.  The problem is that we are still paying that O(N) cost for each registration. Now, to suppose systems that already uses Windsor, we can&#x2019;t really change the way Windsor handle registrations by default, so I came up with the following syntax, that safely change the way Windsor handles registration:          var kernel = new DefaultKernel();using (kernel.OptimizeDependencyResolution()){    for (int i = 0; i &lt; 500; i&#x2B;&#x2B;)    {        kernel.AddComponent(&quot;key&quot; &#x2B; i, typeof(string), typeof(string));    }}&#xA;  &#xA;&#xA;&#xA;Using this method, registering 5,000 components drops down to 2.5 seconds. &#xA;&#xA;I then spent additional time finding all the other nooks and crannies where optimizations hid, dropping the performance down to 1.4 seconds.&#xA;&#xA;Now, I have to say that this is not linear performance improvement. Registering 20,000 components will take about 25 seconds. This is not a scenario that we worry over much about.&#xA;&#xA;The best thing about the non linear curve is that for a 1,000 components, which is what we do care about, registration takes 240 milliseconds. Most applications don&#x2019;t get to have a thousand components, anyway.&#xA;&#xA;There are also other improvements made in the overall runtime performance of Windsor, but those would be very hard to notice outside of a tight loop.</p>
        </article>
        <article id="article-5575">
            <a href="https://ayende.com/blog/4201/more-nhibernate-commercial-support-options" target="_blank">
                <h2 class="title mb-6" id="article-5575">More NHibernate commercial support options</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 17, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The NHibernate scene is growing bigger.  I am starting to see NHibernate related jobs crossing me mailbox, NHibernate 2.1 downloads crossed the 20,000 downloads a while ago and a very active mailing list.  iMeta, who sponsored the development of the AST based parser and is currently sponsoring the Linq for NHibernate effort, is now also offering Commercial Support for NHibernate.  This is a separate offer from mine, and seems to be targeting a different audience.  From my point of view, the more the merrier, it simply shows that the market for NHibernate is growing, fast.</p>
        </article>
        <article id="article-5576">
            <a href="https://ayende.com/blog/4200/nh-prof-the-beta-mistake" target="_blank">
                <h2 class="title mb-6" id="article-5576">NH Prof</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 17, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the things that I should have done from the get go of the beta program was to force people to upgrade when their version is too old.  Why would I want to do that? Because people that continue to use old versions, and old versions has old bugs.  Take a look at this error report:     This version is almost a hundred builds old, and the error reported was fixed long ago. I also get errors from people using older versions than that.  When I built the error reporting feature, I was concerned about the user privacy, so I don&#x2019;t have any information about the user that can be used to identify him. I am reduce to this public plea: Just upgrade NH Prof already!</p>
        </article>
        <article id="article-5577">
            <a href="https://ayende.com/blog/4199/safe-by-default-is-also-annoying-by-default" target="_blank">
                <h2 class="title mb-6" id="article-5577">Safe by default is also annoying by default</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 17, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This was the cause of a NH Prof not being able to report some errors home.      I follow the logic, I agree with the logic, but I still goes ARGH!!!</p>
        </article>
        <article id="article-5578">
            <a href="https://ayende.com/blog/4198/find-the-differences-the-optimization-that-changed-behavior" target="_blank">
                <h2 class="title mb-6" id="article-5578">Find the differences: The optimization that changed behavior</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 16, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I was thinking about ways of optimizing NHibernate Search&#x2019; behavior, and I run into a bug in my proposed solution. It is an interesting one, so I thought that would be make a good post.  Right now NHibernate Search behavior is similar to this:          public IList&lt;T&gt; Search&lt;T&gt;(string query){    var results = new List&lt;T&gt;();    foreach(var idAndClass in DoLuceneSearch(query))    {        var result = (T)session.Get(idAndClass.ClassName, idAndClass.Id);        if(result != null)            results.Add(result);    }    return results;}&#xA;  &#xA;&#xA;&#xA;This isn&#x2019;t the actual code, but it shows how NHibernate works. It also shows the problem that I thought about fixing. The way it is implemented now, NHibernate Search will create a SELECT N&#x2B;1 query.&#xA;&#xA;Now, the optimization is simply:&#xA;&#xA;&#xA;  &#xA;    public IList&lt;T&gt; Search&lt;T&gt;(string query){    return session        .CreateCriteria&lt;T&gt;()        .Add(Restrictions.In(&quot;id&quot;, DoLuceneSearch(query).Select(x=&gt;x.Id)))        .List();}&#xA;  &#xA;&#xA;&#xA;There are at least two major differences between the behavior of the two versions, can you find them?</p>
        </article>
        <article id="article-5579">
            <a href="https://ayende.com/blog/4197/challenge-nh-prof-exporting-reports" target="_blank">
                <h2 class="title mb-6" id="article-5579">Challenge</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 15, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the things that I am working on right now is exporting NH Prof reports. This isn&#x2019;t an earth shattering feature, the idea is to take a report like this:     And give you the ability to save it in a format that you can send to your DBA, or maybe just put it away for later perusal.  I started with the simplest thing that could possibly work, exporting the reports to XML. Using Linq to XML, that has been a true pleasure, and got me this:          &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;unique-queries xmlns=&quot;http://nhprof.com/reports/2009/09&quot;&gt;  &lt;query average-duration=&quot;0.1&quot; count=&quot;10&quot; is-cached=&quot;false&quot; is-ddl=&quot;false&quot;&gt;    &lt;duration database-only=&quot;0&quot; nhibernate=&quot;0&quot; /&gt;    &lt;short-sql&gt;SELECT ... FROM Comments comments0_ WHERE comments0_.PostId = 1&lt;/short-sql&gt;    &lt;formatted-sql&gt;SELECT comments0_.PostId   as PostId1_,       comments0_.Id       as Id1_,       comments0_.Id       as Id5_0_,       comments0_.Name     as Name5_0_,       comments0_.Email    as Email5_0_,       comments0_.HomePage as HomePage5_0_,       comments0_.Ip       as Ip5_0_,       comments0_.Text     as Text5_0_,       comments0_.PostId   as PostId5_0_FROM   Comments comments0_WHERE  comments0_.PostId = 1 /* @p0 */&lt;/formatted-sql&gt;  &lt;/query&gt;&lt;/unique-queries&gt;&#xA;  &#xA;&#xA;&#xA;That is pretty easy to do, but then I hit a wall. This is good, but it isn&#x2019;t nearly enough. I can imagine that most of NH Prof users will want access to the raw data in this format, so they can slice &amp; dice it as they see fit, but I believe that I also need to provide a more readable form.&#xA;&#xA;I started to look at how I can generate PDFs from this, and I run into a problem. I don&#x2019;t have any experience doing such things, and while I don&#x2019;t doubt that I could learn it, I don&#x2019;t think that what is very likely to be a one off requirement is worth spending the time to really learn the topic.&#xA;&#xA;Therefore, I decided to try something a little bit different. I uploaded four sample reports here. I want to see if someone can provide me with solution to convert those to a nice PDF format.&#xA0; &#xA;&#xA;I am going to give away one NH Prof license to the first one that can show me a solution that I can use with NH Prof.&#xA;&#xA;The selected solution will also be featured in this blog, of course.&#xA;&#xA;The small print: Just to be clear, some variation on the selected solution is going to end up within NH Prof. I don&#x2019;t think it is a big task for someone who know what they are doing, and I believe that the NH Prof license offer is adequate compensation for that.</p>
        </article>
        <article id="article-5580">
            <a href="https://ayende.com/blog/4196/append-only-models-with-nhibernate" target="_blank">
                <h2 class="title mb-6" id="article-5580">Append Only Models with NHibernate</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 15, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I mentioned that using an append only model isn&#x2019;t just an infrastructure choice, it has a big effect on your API and your general approach to working with your model.  Let us look at a typical example of change the martial status of an employee:          // transaction is opened before method by the infrastructurepublic void Consume(ChangeMaritalStatus msg){    var emp = Session.Get&lt;Employee&gt;(msg.EmployeeId);    emp.ChangeMaritalStatus(msg.NewMaritalStatus, msg.MaybeNewSurname);}/* transaction is committed here and changes are flushed to the databaseby the infrastructure*/&#xA;  &#xA;&#xA;&#xA;As you can see, using this approach, this will issue an update statement from NHibernate. This is a typical model for using NHibernate.&#xA;&#xA;Next, let us look at the same action, using an append only model:&#xA;&#xA;&#xA;  &#xA;    // transaction is opened before method by the infrastructurepublic void Consume(ChangeMaritalStatus msg){    var emp = Session.GetLatest&lt;Employee&gt;(msg.EmployeeId);    var newEmpVersion = emp.ChangeMaritalStatus(msg.NewMaritalStatus, msg.MaybeNewSurname);    Session.Save(newEmpVersion)}/* transaction is committed here and changes are flushed to the databaseby the infrastructure*/&#xA;  &#xA;&#xA;&#xA;Notice what is going on in here. We changed two major things, first, we moved from just using a Get&lt;Employee&gt;(), an NHibernate method, to using GetLatest&lt;Employee&gt;(), which is an extension method. Second, where before we relied on NHibernate&#x2019;s change tracking to do the deed for us, now we get a new version from the method and we save it explicitly.&#xA;&#xA;If it reminds you of the functional model, this is accurate, in the append only model, data truly may not change, any update is just a copy of the old data plus whatever changes you wish to make.&#xA;&#xA;GetLatest&lt;TEntity&gt; implementation is going to depend on how you actually manage the data in the database. I would usually recommend something like the following table structure:&#xA;&#xA;&#xA;  &#xA;    CREATE TABLE Employees(    Id bigint not null,    Version int not null,    MaritalStatus int not null,    /*    other columns    */    PreviousVersion int null,    PRIMARY KEY (Id, Version)    FOREIGN KEY (Id, PreviousVersion) REFERENCES Employees(Id, Version))&#xA;  &#xA;&#xA;&#xA;Some people prefer to use dates for marking the differences between versions, but there are some significant advantages for using a version number. You have no fear of collisions or inaccuracy, which may happen with dates. It is also easier to read something like Employee # 12312/4 rather than Employee # 12312 / 2008-08-01T10:04:49.&#xA;&#xA;You can just turn all queries in the database to something like:&#xA;&#xA;&#xA;  &#xA;    &#xA;      SELECT * FROM Employees thisWHERE Id = 12312 AND Version = (    SELECT max(Version) FROM Employees version     WHERE version.Id = this.Id)&#xA;    &#xA;  &#xA;&#xA;&#xA;But this has some problems, it forces a scan of at least part of the table (although it will be at least an index scan, if the DBA is worth anything at all) which is a lot of work. We can probably get far better results by using:&#xA;&#xA;&#xA;  &#xA;    &#xA;      CREATE TABLE LatestVersions(    Type nvarchar(255) NOT NULL,    Id bigint NOT NULL,    Version int NOT NULL    PRIMARY KEY (Type, Id))    SELECT * FROM EmployeesWHERE Id = 12312 and Version = (        SELECT Version FROM LatestVersions        WHERE Type = &#x27;Employees&#x27; AND LatestVersions.Id = Employees.Id )&#xA;    &#xA;  &#xA;&#xA;&#xA;I haven&#x2019;t run any comparison tests on this, but this is likely to be faster. Regardless, I consider it more elegant.&#xA;&#xA;The GetLatest&lt;TEntity&gt; simply use HQL or Criteria API to make NHibernate perform this query.&#xA;&#xA;I usually also install a pre update event listener that just throws when it encounters an update (which is not allowed in the system).&#xA;&#xA;And yes, beyond these two changes, everything else just flows. You never update, you always get by latest, and that is about it. Well, almost, you also need to make sure that NHibernate creates the primary key properly, by incrementing the version and updating the LatestVersions table. This can be done using an IIDentityGenerator.&#xA;&#xA;There is a side topic that I am not going to discuss right now relating to how you are going to handle the reporting model. This type of model is great for a lot of reasons, versioning, auditing, etc. What is it not great at is reading data.&#xA;&#xA;The problem is that you generally have a model that doesn&#x2019;t work that well for reading from the database or for showing on the screen. What usually happen is that there is a separate process that is responsible for taking this data and turning that into a more palatable from for reporting purposes (and remember that I consider reporting to be also show me the details screen of employee #12312).&#xA;&#xA;In particular, queries on this type of model are awkward, slow and tend to be annoying in general. I heartily recommends using a separate reporting model.</p>
        </article>
        <div class="button flex justify-between">
            <a href="557.html"><span class="back arrow"></span></a>

            <a href="559.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>