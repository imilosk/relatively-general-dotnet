
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Home â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<script>
    const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

    function getUserPref() {
        const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
        return storedTheme || (lightModePref.matches ? "light" : "dark");
    }

    function setTheme(newTheme) {
        if (newTheme !== "light" && newTheme !== "dark") {
            return console.warn(
                `Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
            );
        }

        const root = document.documentElement;

        // root already set to newTheme, exit early
        if (newTheme === root.getAttribute("data-theme")) {
            return;
        }

        root.setAttribute("data-theme", newTheme);

        const colorThemeMetaTag = document.querySelector("meta[name='theme-color']");
        const bgColour = getComputedStyle(document.body).getPropertyValue("--theme-bg");
        colorThemeMetaTag.setAttribute("content", `hsl(${bgColour})`);
        if (typeof localStorage !== "undefined") {
            localStorage.setItem("theme", newTheme);
        }
    }

    // initial setup
    setTheme(getUserPref());

    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("theme-toggle").addEventListener("click", () => {
            const theme = localStorage.getItem("theme");

            if (theme === "dark") {
                setTheme("light");
            } else {
                setTheme("dark");
            }
        });

        document.getElementById("toggle-navigation-menu").addEventListener("click", (e) => {
            const button = e.target;
            const ariaExpanded = button.getAttribute("aria-expanded");
            const header = document.getElementById("main-header");

            if (ariaExpanded === "true") {
                button.setAttribute("aria-expanded", "false");
                header.classList.remove("menu-open");
            } else {
                button.setAttribute("aria-expanded", "true");
                header.classList.add("menu-open");
            }
        });
    });
</script>

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <theme-toggle class="ms-auto">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main">
    <section aria-label="Blog post list">
        <a href="https://ayende.com/blog/3784/nh-prof-alerts-too-many-database-calls-per-session" target="_blank"><h1 class="title mb-6">NH Prof Alerts</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: December 30, 2008
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is a bit from the docs for NH Prof, which I am sharing in order to get some peer review.&#xA;&#xA;One of the most expensive operations that we can do in our applications is to make a remote call. Going beyond our own process is an extremely expensive operation. Going beyond the local machine is more expensive yet again. &#xA;Calling the database, whatever to query or to write, is a remote call and we want to reduce the number of remote calls as much as possible. This warning is being raised when the profiler notice that a single session is making an excessive number of calls to the database. This is usually an indicative of a potential optimization in the way the session is used. &#xA;There are several reasons why this can be: &#xA;&#xA;    Large number of queries as a result of a Select N&#x2B;1.&#xA;    Calling the database in a loop.&#xA;    Updating (or inserting / deleting) large number of entities&#xA;    Large number of (different) queries that we execute to perform our task.&#xA;&#xA;For the first reason, you can see the suggestions for Select N&#x2B;1. Calling the database in a loop is generally a bug, and should be avoided. Usually you can restructure the code in a way that doesn&#x27;t require you to do so.&#xA;Updating large number of entities is discussed in Use statement batching, and mainly involves setting the batch size to reduce the number of calls that we make for the database.&#xA;The last issue is the more interesting one, in which we need to get data from several sources, and we issue multiple queries for that. The problem is that we issue multiple separate queries for that, which has the aforementioned issues.&#xA;NHibernate provide a nice way of avoiding this, by using Multi Query and Multi Criteria, both of which allow you to aggregate several queries into a single call to the database. If this is your scenario, I strongly recommend that you would take a look Multi Query and Multi Criteria and see how you can use them in your application.</p>
        <a href="https://ayende.com/blog/3783/required-debugging-crash-recovery-assistance-in-nj-ny" target="_blank"><h1 class="title mb-6">Required: Debugging / Crash recovery assistance in NJ / NY</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: December 30, 2008
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A client of mine has run into a production problem, and we need to dig into the application to understand what is going on. Unfortunately, I am not on site, so the level of help that I can contribute currently is not that great. We are looking for someone that can come onboard and help us figure out what the exact problem is. I don&#x27;t have all the details about the production issue yet, but the symptom is very high connection count to the database, and the OS refusing connections with TIME_WAIT. We are pretty sure that there is a connection leak somewhere, but so far we have no been able to identify it. The application in question compromise of classic ASP, ASP.Net and .Net Window Services talking to a Sql Server 2000 database. My client is interested in someone who can come onsite and diagnose the issue. They are located in Fort Lee, NJ, near the GWB. Obviously we would like to get to the root of the issue ASAP. If you think that you can help, please contact me and I will put you in touch with my client.  And yes, this does seems like a scenario right out of Release It!</p>
        <a href="https://ayende.com/blog/3782/software-as-a-service-is-a-matter-of-trust" target="_blank"><h1 class="title mb-6">Software as a Service is a matter of trust</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: December 30, 2008
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">There is a whole world of services out there that one can take advantage of, from online office suite (Google Docs are surprisingly functional) to email, from financial services to hosting your own data center in the cloud. Some of them are free, and some are commercial. I am taking advantage of many of them. Mostly because I am one of those people who keep moving around between machines, and anything that isn&#x27;t web based isn&#x27;t practical to me. Whenever the option of using someone else&#x27;s services come up, there are a few question that we need to deal with:  Security - Do I trust these guys to handle my data? Longevity - Are they going to be around for a long time? How do I get out - Are they locking all my data inside? Can I get it out in a reasonable way? Reliability - Can I rely on them to be up? How often do they have issues? Support - If I have an issue, who deals with it? How do I contact them? How responsive they are? What kind of treatment do they have? Transparency - If there is an issue, do I get to know what happened? How we can ensure that it will not happen again? None of these are idle questions. Right now, I cannot work on NH Prof because of an issue with assembla&#x27;s Subversion. And Ken, yes, I know this wouldn&#x27;t have happened if I used Git. When I used Google Docs to manage my finances, there were several incidents of me logging into the system and not seeing any of my spreadsheets. They always came back several hours later, but that was a very unwelcome feeling. I have run into issues with non responsive (or even hostile) support before, and this is one of the reasons that I would immediately terminate all association with a particular provider. I also prefer services that have a commercial option to the completely free one. With the completely free ones, unless they are backed by someone like Google or Microsoft, there is a strong likelihood that some day it will all just be gone. Now, for many of those services, I can get a server and host them myself. The problem is that there is a non trivial management cost for that. And if I want to do that, I would need to invest quite some time in doing so. The plus side is that if there is an issue, I can fix this. The down side is that if there is an issue, I need to fix it. In the end, it come down to how much you trust the service provider, more than anything else. I don&#x27;t think it is feasible to ignore those services, or even in any way smart. But you do have to be cautious about who you are using, and have a planned strategy to back out of this service, or move to another one. In my case, some of those strategies means falling back to gool ol&#x27; Excel and digging through my email. For some things, like my email, I don&#x27;t have a fallback strategy. If Gmail is down, I am going to be pissed, but the features that I get from Gmail is so important to my workflow that I can&#x27;t imagine doing it any other way. Trust, that is all there is.</p>
        <a href="https://ayende.com/blog/3781/discussion-oo-101-solutions-and-the-open-close-principle-at-the-architecture-level" target="_blank"><h1 class="title mb-6">Discussion: OO 101 Solutions and the Open Close Principle at the architecture level</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: December 30, 2008
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This post is based on the transcript of a conversation between me and Luke Breuer, regarding the application of the Open Close Principle to the system architecture. The quoted sections are Luke&#x27;s, and my own responses are shown underneath them. This is a different style from my usual posts, because this is a conversation, which was transcriptted and only slighted edited. I hope that this would help all those who wanted to know more about what I meant about using OPC at the architecture level and how to structure systems where you only ever add new things. Let us get started:  The topic of the conversation &#x2013; well, I mean, the most general topic is how do you make software better.The more specific one is that you&#x2019;re talking about using the open and close principles for the core architecture and how that enabled you to extend it very easily and it just turned out that that allowed you to do a lot and not have much of a maintenance problem. And it also meant that you didn&#x2019;t need to test or gets 100&#x2011;percent test coverage like a lot of people would advocate almost blindly. I&#x2019;m not sure that I would say that I don&#x2019;t want to have tests. I think the tests would be very helpful in many scenarios. But there are scenarios where tests are awkward to use or just plain annoying. And the scenario that I talked about in the blog post, I had an application that was was WebForms application so it&#x2019;s inherently hard to test. We tried to test it using Watin for a while, but that was very slow, and it was very fragile because of the Java script &#x2013; we did a lot of Ajax. So trying to synchronize between the test, the server, and the Java script code was just literally an impossible task. When I found myself writing threading code in Java script, I know that I went too far.  So basically, we had a problem of trying to synchronize when we running the test and we had a lot of ajax in the pages, then we had three different execution environment. One of them was the test. One of them was the actual code on the server. And one of them was the Java script that was running on the browser. I wrote threading coding and Java script.  That was already difficult to try to do, so we gave that up. I suppose that we could have tested the inner layers of the application, but at that point I felt that it wouldn&#x2019;t worth it &#x2013; it wouldn&#x2019;t have enough ROI to do so. So we basically didn&#x2019;t. And I just came out of a project where I tried to do everything right. I had this rich domain model and I had this rich semantics of a how it was working. And I had this really nice testable solution. Then we actually hit changing requirements. And the test that I was so proud of, became from between enabler of change to actually being a hindrance of change. They shackled us to the old design because when I tried to make changes the way the system worked, because a business requirement has changed to the level that old assumptions that I made were no longer valid. I now had to make a drop down the old test suite and rewrite a new test as I went along. And then I had to try to port the old test and to see if they made sense. This is not a standard thing, this was something that was we basically changed something in the core of domain. But what I found was that at least for my style of work, is that I tend to have a lot of drafts along the way. And drafts change very rapidly. So usually the way I try to build software is to say, &#x201C;Okay, I&#x2019;m going to write it with tests,&#x201D; but these aren&#x2019;t sacred. That is, if I find that I have a significant enough change I&#x2019;m going to blow away the test and start over. Usually we start over from scratch and reboot the test project. Then I&#x2019;m going to salvage from the original production code and the original test code. But this is now salvage mode. I&#x2019;m not going to try to port everything. This is too big a change in many cases. Now this is for draft mode. This is where you start a project. Now I had a team of people that didn&#x2019;t really did TDD and I wasn&#x2019;t confident in my ability to impart this knowledge in that time. What I decided to do was to take a different approach to how we were going to build the system. I wanted to be able to build the system in a way that we didn&#x2019;t actually have to go and do integration all the time. This was a web application. So we had a very well&#x2011;defined scope of change. We only changed one page. Now when I&#x2019;m talking about web application in which we only changed one page, now we had this one feature called. This was the search feature. And that search feature took roughly &#x2013; let me think &#x2013; roughly a month and a half, a single feature, a month and a half. And this is calendar time, so maybe four or five man months just from the point of view of the effort that we dedicate to this thing. This was one of the main features of the application. And basically it had features from everything like I want to be able to search by just about every attribute on every piece of the entire domain model, to I want to be able to export that to Excel, or a world or I want to be able to go from the search page to a particular resort.  That sounds like exactly the software that my company makes. Yeah, and then I want to go to from that resort to with children, and so on and so forth. So and now from this fifth level down, a page that I went through from the search page, I want to hit, &#x201C;Okay, back to search,&#x201D; and go back to the page that I started with, with all the settings, all my search, all my paging, sorting, whatever that I had there. That was a very nice page to work on. A very, very complex page. We actually managed to do it quite nicely I think. Anyway, so the base architecture stated that we want to have only add only features, or add only code. So because we had the Web model, we are able to say the page is the unit of change, if we want to make a change to a particular feature then we had to look for the page or the set of pages that compromised this feature. But we actually didn&#x2019;t have to change a feature just because. Because we always had a very well defined scope what we wanted to do. So example, the search page had a seven or eight features in it. But the way that we built the search page meant that there was isolation between every feature in the page. So we have the export to Excel as a good example. The export to Excel was literally a build as a, &#x201C;Okay, you click this button. You&#x2019;d been redirected to another page that is going to now generate the actual Excel file that you&#x2019;ll download.&#x201D; The unit of change from our perspective was, &#x201C;Okay, let&#x2019;s create the new URL that will generate the Excel file from the search results.&#x201D; And all the change that we actually had to do to code that was already written, was go to the search page and change the link for the export to Excel. And that was it. We didn&#x2019;t actually have a way to break existing features because we never touched them. And once we had this working, we can move on to new features. And if the customer found a bug or if they wanted to change a feature, then we&#x2019;re able to say, &#x201C;Okay, this is my feature.&#x201D; It&#x2019;s because we built it using an always add architecture, the feature were inherently small. The biggest feature that we had was the search functionality which was, if I remember correctly, spread across three files and had a total of 3,000 lines. By the way, just to give you an appreciation, Rhino Security, which is a full&#x2011;blown framework for security in NHibernate, is fifteen hundred or so. That is how complex it was. But even this feature was literally mostly dealing with just building the queries, not actually doing some complex logic that we could somehow break. Now another thing that I&#x2019;m fond of, so I had other project in which I improve on this idea. And basically I&#x2019;m calling it just hard code it. This came out of the notion that we already have a really great way of configuring the system. We write code! And the tool that we use to configure the system is essentially the compiler.So let&#x2019;s say that I want to write a business rule. If you are a preferred customer, you are going to get 5 percent off some item, all the chocolates that you buy. Okay? Something like that. This is a sale. This is an offer, or whatever you want to call it. Now one of the way of doing that is by configuring via XML, creating a rule engine or whatever you want. All of those options are pretty complex. An easy option would be just write the bloody thing inline. Just if this is the the problem, write if your a preferred customer and just do it. Now the problem with doing that in line is well this is very easy to do. Then now you are going to are you into malignance issues because now you have logic scattered all over the place. So the solution for that is to say, &#x201C;Okay. I&#x2019;m going to formalize the process of hard coding things.&#x201D; I mean, why is it that people always think that a hard coding is a bad idea? And why is it that so many people treat hard coding is a sin? Because from our perspective that is because people are drawn to hard coding because it&#x2019;s so easy. And because it creates maintenance problems down the road, we treat it like a sin. So the idea is let&#x2019;s formalize hard coding in to an approach that is maintainable. So now we take the idea of order processing, of changing the way that we process orders. Like if you are a preferred customer, you get 5 percent discount for chocolates. We create an extension point an abstraction called IOrderProcessingRule. Now in order to apply a new business rule, you write something like a, &#x201C;Give preferred customer 5 percent &#x2013;&#x201D; this is the class name, by the way &#x2013; &#x201C;Give_preferred _a customer_5_percent_on_chocolates.&#x201D;  Okay. So now we are going to formalize this and say something like this: public class Give_preferred_Customer_5_percent_discount_on_chocolate : IOrderProcessingRule&#xA;{&#xA;     public void Process(Order order)&#xA;     {   &#xA;            order.OrderLines&#xA;                .Where(x=&gt;x.Prodcut.Name.Contains(&quot;chocolate&quot;)&#xA;                .Apply(x=&gt;x.AddDiscount(5.Percent());&#xA;     }&#xA;}&#xA;So we write this piece of code and we drop these in a particular namespace in our application. And now we are done. Because now the system will automatically pick up this rule, apply it in specific places. And now you can literally forget about everything else that you need to do because you have written the code to do that. The order possessing only knows about IOrderProcessingRule. That piece of code is a very generic, very easy to prove that this is correct. And you don&#x2019;t really have to manage complexity because you are just doing that. You writing everything inline, in a formal fashion, and we overcome complexity by splitting it into tiny pieces.&#xA;So here is a blog post that I wrote about that, basically we write an entire system is in this approach. We had somewhat more elaborate approach of how to do things. But this literally reduced the time of new features from a day to half an hour, something like that.&#xA;&#xA;Okay. So the deployment story &#x2013; kind of written my questions here. So you just &#x2013; I&#x2019;m guessing you compile it and you just drop the DLL on a Web server directory somewhere and it pick this up.&#xA;That is one option. Another option is just compile this on the fly and treat this as a script. Now this is still using the C# because we assume that we may want to use such tool as refactoring or whatever on that. Another option that we my have is just use DSL for that and give the user a very specific nice tool in order to handle that.&#xA;&#xA;So you&#x2019;re actually talking about supplying the C# compiler at the client&#x2019;s.&#xA;The C Sharp compiler is already deployed there. You don&#x2019;t have to do anything, the compiler is bundled with the .NET runtime.&#xA;&#xA;Oh, okay. Okay. So you &#x2013; alright. So you can do code CodeDom and all that. On any machine, you can access CodeDom and do compilation.&#xA;This is how you do this, hot code swapping web cast. So your option is basically now you have the order processing engine that takes order processing rules and it may take several order processing rules because &#x2013; I mean several order processing rule types &#x2013; let&#x2019;s say this &#x2013; for different steps in the execution of processing the order. So you may have an IAfterAuthorizationRule or something like that, or a IPreAuthorizationRule, all sort of stuff like that, that you can literally select what you are going to do.&#xA;I handled that by having a common IOrderProcessingRule just having an attribute call [Handle] and then have an operation, a list of operations that this can handle. And this told the engine it was point to an action executer. Usually I also say that the rules that I&#x2019;m creating is also inherent from an abstract class and not from an interface. Because I&#x2019;m pounding the hell out of the common scenarios in order to get them into a set of utility methods inside of abstract class so the code that I actually have inside my order processing rules is extremely simple and clear, something like the code that we have above, this is the code that you have. That&#x2019;s it.&#xA;&#xA;So how you handle ordering of five different classes to implement this?&#xA;I don&#x2019;t. Ordering &#x2013; in this case, ordering doesn&#x2019;t matter. If order does matter, then I am creating a composite and explicitly ordering them.&#xA;&#xA;So you create a class that composes other classes?&#xA;Yes, although I would strongly suggest not relying ordering because then you&#x2019;ll get into more complex scenarios.&#xA;&#xA;Okay. What about detecting when business logic conflict on other business logic, when there are possible contradictions on what&#x2019;s being done?Define &#x2013; give me an example.&#xA;&#xA;Well, I&#x2019;m just thinking that if you have a bunch of business logic are you requiring someone just to have it all in their head or can you do some sort of analysis on it?&#xA;Oh, now you&#x2019;re getting into why you want to have a DSL. So usually that really depend on the type of things that you&#x2019;re doing. Because let&#x2019;s say that we are back in the order processing scenario. And I&#x2019;m sorry if you have a better scenario that fits your domain we can talk about that. Do you have one? Something that fits your own domain better?&#xA;&#xA;Well, something &#x2013; we have an extremely complex problem that I don&#x2019;t know if it&#x2019;s useful to discuss. The hospitals, at least in America, have contracts with insurance companies. It defines the patient came in with this problem, got diagnosed and had these procedures and drugs and whatnot provided them. And there is someone who hates software developers working for some of these insurance companies, maybe a lawyer, maybe not &#x2013;&#xA;And they give you these crazy rules?&#xA;&#xA;Insane rules. Actually, I have a friend at the company and he&#x2019;s actually identified ambiguities as a legal language. So that things could actually be interpreted to it legally.&#xA;&#xA;I once was able to go to company because I tried to implement something and wasn&#x2019;t able to do that. And we figure out that we literally their business model was not possible, not the way that they stated that.&#xA;&#xA;It&#x2019;s very interesting because your approach here might work well for the contract processing. But right now it&#x2019;s all just straight comparative code. Because you have to do it a few times to detect a pattern and figure out how best to effectively parameterize it. Which is what the DSL does to the business logic.&#xA;I would actually say that if you have &#x2013; how many rules do you expect to have in the system? To the nearest hundred...&#xA;&#xA;Three hundred and eighty.&#xA;Three hundred and eighty. So at this point you really want to be able &#x2013; I mean you really want to &#x2013; 300 is now beyond your ability to remember off the top of your head. And it&#x2019;s also usually more than anyone can remember, period. So now you have a system that you can&#x2019;t understand, by design. Okay? Yeah. This is why when people do audits, they are getting very, very scared.&#xA;So anyway, one of the things that they do in this situation &#x2013; when you have literally thousands of rules. And now you have to start building into the system traceability and visibility. So give me an example of a rule that you have.&#xA;&#xA;An example of a rule is that if a patient has a certain kind of operation, say an appendectomy or something like that, that that procedure sets a maximum price on how much the insurance company will pay. &#xA;By the way, I was wrong. I actually haven&#x2019;t looked at the data structure, but we have what looks like 3,700 rules.&#xA;Thirty&#x2011;seven hundred, 3&#x2011;7&#x2011;0&#x2011;0.&#xA;&#xA;Yes&#xA;Wonderful. Wonderful. Okay. But &#x2013; and here is the funny part. Only a few of them are valid in each particular scenario.&#xA;&#xA;Correct. And then the 380 does tell you that we have &#x2019;em in groups somehow. So it&#x2019;s not completely crazy. It&#x2019;s just mostly crazy.&#xA;Okay. So given this scenario, here is what I would try to do. At this point the rules say that you have enough availability to try to do it using a DSL. But even if you don&#x2019;t want to do it using a DSL, then a lot of the scenarios apply, a lot of theory apply.&#xA;You have to some have some sort or rule evaluation context. So when you execute the rules on top of some scenario, every rule that evaluate is valid has to be recorded. Along with recording that this rule is valid, you also record what is the condition that was evaluated to be valid.&#xA;And that give you a whole world of options just from the visibility system. Why did we say that this guy is not valid for insurance? Well, what are the rules that have now been valid. Okay I see that he&#x2019;s a heavy smoker, and he had an appendicitis operation last six weeks. So those two are valid. I see that the rule&#x2019;s name is &quot;don&#x2019;t give insurance if patient&#x2019;s a heavy smoker&quot;. Okay. Now I know what&#x2019;s happened.&#xA;So just from that point of view, you are being very clear about what&#x2019;s going on.&#xA;&#xA;Can I brainstorm a little bit on your code there? So it seems that what you&#x2019;re allowing is, first of all, it can definitely create classes that take &#x2013; lambda expressions in constructor and test instances of those to your processing engine to parameterize the stuff that can be parameterized. Maybe you don&#x2019;t even need a lamda.&#xA;I&#x2019;m not sure. Let&#x27;s talk in code, okay? That is usually better.&#xA;// Luke&#x27;s suggestion to parameterize&#xA;public class Give_preferred_Customer_discount : IOrderProcessingRule&#xA;{&#xA;     public Give_preferred_Customer_discount(Expression does_discount_apply, decimal discount)&#xA;     {&#xA;          ...&#xA;     }&#xA;&#xA;     public void Process(Order order)&#xA;     {   &#xA;            order.OrderLines&#xA;                .Where(doesc_discount_apply)&#xA;                .Apply(x=&gt;x.AddDiscount(discount.Percent());&#xA;     }&#xA;}&#xA;You&#x2019;re being over generic.&#xA;&#xA;Well, wait a second. Let&#x2019;s go see if... so then we can say where discount apply. So theoretically it could be parameterized that way. So what&#x2019;s bad about that?&#xA;Because now you&#x2019;re being overly generic. Who is going to configure this?&#xA;&#xA;Who&#x2019;s gonna use it?&#xA;Yeah. Who is going to instantiate this class?&#xA;&#xA;I don&#x2019;t know. That depends on the execution model. What I&#x2019;m just saying is I&#x2019;m trying to figure out way to parameterize the rules where it makes sense to because that&#x2019;s a lot of hard coding and if you have the same rule slightly many different times, that&#x2019;s a lotta copy pasting.&#xA;Don&#x2019;t copy/paste. Use inheritance.&#xA;// a better way to parameterize by Oren&#xA;public class Give_preferred_Customer_5_precent_discount_on_chocolate : IOrderProcessingRule&#xA;{&#xA;     public Expression&lt;Func&lt;OrderLine, bool&gt;&gt; Condition&#xA;     {&#xA;                get&#xA;                {&#xA;                        return line =&gt; line.Product.Name == &quot;Chocolate&quot;;&#xA;                }&#xA;     }&#xA;     &#xA;     public Expression&lt;Action&lt;OrderLine&gt;&gt; Action&#xA;     {&#xA;                get&#xA;                {&#xA;                        return line =&gt; line.AddDiscount(5.Precent());&#xA;                }&#xA;     }&#xA;}&#xA;Basically the idea is the same, but now instead of actually having code that execute, we split the difference into two things. First we have the condition and the condition is an expression tree, so we can process that at run time.&#xA;We have a rule that contain two properties, condition, and action. Both of these properties return a lambda expression, an expression tree because now we are able to process that at run time. Now we are able to take a look at what the code actually does. Even if we just perform a ToString() on the expression tree, that still means that we have a lot of more information at run time than we had any other way. Same thing for action. Because we are &#x2013;&#xA;&#xA;Now that&#x2019;s a lot of code to write. I&#x2019;m guessing you would use DSL so you can actually specify it on one line and not get what you have there?&#xA;In the DSL example, we will have something like this:&#xA;// this is a DSL equivalent, which is compiled directly to IL&#xA;when line.Product is Chocolate:&#xA;    apply_discount 5.percent&#xA;This would be this code would translate to in a DSL.&#xA;&#xA;Okay. So would you use the DSL to generate that C# code?&#xA;No. This DSL is directly compiled into IL code.&#xA;&#xA;It&#x2019;s kinda funny. I had no idea that out of this conversation I would get a possible way to make our hospital contract processing much better.&#xA;Here is the example hospital rule:&#xA;// example rule of a rule that a US insurance company would &#xA;// have that defines how much it will pay a hospital for its &#xA;// client; the contracts insurance companies have with hospitals&#xA;// can be _very_ complex&#xA;when patient_arrived:&#xA;    had_a inflamed_appendix&#xA;    &#xA;when patient_left:&#xA;    did_not_have inflamed_appendix&#xA;    &#xA;set_max_payable_cost 14_000&#xA;Something like that. So now this is the single rule. Now let&#x2019;s write another rule. Let&#x2019;s say it&#x2019;s when patient arrived and patient is premium member. And let&#x2019;s say had appendix. If you wanted to be really nasty, you could do something like that. When patient, if he went in not being a premium member and left being a premium member, then he is payable for the higher amount. Stuff like that.&#xA;// another rule&#xA;&#xA;when patient_arrived and patient is premium_member:&#xA;    had_a inflamed_appendix&#xA;    &#xA;set_max_payable_cost 19_0000&#xA;Now this is very initial language design obviously. So take that with a grain of salt. But this is what you&#x2019;re talking about. This is the type of rules that you have. Now the moment that we start having rules like that, now we can start asking questions like, &#x201C;What are my rules for inflamed appendix? What am I supposed to do?&#x201D;&#xA;&#xA;And it&#x2019;s readable.&#xA;Not readable, queryable. Now you can ask what are my rules for an inflamed appendix and you will get an answer. For premium members, if the recuperation &#x2013; and you should probably &#x2013; we can do something better like saying had an operation for.&#xA;//better domain semantics&#xA;had_an_operation_for inflamed_appendix&#xA;&#xA;is_a premuim_member&#xA;&#xA;set_max_payable_cost 19_0000&#xA;Okay? So this is now much better concept for when left, when arrived. So now you can start doing queries on top of that like saying, &#x201C;Okay. Show me everything that what we do for inflamed appendix,&#x201D; and you get an answer. Ask the system what happens if a patient has an operation for an inflamed appendix and the system will tell you all the different possibilities; in the above case, it would tell you that:&#xA;&#xA;if the person is not a premium member, the maximum cost will be 14,000&#xA;if the person is a premium member, the maximum cost will be 19,000&#xA;You get, &#x201C;Okay, here is what we do.&#x201D; And because we have a structure about how we build things, then we say, &#x201C;Okay. For premium member, this is what you&#x2019;re doing. For a non&#x2011;premium member, this is what we are doing. Here are the limitations. Here is the max payable. Here is the duration in which we willing to pay. We are not willing to pay if you did it in none of our own hospital. If this was an emergency procedure, blah, blah, blah, blah.&#x201D; So the idea here &#x2013; this is a&#xA0; rule but it&#x2019;s not write only. It&#x2019;s queryable as well and now you can start doing business intelligence on top of your own business rules.&#xA;&#xA;So we actually do some of that. One of the things that we want to do is the hospitals renegotiate these contracts every year. And what they wanna do is, &#x201C;Well, how can I change my prices given the very complex rules that I have so I can make more money?&#x201D;&#xA;Oh, wait. Now we need to have simulation capabilities as well. This is really powerful stuff.&#xA;&#xA;This is actually probably a pretty good example to both explain why your approach here is really good, and I can actually &#x2013; if this turns out well enough, I could actually implement this. &#xA;Okay, yeah, yeah. That depend &#x2013; and what you&#x2019;re writing now that depend on the structure if your DSL, on the way you build things. But because &#x2013; now another issue, this actually compiled down to IL. So for your perspective, this is insanely fast. You can also do things like &#x2013; okay, let&#x2019;s try to do speculative analysis. What&#x2019;s going to happen if you are going to raise based on my last year history?&#xA;Let&#x2019;s execute all of last year&#x2019;s cases on top of this here set of rules and see how we can optimize what we actually get. Let&#x2019;s say that we know we have 60 people with appendicitis came to the hospital. And what happen if we actually tweak this rule to say that they only get this amount, like if they have a bad credit rating or something like that?&#xA;&#xA;Our process of applying the rules actually records when each rule has been created and which rule has been invoked. So it doesn&#x2019;t give you quantity analysis capability here, but we can ask how many times was this rule was invoked.&#xA;Yeah, but what we&#x2019;re trying to say, you can actually try to do it the other way around. You have the history of the cases that you had, right? Now let&#x2019;s say you are in the renegotiation period with the hospitals and you want to be able to tell them, &#x201C;Okay, I&#x2019;m going to reduce the cost for an appendix operation by $1,000.00. But I&#x2019;m going to give you three pregnancy checks or whatever,&#x201D; because based on past history, you can say, &#x201C;Okay, this will &#x2013; if next year is the same as this year, I know that I&#x2019;m actually going to have a lot more &#x2013; it&#x2019;s more cost effective to do this thing than that thing.&quot;&#xA;And then you actually get into the point where your actual technical expertise and ability to mine and manipulate the data that you have is allowing you to give your hospital what they want, but at the same time, remain competitive and actually make more money.&#xA;&#xA;Oh, yeah. And an advantage of this right here, I think we get a throughput of about 1,000 accounts &#x2013; each time patient goes in and gets something done, we have a throughput of about 1,000 accounts a second right now. If this C# approach could significantly improve on that, and you go from a process that &#x2013; a what if process of several hours to a day down to maybe ten minutes.&#xA;How many accounts do you have?&#xA;&#xA;In the system, we have several millions.&#xA;I would say that you can do that in under three minutes.&#xA;&#xA;That would be fantastic.&#xA;You can just throw it on a grid. The main problem would be just loading the data to access that. But those are all just in memory rules that you can just spit out and just execute immediately basically.&#xA;&#xA;I mean strictly speaking, if you get enough machines out there you could type in a rule and get what changed to the picture.&#xA;Actually, a million records is something that you can do very easily. I mean you can just pre load them into memory and just execute that. So let me think for a second. Assuming that you don&#x2019;t have a &#x2013; yeah. Drop the three minutes, maybe less. You can probably do on&#x2011;the&#x2011;fly changes.&#xA;&#xA;I don&#x2019;t doubt it. I mean, I&#x2019;ve actually wanted to do this from the beginning, but I had too much else to do so...&#xA;Okay. So how much of the system can you implement using this approach?&#xA;&#xA;Well, this is &#x2013; the thing with this is you can &#x2013; when you&#x2019;re &#x2013; with the code you have above there, you&#x2019;re basically saying, &#x201C;I&#x2019;m going to assume that the rule has a pretty specific form, a set of conditions for whether the rule applies, and a set of actions to perform if the rule applies. That gets you some of the amounts, but it doesn&#x2019;t get you rules interacting with each other.&#xA;What do you mean by that?&#xA;&#xA;Which is something that we can&#x27;t do without. What I mean is that if a certain procedure happens, it changes the evaluation model. Sometimes there will be no max price. Let&#x2019;s see. That is probably covered by a logic.&#xA;When you have a rule that changed the evaluation context for the rules, you re&#x2011;execute on the rules.&#xA;&#xA;Okay. I&#x2019;m going to get smart about which ones are...&#xA;No. You actually don&#x2019;t really need to get smart in most cases because usually performance wouldn&#x2019;t be an issue, but usually what I&#x2019;m doing is &#x2013; okay. Let&#x2019;s execute all the rules and a rule don&#x2019;t actually change the state of the system. Rule produce output that I can now &#x2013; okay. Let&#x2019;s say that the rule like if you&#x2019;re under this clause, then you get everything for free. So now the rule needs to be rewritten. And now the rule output is, &#x201C;Everything is possible; go ahead.&#x201D;&#xA;Now at that point of time, we re&#x2011;execute the rules and every rule that actually try to set a maximum amount, is now being invalid, because you have the visibility into what a rule is actually trying to do.&#xA;&#xA;Now what happens if I for some reason have a rule that cannot be expressed from the DSL? Is there a way to like C# and then invoke it?&#xA;Yeah, it&#x2019;s just IL. That&#x2019;s the fun part.&#xA;&#xA;Yes. That&#x2019;s the &#x2013; that&#x2019;s probably what I would consider almost the most power capability because usually you can parametrized between 50 and 99 percent of a system. But you always have that edge case which requires something extra complicated. And supporting that in the DSL might make the DLS that much more complicated. But being able to just inject C# instead it can be very powerful.&#xA;Okay, one note, however, the DSL that I have in mind is based on Boo, and Boo is a fully functional programming language. So your DSL is actually turing complete.&#xA0; I would say that if you have to make it look ugly with a bit of code, you probably are missing an abstraction in your DSL that you can facilitate. Like when we move from when patient arrive and patient left, to had an operation of.&#xA;&#xA;Yeah. This has a lot of promise.Yeah, I think so. It&#x2019;s certainly a very cool way of handling complex systems.&#xA;&#xA;I&#x2019;m telling you, if we can pull this off and if we could get that distributed processing of rules down, as the user is typing in contract rules he gets useful information back, that could turn part of our sector upside down. That&#x2019;s very powerful ability that I don&#x2019;t think anyone has at this point in time.&#xA;Okay, cool. Very cool. So just going back to the original topic, this is what I&#x2019;m talking about when I&#x2019;m talking about a write&#x2011;only architecture, open/close architecture. The idea here is that you&#x2019;re literally able to take the system and say, &#x201C;Okay, this is the core part of the system. This is how I evaluate what is the &#x2013; if a patient should get paid and how much he should get paid.&#x201D; &#xA;And at this point in time, we have very limited set of operations that we can execute. Set maximum amount, set exceptions, set unlimited amounts, stuff like that. This is very limited. This is very small, and this highly testable in isolation.&#xA;the part that usually isn&#x2019;t testable or hard to test is all the crazy business rule that they keep making up. I refuse to call this business logic because there isn&#x2019;t any logic in it.&#xA;&#xA;My head hurt when I was trying to understand. I actually went to our client and they were just &#x2013; it&#x2019;s just they kept adding onto different ways the contract could be calculated. It&#x2019;s just absolutely ridiculous. I mean I honestly do not envy my coworker for having to figure this stuff out. &#xA;But now that he&#x2019;s figured out all the different all the different possibilities of what could happen, now the fun part &#x2019;cause you can actually start building the DSL like this and &#x2013; so what you&#x2019;re saying is that once you have a good core that can support something like this, you don&#x2019;t often get disruptive feature requests that require major rearchitecting?&#xA;No, you don&#x2019;t. You generally have to go with the same path over and over and over again. Just&#xA0; &#x201C;Okay, now I have this one. Now I have this one.&#x201D; Sometimes you will get something like, &#x201C;I want to check if &#x2013; I need to make a check to see if his wife is also in the danger group,&#x201D; or something like that. Okay, new feature in the core. This is something that we need to add.&#xA;But generally stabilize on a feature set that satisfy all the parameterization that your customer have. And now you&#x2019;re just churning out very similar Lego bricks that all look the same. And now you&#x2019;re evaluated is in the type of additional services that you can provide on top of this, like on&#x2011;the&#x2011;fly calculation, like let me tell you how I can do speculative analysis on top of historical data in your current root set and try to do on&#x2011;the&#x2011;fly optimization.&#xA;Like imagine that you&#x2019;re trying to do something like what you just said about, &#x201C;Let&#x2019;s change a rule and see what&#x2019;s happened.&#x201D; What happen if I could just, &#x201C;Okay, let&#x2019;s look at all the rules and let&#x2019;s try some optimization strategies to see what&#x2019;s going on.&#x201D; And now I&#x2019;m going to tell you that, &#x201C;You know what? If we can reduce this and up this, then we have a much better success chance about making 60 percent more profit this year.&#x201D;&#xA;&#xA;Well, and you &#x2013; you almost get enough power that you have to be careful about changing things around too much or they suspicious.&#xA;Yeah. Yes, and no, because this depend on how you market that. This is, by the way, why you don&#x2019;t want to make the decision automatically because it always will end up being optimizing toward a place that you generally don&#x2019;t want to go.&#xA;&#xA;Well, I you wanna be really evil, you sell the tool to the insurance company and the hospital.&#xA;And then they just optimize the client away. Yeah, and so at that point, no one use them, so you basically optimize away the client. So yeah, that&#x2019;s why I&#x2019;m saying that you need to be careful not to make this automated because at some point, you really want to make sure that the customer actually gets what they want. Yeah.&#xA;&#xA;So jumping out a little bit, it seems like this is pursuing the kinds of ideas that we&#x2019;ve known we should design for ages. But you only have parts of the system coupled that need to be coupled. It&#x2019;s basically the same things you learn in Software Design 101. But for some reason, when it comes to the real world, people just can&#x2019;t seem to follow those idea. Have any idea why that is?&#xA;A lot of focus on infrastructure. A couple of hours ago, actually, I got a feature request for Rhino Security. It was, &#x201C;I need to do a &#x2013; type information for the operation that they have. Can you please add an int field to the operation and call it AppSpecific so I can add my own stuff there and anyone else can add their own stuff there?&#x201D; And I look at that and I said, &#x201C;You know what? I think this makes me look like Win32. And I don&#x2019;t really like that. I have another option. You can derive your class from my operation and add your own constant behavior and that&#x2019;s it.&quot;&#xA;&#xA;Oh, do you mean inheritance like it was supposed to be?&#xA;Yes, like add your own specific stuff. The software will pick up that you use this new operation, this new derived operation and will use your own stuff. So you have extended my software. My software has allowed you to extend itself and now you&#x2019;re done. Create your class, register this new class in the mapping. And now you have this new class everywhere.&#xA;&#xA;You&#x2019;re effectively saying you do the minimum amount of work that could possibly be required, just information&#x2011;wise to accomplish what you need accomplished, and you&#x2019;re providing a system where that&#x2019;s actually built in.&#xA;Yes, so the system is literally having an IoC in place, having something like NHibernate place which actually understand the concept of OO and can apply them. In most typical system, let&#x2019;s take a typical system of &#x2013; you know what? Even something like Aminal, Dog and Ecat. The problem is that yeah, you can apply a typical old design and have everything that isn&#x2019;t specific to a dog or cat take an animal as a parameter.&#xA;The problem is that you have no way of introducing a lion into the system because the system is static is into the time in which it was compiled. We no longer live in a world where this is true because we can introduce new types into this system on the fly. So if we have a tool that support that, we can literally apply a classic old design solution into our approach without having to do anything complex. The problem is that people have been so ingrained on the notion that this is so hard; this is not possible to do it on the fly and dynamically, this is such an ingrained concept that people just don&#x2019;t think about that.&#xA;It&#x2019;s historical baggage. And this is historical baggage mostly in the minds of the people who are working on that. This is no longer a technical problem.&#xA;&#xA;So why doesn&#x2019;t anyone else do this? They don&#x2019;t know?&#xA;People are doing that. If you look at all the advance stuff. I did an advance talk &#x2013; advance NHibernte and advance IOC talk. Frankly, I was slightly ashamed of doing these talks because, &#x201C;Look, inheritance. Look, polymorphism.&#x201D;&#xA;And this was my advance talks, like, &#x201C;Look, I can add a new property to a derived class.&#x201D; Wow. And, &#x201C;Oh, look how I can override behavior using the override keyword,&#x201D; stuff like that.&#xA;And that was in the advanced IOC and advanced in hibernate. And I&#x2019;m slightly queasy about calling them advanced because they&#x2019;re literally, OO 101. But the application of this 101 principle in reward scenarios are what make them advanced. And then you move to the really advance stuff like, &#x201C;Okay, let&#x2019;s select the appropriate behavior or the appropriate class that we want to load at runtime, based on business logic. Let&#x2019;s say that you&#x2019;re working for... Prudential is a good example of an insurance company, and AIG is another one, just random stuff that pops into my head.&#xA;&#xA;Well, AIG isn&#x2019;t a good example of an insurance company right now &#xA;Yeah. Okay, those are just two insurances companies that just popped into mind. So let&#x2019;s say that both them run on your software. They have different rules, different requirements, different behaviors, different data they are gathering. But if you want them to run on the same system &#x2013; now when a request come in, calculating whatever this is a valid insurance for a AIG customer, they go through a different process then for Prudential customer.&#xA;So for that reason, your system is set up to handle, Okay, when I&#x2019;m loading a Prudential customer, it&#x2019;s different than an AIG customer, both in the fields and the behavior of the system.&#xA;&#xA;It&#x2019;s interesting that you say that because we actually have our hospital, and there are probably about 40 different hospitals in the systems.&#xA;And all of them have different rules.&#xA;&#xA;I didn&#x27;t mean hospitals, 40 different insurance companies.&#xA;And all of them have slightly different rules on top of the same basic offering, right?&#xA;&#xA;Oh, some have &#x2013; some are very similar. And some have very different ways of evaluating that definitely need to be accounted for.&#xA;And the problem with this type of system, how do you actually manage to do that and keep your velocity over time, especially if you want to release a new version?&#xA;&#xA;I mean, the question is can you use this operating engine for this company and this other engine for the other one?&#xA;No, you don&#x2019;t. You use the same engine and specialize the rules. No, yeah, yeah. No. You could actually have something like these guys do something so crazy, I don&#x2019;t want to introduce this to anyone else. So I&#x2019;m going to specialize the engine &#x2013; again, sub&#x2011;class and extend. And when I&#x2019;m processing something of these guys, I&#x2019;m using their engine. And I am using their engine by virtue of registering that in their own child container and now I&#x2019;m done.&#xA;And how each of the customers have their own rule set, basically just scripts that they&#x2019;re running. And they&#x2019;re separated by the directory that they&#x2019;re in, and that&#x2019;s it. You&#x2019;re done.&#xA;&#xA;So there are two major advantages I see. One is overriding all the other functionality you need to override instead of just duplicating. And the other is turning completeness that sometimes you really do need that. And your environment make this trivial. Which is virtually unheard of unless you simply don&#x2019;t have any business rule engine in there at all.&#xA;Yeah. It&#x2019;s sometimes &#x2013; one of the major problem in the industry we try to solve complexity with complexity instead of &#x2013; so you end up with complex solution for complex problems. But if you don&#x2019;t really too much complexity for complexity, you generally starts in a simple solution. Often, that simple solution is wrong. But it usually will point you toward the right direction.&#xA;&#xA;Yeah? Oh, yeah. I knew there was some way to make it simpler. I just got too much else to do and... Well, I think I have a pretty good idea of what you&#x2019;re suggesting here. What I would suggest is you do whatever you want with this recording, but I would like to type it up just because I find it much easier to read than listen to a sort of &#x2013; I don&#x2019;t really like watching the PDC videos because they&#x2019;re linear and I got to pause and rewind if I wanna hear something again. Whereas, if you have written material, you can scan it at your own speed and do all that. &#xA;And there is where the interesting bits are over. Assuming that you got this far, please let me know what you think about this format.</p>
        <a href="https://ayende.com/blog/3780/nh-prof-alerts-excessive-number-of-rows-returned" target="_blank"><h1 class="title mb-6">NH Prof Alerts</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: December 29, 2008
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is a bit from the docs for NH Prof, which I am sharing in order to get some peer review. The excessive number of rows returned is a warning that is being generated from the profiler when... a query is returning a large number of rows. The simplest scenario is that we simply loaded all the rows in a large table, using something like this code: session.CreateCriteria(typeof(Order))&#xA;&#x9;.List&lt;User&gt;();&#xA;This is a common mistake when you are binding to a UI component (such as a grid) that perform its own paging. This is a problem is several levels:&#xA;&#xA;We tend to want to see only part of the data&#xA;We just loaded a whole lot of unnecessary data&#xA;We are sending more data over the network&#xA;We have higher memory footprint than we should have&#xA;In extreme cases, we may crash as a result of out of memory exception&#xA;None of those are good things, and like the discussion on unbounded result sets, this can be easily prevented by applying a limit at the database level to the number of rows that we will load.&#xA;But it is not just simple queries without limit that can cause issue, another common source of this error is Cartesian product when using joins. Let us take a look at this query:&#xA;session.CreateCriteria(typeof(Order))&#xA;&#x9;.SetFetchMode(&quot;OrderLines&quot;, FetchMode.Join)&#xA;&#x9;.SetFetchMode(&quot;Snapshots&quot;, FetchMode.Join)&#xA;&#x9;.List&lt;Order&gt;();&#xA;Assuming that we have ten orders, with ten order lines each and five snapshots each, we are going to load 500 rows from the database. Mostly, they will contain duplicate data that we already have, and NHibernate will reduce the duplication to the appropriate object graph.&#xA;The problem is that we still loaded too much data, with the same issues as before. Now we also have the problem that Cartesian product doesn&#x27;t tend to stop at 500, but escalate very quickly to ridiculous number of rows returned for trivial amount of data that we actually want.&#xA;The solution for this issue is to change the way we query the data. Instead of issuing a single query with several joins, we can split this to several queries, and send them all to the database in a single batch using Multi Queries.</p>
        <a href="https://ayende.com/blog/3779/architecture-advice-scale-the-architecture-to-fit-the-application" target="_blank"><h1 class="title mb-6">Architecture Advice: Scale the architecture to fit the application</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: December 29, 2008
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I was just reviewing an application that was obviously built upon a lot of the best practices advice for using an NHibernate application. I am currently in the process of ripping apart much of that application and then putting it back together again. This involve things like collapsing projects, removing abstractions and deleting tests.&#xA0; The main reason for that is quite simple, the architecture is too big for the application. We can create a much more stream lined application is we don&#x27;t burden it with an architecture that is suitable for bigger and more complex applications. Selecting an inappropriate architecture is a big burden on an application, and it is one where you should be very careful. Chose an overly simplistic architecture, and you can only scale the application complexity with great difficulty. Chose an overly complex architecture, and you can&#x27;t even get the baseline working easily, because of the complexity involved. Don&#x27;t try to make an application fit the architecture, and don&#x27;t try to apply architecture blindly. Think and always start from the simplest thing that can possibly work.</p>
        <a href="https://ayende.com/blog/3778/my-baseline-asp-net-mvc-modifications" target="_blank"><h1 class="title mb-6">My baseline ASP.Net MVC modifications</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: December 29, 2008
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We start by killing ViewData. I don&#x27;t want it, and I want to fail hard if someone is trying to use it:   Likewise in the views, I hate ViewData.Model, so I remove it from there as well:   For Javascript, I don&#x27;t want to use &lt;script/&gt; tags, they are prone to path problems, and I might need to go back and change them (using compression, combining scripts, etc). I use this approach:   The page title is set by the view, the way it should:   Or, I just set it up in the master page, if I don&#x27;t care that much about changing it.</p>
        <a href="https://ayende.com/blog/3777/do-not-put-presentation-concerns-in-the-controllers" target="_blank"><h1 class="title mb-6">Do not put presentation concerns in the controllers!</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: December 29, 2008
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I thought it would be obvious, but I am currently cleaning up an application that has mixed them in a very annoying way. I decided to track the reason for this coupling and I found this on the sample controller in ASP.Net MVC:   I am pretty sure that setting the page title is a presentation concern, as such, I don&#x27;t want to see this in the controller, and I certainly don&#x27;t want to see it in the base sample from which everyone is going to start.</p>
        <a href="https://ayende.com/blog/3776/nh-prof-alerts-unbounded-result-set" target="_blank"><h1 class="title mb-6">NH Prof Alerts</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: December 29, 2008
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is a bit from the docs for NH Prof, which I am sharing in order to get some peer review. Unbounded result set is perform a query without explicitly limiting the number of returned result (using SetMaxResults() with NHibernate, or using TOP or LIMIT clauses in the SQL). Usually, this means that the application is assuming that a query will only return a few records. That works well in development and testing, but it is a time bomb in production.  The query suddenly starts returning thousands upon thousands of rows and in some cases, it is returning millions of rows. This leads to more load on the database server, the application server and the network. In many cases, it can grind the entire system to a halt, usually ending with the application servers crashing with out of memory errors.  Here is one example of a query that will trigger unbounded result set warning:  session.CreateQuery(&quot;from OrderLines lines where lines.Order.Id = :id&quot;)&#xA;       .SetParameter(&quot;id&quot;, orderId)&#xA;       .List();&#xA;&#xA;If the order have many line items, we are going to load all of them, which is probably not what we intended. A very easy fix for this issue is to add pagination: &#xA;session.CreateQuery(&quot;from OrderLines lines where lines.Order.Id = :id&quot;)&#xA;&#x9;.SetParameter(&quot;id&quot;, orderId)&#xA;&#x9;.SetFirstResult(0)&#xA;&#x9;.SetMaxResult(25)&#xA;&#x9;.List();&#xA;&#xA;Now we are assured that we need to only handle a predictable number, and if we need to work with all of them, we can page through the records as needed. But there is another common occurrence of unbounded result set, directly traversing the object graph, as in this example: &#xA;var order = session.Get&lt;Order&gt;(orderId);&#xA;DoSomethingWithOrderLines(order.OrderLines); &#xA;Here, again, we are loading the entire set (in fact, it is identical to the query we issued before) without regard to how big it is. NHibernate does provide robust handling of this scenario, using filters. &#xA;var order = session.Get&lt;Order&gt;(orderId);&#xA;var orderLines = session.CreateFilter(order.OrderLines, &quot;&quot;)&#xA;&#x9;.SetFirstResult(0)&#xA;&#x9;.SetMaxResults(25)&#xA;&#x9;.List();&#xA;DoSomethingWithOrderLines(orderLines);&#xA;This allow us to page through a collection very easily, and save us from having to deal with unbounded result sets and their consequences.</p>
        <a href="https://ayende.com/blog/3775/nh-prof-alerts-use-of-implicit-transactions-is-discouraged" target="_blank"><h1 class="title mb-6">NH Prof Alerts</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: December 28, 2008
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is a bit from the docs for NH Prof, which I am sharing in order to get some peer review. A common mistake when using a database is that we should use only transactions to orchestrate several write statements. Every operation that the database is doing is done inside a transaction. This include both queries and writes ( update, insert, delete ). When we don&#x27;t define our own transactions, we fall back into implicit transaction mode, in which every statement to the database run in its own transaction, resulting in a higher performance cost (database time to build and tear down transactions) and reduced consistency. Even if we are only reading data, we want to use a transaction, because using a transaction ensure that we get a consistent result from the database. NHibernate assume that all access to the database is done under a transaction, and strongly discourage any use of the session without a transaction. Example of valid code: using(var session = sessionFactory.OpenSession()) &#xA;using(var tx = session.BeginTransaction()) &#xA;{ &#xA;&#x9;// execute code that uses the session &#xA;&#x9;tx.Commit(); &#xA;} &#xA;Leaving aside the safety issue of working with transactions, the assumption that transactions are costly and we need to optimize them is a false one. As already mentioned, databases are always running in transaction. And databases have been heavily optimized to work with transactions. The question is whatever this is per statement or per batch. There is some amount of work that need to be done to create and dispose a transaction, and having to do it per statement is actually more costly than doing it per batch.&#xA;It is possible to control the number and type of locks that a transaction takes by changing the transaction isolation level (and indeed, a common optimization is to reduce the isolation level).&#xA;NHibernate treat the call to Commit() as the time to flush all changed items from the unit of work to the database, without an explicit Commit(), it has no way of knowing when it should do that. A call to Flush() is possible, but it is generally strongly discouraged, because this is usually a sign that you are not using transactions properly.&#xA;I strongly suggest that you would use code similar to the one shown above (or use another approach to transactions, such as TransactionScope, or Castle&#x27;s Automatic Transaction Management) in order to handle transactions correctly.</p>
        <div class="button flex justify-between">
            <a href="499.html"><span class="back arrow"></span></a>

            <a href="501.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
</body>
</html>