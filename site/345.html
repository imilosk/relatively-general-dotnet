
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Home â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<script>
    const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

    function getUserPref() {
        const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
        return storedTheme || (lightModePref.matches ? "light" : "dark");
    }

    function setTheme(newTheme) {
        if (newTheme !== "light" && newTheme !== "dark") {
            return console.warn(
                `Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
            );
        }

        const root = document.documentElement;

        // root already set to newTheme, exit early
        if (newTheme === root.getAttribute("data-theme")) {
            return;
        }

        root.setAttribute("data-theme", newTheme);

        const colorThemeMetaTag = document.querySelector("meta[name='theme-color']");
        const bgColour = getComputedStyle(document.body).getPropertyValue("--theme-bg");
        colorThemeMetaTag.setAttribute("content", `hsl(${bgColour})`);
        if (typeof localStorage !== "undefined") {
            localStorage.setItem("theme", newTheme);
        }
    }

    // initial setup
    setTheme(getUserPref());

    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("theme-toggle").addEventListener("click", () => {
            const theme = localStorage.getItem("theme");

            if (theme === "dark") {
                setTheme("light");
            } else {
                setTheme("dark");
            }
        });

        document.getElementById("toggle-navigation-menu").addEventListener("click", (e) => {
            const button = e.target;
            const ariaExpanded = button.getAttribute("aria-expanded");
            const header = document.getElementById("main-header");

            if (ariaExpanded === "true") {
                button.setAttribute("aria-expanded", "false");
                header.classList.remove("menu-open");
            } else {
                button.setAttribute("aria-expanded", "true");
                header.classList.add("menu-open");
            }
        });
    });
</script>

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <theme-toggle class="ms-auto">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main">
    <section aria-label="Blog post list">
        <a href="https://ayende.com/blog/154945/ravendb-it-was-the-weekend-before-the-wedding" target="_blank"><h1 class="title mb-6">RavenDB</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 27, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">&#x2026;when all through the house. Not a creature was stirring, not even a mouse. Because everyone was away on a Stag/Hen weekend.  Phil Jones has just notified me that a site he has been working on for a while went live.&#xA0; Escape Trips is a site that provides Stag and Hen trips in the UK. A Stag/Hen weekend is apparently a bigger version of a stag party, I assume that this is the origin for movies like this (well, not really).  At any rate, this site is actually powered by RavenDB throughout. We actually have several videos in the pipeline of me and Phil hashing out some details about the site when it was built.  The site is fast, and Phil was kind enough to give me some interesting stats.   Some interesting performance stats compared to SQL Express which was running on the VPS. SQL Express was eating ~500MB of RAM (limited), RavenDB has been sat at ~80MB since launch last night! I think EF was eating CPU as well, CPU usage is way down as well. Performance comment wise, I don&#x2019;t know if EF was to blame but IIS process CPU usage is down even though traffic has doubled since the launch (mainly crawlers and a new adwords campaign). After running since the launch on Thursday night, the RAM usage has increased to 100MB, still a really great number though as I plan to scale down the VPS&#x2019;s RAM saving money, RavenDB will actually be paying for itself!  The website looks quite simple from the public side but most of the development has gone into the private administrative website for dealing with sales, customer support and content editing. Performance wise, the system is more responsive and users are very pleased! Pretty cool!</p>
        <a href="https://ayende.com/blog/153313/what-is-wrong-here-solution" target="_blank"><h1 class="title mb-6">What is wrong here? Solution</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 26, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In my previous post, I showed the database schema and the UI and asked what was wrong with that. Before we move on, here is what I showed.    If you looked carefully, you might have noticed that there are duplicate PO# and Tracking# in the UI. More than that, we somehow double charged the customer for shipping. What is going on? It is actually fairly obvious, when you think about it. Look at the schema, there isn&#x2019;t actually any association between the Tracking # and the PO #. In most orders, we have only 1 PO #, so it was easy to just add this information by just pulling it from the DB and adding a few columns. But when we got an order that has multiple POs&#x2026; that is when all hell breaks lose. This is a classic Cartesian Product problem. The solution?&#xA0; Actually model the UI to avoid suggesting that there is a relationship between the tracking and purchase orders, like this:</p>
        <a href="https://ardalis.com/sending-email-from-a-sitefinity-module-with-attachments/" target="_blank"><h1 class="title mb-6">Sending Email from a Sitefinity Module with Attachments</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 24, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A fairly common use case in web applications is the need to send an email, and applications built on top of Telerik Sitefinity are no&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ardalis.com/reviewing-scrumban-the-book/" target="_blank"><h1 class="title mb-6">Reviewing Scrumban the Book</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 24, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">imageI&#x2019;ve been reading a bunch of kanban and lean books recently as I work on my Pluralsight course on Introducing Kanban. The most recent&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ayende.com/blog/153281/what-is-wrong-here" target="_blank"><h1 class="title mb-6">What is wrong here?</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 24, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This case, it isn&#x2019;t code that I am going to show, rather, I am going to show the final UI and the database structure, and let you figure:  What is wrong. How to fix this. Here is the database schema:  And here is the problem:  Hints, this used to work for a long time, and suddenly it doesn&#x2019;t, and the customer is pissed, annoyed and threatening to sue.</p>
        <a href="https://ardalis.com/asus-zen-ultrabook-one-month-later/" target="_blank"><h1 class="title mb-6">Asus Zen Ultrabook One Month Later</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 23, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I wrote a few weeks ago about my new Asus Zen Ultrabook computer. I&#x2019;ve been using it as my primary laptop computer since then, and thought I&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ayende.com/blog/153409/do-you-monitor-negative-events" target="_blank"><h1 class="title mb-6">Do you monitor negative events?</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 23, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">You are probably aware that you need to monitor your production systems for errors, and to add health monitoring for your servers. But are you monitoring negative events? What is a negative event, stuff that should have happened and didn&#x2019;t. For example, every week you have a process that runs to update the tax rates that applies to your customers. This is implemented as a scheduled process, but for some reason (computer was just being rebooted, the user&#x2019;s password expire, etc) that process didn&#x2019;t run. There isn&#x2019;t an error, pre se. You won&#x2019;t get an error because nothing actually had a chance to actually happen. Another example would be getting a callback confirmation that an order payment has been correctly processed. That usually happen within 1 &#x2013; 5 minutes, and you get an OK/Fail notification. But what happens if that notification just never came? This is a much more dangerous scenario, because you have to not only be prepared for handling errors, you have to be prepared for&#x2026; nothing to happen. What it means is that you have to have some way to setup expectations in the system, and act on them when you don&#x2019;t get a confirmation (negative or positive) within a given time frame.</p>
        <a href="https://ayende.com/blog/154849/ravendb-training-the-euro-tour" target="_blank"><h1 class="title mb-6">RavenDB training: The euro tour</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 22, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We are planning of doing a lot of training on RavenDB, and I wanted to make sure that everyone is aware of it. Next week , we have a public event in London. Where Itamar will explain all about indexing:  RavenDB Indexes explained (public event) - Feb 28, London, UK Then there is the full 2 days workshop about RavenDB, here is the current schedule for the next few months.  RavenDB Training with Itamar Syn-Hershko - Feb 28 - 29, London, UK RavenDB Workshop - Ayende Rahien - 21 - 23 May, Stockholm, Sweden The RavenDB Workshop Part I &amp; II - Itamar Syn-Hershko - June 4th &amp; 5th, Oslo, Norway There is also going to be a course in the states around August, probably New York again and maybe around July in Berlin.</p>
        <a href="https://ayende.com/blog/154273/limit-your-abstractions-and-how-do-you-handle-testing" target="_blank"><h1 class="title mb-6">Limit your abstractions</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 22, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">On my previous post, I explained about the value of pushing as much as possible to the infrastructure, and then show some code that showed how to do so. First, let us look at the business level code: [AcceptVerbs(HttpVerbs.Post)]&#xA;public ActionResult Register(string originUnlocode, string destinationUnlocode, DateTime arrivalDeadline)&#xA;{&#xA;    var trackingId = ExecuteCommand(new RegisterCargo&#xA;    {&#xA;        OriginCode = originUnlocode,&#xA;        DestinationCode = destinationUnlocode,&#xA;        ArrivalDeadline = arrivalDeadline&#xA;    });&#xA;&#xA;    return RedirectToAction(ShowActionName, new RouteValueDictionary(new { trackingId }));&#xA;}&#xA;&#xA;public class RegisterCargo : Command&lt;string&gt;&#xA;{&#xA;    public override void Execute()&#xA;    {&#xA;        var origin = Session.Load&lt;Location&gt;(OriginCode);&#xA;        var destination = Session.Load&lt;Location&gt;(DestinationCode);&#xA;&#xA;        var trackingId = Query(new NextTrackingIdQuery());&#xA;&#xA;        var routeSpecification = new RouteSpecification(origin, destination, ArrivalDeadline);&#xA;        var cargo = new Cargo(trackingId, routeSpecification);&#xA;        Session.Save(cargo);&#xA;&#xA;        Result = trackingId;&#xA;    }&#xA;&#xA;    public string OriginCode { get; set; }&#xA;&#xA;    public string DestinationCode { get; set; }&#xA;&#xA;    public DateTime ArrivalDeadline { get; set; }&#xA;}&#xA;&#xA;&#xA;And the infrastructure code, now:&#xA;protected void Default_ExecuteCommand(Command cmd)&#xA;{&#xA;    cmd.Session = Session;&#xA;    cmd.Execute();&#xA;}&#xA;&#xA;protected TResult Default_ExecuteCommand&lt;TResult&gt;(Command&lt;TResult&gt; cmd)&#xA;{&#xA;    ExecuteCommand((Command) cmd);&#xA;    return cmd.Result;&#xA;}&#xA;&#xA;&#xA;You might have noticed a problem in the way we are named things, the names on the action and the infrastructure code do not match. What is going on?&#xA;Well, the answer is quite simple. Let us look at how our controller looks like ( at least, the important parts ):&#xA;public class AbstractController : Controller&#xA;{&#xA;    public ISession Session;&#xA;&#xA;    public Action&lt;Command&gt; AlternativeExecuteCommand { get; set; }&#xA;    public Func&lt;Command, object&gt; AlternativeExecuteCommandWithResult { get; set; }&#xA;&#xA;    public void ExecuteCommand(Command cmd)&#xA;    {&#xA;        if (AlternativeExecuteCommand!= null)&#xA;            AlternativeExecuteCommand(cmd);&#xA;        else&#xA;            Default_ExecuteCommand(cmd);&#xA;    }&#xA;&#xA;    public TResult ExecuteCommand&lt;TResult&gt;(Command&lt;TResult&gt; cmd)&#xA;    {&#xA;        if (AlternativeExecuteCommandWithResult != null)&#xA;            return (TResult)AlternativeExecuteCommandWithResult(cmd);&#xA;        return Default_ExecuteCommand(cmd);&#xA;    }&#xA;&#xA;    protected void Default_ExecuteCommand(Command cmd)&#xA;    {&#xA;        cmd.Session = Session;&#xA;        cmd.Execute();&#xA;    }&#xA;&#xA;    protected TResult Default_ExecuteCommand&lt;TResult&gt;(Command&lt;TResult&gt; cmd)&#xA;    {&#xA;        ExecuteCommand((Command)cmd);&#xA;        return cmd.Result;&#xA;    }&#xA;}&#xA;&#xA;&#xA;What?! You do mocking by hand and inject them like that? That is horrible! It is much easier to use a mocking framework and &#x2026;.&#xA;Yes, it would be, if I was trying to mocking different things all the time. But given that I have very few abstractions, it make sense to not only build this sort of infrastructure, but to also build infrastructure for those things _in the tests_.&#xA;For example, let us write the test for the action:&#xA;[Fact]&#xA;public void WillRegisterCargo()&#xA;{&#xA;  ExecuteAction&lt;CargoAdminController&gt;( c=&gt; c.Register(&quot;US&quot;, &quot;UK&quot;, DateTime.Today) );&#xA;  &#xA;  Assert.IsType&lt;RegisterCargo&gt;( this.ExecutedCommands[0] );&#xA;}&#xA;&#xA;&#xA;The ExecuteAction method belongs to the test infrastructure, and it setups the controller to be run under the test scenario. Which allows me to not execute the command, but to actually get it.&#xA;From there, it is very easy to get to things like:&#xA;[Fact]&#xA;public void WillCreateNewCargoWithNewTrackingId()&#xA;{&#xA;  SetupQueryResponse&lt;NextTrackingIdQuery&gt;(&quot;abc&quot;);&#xA;  ExecuteCommand&lt;RegisterCargo&gt;( new RegisterCargo&#xA;  {&#xA;    OriginCode = &quot;US&quot;,&#xA;    DestinationCode= &quot;UK&quot;,&#xA;    ArrivalDeadline = DateTime.Today&#xA;  });&#xA;  &#xA;  var cargo = Session.Load&lt;Cargo&gt;(&quot;cargos/1&quot;);&#xA;  Assert.Equal(&quot;abc&quot;, cargo.TrackingId);&#xA;}&#xA;&#xA;&#xA;This is important, because now what you are testing is the actual interaction. You don&#x2019;t care about any of the actual dependencies, we just abstracted them out, but without creating ton of interfaces, abstractions on top of abstractions or any of that.&#xA;In fact, we kept the number of abstractions to a minimum, and we can change pretty much every part of the system with very little fear of cascading change.&#xA;We have similar lego pieces, all of them move together and interact with one another with complete freedom, and we don&#x2019;t have to have a Abstract Factory Factory Fa&#xE7;ade Factory.</p>
        <a href="https://ayende.com/blog/154241/limit-your-abstractions-the-key-is-in-the-infrastructure" target="_blank"><h1 class="title mb-6">Limit your abstractions</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 21, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In my previous post, I discussed actual refactoring to reduce abstraction, and I showed two very interesting methods, Query() and ExecuteCommand(). Here is the code in question: [AcceptVerbs(HttpVerbs.Post)]&#xA;public ActionResult Register(string originUnlocode, string destinationUnlocode, DateTime arrivalDeadline)&#xA;{&#xA;    var trackingId = ExecuteCommand(new RegisterCargo&#xA;    {&#xA;        OriginCode = originUnlocode,&#xA;        DestinationCode = destinationUnlocode,&#xA;        ArrivalDeadline = arrivalDeadline&#xA;    });&#xA;&#xA;    return RedirectToAction(ShowActionName, new RouteValueDictionary(new { trackingId }));&#xA;}&#xA;&#xA;public class RegisterCargo : Command&lt;string&gt;&#xA;{&#xA;    public override void Execute()&#xA;    {&#xA;        var origin = Session.Load&lt;Location&gt;(OriginCode);&#xA;        var destination = Session.Load&lt;Location&gt;(DestinationCode);&#xA;&#xA;        var trackingId = Query(new NextTrackingIdQuery());&#xA;&#xA;        var routeSpecification = new RouteSpecification(origin, destination, ArrivalDeadline);&#xA;        var cargo = new Cargo(trackingId, routeSpecification);&#xA;        Session.Save(cargo);&#xA;&#xA;        Result = trackingId;&#xA;    }&#xA;&#xA;    public string OriginCode { get; set; }&#xA;&#xA;    public string DestinationCode { get; set; }&#xA;&#xA;    public DateTime ArrivalDeadline { get; set; }&#xA;}&#xA;&#xA;What are they so important? Mostly because those methods [and similar, like Raise(event) and ExecuteLater(task)] are actually the back bone of the application. They are the infrastructure on top of which everything rests.&#xA;Those methods basically accept an argument (and optionally return a value). Their responsibility are:&#xA;&#xA;Setup the given argument so it can run.&#xA;Execute it.&#xA;Return the result (if there is one).&#xA;Here is an example showing how to implement ExecuteCommand:&#xA;protected void Default_ExecuteCommand(Command cmd)&#xA;{&#xA;    cmd.Session = Session;&#xA;    cmd.Execute();&#xA;}&#xA;&#xA;protected TResult Default_ExecuteCommand&lt;TResult&gt;(Command&lt;TResult&gt; cmd)&#xA;{&#xA;    ExecuteCommand((Command) cmd);&#xA;    return cmd.Result;&#xA;}&#xA;&#xA;&#xA;&#xA;I have code very much like that in production, because I know that in this system, there are actually only one or two dependencies that a command may want.&#xA;There are very few other dependencies, because of the limited number of abstractions that we have. This makes things very simple to write and work with.&#xA;Because we abstract away any dependency management, and because we allow only very small number of abstractions, this works very well. The amount of complexity that you have is way down, code reviewing this is very easy, because there isn&#x2019;t much to review, and it all follows the same structure. The implementation of the rest are pretty much the same thing.&#xA;There is just one thing left to discuss, because it kept showing up on the comments for the other posts. How do you handle testing?</p>
        <div class="button flex justify-between">
            <a href="344.html"><span class="back arrow"></span></a>

            <a href="346.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
</body>
</html>