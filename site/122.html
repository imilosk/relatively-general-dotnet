
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 122 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-1211">
            <a href="https://ayende.com/blog/193029-C/building-a-social-media-platform-without-going-bankrupt-part-iv-caching-and-distribution" target="_blank">
                <h2 class="title mb-6" id="article-1211">Building a social media platform without going bankrupt</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 28, 2021
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In my previous post we looked at the process in which we process a request for a batch of posts and get their results. The code made no assumptions about where it is running and aside from specifying whatever it is okay or not to allow caching, did no such work.Caching is important, it matters a lot for performance. To the point where if you aren&#x2019;t using caching, you are past willful neglect and in the territory of intentional malpractice. The difference can be between needing 18,500 cores to serve a website and needing less than 400&#xA0; to serve a much busier website. Except that the difference will likely be more pronounced. Because it is so important, we need to take it into account at the architecture level. Another aspect we have to consider is the data distribution. Assuming we want to build a global social media platform, that means having to access it from multiple locations. Which mean, in turn, that we have to consider the fallacies of distributed computing in our system. Locality of reference is another key factor that you have to take into account. Which means that you have to consider the flow of data in the system.Let&#x2019;s assume that we have the following datacenters around the world:We are using geo routing and the relevant infrastructure to make sure that you&#x2019;ll always hit the nearest data center to you. Let&#x2019;s say that we have a Mr. Beat in our social platform, who is very popular and like to post controversial messages such as the need to abolish peppers from your menus. Mr. Beat is located in Australia, so when he is posting yet another &#x201C;peppers have no place in the kitchen&#x201D; post, the data center in Brisbane is going to be the one to field the request.A system like that would do best if we can avoid any and all required coordination between the different data centers, as such, we are going to be using gossip to share the results among all the data centers. In other words, the post will be written in the Brisbane data center and then replicated to the rest of the data centers. There are several ways that we can implement such a feature.The simplest way to replicate all the data to all the data centers. This way, we can always access it from the local store. However, that present two challenges:First, there is latency involved with replicating information across the glove. We may get a request for a post in the Odessa data center for a post originating in Brisbane. If the network devils decided to have a party, we may not have that particular post yet in Odessa. What do you do then? This is where the format of the post id come into play. If we can&#x2019;t find the post in our local storage, we can figure out who owns that (based on the machine id segment) and go ask the owning data center. The second problem is that in many cases, the data is purely local. For example, consider this Twitter account. For the most part, everyone that is following that is going to be located nearby. I assume you may have a very small minority of followers who left the area who are still interested in following up on what is going on, but for the most part, this is not that common. That means that replicating all the information to all the data centers is likely a waste.Given these two facts together, we are actually better off using a different model for data distribution and caching. The post id is generated using the following mechanism:The machine segment in the post id (10 bits long) gives us a good indication of where that post was created. This is originally used only for the purpose of generating unique ids, but we can make far greater usage of this. We decide that the data center that created the post is also the one that owns it. In other words, Mr. Beat&#x2019;s posts are &#x201C;owned&#x201D; by the Brisbane data center. The actual posts are held in a key/value store, but there is a difference in how we do lookup by id based on the ownership. Here is the relevant code:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          async function get(id: int64){&#xA;        &#xA;        &#xA;          &#xA;              let [exists, value] = await kv.get(id);&#xA;        &#xA;        &#xA;          &#xA;              if(!exists){&#xA;        &#xA;        &#xA;          &#xA;                  let owner = identifier.get_owner(id);&#xA;        &#xA;        &#xA;          &#xA;                  if(owner == data_center.id()) {&#xA;        &#xA;        &#xA;          &#xA;                      return null; // missing and we are the owner, does not exists&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;                  // need to check other data center&#xA;        &#xA;        &#xA;          &#xA;                  let [_, remote_val] = await data_center.get_kv(owner).get(id);&#xA;        &#xA;        &#xA;          &#xA;                  await kv.put(id, remote_val); // always insert, even if we got null&#xA;        &#xA;        &#xA;          &#xA;                  value = remote_val;&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;              return value;&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          get.js&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;The idea is that we first check the key/value in the current data center for the post id. If it isn&#x2019;t found, we check if we are the owner of the post. If so, it doesn&#x2019;t exists or was removed. If it belongs to another data center, we&#x2019;ll go and fetch it from there. Note that we&#x2019;ll record a null if needed, so we&#x2019;ll not need to go and fetch a missing value each time it is requested. In other words, the first time that an item is requested from the owner data center, we&#x2019;ll place it in our own key/value for next time. We do so with an indication to the key/value that this is a remote value. Remote values may be purge early or be put on a least frequently viewed rotation, etc. There are other things that we need to deal with, of course. Concurrency, for example, if we have multiple concurrent requests to the same missing id. We&#x2019;ll have multiple chats between data centers to fetch the same value. I don&#x2019;t think that this is a problem. That is likely to only happen the first time, and then it is cached. We might want to monitor how often remote values are requested and only get them after a certain number of requests, but in all honesty, it probably doesn&#x2019;t matter.The key/value store architecture is already likely to cause us to use both disk and memory. We can take advantage of the fact that the remote key isn&#x2019;t important locally and not persist it to disk right away, or not in a durable format. When we need to remove the value from memory, we can see if it had enough hits to warrant writing locally or not.The most complex issue, however, is related to the cache itself. We have a strong ownership model, in which the data center that created a post is its owner. What happens when we need to update a post?Twitter, for example, doesn&#x2019;t have an Edit feature. That is a great reduction of the complexity we have to deal with, but it isn&#x2019;t all that simple. An update to the post can also be a delete. For example, let&#x2019;s say that Mr. Beat posted: &#x201C;eating steamed Br0ccoli&#x201D;. Such a violation of community standards cannot stand. Even though Mr. Beat cleverly disguised his broccoli tendencies by typo-ing the forbidden term. Mr. Beat is very popular and his posts have likely spread across many data centers. An admin marking the post as deleted also has to deal with the possibility that the post is located on other locations as well.We can try to keep track of this, but to be fair, it is easier to simply queue a delete command on all the data centers except the owner. That will ensure that they will remove the cached version and have to re-read it from the owner data center.Everything that I describe so far was about behavior, but we also ought to talk about policies. As part of the work we do when writing a post, we can apply all sort of interesting policies. For example, we may know that Mr. Beat is popular globally and as part of writing a post from him preemptively send that post to all the other data centers. If we have an update to a post, instead of sending a delete command to the rest of the data centers and let it refresh automatically, we can send the updated post content immediately.I intentionally don&#x2019;t want to dig too deeply into those policies, because they are important, but they aren&#x2019;t on the same level as the infrastructure I describe here is. Those are like the cherry on top, if you like such a thing, it can take something good and make it great. But given that those are policies that can be applied on a per item basis and modified as you go along, there isn&#x2019;t a reason to start going there yet.Finally, there is a last aspect to discuss: Expiry.&#xA0; In most social media, the now is important beyond all else. In other words, you are very unlikely to be seeing posts from two years ago and if you are, it matters a lot less if you have to deal with slightly higher latency. Expiring remote content that is over 3 months old, for example, and not placing that in our local key/value at all can be a great way to handle long tail issues. For that matter, given that old content is rarely accessed, we can also optimize our storage by compressing old posts instead of holding on to them directly. And after all of this discussion, I wanted to point out that you are also likely to want to have another layer of caching in place. The API calls you make in many cases may be good candidate for at least short term caching. In other words, if you put them behind something like Cloudflare, given that we explicitly state what post ids we want, we can set a cache duration of 1 &#x2013; 3 minutes without needing to worry too much about updates. That can massively reduce the number of requests that we actually have to handle, and it costs a lot less. Under what scenarios would that be useful?Consider people going to view a popular user, such as Mr. Beat&#x2019;s page. The list of posts there is going to be the same for anyone, and even a short duration on the cache would massively help our load.As you can see, the design of the system assume caching and actively work to make it possible for you to utilize the cache at multiple levels.</p>
        </article>
        <article id="article-1212">
            <a href="https://ayende.com/blog/193028-C/building-a-social-media-platform-without-going-bankrupt-part-iii-reading-posts" target="_blank">
                <h2 class="title mb-6" id="article-1212">Building a social media platform without going bankrupt</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 27, 2021
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">So far in this series of posts I looked into how we write posts. The media goes to S3 compatible API and the posts themselves will go to&#xA0; a key/value store. Reading them back, on the other hand, isn&#x2019;t that simple. For the media, I&#x201D;m going to assume that the S3 is connected to CDN and that is handled, but I want to focus on the manner in which we deal with reading posts. In particular, I&#x2019;m not talking here about how we can display the timeline for a user. That is going to be the subject on another post, right now, I&#x2019;m assuming that this is handled and talking about the next step. We have a list of post ids that we want to get and we need to manage that.&#xA;The endpoint in question would look like this:&#xA;&#xA;GET /api/v1/read?post=1352410889870336005&amp;post=1351081958063951875&#xA;&#xA;The result of this API is a JSON object with the keys as the posts ids and the values as the content of the post.&#xA;This simple API is about as simple as you can imagine, but even from this simple scenario you can see a few interesting details:&#xA;&#xA;The API is using GET, which means that there is a natural limit to the size of the URL. This is good and by design. We will likely limit this to a maximum of 128 items as a time anyway.&#xA;The API is inherently about dealing with batches of information.&#xA;The media is handled separately (generated directly from the client) so we can return far less information.&#xA;&#xA;In many cases, this is going to be a unique set of posts, for example, when you view your timeline, it is likely that you&#x2019;ll see a unique set of posts. However, in many other cases, you&#x2019;ll send a request that is similar or identical to what others will use.&#xA;When you are looking at a popular thread, for example, you&#x2019;ll be asking the same posts ids as everyone else, which means that there is a good chance to easily add caching for this via CDN or the like and benefit greatly as a result.&#xA;Internally, the implementation of this API is probably just going to issue direct reads by ids to the key/value store and just return the result. There should be a minimal amount of processing involved, usually, except for one factor, authorization.&#xA;Assuming that the key/value interface has a get(id) method, the backend code for this API critical API should be something like the code below. Note that this is&#xA0;server side code, I&#x27;m not showing any client side code in this series of posts. This is the backend code to handle address the reading of a batch of ids from the client.&#xA;&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          async function handle_async(user_id: string, post_ids: [int64]) {&#xA;        &#xA;        &#xA;          &#xA;              if(post_ids.length &gt; 128) throw &quot;too many post ids&quot;;&#xA;        &#xA;        &#xA;          &#xA;              &#xA;        &#xA;        &#xA;          &#xA;              let results = (await Promise.all(post_ids.map(id =&gt; kv.get(id))));&#xA;        &#xA;        &#xA;          &#xA;              let filter = null;&#xA;        &#xA;        &#xA;          &#xA;              for (let i = 0; i &lt; results.length; i&#x2B;&#x2B;) {&#xA;        &#xA;        &#xA;          &#xA;                  const post = results[i];&#xA;        &#xA;        &#xA;          &#xA;                  if (!post || post.is_public) continue;&#xA;        &#xA;        &#xA;          &#xA;                  if(!filter){&#xA;        &#xA;        &#xA;          &#xA;                      filter = {by_user: {}, promises: []};&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;                  let promise = filter.by_user[user_id] || auth.is_follower_async(post.author, user_id);&#xA;        &#xA;        &#xA;          &#xA;                  filter.by_user[user_id] = promise;&#xA;        &#xA;        &#xA;          &#xA;                  filter.promises.push(promise.then(r =&gt; results[i] = r ? post : null));&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;              if(filter){&#xA;        &#xA;        &#xA;          &#xA;                  await Promise.all(filter.promises);&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;              return { &#xA;        &#xA;        &#xA;          &#xA;                  cache: filter == null,&#xA;        &#xA;        &#xA;          &#xA;                  results: results.filter(x=&gt;x!=null)&#xA;        &#xA;        &#xA;          &#xA;              };&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          fetch_posts.js&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;&#xA;The code itself assumes that there is no meaning to doing batch operation on the key/value itself, mind. That isn&#x2019;t always the case, but I&#x2019;ll assume that. We issue N async promises to the key/value and wait to get them all back. This assumes that the latency from the API node to the key/value servers is minimal and let us batch a lot of remote calls into near calls.&#xA;The vast majority of the function is dedicated to the auth behavior. A post can be marked as public or protected, and if it is the later, we need to ensure that only people that the author of the post follow will be able to see this. You&#x2019;ll note that I&#x2019;m doing a lot of stuff in an async manner here. For example, we&#x2019;ll only issue a single check per post author and we can safely assume that most posts are public anyway. I&#x2019;m including the &#x201C;full&#x201D; code here to give you an indication about the level of complexity that I would expect to see in the API.&#xA;You should also note that we indicate whatever we allow to cache the results or not. In the case of a request that include a protected post, we don&#x2019;t allow it. But for the most part, we can expect to see high percentage of posts that would be only public and can benefit from that.&#xA;Because we are running in a distributed system, we also have to take into account all sort of interesting race conditions. For example, you may be trying to read a post that has been removed. We explicitly clear all such null items from the results. Another way to handle that is to replace the content of the post and set a marker flag, but we&#x2019;ll touch that on another post.&#xA;Finally, the code above doesn&#x2019;t handle caching or distribution. That is going to be handled both above and below this code. I&#x2019;ll have a dedicated post around that tomorrow.</p>
        </article>
        <article id="article-1213">
            <a href="https://ayende.com/blog/193027-C/building-a-social-media-platform-without-going-bankrupt-part-ii-accepting-posts" target="_blank">
                <h2 class="title mb-6" id="article-1213">Building a social media platform without going bankrupt</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 26, 2021
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This design deal with creating what is effectively a Twitter clone, seeing how we can do that efficiently. A really nice feature of Twitter is that it has just one type of interaction a tweet. The actual tweet may be a share, a reply, a mention or any number of other things, but those are properties on the post, not a different model entirely. Contrast that with Facebook, on the other hand, where you have Posts and Replies as very distinct items. As it turns out, that can be utilized quite effectively to build the core foundation of the system with great efficiency. There are two separate sides for a social network, the write and read portions. And the read side is massively bigger than the write side. Twitter currently has about 6,000 tweets a second, for example, but it has 186 million daily users. We are going to base the architecture on a few assumptions:We are going to favor reads over writes.Reads&#x2019; speed should be a priority at all times.It is fine to take some (finite, small) amount of time to show a post to followers.Favor the users&#x2019; experience over actual guarantees. What this means is that when we write a new post, the process is going to be roughly so:Post the new message to a queue and send confirmation to the client.Add the new post to the user&#x2019;s timeline on the client side directly. Done.Really important detail here. The process of placing an item on the queue is simple, trivial to scale on an infinite basis and can easily handle huge spikes in load.On the other hand, the fact that the client&#x2019;s code will show the user that the message in their timeline is usually sufficient for good user experience. There is the need to process that and send it to followers ASAP, but that is as soon as possible in people&#x2019;s terms. In other words, if it takes 30 seconds or two minutes, it isn&#x2019;t a big deal.With just those details, we are pretty much done with the write side. We accepted the post, we pretend to the user that we are done processing it, but that is roughly about it. All the rest of the work that we need to do now is to see how we can most easily generate the read portion of things.There are some other considerations to take into account. We need to deal not just with text but also images and videos. A pretty core part of the infrastructure is going to be an object storage with S3 compatible API. The S3 API has became an industry standard and is pretty widely supported. That help us reduce the dependency issue. If needed, we can MinIO, run on Backblaze, etc.When a user send a new post, any media elements of the post are stored directly in the S3 storage and then the post itself is written to a queue. Workers will fetch items from the queue and process them. Such processing may entail things like:Stripping EXIF data from images.Re-encoding videos.Analyzing content for language / issues. For example, we never want to have posts about Broccoli, so we can remove / reject them at this stage. This is where a lot of the business logic will reside, mind. During the write portion, we have time. This is an asynchronous process that we can afford to take some time. Scaling workers to read from a queue is cheap, simple an easy technique, after all. That means that we can afford to shift most of the work required to this part of the process.For example, maybe a user posted a reply to a message that only allow replies from users mentioned on the post? That sort of thing.Once processed, we end up with the following architecture:The keys for each post are numeric (this will be important later). We can generate them using the Snowflake method:In other words, we use 40 bits with 16 millisecond precision for the time, 10 bits (1,024) as the machine id and 14 bits (16,384) as the sequence number. The 16 ms precision is already the granularity that you can expect from most computer clocks, so we aren&#x2019;t actually losing much by giving it up. It does means that we don&#x2019;t really have to think about it. A single instance can generate 16K ids each 16 ms, or about a million ids per second. More than enough for our needs.The key about those ids is that they are going to be roughly sorted. That will be very nice to use later on.&#xA0; When accepting a post, we&#x2019;ll generate an id for that, and then place that in the key/value store using that id. All other work from that point of is about working with those ids, but we&#x2019;ll discuss that with more details when we talk about timelines.For now, I think that this post gives a good (and intentionally partial) view of how I expect to handle a new write:Upload any media to S3 compatible API.Generate a new ID for the post.Run whatever processing you need for the post and the media.Write the post to the key/value store under the relevant id. This include also the appropriate references for the parent post, any associated media, etc.Publish to the appropriate timelines. (I&#x2019;ll discuss this in a future post)I&#x2019;m using the term key/value store here generically, because we&#x2019;ll do a lookup per id and find the relevant JSON for the post. Such systems can scale pretty much linearly with very little work. Given the fact that we use roughly time based ids and the time base nature of most social interactions, we can usually move most posts to archive mode in a very natural way. But that would be a separate optimization step that I don&#x2019;t think that would actually be relevant at this point. It is good to have such options, though.And that is pretty much it for writes. There are probably pieces here that I&#x2019;m missing, but I expect that they are related to the business processing that you&#x2019;ll want to do on the posts, not the actual infrastructure. On my next post, I&#x2019;ll deal with the other side. How do we actually read a post? Given the difference in scale, I think that this is a much more interesting scenario.</p>
        </article>
        <article id="article-1214">
            <a href="https://ardalis.com/choose-excitement-over-fear/" target="_blank">
                <h2 class="title mb-6" id="article-1214">Choose Excitement over Fear</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 26, 2021
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">There&#x27;s virtually no difference, physiologically, between the sensations and symptoms of fear and excitement. But there is a big difference&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-1215">
            <a href="https://andrewlock.net/prerending-a-blazor-webassembly-app-without-an-asp-net-core-host-app/" target="_blank">
                <h2 class="title mb-6" id="article-1215">Prerendering a Blazor WebAssembly app to static files, without an ASP.NET Core host app</h2>
            </a>
            <p class="mb-2">by Andrew Lock</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 26, 2021
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post I show how to prerender all the pages in a Blazor WebAssembly app ahead of time, so you can host the app as static files, without a host app.&#x2026;</p>
        </article>
        <article id="article-1216">
            <a href="https://ayende.com/blog/193026-C/building-a-social-media-platform-without-going-bankrupt-part-i-laying-the-numbers" target="_blank">
                <h2 class="title mb-6" id="article-1216">Building a social media platform without going bankrupt</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 25, 2021
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Following the discussion a few days ago, I thought that I would share my high level architecture for building a social media platform in a way that would make sense. In other words, building software that is performant, efficient and not waste multiples of your yearly budget on unnecessary hardware.&#xA;It turns out that 12 years ago, I wrote a post that discusses how I would re-architect twitter. At the time, the Fail Whale would make repeated appearances several times a week and Twitter couldn&#x2019;t really handle its load. I think that a lot of the things that I wrote then are still applicable and would probably allow you to scale your system without breaking the bank. That said, I would like to think that I learned a lot since that time, so it is worth re-visiting the topic.&#xA;Let&#x2019;s outline the scenario, in terms of features, we are talking about basically cloning the key parts of Twitter. Core features include:&#xA;&#xA;Tweets&#xA;Replies&#xA;Mentions&#xA;Tags&#xA;&#xA;Such an application does quite a lot a the frontend, which I&#x2019;m not going to touch. I&#x2019;m focusing solely on the backend processing here. There are also a lot of other things that we&#x2019;ll likely need to deal with (metrics, analytics, etc), which are separate and not that interesting. They can be handled via existing analytics platforms and don&#x2019;t require specialized behavior.&#xA;One of the best parts of a social media platform is that by its very nature, it is eventually consistent. It doesn&#x2019;t matter if I post a tweet and you see it now or in 5 seconds. That gives us a huge amount of flexibility in how we can implement this system efficiently.&#xA;Let&#x2019;s talk about numbers I can easily find:&#xA;&#xA;Twitter has 340 million users.&#xA;Twitter has 42% of the population active.&#xA;Twitter has 6,000 / second. &#x2013; 15.7 billion tweets a month.&#xA;80% of the content is generated by 10% of the users.&#xA;In Twitter, out of 1.3 billion accounts, only 550 million ever sent a tweet.&#xA;A very small percentage have large followers counts. The latest numbers I can get are from early the previous decade, then Twitter has 0.06% of accounts with more than 20,000 followers. and 2.12% has more than 1,000 followers.&#xA;Common twitter usage is 2 tweets a month (common) to 138 a month (prolific).&#xA;&#xA;There are problem with those stats, however. A lot of them are old, some of them are very old, nearly a decade!&#xA;Given that I&#x2019;m writing this blog to myself (and you, my dear reader), I&#x2019;m going to make some assumptions so we can move forward:&#xA;&#xA;50 million users, but we&#x2019;ll assume that they are more engaged than the usual group.&#xA;Out of which 50% (25,000,000) would post on a given month.&#xA;80% of the users post &lt; 5 posts a month. That means 20 million users that post very rarely.&#xA;20% of the users 5 million or so, post more frequently, with a maximum of around 300 posts a month.&#xA;1% of the active users 50,000) posts even more frequently, to the tune of a couple of hundred posts a day.&#xA;&#xA;Checking my math, that means that:&#xA;&#xA;50,000 high active users with 150 posts a day for a total of 225 million posts.&#xA;5 million active users with 300 posts a month for another 1.5 billion posts.&#xA;20 million other users with 5 posts a month, given us another 100 million posts.&#xA;&#xA;Total month posts in this case, would be:&#xA;&#xA;1.745 billion posts a month.&#xA;2.4 million posts an hour.&#xA;670 posts a second.&#xA;&#xA;That assume that there is&#xA0; a constant load on the system, which is probably not correct. For example, the 2016 Super Bowl saw a record of 152,000 tweets per minute with close to 17 million tweets posted during the duration of the game.&#xA;What this means is that the load is highly variable.&#xA0; We may have low hundreds of posts per second to thousands. Note that 152,000 posts per minute are &#x201C;just&#x201D; 2,533 posts per second, which is a lot less scary, even if it means the same.&#xA;We&#x2019;ll start by stating that we want to process 2,500 posts per second as the current maximum acceptable target.&#xA;One very important factor that we have to understand is what exactly do we mean by &#x201C;processing&#x201D; a post. That means recording the act of the post and doing that within an acceptable time frame, we&#x2019;ll call that 200 ms latency for the 99.99%.&#xA;I&#x2019;m going to focus on text only mode, because for binaries (pictures and movies) the solution is to throw the data on a CDN and link to it, nothing more really needs to be done. Most CDNs will already handle things like re-encoding, formatting, etc, so that isn&#x2019;t something that you need to worry about to start with.&#xA;Now that I have laid the ground works, we can start thinking about how we can actually process this. That is going to be handled in a few separate pieces. First, how do we accept the post and process it and then how do we distribute it to all the followers. I&#x2019;ll start dissecting those issues in my next post.</p>
        </article>
        <article id="article-1217">
            <a href="https://www.meziantou.net/simplifying-path-manipulations-with-the-fullpath-type.htm" target="_blank">
                <h2 class="title mb-6" id="article-1217">Simplifying paths handling in .NET code with the FullPath type</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 25, 2021
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In my projects, I often deal with paths. However, there are many traps when working with path:A path can be absolute or relative (c:\a\b, .\a\b)A path can contain navigation segments (., ..)A path can end with a directory separator or not (c:\a or c:\a\)A path can contain empty segments (c:\a\\b)A</p>
        </article>
        <article id="article-1218">
            <a href="https://ayende.com/blog/193025-C/hiring-again-poland-php-dev-qa-engineer" target="_blank">
                <h2 class="title mb-6" id="article-1218">Hiring again (Poland): PHP Dev &amp; QA Engineer</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 22, 2021
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We have two positions open in Poland now:Backend PHP DeveloperQA EngineerYou can see the full job details on the provided links.These are both for working with RavenDB, so it is going to be very interesting work.</p>
        </article>
        <article id="article-1219">
            <a href="https://ayende.com/blog/192993-B/looking-at-parler-specs-and-their-architecture" target="_blank">
                <h2 class="title mb-6" id="article-1219">Looking at Parler specs and their architecture</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 21, 2021
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I run into the following twitter, which list some of Parler&#x2019;s requirements (using the upper limits specified):&#xA;&#xA;Scylla cluster &#x2013; 40 nodes with 64 cores, 512GB RAM, 14TB NVME drives for each node. For a total of 2,560 cores and 20TB RAM, 560 TB of disks.&#xA;PostgreSQL cluster &#x2013; 100 nodes with 96 cores, 768 GB RAM and 4 TB NVME. For a total of 9,600 cores, 75 TB RAM and 400 TB of disks.&#xA;400 application instances &#x2013; 16 cores &amp; 64 GB RAM.&#xA;&#xA;Their internal traffic is about 6.6 GB / sec and their external traffic is about 2 GB / sec. There is a lot of interesting discussion on the twitter feed on these numbers, but I thought that it would be interesting to see how much it would cost to build that.&#xA;The 64 Cores &amp; 512 GB RAM can be handled via Gigabyte R282-Z90, the given specs says that a single one would cost 27,000 USD. That means that the Scylla cluster alone would be about a million dollar, but I haven&#x2019;t even touched on the drives. I couldn&#x2019;t find a 14 TB NVMe drive in a cursory search, but a 15.36TB drive (Micron 9300 Pro 15.36TB NVMe) costs 2,500 USD per unit. That makes the cost of the hardware alone for the Scylla cluster at 1.15 million USD.&#xA;I would expect about twice that much for the PostgreSQL cluster, for what it&#x2019;s worth. For the application servers, that is a lot less, with about a 4,000 USD cost per instance. That comes to another 1.6 million USD.&#xA;Total cost is roughly 5 million USD, and we aren&#x2019;t talking about the other stuff (power, network, racks, etc). I&#x2019;m not a hardware guy, mind! I&#x2019;m probably missing a lot of stuff. At that size, you can likely get volume discounts, but I&#x2019;m missing that the stuff that I&#x2019;m missing would cost quite a lot as well. Call it a minimum of 7.5 million USD to setup a data center with those numbers. That does not include labor and licensing costs, I want to add.&#xA;Also, note that that kind of capacity is likely something that you can&#x2019;t just get from anyone but the big cloud providers with a quick turnaround basis. I&#x2019;ll estimate that this is a multiple months just to order the parts, to be honest.&#xA;In other words, they are going to be looking at a major financial commitment and some significant lead time.&#xA;Then again&#x2026; Given their location in Henderson, Nevada, the average developer salary is 77,000 USD per year. That means that the personal cost, which is typically significantly higher than any other expense, is actually not that big. As of Non 2020, they had about 30 people working for Parler, assuming all of them are developers paid 100,000 USD a year (significantly higher than the average salary in their location), the employment costs of the entire company would likely be under half of the cost of the hardware required.&#xA;All of that said&#x2026;. what we can really see here is a display of incompetency. At the time it was closed, Parler has roughly 15 &#x2013; 20 million users. A lot of them were recently registrations, of course, but Parler already experience several cases of high number of user registrations in the past. In June of 2020 it saw 500,000 users registering to its services within 3 days, for example.&#xA;Let&#x2019;s take the 20 million users as the number of users, and assume that all of them are in the states and have the same hours of activity. We&#x2019;ll further assume that we have high participation numbers and all of those users are actively viewing. Remember the 1% rule, only a small minority of users are actually generating content on most platforms. The vast majority are silent observers. That would give us roughly 200,000 users that generate content, but even then, not all content is made equal. We have posts and comments, basically, and treating them differently is a basic part of building efficient system.&#xA;On Twitter, Katy Perry has just under 110 million followers. Let&#x2019;s assume that the Parler ecosystem was highly interconnected and most of the high profile accounts would be followed by the majority of the users. That means that the top 20,000 users will be followed by all the other 20 millions. The rest of the 180,000 users that active post will likely do so in reaction, not independently, and have comparatively smaller audiences.&#xA;Now, we need to estimate how much these people will post. I looked at Dave Weigel&#x2019;s account (591.7K followers), covering politics for Washington Post. I&#x2019;m writing this on Jan 20, so the Biden inauguration takes place. I&#x2019;m assuming that this is a busy time for political correspondents.&#xA0; Looking at his twitter feed, he posted 3,220 tweets this month and Jan 6, which had a lot to report on, had 377 total tweets. Let&#x2019;s take 500 as the reasonable upper bound for the number of interactions of most of the top users in the system, shall we?&#xA;That means that we have:&#xA;&#xA;20,000 high profiler users.&#xA;Each posting to a max of 500 a day.&#xA;Let&#x2019;s assume that this all happens in 8 hours, instead of over the entire day.&#xA;That translates to roughly 1,250,000 posts an hour. If we express this in terms of posts per second, that comes to 348 posts per second.&#xA;&#xA;Go and look at the specs above. Using these metrics, you can dedicate a machine for each one of those posts. Given the number of cores requested for application instances (400 x 16 = 6400 cores), this is beyond ridiculous.&#xA;Just to give you some context, when we run benchmarks of RavenDB, we run it on a Raspberry Pi 3. That is a 25$ machine, with a shady power supply and heating issues. We were able to reach over 1,000 writes / second on a sustained basis. Now, that is for simple writes, sure, but again, that is a Raspberry Pi doing three times as much as we would need to handle Parler&#x2019;s expected load (which I think I was overestimating).&#xA;This post is getting a bit long, but I want to point out another social network Stack Exchange (Stack Overflow), with 1.3 billion page views per month (assuming perfect distribution, roughly 485 page views per second, each generating multiple requests).&#xA;&#xA;Their web servers handle 450 req/sec at peak across 9 web servers (Max of 4,050 req/sec) with peak CPU usage of 12%.&#xA;2 SQL Server clusters with 4 machines in total. Handling an aggregate of 23800 queries / sec with peak CPU usage of 15%.&#xA;Render time across the board of &lt; 20 ms.&#xA;&#xA;The hardware that is used for those servers:&#xA;&#xA;9 Web - 48 cores &#x2B; 64 GB RAM&#xA;4 DB &#x2013; 32 cores &#x2B; 768 GB RAM&#xA;&#xA;There are a few other type of servers there, and I recommend looking into the links, because there is a lot of interesting details there.&#xA;The key here is that they are running top 200 site in significantly less hardware, and are able to serve requests and provide great quality of service.&#xA;To be fair, Stack Overflow is a read heavy site, with under half a million questions and answers in a month. In other words, less than 0.04% of the views generate a write. That said, I&#x2019;m not certain that the numbers would be meaningfully different in other social media platforms.&#xA;In my next post, I&#x2019;m going to explore how you can build a social media platform without going bankrupt.</p>
        </article>
        <article id="article-1220">
            <a href="https://ayende.com/blog/192961-C/seeking-feedback-on-the-ravendb-cluster-dashboard" target="_blank">
                <h2 class="title mb-6" id="article-1220">Seeking feedback on the RavenDB Cluster Dashboard</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 20, 2021
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am really proud with the level of transparency and visibility that RavenDB gives out of the box to its users. The server dashboard gives you all the critical information about what a node is doing and can serve as a great mechanism to tell at a glance what is the health of a node.A repeated customer request is to take that up a notch. Not just showing a single server status, but showing the entire cluster state. This isn&#x2019;t a replacement for a full monitoring solution, but it is meant to provide you with a quick overview of exactly what is going on in your cluster.I want to present some early prototypes of how we are thinking about showing this information, and I wanted to get your feedback about those, as well as any other information that you think should be relevant for the cluster dashboard.Here is the resource utilization portion of the dashboard. We aren&#x2019;t settled yet on the graphs, but we&#x2019;ll likely have CPU usage and memory (including memory breakdowns). Some of this information may be hidden by default, and you can expand it:You can get more details about what the cluster is doing here:And finally, the overall view of task assignment in the cluster:You can also drill down to a particular server status:This is early stages yet, we pretty much have just the mockup, so this is the right time to ask for what you want to see there.</p>
        </article>
        <div class="button flex justify-between">
            <a href="121.html"><span class="back arrow"></span></a>

            <a href="123.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>