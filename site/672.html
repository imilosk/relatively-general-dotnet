
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 672 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-6711">
            <a href="https://ayende.com/blog/3504/patterns-for-distributed-hash-tables-range-queries" target="_blank">
                <h2 class="title mb-6" id="article-6711">Patterns for Distributed Hash Tables</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 09, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Next to last, in this series on using Distributed Hash Tables (DHT)!&#xA;The previous ones are:&#xA;&#xA;&#xA;Distributed in memory cache / storage&#xA;&#xA;&#xA;Patterns for using distributed hash tables: Groups&#xA;&#xA;&#xA;Patterns for using distributed hash tables: Locking&#xA;&#xA;&#xA;&#xA;&#xA;Patterns for Distributed Hash Tables: Locality&#xA;&#xA;&#xA;Patterns for Distributed Hash Tables: Item Groups&#xA;&#xA;&#xA;Patterns for Distributed Hash Tables: Cheap Cross Item Transactions&#xA;&#xA;&#xA;Patterns for Distributed Hash Tables: Lookup by property&#xA;&#xA;&#xA;In the previous post, we covered how we can create an index that will allow us to get all items that exactly match a specific value. However, we have seen that trying to query by range is not possible using this approach.&#xA;This white paper (PDF) covers how we can use a Trie on top of a DHT. This is an intensely interesting subject. However, since I do not intend to regurgitate either the article or the discussion on tries, I would like to show an implementation of a trie on a DHT, instead. I strongly suggest reading the article, at least.&#xA;&#xA;Note about the implementation, yes, it is not as nice as it can be, probably inefficient and don&#x27;t manage a lot of the things that the white paper calls for (like splitting nodes), I am aware of that, but I choose to go with a simple implementation to demonstrate the concept. If you would like to extend the implementation to show how it should be done, I would be very interested in seeing this.&#xA;The code for the Trie implementation can be found in the scratch pad.&#xA;&#xA;First, we have our (mocked) distributed cache:&#xA;&#xA;public class DistributedCache&#xA;{&#xA;&#x9;private static readonly Hashtable[] distributedCache = new[]&#xA;&#x9;{&#xA;&#x9;&#x9;new Hashtable(), new Hashtable(), new Hashtable(),&#xA;&#x9;&#x9;new Hashtable(), new Hashtable(), new Hashtable(),&#xA;&#x9;&#x9;new Hashtable(), new Hashtable(), new Hashtable(),&#xA;&#x9;&#x9;new Hashtable(), new Hashtable(), new Hashtable(),&#xA;&#x9;&#x9;new Hashtable(), new Hashtable(), new Hashtable(),&#xA;&#x9;&#x9;new Hashtable(), new Hashtable(), new Hashtable(),&#xA;&#x9;};&#xA;&#xA;&#x9;public static void PutInCache(string key, object value)&#xA;&#x9;{&#xA;&#x9;&#x9;var table = distributedCache[Math.Abs(key.GetHashCode()) % distributedCache.Length];&#xA;&#x9;&#x9;table[key] = value;&#xA;&#x9;}&#xA;&#xA;&#x9;public static object GetFromCache(string key)&#xA;&#x9;{&#xA;&#x9;&#x9;return distributedCache[Math.Abs(key.GetHashCode()) % distributedCache.Length][key];&#xA;&#x9;}&#xA;}&#xA;&#xA;Next we define a Trie Node:&#xA;&#xA;public class TrieNode&#xA;{&#xA;&#x9;public TrieNode()&#xA;&#x9;{&#xA;&#x9;&#x9;Children = new SortedList&lt;string,string&gt;();&#xA;&#x9;}&#xA;&#xA;&#x9;public string PartialValue { get; set; }&#xA;&#x9;public SortedList&lt;string, string&gt; Children { get; set; }&#xA;&#x9;public string KeyInCache { get; set; }&#xA;}&#xA;&#xA;And now we need to take a look at Trie Manager itself. It is a bit complex, so we will look at each piece in isolation. We will start from the simple methods:&#xA;&#xA;public static void PutInCacheAndUpdateTrie(KeyValuePair&lt;string, string&gt; word)&#xA;{&#xA;&#x9;DistributedCache.PutInCache(word.Key, word.Value);&#xA;&#x9;UpdateTrie(word);&#xA;}&#xA;&#xA;public static string CreateNodeKey(string val)&#xA;{&#xA;&#x9;return &quot;Node: &quot; &#x2B; val;&#xA;}&#xA;&#xA;Putting an item in the cache will physically put it in the cache, and also update the trie. Each node of the trie is prefixed with &quot;Node: &quot; and the actual key it represent. The Update Trie method is interesting:&#xA;&#xA;private static void UpdateTrie(KeyValuePair&lt;string, string&gt; word)&#xA;{&#xA;&#x9;string currentKey = word.Value;&#xA;&#x9;var node = DistributedCache.GetFromCache(CreateNodeKey(currentKey)) as TrieNode;&#xA;&#x9;while (node == null)&#xA;&#x9;{&#xA;&#x9;&#x9;// this code assumes that the empty node is already in the cache&#xA;&#x9;&#x9;currentKey = currentKey.Substring(0, currentKey.Length - 1);&#xA;&#x9;&#x9;node = DistributedCache.GetFromCache(CreateNodeKey(currentKey)) as TrieNode;&#xA;&#x9;}&#xA;&#x9;if (currentKey == word.Value)// value already in trie, overwrite it&#xA;&#x9;{&#xA;&#x9;&#x9;node.KeyInCache = word.Key;&#xA;&#x9;&#x9;return;&#xA;&#x9;}&#xA;&#x9;// need to create child node(s)&#xA;&#x9;while (currentKey != word.Value)&#xA;&#x9;{&#xA;&#x9;&#x9;currentKey = currentKey &#x2B; word.Value[currentKey.Length];&#xA;&#xA;&#x9;&#x9;var childNode = new TrieNode&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;PartialValue = currentKey,&#xA;&#x9;&#x9;&#x9;KeyInCache = currentKey == word.Value ? word.Key : null&#xA;&#x9;&#x9;};&#xA;&#x9;&#x9;string value = CreateNodeKey(currentKey);&#xA;&#x9;&#x9;node.Children.Add(value, value);&#xA;&#x9;&#x9;DistributedCache.PutInCache(CreateNodeKey(currentKey), childNode);&#xA;&#x9;&#x9;node = childNode;&#xA;&#x9;}&#xA;}&#xA;&#xA;The overall structure is:&#xA;&#xA;Find the highest node that match the current value&#xA;If it exists, overrwrite the value (we allow only a single key per value in this impl.)&#xA;If it doesn&#x27;t exists, create all the nodes from the root (which always exists) to the current value.&#xA;&#xA;This is basically it, all we have left is actually querying the trie:&#xA;&#xA;public static IEnumerable&lt;KeyValuePair&lt;string, string&gt;&gt; GetFromCacheInRange(string start, string end)&#xA;{&#xA;&#x9;var lcd = GetLowestCommonDenominator(start, end);&#xA;&#x9;var cache = (TrieNode)DistributedCache.GetFromCache(CreateNodeKey(lcd));&#xA;&#x9;if (cache == null)&#xA;&#x9;&#x9;return new KeyValuePair&lt;string, string&gt;[0];&#xA;&#x9;int indexOfFirstKey = cache.Children.IndexOfKey(lcd);&#xA;&#x9;if (indexOfFirstKey == -1)&#xA;&#x9;&#x9;indexOfFirstKey = 0;&#xA;&#x9;var keys = new List&lt;string&gt;();&#xA;&#x9;if (IsMatchingNode(cache, start, end))&#xA;&#x9;&#x9;keys.Add(cache.KeyInCache);&#xA;&#x9;for (int i = indexOfFirstKey; i &lt; cache.Children.Count; i&#x2B;&#x2B;)&#xA;&#x9;{&#xA;&#x9;&#x9;if (ProcessNode(keys, cache.Children.Values[i], start, end) == false)&#xA;&#x9;&#x9;&#x9;break;&#xA;&#x9;}&#xA;&#x9;var result = new Dictionary&lt;string, string&gt;();&#xA;&#x9;foreach (var s in keys)&#xA;&#x9;{&#xA;&#x9;&#x9;result.Add(s, DistributedCache.GetFromCache(s).ToString());&#xA;&#x9;}&#xA;&#x9;return result;&#xA;}&#xA;&#xA;Here we find the maximum shared string in the start of both start and end, then try to get the relevant node for it. Then we iterate over all the direct children of the node and add the items to the list of keys. Finally, we resolve the list of keys from the cache. Finding the maximum shared string start is as simple as this:&#xA;&#xA;private static string GetLowestCommonDenominator(string x, string y)&#xA;{&#xA;&#x9;var sb = new StringBuilder();&#xA;&#x9;for (int i = 0; i &lt; x.Length &amp;&amp; i &lt; y.Length; i&#x2B;&#x2B;)&#xA;&#x9;{&#xA;&#x9;&#x9;if (x[i] != y[i])&#xA;&#x9;&#x9;&#x9;break;&#xA;&#x9;&#x9;sb.Append(x[i]);&#xA;&#x9;}&#xA;&#x9;return sb.ToString();&#xA;}&#xA;&#xA;One important implementation detail is determining if a partial value string is between the start and end delimiters that we are given. We do this using IsMatchingNode method:&#xA;&#xA;private static bool IsMatchingNode(TrieNode cache, string start, string end)&#xA;{&#xA;&#x9;if (cache.KeyInCache == null)&#xA;&#x9;&#x9;return false;&#xA;&#xA;&#x9;bool greaterThanOrEqStart;&#xA;&#x9;string partialValue = cache.PartialValue;&#xA;&#x9;if (partialValue.Length &gt; start.Length)&#xA;&#x9;&#x9;greaterThanOrEqStart = partialValue.Substring(0, start.Length).CompareTo(start) &gt;= 0;&#xA;&#x9;else&#xA;&#x9;&#x9;greaterThanOrEqStart = partialValue.CompareTo(start) &gt;= 0;&#xA;&#x9;if (greaterThanOrEqStart == false)&#xA;&#x9;&#x9;return false;&#xA;&#x9;return StillInRange(partialValue, end);&#xA;}&#xA;&#xA;private static bool StillInRange(string partialValue, string end)&#xA;{&#xA;&#x9;bool smallerOrEqEnd;&#xA;&#x9;if (partialValue.Length &gt; end.Length)&#xA;&#x9;&#x9;smallerOrEqEnd = partialValue.Substring(0, end.Length).CompareTo(end) &lt;= 0;&#xA;&#x9;else&#xA;&#x9;&#x9;smallerOrEqEnd = partialValue.CompareTo(end) &lt;= 0;&#xA;&#x9;return smallerOrEqEnd;&#xA;}&#xA;&#xA;Those are ugly, I&#x27;ll admit.&#xA;Now the only thing that we have left is how we process a node recursively:&#xA;&#xA;private static bool ProcessNode(ICollection&lt;string&gt; keys, &#xA;&#x9;string nameOfItemInCache, string start, string end)&#xA;{&#xA;&#x9;var node = (TrieNode)DistributedCache.GetFromCache(nameOfItemInCache);&#xA;&#x9;if (IsMatchingNode(node, start, end))&#xA;&#x9;&#x9;keys.Add(node.KeyInCache);&#xA;&#x9;if (StillInRange(node.PartialValue, end) == false)&#xA;&#x9;&#x9;return false;&#xA;&#x9;foreach (var value in node.Children.Values)&#xA;&#x9;{&#xA;&#x9;&#x9;if (ProcessNode(keys, value, start, end) == false)&#xA;&#x9;&#x9;&#x9;return false;&#xA;&#x9;}&#xA;&#x9;return true;&#xA;}&#xA;&#xA;Given all of that, we can now write the following client code:&#xA;&#xA;public static void Main()&#xA;{&#xA;&#x9;var words = new Dictionary&lt;string, string&gt;&#xA;&#x9;{&#xA;&#x9;&#x9;{&quot;foo&quot;, &quot;hello&quot;},&#xA;&#x9;&#x9;{&quot;bar&quot;, &quot;beer&quot;},&#xA;&#x9;&#x9;{&quot;fubar&quot;, &quot;snow&quot;},&#xA;&#x9;&#x9;{&quot;welcome&quot;, &quot;black&quot;},&#xA;&#x9;&#x9;{&quot;forward&quot;, &quot;rose&quot;},&#xA;&#x9;&#x9;{&quot;next&quot;, &quot;lion&quot;},&#xA;&#x9;&#x9;{&quot;exit&quot;, &quot;hungry&quot;},&#xA;&#x9;&#x9;{&quot;seek&quot;, &quot;monk&quot;},&#xA;&#x9;};&#xA;&#xA;&#x9;DistributedCache.PutInCache(TrieManager.CreateNodeKey(&quot;&quot;), new TrieNode { KeyInCache = null, PartialValue = &quot;&quot; });&#xA;&#xA;&#x9;foreach (var word in words)&#xA;&#x9;{&#xA;&#x9;&#x9;TrieManager.PutInCacheAndUpdateTrie(word);&#xA;&#x9;}&#xA;&#x9;var items = TrieManager.GetFromCacheInRange(&quot;ba&quot;, &quot;bz&quot;);&#xA;&#x9;if (items == null)&#xA;&#x9;&#x9;return;&#xA;&#x9;foreach (var item in items)&#xA;&#x9;{&#xA;&#x9;&#x9;Console.WriteLine(item.Key &#x2B; &quot; = &quot; &#x2B; item.Value);&#xA;&#x9;}&#xA;}&#xA;&#xA;With the output being:&#xA;&#xA;bar = beer welcome = black&#xA;&#xA;This may not seem like an impressive fit, but imagine if we stored things like Users in the DHT, not just a string. This would allow us to perform a range query over the user names and get the actual users (changing the sample code to do this is left as an exercise for the reader).&#xA;The code for the Trie implementation can be found in the scratch pad.</p>
        </article>
        <article id="article-6712">
            <a href="https://ayende.com/blog/3505/patterns-for-using-distributed-hash-tables-conclusion" target="_blank">
                <h2 class="title mb-6" id="article-6712">Patterns for using Distributed Hash Tables</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 09, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Well, it looks like I finally had completed all I wanted to say about DHTs. I can now go back to talking about multi tenancy :-)  The previous ones are:            Distributed in memory cache / storage            Patterns for using distributed hash tables: Groups            Patterns for using distributed hash tables: Locking                Patterns for Distributed Hash Tables: Locality            Patterns for Distributed Hash Tables: Item Groups            Patterns for Distributed Hash Tables: Cheap Cross Item Transactions            Patterns for Distributed Hash Tables: Lookup by property            Patterns for Distributed Hash Tables: Range Queries      We have gone over a lot of options for how to use a DHT / Distributed Cache. Some of them are for intellectual curiosity, some of them are of practical use. I urge you to remember that a DHT is not an RDBMS, and that both the access patterns and usage are different. Trying to force one into the other can be painful.  In the first post in the series, I presented a list of common operations that all DHT supports:     PUT key, data, expiration      Will fail if item is already in cache     GET key      Will return null if item is not in cache or if expired     DEL key      Delete the key from the cache     UPDATE key, data, version      Update the item if the version matches    There are a few things that I would consider important as well:     Batching support - the ability to send several items to storage in a node, as well as getting several items from a node. The later is usually supported, but the former is generally not.    Operations such as add_to_list, remove_from_list can make some operations much simpler if they are implemented by the cache rather than built on top of it.    Automatic recognition of common conventions:         &quot;{Customer#1}_Orders&quot;, which can be translated by the client automatically to the item group name. If we enforce locality on the groups, we can even have the server resolve that for us, without having to pay the cost for the extra call. But this can be implemented on both server and client.      Automatic recognition of locality, so for the purpose of node matching, we will consider only the parts before the colon in a key. This way &quot;foo:1&quot; and &quot;foo:2&quot; will end up on the same node.      Integrating indexed properties and indexed ranges are things that should happen at the client level, so your API will look something like:     Put(item, x =&gt; x.Name, x =&gt; x.Age)&#xA;Get&lt;Foo&gt;( x =&gt; x.Name, &quot;bar&quot;)&#xA;GetRange&lt;Foo&gt;( x =&gt; x.Name, &quot;foo&quot;, &quot;tada&quot; )&#xA;&#xA;&#xA;Those are just rough ideas, but they should tell you how to deal with this.&#xA;&#xA;Building a DHT is a really simple task, assuming that you go with the memcached model of double hashing, so adding support for such things isn&#x27;t particularly hard. But do consider if this is the right solution or not in those scenario.&#xA;&#xA;Done, at last. Hope you liked the series.</p>
        </article>
        <article id="article-6713">
            <a href="https://ayende.com/blog/3503/patterns-for-distributed-hash-tables-lookup-by-property" target="_blank">
                <h2 class="title mb-6" id="article-6713">Patterns for Distributed Hash Tables</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 09, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Will this series on using Distributed Hash Tables (DHT) ever end?  The previous ones are:            Distributed in memory cache / storage            Patterns for using distributed hash tables: Groups            Patterns for using distributed hash tables: Locking                Patterns for Distributed Hash Tables: Locality            Patterns for Distributed Hash Tables: Item Groups            Patterns for Distributed Hash Tables: Cheap Cross Item Transactions      One of the problems of using a DHT is that the only access strategy that you have is the key. And while key based access is fast, it is also fairly limited. We can&#x27;t perform queries on anything but the key. And that sucks. As it turn out, we can provide our own indexes by defining groups keyed by values.   Let us say that we need to find all the users which have not verified their email address. In SQL, we will write:     select * from Users where EmailVerified = 0&#xA;&#xA;&#xA;Using a DHT, it is slightly more complex than that. What we need to do is to create (and maintain, sadly) the index ourselves. In other words, here is the process of writing a User to the DHT:&#xA;&#xA;&#xA;  PUT &quot;User #15&quot;, user&#xA;ADD_TO_LIST &quot;User_EmailVerified_&quot; &#x2B; user.EmailVerified, &quot;User #15&quot;&#xA;&#xA;&#xA;Note that I added a new operation, add_to_list, which is usually does not exists in DHT, but will significantly simply the code, checkout the post about groups to see how we can implement that ourselves.&#xA;&#xA;Note how we structure the name of the list. We will have two such lists in the system, &quot;User_EmailVerified_True&quot; and &quot;User_EmailVerified_False&quot;. We can get the list of all the users that match that property by simply getting the list of values from the list and resolving each of the keys.&#xA;&#xA;This is extremely simple approach, but it does come at a cost for managing that, and remembering that we need to manage that. One problem with this approach is that this is a highly specific one. We can lookup by range, only by specific value.&#xA;&#xA;On my next post, I&#x27;ll cover range queries.</p>
        </article>
        <article id="article-6714">
            <a href="https://ayende.com/blog/3502/patterns-for-distributed-hash-tables-cheap-cross-item-transactions" target="_blank">
                <h2 class="title mb-6" id="article-6714">Patterns for Distributed Hash Tables</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 09, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">And yet another post in my series on using Distributed Hash Tables (DHT).   The previous ones are:            Distributed in memory cache / storage            Patterns for using distributed hash tables: Groups            Patterns for using distributed hash tables: Locking                Patterns for Distributed Hash Tables: Locality            Patterns for Distributed Hash Tables: Item Groups      And in this post, I want to discuss how we can implement cross item transactions. This is a bit more complex than it sounds, because most of the DHT out there will not allow you to have any atomic operation on more than a single item. This makes sense, since DHT is well... distributed, trying to coordinate a transaction in a DHT would require a distributed transaction, something that has a very high performance penalty.  Again, I&#x27;ll say upfront that if you need transactions in a DHT, you are probably doing something wrong. A DHT is based on a key / value lookup, trying to turn that into something that resemble a RDBMS will cause problems. Use this approach with care.  Let us consider the following case, we have Customer, Order and the association between customer and the orders. We have decided to implement this in the following fashion:     Customer #1 - customer data    Customer #1 Orders - associated orders ids    Order #14 - order id   I am repeating again that a probable better way would be to aggregate all the customer information (including its orders) in the customer data, instead of spreading that around on multiple keys, but I have to use some example here, and I choose that one.  We want to be able to add an order to the customer in a single transaction, that is, with all the usual ACID properties. Let us say that adding an order will modify customer and the associated orders as well, so we can&#x27;t have just update the associated key and end with that, we have to have a smarter approach, because we are updating two keys, which must be in sync.  One aspect of the propose solution is that we have to think ahead and design what our transaction boundary will be. In effect, this is very similar to the way we draw transaction boundaries in DDD, although in this case this is actually mandatory.  The proposed solution is quite simple, instead of putting the data in the cache as described above, we can put it using the following approach:     {Customer #1 Group} Customer #1    {Customer #1 Group} Customer #1 Orders    {Customer #1 Group} Order #14   The important bit is the use of an item group, because we have this, we can now perform an update using the following approach:     LOCK &quot;Customer #1 Group&quot;&#xA;customerGroup = GET &quot;Customer #1 Group&quot;&#xA;customer, associated_orders = GET customerGroup &#x2B; &quot; Customer #1&quot;, customerGroup &#x2B; &quot; Customer #1 Orders&quot;&#xA;&#xA;// Do business logic to update customer &amp; orders&#xA;&#xA;customerGroup = Guid.NewGuid()&#xA;&#xA;PUT customerGroup &#x2B; &quot; Customer #1&quot;, customer&#xA;PUT customerGroup &#x2B; &quot; Customer #1 Orders&quot;, associated&#xA;&#xA;PUT &quot;Customer #1 Group&quot;, customerGroup&#xA;UNLOCK &quot;Customer #1 Group&quot;&#xA;&#xA;  // optional: delete previous version, or just let it expire&#xA;&#xA;&#xA;The logic here is simple, we lock on the group key, thus preventing anyone else from updating on it. Then we get the group key and the current state of the items in the group. We update them, generate a new group key and put the new items there, finally, we update the customer group and unlock it.&#xA;&#xA;Let us look at it from the ACID properties that we manage to get:&#xA;&#xA;&#xA;  Atomicity - until we update the group key, which is the final stage, all of our changes are private, and not visible to the outside world. In fact, if another &quot;transaction&quot; has started reading while this was running, it will get the previous version of the value, while running concurrently with this one, instead of blocking.&#xA;&#xA;  Consistency - see atomcity, since updating the group key is the last step, we always publish a consistent state.&#xA;&#xA;  Isolation - see atomicity, no one can access the new values until we publish the group key&#xA;&#xA;  Durability - this depends on the guarantees that the DHT makes&#xA;&#xA;&#xA;This is, I think, a very elegant solution. I would caution you again from adopting it across the board, use a DHT as it is meant to be used, not try to force it to be a RDBMS.</p>
        </article>
        <article id="article-6715">
            <a href="https://ayende.com/blog/3501/patterns-for-distributed-hash-tables-item-groups" target="_blank">
                <h2 class="title mb-6" id="article-6715">Patterns for Distributed Hash Tables</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 09, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">And yet another post in my series on using Distributed Hash Tables (DHT).  The previous ones are:           Distributed in memory cache / storage            Patterns for using distributed hash tables: Groups            Patterns for using distributed hash tables: Locking                Patterns for Distributed Hash Tables: Locality      Right now I want to talk about item groups, or namespaces. In DHT, a namespace isn&#x27;t quite the same as the one we are familiar with from programming language. It is a way to refer to a group of items in a one sweep. Usually, this is used either to retire a whole bunch of items at the same time, or redirect them (which might be the same thing). This is usually useful in caching scenarios much more than in DHT scenarios, but it is an important building block.  Let us consider the idea of having a shop, with all its products in the DHT. We have some batch process that updates a lot of the product information, so we want to be able to retire all the products in the cache in one go. Having to go through the entire products list would be expensive (N remote calls) and will produce invalid view of the data, since some of the items will be retired while some still in the cache, etc.  One way of dealing with that is by defining an item group. An item group is defined so:     {group name}_product_1    {group name}_product_2    {group name}_product_3   The {group name} is not the actual value there, of course. Instead, {group name} refers to a key in the DHT as well. That key contains a value (usually numeric one) that we use when we query the data. So, getting product #1 from the DHT will involve:     GET &quot;{group name}&quot; - return 432    GET &quot;432_product_1&quot;   Using this approach, we can change, in one sweep, all the items that belong to this group. Again, this is nothing but convention, but it is a very useful one. In fact, we will see in a the next post that it can be used to do some pretty interesting things.</p>
        </article>
        <article id="article-6716">
            <a href="https://ayende.com/blog/3500/what-is-wrong-with-sortedlist-t" target="_blank">
                <h2 class="title mb-6" id="article-6716">What is wrong with SortedList&lt;T&gt;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 09, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Today it has arouse my ire. Take a look at the IndexOfKey, IndexOfValue and RemoteAt methods.    You would expect a list to have a way to get to item by index, certainly based on methods such as RemoveAt and IndexOfXyz.  It doesn&#x27;t have such a way. You have to violate the Law of Demeter in order to get it to work, list.Values[i], yuck!</p>
        </article>
        <article id="article-6717">
            <a href="https://ardalis.com/client-cache-headers/" target="_blank">
                <h2 class="title mb-6" id="article-6717">Client Cache Headers</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 08, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Anybody who&#x2019;s talked to me about web programming in the last 5 years or so knows that I&#x2019;m a big fan of caching. However, in most of my&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-6718">
            <a href="https://ayende.com/blog/3499/patterns-for-distributed-hash-tables-locality" target="_blank">
                <h2 class="title mb-6" id="article-6718">Patterns for Distributed Hash Tables</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 08, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Here is another post in my series on using Distributed Hash Tables (DHT).  The previous ones are:           Distributed in memory cache / storage            Patterns for using distributed hash tables: Groups            Patterns for using distributed hash tables: Locking      Now I want to talk about locality, and why it is important. First, the idea of locality is very simple. Put related items together, so getting them from the DHT can be done in a single call.  Let us say that we have the following objects in our application: User, Shopping Cart and Session. We can just put them in the DHT, and they may land wherever they want, but that is not the most optimized way to treat them. A DHT call is cheap, but it is still a remote call, and we really want to minimize that. Assuming that we understand the data access patterns in the application, we can do a bit better than making three remote calls to the DHT.  Just about any DHT will support the idea of multi key get, so we can ask the following:     GET &#x27;User #1&#x27;, &#x27;User #1: Session&#x27;, &#x27;User #1: Shopping Cart&#x27;   We need to ensure that when we are writing to the DHT, we will understand that the meaningful key name for node selection is the part that comes before the colon. And the same for reading.  Now, reading all three items, is a single remote call. And that has significant performance implications. Note that you shouldn&#x27;t rely on that too much, otherwise all your data will end up in a single node, but it is a good model to use in many cases, just don&#x27;t go overboard with this.</p>
        </article>
        <article id="article-6719">
            <a href="https://ayende.com/blog/3498/multi-tenancy-extensible-data-model" target="_blank">
                <h2 class="title mb-6" id="article-6719">Multi Tenancy - Extensible Data Model</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 07, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Continuing on the multi tenancy theme. We have the following problem, I now want to focus on the data model, and how you can create an extensible data model.&#xA;In particular, I am thinking about the ability to define something like a base line Customer entity, and allow a tenant to extend that with new fields and behavior. Note that we are talking about both data and behavior here, not on just extending the data. But let us try to take a look at that as well, just to see what solutions we can come up with.&#xA;The scenario that we have is that the tenant would like to define a new set of properties on the customer, such as non smoking preferences and the mother tongue. Let us see how we can deal with it. We will start by focusing solely on the underlying data model, without considering the actual entities.&#xA;Non RDBMS store&#xA;The main problem of storing additional properties in an entity is that we usually map that to an DB, and those really would like to know, upfront, about all the columns and what is the type of each and every column, Going with a non RDBMS store frees us from this limitation, because we can choose a back end store that is can accept any format. A document store like Lucene is a good example, or Google&#x27;s BigTable or a few others that are out there. This means that you can very easily store tuples in the data store, without requiring fixed schema. Extending teh schema for a customer just means giving them the UI to do so (more on that in a future post).&#xA;The ExtraData Column&#xA;Since there are a lot of benefits for a database, we really want to try to deal with hat problem in this context as well. The easiest solution, probably, is having ExternalData XML (or NVARCHAR(MAX) column in all the tables, into which we can tack the specific tenant data. This has the advantage of being very simple to implement, but it has a lot of issues with regards to the resulting data model, being able to query on the data, that the user has added (and is presumedly important. Therefor, we need to consider other options.&#xA;The ExtraInt1, ExtraInt2, ExtraDate1,ExtraDate2, ExrtraStr1, ExtraStr2 Columns&#xA;With this approach you define a few extra columns at the end of each entity&#x27;s table. And allow the user to map his own concepts to those extra columns. This is really nice from the simple perspective of fixed data model, but is a really bad idea from the perspective o understanding what the hell is going on with the system. Because on tenant used ExtraInt1 to store a language Id and another for storing customer weight, trying to understand what this means is extremely hard. Understanding queries, or optimizing them, building meaningful reports, all are going to be very hard to do.&#xA;The Key Value Table&#xA;Using this approach, we have an AdditionalValues table, with the following structure (EntityId, ValueTypeId, StrValue, IntValue, DateValue) as well as ValuesDefinitions table (ValueTypeId, EntityType, Name, DataType). Using this, we can &quot;extend&quot; the data model for an entity by simply defining a ValueDefinition and writing the values. It does tend to make things quite a bit more complicated from the querying side, and reporting on top of this mode is hard, to say the least. Beyond that, it is very flexible, and the last solution that keep us with a fixed schema.&#xA;Extending the customer table&#xA;By this I mean that if we want an additional value, we can simply add the new column to the table, and we are done. It has some complexity with regards to how you intend to manage that (must allow safe changes only, etc), but from the point of view of usage, that is extremely easy. Querying and reporting are a snap, and the only problem looming in the horizon is the next version.&#xA;Let us say that a customer has defined the NaturalLanguage extended column, and marked it as int, with values (2,3,6,8), which are how they represent the values in the rest of the organization. The next version of the product also have NaturalLanguage column, and it is a string with the language code. Problem.&#xA;The Customer_Extended table&#xA;We can deal with this issue by separating the customizations into a separate table, which we will give us a good place to put the new columns, with the same benefits of extending the actual table, but without the versioning issues.&#xA;For myself, I tend to favor the last one, extended data model using either an extension table or the actual table. It is the easiest to manage &amp; grasp, and it has major benefits for the simplicity of the system on the long term.&#xA;So far we have talked only about the actual data model, not how we can extend this with behaviors. I think that I&#x27;ll leave that one for a later post, and only say tat the storage options that you have will affect your ability to get a clean model at the application layer.</p>
        </article>
        <article id="article-6720">
            <a href="https://ayende.com/blog/3497/multi-tenancy-the-physical-data-model" target="_blank">
                <h2 class="title mb-6" id="article-6720">Multi Tenancy - The Physical Data Model</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 07, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Continuing on the multi tenancy theme, let us talk about the actual physical structure of the data store. In general, you have two basic options.&#xA;&#xA;  The TenantId column and separated data stores. The TenantId is simply adding a column to all the columns, showing what tenant the row belongs to.&#xA;&#xA;  The separate data store calls for a much higher level of separation, where there is no shared storage for the tenants.&#xA;&#xA;There are variation on those, such as having separation in the schema level instead of DB level, etc, but they all end up being down to one of those choices.&#xA;The TenantId approach allows you to use a single DB for the entire application, potentially reducing costs for managing the environment. It is also the easiest to explain, we just filter by TenantId and that is it!&#xA;It comes with a whole set of problems that is related to that decision, however:&#xA;&#xA;  Isolation - You have to actively do filtering all the time. This has major issues on your code. And now, tacking TenantId = @CurrentTenant at each query is not going to be sufficient. Consider the case of joins in such an environment, you are likely to get a filter only on the end result, after it was joined already. And that is just one example.&#xA;&#xA;  Backup - The backup strategy that you have for this scenario sucks. Basically, you have to roll your own.&#xA;&#xA;  Customer copy of the data - Going back to the backup strategy? You can&#x27;t just hand the customer the backup. You have to dump the data out, and write something that writes it back in, and it has to be fast.&#xA;&#xA;  Security - you have to let all tenants access the data, security is in the app logic level.&#xA;&#xA;  Extensibility - in a shared environment it is hard to do a lot of extensibility in the data, because each client is stepping on each other toes.&#xA;&#xA;As you probably gathered, I strongly suggest going with the separate model. Now our management strategy is dealing with the connection string. Isolation is built in and doesn&#x27;t require any , for backup you have the vendor tools, and giving the customer its own data is trivial, just send him the backup file. Security is easy, a tenant can access only their DB, and extending this is much easier, because each tenant has their own walled garden to play with.</p>
        </article>
        <div class="button flex justify-between">
            <a href="671.html"><span class="back arrow"></span></a>

            <a href="673.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	"> Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
