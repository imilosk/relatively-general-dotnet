
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 843 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-8421">
            <a href="https://ayende.com/blog/1845/building-applications-using-castle-rc2-part-ii" target="_blank">
                <h2 class="title mb-6" id="article-8421">Building Applications Using Castle RC2</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 04, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Last time I left we had a working data access layer, based on Active Record, as well as a scaffolding for editing users. We used TDD to drive the functionality of the application, and I intend to keep doing it this way while developing the functionality of the site itself.     Before we start by building the initial list of tests, let us consider what we want to achieve...     We want to have&#xA0;a forum system, so diplaying the forums, adding and browsing messages is very important, but managing users / forums is not a high priority, we can leave the users management on the scaffolding, and build the scaffolding for forums as well. Here is what we need to do to build the scaffolding for Forum:             [Layout(&quot;default&quot;), Rescue(&quot;generalerror&quot;), Scaffolding(typeof(Forum))]                        public class ForumController : SmartDispatcherController                        {                        }         And now we can access it at /forum/list.rails     One thing that I forgot to do before is to add the ActiveRecord HttpModule, which goes into the &lt;httpModules&gt; section in &lt;system.web&gt; element, like this:             &lt;add name=&quot;active-record&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;type=&quot;Castle.ActiveRecord.Framework.SessionScopeWebModule, Castle.ActiveRecord&quot; /&gt;         Now, let us see what kind of scenarios we want to support:             The homepage should display a list of all the forums, by name and id, with links to the forum page.                 There should be a text box where I can enter a forum id and go directly to it.                 A forum should display ten root messages, and be pagable.                 Can add a message to forum.                 Can reply to message.                 Messages appear in hierarchy.         When building tests for a MonoRail application, we have two options, we can do normal tests, which involve testing the data sent from the controller to the view, or integration tests, where we assert on the HTML output from the view. Let us start with the first test, asserting that the homepage controller pass the view a list of all forums. We start by building the test data in the test setup. But in order to do this, we need to setup Active Record.     In the previous installment, we already setup Active Record for the MonoRail application, but now we are calling Active Record from the tests, and that is in a different AppDomain. A word about the way MonoRail tests work. A MonoRail test basically host the ASP.Net runtime in a different AppDomain, which means that anything that goes between your test and the application is cross AppDomain boundaries. This is why we need to setup Active Record in both the tests and the MonoRail application, they are on different app domains. One word of caution, right now we have setup the MonoRail application so that it would recreate the database on startup, but we setup the database on test setup. This means that we need to remove the ActiveRecordStart.CreateSchema() from Application_OnStart.     I decided to do the setup in a test base class, like this:             public class AbstractMRWithARTestCase : AbstractMRTestCase                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [SetUp]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public override void Initialize()                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ActiveRecordStarter.ResetInitializationFlag();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; IConfigurationSource source = ActiveRecordSectionHandler.Instance;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ActiveRecordStarter.Initialize(System.Reflection.Assembly.Load(&quot;Castle.Forums.Model&quot;), source);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ActiveRecordStarter.CreateSchema();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; base.Initialize();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        }         This initialize the framework, and then rebuild the database, so the tests are isolated.     Now, let us see the real setup code:             [SetUp]        public override void Initialize()        {        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; base.Initialize();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User user = new User(&quot;Ayende&quot;, &quot;Ayende@example.org&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; user.SetPassword(&quot;Scott/Tiger&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; user.Create();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Forum forum1 = new Forum(&quot;My Forum 1&quot;, user);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; forum1.Create();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Forum forum2 = new Forum(&quot;My Forum 2&quot;, user);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; forum2.Create();                        }         Now, after all this, we can start creating the first real test, it goes like this:             [Test]                        public void IndexAction_PassAllForumsToView()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; DoGet(&quot;home/index.rails&quot;);                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AssertPropertyBagContains(&quot;forums&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Forum[] forums = (Forum[])Response.PropertyBag[&quot;forums&quot;];                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(2, forums.Length);                                &#xA0;                        }         What does this do? Well, it asserts that the controller has passed two forums to the view. Running this test now will fail with this erro: Entry forums was not on PropertyBag     We have a red light! Let us make it green.&#xA0;We can make this test pass using this code:             public void Index()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; PropertyBag[&quot;forums&quot;] = Forum.FindAll();                        }         We run the code, and this time it is failing with another error, complaining that Forum is not a serializable type. This is an annoying side affect of the need to run ASP.Net in another AppDomain, everything that goes between the domains has to be serializable. This is an annoying limitation, and we are thinking about ways to fix this, but currently there isn&#x27;t a good way to do this, since the ASP.Net runtime creates its own AppDomain, and that is hard to change. So, we need to put [Serializable] on Forum, User and Message classes. I usually don&#x27;t like artificial test requirements, but this isn&#x27;t an onerous one, and there are valid reasons to want to do this anyway.     After making the model entities serializable, the test pass! Of course, if we go to the page, it doesn&#x27;t show anything, we need another test, one that would assert that the view is displaying the fourms:             [Test]                        public void IndexView_DisplayAllForums()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; DoGet(&quot;home/index.rails&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AssertReplyContains(&quot;My Forum 1&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AssertReplyContains(&quot;My Forum 2&quot;);                        }         Run and see it fails... Let us make this work. Go to the view, which is on the Castle.Forums.Web project, &quot;Views\Home\index.boo&quot;. We need to output the forums out, so let us do it simple as:             &lt;h2&gt;Forums List&lt;/h2&gt;                        &lt;ul&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;?brail for forum in forums: ?&gt;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;li&gt;${forum.Id} - ${forum.Name}&lt;/li&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;?brail end ?&gt;                                 &lt;/ul&gt;         Run the test again to make sure that it passes, and let us move on. We don&#x27;t have a list to each forum&#x27;s page, but this is because it doesn&#x27;t exists yet. So let us create it. I think that /forum/1/index.rails is a good place to put it, so let us create a ForumControllerTestCase class, for testing the new functionality. In the setup (which I will not show) we merely create a user, a forum and 50 messages (each with 2 reply messages). The root messages has names like Root 1 and&#xA0;Root 30, and their children names like Child 1.3 or Child 30.2, this is just so we can assert on them with ease.     Let us start by writing the test:             [Test]                        public void ForumController_PassAllRootMessagesToView()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; DoGet(string.Format(&quot;forum/{0}/index.rails&quot;, forumId));                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AssertSuccess();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AssertPropertyBagContains(&quot;messages&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message[] msgs = (Message[])Response.PropertyBag[&quot;messages&quot;];                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(50,&#xA0; msgs.Length);                        }         Very similar to what we did before. Notice that forumId is the id of the forum we create previously. Now, to get the to pass we need to do quite a bit.     First, let us add an index method to ForumController:             public void Index(int forumId)                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Forum forum = Forum.Find(forumId);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; PropertyBag[&quot;messages&quot;] = Message.FindAll(Expression.Eq(&quot;Forum&quot;, forum),                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Expression.IsNull(&quot;RootParent&quot;));                        }         Get the forum, and then get all the message for the forum, very simple. Note that this method is called by the MonoRail framework, and it has a parameter. This parameter is parsed by MonoRail from the request parameters (both query string and forms parameters are considered).     Considerring that the URL that we want to use has the format of &quot;/forum/1/index.rails&quot;, how can MonoRail understand that it should use the 1 as the parameter to the index? We can tell it so with the use of routing rules. A routing rule is merely a small piece of regex that transfrom one representation of the request URL to another.     You can configure routing using the &lt;monorail&gt;/&lt;routing&gt; element, by adding a rule:             &lt;rule&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;pattern&gt;/forum/(\d&#x2B;)/(.*)$&lt;/pattern&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;replace&gt;&lt;![CDATA[ /forum/$2?forumId=$1 ]]&gt;&lt;/replace&gt;                        &lt;/rule&gt;         We are simple replacing every reference to /forum/number/page with /forum/page?id=number. Now, MonoRail can translate the &quot;folder&quot; into the correct parameter. We are not done yet, we still need to create a view to show a forum&#x27;s listing. We need to create a a subdirectory under views &quot;Forum&quot;, which will contain all the forum&#x27;s views. Then, add an empty file called index.boo to it.     Now the test passes, but we have nothing in the view. Also, notice that we aren&#x27;t doing any paging yet.     Here is a test that assert that the page shows something, and that it is using paging:             [Test]                        public void ForumsView_ShowsOnlyFirstRootMessages()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; DoGet(string.Format(&quot;forum/{0}/index.rails&quot;, forumId));                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AssertReplyContains(&quot;Root 1&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AssertReplyContains(&quot;Root 9&quot;);                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AssertReplyDoesNotContain(&quot;Root 11&quot;);//that should be paged                        }         MonoRail has a feature called CachedPagination, which we are about to make use of. It means that we are going to need to change the controller code, and since the pagination is not serializable, so we need to restructure our tests first. Let us start with the code this time:             public void Index(int forumId)                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; string paginationCacheKey = string.Format(&quot;forum.{0}.messages&quot;, forumId);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; DataObtentionDelegate getMessageForForum = delegate                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Forum forum = Forum.Find(forumId);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return Message.FindAll(Expression.Eq(&quot;Forum&quot;, forum), Expression.IsNull(&quot;RootParent&quot;));                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; };                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; IPaginatedPage cachedPagination = PaginationHelper.CreateCachedPagination(paginationCacheKey,10,&#xA0;        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; getMessageForForum);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; PropertyBag[&quot;messages&quot;] =&#xA0; cachedPagination;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Flash[&quot;messages.TotalItems&quot;] = cachedPagination.TotalItems;                        }         What is going on? We create a cache key for the results, this should help reduce the amount of queries that we have in a big site, not really neccecary in our case, but it is so elegant that I can&#x27;t help it ;-) We pass a delegate to the method, which will be called when there is a cache miss to get the data. Then we put the resulting pagination and the total item count into it. Notice that I don&#x27;t need to specify which page I was working with, that is the responsability of the PaginationHelper.     I put the total count into the Flash so I could still test that I am getting the results from the controller. Since pagination is not serializble, I can no longer access PropertyBag, it can&#x27;t pass the AppDomain boundary. The first test now looks like this:             [Test]                        public void ForumController_PassAllRootMessagesToView()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; DoGet(string.Format(&quot;forum/{0}/index.rails&quot;, forumId));                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AssertSuccess();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AssertFlashContains(&quot;messages.TotalItems&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; int msgs = (int)Response.Flash[&quot;messages.TotalItems&quot;];                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(50,&#xA0; msgs);                        }         Moving on to writing the view itself, it looks like this:             &lt;h2&gt;Messages:&lt;/h2&gt;                        &lt;table&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;Title:&lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;Author:&lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;?brail for msg in messages: ?&gt;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ${msg.Title}                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ${msg.Author.Name}                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;?brail end ?&gt;                                 &lt;/table&gt;         Now, when we run the tests, everything pass. But we need to hanle paging as well. Currently we are just showing the first 10 rows. Here is a test that says we can page:             [Test]                        public void ForumsView_HasPaging_AndChangeDataOnPaging()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; DoGet(string.Format(&quot;forum/{0}/index.rails&quot;, forumId));                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; //has next link                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AssertReplyContains(&quot;&lt;a href=\&quot;/forum/index.rails?page=2&amp;amp;forumId=1&amp;amp;\&quot; &gt;next&lt;/a&gt;&quot;);                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; DoGet(string.Format(&quot;forum/{0}/index.rails&quot;, forumId), &quot;page=3&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AssertReplyContains(&quot;Root 20&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AssertReplyContains(&quot;Root 29&quot;);                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AssertReplyDoesNotContain(&quot;Root 19&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AssertReplyDoesNotContain(&quot;Root 31&quot;);                        }         This is fairly brute force way of doing this, but I can&#x27;t really this of a better way. Also, notice the way of passing query strings using DoGet(), if you try to concat strings to make&#xA0;a URL, it won&#x27;t work. Anyway, we need paging, we are likely going to want to do this in more than one view since paging is a cross cutting concerns. We are going to utilize the CommonScripts functionality of Brail to get this. Add a subfolder called CommonScripts to the Views folder, and create a file called Paging.boo:             import Castle.MonoRail.Framework.Helpers                        import System.Text                        import System.Collections                                &#xA0;                        def Pagination(paginationHelper as PaginationHelper,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; items as IPaginatedPage,                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; htmlAttributes as IDictionary,                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; querySting as IDictionary):                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output = StringBuilder()                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output.Append(&quot;&quot;&quot;&lt;div class=&quot;pagination&quot;&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;table width=&quot;100%&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0; border=&quot;0&quot;&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;Showing ${items.FirstItem} - ${items.LastItem} of ${items.TotalItems}&lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td align=&quot;right&quot;&gt;&quot;&quot;&quot;)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if items.HasFirst:                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output.Append( paginationHelper.CreatePageLink( 1, &quot;first&quot;,htmlAttributes, querySting )&#xA0; )                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; else:                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output.Append( &quot;first&quot; )                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; end                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output.Append( &quot; | &quot; )                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if items.HasPrevious:                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output.Append( paginationHelper.CreatePageLink( items.PreviousIndex, &quot;prev&quot;,htmlAttributes, querySting )&#xA0; )                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; else:                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output.Append( &quot;prev&quot; )                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; end                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output.Append( &quot; | &quot; )                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if items.HasNext:                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output.Append( paginationHelper.CreatePageLink( items.NextIndex, &quot;next&quot;,htmlAttributes, querySting ) )                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; else:                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output.Append( &quot;next&quot; )                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; end                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output.Append(&#xA0; &quot; | &quot; )                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if items.HasLast:                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output.Append(&#xA0; paginationHelper.CreatePageLink( items.LastIndex, &quot;last&quot;,htmlAttributes, querySting ) )                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; else:                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output.Append(&#xA0; &quot;last&quot; )                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; end                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output.Append( &quot;&quot;&quot;&lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/table&gt;                        &lt;/div&gt;&quot;&quot;&quot;)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return output.ToString()                        end         This looks like a lot of code, but it isn&#x27;t doing much, actually. Just outputing the pagination html. Notice that we can specify the query string and the html attributes. Now, we can just append this at the bottom of the views:             &lt;?brail                                 output Pagination( PaginationHelper, messages, null, { &quot;forumId&quot; : forumId} )                                 ?&gt;         Now run the tests, assure that they are passing, and then browse to the site and see what your easy work has gained you :-) I&#x27;m not going to write more tests, by this time, you should be able to do this yourself, and they clutter the tutorial. By this point, I think that I have shown how easy it is to write tests for MonoRail.     Now that we have a way of showing the forum&#x27;s messages, we can add a link from the home page to the forum&#x27;s page, and then we are done with the first scenario, this can be done as simply as:             &lt;li&gt;${forum.Id} - &lt;a href=&quot;/forum/${forum.Id}/index.rails&quot;&gt;${forum.Name}&lt;/a&gt;         Now we finished with the first scenario, the second one calls for a text box that allows a quick access to the forum&#x27;s page by its id. It turns out that we have to change only the view to make this happen, just adding this to /home/index.boo:             &lt;div style=&quot;text-align: right;&quot;&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;form action=&quot;/forum/index.rails&quot;&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Go to forum #                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;input type=&quot;text&quot;&#xA0;name=&quot;forumId&quot;/&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;input type=&quot;submit&quot; value=&quot;Go!&quot;/&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/form&gt;                        &lt;/div&gt;         How this works? Remember that the ForumController.Index() method accept an integer? This simply sends it to it. MonoRail doesn&#x27;t care if how we pass the value, it does the Right Thing :-D     But, this raise the question of input validation. We now have input from the user, and they are very good in putting the wrong data just to spite me.     Looking at this, I can see three edge-cases:             Entering an id that doesn&#x27;t belong to a forum.                 Not entering anything.                 Entering a non-numeric value.         Let us protect ourself from the first case:             public void Index(int forumId)                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Forum forum = Forum.TryFind(forumId);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if(forum==null)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; PropertyBag[&quot;ForumId&quot;] = forumId;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; RenderView(&quot;NoSuchForum&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; string paginationCacheKey = string.Format(&quot;forum.{0}.messages&quot;, forumId);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; DataObtentionDelegate getMessageForForum = delegate                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return Message.FindAll(Expression.Eq(&quot;Forum&quot;, forum), Expression.IsNull(&quot;RootParent&quot;));                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; };                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; IPaginatedPage cachedPagination = PaginationHelper.CreateCachedPagination(paginationCacheKey,10,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; getMessageForForum);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; PropertyBag[&quot;messages&quot;] =&#xA0; cachedPagination;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Flash[&quot;messages.TotalItems&quot;] = cachedPagination.TotalItems;                        }         We simply add a check to ensure that the forum exists. In both cases, we show a view that simply says: (Views\Forum\NoSuchForum.boo)             &lt;h2&gt;No Such Forum&lt;/h2&gt;                        &lt;p&gt;                        Could not find a forum with id ${ForumId}                        &lt;/p&gt;         This still doesn&#x27;t handle the last case, where the user pass a non-numeric data. How would we handle this? We can try to catch an error from the framework when it is trying to convert the value to integer, and handle that, but that is not an elegant solution in my opinion. A much more elegant solution is to think about it this way, an invalid integer value is a string, and MonoRail actually supports overloading, so... here is how we handle the other two cases:             public void Index(string forumId)                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (string.IsNullOrEmpty(forumId))                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; PropertyBag[&quot;ForumId&quot;] = &quot;null / empty&quot;;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; else                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; PropertyBag[&quot;ForumId&quot;] = forumId;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; RenderView(&quot;NoSuchForum&quot;);                        }         Now MonoRail will do the right thing, and call our Index(int) if the value can be converted to integer, and call Index(string) if it can&#x27;t. We moved our error handling outside the method, not it is much easier to read and work with. Also, we are reusing the UI, the NoSuchForum view is being used by two actions on the controller. That is something that is usually harder to do (in terms of the setup require to make the code reusable), isn&#x27;t it? A word of caution, this behavior is currently dependant on source code orderring, which I consider a bug. This mean that the Index(int) method should come before Index(string) method for it to be considered.     Forth scenario, we need to be able to add messages to a forum. Let us extend the forum/index view to handle this. I think that I want to use a drop of ajax for this, so we need to add this to Views\Layouts\default.boo, somewhere on the &lt;head&gt;:              ${AjaxHelper.GetJavascriptFunctions()}             This makes sure that prototype&#xA0;is setup appropriately. Now, we can just append this at the end:             &lt;p&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ${ AjaxHelper.LinkToFunction(&#x27;Post new message...&#x27;, &#x27;$(newMsg).toggle()&#x27;) }                        &lt;/p&gt;                        &lt;div id=&quot;newMsg&quot;&#xA0; class=&quot;postNewMsg&quot; style=&quot;display: none;&quot;&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;form method=&quot;POST&quot;&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;table&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;Title:&lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;&lt;input name=&quot;msg.Title&quot; type=&quot;text&quot;/&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;Author Id:&lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;&lt;input name=&quot;msg.Author.Id&quot; type=&quot;text&quot;/&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;Content:&lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;&lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td colspan=&quot;2&quot;&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;textarea name=&quot;msg.Content&quot; rows=&quot;10&quot; cols=&quot;50&quot;&gt;&lt;/textarea&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/table&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;input type=&quot;submit&quot; value=&quot;Post new message&quot;/&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/form&gt;                        &lt;/div&gt;                         This just add a link that when press, will show the add new post form. I am asking the user for its ID, and that isn&#x27;t really nice, but I don&#x27;t want to get into authentication, that is not the purpose of this post. Here is the code that handles the actual saving of the message:             public void PostMsg([DataBind(&quot;msg&quot;)] Message msg)                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; msg.Create();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; string paginationCacheKey = string.Format(&quot;forum.{0}.messages&quot;, msg.Forum.Id);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Context.Cache.Remove(paginationCacheKey);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CancelView();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Response.Redirect(string.Format(&quot;/Forum/Index.rails?forumId={0}&quot;, msg.Forum.Id));                        }                         How did it do that? I hear you asking. Well, it is utilizing a very smart behavior on the side of MonoRail. If you look closely, you&#x27;ll notice that I naming the input fields in the form (and the query string) with an object notation. &quot;msg.Forum.Id&quot;, for instnace. Then, all I need to do is to tell MonoRail how it show build this type for me. Note that you do need to ensure that the values are correct. Trying to input &quot;abc&quot; in the Author Id will fail, but those checks are fairly easy to do. And it puts you on the &quot;we can see the results&quot; path a lot quicker.     After creating the new message, I clear the cache for this forum, and redirect to the main page. So, we have only two more scenarios to go (That is assuming that you are still reading this, of course).     Let us start by showing how we can display hierarchical data. We need to get all the root messages, and all their children, and so on. But right now we don&#x27;t have a way to get from a Message to its children, or from a root message to all its hierarchy. Seems like we have a problem in the model (let us call a meeting).     After thinking about it, I decided that the following properties need to be added:             [HasMany(typeof(Message), &quot;Parent&quot;, &quot;Message&quot;)]                        public ISet Children                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return children; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { children = value; }                        }                                &#xA0;                        [HasMany(typeof(Message), &quot;RootParent&quot;, &quot;Message&quot;)]                        public ISet Hierarchy                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return hierarchy; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { hierarchy = value; }                        }                         And, the Parent needs to be modified slightly:            [BelongsTo]                        public Message Parent                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return parent; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; parent = value;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if(parent==null)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; RootParent = parent.RootParent ?? parent;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        }                        This is done to ensure that the RootParent is set properly in databinding scenarios. Now we can build the controller&#x27;s action:            public void MessageDetails(int messageId)                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SimpleQuery&lt;Message&gt; simpleQuery = new SimpleQuery&lt;Message&gt;(                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; @&quot;from Message msg left join fetch msg.Hierarchy where msg.Id = ?&quot;,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; messageId);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message[] messages = simpleQuery.Execute();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if(messages.Length==0)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; PropertyBag[&quot;MessageId&quot;] = messageId;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; RenderView(&quot;NoSuchMsg&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; PropertyBag[&quot;message&quot;] = messages[0];                        }                        Now you may begin to see what is the value in the RootParent, it allows us to pull all the message hierarchy efficently. We get it from the database, check that the value exists in the database, and then populate the PropertyBag with the value. Now, to the view, which is a little complicated:            &lt;?brail                                 import System.Text                        import System.Collections                                &#xA0;                        def Messages(messages as ICollection):                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output &quot;&lt;ul&gt;&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; for msg in messages:                        ?&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;li&gt;Title: ${msg.Title}&lt;br/&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Author:&#xA0; ${msg.Author.Name}&lt;br/&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ${msg.Content}&lt;/li&gt;&lt;br/&gt;&quot;&quot;&quot;                                &#xA0;                        &lt;?brail output AjaxHelper.LinkToFunction(&#x27;Post reply...&#x27;, &quot;$(&#x27;newMsg.${msg.Id}&#x27;).toggle()&quot;) ?&gt;                        &lt;div id=&quot;newMsg.${msg.Id}&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; class=&quot;postNewMsg&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; style=&quot;display: none;&quot;&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;form method=&quot;POST&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;action=&quot;/forum/postMsg.rails?msg.Forum.Id=${message.Forum.Id}&amp;msg.Parent.Id=${msg.Id}&quot;&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;table&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;Title:&lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;&lt;input name=&quot;msg.Title&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; type=&quot;text&quot;/&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;Author Id:&lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;&lt;input name=&quot;msg.Author.Id&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; type=&quot;text&quot;/&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;Content:&lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td&gt;&lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;td colspan=&quot;2&quot;&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;textarea name=&quot;msg.Content&quot; rows=&quot;10&quot; cols=&quot;50&quot;&gt;&lt;/textarea&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/td&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/tr&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/table&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;input type=&quot;submit&quot; value=&quot;Post new message&quot;/&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/form&gt;                        &lt;/div&gt;                        &lt;?brail                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if msg.Children.Count &gt;0:                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Messages(msg.Children)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; end                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; end                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output &quot;&lt;/ul&gt;&quot;                        end                        ?&gt;                        &lt;h2&gt;Message ${message.Id}&lt;/h2&gt;                        Title: ${message.Title}&lt;br/&gt;                        Author:&#xA0; ${message.Author.Name}&lt;br/&gt;                        ${message.Content}                                &#xA0;                        &lt;?brail&#xA0; Messages( message.Children ) ?&gt;                        Most of this is HTML, though. What is happening is that we output the first message, and then recursively all its children, with a reply link that will open in place. This seems to the end of it, we have finished implementing all the scenarios.Wow, that took a lot of time to write. I usually manage to finish those in a few hours, but this took several days. I hope that I managed to show you a bit of how you can use Castle to make your life easier.This is not a real application, it is not even a pretty demo. I focused mainly on try to shed some light into what Castle can do for you. Of the top of my head, this application need&#xA0;a lot more UI, a bit more error handling, but seems to be it.It is already well structured and it is well tested. Very good points to start with. :-)</p>
        </article>
        <article id="article-8422">
            <a href="https://ayende.com/blog/1844/what-i-find-exciting-part-ii" target="_blank">
                <h2 class="title mb-6" id="article-8422">What I find exciting, part II</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 04, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am not sure if I should feel this way, but I just finished writing a paged table in MonoRail, and that brought a complete sense of satisfaction. No, it isn&#x27;t a major techincal challange. :-) It is just that I know,all the up and all the way down, what is going on, and I wholly approve. More and more I find how important it is to control as much as possible of the stack as possible.    If I try to constract the code required to handle the full &quot;get from the database, show paged view on form&quot; functionaly in ASP.Net WebForms &#x2B; DataSet (the &quot;default&quot; ASP.Net architecture) vs. MonoRail &#x2B; Active Record, I find that I get about the same line count, but the functionality offered is greater (custom paging doesn&#x27;t require a chicken, for instnace), and there isn&#x27;t magic stuff going on that I can&#x27;t get into (view state, data binding).    The amount of flexibility that I have when working with the MR &#x2B; AR stack is far greater. Moreover, I find that I don&#x27;t feel that I am hacking when I am using MonoRail. All too often I need to do something a bit out of line in WebForms, and then I find that I need to write hackish code (e.Cells[12].FindControl(&quot;lnkDelete&quot;).Enabled = UserHasPermission; is hackish, and not maintainable).    The mere fact that I can look at code that does paging and say: &quot;You know, this is really cool.&quot; speaks for itself, I think.</p>
        </article>
        <article id="article-8423">
            <a href="https://ayende.com/blog/1843/brail-code-formatting" target="_blank">
                <h2 class="title mb-6" id="article-8423">Brail Code Formatting</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 03, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I mentioned before that I tend to edit Brail&#x27;s source in #Develop, since it has native support for Boo. I finally decided that just using Boo&#x27;s color scheme is not enough, and created one specific for Brail.This scheme is merely HTML &#x2B; Boo, where code sections are marked with &lt;?brail ?&gt;The coloring schema is attached to this message.Brail.zip (3.53 KB)Now if only it were as simple to do this for Visual Studio....</p>
        </article>
        <article id="article-8424">
            <a href="https://ayende.com/blog/1842/nine-things-developers-want-more-than-money" target="_blank">
                <h2 class="title mb-6" id="article-8424">Nine Things Developers Want More Than Money</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 03, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This&#xA0;is a great list. Rob manages to score with each and every point. (Check the rest of the posts as well, it is interesting, although I strongly disagree with some of the stuff that he is saying).    What really interested me was point 7, &quot;Building Something That Matters&quot;. Rob gives several examples, all of them different. I got a system in production that moves money around, it doesn&#x27;t really matters to me. Being able to use NQG&#x27;s queries does.    What excites you as a developer?</p>
        </article>
        <article id="article-8425">
            <a href="https://ardalis.com/csmodules-added/" target="_blank">
                <h2 class="title mb-6" id="article-8425">CSModules Added</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 02, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x2019;ve added the MetaBlogExtender and ShareIt modules from ScottW&#x2019;s CSModules pack. Let me know if you have any other requests for modules or&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-8426">
            <a href="https://ardalis.com/excel-pivot-chart-from-reporting-services-video/" target="_blank">
                <h2 class="title mb-6" id="article-8426">Excel Pivot Chart from Reporting Services Video</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 02, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Last week I wrote about some fun I was having with Pivot Tables and Pivot Charts in Excel. Well, yesterday I got around to recording a&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-8427">
            <a href="https://ayende.com/blog/1841/open-patches-for-visual-studio" target="_blank">
                <h2 class="title mb-6" id="article-8427">Open Patches For Visual Studio</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 02, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In a step in the right direction, you can now download a few patches for Visual Studio and .Net without calling PSS first.    Details and patches are here.    Sadly, there is not yet a patch for &quot;Visual Studio is too slow&quot;. :-)</p>
        </article>
        <article id="article-8428">
            <a href="https://ayende.com/blog/1840/web-message-box" target="_blank">
                <h2 class="title mb-6" id="article-8428">Web Message Box</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 02, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is probably a really bad idea, but here it is:            public class WebMsgBox                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public static void Show(string msg)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if(HttpContext.Current==null &amp;&amp; HttpContext.Current.Handler is Page)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Page currentPage = (Page) HttpContext.Current.Handler;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; currentPage.ClientScript                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; .RegisterStartupScript(currentPage.GetType(),&quot;msgBox&quot;,                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;string.Format(&quot;alert(&#x27;{0}&#x27;);&quot;, msg.Replace(&quot;&#x27;&quot;,&quot;\\&#x27;&quot;)),                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; true);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        }                It can be called from anywhere in the code, not just from a page.</p>
        </article>
        <article id="article-8429">
            <a href="https://ayende.com/blog/1839/what-should-i-use-nhiberante-or-active-record" target="_blank">
                <h2 class="title mb-6" id="article-8429">What should I use, NHiberante or Active Record?!</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 02, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I was asked this several times lately, and it is time to try to make a more coherent statement about my thought in this matter.    Active Record is a wrapper around NHibernate, which aims to make it easier to work with. The main benefit, in my opinon, is the time it takes to get a working entity from each.    In NHibernate, you need to create the XML file (sorry Pierre, if I write attributes, they are the ActiveRecord ones :-) ), which can take more time than just slapping an attribute on a property and be done with it. Active Record does a lot to infer things for you, reducing the time required to configure the mapping.    Active Record API is also much simpler (which goes both ways), which means that the learning curve is slightly lower.    However, in order to use Active Record effectively, you should understand the way that NHibernate work. Active Record also has implications on code readability in complex scenarios, basically, once you cross the one - two lines of attributes, you start to lose readability fairly fast.    Another big issue with Active Record is that it &quot;pollute&quot; your domain objects with persistance knowledge. This can be as explicit as inheriting from ActiveRecordBase&lt;T&gt; and suddenly getting Save()/Create()/Find***() methods on the object, or as implicit as having just the attributes. Either way, your domain objects suddenly &quot;know&quot; about persistance.&#xA0;    With NHibernate, you can get a domain model where there is no reference to NHibernate at all. And for several projects, this is an important criteria. You also get a better seperation of the mapping from the objects, which is very good if you want to avoid stuff like this:[Property(&quot;FLD_G&quot;]&#xA0;public&#xA0;string&#xA0;Name&#xA0;    Which only serves to remind you what kind of&#xA0;a freak the database is underneath.    There isn&#x27;t&#xA0;that big of a difference between Active Record and NHibernate, since Active Record tries hard to ensure that there would never be a case where you are blocked from simply calling&#xA0;NHibernate if you need to. The main differences are a&#xA0;matter of taste, architecture decisions and database complexity.    Guidance:            Do: prefer to use Active Record - for simplicity and ease of use.            Do: make sure that you understand NHibernate&#x27;s Method of Operation before embarking on an important project with Active Record            Do: make use of the Queries capabilities on Active Record to utilize HQL and other important features on NHibernate.            Do not: use Active Record for legacy databases or highly unusual schemas.            Do not: use Active Record if you want your domain objects to be free of all persitance concerns.    I added the highly unusual schemas because I run into a lot of cases where the customer want to do something a bit extra. Custom user types, dynamic entities mapping, etc, which are better handled using NHibernate directly than going over Active Record.</p>
        </article>
        <article id="article-8430">
            <a href="https://ayende.com/blog/1838/building-applications-using-castle-rc2-part-i" target="_blank">
                <h2 class="title mb-6" id="article-8430">Building Applications Using Castle RC2</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 01, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Well, now that Castle RC2 is out, let us see what this release can do for us, shall we?&#xA0;After my recent talk, I got forums heavy on my mind, so let us build one.     You can get the release here. I suggest that you would get the MSI installer. After installing the MSI, open Visual Studio and create a new project, you should see this screen:          Choose Castle ActiveRecord Project and name the project &quot;Castle.Forums.Model&quot;, name the solution (last text box) &quot;Castle.Forums&quot;. Note: Despite all my recent posts about Active Record &#x2B; NHibernate 1.2 == Love (and Linq :-) ), the RC2 does not have these features, since they mostly rely on enhancements in NHibernate 1.2. Currently, we are focused on getting a stable release out of the door, and we don&#x27;t want to add NHibernate 1.2 yet. Mostly because it is a moving target and that we want to have a stable release of Active Record before chasing the rainbow over the next hill. Personally, I am using the trunk version for a lot of stuff, and I find it quite stable, but I like to live dangerously. Also, I can see the need for a feature and add it throughout the stack, which is what I am mostly doing now, seeing what new &amp; exciting places I can take Active Record &#x2B; NHibernate 1.2. Overall, I think that both frameworks benefits from this.     Here is the solution that was created:          It created a test project for us! Yay! Let us start by looking at the AbstractModelTestCase class. It basically setting up everything that we need in order to start testing.&#xA0; The only thing that we need to do here is just to modify InitFramework() method so it would include our model assembly, and only initialize once. Like this:             protected virtual void InitFramework()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if(isInitialized )                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return;                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; IConfigurationSource source = ActiveRecordSectionHandler.Instance;                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ActiveRecordStarter.Initialize(System.Reflection.Assembly.Load(&quot;Castle.Forums.Model&quot;), source);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; isInitialized = true;                        }                                &#xA0;                        protected static bool isInitialized = false;        I also had to change the connection string in the app.config, to point to &quot;test&quot; instead of &quot;mytestdatabase&quot;, which is the default. Note that you probably want to run the tests on a scratch database, since the default test behavior is to rebuild the schema at every test.    Now, let us build a list of tests that we want to have. I think that those are interesting;            Can create user (name, email, hashed password)            Can load user by name and password            Can create a forum (name, manager)            Can load list of forums            Can create a message (title, content, author, forum, parent, root)            Can load list of messages for forum.            Can load hierarchical list of the last ten root (start) messages&#xA0;for a forum.Again, a reminder, this is using NHibernate 1.0.2, so no generic collections.    Create a new file called UserTestCase and add the following:            [TestFixture]                        public class UserTestCase : AbstractModelTestCase                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 }        Now, let us start writing the real test:            [Test]                        public void Can_Create_And_Load_User_By_ID()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User user = new User(&quot;Ayende&quot;, &quot;Ayende@example.com&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; user.SetPassword(&quot;Scott/Tiger&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; user.Create();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Flush();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;CreateScope();//replace scope                        &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User userFromDb = User.Find(user.Id);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.IsFalse( ReferenceEquals(user, userFromDb), &quot;got the same instnace even though we changed scopes!&quot; );                                &#xA0;                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual( &quot;Ayende&quot;, userFromDb.Name , &quot;User name did not match&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(&quot;Ayende@example.com&quot;, userFromDb.Email, &quot;Email did not match&quot; );                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.IsTrue( user.PasswordMatch(&quot;Scott/Tiger&quot;), &quot;Password did not match&quot; );                        }        So, I had written the test, and now I know how I want my code to look. At the moment, it can&#x27;t compile, because it has no User class. Add a User class to the Castle.Forums.Model assembly. I only want to get this test to work, so here is the implementation of the User class:            [ActiveRecord(&quot;Users&quot;)]                        public class User : ActiveRecordBase&lt;User&gt;                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; int id;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; string name;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; string email;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Field]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; string hashedPassword;                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public User()                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public User(string name, string email)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.name = name;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.email = email;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [PrimaryKey]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public int Id                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return id; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { id = value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Property]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public string Name                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return name; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { name = value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Property]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public string Email                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return email; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { email = value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public void SetPassword(string password)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; hashedPassword = Hash(password);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public bool PasswordMatch(string maybePassword)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return hashedPassword == Hash(maybePassword);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public static string Hash(string value)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return value;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        }        I don&#x27;t have a test for the Hash() method yet, so I just had it return its input, now let us write a very simple test for it:            [Test]                        public void Calling_User_Hash_Get_Diffrent_Return_Value()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; string hashed = User.Hash(&quot;Scott/Tigger&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreNotEqual(&quot;Scott/Tiger&quot;, hashed, &quot;Password is the same even after hashing&quot;);                        }        This one fails, obvious, so I add the following implementation:            public static string Hash(string value)                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SHA512 hasher = SHA512.Create();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; byte[] valueBytes = Encoding.UTF8.GetBytes(value);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; byte[] hashedBytes = hasher.ComputeHash(valueBytes);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return Convert.ToBase64String(hashedBytes);                        }        Now we need to load a user by name and password, let us write the test first:            [Test]                        public void Can_Load_User_By_Name_And_Password()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User user = new User(&quot;Ayende&quot;, &quot;Ayende@example.com&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; user.SetPassword(&quot;Scott/Tiger&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; user.Create();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Flush();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CreateScope();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User userFromDb = User.FindByNameAndPassword(&quot;Ayende&quot;, &quot;Scott/Tiger&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.IsNotNull(userFromDb, &quot;Could not find user by username and password&quot;);                        }        Implementing FindByNameAndPassword...            public static User FindByNameAndPassword(string name, string password)                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; string hashedPassword = Hash(password);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return FindOne(Expression.Eq(&quot;Name&quot;, name),                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Expression.Eq(&quot;hashedPassword&quot;, hashedPassword));                        }        Looks like we are through with test for users, in a similar fashion, we are going to build the forums.    In ForumTestCase:             public override void Init()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; base.Init();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.user = new User(&quot;Ayende&quot;, &quot;Ayende@example.org&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.user.SetPassword(&quot;Scott/Tiger&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.user.Create();                        }            &#xA0;            [Test]                        public void Can_Create_And_Load_Forum()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Forum forum = new Forum(&quot;My Forum&quot;, user);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; forum.Create();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Flush();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CreateScope();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Forum forumFromDb = Forums.Find(forum.Id);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(&quot;My Forum&quot;, forumFromDb.Name, &quot;Forum name not the same&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; //note: can&#x27;t do a simple comparision because the arrive from different scopes.                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(user.Id, forum.Manager.Id, &quot;Forum manager is not the same&quot; );                        }        And the Forum class implementation:            &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 [ActiveRecord]                        public class Forum : ActiveRecordBase&lt;Forum&gt;                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; int id;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; string name;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User manager;                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public Forum()                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public Forum(string name, User manager)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.name = name;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.manager = manager;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [PrimaryKey]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public int Id                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return id; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { id = value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Property]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public string Name                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return name; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { name = value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [BelongsTo]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public User Manager                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return manager; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { manager = value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        }        Along the way, we also go the second test for free:            [Test]                        public void Can_Load_List_Of_Forums()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Forum forum = new Forum(&quot;My Forum&quot;, user);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; forum.Create();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Forum forum2 = new Forum(&quot;My Forum 2&quot;, user);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; forum2.Create();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Forum[] allForums = Forum.FindAll();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(2, allForums.Length);                        }        That is all for forums, now to messages. First, the test:            [Test]                        public void Can_Create_And_Load_Message()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message msg = new Message(&quot;Hi there&quot;, &quot;Hello World&quot;, user, forum, null);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; msg.Create();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Flush();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CreateScope();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message msgFromDb = Message.Find(msg.Id);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(&quot;Hi there&quot;, msgFromDb.Title , &quot;Could not get title&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(&quot;Hello World&quot;, msgFromDb.Content, &quot;Could not get content&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(user.Id, msg.Author.Id, &quot;Author do not match&quot; );                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(forum.Id,&#xA0; msg.Forum.Id, &quot;Forum do not match&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.IsNull(msg.Parent, &quot;Got a non null parent for a root message&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.IsNull(msg.RootParent, &quot;Got a non null root parent for a root message&quot;);                        }        Which is implemented by:            [ActiveRecord]                        public class Message : ActiveRecordBase&lt;Message&gt;                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; int id;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; string title;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; string content;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User author;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Forum forum;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message parent;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /// &lt;summary&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /// This is the first message in a discussion thread                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; /// &lt;/summary&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message rootParent;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public Message()                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public Message(string title, string content, User user, Forum forum, Message parent)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.title = title;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.content = content;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.author = user;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.forum = forum;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.parent = parent;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Property]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public string Title                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return title; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { title = value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Property]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public string Content                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return content; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { content = value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [BelongsTo]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public User Author                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return author; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { author = value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [BelongsTo]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public Forum Forum                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return forum; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { forum = value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [BelongsTo]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public Message Parent                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return parent; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { parent = value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [BelongsTo]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public Message RootParent                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return rootParent; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { rootParent = value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [PrimaryKey]                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; public int Id                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return id; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { id = value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        }        Now, I can think of two scenarios that I didn&#x27;t cover. First, the message should automatically set the root parent property if is it passed a non null parent, and it should set its root parent to the parent&#x27;s root parent if that is not empty. Here are the tests:            [Test]                        public void Ctor_Sets_Parent_And_Root_Parent_If_Not_Null()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message parent = new Message(&quot;Hi there&quot;, &quot;Hello World&quot;, user, forum, null);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message msg = new Message(&quot;Hi there&quot;, &quot;Hello World&quot;, user, forum, parent);                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(parent, msg.Parent, &quot;did not set parent correctly&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(parent, msg.RootParent, &quot;did not set root parent correctly&quot;);                        }                                &#xA0;                        [Test]                        public void Ctor_Sets_RootParent_To_Parent_Root()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message grandParent = new Message(&quot;Hi there&quot;, &quot;Hello World&quot;, user, forum, null);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message parent = new Message(&quot;Hi there&quot;, &quot;Hello World&quot;, user, forum, grandParent);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message msg = new Message(&quot;Hi there&quot;, &quot;Hello World&quot;, user, forum, parent);                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(parent, msg.Parent, &quot;did not set parent correctly&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(grandParent, msg.RootParent, &quot;did not set root parent correctly&quot;);                        }        And their implementation, which is merely this addition to the constructor:            public Message(string title, string content, User user, Forum forum, Message parent)                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.title = title;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.content = content;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.author = user;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.forum = forum;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.parent = parent;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if(parent!=null)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.rootParent = parent.RootParent ?? parent;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                 }        Now, we need to be able to load messages for a forum, let us try:            [Test]                        public void Can_Load_Messages_By_Forum()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message grandParent = new Message(&quot;Hi there&quot;, &quot;Hello World&quot;, user, forum, null);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; grandParent.Create();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message parent = new Message(&quot;Hi there&quot;, &quot;Hello World&quot;, user, forum, grandParent);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; parent.Create();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message msg = new Message(&quot;Hi there&quot;, &quot;Hello World&quot;, user, forum, parent);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; msg.Create();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Flush();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message[] messages = Message.FindAllByForum(forum);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(3, messages.Length );                        }        And its implementation:            public static Message[] FindAllByForum(Forum forum)                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return FindAll(Expression.Eq(&quot;Forum&quot;, forum));                        }        Now we only have to handle of finding all the last root messages in a forum:            [Test]                        public void Can_Load_Last_Ten_Root_Messages()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CreateNestedMessages();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Flush();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CreateScope();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message[] message = Message.FindLastRootsByForum(forum, 10);                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(10, message.Length);                        }                     private void CreateNestedMessages()                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; for (int i = 0; i &lt; 12; i&#x2B;&#x2B;)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message grandParent = new Message(&quot;Hi there&quot;, &quot;Hello World&quot;, user, forum, null);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; grandParent.Create();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; for (int j = 0; j &lt; 2; j&#x2B;&#x2B;)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message parent = new Message(&quot;Hi there&quot;, &quot;Hello World&quot;, user, forum, grandParent);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; parent.Create();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; for (int k = 0; k &lt; 1; k&#x2B;&#x2B;)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Message msg = new Message(&quot;Hi there&quot;, &quot;Hello World&quot;, user, forum, parent);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; msg.Create();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        }        The implementation is ridiciously short, actually:            public static Message[] FindLastRootsByForum(Forum forum, int count)                        {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return SlicedFindAll(0, count,                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Expression.IsNull(&quot;RootParent&quot;),                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Expression.Eq(&quot;Forum&quot;, forum));                        }        This is it! We now have ten tests, and a working domain model we can start using. A couple of things before we continue:            We dealt 99% of the time with tests / code            Except for the connection string, there was no need to handle configuration / references and other stuff that always clutter this examples.    Now, we want to create a the UI. For this, please create a new Castle MonoRail Project, and name it Castle.Forums.Web, you should then see the following dialog:        Choose Brail (of course :-) ) and enable routing, we will use this a bit later, but let us be prepared. We don&#x27;t need Windsor intergration, since this is a very small project. Admire the artwork for a while before pressing next.        I don&#x27;t really need to tell you that you are going to create a test project, right? Click finish and let us take a look at the projects that were created.        Notice how structured this is? We already have the foundations of creating something really nice. Set the Castle.Forums.Web project to the startup project and run it. The ASP.Net Development Server will open, and you will see the boring default page.    I need to be able to work with users (since they are mandatory for everything else), but I don&#x27;t want to invest any time in it at the moment. Let us just setup scaffolding. Here we need to do a bit of manual work:    Add the following references (all exist in the .NET tab in the Add References dialog) to the Castle.Forums.Web:            Castle.ActiveRecord            Castle.Components.Common.TemplateEngine            Castle.Components.Common.TemplateEngine.NVelocityTemplateEngine            Castle.MonoRail.ActiveRecordScaffold            Castle.MonoRail.ActiveRecordSupport            NHibernate    Now, add this to the &lt;configSection&gt; part in the web.config file:            &lt;section name=&quot;activerecord&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;type=&quot;Castle.ActiveRecord.Framework.Config.ActiveRecordSectionHandler, Castle.ActiveRecord&quot; /&gt;        And then add this at the bottom of the file:            &lt;!-- For the configuration reference, check --&gt;                        &lt;!-- http://www.castleproject.org/index.php/ActiveRecord:Configuration_Reference --&gt;                        &lt;activerecord isWeb=&quot;true&quot;&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;!-- The configuration below is good enough for MS SQL Server only --&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;!-- Remember that you should use a test database, never use development or production --&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;config&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;add key=&quot;hibernate.connection.driver_class&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;value=&quot;NHibernate.Driver.SqlClientDriver&quot; /&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;add key=&quot;hibernate.dialect&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;value=&quot;NHibernate.Dialect.MsSql2000Dialect&quot; /&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;add key=&quot;hibernate.connection.provider&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;value=&quot;NHibernate.Connection.DriverConnectionProvider&quot; /&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;add key=&quot;hibernate.connection.connection_string&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;value=&quot;Data Source=.;Initial Catalog=test;Integrated Security=SSPI&quot; /&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;/config&gt;                        &lt;/activerecord&gt;        Now, go to the GlobalApplication.cs file and add the following to the Application_OnStart method:            IConfigurationSource source = ActiveRecordSectionHandler.Instance;                                &#xA0;                        ActiveRecordStarter.Initialize(System.Reflection.Assembly.Load(&quot;Castle.Forums.Model&quot;), source);                                &#xA0;                        ActiveRecordStarter.CreateSchema();        Please note that the last line here will rebuild the database everytime that the application starts. This is great for testing / development, not so great if you are going to production, be aware of this.    We need to add a controller for the users, we will call it UserController and it looks like this:            [Layout(&quot;default&quot;), Rescue(&quot;generalerror&quot;), Scaffolding(typeof(User))]                        public class UserController : Controller                                 {                        }        Now that we have everything setup the way we want to, run the project, and then change the url from &quot;/home/index.rails&quot; to &quot;/user/list.rails&quot;, you should see the following:        It is not pretty, but it is functional, and it allows us to immediately start working with the data. Tomorrow, I&#x27;ll post part II, and I&#x27;ll try to discover how one can TDD a web application using MonoRail.</p>
        </article>
        <div class="button flex justify-between">
            <a href="842.html"><span class="back arrow"></span></a>

            <a href="844.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>