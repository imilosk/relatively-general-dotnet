
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 610 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-6091">
            <a href="https://ayende.com/blog/3963/buying-the-pot-as-a-way-of-winning-the-database-wars" target="_blank">
                <h2 class="title mb-6" id="article-6091">Buying the pot as a way of winning the database wars?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 20, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The news are just out, Oracle is buying Sun.  This is especially interesting since Oracle has previously bought InnoDB (a key component for MySQL in the enterprise) and Sun has bought MySQL. This means that, off the top of my head, Oracle is now the owner of the following database products:     Oracle DB    BerkleyDB    MySQL &amp; InnoDB   I am pretty sure that they have others, but even so, that is quite a respectable list, I should think.  Of course, with Sun, Oracle is also getting Java&#x2026;</p>
        </article>
        <article id="article-6092">
            <a href="https://ayende.com/blog/3962/where-is-the-roi" target="_blank">
                <h2 class="title mb-6" id="article-6092">Where is the ROI?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 20, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Justin has a post called: Keep your IQueryable in check, in which he basically says that while he finds value in the Query Object pattern that I recently talked about, he is concerned by the fact that I am returning an IQueryable (or ICriteria or IQuery) from the query object. The problem is that the UI layer can then modify the query in potentially undesirable ways. The example that he gave is:     latePayingCustomQuery  &#xA;  .Where(c =&gt; c.LastName.StartsWith(&quot;E&quot;))  &#xA;  .Skip((page - 1) * itemCount)  &#xA;  .Take(10);  &#xA;&#xA;&#xA;Which perform a query on an unindex string column, which is slow.&#xA;&#xA;He suggests limiting what the user can do by providing a IPagable &amp;&amp; ISortable that would limit the options of the UI layer to abuse it.&#xA;&#xA;My response to that is: And&#x2026;?&#xA;&#xA;I am not in favor of doing things to protect developers, but there is also another side to that. &#xA;&#xA;What is the worst thing that can possibly happen? That part of the application would be slow. We will find it during testing, or (heaven forbid), on production. &#xA;&#xA;And&#x2026;?&#xA;&#xA;How is this in any way different than anything else that we are doing? Presumably the developer who wrote the code didn&#x2019;t wrote it just because he felt like it, there was a business reason behind it. At that point, we treat this issue as a standard perf issue, and fix it.&#xA;&#xA;The cost of doing that in the rare cases where it will happen vs. the cost of creating the limited abstraction, forcing developers to deal with that, etc. More than that, I can assure you that you will need to break out of the straightjacket at some point, why put it on in the first place?&#xA;&#xA;This is a question that I routinely ask my clients. Why do you want that? &#x201C;To stop developers from&#x2026;&#x201D;&#xA;&#xA;To which I reply: &#x201C;What is the cost of doing it this way? What is the cost of a mistake? What is the cost of fixing that mistake? What is the difference between that and just another bug?&#x201D; &#xA;&#xA;There is a reason that I choose the ALT.Net logo to be running with scissors. Power tools are here to be used. Yes, there are things that you want to hide, but those are by far the exception, not the norm.</p>
        </article>
        <article id="article-6093">
            <a href="https://ayende.com/blog/3961/nhibernate-mapping-join" target="_blank">
                <h2 class="title mb-6" id="article-6093">NHibernate Mapping - &lt;join/&gt;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 20, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We have previously explored the one-to-one mapping, which let you create 1:1 association in the database, but there is actually another way to map several tables to an object model. We aren&#x2019;t constrained by the database model, and we can merge several tables into a single entity.   We do that using the &lt;join/&gt; element:     &lt;join&#xA;        table=&quot;tablename&quot;                        (1)&#xA;        schema=&quot;owner&quot;                           (2)&#xA;        catalog=&quot;catalog&quot;                        (3)&#xA;        fetch=&quot;join|select&quot;                      (4)&#xA;        inverse=&quot;true|false&quot;                     (5)&#xA;        optional=&quot;true|false&quot;&gt;                   (6)&#xA;&#xA;        &lt;key ... /&gt;&#xA;&#xA;        &lt;property ... /&gt;&#xA;        ...&#xA;&lt;/join&gt;&#xA;&#xA;&#xA;Let us explore this a bit, assuming the we have the following database model:&quot;&#xA;&#xA; &#xA;&#xA;And what we want is to map this to the following object model:&#xA;&#xA; &#xA;&#xA;We can do this will the following mapping:&#xA;&#xA;&#xA;  &lt;class name=&quot;Person&quot;&#xA;&#x9; table=&quot;People&quot;&gt;&#xA;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;identity&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;property name=&quot;Name&quot; /&gt;&#xA;&#xA;&#x9;&lt;join table=&quot;Addresses&quot;&gt;&#xA;&#x9;&#x9;&lt;key column=&quot;PersonId&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;Line1&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;Line2&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;City&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;Country&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;ZipCode&quot;/&gt;&#xA;&#x9;&lt;/join&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&#xA;And getting a Person will now result in the following SQL:&#xA;&#xA; &#xA;&#xA;NHibernate will now take care of mapping everything to its place, and making sure that everything works just right.&#xA;&#xA;By now you should be able to figure out what fetch means, and inverse should also be familiar. Optional is interesting, what is basically says is that we should always use an outer join to get the values from the Addresses table and if all the mapped properties are null, it wouldn&#x2019;t create a new row in the Addresses table.&#xA;&#xA;On the face of it, it looks like a nice way to merge tables together, but that isn&#x2019;t actually the primary reason for this feature. You can use it for that, for sure, but that is mostly useful in legacy databases. In most cases, your object model should be more granular than the database model, not the other way around.&#xA;&#xA;The really interesting part about this feature is that it allows us to mix &amp; match inheritance strategies. It let us create a table per hierarchy that store all the extra fields on another table, for example. That significantly reduce the disadvantage of using a table per hierarchy or table per subclass, since we can tell very easily what is the type of the class that we are using, and act appropriately.</p>
        </article>
        <article id="article-6094">
            <a href="https://ardalis.com/space-coast-asp-net-mvc-and-solid-principles-talk/" target="_blank">
                <h2 class="title mb-6" id="article-6094">Space Coast ASP.NET MVC and SOLID Principles Talk</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 19, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Last week I visited the Space Coast .NET user group in Florida (courtesy of INETA) to talk about ASP.NET MVC and SOLID software development&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-6095">
            <a href="https://ayende.com/blog/3960/nhibernate-mapping-one-to-one" target="_blank">
                <h2 class="title mb-6" id="article-6095">NHibernate Mapping - &lt;one-to-one/&gt;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 19, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In the database world, we have three kind of associations: 1:m, m:1, m:n.  However, occasionally we want to have a one to one relationship. We could simulate it easily enough on the database side using two many to one relations, but that would require us to add the association column to both tables, and things gets&#x2026; tricky when it comes the time to insert or update to the database, because of the cycle that this creates.  NHibernate solves the problem by introducing a one-to-one mapping association, which allow you to define the two relationships based on a single column in the database, which controls the two way association.     &lt;one-to-one&#xA;        name=&quot;PropertyName&quot;                                (1)&#xA;        class=&quot;ClassName&quot;                                  (2)&#xA;        cascade=&quot;all|none|save-update|delete&quot;              (3)&#xA;        constrained=&quot;true|false&quot;                           (4)&#xA;        fetch=&quot;join|select&quot;                                (5)&#xA;        property-ref=&quot;PropertyNameFromAssociatedClass&quot;     (6)&#xA;        access=&quot;field|property|nosetter|ClassName&quot;         (7)&#xA;/&gt;&#xA;&#xA;&#xA;1, 2, 3, 6, 7 were all discussed elsewhere, so I&#x2019;ll skip them and move directly to showing how this can be used.&#xA;&#xA;We have the follow object model:&#xA;&#xA; &#xA;&#xA;And the database model:&#xA;&#xA; &#xA;&#xA;&#xA;&#xA;Note that while in the object model we have a bidirectional mapping, in the database we have only a single reference on the employees table. In the relational model, all associations are naturally bidirectional, but that is not true on the object model. In order to bridge this inconsistency, we map them as:&#xA;&#xA;&#xA;  &lt;class name=&quot;Employee&quot;&#xA;&#x9;&#x9;table=&quot;Employees&quot;&gt;&#xA;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;native&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&#xA;&#x9;&lt;property name=&quot;Role&quot;/&gt;&#xA;&#xA;&#x9;&lt;many-to-one name=&quot;Person&quot;&#xA;&#x9;&#x9;unique=&quot;true&quot;&#xA;&#x9;&#x9;column=&quot;Person&quot;/&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&lt;class name=&quot;Person&quot;&#xA;&#x9;&#x9;table=&quot;People&quot;&gt;&#xA;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;native&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;property name=&quot;Name&quot; /&gt;&#xA;&#x9;&lt;one-to-one name=&quot;Employee&quot;&#xA;&#x9;&#x9;&#x9;class=&quot;Employee&quot;/&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&#xA;We have a unique many-to-one association from Employee to Person, but a one to one from Person to Employee. This will reuse the many-to-one association defined in the Employee mapping.&#xA;&#xA;Let see how this works for saving and loading the data:&#xA;&#xA;&#xA;  using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var person = new Person&#xA;&#x9;{&#xA;&#x9;&#x9;Name = &quot;test&quot;,&#xA;&#x9;};&#xA;&#x9;var employee = new Employee&#xA;&#x9;{&#xA;&#x9;&#x9;Person = person,&#xA;&#x9;&#x9;Role = &quot;Manager&quot;&#xA;&#x9;};&#xA;&#x9;person.Employee = employee;        session.Save(person);        session.Save(employee);&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;// person to employee&#xA;using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var employee = session.Get&lt;Person&gt;(1).Employee;&#xA;&#x9;Console.WriteLine(employee.Role);&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;// employee to person&#xA;using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var person = session.Get&lt;Employee&gt;(1).Person;&#xA;&#x9;Console.WriteLine(person.Name);&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;And the SQL that would be generated would be:&#xA;&#xA; &#xA;&#xA;This is quite interesting. We can see that we insert the entities as we expect, but when we pull a person out, we do a join to the employee, to get the one-to-one association. For that matter, even in the second scenario, we do a join to get the associated employee.&#xA;&#xA;The reason that we have to do it is quite interesting as well. NHibernate makes some guarantees about the way the object model and the database model map to one another. And one of those guarantees is that if there is no association in the database, we will get back a null in the object model.&#xA;&#xA;Generally, this works very well, since we can tell whatever an association exists or not using the value in the table (for many-to-one associations). But for one-to-one association, if we want to keep this guarantee, we have to check the associated table to verify if we need to have a null or a proxy there. That is somewhat annoying, but we can get around that by specifying constrained=&#x201D;true&#x201D;. This tell NHibernate that in this case, whenever there is a Person, there must also be a matching Employee value. We can specify it like this:&#xA;&#xA;&#xA;  &lt;one-to-one name=&quot;Employee&quot; &#xA;&#x9;constrained=&quot;true&quot;&#xA;&#x9;foreign-key=&quot;none&quot;&#xA;&#x9;class=&quot;Employee&quot;/&gt;&#xA;&#xA;&#xA;Something else to note is that we must specify this with foreign-key=&#x201D;none&#x201D;, because otherwise NHibernate&#x2019;s Schema Export feature would create two foreign keys for us, which would create a circular reference that wouldn&#x2019;t allow us to insert anything into the database.&#xA;&#xA;When setting this, we can see that there is a dramatic change in NHibernate&#x2019;s behavior:&#xA;&#xA; &#xA;&#xA;Instead of generating joins, NHibernate now uses standard selects to get the data. And we don&#x2019;t have to pre-populate the information on loading the entity, we can delay that as we usually do with NHibernate.&#xA;&#xA;And the last thing that we will explore for &lt;one-to-one/&gt; is the fetch attribute. It defaults to select, so we have already seen how that works, but when we set fetch=&#x201D;join&#x201D;, we get an interesting flashback. Well, almost:&#xA;&#xA; &#xA;&#xA;Again, we use a join to get the value upfront, but since we are now using constrained=&#x201D;true&#x201D;, we can use an inner join instead of a left outer join, which is more efficient in most cases.</p>
        </article>
        <article id="article-6096">
            <a href="https://ayende.com/blog/3959/how-microsoft-should-release-guidance" target="_blank">
                <h2 class="title mb-6" id="article-6096">How Microsoft should release guidance?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 18, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Phil Haack has a post about code sample taxonomy, in which he asks how Microsoft can ship high quality sample apps:     Obviously, this [shipping high quality samples] is what we should be striving for, but what do we do in the meantime? Stop shipping samples? I hope not.    Again, I don&#x2019;t claim to have the answers, but I think there are a few things that could help. One twitter response made a great point:         a reference app is going to be grilled. Even more if it comes from the mothership. Get the community involved *before* it gets pub       Getting the community involved is a great means of having your code reviewed to make sure you&#x2019;re not doing anything obviously stupid. Of course, even in this, there&#x2019;s a challenge. Jeremy Miller made this great point recently:         We don&#x27;t have our own story straight yet.&#xA0; We&#x27;re still advancing our craft.&#xA0; By no means have we reached some sort of omega point in our own development efforts.&#xA0;        In other words, even with community involvement, you&#x2019;re probably going to piss someone off.   Um, no.  I feel that Jeremy&#x2019;s point has been pulled out of context. While we may have disagreements about what constitute the future directions in software development, that isn&#x2019;t actually what cause the community to reject the bad samples from Microsoft.  No one said a word about Kobe because it didn&#x2019;t use NHibernate, or wasn&#x2019;t built with messaging or using DDD.  What we reject in those sample app is that they are, put simply, bad coding. There is nothing amorphous about this, we aren&#x2019;t talking about subjective feeling, we are talking about very concrete, objective and real metrics that we can apply.     Bad Code   Not some omega point.     Bad Code   Not lack of understanding of the platform because the developers writing that were new to ASP.Net MVC.     Bad Code   That would have been bad code if it was written 5 years ago or 15 years ago.  That is the problem.  And I think that there is quite a simple answer for that. Stop shipping official guidance package without involvement from the community.  Create a special CodePlex project where you are being explicit about putting things for review, not for publishing. After the guidance has been published, it is probably too late already.   Get some feedback from the community, then you can publish this in the usual places.</p>
        </article>
        <article id="article-6097">
            <a href="https://ayende.com/blog/3958/the-dal-should-go-all-the-way-to-ui" target="_blank">
                <h2 class="title mb-6" id="article-6097">The DAL should go all the way to UI</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 18, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">My recent post caused quite a few comments, many of them about two major topics. The first is the mockability of my approach and the second is regarding the separation of layers. This post is about the second concern.   A typical application architecture usually looks like this:     &#xA0;  This venerable structure is almost sacred for many people. It is also, incidentally, wrong.  The main problem is that the data access concerns don&#x2019;t end up in the business layer. There are presentation concerns that affect that as well. Let us take a look at a common example. I want to show the invoices for a user:     Given that requirement, I quickly build my interface, implement it and throw it over the wall to the UI team to deal with it*.  Here is the interface that I came up with:     GetInvoicesForUser(userId)   Great, isn&#x2019;t it? It satisfy all the business requirements that I have.  Except, my UI can&#x2019;t actually work with this. We have to have paging there as well, and the only way to do paging using this API is to do that on the client side, which is probably bad. I grumble a little bit but change the interface to:     GetInvoicesForUser(userId, pageNum, pageSize)   Done, right?  Well, not really. I have a new UI requirement now, the user want to be able to sort the grid by any column. Now I grumble even more, because this is harder, but I create the following interface:     GetInvoicesForUser(userId, pageNum, pageSize, orderByCol, orderByDesc)   And then they want to order by multiple columns, and then they&#x2026;  Do you notice a theme here? A lot of the data access concerns that I have are not actually concerns that the layer above me has, they are one layer removed.   But there is a more important problem here, I am violating (repeatedly) the Open Closed Principle. As a reminder:     software entities (classes, modules, functions, etc.) should be open for extension, but closed for modification   My data access is not open for extension, and it is certainly not closed for modification.  The problem is that I am trying to create a hard isolation between two pieces of the system that need to work very closely together, and as long as we are going to insist on this strict separation, we are going to have problems.  My current approach is quite different. I define queries, which contains the actual business logic for the query, but I pass that query onward to higher levels of my application. Any additional processing on the query (projections, paging, sorting, etc) can be done. In that way, my queries are closed for modification and open for extension, since they can be further manipulated by higher level code.  A good example of that would be:  public class LatePayingCustomerQuery&#xA;{&#xA;&#x9;public DateTime? DueDate {get;set;}&#xA;&#x9;public decimal? MinAmount {get;set;}&#xA;&#x9;public deciaml MaxAmount {get;set;}&#xA;&#x9;&#xA;&#x9;public IQueryable&lt;Customer&gt; GetQuery(ISession session)&#xA;&#x9;{&#xA;&#x9;&#x9;var payments = &#x9;from payment in s.Linq&lt;Payment&gt;()&#xA;&#x9;&#x9;&#x9; &#x9;&#x9;where payment.IsLate&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;select payment;&#xA;&#x9;&#xA;&#x9;&#x9;if(DueDate != null)&#xA;&#x9;&#x9;&#x9;payments = payments.Where( payment =&gt; payment.DueDate &gt;= DueDate.Value );&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;if(MinAmount != null)&#xA;&#x9;&#x9;&#x9;payments = payments.Where( payment =&gt; payment.Amount &gt;= MinAmount.Value );&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;if(MaxAmount != null)&#xA;&#x9;&#x9;&#x9;payments = payments.Where( payment =&gt; payment.Amount &lt;= MaxAmount.Value );&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;return &#x9;from customer in s.Linq&lt;Customer&gt;&#xA;&#x9;&#x9;&#x9;&#x9;where payments.Any( payment =&gt; customer == payment.Customer )&#xA;&#x9;&#x9;&#x9;&#x9;select customer;&#xA;&#x9;}&#xA;}&#xA;&#xA;I hope that this clears the air a bit about how I approach data access using NHibernate.&#xA;&#xA;* it is a joke, nitpickers will be shot.</p>
        </article>
        <article id="article-6098">
            <a href="https://ayende.com/blog/3957/mocking-nhibernate" target="_blank">
                <h2 class="title mb-6" id="article-6098">Mocking NHibernate</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 18, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">My recent post caused quite a few comments, many of them about two major topics. The first is the mockability of my approach and the second is regarding the separation of layers.  This post is about the first concern. I don&#x2019;t usually mock my database when using NHibernate. I use an in memory database and leave it at that. There are usually two common behaviors for loading data from the database. The first is when you need to load by primary key, usually using either Get or Load, the second is using a query.  If we are using Get or Load, this is extremely easy to mock, so I won&#x2019;t touch that any further.  If we are using a query, I categorically don&#x2019;t want to mock that. Querying is a business concern, and should be treated as such. Setting up an in memory database to be used with NHibernate is easy, you&#x2019;ll have to wait until the 28th for the post about that to be published, but it is basically ten lines of code that you stick in a base class.   As such, I have no real motivation to try to abstract that away, I gain a lot, and lose nothing.</p>
        </article>
        <article id="article-6099">
            <a href="https://ayende.com/blog/3956/posts-vs-comments" target="_blank">
                <h2 class="title mb-6" id="article-6099">Posts vs. Comments</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 18, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Just some interesting correlation:     Yesterday was the second most active day comments wise, eclipsed only by my single foray into politics.  Another interesting statistics:                       # Posts / Day                        1                        2                        3                        4                        5                        6                        7                        8                        9                        10                        11                        12                        13                        14                        17                        22                                  # of Days                        336                        287                        200                        165                        104                        64                        28                        32                        11                        11                        5                        7                        3                        1                        1                        1                 This table shows the relation between the number of posts per day and the number of times that I posted that number.  So, for example, you can see that my record is (once and never again!) 22 posts per day, and that I quite frequently post more than a single post per day.</p>
        </article>
        <article id="article-6100">
            <a href="https://ayende.com/blog/3955/repository-is-the-new-singleton" target="_blank">
                <h2 class="title mb-6" id="article-6100">Repository is the new Singleton</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 17, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I mentioned in passing that I don&#x2019;t like the Repository pattern anymore much, and gotten a lot of responses to that. This is the answering post, and yes, the title was&#xA0; chosen to get a rise out of you.  There are actually two separate issues that needs to be handled here. One of them is my issues with the actual pattern and the second is the pattern usage. There most commonly used definition for Repository is defined in Patterns of Enterprise Application Architecture:     A system with a complex domain model often benefits from a layer, such as the one provided by Data Mapper, that isolates domain objects from details of the database access code. In such systems it can be worthwhile to build another layer of abstraction over the mapping layer where query construction code is concentrated. This becomes more important when there are a large number of domain classes or heavy querying. In these cases particularly, adding this layer helps minimize duplicate query logic.    A Repository mediates between the domain and data mapping layers, acting like an in-memory domain object collection. Client objects construct query specifications declaratively and submit them to Repository for satisfaction. Objects can be added to and removed from the Repository, as they can from a simple collection of objects, and the mapping code encapsulated by the Repository will carry out the appropriate operations behind the scenes. Conceptually, a Repository encapsulates the set of objects persisted in a data store and the operations performed over them, providing a more object-oriented view of the persistence layer. Repository also supports the objective of achieving a clean separation and one-way dependency between the domain and data mapping layers.   Note that while the actual pattern description defined in PoEAA and DDD are very nearly identical, the actual reasoning behind it is different, and the DDD repository is limited to aggregate roots only.  So, what is the problem with that?  The problem with this pattern is that it totally ignores the existence of mature persistence technologies, such as NHibernate. NHibernate already provides an illusion of in memory access, in fact, that is its sole reason of existing. Declarative queries, check. OO view on the persistence store, check. One way dependency between the domain and the data store, check.  So, what do I gain by using the repository pattern when I already have NHibernate (or similar, most OR/M have matching capabilities by now)?  Not much, really, expect as additional abstraction. More than that, the details of persistence storage are:     Complex    Context sensitive    Important   Trying to hide that behind a repository interface usually lead us to a repository that has method like:     FindCustomer(id)    FindCustomerWithAddresses(id)    FindCustomerWith..   It get worse when you have complex search criteria and complex fetch plan. Then you are stuck either creating a method per each combination that you use or generalizing that. Generalizing that only means that you now have an additional abstraction that usually map pretty closely to the persistent storage that you use.  From my perspective, that is additional code that doesn&#x2019;t have to be written.  Wait, I can hear you say, but repositories encapsulate queries, and removing query logic duplication is one of the reasons for them in the first place.  Well, yes, but encapsulation of queries should be done in the repository. Queries are complex, and you want to encapsulate them in their own object. In most cases, I have something like this:     GetQuery takes an ISession an return ICriteria, which mean that my code gets the chance to set paging, ordering, fetching strategies, etc. That is not the responsibility of the query object, and trying to hide it only add additional abstraction that doesn&#x2019;t actually give me anything.  I mentioned that I have two problems with the repository pattern, the second being the way it is being used.  Quite frankly, and here I fully share the blame, the Repository pattern is popular. A lot of people use it, mostly because of the DDD association. I am currently in the opinion that DDD should be approached with caution, since if you don&#x2019;t actually need it (and have the prerequisites for it, such as business expert to work closely with or an app that can actually benefit from it), it is probably going to be more painful to try using DDD than without.  More than that, the way that most people use a Repository more closely follows the DAO pattern, not the Repository pattern. But Repository sounds more cool, so they call it that.  My current approach for data access now is:     When using a database, use NHibernate&#x2019;s ISession directly    Encapsulate complex queries into query objects that construct an ICriteria query that I can get and manipulate further    When using something other than a database, create a DAO for that, respecting the underlying storage implementation     Don&#x2019;t try to protect developers   Let us see how many call for my lynching we get now&#x2026;</p>
        </article>
        <div class="button flex justify-between">
            <a href="609.html"><span class="back arrow"></span></a>

            <a href="611.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
