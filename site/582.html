
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 582 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-5811">
            <a href="https://ayende.com/blog/4224/do-you-sign-the-default-contract" target="_blank">
                <h2 class="title mb-6" id="article-5811">Do you sign the default contract?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 03, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is just something that came up recently in a mailing list, we were talking about copyright, ownership and such. The topic of who owns the code you write on your own time (and on your own machines) came up.  The opinion of some people was that the employer may own the code even under those circumstances. It seems that it isn&#x2019;t usually part of the law (that depend on where you are at, of course), but it is part of standard employment contract templates.   When I started looking for a job, I insisted on taking the employment contract home and going over it with:     a calm mind    having another set of eyes go over it   I had one case of not properly reading what I was signing on with bad consequences, I learned since then.  There is no such thing as a standard contract, you can always negotiate.   For that matter, I rejected an offer from one place after verbal agreements that we reached didn&#x2019;t get into the contract (twice!). I decided that if they were trying to effectively cheat me when I wasn&#x2019;t even working for them, I had better things to do than to put my head into this sickbed.  Some of the things that I found in employment contracts are of the sort that would make your head curl. Non compete agreements that basically say that you are not allowed to do any work (for anyone) for 2 years after you stop working for the company. Ownership on anything you do (be in software artifacts, a book about flowers and quite possibly any children you have during your employment terms).  Some of them are unenforceable at court, but you would be at a much better position if you didn&#x2019;t have to deal with annoying section in a contract that you are signed on in the first place.  My usual approach to reading contracts is to debug them, assuming that the other side is nefarious, evil, double dealing and likes kicking puppies before breakfast. Most places will go with the &#x201C;Try and you shall succeed&#x201D; method for contracts. If you signed on to them without complaints, they are good. If you object to something, they can amend the contract to be more reasonable. It isn&#x2019;t that they are nefarious, or that they even plan to act according to the contract. But it is best if they don&#x2019;t have any leverage on you.  An interesting point that I run into is that it is often useful to be bold when negotiating a contract. I deleted the non compete clause for my employment contract when I viewed it, and required a lot of clarifications about what of my work amounts to company&#x2019;s property. I followed the same logic as they did, &#x201C;Try and you shall succeed&#x201D;, if they didn&#x2019;t care about that, I was good.   We ended up with a 1 year limitation for clients that they sent me to, and agreeing that any software work that I am making on the company&#x2019;s time or using their equipment belong to the company, which I considered reasonable.   Not reading the contract is a crime, once you did, be very careful in deciding what is acceptable and what isn&#x2019;t. And if you are already signed on a contract, make sure that you know what is in it.</p>
        </article>
        <article id="article-5812">
            <a href="https://ayende.com/blog/4223/hey-you-developer-learn-a-bit-of-business-speak" target="_blank">
                <h2 class="title mb-6" id="article-5812">Hey you, developer! Learn a bit of business speak!</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 02, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In a comment to one of my posts, Dave Mertens said:     I often wish I had the luxury the throw away the current code and start from scratch. Why. Because my manager ask me how long it takes to fix just this bug. 80% of the bugs (luckily we don&#x27;t have that many bugs) are fixed within 2 hours including writing tests. Than he asks me how long it takes to rewrite the damn code.     It is interesting to note that the questions you ask select the answers you want.  When you give someone a choice between 2 hours of fixing code vs. 3 days of fixing code, the decision is always going to be in favor of 2 hours.  At one point in my life I was asked if I stopped beating up people. This is a twist on the old &#x201C;have you stopped beating your wife yet? yes/no&#x201D; question. I answered in Mu. Then I spent another ten minutes explaining what I meant.     When someone asks me those types of questions, I correct the question, before I answer. Because while you may ask questions to lead the answer in a certain way, there is nothing that says that I must go that way.  The right question is: How often are we hitting on bugs for this same code path? Then asking about how long it takes to fix the whole damn thing.  Oh, and make sure that you can fix it. There is nothing a business likes less than spending time &amp; money on solving a problem and ending up not solving it. Leaving aside what it does to your credibility and the trust relationship with the business.</p>
        </article>
        <article id="article-5813">
            <a href="https://ayende.com/blog/4222/random-nhibernate-tweets" target="_blank">
                <h2 class="title mb-6" id="article-5813">Random NHibernate tweets</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 01, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Those crossed my desk recently, and I thought they were interesting.                I am seeing more and more movement behind NHibernate.</p>
        </article>
        <article id="article-5814">
            <a href="https://ayende.com/blog/4221/sometimes-it-looks-like-select-is-broken-a-wpf-memory-leak" target="_blank">
                <h2 class="title mb-6" id="article-5814">Sometimes it looks like select IS broken: A WPF memory leak</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 01, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the most annoying bug reports that we got for NH Prof is that it crash with out of memory exception after long use. We did the usual checkups, and the reason for the memory leak was obvious, something kept a lot of objects internal to WPF in memory. In fact, here are the heavy hitters, as extracted from the dump:              Count        Size (kliobytes)        Type                  5,844        3,337        System.Byte[]                  69,346        5,474        System.String                  49,400        37,198        System.Object[]                  1,524,355        47,636        MS.Utility.SingleItemList`1[[System.WeakReference,mscorlib]]                  3,047,755        71,432        MS.Internal.Data.ValueChangedEventArgs                  1,523,918        71,434        MS.Utility.ThreeItemList`1[[System.WeakReference,mscorlib]]                  3,048,292        71,444        MS.Utility.FrugalObjectList`1[[System.WeakReference,mscorlib]]                  3,048,292        95,259        System.Windows.WeakEventManager&#x2B;ListenerList                  3,047,755        166,674        MS.Internal.Data.ValueChangedEventManager&#x2B;ValueChangedRecord                  3,056,462        191,029        System.EventHandler                  7,644,217        238,882        System.WeakReference          As you can see, this just says that we are doing something that cause WPF to keep a lot of data in memory. In fact, this looks like a classic case of &#x201C;memory leak&#x201D; in .NET, where we aren&#x2019;t releasing references to something. This usually happen with events, and it was the first thing that I checked.  It took a while, but I convinced myself that this wasn&#x2019;t that. The next step was to try to figure out what is causing this. I&#x2019;ll skip the sordid tale for now, I&#x2019;ll queue it up for posting at a later date. What we ended up with is a single line of code that we could prove caused the issue. If we removed it, there was no leak, if it was there, the leak appeared.  That was the point where I threw up my hands and asked Christopher to look at this, I couldn&#x2019;t think of something bad that we were doing wrong, but Christopher and Rob are the experts in all things WPF.  Christopher managed to reproduce this in an isolated fashion. here is how it goes:                 public class TestModel : INotifyPropertyChanged{    private readonly DispatcherTimer timer;    private int count;    public event PropertyChangedEventHandler PropertyChanged = delegate { };    public TestModel()    {        timer = new DispatcherTimer(DispatcherPriority.Normal)                    {                        Interval = TimeSpan.FromMilliseconds(50)                    };        timer.Tick &#x2B;= Timer_Tick;        timer.Start();    }    public IEnumerable Data    {        get        {            return new[]            {                new {Name = &quot;Ayende&quot;},            };        }    }    private void Timer_Tick(object sender, EventArgs e)    {        if (count&#x2B;&#x2B; % 100 == 0)        {            GC.Collect(2, GCCollectionMode.Forced);            Console.WriteLine(&quot;{0:#,#}&quot;, Process.GetCurrentProcess().WorkingSet64);        }        PropertyChanged(this, new PropertyChangedEventArgs(&quot;Data&quot;));    }}&#xA;    &#xA;  &#xA;&#xA;&#xA;This is a pretty standard model, showing data that updates frequently. (The short time on the time is to show the problem in a short amount of time.) Note that we are being explicit about forcing a GC release here, to make sure it isn&#x2019;t just waste memory that haven&#x2019;t been reclaimed yet.&#xA;&#xA;And the XAML:&#xA;&#xA;&#xA;  &#xA;    &lt;Grid&gt;    &lt;ItemsControl ItemsSource=&quot;{Binding Data}&quot;&gt;        &lt;ItemsControl.ItemTemplate&gt;            &lt;DataTemplate&gt;                &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;                    &lt;TextBlock Text=&quot;{Binding Name}&quot; /&gt;                &lt;/StackPanel&gt;            &lt;/DataTemplate&gt;        &lt;/ItemsControl.ItemTemplate&gt;    &lt;/ItemsControl&gt;&lt;/Grid&gt;&#xA;  &#xA;&#xA;&#xA;Executing this will result in the following memory pattern:&#xA;&#xA; &#xA;&#xA;Looking at the code, I really don&#x2019;t see anything that is done wrong there. &#xA;&#xA;I uploaded a sample project that demonstrate the issue here.&#xA;&#xA;Am I going crazy? Am I being stupid? Or is select really broken?</p>
        </article>
        <article id="article-5815">
            <a href="https://ayende.com/blog/4220/re-are-you-smart-enough-to-do-without-tdd" target="_blank">
                <h2 class="title mb-6" id="article-5815">re</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 30, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Daniel has posted a reply to my post, titling it:&#xA0; Are you smart enough to do without TDD. I more or less expected to get responses like that, which was why I was hesitant to&#xA0; post it. Contrary to popular opinion, I don&#x2019;t really enjoy being controversial.   There are two main points that I object to in his post:     You see, Ayende appears to say that if you&#x27;re smart enough, you&#x27;ll just know what code to write, just like that. Ergo, if you don&#x27;t know, maybe you&#x27;re not that smart and hence you would need this technique for losers called Test Driven Design/Development.   That is not what I said, please don&#x2019;t put words in my mouth. What I said was: &#x201C;The idea behind TDD is to use the tests to drive the design. Well, in this case, I don&#x2019;t have any design to drive.&#x201D; Combine this with my concepts &amp; features architecture, where the main tenets is: &#x201C;A feature creation may not involve any design activity.&#x201D; and it should be clear why TDD simply doesn&#x2019;t work for my scenario.   And his attack on Rhino Mocks:     Moq vs Rhino Mocks: he [Ayende, it seems] read the (useless IMO) literature on mocks vs stubs vs fakes, had apparently a clear idea of what to do, and came up with Rhino&#x27;s awkward, user unfriendly and hard to learn API with a myriad of concepts and options, and a record-replay-driven API (ok, I&#x27;m sure it was not his original idea, but certainly it&#x27;s his impl.) which two years ago seemed to him to stand at the core of mocking. Nowadays not only he learned what I&#x27;ve been saying all along, that &quot;dynamic, strict, partial and stub... No one cares&quot;, but also is planning to remove the record / playback API too.   This is just full of misinformation. Let me see how:     Rhino Mocks is 5 years old.     Rhino Mocks came out for .NET 1.0.    Rhino Mocks actually predate most of the mocks vs. stubs debate.   I keep Rhino Mocks updated as new concepts and syntax options comes. Yes, AAA is easier, but AAA relies on having the syntax options that we have in C# 3.0. Rhino Mocks didn&#x2019;t start from there, it started a lot earlier, and it is a testament to its flexibility that I was able to adapt it to any change along the way.  Oh, and Rhino Mocks was developed with TDD, fully. Still is, for that matter. So I find it annoying that someone attacks it on this grounds without really understanding how it worked.</p>
        </article>
        <article id="article-5816">
            <a href="https://ayende.com/blog/4219/duct-tape-programmers" target="_blank">
                <h2 class="title mb-6" id="article-5816">Duct tape programmers</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 30, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Sometimes I read something and I just know that responding off the cuff would be a big mistake. Joel&#x2019;s latest essay, duct tape programmers, is one such case.  I many ways, I feel that this and this says it all:    Sometimes I feel like Joel is on a quest to eradicate good design practices.   Let us start from where I do agree with him. Yes, some people have a tendency to overcomplicate things and code themselves into a corner. Yes, you should keep an eye on your deadlines and deliver.   But to go from there to disparage good practices? To actually encourage brute force hacking?   I think that Joel&#x2019;s dream developer is the guy that keep copy/pasting stuff he finds on the web until it looks like it is working. At the very least, it will make sure that his bug tracking system is used.  And the examples that he gives?     Here&#x2019;s what Zawinski says about Netscape: &#x201C;It was decisions like not using C&#x2B;&#x2B; and not using threads that made us ship the product on time.&#x201D;   Oh, wait, let me see. Netscape is the company that:     Routinely shipped a browser that kept crashing    Wasn&#x2019;t able to compete with IE    Got their source code into a bad enough shape that they had to rewrite it from scratch and lose 5 &#x2013; 6 YEARS doing so    Collapsed   Yep, sounds like this duct tape notion really worked out for them, no?  Here is the deal, every tool and approach can be overused.           But that is part of being a professional, you have to how to balance things. I am not sure what bee got in Joel&#x2019;s bonnet, but it sure seems to cause him to have a knee jerk reaction whenever good design principles are discussed.  Shipping software is easy, you can cobble together something that sort of works and you have a shipping product. People will even buy it from you. All you have to do is look around and see it.  The hard part is to keep releasing software, and with duct tape, your software will be taken away from you by software protective services.     Don&#x2019;t, just don&#x2019;t.</p>
        </article>
        <article id="article-5817">
            <a href="https://ayende.com/blog/4218/scenario-driven-tests" target="_blank">
                <h2 class="title mb-6" id="article-5817">Scenario Driven Tests</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 29, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I originally titled this blog post: Separate the scenario under test from the asserts. I intentionally use the terminology scenario under test, instead of calling it class or method under test.   One of the main problem with unit testing is that we are torn between competing forces. One is the usual drive for abstraction and eradication of duplication, the second is clarity of the test itself. Karl Seguin does a good job covering that conflict.  I am dealing with the issue by the simple expedient of forbidding anything but asserts in the test method. And no, I don&#x2019;t mean something like BDD, where the code under test is being setup in the constructor or the context initialization method.  I tend to divide my tests code into four distinct parts:     Scenario under test    Scenario executer    Test model, represent the state of the application    Test code itself, asserting the result of a specific scenario on the test model   The problem is that a single scenario in the application may very well have multiple things that we want to actually test. Let us take the example of authenticating a user, there are several things that happen during the process of authentication, such as the actual authentication, updating the last login date, resetting bad login attempts, updating usage statistics, etc.  I am going to write the code to test all of those scenarios first, and then discuss the roles of each item in the list. I think it will be clearer to discuss it when you have the code in front of you.  We will start with the scenarios:          public class LoginSuccessfully : IScenario{    public void Execute(ScenarioContext context)    {        context.Login(&quot;my-user&quot;,&quot;swordfish is a bad password&quot;);    }}public class TryLoginWithBadPasswordTwice : IScenario{    public void Execute(ScenarioContext context)    {        context.Login(&quot;my-user&quot;,&quot;bad pass&quot;);        context.Login(&quot;my-user&quot;,&quot;bad pass&quot;);    }}public class TryLoginWithBadPasswordTwiceThenTryWithRealPassword : IScenario{    public void Execute(ScenarioContext context)    {        context.Login(&quot;my-user&quot;,&quot;bad pass&quot;);        context.Login(&quot;my-user&quot;,&quot;bad pass&quot;);        context.Login(&quot;my-user&quot;,&quot;swordfish is a bad password&quot;);    }}&#xA;  &#xA;&#xA;&#xA;And a few tests that would show the common usage:&#xA;&#xA;&#xA;  &#xA;    public class AuthenticationTests : ScenarioTests{    [Fact]    public void WillUpdateLoginDateOnSuccessfulLogin()    {        ExecuteScenario&lt;LoginSuccessfully&gt;();                Assert.Equal(CurrentTime, model.CurrentUser.LastLogin);    }        [Fact]    public void WillNotUpdateLoginDateOnFailedLogin()    {        ExecuteScenario&lt;TryLoginWithBadPasswordTwice&gt;();                Assert.NotEqual(CurrentTime, model.CurrentUser.LastLogin);    }    [Fact]    public void WillUpdateBadLoginCountOnFailedLogin()    {        ExecuteScenario&lt;TryLoginWithBadPasswordTwice&gt;();                Assert.NotEqual(2, model.CurrentUser.BadLoginCount);    }    [Fact]    public void CanSuccessfullyLoginAfterTwoFailedAttempts()    {        ExecuteScenario&lt;TryLoginWithBadPasswordTwiceThenTryWithRealPassword&gt;();                Assert.True(model.CurrentUser.IsAuthenticated);    }}&#xA;  &#xA;&#xA;&#xA;As you can see, each of the tests is pretty short and to the point, there is a clear distinction between what we are testing and what is being tested.&#xA;&#xA;Each scenario represent some action in the system which we want to verify behavior for. Those are usually written with the help of a scenario context (or something of the like) with gives the scenario access to the application services required to perform its work. An alternative to the scenario context is to use a container in the tests and supply the application service implementations from there.&#xA;&#xA;The executer (ExecuteScenario&lt;TScenario&gt;() method) is responsible for setting the environment for the scenario, executing the scenario, and cleaning up afterward. It is also responsible for any updates necessary to get the test model up to date.&#xA;&#xA;The test model represent the state of the application after the scenario was executed. It is meant for the tests to be able to assert against. In many cases, you can use the actual model from the application, but there are cases where you would want to augment that with test specific items, to allow easier testing.&#xA;&#xA;And the tests, well, the tests simple execute a scenario and assert on the result.&#xA;&#xA;By abstracting the execution of a scenario into the executer (which rarely change) and providing an easy way of building scenarios, you can get very rapid feedback into test cycle while maintaining testing at a high level.&#xA;&#xA;Also, relating to my previous post, note what we are testing here isn&#x2019;t a single class. We are testing the system behavior in a given scenario. Note also that we usually want to assert on various aspects of a single scenario as well (such as in the WillNotUpdateLoginDateOnFailedLogin and WillUpdateBadLoginCountOnFailedLogin tests).</p>
        </article>
        <article id="article-5818">
            <a href="https://ayende.com/blog/4217/even-tests-has-got-to-justify-themselves" target="_blank">
                <h2 class="title mb-6" id="article-5818">Even tests has got to justify themselves</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 28, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Let us get a few things out of the way:&#xA;&#xA;    I am not using TDD. &#xA;    I am not using BDD. &#xA;    I am not using Test After. &#xA;    I am not ignoring testing. &#xA;&#xA;I considered not posting this post, because of the likely response, but it is something that I think it worth at least discussion. The event that made me decide to post this is the following bug:&#xA;&#xA;&#xA;public bool IsValid{    get { return string.IsNullOrEmpty(Url); }}&#xA;&#xA;&#xA;As you can probably guess, I have an inverted conditional here. The real logic is that the filter is valid if the Url is not empty, not the other way around.&#xA;When I found the bug, I briefly considered writing a test for it, but it struck me as a bad decision. This is code that I don&#x2019;t see any value in testing. It is too stupid to test, because I won&#x2019;t have any ROI from the tests.&#xA0; And yes, I am saying that after seeing that the first time I wrote the code it had a bug.&#xA;The idea behind TDD is to use the tests to drive the design. Well, in this case, I don&#x2019;t have any design to drive. In recent years, I have moved away from the tenets of TDD toward a more system oriented testing system. &#xA;I don&#x2019;t care about testing a specific class, I want to test the entire system as whole. I may switch some parts of the infrastructure (for example, change the DB to in memory one), for perf sake, but I usually try to test an entire component at a time. &#xA;My components may be as small as a single class or as big as the entire NH Prof sans the actual UI pieces.&#xA0; I have posted in the past, showing how I implement features for NH Prof, including the full source code for the relevant sections. Please visit the link, it will probably make more sense to you afterward. It is usually faster, easier and more convenient to write a system test than to try to figure out how to write a unit test for the code.&#xA;Now, let us look at why people are writing tests:&#xA;&#xA;    Higher quality code&#xA;    Safe from regressions&#xA;    Drive design&#xA;&#xA;Well, as I said, I really like tests, but my method of designing software is no longer tied to a particular class. I have the design of the class handed to me by a higher authority (the concept), so that is out. Regressions are handled quite nicely using the tests that I do write. &#xA;What about the parts when I am doing design, when I am working on a new concept?&#xA;Well, there are two problems here:&#xA;&#xA;    I usually try several things before I settle down on a final design. During this bit of churn, it is going to take longer to do things with tests.&#xA;    After I have a design finalized, it is still easier to write a system level test than write unit tests for the particular implementation.&#xA;&#xA;As a matter of fact, in many cases, I don&#x2019;t really care about the implementation details of a feature, I just want to know that the feature works. As a good example, let us take a look at this test:&#xA;&#xA;&#xA;public class CanGetDurationOfQueries : IntegrationTestBase{    [Fact]    public void QueriesSpecifyTheirDuration()    {        ExecuteScenarioInDifferentAppDomain&lt;SelectBlogByIdUsingCriteria&gt;();        var first = model.RecentStatements            .ExcludeTransactions()            .First();        Assert.NotNull(first.DurationViewModel.Inner.Value);    }}&#xA;&#xA;&#xA;NH Prof went through three different ways of measuring the duration of a query. The test didn&#x2019;t need to change. I have a lot of tests that work in the same manner. Specifying the final intent, rather than specifying each individual step.&#xA;There are some parts in which I would use Test First, usually parts that I have high degree of uncertainty about.&#xA0; The &#x201C;show rows from query&#x201D; feature in NH Prof was develop using Test First, because I had absolutely no idea how to approach it.&#xA;But most of the time, I have a pretty good idea where I am and where I am going, and writing unit tests for every miniscule change is (for lack of a better phrase) hurting my style. &#xA;Just about any feature in NH Prof is covered in tests, and we are confident enough in our test coverage to release on every single commit.&#xA;But I think that even a test has got to justify its existence, and in many cases, I see people writing tests that have no real meaning. They duplicate the logic in a single class or method. But that isn&#x2019;t what I usually care about. I don&#x2019;t care about what a method or a class does.&#xA;I care about what the overall behavior is. And I shaped my tests to allow me to assert just that. I&#x2019;ll admit that NH Prof is somewhat of a special case, since you have a more or less central location that you can navigate form which to everything else. In most systems, you don&#x2019;t have something like that.&#xA;But the same principle remains, if you setup your test environment so you are testing the system, it is going to be much easier to test the system. It isn&#x2019;t a circular argument. Let us take a simple example of an online shop and wanting to test the &#x201C;email on order confirmed&#x201D; feature.&#xA;One way of doing this would be to write a test saying that when the OrderConfirmed message arrive, a SendEmail message is sent. And another to verify that SendEmail message actually send an email.&#xA;I would rather write something like this, however:&#xA;&#xA;&#xA;[Fact]public void WillSendEmailOnOrderConfirmation(){    // setup the system using an in memory bus    // load all endpoints and activate them    // execute the given scenario    ExecuteScenario&lt;BuyProductUsingValidCreditCard&gt;();    var confirmation = model.EmailSender.EmailsToSend.FirstOrDefault(x=&gt;x.Subject.Contains(&quot;Order Confirmation&quot;);    Assert.NotNull(confirmation);}&#xA;&#xA;&#xA;I don&#x2019;t care about implementation, I just care about what I want to assert.&#xA;But I think that I am getting side tracked to another subject, so I&#x2019;ll stop here and post about separating asserts from their scenarios at another time.</p>
        </article>
        <article id="article-5819">
            <a href="https://ayende.com/blog/4216/distributed-source-control" target="_blank">
                <h2 class="title mb-6" id="article-5819">Distributed Source Control</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 27, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I had a short discussion with Steve Bohlen about distributed source control, and how it differs from centralized source control. After using Git for a while, I can tell you that there are several things that I am not really willing to give up.     Fast commits    Local history    Easy merging   To be sure, a centralized SCM will have commits, history and merging. But something like Git takes it to a whole new level. Looking at how it changed my workflow is startling. There is no delay to committing, so I can commit every minute or so. I could do it with SVN, but it would take 30 seconds to a minute to execute, blocking my work, so I use bigger commits with SVN.  Having local history means that I can deal with a lot of small commits, because diffing a file from two commits ago is as fast as diffing the local copy. I tend to browse around in the history quite a lot, especially when I am doing stuff like code reviews, or trying to look at how I did something three weeks ago.  Merging is another thing that DVCS excels at. Not so much because of better merge algorithms (although that is a part of this), but simply because having all the information locally make the merge process so much faster.  All in all, it end up being a much easier process to work with. It takes time to get used to it, though.  And given those requirements, Fast commits, Local history, Easy merging, you pretty much end up with a distributed solution. Even with a DVCS, you still have the master repository, but just the fact that you have full local history frees you from having to manage all of that.</p>
        </article>
        <article id="article-5820">
            <a href="https://ardalis.com/gmail-problems/" target="_blank">
                <h2 class="title mb-6" id="article-5820">Gmail Problems</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 26, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Hmm, GMail has been increasingly inconsistent both for POP3 and browser usage for me lately. Is anybody else seeing the same thing or is it&#x2026;Keep Reading &#x2192;</p>
        </article>
        <div class="button flex justify-between">
            <a href="581.html"><span class="back arrow"></span></a>

            <a href="583.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;🚀&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
