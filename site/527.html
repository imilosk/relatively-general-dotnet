
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 527 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-5261">
            <a href="https://ayende.com/blog/4588/where-is-the-bug" target="_blank">
                <h2 class="title mb-6" id="article-5261">Where is the bug?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 14, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This cost me two hours of debugging, do you see&#xA0; why the test will always fail?</p>
        </article>
        <article id="article-5262">
            <a href="https://ayende.com/blog/4587/how-to-pay-3-times-for-the-same-flight-ticket" target="_blank">
                <h2 class="title mb-6" id="article-5262">How to pay 3 times for the same flight ticket</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 13, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">My current mood is somewhere between mad, pissed off, frustrated and exhausted.  All I want to do it arrive home, but dark forces has conspired against me. It works like this:     I got a ticket both ways to London, and I left to London quite happily, taking the train to the airport. At that point things started going horribly wrong. An idiot has suicided on the train trucks, leading to about 2 hours of delays, which, naturally, caused me to miss my flight. We will leave that aside and just point out that I somehow managed to get to London without being late to my course the next morning.     That is when I heard that since I was a no show for the outgoing flight, the airline cancelled my flight back.&#xA0; I had to order a new one, but because I was busy actually doing the course, I asked the company to order that for me.    They did, and I went to the airport quite satisfied, except that on arrival, the stupid machine told me that my booking is invalid, which is the point that I discovered that the ticket was ordered on Ayende Rahien. Unfortunately, legally speaking, that guy doesn&#x2019;t exists. The airline was quite insistent that they can&#x2019;t put me on board with the different name. And they made me buy a new ticket.   That was the point (after I paid for the same bloody seat for the third time) that they told me that they oversold the flight, and that they put me on waiting list.   I tried to explain that they could use the second ticket that I bought, and just give me the same seat, but they told me that they already sold that to someone else.   I am currently waiting to hear whatever I&#x2019;ll get to go home tonight or not.   Your truly,  Pissed off,  Oren Eini (because being Ayende is currently dangerous, given my mood)</p>
        </article>
        <article id="article-5263">
            <a href="https://ayende.com/blog/4586/find-the-bug-ravendb-hilo-implementation" target="_blank">
                <h2 class="title mb-6" id="article-5263">Find the bug</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 13, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The follow code is part of RavenDB HiLo implementation:             private long NextId()&#xA;        {&#xA;            long incrementedCurrentLow = Interlocked.Increment(ref currentLo);&#xA;            if (incrementedCurrentLow &gt; capacity)&#xA;            {&#xA;                lock (generatorLock)&#xA;                {&#xA;                    if (Thread.VolatileRead(ref currentLo) &gt; capacity)&#xA;                    {&#xA;                        currentHi = GetNextHi();&#xA;                        currentLo = 1;&#xA;                        incrementedCurrentLow = 1;&#xA;                    }&#xA;                }&#xA;            }&#xA;            return (currentHi - 1)*capacity &#x2B; (incrementedCurrentLow);&#xA;        }&#xA;  &#xA;&#xA;It contains a bug, can you see it? I took a long time to figure it out, I am ashamed to say. &#xA;&#xA;BTW, you can safely assume that GetNextHi is correct.</p>
        </article>
        <article id="article-5264">
            <a href="https://ayende.com/blog/4585/nhibernate-course-in-australia" target="_blank">
                <h2 class="title mb-6" id="article-5264">NHibernate course in Australia?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 12, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am going to be visiting Australia in December, and I thought that I might take advantage of that to give my 3 days NHibernate course.  Before doing that, I thought that I should test the waters. Thoughts?</p>
        </article>
        <article id="article-5265">
            <a href="https://ayende.com/blog/4584/ravendb-includes" target="_blank">
                <h2 class="title mb-6" id="article-5265">RavenDB</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 12, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">When I set out to build RavenDB, I had a very clear idea about what I wanted to do. I wanted to build an integrated, opinionated, solution. Something that will do the right thing most of the time, and let you override that if you really want to.  One of the things that really drove the design was 6 &#x2013; 7 years of experience in building applications based on RDBMS using ORMs. Let me put it gently, I am&#x2026; well acquainted with the problems that people may run into when they use an ORM. One of the things that I wanted to avoid was duplicating the possibility of error with RavenDB.  One of the major design decisions that I made was to disallow associations between documents. This is part of the core design of the system.  Let us take the following example:  &#xA0;   As you can see, we have two documents, an Order and a Customer. The order references a customer, but unlike in RDBMS, we use a denormalized reference, with both the Id and the Name of the customer stored inside the Order document. That is advantageous because it allows us to perform most operations on the Order document without having to load the Customer document.  From the C# model, it looks like this:     public class Order&#xA;{&#xA;      public string Id { get;set; }&#xA;      public Address ShippingAddress { get;set; }&#xA;      public Address BillingAddress { get;set; }&#xA;      public DenormalizedReference Customer { get;set; }&#xA;}&#xA;&#xA;public class DenormalizedReference&#xA;{&#xA;      public string Id { get;set; }&#xA;      public string Name { get;set; }&#xA;}&#xA;&#xA;public class Customer&#xA;{&#xA;      public string Id { get;set; }&#xA;      public string Name { get;set; }&#xA;      public string Email { get;set; }&#xA;&#xA;}&#xA;  &#xA;&#xA;Note that there isn&#x2019;t a direct reference between the Order and the Customer. Instead, Order holds a DenormalizedReference, which holds the interesting bits from Customer that we need to process requests on Order.&#xA;&#xA;So far so good, but, and this is important, you can&#x2019;t always set things up this way. There is a set of cases where you do want to be able to access the associated document.&#xA;&#xA;Well, that is easy enough, isn&#x2019;t it? All we need to do is load it:&#xA;&#xA;&#xA;  var order = session.Load&lt;Order&gt;(&quot;orders/9432&quot;);&#xA;var customer = session.Load&lt;Customer&gt;(order.Customer.Id);&#xA;  &#xA;&#xA;This is simple, easy to read, easy to understand and make me want to curl into a ball and weep. The problem is, of course, that this is going to generate two calls to Raven. And if there is one thing that I pay attention to is the number of remote calls that I am making.&#xA;&#xA;I started to think about how I can make this scenario work better, and I came up with the following design.&#xA;&#xA;Given the two documents &#xA;&#xA;&#xA;Then for GET /docs/orders/9432&#xA;&#xA;&#xA;   &#xA;&#xA;&#xA;&#xA;And for GET /docs/orders/9432?include=Customer.Id&#xA;&#xA;&#xA;   &#xA;  &#xA;&#xA;Note that in the second case, we get the full customer data merged into the order document.&#xA;&#xA;From an implementation perspective, this would be very easy to do. The problem is how to represent this in the client API. We had a very interesting discussion on the topic in the mailing list.&#xA;&#xA;&#xA;&#xA;Let me explain the problem in detail. Given the C# classes above, how do you express this notion of the include? You can&#x2019;t use the Order model above, because that Customer property is going to of type DenormalizedReference. We can&#x2019;t make that property of type Customer, either, because then the Customer data would be embedded inside the Order document, which isn&#x2019;t what we wanted.&#xA;&#xA;In the mailing list, there were a lot of proposal being raised, the one that seemed to be the most popular was to drop the 1:1 mapping between the C# model and the document model and move to something like this:&#xA;&#xA;&#xA;  [RootAggregate]&#xA;public class Order&#xA;{&#xA;    public string Id { get; set; }&#xA;    public string Name { get; set; }&#xA;    public Customer Customer { get; set; }&#xA;}&#xA;&#xA;[RootAggregate]&#xA;public class Customer&#xA;{&#xA;    public string Id { get; set; }&#xA;    [Denormalized]&#xA;    public string Name { get; set; }&#xA;    public string Email { get; set; }&#xA;&#xA;}&#xA;  &#xA;&#xA;And then make the client API smart enough to understand the attribute. The model above would generate the same documents as the previous model, but would allow much easier time when working on features such as this. This way, we can normally access the data that is embedded in the document, but also include the associated document when we need it.&#xA;&#xA;There are several problems here:&#xA;&#xA;&#xA;  This creates a misleading API, making people think that things are normalized when they aren&#x2019;t.&#xA;&#xA;  It is going to bring back ALL the problems associated with lazy loading (worse, it is going to bring back all the problems associated with EF 1.0 lazy loading).&#xA;&#xA;  It goes directly against the way I believe you should work with a document database.&#xA;&#xA;&#xA;But I couldn&#x2019;t think of any other way, nor could anyone else. &#xA;&#xA;Until Frank Schwieterman come to our rescue:&#xA;&#xA;&#xA;  Maybe rather then join the documents into one result, such a request would cause the &#x27;joined&#x27; entities to be preloaded instead.&#xA;    From the client API perspective, I would load do the joined load of the user object, and the user is returned in its original form.&#xA0; But now the session has the customer object preloaded, so when I try to load the customer object via the client API no request is made to the server.&#xA0; From the caller&#x27;s perspective, the only change to usage has been the preload hint passed in the original request.&#xA;&#xA;&#xA;Yes!&#xA;&#xA;The problem was (from my perspective) never with the way the model is structured, the problem was that the way the documents were model caused a performance problem. Frank&#x2019;s suggestion completely eliminated that issue.&#xA;&#xA;It took some interesting coding to get it to work properly, but essentially, it is just an application of the Future usage for loading large object graph in NHibernate. Now we can do:&#xA;&#xA;&#xA;  var order = session&#xA;    .Include(&quot;Customer.Id&quot;)&#xA;    .Load&lt;Order&gt;(&quot;orders/1&quot;);&#xA;&#xA;var customer = session.Load&lt;Customer&gt;(order.Customer.Id);&#xA;  &#xA;&#xA;And this code will only go to the server once!&#xA;&#xA;We get to keep the separate model, and we can manipulate how we are loading associations easily. I really like this solution.</p>
        </article>
        <article id="article-5266">
            <a href="https://ayende.com/blog/4583/playing-with-entity-framework-code-only" target="_blank">
                <h2 class="title mb-6" id="article-5266">Playing with Entity Framework Code Only</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 11, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">After making EF Prof work with EF Code Only, I decided that I might take a look at how Code Only actually work from the perspective of the application developer. I am working on my own solution based on the following posts:          EF Feature CTP4 Walkthrough: Code First            EF Feature CTP4 Walkthrough: Productivity Improvements      But since I don&#x2019;t like to just read things, and I hate walkthroughs, I decided to take that into a slightly different path. In order to do that, I decided to set myself the following goal:        Create a ToDo application with the following entities:         User      Actions (inheritance)             ToDo        Reminder            Query for:         All actions for user      All reminders for today across all users      That isn&#x2019;t really a complex system, but my intention is to get to grips with how things work. And see how much friction I encounter along the way.  We start by referencing &#x201C;Microsoft.Data.Entity.Ctp&#x201D; &amp; &#x201C;System.Data.Entity&#x201D;  There appears to be a wide range of options to define how entities should be mapped. This include building them using a fluent interface, creating map classes or auto mapping. All in all, the code shows a remarkable similarity to Fluent NHibernate, in spirit if not in actual API.  I don&#x2019;t like some of the API:     HasRequired and HasKey for example, seems to be awkwardly named to me, especially when they are used as part of a fluent sentence. I have long advocated avoiding the attempt to create real sentences in a fluent API (StructureMap was probably the worst in this regard). Dropping the Has prefix would be just as understandable, and look better, IMO.    Why do we have both IsRequired and HasRequired? The previous comment apply, with the addition that having two similarly named methods that appears to be doing the same thing is probably not a good idea.   But aside from that, it appears very nice.  ObjectContext vs. DbContext   I am not sure why there are two of them, but I have a very big dislike of ObjectContext, the amount of code that you have to write to make it work is just ridiculous, when you compare that to the amount of code you have to write for DbContext.  I also strongly dislike the need to pass a DbConnection to the ObjectContext. The actual management of the connection is not within the scope of the application developer. That is within the scope of the infrastructure. Messing with DbConnection in application code should be left to very special circumstances and require swearing an oath of nonmaleficence. The DbContext doesn&#x2019;t require that, so that is another thing that is in favor of it.  Using the DbContext is nice:     public class ToDoContext : DbContext&#xA;{&#xA;    private static readonly DbModel model;&#xA;&#xA;    static ToDoContext()&#xA;    {&#xA;        var modelBuilder = new ModelBuilder();&#xA;        modelBuilder.DiscoverEntitiesFromContext(typeof(ToDoContext));&#xA;        modelBuilder.Entity&lt;User&gt;().HasKey(x =&gt; x.Username);&#xA;        model = modelBuilder.CreateModel();&#xA;    }&#xA;&#xA;    public ToDoContext():base(model)&#xA;    {&#xA;        &#xA;    }&#xA;&#xA;    public DbSet&lt;Action&gt; Actions { get; set; }&#xA;&#xA;    public DbSet&lt;User&gt; Users { get; set; }&#xA;}&#xA;  &#xA;&#xA;Note that we can mix &amp; match the configuration styles, some are auto mapped, some are explicitly stated. It appears that if you fully follow the builtin conventions, you don&#x2019;t even need ModelBuilder, as that will be build for you automatically.&#xA;&#xA;Let us try to run things:&#xA;&#xA;&#xA;  using(var ctx = new ToDoContext())&#xA;{&#xA;    ctx.Users.ToList();&#xA;}&#xA;  &#xA;&#xA;The connection string is specified in the app.config, by defining a connection string with the name of the context. &#xA;&#xA;Then I just run it, without creating a database. I expected it to fail, but it didn&#x2019;t. Instead, it created the following schema:&#xA;&#xA; &#xA;&#xA;That is a problem, DDL should never run as an implicit step. I couldn&#x2019;t figure out how to disable that, though (but I didn&#x2019;t look too hard). To be fair, this looks like it will only run if the database doesn&#x2019;t exists (not only if the tables aren&#x2019;t there). But I would still make this an explicit step.&#xA;&#xA;The result of running the code is:&#xA;&#xA; &#xA;&#xA;Now the time came to try executing my queries:&#xA;&#xA;var actionsForUser = &#xA;    (&#xA;        from action in ctx.Actions&#xA;        where action.User.Username == &quot;Ayende&quot;&#xA;        select action&#xA;    )&#xA;    .ToList();&#xA;&#xA;var remindersForToday =&#xA;    (&#xA;        from reminder in ctx.Actions.OfType&lt;Reminder&gt;()&#xA;        where reminder.Date == DateTime.Today&#xA;        select reminder&#xA;    )&#xA;    .ToList();&#xA;&#xA;&#xA;Which resulted in:&#xA;&#xA; &#xA;&#xA;That has been a pretty brief overview of Entity Framework Code Only, but I am impressed, the whole process has been remarkably friction free, and the time to go from nothing to a working model has been extremely short.</p>
        </article>
        <article id="article-5267">
            <a href="https://ayende.com/blog/4582/if-i-run-dev-div" target="_blank">
                <h2 class="title mb-6" id="article-5267">If I run Dev Div&#x2026;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 10, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I found this post interesting, so I thought that I would try to answer it.  If I run Dev Div, I would:     Utilize CodePlex Foundation to a much higher degree. Right now CPF manages about 6 projects, all of them seems to originate from Microsoft. None of them are actually useful for CPF in the sense of creating an excitement around it. If I run Dev Div, and given the indication of the lack of will from within Microsoft to maintain the DLR, I would give the CPF the DLR, along with a small budget (1 million annually should more than cover that) and set it free. That 1 million? I would put it down as marketing, because the amount of good will that you&#x2019;ll generate from doing that is enormous. And the level of publicity that you&#x2019;ll get for CPF is huge.   &#xA0;     Sit down with marketing and create a new set of personas, based on what is actually happening in the real world. Mort, Einstein and that Elvis dude might be good when you are building the product and designing the API, but there are other aspects to consider, and acceptance in the community is important. A lot of the public blunders that Microsoft has made recently has been just that, marketing mistakes more than anything else.    &#xA0;     Build for each project a set of scenarios that appeal to each group. For the PHP crowd, point out how WebMatrix makes their life simple. For the ALT.Net crowd, show them how they can use IIS Express to run their unit tests without requiring anything installed. Right now what is going on is that pushing to one side alienate the other.     Let me put this another way, when someone asks me why use NHibernate instead of Entity Framework, I am going to inform them that Microsoft continues their trend of new Data Access framework every two years, and they have gone retro with Microsoft.Data.    &#xA0;     Kill duplicated effort before it goes out the door. Linq to SQL &amp; Entity Framework are a great example of things that should have been developed concurrently (because either project had a chance of failure, so hedging your bets is good, if you can afford that), but they should have never been allowed to both see the light of day. The marketing damage from moving Linq to SQL to maintenance mode was huge.   &#xA0;     Simplify, simplify, simplify! Microsoft does a lot of good things, but they tend to provide solutions that are wide scoped and complex. Often enough, so complex that people just give up on them. Case in point, if at all possible, I wouldn&#x2019;t use WCF for communication. I would rather role my own RPC stack, because that makes things easier. That is a Fail for Microsoft in many cases, and one of the reasons that they are leaking developers to other platforms.   &#xA0;     Forbid developers from arguing with customers publically about policy decisions. The reasoning is simple, devs don&#x2019;t have a lot (if any) impact on policy decisions, they can explain them, sure. But when there is disagreement, having an argument about it tends to end up with bad blood in the water. Such discussions should be done at a level that can actually do something. Case in point, recent WebMatrix arguments in twitter &amp; blogs.    &#xA0;     Focus some love &amp; attention toward the non entry level segment of the market. There has been a worrying set of events recently that indicate a shift in focus toward the entry level market, and the rest of developers are feeling abandoned. That shouldn&#x2019;t be allowed to remain this way for long.   If you&#x2019;ll not, except for the suggestion about turning simplification to an art form and applying it ruthlessly, most of the suggestions are actually about marketing and positioning, not about product development.</p>
        </article>
        <article id="article-5268">
            <a href="https://ayende.com/blog/4581/breaking-the-c-compiler-again" target="_blank">
                <h2 class="title mb-6" id="article-5268">Breaking the C# compiler, again</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 10, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Take a look at the following code:             1:  var docs = new dynamic[0];&#xA;&#xA;       2:  var q = from doc in docs&#xA;&#xA;       3:          where doc[&quot;@metadata&quot;][&quot;Raven-Entity-Name&quot;] == &quot;Cases&quot;&#xA;&#xA;       4:          where doc.AssociatedEntities != null&#xA;&#xA;       5:          from entity in doc.AssociatedEntities&#xA;&#xA;       6:          where entity.Tags != null // COMPILER ERROR HERE&#xA;&#xA;       7:          from tag in entity.Tags&#xA;&#xA;       8:          where tag.ReferencedAggregate != null&#xA;&#xA;       9:          select new {tag.ReferencedAggregate.Id, doc.__document_id};        &#xA;  &#xA;  &#xA;&#xA;It doesn&#x2019;t compiles, complaining about an error in line 6 (The property &#x27;&lt;&gt;h__TransparentIdentifier0&#x27; cannot be used with type arguments).&#xA;&#xA;Leaving aside the issue with the error itself, which is about as useful as C&#x2B;&#x2B; template errors, I have a strongly issue with this.&#xA;&#xA;What do you think can fix this error? Well, if you remove line 8 (!), it just works:&#xA;&#xA;&#xA;  &#xA;       1:  var docs = new dynamic[0];&#xA;&#xA;       2:  var q = from doc in docs&#xA;&#xA;       3:          where doc[&quot;@metadata&quot;][&quot;Raven-Entity-Name&quot;] == &quot;Cases&quot;&#xA;&#xA;       4:          where doc.AssociatedEntities != null&#xA;&#xA;       5:          from entity in doc.AssociatedEntities&#xA;&#xA;       6:          where entity.Tags != null&#xA;&#xA;       7:          from tag in entity.Tags&#xA;&#xA;       8:          select new { tag.ReferencedAggregate.Id, doc.__document_id };&#xA;  &#xA;  &#xA;&#xA;There are several things that I can&#x2019;t figure out:&#xA;&#xA;&#xA;  Why am I getting an error?&#xA;&#xA;  Why removing a line after the error fixes the error in the line before it.&#xA;&#xA;&#xA;What I suspect is that the error reporting (which in C# is usually damn good) is getting confused with the error reporting location.&#xA;&#xA;To make things worse, this code will crash VS 2010 every single time. I am actually editing this in notepad!!!&#xA;&#xA;Here is the set of extensions methods that I use here:&#xA;&#xA;&#xA;  public static class LinqOnDynamic&#xA;{&#xA;    private static IEnumerable&lt;dynamic&gt; Select(this object self)&#xA;    {&#xA;        if (self == null)&#xA;            yield break;&#xA;        if (self is IEnumerable == false || self is string)&#xA;            throw new InvalidOperationException(&quot;Attempted to enumerate over &quot; &#x2B; self.GetType().Name);&#xA;&#xA;        foreach (var item in ((IEnumerable) self))&#xA;        {&#xA;            yield return item;&#xA;        }&#xA;    }&#xA;&#xA;    public static IEnumerable&lt;dynamic&gt; SelectMany(this object source,&#xA;                                                    Func&lt;dynamic, int, IEnumerable&lt;dynamic&gt;&gt; collectionSelector,&#xA;                                                    Func&lt;dynamic, dynamic, dynamic&gt; resultSelector)&#xA;    {&#xA;        return Enumerable.SelectMany(Select(source), collectionSelector, resultSelector);&#xA;    }&#xA;&#xA;    public static IEnumerable&lt;dynamic&gt; SelectMany(this object source,&#xA;                                                    Func&lt;dynamic, IEnumerable&lt;dynamic&gt;&gt; collectionSelector,&#xA;                                                    Func&lt;dynamic, dynamic, dynamic&gt; resultSelector)&#xA;    {&#xA;        return Enumerable.SelectMany(Select(source), collectionSelector, resultSelector);&#xA;    }&#xA;&#xA;    public static IEnumerable&lt;dynamic&gt; SelectMany(this object source,&#xA;                                                    Func&lt;object, IEnumerable&lt;dynamic&gt;&gt; selector)&#xA;    {&#xA;        return Select(source).SelectMany&lt;object, object&gt;(selector);&#xA;    }&#xA;&#xA;    public static IEnumerable&lt;dynamic&gt; SelectMany(this object source,&#xA;                                                                    Func&lt;object, int, IEnumerable&lt;dynamic&gt;&gt; selector)&#xA;    {&#xA;        return Select(source).SelectMany&lt;object, object&gt;(selector);&#xA;&#xA;    }&#xA;}&#xA;  &#xA;&#xA;WTF?!</p>
        </article>
        <article id="article-5269">
            <a href="https://ayende.com/blog/4580/financial-analysis" target="_blank">
                <h2 class="title mb-6" id="article-5269">Financial analysis</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 09, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I decided to spend some time with Excel trying to do a look back at how things are doing. I am not going to give you numbers, but the trends in the data are interesting. All the data is relevant to this year only.  &#xA0;     Tell me that the top one doesn&#x2019;t remind you of a rude gesture. As you can see, NHibernate rules the roost here, on the bottom, it is even clearer. I think that a lot of that is that I am closely related to NHibernate that is making the difference.                    Looking at the data over time gives me a very interesting perspective about the introduction of subscriptions. That was expected, but I don&#x2019;t think that I really grokked that. Looking at the bottom image, I can tell you that subscriptions are pretty big, from the point of view of license numbers, but they are much weaker from the point of view of money in the bank.I knew that, I even wanted that, since the whole point of subscriptions was to get sustainable revenue stream rather than money today. But I wasn&#x2019;t really ready for that.     This one is particularly annoying, because there is a dry spot around the 20th every single month, and I get abandonment anxiety at that time.  That is it for now :-)</p>
        </article>
        <article id="article-5270">
            <a href="https://ayende.com/blog/4579/nhibernate-tooling-review-llblgen-pro-3-0" target="_blank">
                <h2 class="title mb-6" id="article-5270">NHibernate Tooling Review: LLBLGen Pro 3.0</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 08, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is part of what looks to be long series of posts about tooling relating to NHibernate. &#xA;In this case, I want to talk about LLBLGen Pro. &#xA;LLBLGen Pro&#xA0;3.0 is an OR/M tool that also comes with an NHibernate option. Because it is the GUI tool to manage NHibernate mapping that I am testing, I am going to show a lot of screenshots. Also, please note that I am using this without any foreknowledge, reading the docs, or anything. I am also not going to do an in depth discussion, just use it to see how those things are working. &#xA;After installation, we start a new project: &#xA; &#xA;Which give us the following (scary) dialog. Note all the tabs in the bottom. There is a huge number of options and knows that you can tweak. &#xA; &#xA;The next step that I wanted to do is to see how it handles an existing data model, so I decided to add the test model that I use for NHibernate: &#xA;  &#xA;This takes about zero time and gives us the entities. It properly recognize 1:m associations, but I had to define the m:n associations myself. I am not sure if this is what I am supposed to do or if I just missed something. What is impressive is that the schema in question is actually being generated from NHibernate through the SchemaExport tool. So we went a full cycle, NHibernate mapping, schema, extracting everything to the following model: &#xA; &#xA;I wonder if I can get LLBLGen Pro&#xA0;to read a set of NHibernate mapping as well, because this view of the mapping can be very useful. &#xA;But enough talking about the UI, there are a lot of tools that have great UI, I want to see what code it generates. &#xA;As an aside, I like this part of the code generation: &#xA; &#xA;Not so much because what there is there, but because it implies how the code generation process itself is structured. &#xA;I was surprised when I saw this: &#xA;  &#xA;It brought back flashbacks of 1.0, but they are empty, I assume that this is vestigial remain in the template. &#xA;I don&#x2019;t like that CategoriesPost is there, but I couldn&#x2019;t figure out how to remove it, this isn&#x2019;t an entity, it is an association table. &#xA;Looking at the code, there is one thing that really bothers me, take a look at the property definitions. How do you set that? &#xA; &#xA;I am pretty sure that I did something to cause that, but I really don&#x2019;t have any idea what. &#xA;&#xA;Update: (This is written before the post is published, but after I had time to review what I did). It appears that I played with too many settings, there is an option called EmitFieldSetter that I accidently set to false. The idea behind this setting that you want to allow setting properties via methods, not via direct properties.&#xA;&#xA;I&#x2019;ll ignore that for now, and look at the rest of the code. In addition to the Model project, LLBLGen Pro&#xA0;also generates the Persistence project: &#xA; &#xA;I was quite surprised to see that it uses class maps, but then I looked at the code: &#xA;&#xA;/// &lt;summary&gt;Represents the mapping of the &#x27;Blog&#x27; entity, represented by the &#x27;Blog&#x27; class.&lt;/summary&gt;&#xA;public class BlogMap : ClassMap&lt;Blog&gt;&#xA;{&#xA;    /// &lt;summary&gt;Initializes a new instance of the &lt;see cref=&quot;BlogMap&quot;/&gt; class.&lt;/summary&gt;&#xA;    public BlogMap()&#xA;    {&#xA;        Table(&quot;[dbo].[Blogs]&quot;);&#xA;        OptimisticLock.Version();&#xA;        LazyLoad();&#xA;&#xA;        Id(x=&gt;x.Id)&#xA;            .Access.CamelCaseField(Prefix.Underscore)&#xA;            .Column(&quot;Id&quot;)&#xA;            .GeneratedBy.Identity();&#xA;        Map(x=&gt;x.AllowsComments).Access.CamelCaseField(Prefix.Underscore);&#xA;        Map(x=&gt;x.CreatedAt).Access.CamelCaseField(Prefix.Underscore);&#xA;        Map(x=&gt;x.Subtitle).Access.CamelCaseField(Prefix.Underscore);&#xA;        Map(x=&gt;x.Title).Access.CamelCaseField(Prefix.Underscore);&#xA;&#xA;        HasMany(x=&gt;x.Posts)&#xA;            .Access.CamelCaseField(Prefix.Underscore)&#xA;            .Cascade.AllDeleteOrphan()&#xA;            .Fetch.Select()&#xA;            .AsSet()&#xA;            .Inverse()&#xA;            .LazyLoad()&#xA;            .KeyColumns.Add(&quot;BlogId&quot;);&#xA;        HasManyToMany(x=&gt;x.Users)&#xA;            .Access.CamelCaseField(Prefix.Underscore)&#xA;            .Cascade.AllDeleteOrphan()&#xA;            .Fetch.Select()&#xA;            .AsSet()&#xA;            .Table(&quot;[dbo].[UsersBlogs]&quot;)&#xA;            .ParentKeyColumns.Add(&quot;BlogId&quot;)&#xA;            .ChildKeyColumns.Add(&quot;UserId&quot;);&#xA;&#xA;    } &#xA;} &#xA;&#xA;That is highly readable, and a lot of people prefer that, and I guess it is easier than generating the XML. &#xA;Did you see the SessionManager class? It also handles all the wiring of NHibernate, so you can start using it by just getting the session: &#xA;&#xA;SessionManager.OpenSession()&#xA;&#xA;Overall, very impressive. From installation to working code (except that annoying no setter thingie), it took mere minutes, and the code is clean. That is one of the things that I always hated with code generators, they generally produce crappy code, so I was very happy to see how the code looked like. &#xA;Now, after the whirlwind tour, let me see if I can look at more of the options. &#xA;Oh, it looks like it can generate HBM files, let us give that a try: &#xA;&#xA;&lt;class name=&quot;Blog&quot; table=&quot;[dbo].[Blogs]&quot; optimistic-lock=&quot;version&quot; &gt;&#xA;    &lt;id name=&quot;Id&quot; column=&quot;Id&quot; access=&quot;field.camelcase-underscore&quot; &gt;&#xA;        &lt;generator class=&quot;identity&quot;/&gt;&#xA;    &lt;/id&gt;&#xA;    &lt;property name=&quot;AllowsComments&quot; column=&quot;AllowsComments&quot; access=&quot;field.camelcase-underscore&quot;/&gt;&#xA;    &lt;property name=&quot;CreatedAt&quot; column=&quot;CreatedAt&quot; access=&quot;field.camelcase-underscore&quot;/&gt;&#xA;    &lt;property name=&quot;Subtitle&quot; column=&quot;Subtitle&quot; access=&quot;field.camelcase-underscore&quot;/&gt;&#xA;    &lt;property name=&quot;Title&quot; column=&quot;Title&quot; access=&quot;field.camelcase-underscore&quot;/&gt;&#xA;    &lt;set name=&quot;Posts&quot; access=&quot;field.camelcase-underscore&quot; cascade=&quot;all-delete-orphan&quot; inverse=&quot;true&quot; fetch=&quot;select&quot;&gt;&#xA;        &lt;key&gt;&#xA;            &lt;column name=&quot;BlogId&quot;/&gt;&#xA;        &lt;/key&gt;&#xA;        &lt;one-to-many class=&quot;Post&quot;/&gt;&#xA;    &lt;/set&gt;&#xA;    &lt;set name=&quot;Users&quot; access=&quot;field.camelcase-underscore&quot; table=&quot;[dbo].[UsersBlogs]&quot; cascade=&quot;all-delete-orphan&quot; fetch=&quot;select&quot;&gt;&#xA;        &lt;key&gt;&#xA;            &lt;column name=&quot;BlogId&quot;/&gt;&#xA;        &lt;/key&gt;&#xA;        &lt;many-to-many class=&quot;User&quot;&gt;&#xA;            &lt;column name=&quot;UserId&quot;/&gt;&#xA;        &lt;/many-to-many&gt;&#xA;    &lt;/set&gt;&#xA;&lt;/class&gt;&#xA;&#xA;There is one main thing to note here, this looks pretty much like it was written by a human. There are still some things to improve, but compare that to the output of Fluent NHibernate, and you&#x2019;ll see that this is generating something that is much easier to work with. &#xA;Some things that still bothers me: &#xA;&#xA;    Kick all the access=&#x201D;field.camelcase-underscore&#x201D; to the default-access on the &lt;hibernate-mapping&gt; element, that would remove a lot of duplication. &#xA;    The table=&#x201D;[dbo].[UsersBlogs]&#x201D; should be table=&#x201D;`UsersBlogs`&#x201D; schema=&#x201D;`dbo`&#x201D;, and I would skip the catalog if it is dbo already. &#xA;    The class contains an optimistic-lock=&#x201D;version&#x201D;, but there is no version column, so this should go away as well. The same error appears in the fluent nhibernate mapping as well. &#xA;&#xA;Let us see what else I can play with. &#xA;There is something called Typed Views, which I didn&#x2019;t understand at first: &#xA; &#xA;It appears that instead of generating an entity (which has associations, collections, references, etc), this build just a bare bone class to hold the data. The purpose, I believe, is to use this for reporting/binding scenarios, in which case a view model is much more appropriate. This is one features that the CQRS guys are probably going to like. &#xA;Oh, I found the m:n option: &#xA; &#xA;With that, I get: &#xA; &#xA;I probably need to change the name generation pattern, though :-) &#xA;I would suggest running the labels on the UI through PascalCaseToSentence, though. That is, instead of having to read AutoAddManyToManyRelationships, turn that to &#x201C;Auto add many to many relationships&#x201D;. &#xA;There is another feature, called TypedList, which gives you a query designer for building NHibernate queries (they are translated to HQL) which looked nice, but I haven&#x2019;t looked at too closely. The way I usually work, queries are too context sensitive to allow to create the sort of query library that would make this feature useful. &#xA;This has been a very short run through LLBLGen Pro&#xA0;in its NHibernate mode. Overall, it looks very impressive, and it generates the best code that I have seen yet out of a tool. Good enough to take and use as is. &#xA;The only detraction that I could find is the name, (yes, I know that I talked about this before), LLBLGen Pro just doesn&#x2019;t roll off the tongue.</p>
        </article>
        <div class="button flex justify-between">
            <a href="526.html"><span class="back arrow"></span></a>

            <a href="528.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>