
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 387 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-3861">
            <a href="https://ayende.com/blog/165604/time-series-feature-design-querying-over-large-data-sets" target="_blank">
                <h2 class="title mb-6" id="article-3861">Time series feature design</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 20, 2014
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">What happens when you want to do an aggregation query over very large data set? Let us say that you have 1 million data points within the range you want to query, and you want to get a rollup of all the data in the range of a week. As it turns out, there is a relatively simple solution for optimizing this and maintaining a relatively constant query speed, regardless of the actual data set size. Time series data has the great benefit of being easily aggregated. Most often, the data looks like this:  The catch is that you have a lot of it.  The set of aggregation that you can do over the data is also relatively simple. You have mean, max, min, std deviation, etc. The time ranges are also pretty fixed, and the nice thing about time series data is that the bigger the range you want to go over, the bigger your rollup window is. In other words, if you want to look at things over a week, you would probably use a day or hour rollup. If you want to see things over a month, you will use a week or a day, over a year, you&#x2019;ll use a week or a month, etc. Let us assume that the cost of aggregation is 10,000 operations per second (just some number I pulled because it is round and nice to work with, real number is likely several orders of magnitude higher). So if we have to run this over a set that is 1 million data points in size, with the data being entered on per minute basis. With 1 million data points, we are going to wait almost two minutes for the reply. But there is really no need to actually check all those data points manually. What we can do is actually prepare, ahead of time, the rollups on an hourly basis. That gives us a summary on a per hour basis of just over 16 thousand data points, and will result in a query that runs in under 2 seconds. If we also do a daily rollup, we move from having a million data points to less than a thousand.  Actually maintaining those computed rollups would probably be a bit complex, but it won&#x2019;t be any more complex than how we are computing map/reduce indexes in RavenDB (this is a private, and simplified, case of map/reduce). And the result would be instant query times, even on very large data sets.</p>
        </article>
        <article id="article-3862">
            <a href="https://ayende.com/blog/165603/time-series-feature-design-scale-out-high-availability" target="_blank">
                <h2 class="title mb-6" id="article-3862">Time series feature design</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 19, 2014
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I expect (at a bare minimum), to be able to do about 25,000 sustained writes per second on a single machine. I actually expect to be able to do significantly more. But let us go with that amount for now as something that if it drops below that value, we are in trouble. Over a day, that is 2.16 billion records. I don&#x2019;t think this likely, but that is a lot of data to work with. That leads to interesting questions on scale out story. Do we need one? Well, probably not for performance reasons (said the person who haven&#x2019;t written the code, much less benchmarked it) at least not if my hope for the actual system performance comes about. However, just writing the data isn&#x2019;t very interesting, we also need to read and work with it. One of the really nice thing about time series data is that it is very easily sharded, because pretty much all the operations you have are naturally accumulative. You have too much data for a single server, go ahead and split it. On query time, you can easily merge it all back up again and be done with it. However, a much more interesting scenario for us is the high availability / replication story. This is where things gets&#x2026; interesting. With RavenDB, we do async server side replication. With time series data, we can do that (and we have the big advantage of not having to worry about conflicts), but the question is how. The underlying mechanism for all the replication in RavenDB is the notion of etags, of a way to track the order of changes to the database. In time series data, that means tracking the changes that happens in some form of a sane fashion. It means having to track, per write, at least another 16 bytes. (8 bytes for a monotonically increasing etag number, another 8 for the time that was changed). And we haven&#x2019;t yet spoken of things like replication of deletes, replication of series tag changes, etc. I can tell you that dealing with replication of deletes in RavenDB, for example, was no picnic.  A much simpler alternative would be to not handle this at the data level. One nice thing about Voron is that we can actually do log shipping. That would trivially solve pretty much the entire problem set of replication, because it would happen at the storage layer, and take care of all of it. However, it does come with its own set of issues. In particular, it means that the secondary server has to be read only, it cannot accept any writes. And by that I mean that it would physically reject them. That leads to a great scale out story with read replicas, but it means that you have to carefully consider how you are dealing the case of the primary server going down for a duration, or any master/master story. I am not sure that I have any good ideas about this at this point in time. I would love to hear suggestions.</p>
        </article>
        <article id="article-3863">
            <a href="https://ayende.com/blog/165602/time-series-feature-design-user-interface" target="_blank">
                <h2 class="title mb-6" id="article-3863">Time series feature design</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 18, 2014
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We need one.&#xA0; But that is pretty much all I have to say about it. Most of the ways you&#x2019;ve to look at time series data end up something like this:  But before you can get here, you need to handle:  Looking at series Inspecting raw series data Tagging / searching series Looking at the roll up values across different dates for different series Delete data (full series or range of data) Probably other stuff, but those are the things that I can think of. Probably a good place to do a lot of graphs, too, just to let the users play with the data. But that is what I have in mind here so far. Oh, and quite obviously, we want to be able to output everything to CSV so users can look at that in Excel, of course.</p>
        </article>
        <article id="article-3864">
            <a href="https://ayende.com/blog/165601/time-series-feature-design-client-api" target="_blank">
                <h2 class="title mb-6" id="article-3864">Time series feature design</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 17, 2014
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We have gone over the system behavior, the wire protocol and how we actually store the data on disk. Now, let us talk about the actual client API. The entry point is going to the TimeSeries class, which will have the following behavior: Stateless operations:  Queries:  timeSeries.Query(&#x201C;sensor1.heat&#x201D;, &#x201C;sensor1.flow&#x201D;)&#xA0;&#xA0; .Range(start,end)&#xA0;&#xA0; .Rollup(Rollup.Weekly)&#xA0;&#xA0; .Aggergation(AggergateBy.Max, AggergateBy.Min, AggergateBy.Mean); timeSeries.SeriesBy(&#x201C;temp:C&#x201D;); Operations:  timeSeries.Delete(&#x201C;sensor1.heat&#x201D;, start, end); timeSeries.Tag(&#x201C;sensor1.heat&#x201D;, &#x201C;temp:C&#x201D;); Those types of operations have no state, require nothing beyond just knowing where the server is located and can be immediately executed without requiring any external state. The returned results aren&#x2019;t tracked or managed&#xA0; by us in any way, so there is no need for a session.&#xA0;  Stateful operation - The only stateful operation we have (at least so far) is adding data to the database. We do that using the connection abstraction. This is very close to the actual on the wire representation, which is always good. We have something like:      1: using(var con = timeSeries.OpenConnection(waitForServerFlush: true))   2: {   3:     using(var series = con.AddToSeries(&quot;sensor1.heat&quot;))   4:     {   5:         for(var i = 0; i &lt; 100; i&#x2B;&#x2B;)    6:         {   7:             series.Add(time.AddMinutes(i), value &#x2B; i);   8:         }   9:     }  10: }&#xA;This is a bit of an awkward API, but it serves a purpose, it is very close to the way the on-wire format is, and it is optimized for performance, not for being nice.&#xA;We can also have:&#xA;&#xA;con.Add(&#x201C;sensor1.heat&#x201D;, time, value);&#xA;But if you are mixing things up (add sensor1.heat, sensor1.flow and then sensor1.heat again, etc), it probably won&#x2019;t be as efficient. (It is important to be able to expose those optimizations all the way from the disk to the wire to the client API. Most times, they don&#x2019;t matter, which is why we have the higher level API, but when they do, they really do.&#xA;And&#x2026; this is pretty much it.&#xA;The API will probably be an async one, to keep up with the times, but those are pretty much the high level things that we have here.</p>
        </article>
        <article id="article-3865">
            <a href="https://ayende.com/blog/165825/from-ravendb-with-love" target="_blank">
                <h2 class="title mb-6" id="article-3865">From RavenDB, with love</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 14, 2014
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">For Valentine day, we are going to have a special sale for the upcoming RavenDB conference. The sale is for 2 or more tickets only.  RavenDB Conference &amp; Workshop Special Offer &#x2013; Save 700$  RavenDB Conference &#x2013; Special Offer &#x2013; Save 28$</p>
        </article>
        <article id="article-3866">
            <a href="https://ayende.com/blog/165573/time-series-feature-design-system-behavior" target="_blank">
                <h2 class="title mb-6" id="article-3866">Time series feature design</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 14, 2014
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">It is easy to forget that a database isn&#x2019;t just about storing and retrieving data. A lot of work goes into the actual behavior of the system beyond the storage aspect.  In the case of time series database, just storing the data isn&#x2019;t enough, we very rarely actually want to access all the data. If we have a sensor that send us a value once a minute, that comes to 43,200 data points per month. There is very little that we actually want to do for that amount of data. Usually we want to do things over some rollup of the data. For example, we might want to see the mean per day, or the standard deviation on a weakly basis, etc. We might also want to do some down sampling. By that I mean that we take a series whose value is stored on a per minute / second basis and we want to store just the per day totals and delete the old data to save space. The reason that I am using time series data for this series of blog posts is that there really isn&#x2019;t all that much that you can do for a time series data, to be honest. You store it, aggregate over it, and&#x2026; that is about it. Users might be able to do derivations on top of that, but that is out of scope for a database product.  Can you think about any other behaviors that the system needs to provide?</p>
        </article>
        <article id="article-3867">
            <a href="https://ayende.com/blog/165572/time-series-feature-design-the-wire-format" target="_blank">
                <h2 class="title mb-6" id="article-3867">Time series feature design</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 13, 2014
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Now that we actually have the storage interface nailed down, let us talk about how we are going to actually expose this over the wire. The storage interface we defined is really low level and not something that I would really care to try working with if I was writing user level code. Because we are in the business of creating databases, we want to allow this to run as a server, not just as a library. So we need to think about how we are going to expose this over the wire. There are several options here. We can expose this as a ZeroMQ service, sending messages around. This looks really interesting, and would certainly be a great research to do, but it is a foreign concept for most people, and it would have to be exposed as such through any API we use, so I am afraid we won&#x2019;t be doing that. We can write a custom TCP protocol, but that has its own issues. Chief among which, just like ZeroMQ, we would have to deal, from scratch with things like:  Authentication Tracing Debugging Hosting Monitoring Easily &#x201C;hackable&#x201D; format Replayability And probably a whole lot more on top of that. I like building the wire interface over some form of HTTP interface (I intentionally don&#x2019;t use the overly laden REST word). We get a lot of things for free, in particular, we get easy ability to do things like pipe stuff through Fiddler so we can easily debug them. That also influence decisions such as how to design the wire format itself (hint, human readable is good). I want to be able to easily generate requests and see them in the browser. I want to be able to read the fiddler output and figure out what is going on We actually have several different requirements that we need to do.   Enter data Query data Do operations Entering data is probably the most interesting aspect. The reason is that we need to handle inserting many entries in as efficient a manner as possible. That means reduce the number of server round trips. At the same time, we want to keep other familiar aspects, such as the ability to easily predict when the data is &#x201C;safe&#x201D; and the storage transaction has been committed to disk. Querying data and handling one off operations is actually much easier. We can handle it via a simple REST interface:  /timeseries/query?start=2013-01-01&amp;end=2014-01-01&amp;id=sensor1.heat&amp;id=sensor1.flow&amp;aggregation=avg&amp;period=weekly /timeseries/delete?id=sensor1.heat&amp;id=sensor1.flow&amp;start=2013-01-01&amp;end=2014-01-01 /timeseries/tag?id=sensor1.heat&amp;tag=temp:C Nothing much to it, so far. We expose it as JSON endpoints, and that is&#x2026; it. For entering data, we need something a bit more elaborate. I chose to use websockets for this, mostly because I want two way communication and that pretty much force my hand. The reason that I want to use two way communication mechanism is that I want to enable the following story:  The client send the data to the server as fast as it is able to. The server will aggregate the data and will decide, base on its own consideration, when to actually commit the data to disk. The client need some way of knowing when the data it just sent is actually flushed so it can rely on it. the connection should stay open (potentially for a long period of time) so we can keep sending new stuff in without having to create a new connection. As far as the server is concerned, by the way, it will decide to flush the pending changes to disk whenever:   over 50 ms passed waiting for the next value to arrive, or it has been at least 500 ms from the last flush, or there are over 16,384 items pending, or the client indicated that it wants to close the connection, or the moon is full on a Tuesday However, how does the server communicate that to the client? The actual format we&#x2019;ll use is something like this (binary, little endian format):      1: enter-data-stream =     2:    data-packet&#x2B;   3:&#xA0;    4: data-packet =    5:    series-name-len [4 bytes]   6:    series-name [series-name-len, utf8]   7:    entries   8:    no-entries   9:&#xA0;   10: entries =  11:    count [2 bytes]  12:    entry[count]  13:&#xA0;   14: no-entries =  15:    count [2 bytes] = 0  16:&#xA0;   17: entry =  18:    date [8 bytes]     19:    value [8 bytes]&#xA;The basic idea is that this format should be pretty good in conveying just enough information to send the data we need, and at the same time be easy to parse and work with. I am not sure if this is a really good idea, because this might be premature optimization and we can just send the data as json strings. That would certainly be more human readable. I&#x2019;ll probably go with that and leave the &#x201C;optimized binary approach&#x201D; for when/if we actually see a real need for it. The general idea is that computer time is much cheaper than human time, so it is worth the time to make things human readable.&#xA;The server keep tracks of the number of entries that were sent to it for each connection, and whenever it is flushing the buffered data to disk, it will send notification to that effect to the client. The client can then decide &#x201C;okay, I can notify my caller that everything that I have sent has been properly saved to disk&#x201D;. Or it can just ignore it (usual case if they have a long running connection).&#xA;And that is about it as far as the wire protocol is concerned. Next, we will take a look at some of the operations that we need.</p>
        </article>
        <article id="article-3868">
            <a href="https://ardalis.com/walking-while-working/" target="_blank">
                <h2 class="title mb-6" id="article-3868">Walking While Working</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 12, 2014
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">DSC_0031 - Cropped Staying in shape as a programmer can be difficult, but recent studies have shown that even if you&#x27;re among those in our&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-3869">
            <a href="https://ayende.com/blog/165571/time-series-feature-design-storage" target="_blank">
                <h2 class="title mb-6" id="article-3869">Time series feature design</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 12, 2014
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post, we are going to talk about the actual design for a time series feature, from a storage perspective. For the purpose of the discussion, I am going to assume the low level Voron as the underlying storage engine. We are going to need to store the data in a series. And the actual data is going to be relatively ordered (time based, usually increasing). As such, I am going to model the data itself as a set of Voron trees, one tree per each series that is created. The actual data in each tree would be composed of key and value, that are each 8 bytes long.  Key (8 bytes): 100-nanosecond interval between Jan 1, 0001 to Dec 31, 9999. Val (8 bytes): 64 bits double precision floating point number. There can be do duplicate values for a specific time in a series. Since this represent one ten millionth of a second, that should be granular enough, I think. Reading from the storage will always be done on a series basis. The idea is to essentially use the code from this post, but to simplify to a smaller key.&#xA0; The idea is that we can store roughly 250 data points in each Voron page. Which should give us some really good performance for both reads &amp; writes. Note that we need to provide storage API to do bulk writes, since there are some systems that would require it. Those can either be systems with high refresh rates (a whole set of sensors with very low refresh rates) or, more likely, import scenarios. The import scenario can be either a one time (moving to a new system), or something like a nightly batch process where we get the aggregated data from multiple sources.  For our purposes, we aren&#x2019;t going to distinguish between the two. We are going to provide and API similar to:   void Add(IEnumerable&lt;Tuple&lt;string,IEnumerable&lt;Tuple&lt;DateTime, double&gt;&gt;&gt; data);&#xA;&#xA;&#xA;This ugly method can handle updates to multiple series at once. In human speak, this is an enumerable of updates to a series where each update is the time and value for that time. From the storage perspective, this creates a single transaction where all the changes are added at once, or not at all. It is the responsibility of higher level code to make sure that we optimize number of calls vs. in flight transaction data vs. size of transactions.&#xA;Adding data to a series that doesn&#x2019;t exists will create it.&#xA;We also assume that series names is up to printable Unicode characters of up to 256 bytes (UTF8).&#xA;The read API is going to be composed of:&#xA;&#xA;IEnumerable&lt;Tuple&lt;DateTime, double&gt;&gt; ScanRange(string series, DateTime start, DateTime end);&#xA;IEnumerable&lt;Tuple&lt;DateTime, double[]&gt;&gt; ScanRanges(string []series, DateTime start, DateTime end);&#xA;Anything else would have to be done at a higher level.&#xA;There is no facility for updates. You can just add again on the same time with a new value, and while this is supported, this isn&#x2019;t something that is expected.&#xA;Deleting data can be done using:&#xA;&#xA;void Delete(string series, DateTime start, DateTime end);&#xA;void DeleteAll(string series);&#xA;The first option will delete all the items in range. The second will delete the entire tree. The second is probably going to be much faster. We are probably better off checking to see if the max / min ranges for the tree are beyond the items for this series and falling to DeleteAll if we can. Explicit DeleteAll will also delete all the series tags. While implicit Delete(&#x201C;series-1&#x201D;, DateTime.MinValue, DateTime.MaxValue) for example will delete the series&#x2019; tree, but keep the series tags.&#xA;Series can have tags attached to it. Those can be any string up to 256 bytes (UTF8). By conventions, they would usually be in the form of &#x201C;key:val&#x201D;.&#xA;Series can be queried using:&#xA;&#xA;IEnumerable&lt;string&gt; GetSeries(string start = null);&#xA;IEnumerable&lt;string&gt; GetSeriesBy(string tag, string start = null);&#xA;IEnumerable&lt;string&gt; GetSeriesTags(string  series);&#xA;Series can be tagged using:&#xA;&#xA;void TagSeries(string series, string []tags);&#xA;There can be no duplicate tags.&#xA;In summary, the interface we intend to use for storage would look roughly like the following:&#xA;public interface ITimeSeriesStorage&#xA;{&#xA;    void Add(IEnumerable&lt;Tuple&lt;string,IEnumerable&lt;Tuple&lt;DateTime, double&gt;&gt;&gt; data);&#xA;    IEnumerable&lt;Tuple&lt;DateTime, double&gt;&gt; ScanRange(string series, DateTime start, DateTime end);&#xA;    IEnumerable&lt;Tuple&lt;DateTime, double[]&gt;&gt; ScanRanges(string []series, DateTime start, DateTime end);&#xA;    void Delete(string series, DateTime start, DateTime end);&#xA;    void DeleteAll(string series);&#xA;    IEnumerable&lt;string&gt; GetSeries(string start = null);&#xA;    IEnumerable&lt;string&gt; GetSeriesBy(string tag, string start = null);&#xA;    IEnumerable&lt;string&gt; GetSeriesTags(string series);&#xA;    void TagSeries(string series, string []tags);&#xA;}&#xA;Data sizes &#x2013; assume 1 value per minute per series, that gives us an update rate of 1,440 updates per day or 525,600 per year. That means that for 100,000 sensors (not an uncommon amount) we need to deal with 52,560,000,000 data items per year. This would probably end up being just over 3 GB or so. Assuming 1 value per second, that gives us 86,400 values per day, 31,536,000 per year and 3,153,600,000,000 values per year for the 100,000 sensors will user about 184 GB or so. Those seems to be eminently reasonable values for the data size that we are talking about here.&#xA0; &#xA;Next, we&#x2019;ll discuss how this is all going to look like over the wire&#x2026;</p>
        </article>
        <article id="article-3870">
            <a href="https://ayende.com/blog/165570/time-series-feature-design" target="_blank">
                <h2 class="title mb-6" id="article-3870">Time series feature design</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 11, 2014
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I mentioned before that there is actually quite a lot that goes into a major feature, usually a lot more than would seem on the surface. I thought that this could serve as a pretty good example of a series of blog posts that we can use to show how we are actually sitting down and doing high level design of features in RavenDB. I&#x2019;ve actually already spoken, and we have seen an implementation of the backend, about time series data. But that was just the basic storage, and that was mostly to explore how to deal with Voron for more scenarios, to be honest. Now, allow me to expand that into a full pledged feature design. What we want: the ability to store time series data and work with it. Time series data is a value (double) that is recorded at a specific time for a specific series. A good explanation on that can be found here: https://tempo-db.com/docs/modeling-time-series-data/ We have a bunch of sensors that report data, and we want to store it, and get it back, and get rollups of the information, and probably do more, but that is enough for now. At first glance, we need to support the following operations:  Add data (time, value) to a series. Add bulk data to a set of series. Read data (time,value) from a series or a set of them in a given range. Read rollup (avg, mean, max, min) per period (minutes, hour, day, month) in a given range for a set of series. In the next few posts, I&#x2019;ll discuss storage, network, client api, user interface and distribution design for this. I would truly love to hear from you about any ideas you have.</p>
        </article>
        <div class="button flex justify-between">
            <a href="386.html"><span class="back arrow"></span></a>

            <a href="388.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>