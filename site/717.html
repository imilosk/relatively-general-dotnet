
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 717 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-7161">
            <a href="https://ayende.com/blog/3087/erlang-processes-on-the-clr" target="_blank">
                <h2 class="title mb-6" id="article-7161">Erlang processes on the CLR</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 07, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I mentioned that getting to Erlang like processes is something that I really want to get to. I started thinking about how I can make it work with the IEnumerable&lt;T&gt; implementation.  As it turned out, that was fairly simple, once I got the idea. Take a look at this class diagram:   We have tasks, and we register them in the scheduler. We can also wait for them without blocking the thread. Check out this trivial example. We have the following long running task: public class MultiplicationTask : AbstractTask&#xA;{&#xA;    private readonly int value;&#xA;&#xA;    public MultiplicationTask(int value)&#xA;    {&#xA;        this.value = value;&#xA;    }&#xA;&#xA;    protected override IEnumerable&lt;Condition&gt; Execute()&#xA;    {&#xA;        Thread.Sleep(1000);&#xA;        SetResult(value * 2);&#xA;        yield break;&#xA;    }&#xA;}&#xA;&#xA;And the code that want to call it:&#xA;public class UseMultiplicationTask : AbstractTask&#xA;{&#xA;    protected override IEnumerable&lt;Condition&gt; Execute()&#xA;    {&#xA;        Future future1 = Spawn(new MultiplicationTask(15));&#xA;        Future future2 = Spawn(new MultiplicationTask(23));&#xA;&#xA;        yield return delegate { return future1.HasValue &amp;&amp; future2.HasValue; };&#xA;&#xA;        System.Console.WriteLine(future1.GetValue&lt;int&gt;() &#x2B; future2.GetValue&lt;int&gt;());&#xA;    }&#xA;}&#xA;&#xA;We yield a condition that tell us when we can be executed again. From then, it is just a matter of properly scheduling the different tasks.&#xA;We can probably pretty it up a bit with lambdas, but this works. &#xA;No, instead of listing all the code here, you can browse it here:https://rhino-tools.svn.sourceforge.net/svnroot/rhino-tools/trunk/SampleApplications/BlogCode/BlogCode/ErlangTasks&#xA;I really like this approach</p>
        </article>
        <article id="article-7162">
            <a href="https://ayende.com/blog/3086/i-yield-i-yield" target="_blank">
                <h2 class="title mb-6" id="article-7162">I Yield, I Yield</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 07, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am going over the ParallelFX code at the moment, and I run into this interesting method. Platform.Yield(), which turn out to be a call to SwitchToThread(), which is a method I really should have known about. Turn out that this is a way to explicitly give up the current time-slice that the thread is executing (for the current CPU only). This lead me to do some more discovery, and I found this, managed fibers implementations (I can&#x27;t find the source for this, however, and I have the SDK). This is all part of my quest to get Erlang-like support for concurrency. By that I mean that I can do things like: public void Process()&#xA;{&#xA;   var dbFuture = Spawn( AquireDataFromDB );&#xA;   var wsFuture = Spawn( AquureDataFromWS );&#xA;&#xA;   YieldUntil(dbFuture, wsFuture);&#xA;&#xA;   // do real processing here.&#xA;}&#xA;The key point is that the call to YieldUntil does not block the current thread, instead, it frees it to do start executing additional processing.&#xA;We can keep abusing the yield return approach, but that is starting to get old.</p>
        </article>
        <article id="article-7163">
            <a href="https://ayende.com/blog/3085/fluent-pipelines" target="_blank">
                <h2 class="title mb-6" id="article-7163">Fluent Pipelines</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 07, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am having a discussion with Jon Skeet about the merits of using Linq for pipelines and delegates/lambda instead of classes. I kept saying that I don&#x27;t really see the point, so I went ahead and implemented this: GenerateData(10000)//enumerator from 0 .. 10000&#xA;&#x9;.Where(i =&gt; i % 3 == 0)&#xA;&#x9;.Transform(i =&gt; (i * 2).ToString() )&#xA;&#x9;.Act(i =&gt; Console.WriteLine(i))&#xA;&#x9;.Execute();&#xA;&#xA;This uses the same approach as my previous pipeline, but it does it in C# 3.0, so it can use things like extension methods, which make this nicer. The same in C# 2.0 is possible, but take some ridiculous amount of code to do.&#xA;This code is much simpler than the code I have shown here, no?&#xA;Why do I use the first approach then?&#xA;Scalability.&#xA;What we are seeing here is about as trivial as it can get. What happens when we have more complex semantics?&#xA;Let us take writing to the database as an example. We need to do quite a bit there, more than we would put in the lambda expression, certainly. We can extract to a method, but then we run into another problem, we can&#x27;t do method inheritance. This means that I have no easy way of abstracting the common stuff outside. Well, I can use template method, but that works if and only if I have a single place I want to change behavior.&#xA;As an example of scaling, let us take this piece of code:&#xA;public class FibonacciBulkInsert : SqlBulkInsertOperation&#xA;{&#xA;&#x9;public FibonacciBulkInsert() : base(&quot;test&quot;, &quot;Fibonacci&quot;)&#xA;&#x9;{&#xA;&#x9;}&#xA;&#xA;&#x9;protected override void PrepareSchema()&#xA;&#x9;{&#xA;&#x9;&#x9;Schema[&quot;id&quot;] = typeof (int);&#xA;&#x9;}&#xA;}&#xA;Which uses this base class to handle the bulk of the work.&#xA;One thing that Jon mentioned that was interesting was the ability to take advantage of Linq specific improvements, such as PLinq. This is indeed a consideration, but upon some reflection on it, I realized that the two are not mutually exclusive. If I want to take advantage of any of that, all I need is to modify the pipeline to iterate using PLinq rather than foreach.</p>
        </article>
        <article id="article-7164">
            <a href="https://ayende.com/blog/3084/asp-net-ajax-error-handling-and-wtf" target="_blank">
                <h2 class="title mb-6" id="article-7164">ASP.Net Ajax, Error Handling and WTF</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 06, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am facing some really unpleasant choices at the moment. And I thought it would be so easy.&#xA;I wanted to add global error handling to all the web services that we expose as [ScriptService].&#xA;For some reason, they didn&#x27;t show up in the Application_Error event, and that caused the exception details to be sent to the client.&#xA;It looks like for some strange reasons, web services exceptions don&#x27;t go through the Application_Error, so I implemented a SoapExtension to handle that, but ScriptService doesn&#x27;t go through the Soap layers, so it obviously doesn&#x27;t work.&#xA;Then I went and looked at the code.&#xA;The whole thing is _hard coded_ inside, and there is no way in.&#xA;No way to globally capture exception being raised from script services.&#xA;No way in to add this ability.&#xA;Urgh! Argh!&#xA;&#xA;I mean, it is not like I want something very special, it sounds to me like a reasonable request.&#xA;Yes, I know you can turn off the error in the config, but I would like, you know, to log this. &#xA;&#xA;Of course, everything is internal in there, so I can&#x27;t just go and override the RestHandler. ExecuteWebServiceCall(), I would have to have a private build of this stuff.&#xA;Just to be able to log exceptions.</p>
        </article>
        <article id="article-7165">
            <a href="https://ayende.com/blog/3083/pipes-and-filters-the-multi-threaded-version" target="_blank">
                <h2 class="title mb-6" id="article-7165">Pipes and filters</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 06, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Another advantage of using the pipes and filters approach is that it is naturally thread safe. Only a single filter is handling an item at a given time, even if the pipes are all running on multiply threads. This means that we have an very simple way to introduce threading into the system, without any hassle whatsoever. Let us take a look at the single threaded pipeline: public class SingleThreadedPipeline&lt;T&gt;&#xA;{&#xA;    private readonly List&lt;IOperation&lt;T&gt;&gt; operations = new List&lt;IOperation&lt;T&gt;&gt;();&#xA;&#xA;    public SingleThreadedPipeline&lt;T&gt; Register(IOperation&lt;T&gt; operation)&#xA;    {&#xA;        operations.Add(operation);&#xA;        return this;&#xA;    }&#xA;&#xA;    public void Execute()&#xA;    {&#xA;        IEnumerable&lt;T&gt; current = new List&lt;T&gt;();&#xA;        foreach (IOperation&lt;T&gt; operation in operations)&#xA;        {&#xA;            current = operation.Execute(current);&#xA;        }&#xA;        IEnumerator&lt;T&gt; enumerator = current.GetEnumerator();&#xA;        while (enumerator.MoveNext()) ;&#xA;    }&#xA;}&#xA;Very simple, except the last line, which is what push the entire pipeline along. Now, what do we need in order to make this multi threaded?&#xA;Well, what do I mean when we talk about multi threaded? I mean that we will execute all the operations concurrently, so they can process different parts of the pipeline at the same time. This allows us to make better use of our computing resources, etc.&#xA;Here is the code:&#xA;public class ThreadPoolPipeline&lt;T&gt;&#xA;{&#xA;    private readonly List&lt;IOperation&lt;T&gt;&gt; operations = new List&lt;IOperation&lt;T&gt;&gt;();&#xA;&#xA;    public ThreadPoolPipeline&lt;T&gt; Register(IOperation&lt;T&gt; operation)&#xA;    {&#xA;        operations.Add(operation);&#xA;        return this;&#xA;    }&#xA;&#xA;    public void Execute()&#xA;    {&#xA;        IEnumerable&lt;T&gt; current = new List&lt;T&gt;();&#xA;        foreach (IOperation&lt;T&gt; operation in operations)&#xA;        {&#xA;            IEnumerable&lt;T&gt; execute = operation.Execute(current);&#xA;            current = StartConsuming(execute);&#xA;        }&#xA;        IEnumerator&lt;T&gt; enumerator = current.GetEnumerator();&#xA;        while (enumerator.MoveNext()) ;&#xA;    }    private ThreadSafeEnumerator&lt;T&gt; StartConsuming(IEnumerable&lt;T&gt; enumerable)&#xA;    {&#xA;        ThreadSafeEnumerator&lt;T&gt; threadSafeEnumerator = new ThreadSafeEnumerator&lt;T&gt;();&#xA;        ThreadPool.QueueUserWorkItem(delegate&#xA;        {&#xA;            try&#xA;            {&#xA;                foreach (T t in enumerable)&#xA;                {&#xA;                    threadSafeEnumerator.AddItem(t);&#xA;                }&#xA;            }&#xA;            catch (Exception e)&#xA;            {&#xA;                Console.WriteLine(e);&#xA;            }&#xA;            finally&#xA;            {&#xA;                threadSafeEnumerator.MarkAsFinished();&#xA;            }&#xA;        });&#xA;        return threadSafeEnumerator;&#xA;    }}&#xA;We are using ThreadSafeEnumerate here, and pass a callback to the thread pool which will execute the pervious part of the pipeline and push them into the current pipeline.&#xA;This is just an advance version of decorators.&#xA;The implementation of ThreadSafeEnumerator is about as simple as multi threaded code can be:&#xA;public class ThreadSafeEnumerator&lt;T&gt; : IEnumerable&lt;T&gt;, IEnumerator&lt;T&gt;&#xA;{&#xA;    private bool active = true;&#xA;    private readonly Queue&lt;T&gt; cached = new Queue&lt;T&gt;();&#xA;    private T current;&#xA;&#xA;    public IEnumerator&lt;T&gt; GetEnumerator()&#xA;    {&#xA;        return this;&#xA;    }&#xA;&#xA;    IEnumerator IEnumerable.GetEnumerator()&#xA;    {&#xA;        return ((IEnumerable&lt;T&gt;)this).GetEnumerator();&#xA;    }&#xA;&#xA;    public T Current&#xA;    {&#xA;        get { return current; }&#xA;    }&#xA;&#xA;    public void Dispose()&#xA;    {&#xA;        cached.Clear();&#xA;    }&#xA;&#xA;    public bool MoveNext()&#xA;    {&#xA;        lock (cached)&#xA;        {&#xA;            while (cached.Count == 0 &amp;&amp; active)&#xA;                Monitor.Wait(cached);&#xA;&#xA;            if (active == false &amp;&amp; cached.Count == 0)&#xA;                return false;&#xA;&#xA;            current = cached.Dequeue();&#xA;&#xA;            return true;&#xA;        }&#xA;    }&#xA;&#xA;    public void Reset()&#xA;    {&#xA;        throw new NotSupportedException();&#xA;    }&#xA;&#xA;    object IEnumerator.Current&#xA;    {&#xA;        get { return Current; }&#xA;    }&#xA;&#xA;    public void AddItem(T item)&#xA;    {&#xA;        lock (cached)&#xA;        {&#xA;            cached.Enqueue(item);&#xA;            Monitor.Pulse(cached);&#xA;        }&#xA;    }&#xA;&#xA;    public void MarkAsFinished()&#xA;    {&#xA;        lock(cached)&#xA;        {&#xA;            active = false;&#xA;            Monitor.Pulse(cached);&#xA;        }&#xA;        &#xA;    }&#xA;}&#xA;The real magic happens in MoveNext(), with support from AddItem() and MarkAsFinished().&#xA;This is it, these two classes are all we need to make everything else multi threaded.&#xA;Note that this version assumes that you can execute all the operations concurrently, which may not be the can if you have a lot of them (over 25/CPU by default). At that point, we would need to implement coroutines for the ThreadSafeEnumearator, instead of just blocking the thread.</p>
        </article>
        <article id="article-7166">
            <a href="https://ayende.com/blog/3082/pipes-and-filters-the-ienumerable-appraoch" target="_blank">
                <h2 class="title mb-6" id="article-7166">Pipes and filters</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 05, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Pipes are very common in computing. It is a very good way to turn a complex problem to a set of small problems. You are probably familiar with the pattern, even if not explicitly.  The ASP.Net Http Pipeline (Begin_Request, Authorize_Request, etc  Compiler Pipelines (Parse, ProcessTypes, SaveAssembly, etc)  Command Line piping (ps -ax | grep Finder) What I wanted to talk about today was how to implement this in code. I did several implementation of pipes and filters in the past, and they all were overly complex. I took this weekend to look at the problem again, and I came up with a ridiculously simple solution. In a nutshell, here it is:   We have a pipeline, that is composed of operations. Each operation accepts an input and return an output. The use of IEnumerable&lt;T&gt; means that we can streamline the entire process without any effort whatsoever. Most problems that calls for the pipeline approach are fairly complex, so picking a simple example means that it is trivial to implement it otherwise. Let us go to the really trivial sample of printing all the processes whose working set is greater than 50 MB. We have three stages in the pipeline, the first, get processes: public class GetAllProcesses : IOperation&lt;Process&gt;&#xA;{&#xA;    public IEnumerable&lt;Process&gt; Execute(IEnumerable&lt;Process&gt; input)&#xA;    {&#xA;        return Process.GetProcesses();&#xA;    }&#xA;}&#xA;The second, limit by working set size:&#xA;public class LimitByWorkingSetSize : IOperation&lt;Process&gt;&#xA;{&#xA;    public IEnumerable&lt;Process&gt; Execute(IEnumerable&lt;Process&gt; input)&#xA;    {&#xA;        int maxSizeBytes = 50 * 1024 * 1024;&#xA;        foreach (Process process in input)&#xA;        {&#xA;            if (process.WorkingSet64 &gt; maxSizeBytes)&#xA;                yield return process;&#xA;        }&#xA;    }&#xA;}&#xA;The third, print process name:&#xA;public class PrintProcessName : IOperation&lt;Process&gt;&#xA;{&#xA;    public IEnumerable&lt;Process&gt; Execute(IEnumerable&lt;Process&gt; input)&#xA;    {&#xA;        foreach (Process process in input)&#xA;        {&#xA;            System.Console.WriteLine(process.ProcessName);&#xA;        }&#xA;        yield break;&#xA;    }&#xA;}&#xA;&#xA;All of those are very trivial implementation. You can see that the GetAllProcesses class doesn&#x27;t care about its input, it is the source. The LimitByWorkingSetSize iterate over the input and use the &quot;yield return&quot; keywords to stream the results to the next step, PrintProcessesName. Since this step is the final one, we use the &quot;yield break&quot; keywords to make it compile without returning anything. (We could return null, but that would be rude).&#xA;It is important to note that the second stage uses the if to control what get pass downstream. &#xA;Now we only have to bring them together, right?&#xA;public class TrivialProcessesPipeline : Pipeline&lt;Process&gt;&#xA;{&#xA;    public TrivialProcessesPipeline()&#xA;    {&#xA;        Register(new GetAllProcesses());&#xA;        Register(new LimitByWorkingSetSize());&#xA;        Register(new PrintProcessName());&#xA;    }&#xA;}&#xA;&#xA;Now, executing this pipeline will execute all three steps, in a streaming fashion.&#xA;Okay, this is a lot of code that we can replace with the following snippet:&#xA;int maxSizeBytes = 50 * 1024 * 1024;&#xA;foreach (Process process in Process.GetProcesses())&#xA;{&#xA;     if (process.WorkingSet64 &gt; maxSizeBytes)&#xA;         System.Console.WriteLine(process.ProcessName);&#xA;}&#xA;&#xA;What are we getting from this?&#xA;Composability and streaming. When we execute the pipeline, we are not executing each step in turn, we are executing them all in parallel. (Well, not in parallel, but together.)&#xA;Hey, I didn&#x27;t show you how the Pipeline&lt;T&gt; was implemented, right?&#xA;public class Pipeline&lt;T&gt;&#xA;{&#xA;    private readonly List&lt;IOperation&lt;T&gt;&gt; operations = new List&lt;IOperation&lt;T&gt;&gt;();&#xA;&#xA;    public Pipeline&lt;T&gt; Register(IOperation&lt;T&gt; operation)&#xA;    {&#xA;        operations.Add(operation);&#xA;        return this;&#xA;    }&#xA;&#xA;    public void Execute()&#xA;    {&#xA;        IEnumerable&lt;T&gt; current = new List&lt;T&gt;();&#xA;        foreach (IOperation&lt;T&gt; operation in operations)&#xA;        {&#xA;            current = operation.Execute(current);&#xA;        }&#xA;        IEnumerator&lt;T&gt; enumerator = current.GetEnumerator();&#xA;        while (enumerator.MoveNext()) ;&#xA;    }&#xA;}&#xA;&#xA;I&#x27;ll leave you to ponder that.</p>
        </article>
        <article id="article-7167">
            <a href="https://ayende.com/blog/3081/mutli-mocks-and-verifying-behavior" target="_blank">
                <h2 class="title mb-6" id="article-7167">Mutli Mocks and verifying behavior</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 05, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I have the following piece of code: protected override void DoClose()&#xA;{&#xA;    IDisposable dispoable = enumerator as IDisposable;&#xA;    if (dispoable != null)&#xA;        dispoable.Dispose();&#xA;&#xA;    dispoable = enumerable as IDisposable;&#xA;    if(dispoable != null)&#xA;        dispoable.Dispose();&#xA;}&#xA;&#xA;How do I verify that it correctly disposes both enumerator and enumerable when the method is called?&#xA;Here is the test that I wrote, it is using Rhino Mocks&#x27; Multi Mocks feature to generate a proxy that has more than a single implementation.&#xA;[Test]&#xA;public void WillDisposeInternalEnumeratorAndEnumerableWhenDisposed()&#xA;{&#xA;    MockRepository mocks = new MockRepository();&#xA;    IEnumerable&lt;Row&gt; enumerable = mocks.DynamicMultiMock&lt;IEnumerable&lt;Row&gt;&gt;(typeof(IDisposable));&#xA;    IEnumerator&lt;Row&gt; enumerator = mocks.DynamicMock&lt;IEnumerator&lt;Row&gt;&gt;();&#xA;    using(mocks.Record())&#xA;    {&#xA;        SetupResult.For(enumerable.GetEnumerator()).Return(enumerator);&#xA;        enumerator.Dispose();&#xA;        ((IDisposable)enumerable).Dispose();&#xA;    }&#xA;    using (mocks.Playback())&#xA;    {&#xA;        DictionaryEnumeratorDataReader reader =&#xA;            new DictionaryEnumeratorDataReader(new Dictionary&lt;string, Type&gt;(), enumerable);&#xA;        reader.Dispose();&#xA;    }&#xA;}&#xA;&#xA;Simple, and to the point.</p>
        </article>
        <article id="article-7168">
            <a href="https://ardalis.com/facebook-and-scoble-square-off/" target="_blank">
                <h2 class="title mb-6" id="article-7168">Facebook and Scoble Square Off</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 04, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Like so many others have noted, I think 2008 and the next few years will see a shakeup in some of the &#x201C;web 2.0&#x201D; and social networking&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-7169">
            <a href="https://ardalis.com/attending-codemash-2008/" target="_blank">
                <h2 class="title mb-6" id="article-7169">Attending CodeMash 2008</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 04, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x2019;ll be attending CodeMash again for its second year, at the Kalahari Resort in Ohio. Last year it was a great local conference and this&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-7170">
            <a href="https://ardalis.com/simplecms-for-iis7/" target="_blank">
                <h2 class="title mb-6" id="article-7170">SimpleCMS for IIS7</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 04, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">SimpleCMSis a (very) simple content management system I developed with Brendan for ASPAlliance.com and which is now available from CodePlex&#x2026;Keep Reading &#x2192;</p>
        </article>
        <div class="button flex justify-between">
            <a href="716.html"><span class="back arrow"></span></a>

            <a href="718.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>