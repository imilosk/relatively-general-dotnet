
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 370 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-3691">
            <a href="https://ayende.com/blog/169796/excerpts-from-the-ravendb-performance-team-report-etags-and-evil-code-part-i" target="_blank">
                <h2 class="title mb-6" id="article-3691">Excerpts from the RavenDB Performance team report</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 19, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">As part of the performance work we have been doing, we focused on the Etag class we use as a performance hot spot. For this post, I&#x2019;m going to talk about Etag.Parse(string) and what we did to improve its performance.&#xA;&#xA;&#x9;Etag is a core type in RavenDB, it is how we represent changes in the database, and we deal with it a lot. As such, it turned up as a performance hot spot in our profiling. This post is based mostly around Maxim&#x2019;s work to improve the overall performance.&#xA;&#xA;&#x9;One of the things that we do with Etag is to take a string and turn that into an instance of an Etag. An Etag looks just like a Guid, but its structure has meaning that we care about. Here is what a typical Etag looks like:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;01000000-0000-0005-0000-00000000012C&#xA;&#xA;&#xA;&#x9;We send them over the wire as strings for a lot of purposes. Here is the initial code that we used for parsing Etags:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;public static Etag Parse2(string str)&#xA;{&#xA;    if (string.IsNullOrEmpty(str))&#xA;        throw new ArgumentException(&quot;str cannot be empty or null&quot;);&#xA;    if (str.Length != 36)&#xA;        throw new ArgumentException(string.Format(&quot;str must be 36 characters (Etag::Parse is {0})&quot;, str));&#xA;&#xA;    var buffer = new byte[16]&#xA;    {&#xA;        byte.Parse(str.Substring(16, 2), NumberStyles.HexNumber),&#xA;        byte.Parse(str.Substring(14, 2), NumberStyles.HexNumber),&#xA;        byte.Parse(str.Substring(11, 2), NumberStyles.HexNumber),&#xA;        byte.Parse(str.Substring(9, 2), NumberStyles.HexNumber),&#xA;        byte.Parse(str.Substring(6, 2), NumberStyles.HexNumber),&#xA;        byte.Parse(str.Substring(4, 2), NumberStyles.HexNumber),&#xA;        byte.Parse(str.Substring(2, 2), NumberStyles.HexNumber),&#xA;        byte.Parse(str.Substring(0, 2), NumberStyles.HexNumber),&#xA;        byte.Parse(str.Substring(34, 2), NumberStyles.HexNumber),&#xA;        byte.Parse(str.Substring(32, 2), NumberStyles.HexNumber),&#xA;        byte.Parse(str.Substring(30, 2), NumberStyles.HexNumber),&#xA;        byte.Parse(str.Substring(28, 2), NumberStyles.HexNumber),&#xA;        byte.Parse(str.Substring(26, 2), NumberStyles.HexNumber),&#xA;        byte.Parse(str.Substring(24, 2), NumberStyles.HexNumber),&#xA;        byte.Parse(str.Substring(21, 2), NumberStyles.HexNumber),&#xA;        byte.Parse(str.Substring(19, 2), NumberStyles.HexNumber)&#xA;    };&#xA;&#xA;    return new Etag&#xA;    {&#xA;        restarts = BitConverter.ToInt64(buffer, 0),&#xA;        changes = BitConverter.ToInt64(buffer, 8)&#xA;    };&#xA;}&#xA;&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;You can note several things here. First, we are being kinda funky here with the order of parsing. This is because we read the string in Big Endian format, to allow direct comparisons of the bytes strings.&#xA;&#xA;&#x9;The other issue is the shear number of allocations and calls we are making. Because this is such a small code base, we created 10,000 etags and parsed them a million times .That took 17.3 seconds. For a throughput of roughly 5 Etags per millisecond.&#xA;&#xA;&#x9;Then we sat down and re-wrote it using a lot of somewhat nasty tricks.&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;private readonly static int[] _asciisOfHexToNum = CreateHexCharsToNumsTable();&#xA;&#xA;private static int[] CreateHexCharsToNumsTable()&#xA;{&#xA;    var c = new int[&#x27;z&#x27; &#x2B; 1];&#xA;    for (var i = &#x27;0&#x27;; i &lt;= &#x27;9&#x27;; i&#x2B;&#x2B;)&#xA;    {&#xA;        c[i] = (char)(i - &#x27;0&#x27;);&#xA;    }&#xA;    for (var i = &#x27;A&#x27;; i &lt;= &#x27;Z&#x27;; i&#x2B;&#x2B;)&#xA;    {&#xA;        c[i] = (char)((i - &#x27;A&#x27;) &#x2B; 10);&#xA;    }&#xA;    for (var i = &#x27;a&#x27;; i &lt;= &#x27;z&#x27;; i&#x2B;&#x2B;)&#xA;    {&#xA;        c[i] = (char)((i - &#x27;a&#x27;) &#x2B; 10);&#xA;    }&#xA;&#xA;    return c;&#xA;}&#xA;&#xA;&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;public unsafe static Etag Parse(string str)&#xA;{&#xA;    if (str == null || str.Length != 36)&#xA;        throw new ArgumentException(&quot;str cannot be empty or null&quot;);&#xA;&#xA;    fixed (char* input = str)&#xA;    {&#xA;        var etag = new Etag();&#xA;        int fst = ((byte)(_asciisOfHexToNum[input[0]] * 16 &#x2B; _asciisOfHexToNum[input[1]])) &lt;&lt; 24 |&#xA;            ((byte)(_asciisOfHexToNum[input[2]] * 16 &#x2B; _asciisOfHexToNum[input[3]])) &lt;&lt; 16 |&#xA;            ((byte)(_asciisOfHexToNum[input[4]] * 16 &#x2B; _asciisOfHexToNum[input[5]])) &lt;&lt; 8 |&#xA;            (byte)(_asciisOfHexToNum[input[6]] * 16 &#x2B; _asciisOfHexToNum[input[7]]);&#xA;        int snd = ((byte)(_asciisOfHexToNum[input[9]] * 16 &#x2B; _asciisOfHexToNum[input[10]])) &lt;&lt; 24 |&#xA;            ((byte)(_asciisOfHexToNum[input[11]] * 16 &#x2B; _asciisOfHexToNum[input[12]])) &lt;&lt; 16 |&#xA;            ((byte)(_asciisOfHexToNum[input[14]] * 16 &#x2B; _asciisOfHexToNum[input[15]])) &lt;&lt; 8 |&#xA;            ((byte)(_asciisOfHexToNum[input[16]] * 16 &#x2B; _asciisOfHexToNum[input[17]]));&#xA;        etag.restarts = (uint)snd | ((long)fst &lt;&lt; 32);&#xA;&#xA;&#xA;        fst = ((byte)(_asciisOfHexToNum[input[19]] * 16 &#x2B; _asciisOfHexToNum[input[20]])) &lt;&lt; 24 |&#xA;            ((byte)(_asciisOfHexToNum[input[21]] * 16 &#x2B; _asciisOfHexToNum[input[22]])) &lt;&lt; 16 |&#xA;            ((byte)(_asciisOfHexToNum[input[24]] * 16 &#x2B; _asciisOfHexToNum[input[25]])) &lt;&lt; 8 |&#xA;            ((byte)(_asciisOfHexToNum[input[26]] * 16 &#x2B; _asciisOfHexToNum[input[27]]));&#xA;        snd = ((byte)(_asciisOfHexToNum[input[28]] * 16 &#x2B; _asciisOfHexToNum[input[29]])) &lt;&lt; 24 |&#xA;            ((byte)(_asciisOfHexToNum[input[30]] * 16 &#x2B; _asciisOfHexToNum[input[31]])) &lt;&lt; 16 |&#xA;            ((byte)(_asciisOfHexToNum[input[32]] * 16 &#x2B; _asciisOfHexToNum[input[33]])) &lt;&lt; 8 |&#xA;            ((byte)(_asciisOfHexToNum[input[34]] * 16 &#x2B; _asciisOfHexToNum[input[35]]));&#xA;        etag.changes = (uint)snd | ((long)fst &lt;&lt; 32);&#xA;        return etag;&#xA;    }&#xA;}&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;Here is what we did. We created a translation table, so every possible byte is pre calculated. That means that for the cost of actually parsing the string is basically doing a lookup into an array, which is constant type. There are no allocations, nor is there anything expensive going on. On the same machine the previous code took 17.3 to run, this code can process a million Etags in just 287 milliseconds. Or close to 3,500 Etag per milliseconds.&#xA;&#xA;&#x9;I leave the rate of improvement as an exercise for the reader. Also, can you think of any way in which we can improve this code even further? We weren&#x2019;t able to figure out anything, but you never knows.</p>
        </article>
        <article id="article-3692">
            <a href="https://enterprisecraftsmanship.com/posts/how-to-increase-your-value-as-developer/" target="_blank">
                <h2 class="title mb-6" id="article-3692">How to increase your value as a developer</h2>
            </a>
            <p class="mb-2">by Vladimir Khorikov</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 17, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Did you think about what traits make developers great? Which one is the most valuable for the companies they are working for?&#xA;&#xA;&#xA;While there might be quite a few of them, I believe there&#x2019;s one that employers value the most. I also believe getting that characteristic can drastically increase your value as a software developer.</p>
        </article>
        <article id="article-3693">
            <a href="https://ayende.com/blog/169794/excerpts-from-the-ravendb-performance-team-report-voron-vs-esent" target="_blank">
                <h2 class="title mb-6" id="article-3693">Excerpts from the RavenDB Performance team report</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 16, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Another thing that turned up in the performance work was the Esent vs. Voron issue. We keep testing everything on both, and trying to see which one can outdo the other, fix a hotspot, then try again. When we run the YCSB benchmark we also compared between Esent vs. Voron as storage for our databases and we found that Voron was very good in read operation while Esent was slightly better in write operation. During the YCSB tests we found out one of the reason why Voron was a bit slower than Esent for writing, it was consuming 4 times the expected disk-space. The reason for this high disk-space consumption was that the benchmark by default generates documents of exactly 1KB, with meta-data the actual size was 1.1KB. Voron internal implementation uses a B&#x2B; tree where the leafs are 4KB in size, 1KB was the threshold in which we decide not to save data to the leaf but to reference on it and save it on a new page. We ended up creating a new 4KB page to hold 1.1KB documents for each document that we saved. The benchmark actually hit the worst case scenario for our implementation, and caused us to use 4 times more disk space and write 4 times more data than we needed.&#xA0; Changing this threshold reduce the disk-space consumption to the expected size, and gave Voron a nice boost.  We are also testing our software on a wide variety of systems, and with Voron specifically with run into an annoying issue. Voron is a write ahead log system, and we are very careful to write to the log in a very speedy manner. This is one of the ways in which we are getting really awesome speed for Voron. But when running on slow I/O system, and putting a lot of load on Voron, we started to see very large stalls after a while. Tracing the issue took a while, but eventually we figured out what was going on. Writing to the log is all well and good, but we need to also send the data to the actual data file at some point. The way Voron does it, it batch a whole bunch of work, write it to the data file, then sync the data file to make sure it is actually persisted on disk. Usually, that isn&#x2019;t really an issue. But on slow I/O, and especially under load, you get results like this:  Start to sync data file (8:59:52 AM). Written but unsynced data size 309 MBFlushViewOfFile duration 00:00:13.3482163. FlushFileBuffers duration: 00:00:00.2800050.End of data pager sync (9:00:05 AM). Duration: 00:00:13.7042229 Note that this is random write, because we may be doing writes to any part of the file, but that is still way too long. What was worse, and the reason we actually care is that we were doing that while holding the transaction lock. We were able to re-design that part so even under slow I/O, we can take the lock for a very short amount of time, update the in memory data structure and then release the lock and spend some quality time gazing at our navel in peace while the I/O proceeded in its own pace, but now without blocking anyone else.</p>
        </article>
        <article id="article-3694">
            <a href="https://ayende.com/blog/169793/excerpts-from-the-ravendb-performance-team-report-routing" target="_blank">
                <h2 class="title mb-6" id="article-3694">Excerpts from the RavenDB Performance team report</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 15, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We have been quite busy lately doing all sort of chores. The kind of small features that you don&#x2019;t really notice, but make a lot of difference over time. One of the ways that we did that was to assign a team for the sole purpose of improving the performance of RavenDB. This is done by writing a lot of stress tests, running under profilers and in general doing very evil things to the code to get it to work much faster. The following is part of the results that we have found so far, written mostly by Tal.&#xA;&#xA;&#x9;We decided to use Yahoo! Cloud Service Benchmark (AKA YCSB) for that purpose, while YCSB is great in creating stress on the target database servers it does not offer complex interface to stress complex scenario, and seems to be targeting key value solutions. YCSB allows you to basically control some parameters to the workload engine and implementation of five basic operation: Insert, Update, Read, Scan and Delete of a single record, in a single table/collection.&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;Note: I think that this is because it focused (at least initially) primarily on the Big Table type of NoSQL solutions.&#xA;&#xA;&#xA;&#x9;This very thin interface allows us to mainly stress the PUT/GET document. The first thing we found is that running with indexes actually slowed us down since we are &#x201C;wasting&#x201D; precious CPU time on indexing and not doing any querying, that is enough to show you the true face of benchmark miracle, since where have you ever seen a database that you didn&#x2019;t wish to run a query upon?&#xA0; But this is a topic for another post&#x2026; lets go back to performance.&#xA;&#xA;&#x9;The second thing we found was a hotspot in the route data retrieval&#xA0; mechanism of the Web API/ While using Web API routing seems to work like magic, when you get to have approximately four hundred endpoints you will start suffering from performance issues retrieving route data. In our case we were spending about 1ms per http request just to retrieve the route data for the request, that may not seems like much but for 1,500 request that took 5 seconds to execute this took 1.5 seconds just for route data retrieval. Please, do not try to extrapolate the throughput of RavenDB from those numbers since we ran this test on a weak machine also under a profiling tool that slow it down significantly.&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;Note: Effectively, for our use case, we were doing an O(400) operation on every request, just to find what code we needed to run to handle this request.&#xA;&#xA;&#xA;&#x9;We decided to cache the routes for each request but just straight forward caching wouldn&#x2019;t really help in our case. The problem is that we have many unique requests that would fill the cache and then wouldn&#x2019;t actually be of use.&#xA;&#xA;&#x9;Our major issue was requests that had a route that looked like so databases/{databaseName}/docs/{*docId}. While we we do want to cache routes such as: databases/{databaseName}/stats. The problem is that we have both types of routes and they are used quite often so we ended up with a greatest common route cache system. That means that /databases/Northwind/docs/Orders/order1 and /databases/Northwind/docs/Orders/order2 will go into the same bucket that is /databases/Northwind/docs.&#xA;&#xA;&#x9;In that way, we would still have to do some work per request, but now we don&#x2019;t have to go through all four hundred routes we have to find the relevant routes.&#xA;&#xA;&#x9;What was the performance impact you wonder? We took off 90% of get route data time that is spending 0.15 seconds instead of 1.5 seconds for those 1,500 requests, reducing the overall runtime to 3.65 seconds, that is 27% less run time.&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;Note: Again, don&#x2019;t pay attention to the actual times, it is the rate of improvement that we are looking at.&#xA;&#xA;&#xA;&#x9;As an aside, another performance improvement that we made with regards to routing was routing discovery. During startup, we scan the RavenDB assembly for controllers, and register the routes. That is all great, as long as you are doing that once. And indeed, in most production scenarios, you&#x2019;ll only do that once per server start. That means that the few dozen milliseconds that you spend on this aren&#x2019;t really worth thinking about. But as it turned out, there was one key scenario that was impacted by this. Tests! In tests, you start and stop RavenDB per test, and reducing this cost is very important to ensuring a pleasant experience. We were able to also optimize the route discovery process, and we were actually able to reduce our startup time from cold boot to below what we had in 2.5.</p>
        </article>
        <article id="article-3695">
            <a href="https://ayende.com/blog/169761/ravendb-indexing-performance-timeline" target="_blank">
                <h2 class="title mb-6" id="article-3695">RavenDB&#x2013;Indexing performance timeline</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 13, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We get people asking us about the details of RavenDB indexes, why a certain index is busy, what is costly, etc. This is a pretty common set of questions, and while we were always able to give the customer a good answer, I was never truly happy with that. A lot of that was about understanding the system to a very deep level and being able to read fairly obscure to an outsider. Like most things that aren&#x2019;t obvious and easy to use, that bugged me, deeply. Therefor, we spent a few weeks adding internal metrics and exposing everything in a nice and easy fashion. Let me show you the details from one of our production databases:  The Y axis is for different indexes. On the Y axis, you have time. Note that the top part is for map operations, and the bottom part is for reduce operations, and that they are running in parallel. You can also visually see that those the map &amp; reduce are actually running in parallel.  What is even better, you can visually see each individual indexing batch, let us focus on the long indexing batch in the middle:  As you can see, we are indexing 512 documents, but it took us a really long time to index them, why is that? We can see that the reason that this batch took so long is that the Orders/Stats and Products/Stats index were very long. Clicking on them, we can see:  &#xA0;    The Orders/Stats index accepted a 105 documents, and outputted 1,372 map values. And the costly part of this index was to actually commit those (along with the Products/Stats, which also output a similar amount) to the map storage.  Another slow index is exposed here:  In this case, we have an index that is big enough that we need to flush it to disk from RAM. That explains things. I&#x2019;m really excited about this feature.</p>
        </article>
        <article id="article-3696">
            <a href="https://ayende.com/blog/169729/current-status-voron-on-linux" target="_blank">
                <h2 class="title mb-6" id="article-3696">Current status, Voron on Linux</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 12, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We have been quite for a while on that front, but that is just because we were head down and working hard on it. The current status is that we are getting there .&#xA;&#xA;&#x9;Recently we have been fighting with a SIGSEGV (segmentation fault) that appear out of nowhere and kind of ruin our fun. To be rather more exact, we have been on that bug for over a month. We have been getting great help from Sine Nomine about figure out the root cause of that, and today Neale Ferguson finally tracked down the final clues that gave up a simple reproduction.&#xA;&#xA;&#x9;Take the following code and run it on a Linux machine (in our case, Ubuntu 14.4 with Mono 3.10). It would crash with a really nasty error:&#xA;class MainClass&#xA;{&#xA;    public unsafe static void Main(string[] args)&#xA;    {&#xA;        var f = Syscall.mmap(IntPtr.Zero, 1024 * 1024, MmapProts.PROT_WRITE | MmapProts.PROT_READ, MmapFlags.MAP_SHARED | MmapFlags.MAP_ANONYMOUS, -1, 0);&#xA;&#xA;        var p = new byte*[]{ (byte*)f.ToPointer() };&#xA;&#xA;        Syscall.munmap(f,1024*1024);&#xA;&#xA;        Console.WriteLine(p.Length);&#xA;&#xA;        p = null;&#xA;&#xA;        GC.Collect();&#xA;        GC.WaitForPendingFinalizers();&#xA;    }&#xA;}&#xA;&#xA;&#xA;&#x9;The underlying reason, to the best of my understanding at the moment, is that the sgen GC implementation in Mono is going inspecting the p array for its values. But instead of just treating this as an opaque value (because I wouldn&#x2019;t expect the GC to follow a pointer reference), it is trying to access the value. Since by this time, this value is no longer valid, it is accessing invalid memory location, and dying horribly.&#xA;&#xA;&#x9;The good news htat once we had a simple repro, the Mono team was really quick on their feet and this has already been fixed.</p>
        </article>
        <article id="article-3697">
            <a href="https://enterprisecraftsmanship.com/posts/how-to-build-microservices-wrong/" target="_blank">
                <h2 class="title mb-6" id="article-3697">How to build Microservices wrong</h2>
            </a>
            <p class="mb-2">by Vladimir Khorikov</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 10, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Microservices have got a lot of traction last year. It&#x2019;s always interesting to read about success stories other people have; they tend to inspire you to try this new trend out in your own project.&#xA;&#xA;&#xA;However, there are several traps you can fall into if you follow this trend without deep understanding of its fundamentals. Today, I&#x2019;ll share some bad practices I saw one particular company used on its way to adopt microservices architecture.</p>
        </article>
        <article id="article-3698">
            <a href="https://www.meziantou.net/application-recovery-and-restart.htm" target="_blank">
                <h2 class="title mb-6" id="article-3698">Application Recovery and Restart</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 05, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">When an application crashes the user does not want to lose the data is was working on. Small bonus they would like the application to restart automatically and restore their context. This is exactly what allows the Application Recovery and Restart (ARR) API. ARR allows you to define a method to cal</p>
        </article>
        <article id="article-3699">
            <a href="https://enterprisecraftsmanship.com/posts/value-objects-explained/" target="_blank">
                <h2 class="title mb-6" id="article-3699">Value Objects explained</h2>
            </a>
            <p class="mb-2">by Vladimir Khorikov</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 03, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x2019;ve already written about base entity class. Today, I&#x2019;d like to continue with Value Object base class I use in my projects. Also, I&#x2019;ll share some best practices regarding Value Objects implementation.&#xA; Value Objects: what is it?  An object that represents a descriptive aspect of the domain with no conceptual identity is called a Value Object. Value Objects are instantiated to represent elements of the design that we care about only for what they are, not who or which they are.</p>
        </article>
        <article id="article-3700">
            <a href="https://ayende.com/blog/169666/side-by-side-indexes-in-ravendb" target="_blank">
                <h2 class="title mb-6" id="article-3700">Side by side indexes in RavenDB</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 02, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the new features we just finished working on is the notion of side by side indexes. You can see how to access it on the image, but what is it?  As usual lately, this is part and parcel of our current focus in operations. The basic notion is simple. You have an index in production that you want to update, but just updating it on the fly isn&#x2019;t going to work. The problem is that updating the index force a complete reindexing of the data, and in most production systems, we have enough documents that this can take a while. That means that during the indexing process, your application would see partial results, and may see that for a while. Common work around was to add support in your application to change the index name, so you would create a new index, wait for it to become non stale and then you would update the application configuration so you would query the new index. With the side by side option, this is all handled for you. When you save an index with side by side option, you get the following options:  Basically, we create the index under a temporary name, and start indexing it. And you can choose when RavenDB automatically will make the switch (note that there is an OR condition between those, so any of those that match would work). This give you the option of changing an index, and have no interruptions of service, because RavenDB will take care of all of that for you. You can even mark an index with a &#x201C;force to change via side-by-side&#x201D;, which will protect it from accidental changes.</p>
        </article>
        <div class="button flex justify-between">
            <a href="369.html"><span class="back arrow"></span></a>

            <a href="371.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>