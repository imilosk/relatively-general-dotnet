
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Home â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<script>
    const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

    function getUserPref() {
        const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
        return storedTheme || (lightModePref.matches ? "light" : "dark");
    }

    function setTheme(newTheme) {
        if (newTheme !== "light" && newTheme !== "dark") {
            return console.warn(
                `Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
            );
        }

        const root = document.documentElement;

        // root already set to newTheme, exit early
        if (newTheme === root.getAttribute("data-theme")) {
            return;
        }

        root.setAttribute("data-theme", newTheme);

        const colorThemeMetaTag = document.querySelector("meta[name='theme-color']");
        const bgColour = getComputedStyle(document.body).getPropertyValue("--theme-bg");
        colorThemeMetaTag.setAttribute("content", `hsl(${bgColour})`);
        if (typeof localStorage !== "undefined") {
            localStorage.setItem("theme", newTheme);
        }
    }

    // initial setup
    setTheme(getUserPref());

    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("theme-toggle").addEventListener("click", () => {
            const theme = localStorage.getItem("theme");

            if (theme === "dark") {
                setTheme("light");
            } else {
                setTheme("dark");
            }
        });

        document.getElementById("toggle-navigation-menu").addEventListener("click", (e) => {
            const button = e.target;
            const ariaExpanded = button.getAttribute("aria-expanded");
            const header = document.getElementById("main-header");

            if (ariaExpanded === "true") {
                button.setAttribute("aria-expanded", "false");
                header.classList.remove("menu-open");
            } else {
                button.setAttribute("aria-expanded", "true");
                header.classList.add("menu-open");
            }
        });
    });
</script>

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <theme-toggle class="ms-auto">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main">
    <section aria-label="Blog post list">
        <a href="https://ayende.com/blog/157153/rant-signalr-crazyiness-head-butting-wall-crashing" target="_blank"><h1 class="title mb-6">Rant</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: July 20, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Before I get to the entire story, a few things:  The SignalR team is amazingly helpful.  SignalR isn&#x2019;t released, it is a 0.5 release.   Even so, the version that I was using was the very latest, not even the properly released 0.5 version. My use cases are probably far out from what SignalR is set out to support. A lot of the problems were actually my fault. One of the features for 1.2 is the changes features, a way to subscribe to notifications from the databases, so you won&#x2019;t have to poll for them. Obviously, this sounded like a good candidate for SingalR, so I set out to integrate SignalR into RavenDB. Now, that ain&#x2019;t as simple as it sounds.  SignalR relies on Newtonsoft.Json, which RavenDB also used to use. The problem with version compact meant that we ended up internalizing this dependency, so we have had to resolve this first.  RavenDB runs in IIS and as its own (HttpListener based) host. SignalR does the same, but makes assumptions about how it runs.  We need to minimize connection counts.  We need to support logic &amp; filtering for events on both server side and client side. The first two problems we solved by brute force. We internalized the SignalR codebase and converted its Netwonsoft.Json usage to the RavenDB&#x2019;s internalize version. Then I wrote modified one of the SignalR hosts to allow us to integrate that with the way RavenDB works. So far, that was relatively straightforward process. Then we had to write the integration parts. I posted about the external API yesterday.  My first attempt to write it was something like this:     public class Notifications : PersistentConnection&#xA;    {&#xA;        public event EventHandler Disposed = delegate { }; &#xA;        &#xA;        private HttpServer httpServer;&#xA;        private string theConnectionId;&#xA;&#xA;        public void Send(ChangeNotification notification)&#xA;        {&#xA;            Connection.Send(theConnectionId, notification);&#xA;        }&#xA;        public override void Initialize(IDependencyResolver resolver)&#xA;        {&#xA;            httpServer = resolver.Resolve&lt;HttpServer&gt;();&#xA;            base.Initialize(resolver);&#xA;        }&#xA;&#xA;        protected override System.Threading.Tasks.Task OnConnectedAsync(IRequest request, string connectionId)&#xA;        {&#xA;            this.theConnectionId = connectionId;&#xA;            var db = request.QueryString[&quot;database&quot;];&#xA;            if(string.IsNullOrEmpty(db))&#xA;                throw new ArgumentException(&quot;The database query string element is mandatory&quot;);&#xA;&#xA;            httpServer.RegisterConnection(db, this);&#xA;&#xA;            return base.OnConnectedAsync(request, connectionId);&#xA;        }&#xA;&#xA;        protected override System.Threading.Tasks.Task OnDisconnectAsync(string connectionId)&#xA;        {&#xA;            Disposed(this, EventArgs.Empty);&#xA;            return base.OnDisconnectAsync(connectionId);&#xA;        }&#xA;    }&#xA;&#xA;&#xA;This is the very first attempt. I then added the ability to add items of interest via the connection string, but that is the basic idea.&#xA;It worked, I was able to write the feature, and aside from some issues that I had grasping things, everything was wonderful. We had passing tests, and I moved on to the next step.&#xA;Except that&#x2026;. sometimes&#x2026;. those tests failed.&#xA0; Once every so often, and that indicate a race condition.&#xA;It took a while to figure out what was going on, but basically, what happened was that sometimes, SignalR uses a long polling transport to send messages. Note the code above, we register for events as long as we are connected. In long polling system (and in general in persistent connections that may come &amp; go), it is quite common to have periods of time where you aren&#x2019;t actually connected. &#xA;The race condition would happen because of the following sequence of events:&#xA;&#xA;Connected&#xA;Got message (long pooling, cause disconnect)&#xA;Disconnect&#xA;Message raised, client is not connected, message is gone&#xA;Connected&#xA;No messages for you&#xA;I want to emphasize that this particular issue is all me. I was the one misusing SignalR, and the behavior makes perfect sense.&#xA;SignalR actually contains a message bus abstraction exactly for those reasons. So I was supposed to use that. I know that now, but then I decided that I probably using the API at the wrong level, and moved to use hubs and groups.&#xA;In this way, you could connect to the hub, request to join to the group watching a particular document, and voila, we are done. That was the theory, at least. In practice, this was very frustrating.&#xA0; The first major issue was that I just couldn&#x2019;t get this thing to work.&#xA;The relevant code is:&#xA;    return temporaryConnection.Start()&#xA;                .ContinueWith(task =&gt;&#xA;                {&#xA;                    task.AssertNotFailed();&#xA;&#xA;                    hubConnection = temporaryConnection;&#xA;                    proxy = hubConnection.CreateProxy(&quot;Notifications&quot;);&#xA;                });&#xA;&#xA;&#xA;Note that I create the proxy after the connection has been established.&#xA;That turned out to be an issue, you have to create the proxy first, then call start. If you don&#x2019;t, SignalR will look like it is working fine, but will ignore all hub calls. I had to trace really deep into the SignalR codebase to figure that one out.&#xA;In my opinion (already communicated to the team) is that if you start a hub without a proxy, that is probably an error and should throw.&#xA;Once we got that fix, things started to work, and the test run.&#xA;Most of the time, that is. Once in a while, the tests would fail. Again, the issue was a race condition. But I wasn&#x2019;t doing anything wrong, I was using SignalR&#x2019;s API in a way straight out of the docs. This turned out to be a probably race condition inside InProcessMessageBus, where because of multiple threads running, registering for a group inside SignalR isn&#x2019;t visible on the next request.&#xA;That was extremely hard to debug.&#xA;Next, I decided to do away with hubs, by this time, I had a lot more understanding of the way SignalR worked, and I decided to go back to persistent connections, and simply implement the message dispatch in my code, rather than rely on SignalR groups.&#xA;That worked, great. The tests even passed more or less consistently.&#xA;The problem was that they also crashed the unit testing process, because of leaked exceptions. Here is one such case, in HubDispatcher.OnRecievedAsync():&#xA; return resultTask&#xA;                .ContinueWith(_ =&gt; base.OnReceivedAsync(request, connectionId, data))&#xA;                .FastUnwrap();&#xA;&#xA;&#xA;Note that &#x201C;_&#x201D; parameter. This is a convention I use as well, to denote a parameter that I don&#x2019;t care for). The problem here is that this parameter is a task, and if this task failed, you have a major problem, because on .NET 4.0, this will crash your system. In 4.5, that is fine and can be safely ignored, but RavenDB runs on 4.0.&#xA;So I found those places and I fixed them.&#xA;And then we run into hangs. Specifically, we had issues with disposing of connections, and sometimes of not disposing them, and&#x2026;&#xA;That was the point when I cut it. &#xA;I like the SignalR model, and most of the codebase is really good. But it is just not in the right shape for what I needed. By this time, I already have a pretty good idea about how SignalR operates, and it was a work of a few hours to get it working without SignalR. RavenDB now sports a streamed endpoint that you can register yourself to, and we have a side channel that you can use to send commands on to the server. It might not be as elegant, but it is simpler by a few orders of magnitude, and once we figure that out, we have a full blown working system at our hands.&#xA0; All the test passes, we have no crashes, yeah!&#xA;I will post exactly on how we did it in a future post.</p>
        <a href="https://ayende.com/blog/157121/awesome-feature-of-the-day-ravendb-changes-api" target="_blank"><h1 class="title mb-6">Awesome feature of the day, RavenDB Changes API</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: July 19, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This was a really hard feature. I&#x2019;ll discuss exactly why and how in my next post, but for now, I pretty much want to gloat about this. We now have the ability to subscribe to events from the server on the client.&#xA;&#xA;&#x9;This opens up some really nice stories for complex apps, but for now, I want to show you what it does:&#xA;&#xA;&#x9; store.Changes()&#xA;      .DocumentSubscription(&quot;orders/1293&quot;)&#xA;      .Subscribe(Reload);&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;You can add subscribe to multiple documents (or even all documents) and you can also subscribe to changes in indexes as well.&#xA;&#xA;&#x9;Why is this an awesome feature? It opens up a lot of interesting stories.&#xA;&#xA;&#x9;For example, let us assume that the user is currently editing an order. You can use this feature to detect, at almost no cost, when someone have changed that order, saving the user frustration when / if he tries to save his changes and get a concurrency exception.&#xA;&#xA;&#x9;You can also use this to subscribe to a particular index and update in memory caches on update, so the data is kept in memory, and you don&#x2019;t have to worry about your cache being stale, because you&#x2019;ll be notified when it does and can act on this.&#xA;&#xA;&#x9;You can even use this to watch for documents of a particular type coming in and do something about that. For example, you might setup a subscription for all alerts, and whenever any part of the system writes a new alert, you will show that to the user.&#xA;&#xA;&#x9;The last one, by the way, is a planned feature for RavenDB Studio itself. As well as a few others that I&#x2019;ll keep hidden for now .</p>
        <a href="https://ardalis.com/aspconf-2012-sessions/" target="_blank"><h1 class="title mb-6">aspConf 2012 Sessions</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: July 18, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Yesterday I presented two sessions foraspConf 2012. The first was a new talk I haven&#x2019;t given before on ASP.NET MVC Solution Best Practices&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ayende.com/blog/157089/system-vs-user-task-security-who-pays-the-sports-writer" target="_blank"><h1 class="title mb-6">System vs. User task security: Who pays the sports writer?</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: July 18, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Let us assume for a moment that we are building a system for a sports site. We have multiple authors, submitting articles, and we pay each author for those articles. The data model might look like this:  In this post, I want to talk about the security implications of such a system. Typically, this gets translated to requirements such as:  Authors can edit their articles. Authors cannot modify / view any payments. Which very often gets boiled down to something like this: GRANT SELECT,INSERT,UPDATE,DELETE ON Articles TO Authors;&#xA;DENY SELECT,INSERT,UPDATE,DELETE On Payments TO Authors;&#xA;What do you think of such a system? My approach, this is a horrible mess altogether. Think what it means for something like this:&#xA;public ActionResult SubmitArticle(Article article)&#xA;{&#xA;    if(IsValid(article)==false)&#xA;        return View();&#xA;&#xA;    Session.Store(article);&#xA;&#xA;    var payment = GetOrCreatePaymentFor(article.Author);&#xA;&#xA;    payment.AddArticle(article);&#xA;&#xA;    return RedirectToAction(&quot;index&quot;);&#xA;}&#xA;&#xA;&#xA;In order to run, this code would actually have to run under several different security credentials in order to work successfully.&#xA;That is before we take into account how using multiple users for different operations would result in total chaos for small things like connection pooling.&#xA;In real world systems, the security can&#x2019;t really operate based on the physical structure of the data in the data store. It is far too complex to manage. Instead, we implement security by separating the notion of the System performing tasks (such as adding a payment for an article) that are system tasks, and the System performing tasks on behalf of&#xA0; the user. &#xA;The security rules are implemented in the system, and the application user have no physical manifestations (such as being DB users) in the system at all.&#xA;And to the commentators, I know there are going to be some of you are going to claim that physical security at the database level is super critical, but while you are doing that, please also answer the problems of connection pooling and the complexities of multiple security contexts required for most real world business operations.</p>
        <a href="https://benfoster.io/blog/azure-virtual-machines-do-not-come-with-a-sysadmin/" target="_blank"><h1 class="title mb-6">Azure Virtual Machines do not come with a Sysadmin</h1></a>
        <p class="mb-2">by Ben Foster</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: July 18, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Don&#x2019;t be fooled (as I was) into thinking that the pre-made Windows Azure Virtual Machine images do not require any maintenance out of the box.</p>
        <a href="https://ardalis.com/getting-structuremap-to-work-with-mvc4-rc-and-web-api/" target="_blank"><h1 class="title mb-6">Getting StructureMap to Work with MVC4 RC and Web API</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: July 17, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">At the moment (18 July 2012) if you install the NuGet package structuremap.MVC4, it will not compile due to breaking changes in the ASP.NET&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ayende.com/blog/157057/implications-of-design-decisions-read-striping" target="_blank"><h1 class="title mb-6">Implications of design decisions: Read Striping</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: July 17, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">When using RavenDB replication, you have the option to do something that is called &#x201C;Read Striping&#x201D;. Instead of using replication only for High Availability and Disaster Recovery, we can also spread our reads among all the replicating servers. The question then becomes, how would you select which server to use for which read request? The obvious answer is to do something like this:  Request Number % Count of Servers = current server index. This is simple to understand, easy to implement and oh so horribly wrong in a subtle way that it is scary. Let us look at the following scenario, shall we?   Session #1 loads users/3 from Server A Session #1 then query (with non stale results) from Server B The users/3 document hasn&#x2019;t been replicated to Server B yet, so Server B sends back a reply &#x201C;here are my (non stale) results)&#x201D; Session #1 assumes that users/3 must be in the results, since they are non stale, and blows up as a result.  We want to avoid such scenarios. Werner Vogels, Amazon&#x2019;s CTO, has the following consistency definitions:  Causal consistency. If process A has communicated to process B that it has updated a data item, a subsequent access by process B will return the updated value and a write is guaranteed to supersede the earlier write. Access by process C that has no causal relationship to process A is subject to the normal eventual consistency rules.  Read-your-writes consistency. This is an important model where process A after it has updated a data item always accesses the updated value and never will see an older value. This is a special case of the causal consistency model.  Session consistency. This is a practical version of the previous model, where a process accesses the storage system in the context of a session. As long as the session exists, the system guarantees read-your-writes consistency. If the session terminates because of certain failure scenarios a new session needs to be created, and the guarantees do not overlap the sessions.  Monotonic read consistency. If a process has seen a particular value for the object any subsequent accesses will never return any previous values.  Monotonic write consistency. In this case the system guarantees to serialize the writes by the same process. Systems that do not guarantee this level of consistency are notoriously hard to program. What is the consistency model offered by this?  Request Number % Count of Servers = current server index. As it turned out, it is pretty much resolves into &#x201C;none&#x201D;. Because each request may be re-directed into a different server, there is no consistency guarantees that we can make.&#xA0; That can make reasoning about the system really hard. Instead, RavenDB choose to go another route, and we use the following formula to calculate which server we will use.  Session Number % Count of Servers = current server index. By using a session, rather than a request, counter to decide which server we will use when spreading reads, we ensure that all of the requests made within a single session are always going to the same server, ensuring we have session consistency. Within the scope of a single session, we can rely on that consistency, instead of the chaos of no consistency at all. It is funny, how such a small change can have such profound implication.</p>
        <a href="https://ayende.com/blog/157025/unprofessional-code-take-ii-answer" target="_blank"><h1 class="title mb-6">Unprofessional code, take II&#x2013;Answer</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: July 16, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Yesterday, I called this code unprofessional, and it is.  The reason that I call this code unprofessional is that it is a black box. Oh, sure, this is a great code in terms of readability and understand what is going on. But it is also a very complex piece of code, with a lot of things that are going on and it is in a critical location.  This sort of code cannot be a black box. Case in point, take a look at this email thread. We have a customer who is trying to understand why dynamic indexes are being created, when he has the proper indexes to answer query. And I had to ask a lot of questions to figure out what the problem was. Turned out, it is by design issue, but we could fix that . That is not a good place to be. I want my customers to be able to figure those things on their own. That is why the code now looks like this:  And you can ask RavenDB to explain how he got to a specific decision. For example, when we want to figure out why a specific index was selected (or, more likely, was not selected), we can issue the following request:  http://localhost:8080/databases/HibernatingRhinos.Orders/indexes/dynamic/Orders?query=OrderNumber:1293182&amp;explain=true  Which will give us the following output: [&#xA;   {&#xA;      &quot;Index&quot;:&quot;Auto/Orders/ByContractIdAndPayments_PaymentIdentifier&quot;,&#xA;      &quot;Reason&quot;:&quot;Can&#x27;t choose an index with a different number of from clauses / SelectMany, will affect queries like Count().&quot;&#xA;   },   {&#xA;      &quot;Index&quot;:&quot;Freebies/Search&quot;,&#xA;      &quot;Reason&quot;:&quot;Index does not apply to entity name: Orders&quot;&#xA;   },&#xA;   {&#xA;      &quot;Index&quot;:&quot;Orders/Search&quot;,&#xA;      &quot;Reason&quot;:&quot;The following fields are missing: &quot;&#xA;   },&#xA;   {&#xA;      &quot;Index&quot;:&quot;Orders/Stats&quot;,&#xA;      &quot;Reason&quot;:&quot;Can&#x27;t choose a map/reduce index for dynamic queries.&quot;&#xA;   },&#xA;   {&#xA;      &quot;Index&quot;:&quot;Products/Stats&quot;,&#xA;      &quot;Reason&quot;:&quot;Can&#x27;t choose a map/reduce index for dynamic queries.&quot;&#xA;   },&#xA;   {&#xA;      &quot;Index&quot;:&quot;Raven/DocumentsByEntityName&quot;,&#xA;      &quot;Reason&quot;:&quot;Query is specific for entity name, but the index searches across all of them, may result in a different type being returned.&quot;&#xA;   },&#xA;   {&#xA;      &quot;Index&quot;:&quot;Test&quot;,&#xA;      &quot;Reason&quot;:&quot;Index does not apply to entity name: Orders&quot;&#xA;   },&#xA;   {&#xA;      &quot;Index&quot;:&quot;Trials/Search&quot;,&#xA;      &quot;Reason&quot;:&quot;Index does not apply to entity name: Orders&quot;&#xA;   },&#xA;   {&#xA;      &quot;Index&quot;:&quot;Auto/Orders/ByOrderNumber&quot;,&#xA;      &quot;Reason&quot;:&quot;Selected as best match&quot;&#xA;   }&#xA;]&#xA;&#xA;&#xA;As you can see, that is a pretty good way to debug things, in production, without any complex steps or dedicated tools.&#xA;And, like in the previous example, reducing support costs is important.</p>
        <a href="https://ayende.com/blog/156993/unprofessional-code-take-ii" target="_blank"><h1 class="title mb-6">Unprofessional code, take II</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: July 13, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Since the previous time that I posted unprofessional code, I got a lot of comments about how I am cruel to poor developers, I decided to post some of my own code that isn&#x2019;t professional. The following is part of the RavenDB Dynamic Query Optimizer:  Hint, this single expression goes on for about 120 lines (the length isn&#x2019;t the reason it is not professional) and is quite important for RavenDB.</p>
        <a href="https://ayende.com/blog/156961/the-importance-of-temporary-indexes-for-ad-hoc-queries" target="_blank"><h1 class="title mb-6">The importance of temporary indexes for ad hoc queries</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: July 12, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In RavenDB, when you make an query without explicitly specifying which index you want to use, the query optimizer will select one for you. If none is found that can satisfy your query, the query optimizer will create one that matches your query, but it will do so on a temporary basis. That index will function normally, but if it isn&#x2019;t used, it will be removed after a while. If it is heavily used, it will be converted to a real index.  I was reminded of this today when I realized that I had a bug in our code that caused a value to be misspelled. There were just a few such documents, and I went into the studio and fixed them manually. I had to use a dynamic query to do so, and I was amused to realize that this is the exact scenario for which we built them. An admin doing ad hoc operations, probably to resolve some bug or issue. Sometimes, just having things work out the way you planned make for a great day. And hey, this is what I was avoiding:</p>
        <div class="button flex justify-between">
            <a href="329.html"><span class="back arrow"></span></a>

            <a href="331.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
</body>
</html>