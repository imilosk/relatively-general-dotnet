
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 545 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-5441">
            <a href="https://ayende.com/blog/4335/uberprof-performance-improvements-or-when-o-n-3-n-is-not-fast-enough" target="_blank">
                <h2 class="title mb-6" id="article-5441">UberProf performance improvements, or: when O(N^3 &#x2B; N) is not fast enough</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 23, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">While working on improving the performance of the profiler, I got really annoyed. The UI times for updating sessions with large amount of statements was simply unacceptable. We already virtualized the list UI, so it couldn&#x2019;t be that. I started tracking it down, and it finally came down to the following piece of code:     protected override void Update(IEnumerable&lt;IStatementSnapshot&gt; snapshots)&#xA;{&#xA;    foreach (var statementSnapshot in snapshots)&#xA;    {&#xA;        var found = (from model in unfilteredStatements&#xA;                     where model.Id == statementSnapshot.StatementId&#xA;                     select model).FirstOrDefault();&#xA;&#xA;        if (found == null)&#xA;        {&#xA;            unfilteredStatements.Add(&#xA;                new StatementModel(applicationModel, statementSnapshot) {CanJumpToSession = false});&#xA;        }&#xA;        else&#xA;        {&#xA;            found.UpdateWith(statementSnapshot);&#xA;        }&#xA;    }&#xA;&#xA;    if (snapshots.Any())&#xA;    {&#xA;        hasPolledForStatements = true;&#xA;        StatementsChanged(this, &#xA;            new StatementsChangedEventArgs {HasPolledForStatments = hasPolledForStatements});&#xA;    }&#xA;}&#xA;  &#xA;&#xA;This looks pretty innocent, right? At a guess, what is the performance characteristics of this code?&#xA;&#xA;It isn&#x2019;t O(N), that is for sure, look at the linq query, it will perform a linear search in the unfilteredStatements, which is an O(N) operation. *&#xA;&#xA;At first glance, it looks like O(N*N), right? Wrong!&#xA;&#xA;unfilteredStatements is an ObservableCollection, and guess what is going on in the CollectionChanged event? A statistics function that does yet another O(N) operation for every single added statement.&#xA;&#xA;Finally, we have the StatementsChanged handler, which will also perform an O(N) operation, but only once.&#xA;&#xA;&#xA;  protected override void Update(IEnumerable&lt;IStatementSnapshot&gt; snapshots)&#xA;{&#xA;    var hasStatements = false;&#xA;    foreach (var statementSnapshot in snapshots)&#xA;    {&#xA;        IStatementModel found;&#xA;        statementsById.TryGetValue(statementSnapshot.StatementId, out found);&#xA;        hasStatements = true;&#xA;&#xA;        if (found == null)&#xA;        {&#xA;            unfilteredStatements.Add(new StatementModel(applicationModel, statementSnapshot) {CanJumpToSession = false});&#xA;            statementsById.Add(statementSnapshot.StatementId, found);&#xA;        }&#xA;        else&#xA;        {&#xA;            found.UpdateWith(statementSnapshot);&#xA;        }&#xA;    }&#xA;&#xA;    if (hasStatements == false) &#xA;        return;&#xA;    HandleStatementsOrFiltersChanging(true);&#xA;}&#xA;  &#xA;&#xA;The changes here are subtle, first, we killed off the O(N) linq query in favor of an O(1) lookup in a hashtable. Second, unfilteredStatements is now a simple List&lt;T&gt;, and HandleStatementsOrFilterChanging is the one responsible for notifications. Just these two changes were sufficent from the O(N^3&#x2B;N) that we had before to a simple O(N&#x2B;N) (because we still run some statistical stuff at the end) which collapses so a simple O(N).&#xA;&#xA;Once that is done, showing sessions with 50,000 statements in them became instantaneous.&#xA;&#xA;* Yes, it is supposed to be O(M) because the unfilteredStatements.Count is different than snapshots.Count, but I am simplifying here to make things easier.</p>
        </article>
        <article id="article-5442">
            <a href="https://ayende.com/blog/4334/uberprof-performance-improvements" target="_blank">
                <h2 class="title mb-6" id="article-5442">UberProf performance improvements</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 22, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I mentioned before that I run into some performance problems, I thought it would be interesting to see how I solved them.   The underlying theme was finding O(N) operations are eradicating them. In almost all the cases, the code is more complex, but significantly faster              Old code        New code                           public static class TimestampExtensions&#xA;{&#xA;    public static void AddInPlace&lt;T&gt;(this IList&lt;T&gt; self, T model)&#xA;        where T : IHaveTimestamp&#xA;    {&#xA;        int index = self.Count;&#xA;        for (var i = 0; i &lt; self.Count; i&#x2B;&#x2B;)&#xA;        {&#xA;            if (self[i].Timestamp &gt; model.Timestamp)&#xA;            {&#xA;                index = i;&#xA;                break;&#xA;            }&#xA;        }&#xA;        self.Insert(index, model);&#xA;    }    &#xA;}&#xA;        &#xA;&#xA;      &#xA;        public static class TimestampExtensions&#xA;{&#xA;    public static void AddInPlace(this IList&lt;SqlStatement&gt; self, SqlStatement model)&#xA;    {&#xA;        var timestamp = model.Timestamp;&#xA;        var index = self.Count;&#xA;        if (index &gt; 0 &amp;&amp; timestamp &gt;= self[index - 1].Timestamp)&#xA;        {&#xA;            self.Add(model);&#xA;            return;&#xA;        }&#xA;        for (var i = 0; i &lt; self.Count; i&#x2B;&#x2B;)&#xA;        {&#xA;            if (self[i].Timestamp &lt; timestamp) &#xA;                continue;&#xA;            index = i;&#xA;            break;&#xA;        }&#xA;        self.Insert(index, model);&#xA;    }    &#xA;}&#xA;        &#xA;    &#xA;  &#xA;&#xA;Here we optimize for the common case where we add the statement to the end of the list. We also changed from generic method with interface constraint to the actual type used. That allows the JIT to apply additional optimizations. That method alone was responsible for almost 10 minutes in my test runs.&#xA;&#xA;&#xA;    &#xA;      Old code&#xA;&#xA;      New code&#xA;    &#xA;&#xA;    &#xA;      &#xA;        var statement = session.Statements&#xA;    .Reverse()&#xA;    .Where(x =&gt; x.SessionId.Timestamp &lt;= queryDuration.SessionId.Timestamp)&#xA;    .FirstOrDefault();&#xA;        &#xA;&#xA;      &#xA;        var statement = session.Statements.LastOrDefault();&#xA;        &#xA;    &#xA;  &#xA;&#xA;session.Statements is already ordered by the statements timestamps. The code perform a slightly differently here, and it is less robust to async message streaming (when events that happened sequentially arrive in different order than they occured), but that is rare enough that I feel that the performance boost from this is acceptable.&#xA;&#xA;&#xA;    &#xA;      Old code&#xA;&#xA;      New code&#xA;    &#xA;&#xA;    &#xA;      &#xA;        public override void AfterAttachingToSession(         SessionInformation sessionInformation, SqlStatement statement)&#xA;{&#xA;    var isSelectStatement = statement.IsSelectStatement;&#xA;    if (isSelectStatement == false)&#xA;        return;&#xA;&#xA;    if (statement.RawSql == mySqlSelectLastIdentity)&#xA;        return;&#xA;&#xA;    int countOfStatementsWithIdenticalSql = sessionInformation.Statements&#xA;        .Count(x =&gt; x.RawSql == statement.RawSql);&#xA;    if (countOfStatementsWithIdenticalSql &lt;         configuration.MaxRepeatedStatementsForSelectNPlusOne)&#xA;        return;&#xA;    statement.AcceptAlert(AlertInformation.SelectNPlusOne());&#xA;}&#xA;        &#xA;&#xA;      &#xA;        public int GetCountOfStatementsByRawSql(string rawSql)&#xA;{&#xA;    int value;&#xA;    countsByRawSql.TryGetValue(rawSql, out value);&#xA;    return value;&#xA;}&#xA;&#xA;public void AddStatement(SqlStatement statement)&#xA;{&#xA;    int count;&#xA;    if (countsByRawSql.TryGetValue(statement.RawSql, out count) == false)&#xA;        count = 0;&#xA;    countsByRawSql[statement.RawSql] = count &#x2B; 1;&#xA;    &#xA;    statements.AddInPlace(statement);&#xA;    StatementsChanged();&#xA;}&#xA;&#xA;&#xA;public override void AfterAttachingToSession(&#xA;    SessionInformation sessionInformation, SqlStatement statement)&#xA;{&#xA;    var isSelectStatement = statement.IsSelectStatement;&#xA;    if (isSelectStatement == false)&#xA;        return;&#xA;&#xA;    if (statement.RawSql == mySqlSelectLastIdentity)&#xA;        return;&#xA;&#xA;    if (sessionInformation.GetCountOfStatementsByRawSql(statement.RawSql) &lt; &#xA;        configuration.MaxRepeatedStatementsForSelectNPlusOne)&#xA;        return;&#xA;    statement.AcceptAlert(AlertInformation.SelectNPlusOne());&#xA;}&#xA;        &#xA;    &#xA;  &#xA;&#xA;On the left, we have the old code, that did the calculations manually. On the right, the two top methods will do the calculation up front, and then it is just a matter of reading it in the appropriate times.&#xA;&#xA;&#xA;    &#xA;      Old code&#xA;&#xA;      New code&#xA;    &#xA;&#xA;    &#xA;      &#xA;        protected void ClearStackTraceFromInfrastructureFrameworks(StackTraceInfo stackTrace)&#xA;{&#xA;    if (configuration.InfrastructureNamespaces == null)&#xA;        return;&#xA;    &#xA;    stackTrace.Frames =stackTrace.Frames.Where(&#xA;        frame =&gt;&#xA;        {&#xA;            var isInfrastructureNamespace = &#xA;                configuration.InfrastructureNamespaces.Any(&#xA;                ns =&gt; frame.Namespace != null &amp;&amp; frame.Namespace.StartsWith(ns)&#xA;                );&#xA;&#xA;            return isInfrastructureNamespace == false ||&#xA;                   configuration.NonInfrastructureNamespaces.Any(&#xA;                    ns =&gt; frame.Namespace != null &amp;&amp; frame.Namespace.StartsWith(ns)&#xA;                    );&#xA;        }).ToArray();&#xA;}&#xA;        &#xA;&#xA;      &#xA;        public StackTraceProcessor(ProfilerConfiguration configuration)&#xA;{&#xA;    this.configuration = configuration;&#xA;    var sb = new StringBuilder();&#xA;    foreach (var infrastructureNamespace in &#xA;        configuration.InfrastructureNamespaces ?? new List&lt;string&gt;())&#xA;    {&#xA;        sb.Append(&quot;(^&quot;)&#xA;            .Append(Regex.Escape(infrastructureNamespace))&#xA;            .Append(&quot;)|&quot;);&#xA;    }&#xA;    sb.Length = sb.Length - 1;&#xA;    namespacesToClear = new Regex(sb.ToString(),&#xA;        RegexOptions.Compiled | RegexOptions.IgnoreCase);&#xA;    sb.Length = 0;&#xA;&#xA;    foreach (var infrastructureNamespace in &#xA;        configuration.NonInfrastructureNamespaces ?? new List&lt;string&gt;())&#xA;    {&#xA;        sb.Append(&quot;(^&quot;)&#xA;            .Append(Regex.Escape(infrastructureNamespace))&#xA;            .Append(&quot;)|&quot;);&#xA;    }&#xA;    sb.Length = sb.Length - 1;&#xA;    namespacesToKeep = new Regex(sb.ToString(), &#xA;        RegexOptions.Compiled | RegexOptions.IgnoreCase);&#xA;}&#xA;&#xA;protected void ClearStackTraceFromInfrastructureFrameworks(StackTraceInfo stackTrace)&#xA;{&#xA;    if (configuration.InfrastructureNamespaces == null)&#xA;        return;&#xA;&#xA;    stackTrace.Frames =&#xA;        stackTrace.Frames.Where(IsValidStackFrameMethod).ToArray();&#xA;}&#xA;&#xA;private bool IsValidStackFrameMethod(StackTraceFrame frame)&#xA;{&#xA;    if (frame.Namespace == null)&#xA;        return true;&#xA;    if(namespacesToClear.IsMatch(frame.Namespace) == false)&#xA;        return true;&#xA;    return namespacesToKeep.IsMatch(frame.Namespace);&#xA;}&#xA;        &#xA;    &#xA;  &#xA;&#xA;Interestingly enough, this code produced much better runtime performance, simply because, while it is more complex, the number of iterations that are happening are so much smaller.&#xA;&#xA;Overall, the change result in order of magnitude or two difference for processing messages in the profiler pipeline.</p>
        </article>
        <article id="article-5443">
            <a href="https://ayende.com/blog/4333/effectus-isolated-features" target="_blank">
                <h2 class="title mb-6" id="article-5443">Effectus</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 21, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Continuing in my exploration of the Effectus code base, which originated from my Building a Desktop To-Do Application with NHibernate article on MSDN Magazine, I wanted to talk today about separating features into individual pieces in the application.  Each feature in the Effectus application is built as an isolated unit, that has little to do with any other features. This is very clear when you look at how they are organized:  &#xA0;     Sidenote: In each feature, the component parts are named the same (Presenter, View, Model). This is intentional, since it make it that much harder to mix stuff from other features.     Every feature has a pretty rigid structure, defined by the application, and trying to reuse stuff between features is frowned upon and avoided, even if doing so can reduce duplication. As a good example, the Model for both CreateNew and Edit features are identical, but they are two different classes with no attempt to merge it up.  The reason for this is quite simple, treating each feature as an isolated unit bring us great benefits, we can have different developers working on different features without the chance of stepping on each other toes, it is very hard for one feature to break another, deploying new features is easier to handle, etc. Trying to apply DRY and consolidate common pieces of code would introduce dependencies between features, and that is a bad idea.  But what about communication between features? What about when one feature needs to call another?  As it turned out, it is quite easy to turn a lot of the inter feature communication into an indirect calls, using pub/sub. We gain the independence from dependencies using pub/sub, while maintaining the feel of a well integrated product for the user. For the rare cases of one feature calling another, I create a simple Call(&#x201C;FeatureName&#x201D;) mechanism (in the code, this is Presenters.Show(name) method) that all us to just explicitly invoke another feature, maybe with some initial arguments. A more complete implementation will handle even that using pub/sub, probably with an integrator class that would dispatch the appropriate event to start and invoke the feature(s) that want to handle it.  You can read more about the architecture principles behind this system in: Application structure: Concepts &amp; Features</p>
        </article>
        <article id="article-5444">
            <a href="https://ardalis.com/using-ramdisk-to-speed-build-times/" target="_blank">
                <h2 class="title mb-6" id="article-5444">Using RAMDisk to Speed Build Times</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 20, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Now that computers with 64-bit operating systems and 8 or 12 GB of RAM are pretty affordable, there are some fairly easy things you can do&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-5445">
            <a href="https://ardalis.com/devlink-2010-call-for-speakers/" target="_blank">
                <h2 class="title mb-6" id="article-5445">DEVLINK 2010 Call For Speakers</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 20, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The call for speakers for DEVLINK 2010 is now open. They are opening the call earlier this year to allow everyone ample time to consider the&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-5446">
            <a href="https://ayende.com/blog/4332/effectus-fatten-your-infrastructure" target="_blank">
                <h2 class="title mb-6" id="article-5446">Effectus</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 20, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Continuing in my exploration of the Effectus code base, which originated from my Building a Desktop To-Do Application with NHibernate article on MSDN Magazine, I wanted to talk today about how to build an application infrastructure.  First, to be clear, I am not talking about infrastructure pieces such as caching, data access, etc. Those are generic concerns and you should be able to just get them from an off the shelve library. When I am talking about an application infrastructure, I am talking about the infrastructure code that you are going to need to write for a particular application. You are always going to have to do that, even if it is something as simple as just wiring the container together, or registering session handling, etc.  From my point of view, the point of the application infrastructure is to make writing the actual application features as simple as possible. Ideally, you want to make the infrastructure pieces handle everything that isn&#x2019;t purely related to the feature you are implementing. The reason that an application infrastructure can do this while a generic infrastructure cannot is that an application infrastructure can make a lot of assumptions about the way the application is built.  Let us take the Main screen feature in Effectus, shall we, it will let us look at how this is implemented:     public Observable&lt;int&gt; CurrentPage { get; set; }&#xA;&#xA;public Fact CanMovePrev&#xA;{&#xA;    get { return new Fact(CurrentPage, () =&gt; CurrentPage &gt; 0); }&#xA;}&#xA;&#xA;public Fact CanMoveNext&#xA;{&#xA;    get { return new Fact(CurrentPage, () =&gt; CurrentPage &#x2B; 1 &lt; NumberOfPages); }&#xA;}&#xA;&#xA;public void OnCreateNew()&#xA;{&#xA;    Presenters.Show(&quot;CreateNew&quot;);&#xA;}&#xA;&#xA;public void OnActionsChoosen(ToDoAction action)&#xA;{&#xA;    Presenters.Show(&quot;Edit&quot;, action.Id);&#xA;}&#xA;&#xA;public void OnLoaded()&#xA;{&#xA;    LoadPage(0);&#xA;}&#xA;&#xA;public void OnMoveNext()&#xA;{&#xA;    LoadPage(CurrentPage &#x2B; 1);&#xA;}&#xA;&#xA;public void OnMovePrev()&#xA;{&#xA;    LoadPage(CurrentPage - 1);&#xA;}&#xA;  &#xA;&#xA;Looking the code, we can see that there are actually a lot of infrastructure playing a part here.&#xA;&#xA;&#xA;  Automatic binding of On[Button Name]() methods to the button command.&#xA;&#xA;  &#xA;    Within this, enabling / disabling automatically using Can[Button Name] properties&#xA;  &#xA;&#xA;  Automatic binding of On[List name]Choosen(Item) to the selected item changed behavior on the list.&#xA;&#xA;  Automatic updates of property states using Fact.&#xA;&#xA;  Automatic updates of property values, using Observable.&#xA;&#xA;&#xA;There isn&#x2019;t much to say about the automatic binding between UI actions and presenter methods, except that I think it is clear how this behavior reduce the level of infrastructure level code that you would have to write, test and maintain. But both Fact and Observable deserve a bit more explanation.&#xA;&#xA;In the LoadPage() method, not shown here, we are updating the CurrentPage property, this will trigger invalidation of the all the facts bound to the value (CanMoveNext, CanMovePrev), which will force their re-evaluation. Since the infrastructure knows how to wire this up to the appropriate commands on the UI, this means that this will enable/disable the given controls automatically. What is more, look at the code. It is clear, concise and pretty easy to reason about and use.&#xA;&#xA;I&#x2019;ll leave the actual exploration of the implementation to you, it is fairly simple, but the idea is important. The Effectus application actually have more infrastructure code than it have code to implement its features. But that is a very small application. Just to give you an idea, the # of lines of code devoted to infrastructure in Effectus is about 600 LOC! In most applications, you probably wouldn&#x2019;t even notice the amount of code that the infrastructure takes, but the effects are quite clear.</p>
        </article>
        <article id="article-5447">
            <a href="https://ardalis.com/view-binary-encoded-wcf-messages/" target="_blank">
                <h2 class="title mb-6" id="article-5447">View Binary Encoded WCF Messages</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 19, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">If you&#x2019;re doing any work with WCF (and perhaps Silverlight, for example, but any client will do) and you&#x2019;d like to maximize the performance&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-5448">
            <a href="https://ayende.com/blog/4331/effectus-building-ui-based-on-conventions" target="_blank">
                <h2 class="title mb-6" id="article-5448">Effectus</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 19, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I waited for a while after my article was posted, to see if anyone caught on to some of the things that I did in the sample code that weren&#x2019;t related to NHibernate usage. It seems that no one caught on to that, so I&#x2019;ll try pointing them out explicitly.  The basic format of a feature in Effectus is this:     Each feature have a Presenter (business logic for the feature), a View Model, which is directly bound to the View and is the main way that Presenter has to communicate with the View. The main responsibility of the Model is to be bound to the UI, and allow the presenter to update it, but it is not quite enough.  The UI also need to raise events and handle user input. A common example is handling button clicks. You can&#x2019;t really map them into Model behavior, at least not easily and in a way that make sense to the developers. Instead, I defined a set of conventions. As you can see in the picture, based on the name of the element, we match is with the appropriate execute method and the way to decide if the command can execute. Under the cover, we generate the appropriate ICommand instance, bound to the Presenter behavior.     If you look at the code, you can see that the conventions extend even to handling the selected item changed in a list box, including passing the newly selected instance back to the presenter. Those conventions are project specific, based on what the project need, and they result in a code base that is very easy to read and follow. Moreover, they result in a codebase that is relatively free from infrastructure concerns.  I am going to have a few more posts about Effectus, can you figure out what else I put in that code base?</p>
        </article>
        <article id="article-5449">
            <a href="https://ardalis.com/where-is-the-fix-button-in-windows-photo-viewer-in-windows-7/" target="_blank">
                <h2 class="title mb-6" id="article-5449">Where is the Fix button in Windows Photo Viewer in Windows 7?</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 18, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I love Windows 7. I&#x27;m using it now on my new primary laptop computer, and going through pictures getting ready for the holidays. And of&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-5450">
            <a href="https://ayende.com/blog/4330/how-to-write-mef-in-2-hours-or-less" target="_blank">
                <h2 class="title mb-6" id="article-5450">How to write MEF in 2 hours or less</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 18, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">It took me a while to get around to this blog post, I promised Glenn that I would write it ages ago.  The title of this blog post, which is admittedly provocative, refer to a (I believe intentional) misinterpretation of a comment of mine in a MEF talk. It might also explain my general attitude about software in general.  MEF is a pretty big library, and it does a whole host of things. But when talking about it, there are specific features that keep getting mentioned over and over, probably because they are:     Really nice features.    Demo very well.   A good example of that is MEF ability to import new types on the fly. It is something really nice, but it isn&#x2019;t something that is really impressive to me. Doing dynamic loading isn&#x2019;t really hard. That has led me to make the comment that turned into the title of this post.  The actual comment I made was: &#x201C;I can implement this feature (dynamic loading) in less than two hours.&#x201D; The problem is that that was interpreted as saying that I can implement MEF itself in 2 hours (just to be clear, it isn&#x2019;t possible). What is possible, however, is to implement interesting parts of MEF for a particular scenario in a short amount of time.   In fact, most of the time, I can implement the features that I find attractive in some software (not limited to MEF) faster than I can learn how to use that software in the first place. Granted, it may be a single purpose, only-works-under-the-following-set-of-assumptions implementation, but it will work, it will be faster out of the gate and it will limit the number of dependencies that I have to manage.  It is something that you have to consider, because sometimes you want to put those responsibilities at the hands of some other party because you don&#x2019;t want to deal with that. Sometimes you explicitly want to do it yourself because giving up control on this thing (or adapting to the way some library does it) is not acceptable.</p>
        </article>
        <div class="button flex justify-between">
            <a href="544.html"><span class="back arrow"></span></a>

            <a href="546.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>