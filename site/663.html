
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 663 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-6621">
            <a href="https://ayende.com/blog/3406/why-i-dont-like-firebird-part-i" target="_blank">
                <h2 class="title mb-6" id="article-6621">Why I don&#x27;t like Firebird</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 07, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I mentioned before that my main objection to this DB is its utter lack of tooling. I mean, even SQLite has some tools. For Firebird, there seem to be nothing that works on my machine.  I needed to debug something there, and this was the easiest solution.</p>
        </article>
        <article id="article-6622">
            <a href="https://ayende.com/blog/3405/things-you-should-never-do" target="_blank">
                <h2 class="title mb-6" id="article-6622">Things you should never do</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 06, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">That should be pretty high in the list, I think:</p>
        </article>
        <article id="article-6623">
            <a href="https://ayende.com/blog/3404/challenge-find-the-deadlock" target="_blank">
                <h2 class="title mb-6" id="article-6623">Challenge</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 05, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Okay, there isn&#x27;t much of a challenge here, but it is worth point out nevertheless:</p>
        </article>
        <article id="article-6624">
            <a href="https://ayende.com/blog/3403/a-tdd-dilemma" target="_blank">
                <h2 class="title mb-6" id="article-6624">A TDD Dilemma</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 05, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am currently modifying some core parts of the system, changing it from using a SQLite DB to using Berkeley DB. The problem is that it is causing... issues.  I have things fairly well isolated, but I need to write code that make this test pass:   As you notice, this is a test for the repository, and it is verifying that the changes has been written to DB correctly.  I removed the references to SQLite and am ready to write the BDB implementation. But I can&#x27;t. I have no idea how to design it, and I can&#x27;t write tests to allow incremental design because all the tests are broken.  I am creating a Temp.Tests project now, and TDDing the implementation, after which I will fix the tests that currently cannot compile.</p>
        </article>
        <article id="article-6625">
            <a href="https://ayende.com/blog/3402/bug-magnet" target="_blank">
                <h2 class="title mb-6" id="article-6625">Bug magnet</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 04, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">If you ever need to understand why I tend to be involved so many projects, it is for a simple reason. I am apparently a bug magnet. I mentioned that I managed to cause FireBird to corrupt itself, which is why I am not intending to use it. Now I have another contender to the list.  Berkeley DB is a well known, widely used, and in general though to be very stable. I decided to use it, mainly because it is cool and I really need to learn something new. (It is running a lot of interesting things, and I want to be able to give concrete opinions on that.)  So, I start by writing tests, to ensure that it behave the way I expect it to. It doesn&#x27;t, so I go and read the documentation, and it explained that my assumptions were wrong. Okay, I can deal with that, I learn more about this, and starting to experiment with how it works.   It was going fairly well, until I started to toy with transactions and isolations. One of the early tests is to see whatever read committed transactions work.  I wanted to get this (pseudo code) to pass:     using (var environment = new BerkeleyDbEnvironment(&quot;test&quot;))&#xA;{&#xA;    using (var tx = environment.BeginTransaction())&#xA;    using (var queue = environment.OpenQueue(&quot;my-queue&quot;))&#xA;    {&#xA;&#xA;        queue.Append(new DateTime(2000, 1, 1));&#xA;&#xA;        // now test that we cannot read it&#xA;        using (var environment2 = new BerkeleyDbEnvironment(&quot;test&quot;))&#xA;        {&#xA;            using (var tx2 = environment2.BeginTransaction())&#xA;            using (var queue2 = environment2.OpenQueue(&quot;my-queue&quot;))&#xA;            {&#xA;                Assert.IsNull(queue2.Consume());&#xA;                tx2.Commit();&#xA;            }&#xA;        }&#xA;&#xA;        tx.Commit();&#xA;    }&#xA;}&#xA;&#xA;&#xA;However, not only did the test fail, it also corrupt the DB state, and corrupt the process state (leaving file handles hanging). At first, I blamed myself, then I blamed the code. Finally, I blamed the .Net API Binding.&#xA;&#xA;Eventually I decided that I really need to write my own, to fix this issue. Luckily, I decided to try to reproduce the same scenario using the native C API. This is the first time I touched C in years, so you can imagine how pissed off I was.&#xA;&#xA;I got the same error! And it is a scary one:&#xA;&#xA;&#xA;  PANIC: fatal region error detected; run recovery &#xA;    PANIC: fatal region error detected; run recovery &#xA;&#xA;    File handles still open at environment close &#xA;&#xA;    Open file handle: test\my-test-queue &#xA;&#xA;    PANIC: fatal region error detected; run recovery&#xA;&#xA;&#xA;Here the full C code, running against BDB 4.7.&#xA;&#xA;&#xA;  //create environment &amp; queue&#xA;u_int32_t envCreateFlags = DB_CREATE |&#xA;&#x9;&#x9;&#x9;   DB_INIT_LOCK|&#xA;&#x9;&#x9;&#x9;   DB_INIT_LOG|&#xA;&#x9;&#x9;&#x9;   DB_INIT_MPOOL|&#xA;&#x9;&#x9;&#x9;   DB_INIT_TXN|&#xA;&#x9;&#x9;&#x9;   DB_RECOVER;&#xA;&#xA;char* path = &quot;test&quot;;&#xA;&#xA;DB_ENV *createDbEnv;&#xA;db_env_create(&amp;createDbEnv, 0);&#xA;createDbEnv-&gt;open(createDbEnv,path, envCreateFlags, 0);&#xA;&#xA;DB *createDbDb;&#xA;db_create(&amp;createDbDb, createDbEnv, 0);&#xA;createDbDb-&gt;set_re_len(createDbDb, 128);&#xA;createDbDb-&gt;open(createDbDb, NULL, &quot;my-test-queue&quot;, NULL, DB_QUEUE, DB_CREATE, 0);&#xA;createDbDb-&gt;close(createDbDb, 0);&#xA;createDbEnv-&gt;close(createDbEnv, 0);&#xA;&#xA;// write to queue&#xA;DB_ENV *writeToQueueEnv ;&#xA;db_env_create(&amp;writeToQueueEnv, 0);&#xA;writeToQueueEnv-&gt;open(writeToQueueEnv, path, envCreateFlags, 0);&#xA;DB_TXN *writeToQueueTxn;&#xA;&#xA;writeToQueueEnv-&gt;txn_begin(writeToQueueEnv, NULL, &amp;writeToQueueTxn, DB_READ_COMMITTED);&#xA;&#xA;DB *writeToQueueDb;&#xA;db_create(&amp;writeToQueueDb, writeToQueueEnv, 0);&#xA;writeToQueueDb-&gt;open(writeToQueueDb, writeToQueueTxn, &quot;my-test-queue&quot;, NULL, DB_QUEUE, 0, 0);&#xA;&#xA;int keyVal = 5;&#xA;int valVal = 3;&#xA;&#xA;DBT key, value;&#xA;memset(&amp;key, 0, sizeof(DBT));&#xA;memset(&amp;value, 0, sizeof(DBT));&#xA;&#xA;key.data = &amp;keyVal;&#xA;key.size = sizeof(int);&#xA;value.data = &amp;valVal;&#xA;value.size = sizeof(DBT);&#xA;&#xA;writeToQueueDb-&gt;put(writeToQueueDb,&#x9;writeToQueueTxn, &amp;key, &amp;value, DB_APPEND);&#xA;&#xA;// now try to read using another transaction&#xA;&#xA;// read from queue in middle of uncommited transaction&#xA;DB_ENV *readFromQueueEnv ;&#xA;db_env_create(&amp;readFromQueueEnv, 0);&#xA;readFromQueueEnv-&gt;open(readFromQueueEnv, path, envCreateFlags, 0);&#xA;DB_TXN *readFromQueueTxn;&#xA;&#xA;readFromQueueEnv-&gt;txn_begin(readFromQueueEnv, NULL, &amp;readFromQueueTxn, DB_READ_COMMITTED);&#xA;&#xA;DB *readFromQueueDb;&#xA;db_create(&amp;readFromQueueDb, readFromQueueEnv, 0);&#xA;readFromQueueDb-&gt;open(readFromQueueDb, readFromQueueTxn, &quot;my-test-queue&quot;, NULL, DB_QUEUE, 0, 0);&#xA;&#xA;int readFromQueueKeyVal = 5;&#xA;int val2Val = 3;&#xA;&#xA;DBT readFromQueueKey, readFromQueueData;&#xA;memset(&amp;readFromQueueKey, 0, sizeof(DBT));&#xA;memset(&amp;readFromQueueData, 0, sizeof(DBT));&#xA;&#xA;readFromQueueKey.data = &amp;keyVal;&#xA;readFromQueueKey.size = sizeof(int);&#xA;readFromQueueData.data = &amp;valVal;&#xA;readFromQueueData.size = sizeof(DBT);&#xA;&#xA;int ret = readFromQueueDb-&gt;get(readFromQueueDb, readFromQueueTxn, &amp;key, &amp;value, DB_CONSUME);&#xA;if( ret == DB_NOTFOUND)&#xA;&#x9;Console::WriteLine(&quot;not found&quot;);&#xA;&#xA;readFromQueueTxn-&gt;close(readFromQueueTxn, 0);&#xA;readFromQueueDb-&gt;close(readFromQueueDb, 0);&#xA;readFromQueueEnv-&gt;close(readFromQueueEnv, 0);&#xA;&#xA;&#xA;// now commit write transaction&#xA;writeToQueueTxn-&gt;commit(writeToQueueTxn, 0);&#xA;writeToQueueDb-&gt;close(writeToQueueDb,0);&#xA;writeToQueueEnv-&gt;close(writeToQueueEnv, 0);&#xA;&#xA;&#xA;Now, what the hell am I doing wrong? I am pretty sure that I am missing something. Just to give you an idea about what the issue is, this is about as bad as if running this code would crash a SQL database:&#xA;&#xA;&#xA;  using( var con = new SomeDbConnection(&quot; connection string &quot;))&#xA;using( var tx = con.BeginTransaction())&#xA;using( var cmd = con.CreateCommand() )&#xA;{&#xA;&#x9;cmd.Transaction = tx;&#xA;&#x9;cmd.CommandText = &quot;INSERT INTO Queue (Data) VALUES(&#x27;a&#x27;)&quot;;&#xA;      cmd.ExecuteNonQuery();&#xA;&#x9;&#xA;&#x9;using( var con2 = new SomeDbConnection(&quot; connection string &quot;))&#xA;&#x9;using( var tx2 = con2.BeginTransaction())&#xA;&#x9;using( var cmd2 = con2.CreateCommand() )&#xA;&#x9;{&#xA;&#x9;&#x9;cmd.Transaction = tx;&#xA;&#x9;&#x9;cmd.CommandText = &quot;DELETE FROM Queue&quot;&#xA;&#x9;      int rowAffected = cmd.ExecuteNonQuery();&#x9;&#x9;&#xA;&#x9;&#x9;Assert.AreEqual(0, rowAffected);&#xA;&#x9;&#x9;tx2.Commit();&#xA;&#x9;}&#x9;&#xA;&#x9;&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;Sigh, if I were a tester, I would be a menace.&#xA;&#xA;Updates:&#xA;&#xA;The error occurs if &amp; only if you are creating two environments in the same process. What is annoying is that this is at least implicitly allowed. Only if you specify DB_REGISTER you are limited to a single environment per process (and there is a check for it).&#xA;&#xA;It turns out that this is an issue of using the DB_RECOVER flag in multiple environments at the same time. When you create a new environment with DB_RECOVER, it clear the process state. Yuck. Full details can be found here.</p>
        </article>
        <article id="article-6626">
            <a href="https://ardalis.com/mavens-in-the-developer-community/" target="_blank">
                <h2 class="title mb-6" id="article-6626">Mavens in the Developer Community</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 03, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Since launching DevMavens this week, I&#x2019;ve had a few folks tell me they didn&#x2019;t previously know what a maven was. The site shows some&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-6627">
            <a href="https://ayende.com/blog/3401/challenge-find-the-bug" target="_blank">
                <h2 class="title mb-6" id="article-6627">Challenge</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 03, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Here is another subtle bug:     public class Log&#xA;{&#xA;&#x9;string path;&#xA;&#xA;&#x9;public Log(string path)&#xA;&#x9;{&#xA;&#x9;&#x9;if(Directory.Exists(path)==false)&#xA;&#x9;&#x9;&#x9;Directory.CreateDirectory(path);&#xA;&#x9;&#x9;this.path=path;&#x9;&#x9;&#xA;&#x9;}&#xA;&#xA;&#x9;public TextWriter GetLogger(string name)&#xA;&#x9;{&#xA;&#x9;&#x9;string fileName = Path.Combine(path, name);&#xA;&#x9;&#x9;if(File.Exists(fileName))&#xA;&#x9;&#x9;&#x9;return File.AppendText(fileName);&#xA;&#x9;&#x9;return File.CreateText(fileName);&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;&#xA;  Assume that the name that we pass to GetLogger() is always valid. &#xA;&#xA;  Assume that there are no permission errors.&#xA;&#xA;  Assume that no one is going to delete the log directory behind our back.&#xA;&#xA;  Assume no file system level errors (like file system full, etc).&#xA;&#xA;&#xA;Update: A few readers pointed out a few more problems with the code, so let us constrain it even further...&#xA;&#xA;&#xA;  Assume single threaded access.&#xA;&#xA;  Assume proper disposable of file handle.&#xA;&#xA;&#xA;Under what conditions will this fail?</p>
        </article>
        <article id="article-6628">
            <a href="https://ayende.com/blog/3400/in-search-of-an-embedded-db" target="_blank">
                <h2 class="title mb-6" id="article-6628">In search of an embedded DB</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 03, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I need to use an embedded DB in a project. Naturally, I turned to my old friend, SQLite. It has served me well in the past, and I am well versed in all its tricks. Except... SQLite really fall apart when you are talking about even moderately multi threaded applications. By that I mean, it works just as advertised, for sure. It just lock the entire DB when used, which tend to kill other threads who want to access the poor DB.  I then turned to FireBird, but a short spike told me that it is... inadequate. I managed to get the database into inconsistent state, but I am not sure how or why. There seem to be very little information about it as well, so at the moment it is out of the game.  Sql CE is worse than SQLite when it comes to handling multiple threads, so that wasn&#x27;t even in the running.  Vista DB is commercial, and I plan to make this an OSS project, so that is out as well.   I want to use Berkeley DB, but is seems like the .Net story is hard. There are CLR Binding, but I run into several blocking issues with them. There is no 1:1 mapping to the C API or the Java API, the error messages are... terse. And there aren&#x27;t any tests at all! Even worse, the code is interfacing with native code, so it is C# after a rail road has hit it at 200 kph and having spent three days crying in a desert.  I put some time into trying to get this to work, and once the initial hump is over (understanding the association between environments, databases and transactions), it makes a lot of sense. Of course, there are a lot of features that I wouldn&#x27;t even try to figure out.  First order of business, create a .Netified wrapper that will abstract the C like API away from me.  Okay, I am being ungracious here, the API make a lot of sense and the code is good for the purpose it was built, it was just that I had a moment of existential uncertainty when I looked at the code and it looked like C&#x2B;&#x2B;#.</p>
        </article>
        <article id="article-6629">
            <a href="https://ardalis.com/ddd-quickly/" target="_blank">
                <h2 class="title mb-6" id="article-6629">DDD Quickly</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 02, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I picked up the print version of Domain Driven Design Quickly on Amazon recently. I didn&#x2019;t realize at the time that it was also available as&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-6630">
            <a href="https://ardalis.com/blog-move/" target="_blank">
                <h2 class="title mb-6" id="article-6630">Blog Move</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 02, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Please join me as I move my blog to my own URL, SteveSmithBlog.com. I&#x2019;ll continue to post there about more or less the same things I did&#x2026;Keep Reading &#x2192;</p>
        </article>
        <div class="button flex justify-between">
            <a href="662.html"><span class="back arrow"></span></a>

            <a href="664.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>