
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 183 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-1821">
            <a href="https://ayende.com/blog/188642-A/searching-through-text-part-ii-exploring-posting-lists-persistence" target="_blank">
                <h2 class="title mb-6" id="article-1821">Searching through text</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 16, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In full text search terminology, a posting list is just a list of document ids. These are used to store and find matches for particular terms in the index.I took the code from the previous post and asked it to give me the top 50 most frequent terms in the dataset and their posting lists. The biggest list had over 200,000 documents, and I intentionally use multiple threads to build things, so the actual list is going to be random from run to run (which adds a little more real-worldedness to the system*).*Yes, I invented that term. It make sense, so I&#x2019;m sticking with it.I took those posting lists and just dumped them to a file, in the simplest possible format. Here are the resulting files:There are a few things to note here. As you can see, the file name is the actual term in the index, the contents of the file is a sorted list of int64 of the document ids (as 8 bytes little endian values).I&#x2019;m using int64 here because Lucene uses int32 and thus has the ~2.1 billion document limit, which I want to avoid. It also make it more fun to work with the data, because of the extra challenge.&#xA0; The file sizes seems small, but the from file contains over 250,000 entries. When dealing with posting lists, size matter, a lot. So let&#x2019;s see what it would take to reduce the size here, shall we?Simply zipping the file gives us a massive space reduction, so there is a lot left on the table, which is great. Actually, I might have skipped a few steps:Posting lists are sorted, because it helps do things like union / intersect queries.Posting lists are typically only added to.Removal are handled separately, with a merge step to clean this up eventually.Because the value is sorted, the first thing I tried was to use a diff model with variable sized int. Here is the core code:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          public class DiffBinaryWriter : BinaryWriter&#xA;        &#xA;        &#xA;          &#xA;          {&#xA;        &#xA;        &#xA;          &#xA;              long prev;&#xA;        &#xA;        &#xA;          &#xA;              public DiffBinaryWriter(Stream s, long start) : base(s)&#xA;        &#xA;        &#xA;          &#xA;              {&#xA;        &#xA;        &#xA;          &#xA;                  prev = start;&#xA;        &#xA;        &#xA;          &#xA;                  WriteValue(prev);&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              public void Diff(long cur)&#xA;        &#xA;        &#xA;          &#xA;              {&#xA;        &#xA;        &#xA;          &#xA;                  var diff = cur - prev;&#xA;        &#xA;        &#xA;          &#xA;                  prev = cur;&#xA;        &#xA;        &#xA;          &#xA;                  if (diff &lt;= 0)&#xA;        &#xA;        &#xA;          &#xA;                      throw new ArgumentOutOfRangeException($&quot;{cur} is not greater than {prev}, values aren&#x27;t sorted&quot;);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  WriteValue(diff);&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              private void WriteValue(long diff)&#xA;        &#xA;        &#xA;          &#xA;              {&#xA;        &#xA;        &#xA;          &#xA;                  if (diff &gt; int.MaxValue)&#xA;        &#xA;        &#xA;          &#xA;                  {&#xA;        &#xA;        &#xA;          &#xA;                      // probably rare&#xA;        &#xA;        &#xA;          &#xA;                      Write7BitEncodedInt(0); // indicate that we need to read a full long here&#xA;        &#xA;        &#xA;          &#xA;                      Write(diff);&#xA;        &#xA;        &#xA;          &#xA;                      return;&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  Write7BitEncodedInt((int)diff);&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          diff.cs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;Nothing really that interesting, I have to admit, but it did cut the size of the file to 242KB, which is nice (and better than ZIP). Variable sized integers are used heavily by Lucene, so I&#x2019;m very familiar with them. But there are other alternatives.StreamVByte is a new one, with some impressive perf numbers, but only gets us to 282 KB (but it is possible / likely that my implementation of the code is bad).FastPFor compresses the (diffed) data down to 108KB. RoaringBitmap gives us a total of 64KB.There are other methods, but they tend to go to the esoteric and not something that I can very quickly test directly. It is important to note that there are several separate constraints here:Final size on diskComputational cost to generate that final formatComputation cost to go from the final format to the original valuesHow much (managed) memory is required during this processThat is enough for now, I believe. My next post will deal delve into the actual semantics that we need to implement to get a good behavior from the system. This is likely going to be quite interesting.</p>
        </article>
        <article id="article-1822">
            <a href="https://ardalis.com/running-integration-tests-in-build-pipelines-with-a-real-database/" target="_blank">
                <h2 class="title mb-6" id="article-1822">Running Integration Tests in Build Pipelines with a Real Database</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 16, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Last updated: 13 October 2023 A pain point for some organizations is figuring out how to run tests that involve databases. These are not&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-1823">
            <a href="https://www.stevejgordon.co.uk/health-checks-with-grpc-and-asp-net-core-3" target="_blank">
                <h2 class="title mb-6" id="article-1823">Health Checks with gRPC and ASP.NET Core 3.0</h2>
            </a>
            <p class="mb-2">by Steve Gordon</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 15, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post, we will explore a couple of options to apply health checks to your gRPC server running on ASP.NET Core 3.0. Health checks are a common requirement. In particular, in containerised environments, they are required so that the container orchestrator and load balancers know which services are actually functioning. This post is part [&#x2026;]</p>
        </article>
        <article id="article-1824">
            <a href="https://enterprisecraftsmanship.com/posts/combining-asp-net-core-attributes-with-value-objects/" target="_blank">
                <h2 class="title mb-6" id="article-1824">Combining ASP.NET Core validation attributes with Value Objects</h2>
            </a>
            <p class="mb-2">by Vladimir Khorikov</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 15, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is a continuation of the article series about some more advanced error handling techniques.</p>
        </article>
        <article id="article-1825">
            <a href="https://ayende.com/blog/188705-C/on-replacing-lucene" target="_blank">
                <h2 class="title mb-6" id="article-1825">On Replacing Lucene</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 15, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">My previous post got an interesting comment:I smell a Lucene.NET replacement for Raven 5 in the future :-)I wanted to deal with this topic, but before we get to it, please note. I&#x2019;m not committing to any features / plans for RavenDB in here, merely outlining my thinking.I really want to drop Lucene. There are many reasons for this.The current release version of Lucene.NET was released over 7 years ago(!) and it matches a Lucene (JVM) version that was out in 2010. The active development of Lucene.NET is currently focused on released 4.8 (dated 2014) and has been stalled for several years.Lucene&#x2019;s approach to resource utilization greatly differs from how I would like to approach things in modern .NET Core applications.There is a problem with replacing Lucene, however. Lucene is, quite simply, an amazing library. It is literally the benchmark that you would compare yourself against in its field. This isn&#x2019;t the first time that I have looked into this field, mind. Leaving aside the fact that I believe that I reviewed most of the open source full text search libraries, I also wrote quite a few spikes around that.Lucene is big, so replacing it isn&#x2019;t something that you can do in an afternoon or a weekend. You can get to the 80% functionality in a couple of weeks, for sure, but it is the remaining 20% that would take 300% of the time . For example, inverted indexes are simple, but then you need to be able to handle phrase queries, and that is a whole other ball game. We looked into supporting the porting of Lucene.NET directly as well as developing our own option, and so far neither option has gotten enough viability to take action. 2015 &#x2013; 2018 has been very busy years for us. We have rebuilt RavenDB from scratch, paying attention to many details that hurt us in the past. Some of the primary goals was to improve performance (10x) and to reduce support overhead. As a consequence of that, RavenDB now uses a lot less managed memory. Most of our memory utilization is handled by RavenDB directly, without relying on the CLR runtime or the GC.Currently, our Lucene usage is responsible for the most allocations in RavenDB. I can&#x2019;t think of the last time that we had high managed memory usage that wasn&#x2019;t directly related to Lucene. And yes, that means that when you do a memory dump of a RavenDB&#x2019;s&#xA0; process, the top spot isn&#x2019;t taken by System.String, which is quite exceptional, in my experience. Make no mistake, we are still pretty happy with what Lucene can do, but we have a lot of experience with that particular version and are very familiar with how it works. Replacing it means a substantial amount of work and introduce risks that we&#x2019;ll need to mitigate. Given these facts, we have the following alternatives:Write our own system to replace Lucene.Port Lucene 8 from JVM to .NET Core, adapting it to our architecture.Upgrade to Lucene.NET 4.8 when it is out. The first option gives us the opportunity to build something that will fit our needs exactly. This is most important because we also have to deal with both feature fit and architectural fit. For example, we care a lot about memory usage and allocations. That means that we can build it from the ground up to reduce these costs. The risk is that we would be developing from scratch and it is hard to scope something this big. The second option means that we would benefit from modern Lucene. But it means having to port non trivial amount of code and have to adapt both from JVM to CLR but also to our own architectural needs. The benefit here is that we can likely not port stuff that we don&#x2019;t need, but there is a lot of risk involved in such a big undertaking. We will also effectively be either forking the .NET project or have just our own version. That means that the maintenance burden would be on us.Upgrading to Lucene.NET 4.8 is the third option, but we don&#x2019;t know when that would be out (stalled for a long time) and it does move us very far in the Lucene&#x2019;s versions. It also likely going to require a major change in how we behave. Not so much with the coding wise (I don&#x2019;t expect that to be too hard) but in terms of the different operational properties than what we are used to.The later two options are going to keep Lucene as the primary sources of allocations in our system, while the first option means that we can probably reduce that significantly for both indexing and querying, but we&#x2019;ll have to push our own path.We have made no decisions yet, and we&#x2019;ll probably won&#x2019;t for a while. We are playing around with all options, as you can see on this blog, but that is also mostly because it is fun to explore and learn.</p>
        </article>
        <article id="article-1826">
            <a href="https://andrewlock.net/running-net-core-global-tools-in-non-sdk-docker-images/" target="_blank">
                <h2 class="title mb-6" id="article-1826">Running .NET Core global tools in non-sdk Docker images</h2>
            </a>
            <p class="mb-2">by Andrew Lock</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 15, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post I describe how you can avoid the dependencies of global tools on the .NET Core SDK and runtime by containerising them using Docker.&#x2026;</p>
        </article>
        <article id="article-1827">
            <a href="https://www.meziantou.net/csharp-8-nullable-reference-types.htm" target="_blank">
                <h2 class="title mb-6" id="article-1827">C# 8: Nullable Reference Types</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 15, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This post is part of the series &#x27;C# 8&#x27;. Be sure to check out the rest of the blog posts of the series!C# 8: Nullable Reference Types (this post)How to use Nullable Reference Types in .NET Standard 2.0 and .NET FrameworkHow to use C# 8 Indices and Ranges in .NET Standard 2.0 and .NET FrameworkI&#x27;ve u</p>
        </article>
        <article id="article-1828">
            <a href="https://ayende.com/blog/188641-A/searching-through-text-part-i-full-text-search-in-under-200-lines-of-code" target="_blank">
                <h2 class="title mb-6" id="article-1828">Searching through text</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 14, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Full text search is a really interesting topic, which I have been dipping my toes into again and again over the years. It is a rich area of research, and there has been quite a few papers, books and articles about the topic. I read a bunch of projects for doing full text search, and I have been using Lucene for a while. I thought that I would write some code to play with full text search and see where that takes me. This is a side project, and I hope it will be an interesting one. The first thing that I need to do is to define the scope of work:Be able to (eventually) do full text search queriesCompare and contrast different persistence strategies for thisBe able to work with multiple fieldsWhat I don&#x2019;t care about: Analysis process, actually implementing complex queries (I do want to have the foundation for them), etc.Given that I want to work with real data, I went and got the Enron dataset. That is over 517,000 emails from Enron totaling more than 2.2 GB. This is one of the more commonly used test datasets for full text search, so that is helpful. The first thing that we need to do is to get the data into a shape that we can do something about it.Enron is basically a set of MIME encoded files, so I&#x2019;ve used MimeKit to speed the parsing process. Here is the code of the algorithm I&#x2019;m using for getting the relevant data for the system. Here is the relevant bits:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          static void Analyze(string dir)&#xA;        &#xA;        &#xA;          &#xA;          {&#xA;        &#xA;        &#xA;          &#xA;              var spearators = new char[] { &#x27; &#x27;, &#x27;\t&#x27;, &#x27;,&#x27;, &#x27;!&#x27;, &#x27;\r&#x27;, &#x27;(&#x27;, &#x27;)&#x27;, &#x27;?&#x27;, &#x27;-&#x27;, &#x27;&quot;&#x27;, &#x27;\n&#x27;, &#x27;/&#x27; };&#xA;        &#xA;        &#xA;          &#xA;              var trim = new char[] { &#x27;.&#x27;, };&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              var blockingCollection = new BlockingCollection&lt;string&gt;(2048);&#xA;        &#xA;        &#xA;          &#xA;              var tasks = new List&lt;Task&gt;();&#xA;        &#xA;        &#xA;          &#xA;              var dics = new ConcurrentQueue&lt;Dictionary&lt;string, HashSet&lt;string&gt;&gt;&gt;();&#xA;        &#xA;        &#xA;          &#xA;              for (int i = 0; i &lt; 16; i&#x2B;&#x2B;)&#xA;        &#xA;        &#xA;          &#xA;              {&#xA;        &#xA;        &#xA;          &#xA;                  var task = Task.Run(() =&gt;&#xA;        &#xA;        &#xA;          &#xA;                  {&#xA;        &#xA;        &#xA;          &#xA;                      while (blockingCollection.IsCompleted == false)&#xA;        &#xA;        &#xA;          &#xA;                      {&#xA;        &#xA;        &#xA;          &#xA;                          using var stream = File.OpenRead(blockingCollection.Take());&#xA;        &#xA;        &#xA;          &#xA;          &#xA;        &#xA;        &#xA;          &#xA;                          var parser = new MimeParser(stream, MimeFormat.Entity);&#xA;        &#xA;        &#xA;          &#xA;                          while (parser.IsEndOfStream == false)&#xA;        &#xA;        &#xA;          &#xA;                          {&#xA;        &#xA;        &#xA;          &#xA;                              var entity = parser.ParseMessage();&#xA;        &#xA;        &#xA;          &#xA;          &#xA;        &#xA;        &#xA;          &#xA;                              var dic = new Dictionary&lt;string, HashSet&lt;string&gt;&gt;&#xA;        &#xA;        &#xA;          &#xA;                              {&#xA;        &#xA;        &#xA;          &#xA;                                  [&quot;Id&quot;] = new HashSet&lt;string&gt; { entity.MessageId.ToLower() },&#xA;        &#xA;        &#xA;          &#xA;                                  [&quot;Date&quot;] = new HashSet&lt;string&gt; { entity.Date.ToString(&quot;r&quot;) },&#xA;        &#xA;        &#xA;          &#xA;                                  [&quot;From&quot;] = entity.From.Select(x =&gt; x.ToString().ToLower()).ToHashSet(),&#xA;        &#xA;        &#xA;          &#xA;                                  [&quot;To&quot;] = entity.To.Select(x =&gt; x.ToString().ToLower()).ToHashSet(),&#xA;        &#xA;        &#xA;          &#xA;                                  [&quot;Body&quot;] = entity.GetTextBody(TextFormat.Plain)&#xA;        &#xA;        &#xA;          &#xA;                                      .Split(spearators, StringSplitOptions.RemoveEmptyEntries)&#xA;        &#xA;        &#xA;          &#xA;                                      .Select(x =&gt; x.Trim(trim).ToLower())&#xA;        &#xA;        &#xA;          &#xA;                                      .Where(x =&gt;&#xA;        &#xA;        &#xA;          &#xA;                                      {&#xA;        &#xA;        &#xA;          &#xA;                                          if (x.Length &gt; 3)&#xA;        &#xA;        &#xA;          &#xA;                                              return true;&#xA;        &#xA;        &#xA;          &#xA;                                          if (x.Length == 0)&#xA;        &#xA;        &#xA;          &#xA;                                              return false;&#xA;        &#xA;        &#xA;          &#xA;                                          return char.IsDigit(x[0]);&#xA;        &#xA;        &#xA;          &#xA;                                      })&#xA;        &#xA;        &#xA;          &#xA;                                      .ToHashSet()&#xA;        &#xA;        &#xA;          &#xA;                              };&#xA;        &#xA;        &#xA;          &#xA;          &#xA;        &#xA;        &#xA;          &#xA;                              dics.Enqueue(dic);&#xA;        &#xA;        &#xA;          &#xA;                          }&#xA;        &#xA;        &#xA;          &#xA;                      }&#xA;        &#xA;        &#xA;          &#xA;                  });&#xA;        &#xA;        &#xA;          &#xA;                  tasks.Add(task);&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              var so = Stopwatch.StartNew();&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              tasks.Add(Task.Run(() =&gt;&#xA;        &#xA;        &#xA;          &#xA;              {&#xA;        &#xA;        &#xA;          &#xA;                  foreach (var file in Directory.EnumerateFiles(dir, &quot;*&quot;, SearchOption.AllDirectories))&#xA;        &#xA;        &#xA;          &#xA;                  {&#xA;        &#xA;        &#xA;          &#xA;                      blockingCollection.Add(file);&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;                  blockingCollection.CompleteAdding();&#xA;        &#xA;        &#xA;          &#xA;              }));&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              var final = Task.WhenAll(tasks.ToArray());&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              // do stuff with it.&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          analysis.cs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;As you can see, this is hardly a sophisticated approach. We are spawning a bunch of threads, processing all half million emails in parallel, select a few key fields and do some very basic text processing. The idea is that we want to get to the point where we have enough information to do full text search, but without going through the real pipeline that this would take.Here is an example of the output of one of those dictionaries:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          {&#xA;        &#xA;        &#xA;          &#xA;            &quot;Id&quot;: [&#xA;        &#xA;        &#xA;          &#xA;              &quot;18739556.1075840017471.javamail.evans@thyme&quot;&#xA;        &#xA;        &#xA;          &#xA;            ],&#xA;        &#xA;        &#xA;          &#xA;            &quot;Date&quot;: [&#xA;        &#xA;        &#xA;          &#xA;              &quot;Sat, 03 Nov 2001 01:24:54 GMT&quot;&#xA;        &#xA;        &#xA;          &#xA;            ],&#xA;        &#xA;        &#xA;          &#xA;            &quot;From&quot;: [&#xA;        &#xA;        &#xA;          &#xA;              &quot;tim.belden@enron.com&quot;&#xA;        &#xA;        &#xA;          &#xA;            ],&#xA;        &#xA;        &#xA;          &#xA;            &quot;To&quot;: [&#xA;        &#xA;        &#xA;          &#xA;              &quot;mike.swerzbin@enron.com&quot;,&quot;matt.motley@enron.com&quot;,&quot;robert.badeer@enron.com&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;sean.crandall@enron.com&quot;,&quot;diana.scholtes@enron.com&quot;,&quot;chris.mallory@enron.com&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;phillip.platter@enron.com&quot;,&quot;tom.alonso@enron.com&quot;,&quot;mark.fischer@enron.com&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;holden.salisbury@enron.com&quot;&#xA;        &#xA;        &#xA;          &#xA;            ],&#xA;        &#xA;        &#xA;          &#xA;            &quot;Body&quot;: [&#xA;        &#xA;        &#xA;          &#xA;              &quot;alan&quot;,&quot;original&quot;,&quot;02&quot;,&quot;11:59&quot;,&quot;12:16&quot;,&quot;13th&quot;,&quot;14th;&quot;,&quot;20&quot;,&quot;2001&quot;,&quot;20th&quot;,&quot;7&quot;,&quot;7th&quot;,&quot;9&quot;,&quot;9th&quot;,&quot;adress&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;advancing&quot;,&quot;agenda&quot;,&quot;alan&quot;,&quot;alvarez&quot;,&quot;anything&quot;,&quot;appears&quot;,&quot;asked&quot;,&quot;available&quot;,&quot;away&quot;,&quot;back-up&quot;,&quot;because&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;before&quot;,&quot;belden&quot;,&quot;between&quot;,&quot;caps&quot;,&quot;comments&quot;,&quot;commission&quot;,&quot;commission&#x27;s&quot;,&quot;comnes&quot;,&quot;decisions&quot;,&quot;definitive&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;doesn&#x27;t&quot;,&quot;educated&quot;,&quot;ferc&quot;,&quot;following&quot;,&quot;friday&quot;,&quot;from:&quot;,&quot;going&quot;,&quot;guess&quot;,&quot;hear&quot;,&quot;held&quot;,&quot;here&#x27;s&quot;,&quot;highly&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;however&quot;,&quot;into&quot;,&quot;issue&quot;,&quot;issues&quot;,&quot;know&quot;,&quot;last&quot;,&quot;like:&quot;,&quot;likely&quot;,&quot;look&quot;,&quot;looks&quot;,&quot;meantime&quot;,&quot;meeting&quot;,&quot;meetings&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;meets&quot;,&quot;message&quot;,&quot;more&quot;,&quot;next&quot;,&quot;november&quot;,&quot;order&quot;,&quot;orders&quot;,&quot;ours&quot;,&quot;pending&quot;,&quot;posts&quot;,&quot;preparing&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;pressure&quot;,&quot;price&quot;,&quot;ray;&quot;,&quot;right&quot;,&quot;rule&quot;,&quot;said&quot;,&quot;scheduled&quot;,&quot;sean&quot;,&quot;sent:&quot;,&quot;significant&quot;,&quot;since&quot;,&quot;soon&quot;,&quot;still&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;subject:&quot;,&quot;submittal&quot;,&quot;surprise&quot;,&quot;that&quot;,&quot;there&quot;,&quot;therefore&quot;,&quot;they&quot;,&quot;this&quot;,&quot;tim;&quot;,&quot;time&quot;,&quot;timing&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;unlikely&quot;,&quot;until&quot;,&quot;what&quot;,&quot;when&quot;,&quot;will&quot;,&quot;winter&quot;,&quot;wish&quot;,&quot;with&quot;,&quot;wood&quot;,&quot;would&quot;,&quot;written&quot;&#xA;        &#xA;        &#xA;          &#xA;            ]&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          enron.json&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;As you can see, this is bare bones (I forgot to index the Subject, for example), but on my laptop (8 cores Intel(R) Core(TM) i7-6820HQ CPU @ 2.70GHz) with 16 GB of RAM, we can index this amount of data in under a minute and a half.So far, so good, but this doesn&#x2019;t actually gets us anywhere, we need to construct an inverted index, so we can ask questions about the data and be able to find stuff out. We are already about half way there, which is encouraging. Let&#x2019;s see how far we can stretch the &#x201C;simplest thing that could possibly work&#x201D;&#x2026; shall we?Here is the key data structures:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          var docs = new ConcurrentDictionary&lt;long, DocRef&gt;();&#xA;        &#xA;        &#xA;          &#xA;          long index = 0;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          var fields = new ConcurrentDictionary&lt;string, ConcurrentQueue&lt;long&gt;&gt;[]&#xA;        &#xA;        &#xA;          &#xA;          {&#xA;        &#xA;        &#xA;          &#xA;              new ConcurrentDictionary&lt;string, ConcurrentQueue&lt;long&gt;&gt;(), // Body&#xA;        &#xA;        &#xA;          &#xA;              new ConcurrentDictionary&lt;string, ConcurrentQueue&lt;long&gt;&gt;(), // Subject&#xA;        &#xA;        &#xA;          &#xA;              new ConcurrentDictionary&lt;string, ConcurrentQueue&lt;long&gt;&gt;(), // Date&#xA;        &#xA;        &#xA;          &#xA;              new ConcurrentDictionary&lt;string, ConcurrentQueue&lt;long&gt;&gt;(), // From&#xA;        &#xA;        &#xA;          &#xA;              new ConcurrentDictionary&lt;string, ConcurrentQueue&lt;long&gt;&gt;(), // To &#xA;        &#xA;        &#xA;          &#xA;          };&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          index-state.cs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;Basically, we have an array of fields, each of which holds a dictionary from each of the terms and a list of documents for the terms. For the full code for this stage, look at the following link, it&#x2019;s less than 150 lines of code.Indexing the full Enron data set now takes 1 minute, 17 seconds, and takes 2.5 GB in managed memory.The key is that with this in place, if I want to search for documents that contains the term: &#x201C;XML&#x201D;, for example, I can do this quite cheaply. Here is how I can &#x201C;search&#x201D; over half a million documents to get all those that have the term HTML in them:As you can imagine, this is actually quite fast.That is enough for now, I want to start actually exploring persistence options now. The final code bits are here, I ended up implementing stop words as well, so this is a really cool way to show off how you can do full text search in under 200 lines of code..</p>
        </article>
        <article id="article-1829">
            <a href="https://ayende.com/blog/188610-A/complex-decisions-and-random-chance" target="_blank">
                <h2 class="title mb-6" id="article-1829">Complex decisions and random chance</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 11, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">An important aspect of RavenDB is that It Just Works. In other words, we aim to make RavenDB a really boring database, one that require very little of your attention. As it turns out, this can get really complex. The topic for today is role assignment in a distributed cluster after recovering from a failure.Let&#x2019;s consider the case of a cluster composed of 10 databases, spread among three nodes (A,B and C). The databases are replicated on all three nodes, which A being the primary for 4 of them, and C and B being the primary for 3 each.And the following sequence of events:Node A goes down.The RavenDB cluster will react to that by re-shuffling responsibilities in the cluster for the databases where A was the primary node of contact.Clients will observe no change in behavior and continue to operate normally. All the databases are now served by nodes B and C.Node B goes down.At this point, there is no longer a cluster (which requires a majority of the nodes to be up, in this case, two). Node C and the remaining client follow the disaster plan that was created (and distributed to the clients) ahead of time by the cluster.All the clients now talk to node C for all databases.So far, this is business as usual and how RavenDB works to ensure that even in the presence of failure, we can continue working normally. Node C is the only remaining node in the cluster, and it shoulders the load admirably. At this point, the admin takes pity on our poor node C and restarts node A and B. The following operations then take place:The cluster can communicate between the nodes and start monitoring the system.Nodes A and B are getting updated from node C with all the missing changes that they missed.The cluster will update the topology of the databases to reflect that node A and B are now up.At this point, however, node C is the primary node for all the databases, and the CPU heat sink is starting to make some warning signs.What we need to do now is to re-assign the primary role for each database across the cluster. And that turns out to be surprisingly tricky thing to do.We sat down and wrote a list of the potential items we need to consider in this case: The number of databases already assigned to the cluster node.The number of requests / sec that the database gets vs. the already assigned databases on the node.The working set that the database require to operate vs. the existing working set on the node.The number of IOPS that are required vs&#x2026;There is also the need to take into account the hardware resources for each node. They are usually identical, but they don&#x2019;t have to be.As we started scoping the amount of work that we would need to make this work properly, we were looking at a month or so. In addition to actually making the proper decision, we first need to gather the relevant information (and across multiple operating systems, containers, bare metal, etc). In short, that is a lot of work to be done.We decided to take a couple of steps back, before we had to figure out where we&#x2019;ll put this huge task in our queue. What was the actual scenario?If there is a single database on the cluster (which isn&#x2019;t uncommon), then this feature doesn&#x2019;t matter. A single node will always be the primary anyway. This means that this distribution of primary responsibility in the cluster is not actually a single step operation, it only make sense when you apply it to multiple databases. And that, as it turns out, gives us a lot more freedom.We were able to implement the feature in the same day, and the cost of that was quite simple. Whenever the cluster detected that a database&#x2019;s node has recovered, it would run the following command:primary = topology[rand(topology.Length)];This is the only thing that we need in order to get fair distribution of the data across the nodes. The way it works is simple. As each database become up to date, the cluster will pick it up and a primary at random. Because we have multiple such cases, sheer chance is going to ensure that they will go to different nodes (and those, rebalance the load across the cluster).It simple, it works quite nicely and it is a lot less scary than having to implement a smart system. And in our testing, it worked like magic .</p>
        </article>
        <article id="article-1830">
            <a href="https://ayende.com/blog/188609-A/data-modeling-with-ravendb-webinar-is-now-available" target="_blank">
                <h2 class="title mb-6" id="article-1830">Data modeling with RavenDB Webinar is now available</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 10, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Here is the webinar recording from last week.</p>
        </article>
        <div class="button flex justify-between">
            <a href="182.html"><span class="back arrow"></span></a>

            <a href="184.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;🚀&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
