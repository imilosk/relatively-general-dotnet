
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 626 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-6251">
            <a href="https://ayende.com/blog/3831/a-note-to-microsoft-agile-or-open-source-doesnt-excuse-it-being-crap" target="_blank">
                <h2 class="title mb-6" id="article-6251">A note to Microsoft: Agile or open source doesn&#x2019;t excuse it being crap</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 25, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I explicitly don&#x2019;t want to go over the exact scenario that this is relating to. I want to talk about a general sentiment that I got from several people from Microsoft a few times, which I find annoying.  It can be summed up pretty easily by this quote:     You all know that we work on the Agile process here, right? We get something out (perhaps a little early) and then improve it. Codeplex is for open source and continuous improvement with community feedback.   The context is a response to a critique about unacceptable level of quality in something Microsoft put out. Again, I do not want to discuss the specifics. I want to discuss the sentiment, I got answers in a similar spirit from several Microsoft people recently, and I find it annoying in the extreme.  Agile doesn&#x2019;t mean that you start with crap, call it organic fertilizer and try to tell me that it will improve in the future. Quality is supposed to be built in, it is the scope that you grow incrementally, not the product quality.  I actually find the open source comment to be even more annoying. Open source does not mean that you get someone else to do your dirty work. And if you take something and call it open source, it doesn&#x2019;t mean that you are not going to get called on the carpet for the quality of whatever you released.   Calling it open source does not mean that the community is accountable for its quality.</p>
        </article>
        <article id="article-6252">
            <a href="https://ayende.com/blog/3830/nh-prof-new-features-disabling-ignoring-alerts" target="_blank">
                <h2 class="title mb-6" id="article-6252">NH Prof New Features</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 24, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Those are not actually new features, if you want to be strict about it. There is a whole bunch of things in NH Prof that already exists, but are only now starting to have an exposed UI.  I believe that NH Prof&#x2019;s ability to analyze and detect problems in your NHibernate&#x2019;s usage is one of the most valuable features that it have. Heavens know that I spent enough time on that thing to make it understand everything that I learned about NHibernate in 5 years of usage (how did it get to be that long)?   The problem is that NH Prof is not self aware yet, and assumptions about what is good practice or not cannot be made in vacuum, they must be made in context, which NH Prof lacks. As such, it is possible that you&#x2019;ll find yourself inundated with alerts that aren&#x2019;t valid for your scenario.  A typical example would be that for your project, which uses MySql, you cannot use NHibernate&#x2019;s batching (which isn&#x2019;t supported on MySql). Therefore, the batching alert is not only invalid, it is actually annoying. You can globally disable an alert from the settings dialog:     But that is like whacking flies with a rifle. It will kill all the alerts of that type. What about when you want to ignore a specific alert in a specific circumstance?  NH Prof supports this as well:&#xA0;        The profiler is smart enough to ignore the same alert from the same source in the future.   Of course, we can also remove ignored alerts from the settings dialog as well.</p>
        </article>
        <article id="article-6253">
            <a href="https://ayende.com/blog/3829/just-dont-do-that-is-an-acceptable-answer" target="_blank">
                <h2 class="title mb-6" id="article-6253">&#x201C;Just don&#x2019;t do that&#x201D; is an acceptable answer</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 24, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Recently I found myself facing several pretty tough problems. Solving the problem or the generic case would have been hard if not impossible. In all of those cases, I was able to redefine the problem to make the solution trivially simple.  Problem #1 &#x2013; SQL display in NH Prof  We had an issue with NH Prof regarding scrolling a big list. The problem was that the performance for big lists isn&#x2019;t that great. WPF has a solution for that, virtual lists, which means that we only get to bind to the visible portion of the list, which significantly improve the system performance. The problem is that when you do this, you lose smooth scrolling, and then you get into a bit of a situation when you have large SQL statements. The UI doesn&#x2019;t work in a nice way.  I wanted to have both. We figured out a couple of ways to do that, but I kept having this nagging feeling that I am being stupid. Eventually I realized that I had a problem in the problem specification. We do not need to display the large SQL statement in the list. It makes no sense from a UI perspective anyway. I was just coasting along on inertia without thinking, and I run into this issue.  Before:     After:       There is no value in the long statement. We are stripping a lot of information away from the statements anyway, to make it easy to understand what is going on there at a glance. The previous version just put additional burden on the user to try to understand what is going on in the mess. If they want the detailed view, we have that, and it is formatted, nice and easy to read.  Problem #2 &#x2013; Heterogeneous load balancing  When building Rhino Service Bus load balancing support (what NServiceBus calls distributer / grid), I had run into a major issue of non elegance. I initially had thought that each node in the grid would tell the balancer what messages the node can handle, and on arrival, the balancer will inspect the message and dispatch to the an available end point.  The problem was that I didn&#x2019;t like this, it required too many moving parts (each node keep telling the balancer which messages it could handle, updating several dispatch lists on each message, etc). It was a complex solution, and I didn&#x2019;t like where I was heading.  Again, I had a problem with the solution complexity because the problem was stated in a problematic fashion. I didn&#x2019;t need to support Heterogeneous system, I don&#x2019;t have one at the moment. I can specify that a load balancer is going to always front a homogenous set of nodes, and reduce the problem to a dequeue &amp; send.   Rethinking about the problem can often tell you that you are trying to solve more than what you should. By reducing the scope of the problem by a degree that is often meaningless to the desired&#xA0; business requirement, we can drastically simplify the solution and the implementation.</p>
        </article>
        <article id="article-6254">
            <a href="https://ayende.com/blog/3828/more-disposal-subtleties-and-framework-bugs-that-stalks-me" target="_blank">
                <h2 class="title mb-6" id="article-6254">More disposal subtleties and framework bugs that stalks me</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 24, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This one was a real pain to figure out. Can you imagine what would be the result of this code?                    1: var queue = new MessageQueue(queuePath);&#xA;&#xA;         2: queue.Dispose();&#xA;&#xA;         3: var peekAsyncResult = queue.BeginPeek();&#xA;&#xA;         4: peekAsyncResult.AsyncWaitHandle.WaitOne();&#xA;    &#xA;  &#xA;&#xA;&#xA;If you guessed that we would get ObjectDisposedException, you are sadly mistaken. If you guessed that this would lead to a deadlock, you won.&#xA;&#xA;Figuring out the behavior in a multi threaded system where one thread was beginning to listen and another was disposing the queue and waiting for pending operations to complete is&#x2026; not fun.&#xA;&#xA;Update: For some strange reason, I am not able to reproduce the problem shown above. I know that I did before I posted this, but I posted it as one of the last things that I did that day. I think that this is somehow related to the actual queue used and whatever or not it has messages.</p>
        </article>
        <article id="article-6255">
            <a href="https://ayende.com/blog/3827/rhino-dht-concurrency-handling-example-the-phone-billing-system" target="_blank">
                <h2 class="title mb-6" id="article-6255">Rhino DHT: Concurrency handling example &#x2013; the phone billing system</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 23, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I got into a discussion today about how we are dealing with concurrency, and I have had a few good examples that I think worth putting in writing. The first of them is the phone billing system. This is, by nature, a distributed and concurrent system, and it is pretty easy to understand, I think.  We store the billing information for each customer (keyed by the phone number) in the DHT. The initial state looks like this:     The balance is what the account has, the call &amp; SMS are the actions on the account. For the purpose of discussion, sending SMS costs 2$ and 1 minute call cost 5$.  And then the following happens. A phone call is made at the same time that a couple of SMSes is sent and a bill is paid. You can see that in the following picture:     Each of those actions are handled by a different node. We will deal with them in sequence, because writing parallel hard be is.  A phone call is made, so we need to record that it happened. We get the current billing information from the DHT and add a new action:     At the same time, we also send a couple of SMS messages. Again, we get the current billing information (and we get version 42), add the action and saving it back. However, we don&#x2019;t have the most current version, so the DHT accepts the update and now we have two versions for key 555-5421. This is expected and normal behavior.     You should also note that we have an overdraft charge, for going over our account balance.This is something that was added to the account as part of the business logic of processing those the call. Being a responsible adult, the bill is paid at the exact time to avoid an overdraft charge. That one is handled according to the same approach, get the billing information from the DHT (and again we get version 42), modify it and save.  Now we have the following situation:   All three are valid, I have to say. When we ask the DHT to get a value by key, we will get all three versions back into a coherent vision of what actually happened.  First, I should mention that this is not a generic solution for all problems. There are likely to be problems that you&#x2019;ll not be able to resolve using this approach.   One thing that you might have noticed is that each of the items is tagged with a number. In real life, it would be a guid, but no one can remember a guid by looking at it, so I made it a number that is easy to remember. This id can uniquely identify an item across multi machines and concurrent versions.  The algorithm for merging those three versions together is actually quite simple. It goes something like this:             1: public BillingStatementState Merge(BillingStatementState[] states)&#xA;&#xA;       2: {&#xA;&#xA;       3:     var mergedState = new BillingStatementState();&#xA;&#xA;       4:&#xA0; &#xA;&#xA;       5:     foreach (var balanceItem in states.SelectMany(b=&gt;b.Balances)&#xA;&#xA;       6:     {&#xA;&#xA;       7:         if(mergedState.HasBalanceItem(balanceItem.Id) == false)&#xA;&#xA;       8:             mergedState.AddBalanceItem(balanceItem);&#xA;&#xA;       9:     }     &#xA;&#xA;      10:&#xA0; &#xA;&#xA;      11:     foreach (var item in states.SelectMany(s=&gt;s.ActionItems))&#xA;&#xA;      12:     {&#xA;&#xA;      13:        if(mergedState.HasActionItem(item.Id))&#xA;&#xA;      14:             continue;&#xA;&#xA;      15:         mergedState.AddActionItem(item);&#xA;&#xA;      16:     }&#xA;&#xA;      17:  &#xA;&#xA;      18:     mergedState.RecalculcateCharges();&#xA;&#xA;      19:  &#xA;&#xA;      20:     return mergedState;&#xA;&#xA;      21: }&#xA;&#xA;      22:&#xA0; &#xA;  &#xA;&#xA;&#xA;RecalcuateCharges is responsible to add / remove overdraft charges based on the new information.&#xA;&#xA;What we are basically doing is quite simple, we copy all the new information to the new state, and we know that it is new because we have a unique id that can identify each item. The only remaining bit of complexity is that we now need to recalculate the charges.&#xA;&#xA;As you&#x2019;ll see in a future post, &#x201C;recalculating&#x201D; isn&#x2019;t really it, you usually have to perform some compensating actions as well, but that is beside the point for now.&#xA;&#xA;Given the above code, we can safely merge the three versions, and make them into a single big version.&#xA;&#xA; &#xA;&#xA;The DHT will notice that the new value is the child of all current valid versions, accept the update and remove all other versions.&#xA;&#xA;As I said, it is not something that can fit any scenario, but it can fit a surprisingly wide area of them.</p>
        </article>
        <article id="article-6256">
            <a href="https://ayende.com/blog/3826/the-challenger-of-architecture-astronauts-two-tier-service-application-scenario" target="_blank">
                <h2 class="title mb-6" id="article-6256">The Challenger of Architecture Astronauts - Two-Tier Service Application Scenario</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 23, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">It continues to amaze me, the length some people will go to in order to add additional complexity. Let us take this article: Two-Tier Service Application Scenario (REST). I will leave aside the arguments about this article gross misrepresentations of what terms like domain modeling, entities and REST. Greg already called the DDD argument, and Colin is working on the problems with the representation of REST.   What I want to talk about is friction. I am looking at the code that is shown in the article and I cringed. Hard. Do you want to tell me that it is recommended that people would write code like this?         I am assuming that I would need to write one of those for each of my &#x201C;entities&#x201D; I honestly cannot figure out why. Why create specialized behavior when it would be easier, simpler, cheaper and better to handle this generically?  Is there any sort of value in this code? I don&#x2019;t think so.  It gets better when you see what you need to do in your Application_Start.          So now, not only do I have to create those handlers by hand, I now need to take care to register each them. I&#x2019;ll leave aside the bug in the routing code vs. the employee route handler code (&#x2018;employee&#x2019; is not a route value), to focus on a more important subject. Even if I decided that I want to code my way to insanity, why do I give a single class two responsibilities (creating EmployeeHandler and EmployeesHandler).  I am not even trying to ask why I need the route handler in the first place. It seems like it is there just so there would be another layer in the architecture diagram. It looks like that was a common requirement, because here comes the next step toward the road of useless code:         Except for creating additional work for the developer, I cannot think of a single reason why I would want to write this type of code unless I was paid by the line count.  Let me see how many things I can find here that are going to add friction:     As written, you are going to need one of those for each of the &#x201C;entities&#x201D; that you have. I assume that this is so that all the other per &#x201C;entity&#x201D; types wouldn&#x2019;t feel lonely. On last count, We had:         EmployeeRepository      EmployeeHandler      EmployeesHandler      EmployeeRouteHandler      EmployeeTranslator      EmployeeScript      EmployeeFacade       Mapping &#x201C;command&#x201D; whatever that is, to method calls? So every time that I have to add a new method, I have to touch how many places?    Why on earth do I need to do explicit error handling? That is why I have exceptions for. Those should do the Right Thing and I should not have to explicitly manage errors unless I know about something specific happening.   Oh, and I saved the best for last. Please take a look at the beast. And unlike the story, there is no beauty.         I truly find it hard to find a place to start.     Magic numbers all over the place.    Promote(object[] data) ?! Are we in the stone age again? I really hoped that by 2009 we would be able to get to grip with the notion of meaningful method parameters! For crying out load, you can use the ASP.Net MVC binder to do the work, you don&#x2019;t have to do it yourself.    Null reference exception that are just waiting to happen.    Unless PositionEnum is not an enum (a WTF all on its own), then the code wouldn&#x2019;t even compile! Enums are value types, you cannot use &#x2018;as&#x2019; with them.    busErrors ?          First of all, what bus?      More importantly, are we back in the good ole days of return codes? I thought we were beyond that already!       Really bad resource management. C# has try/catch/finally for a reason. If an exception is thrown, you are going to leak the transactions. This is truly sad since the text is very careful to point out that you MUST dispose of those resources before you return.   As I said, I am not going to even approach the actual guidance that is offered there. I think that it is invalid as best and likely to be harmful.   From the code sample shown, I would surmise that no one actually sat down and actually coded any sort of system with this. Even the most basic system would crumble under the sheer weight of architecture piled on top of the poor system.  I am saddened and disappointed to see such a thing being presented as guidance from the P&amp;P.</p>
        </article>
        <article id="article-6257">
            <a href="https://ayende.com/blog/3825/more-information-of-gc-issue" target="_blank">
                <h2 class="title mb-6" id="article-6257">More information of GC issue</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 22, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">After a lot more study, it looks like there are two separate issues that are causing the problem here.      During AppDomain unload, it is permissible for the GC to collect reachable objects. I am fine with that and I certainly agree that this makes sense.    Application_End occurs concurrently with the AppDomain unload.   Looking at the docs (and there are surprisingly few about this), it seems like 1 is expected, but 2 is a bug. The docs state:     Application_End&#xA0; - Called once per lifetime of the application before the application is unloaded.    It may be my English, but to me before doesn&#x2019;t suggest at the same time as.  So I do believe it is a bug in the framework, but not in the GC, it is in the shutdown code for ASP.Net. This is still a very nasty problem.</p>
        </article>
        <article id="article-6258">
            <a href="https://ayende.com/blog/3824/i-am-being-stalked-by-clr-bugs" target="_blank">
                <h2 class="title mb-6" id="article-6258">I am being stalked by CLR bugs</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 21, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just spent several hours tracking down a crashing but in my current project.   The&#xA0; issue was, quite clearly, a problem with releasing unmanaged resources. So I tightened my control over resources and made absolutely sure that I am releasing everything properly.  I simply could not believe what was going on. I knew what they code is doing, and I knew that what I was getting was flat out impossible.       Yes, I know that we keep saying that, but this bug really is not possible!  The situation is quite clear, during the shutdown process of the application, an unmanaged resource&#x2019;s finalizer would throw an exception because it wasn&#x2019;t properly disposed.  The problem? It is most assuredly should be disposed. When debugging through the problem, I found out something extremely strange and worrying. The managed object&#x2019;s finalizer was running while there were strong references to the object.  You can see that in the attached screenshot (click the image see it in full size).  That is, by the way, when you have the root in a static field, so it cannot be that the whole graph is free.  This is somehow related to threading, because debugging this would often change the way this works, but running without a debugger consistently fails.  The CLR semantics for finalizers clearly state that they can only be run after there are no more strong references to the instance. Cleary, this is not what is going on here.  The only thing that I can think of that can affect this is that there is something really strange going on with app domain unloads.  Now, I can&#x2019;t figure if this is me being extremely stupid or if this is a real problem. I did manage to create a reproduction of the issue, however, which you can download here.  This is on VMWare Fusion, running Windows 2008 x64, with .Net 3.5 SP1.  To reproduce, start the application in WebDev.WebServer, wait for the page to load, and the close the WebDev.WebServer. If it crashes, you have successfully reproduced the problem.  Update &#x2013; This is really interesting. both stack traces are operating on the same object, by the way.     Adding locking around the finalizer and dispose seems to have made the problem go away.</p>
        </article>
        <article id="article-6259">
            <a href="https://ayende.com/blog/3823/rhino-service-bus-concurrency-violations-are-business-logic" target="_blank">
                <h2 class="title mb-6" id="article-6259">Rhino Service Bus</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 21, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Concurrency is a tough topic, fraught with problems, pitfalls and nasty issues. This is especially the case when you try to build distributed, inherently parallel systems. I am dealing with the topic quite a lot recently and I have create several solutions (none of them are originally mine, mind you).  There aren&#x2019;t that many good solutions our there, most of them boil down to: &#x201C;suck it up and deal with the complexity.&#x201D; In this case, I want to try to deal with the complexity in a consistent fashion ( no one off solutions ) and in a way that I can deal without first meditating on the import of socks.  Let us see if I can come up with a good example. We have a saga that we use to check whatever a particular user has acceptable credit to buy something from us. The logic is that we need to verify with at least 2 credit card bureaus, and the average must be over 700. (This logic has nothing to do with the real world, since I just dreamt it up, by the way). Here is a simple implementation of a saga that can deal with those requirements:                    1: public class AccpetableCreditSaga : ISaga&lt;AccpetableCreditState&gt;,&#xA;&#xA;         2:   InitiatedBy&lt;IsAcceptableAsCustomer&gt;,&#xA;&#xA;         3:   Orchestrates&lt;CreditCardScore&gt;, &#xA;&#xA;         4:   Orchestrates&lt;MergeSagaState&gt;&#xA;&#xA;         5: {&#xA;&#xA;         6:   IServiceBus bus;&#xA;&#xA;         7:   public bool IsCompleted {get;set;}&#xA;&#xA;         8:   public Guid Id {get;set;}&#xA;&#xA;         9:   &#xA;&#xA;        10:   public AccpetableCreditSaga (IServiceBus bus)&#xA;&#xA;        11:   {&#xA;&#xA;        12:     this.bus = bus;&#xA;&#xA;        13:   }&#xA;&#xA;        14:   &#xA;&#xA;        15:   public void Consume(IsAcceptableAsCustomer message)&#xA;&#xA;        16:   {&#xA;&#xA;        17:     bus.Send(&#xA;&#xA;        18:       new Equifax.CheckCreditFor{Card = message.Card),&#xA;&#xA;        19:       new Experian.CheckCreditFor{Card = message.Card),&#xA;&#xA;        20:       new TransUnion.CheckCreditFor{Card = message.Card)&#xA;&#xA;        21:       );&#xA;&#xA;        22:   }&#xA;&#xA;        23:   &#xA;&#xA;        24:   public void Consume(CreditCardScore message)&#xA;&#xA;        25:   {&#xA;&#xA;        26:     State.Scores.Add(message);&#xA;&#xA;        27:     &#xA;&#xA;        28:     TryCompleteSaga();&#xA;&#xA;        29:   }&#xA;&#xA;        30:   &#xA;&#xA;        31:   public void Consume(MergeSagaState message)&#xA;&#xA;        32:   {&#xA;&#xA;        33:     TryCompleteSaga();&#xA;&#xA;        34:   }&#xA;&#xA;        35:   &#xA;&#xA;        36:   public void TryCompleteSaga()&#xA;&#xA;        37:   {&#xA;&#xA;        38:     if(State.Scores.Count &lt;2)&#xA;&#xA;        39:       return;&#xA;&#xA;        40:      &#xA;&#xA;        41:      bus.Publish(new CreditScoreAcceptable&#xA;&#xA;        42:      {&#xA;&#xA;        43:       CorrelationId = Id,&#xA;&#xA;        44:       IsAcceptable = State.Scores.Average(x=&gt;x.Score) &gt; 700&#xA;&#xA;        45:      });&#xA;&#xA;        46:      IsCompleted = true;&#xA;&#xA;        47:   }&#xA;&#xA;        48: }&#xA;    &#xA;  &#xA;&#xA;&#xA;We have this strange MergeSagaState message, but other than that, it should be pretty obvious what is going on in here.It should be equally obvious that we have a serious problem here. Let us say that we get two reply messages with credit card scores, at the same time. We will create two instances of the saga that will run in parallel, each of them getting a copy of the saga&#x2019;s state. But, the end result is that processing those messages doesn&#x2019;t match the end condition for the saga. So even though in practice we have gotten all the messages we need, because we handled them in parallel, we had no chance to actually see both changes at the same time. This means that any logic that we have that requires us to have a full picture of what is going on isn&#x2019;t going to work.&#xA;&#xA;Rhino Service Bus solve the issue by putting the saga&#x2019;s state into Rhino DHT. This means that a single saga may have several states at the same time. Merging them together is also something that the bus will take care off. Merging the different parts is inherently an issue that cannot be solved generically. There is no generic merge algorithm that you can use. Rhino Service Bus define an interface that will allow you to deal with this issue in a clean manner and supply whatever business logic is required to merge difference versions.&#xA;&#xA;Here is an example of how we can merge the different versions together:&#xA;&#xA;&#xA;  &#xA;       1: public class AccpetableCreditStateMerger : ISagaStateMerger&lt;AccpetableCreditState&gt;&#xA;&#xA;       2: {&#xA;&#xA;       3:   public AccpetableCreditState Merge(AccpetableCreditState[] states)&#xA;&#xA;       4:   {&#xA;&#xA;       5:     return new AccpetableCreditState&#xA;&#xA;       6:     {&#xA;&#xA;       7:       SCores = states.SelectMany(x=&gt;x.Scores)&#xA;&#xA;       8:         .GroupBy(x=&gt;x.Bureau)&#xA;&#xA;       9:         .Select(x =&gt; new Score&#xA;&#xA;      10:         {&#xA;&#xA;      11:           Bureau = x.Key,&#xA;&#xA;      12:           Score = x.Max(y=&gt;y.Score)&#xA;&#xA;      13:         }).ToList();&#xA;&#xA;      14:     };&#xA;&#xA;      15:   }&#xA;&#xA;      16: }&#xA;  &#xA;&#xA;&#xA;Note that this is notepad code, so it may contain errors, but the actual intention should be clear. We accept an array of states that need to be merged, find the highest score from each bureau and return the merged state.&#xA;&#xA;whenever Rhino Service Bus detects that the saga is in a conflicted state, it will post a MergeSagaState message to the saga. This will merge the saga&#x2019;s state and call the Consume(MergeSagaState), in which the saga gets to decide what it wants to do about this (usually inspect the state to see if we missed anything). This also works for completing a saga, by the way, you cannot complete a saga in an inconsistent state, you will get called again with Consume(MergeSagaSate) to deal with that.&#xA;&#xA;The state merger is also a good place to try to deal with concurrency compensating actions. If we notice in the merger that we perform some action twice and we need to revert one of them, for example. In general, it is better to be able to avoid having to do so, but that is the place for this logic.</p>
        </article>
        <article id="article-6260">
            <a href="https://ayende.com/blog/3822/rhino-service-bus-concurrency-in-a-distributed-world" target="_blank">
                <h2 class="title mb-6" id="article-6260">Rhino Service Bus</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 19, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I have talked about Rhino DHT at length, and the versioning story that exists there. What I haven&#x2019;t talked about is why I built it. Or, to be rather more exact, the actual use case that I had in mind.  Jason Diamond had pointed out a problem with the way sagas work with Rhino Service Bus.     Are BaristaSaga objects instantiated per message? If so, can two different instances be consuming different messages concurrently?     The reason I ask is because it looks like handling the PrepareDrink message could take some time. Is it possible that a PaymentComplete message could come in before the PrepareDrink message is finished being handled?     If the two instances of BaristaSaga have their own instance of BaristaState, I can see the GotPayment value set by handling the PaymentComplete message getting lost.     If the two instances of BaristaSaga share the same instance of BaristaState, do I now have to worry about synchronizing changes to the state across all of the sagas? Also, wouldn&#x27;t this prevent having multiple barista &quot;servers&quot; handling messages since they wouldn&#x27;t be able to share instances across processes/machines.   The answer to that is that yes, a saga can execute concurrently. Not only that, but it can execute concurrently on different machines. That put us in somewhat of a problem regarding consistent state.  There are several options that we can use to resolve the issue. One of them is to ensure that this cannot happen by locking on a shared resource when executing the saga (commonly done by opening a transaction on the saga&#x2019;s row). That can significantly limit the system scalability. Another option is to persist the saga&#x2019;s state in a way that ensure that we have no conflicts. One way of doing that is to persist the actual state change itself, which allow us to replay the object to a consistent state. Concurrent updates don&#x2019;t bother us because we aren&#x2019;t actually modifying the data.  That might require some careful thinking, however, to avoid a case where a saga tat is concurrently executing step on its own feet without paying attention. I strongly dislike anything that require careful thinking. It is like saying that C&#x2B;&#x2B;&#x2019;s has no memory leaks issues, it just require some careful thinking.  For RSB, I wanted to be able to do better than that. I selected Rhino DHT at persistence store for the default saga&#x2019;s state (you can still do other things, of course). That means that concurrency is very explicit. If you got to a point where there were two concurrently executing instances of the saga, their state is going to go to Rhino DHT. Since they are both going to be from the same version, Rhino DHT is going to keep both state changes around.  The next time that we need the state for that particular saga, we are actually going to get both states. At that point, we introduce the ISagaStateMerger:                    1: public interface ISagaStateMerger&lt;TState&gt;&#xA;&#xA;         2:     where TState : IVersionedSagaState&#xA;&#xA;         3: {&#xA;&#xA;         4:     TState Merge(TState[] states);&#xA;&#xA;         5: }&#xA;    &#xA;  &#xA;&#xA;&#xA;This allow us to handle the notion of concurrency resolution in a very explicit manner. We get the appropriate state merger from the container and use that to merge the states back to a consistent state, which we then pass to the saga to continue its execution.&#xA;&#xA;There is just one additional twist. A saga cannot complete until it is in a consistent state, so if the saga completes while it is in an inconsistent state, we will call the saga again (after resolving the conflict) and let it handle the final state conflict before perform the actual completion.</p>
        </article>
        <div class="button flex justify-between">
            <a href="625.html"><span class="back arrow"></span></a>

            <a href="627.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;🚀&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
