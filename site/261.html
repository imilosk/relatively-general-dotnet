
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Home â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<script>
    const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

    function getUserPref() {
        const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
        return storedTheme || (lightModePref.matches ? "light" : "dark");
    }

    function setTheme(newTheme) {
        if (newTheme !== "light" && newTheme !== "dark") {
            return console.warn(
                `Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
            );
        }

        const root = document.documentElement;

        // root already set to newTheme, exit early
        if (newTheme === root.getAttribute("data-theme")) {
            return;
        }

        root.setAttribute("data-theme", newTheme);

        const colorThemeMetaTag = document.querySelector("meta[name='theme-color']");
        const bgColour = getComputedStyle(document.body).getPropertyValue("--theme-bg");
        colorThemeMetaTag.setAttribute("content", `hsl(${bgColour})`);
        if (typeof localStorage !== "undefined") {
            localStorage.setItem("theme", newTheme);
        }
    }

    // initial setup
    setTheme(getUserPref());

    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("theme-toggle").addEventListener("click", () => {
            const theme = localStorage.getItem("theme");

            if (theme === "dark") {
                setTheme("light");
            } else {
                setTheme("dark");
            }
        });

        document.getElementById("toggle-navigation-menu").addEventListener("click", (e) => {
            const button = e.target;
            const ariaExpanded = button.getAttribute("aria-expanded");
            const header = document.getElementById("main-header");

            if (ariaExpanded === "true") {
                button.setAttribute("aria-expanded", "false");
                header.classList.remove("menu-open");
            } else {
                button.setAttribute("aria-expanded", "true");
                header.classList.add("menu-open");
            }
        });
    });
</script>

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <theme-toggle class="ms-auto">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main">
    <section aria-label="Blog post list">
        <a href="https://ayende.com/blog/167201/compression-finale" target="_blank"><h1 class="title mb-6">Compression finale</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: July 02, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">After a fairly long road, we are done. We have all the pieces, generating a shared dictionary, writing using Huffman encoding and getting the results back out. Hopefully by now the theory behind it is fairly clear to you, and it is time to actually put this into practice. I&#x2019;ve 100,000 random users documents in this file, and I want to see what kind of compression I can get from a shared dictionary approach. The project with the code for all of this can be found here: Rhea Compression (most of it is basically a port of FemtoZip to .NET). The actual file size is 8.49 MB, and when compressing it with Zip (Windows&#x2019; send to compress folder) it turn into a 1.93 MB file.  The original file size in bytes is: 8,809,353. I then tried to compress each document individually using GZipStream, resulting in a total of: 10,004,614 bytes used. Or 9.5 MB! In other words, and not to anyone surprise (I hope), we see an increase in the file size. However, when using Rhea&#x2019;s compression, we do the following: var trainer = new CompressionTrainer();&#xA;&#xA;for (int i = 0; i &lt; json.Length/100; i&#x2B;&#x2B;)&#xA;{&#xA;    trainer.TrainOn(json[i*100]);&#xA;}&#xA;&#xA;var compressionHandler = trainer.CreateHandler();&#xA;&#xA;&#xA;This creates a shared dictionary from every 100th document. So we have 1,000 documents as our sampling data. Then, I compressed all the individual documents one at a time.&#xA;The result took: 2,593,235 bytes or just 2.47 MB. We got 29% compression ratio! Note that we did this with a 34Kb shared dictionary.&#xA;Here is the actual compression code:&#xA;foreach (var dic in docs)&#xA;{&#xA;    size &#x2B;= s.Length;&#xA;    ms.SetLength(0);&#xA;    compressedSize &#x2B;= compressionHandler.Compress(s, ms);&#xA;}&#xA;&#xA;&#xA;&#xA;And that is pretty much it. Rhea Compression is on github, and that concludes my spike into compression. In general, Rhea (and FemtoZip, obviously) are meant for very specific scenarios. I have high hopes to be able to use it in the future for doing great things .</p>
        <a href="https://ayende.com/blog/167171/huffman-coding-and-encoding-compressed-data" target="_blank"><h1 class="title mb-6">Huffman coding and encoding compressed data</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: July 01, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">So far, we have dealt with relatively straightforward topics. Given a corpus, find a shared dictionary that we can then use to extract repeated patterns. This is the classic view of compression, even if real world compression schemes are actually a lot more convoluted. Now, that we have compressed text like the following, what comes next?&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;&lt;-43,6&gt;11,&#x27;n&lt;-60,6&gt;Anna Nepal&lt;-40,13&gt;&lt;-18,8&gt;&lt;-68,8&gt;awest@twinte.gov&#x27;}&#xA;&#xA;&#xA;&#x9;Obviously, it would be pretty important to encoding this properly. Here is an example of a bad encoding scheme:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;[prefix &#x2013; byte &#x2013; 1 for compressed, 0 for literal]&#xA;&#x9;&#xA;&#x9;&#x9;[length &#x2013; int &#x2013; length of compressed / literal]&#xA;&#x9;&#xA;&#x9;&#x9;[offset &#x2013; int &#x2013; back reference if the prefix was set to 1]&#xA;&#xA;&#xA;&#x9;The problem here is that we need 6 bytes to encode a one letter literal, and 9 bytes to encode any back reference. Using this inefficient method, encoding the compressed string above actually takes more space than the original one.&#xA;&#xA;&#x9;As you can imagine, there has been a lot of research into this. The RFC 1951 specification, for example, set us how to do that in detail, although I find this explanation much easier to go through.&#xA;&#xA;&#x9;Let us see a simple Huffman encoding scheme. We will use &#x201C;this is an example of a huffman tree&#x201D; as our text, and first, we&#x2019;ll build the table.&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;And now we can encoding the above sentence in 135 bits, instead of 288.&#xA;&#xA;&#x9;For decoding, we just run over the table again, and stop the first time that we hit a leaf.&#xA;&#xA;&#x9;For example, let us see how we would decode &#x2018; &#x2018; and &#x2018;r&#x2019;.&#xA;&#xA;&#x9;Space is very common, appearing 7 times in the text. As such, it is encoded as 111. So, start from the root, and move right three times. We are in a leaf node, and we output space.&#xA;&#xA;&#x9;With the letter R, it only appear in the text 4 times, and its encoding is 10111. So move right from the root node, then left, then three times right, resulting in the leaf node R.&#xA;&#xA;&#x9;So the results of Huffman encoding using the above table is:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;[t] = 0001&#xA;[h] = 1010&#xA;[i] = 1011&#xA;[s] = 0000&#xA;[ ] = 111&#xA;[i] = 1011&#xA;[s] = 0000&#xA;[ ] = 111&#xA;[a] = 010&#xA;[n] = 0011&#xA;[ ] = 111&#xA;[e] = 011&#xA;[x] = 10001&#xA;[a] = 010&#xA;[m] = 0010&#xA;[p] = 10010&#xA;[l] = 110010&#xA;[e] = 011&#xA;[ ] = 111&#xA;[o] = 110011&#xA;[f] = 1101&#xA;[ ] = 111&#xA;[a] = 010&#xA;[ ] = 111&#xA;[h] = 1010&#xA;[u] = 10000&#xA;[f] = 1101&#xA;[f] = 1101&#xA;[m] = 0010&#xA;[a] = 010&#xA;[n] = 0011&#xA;[ ] = 111&#xA;[t] = 0001&#xA;[r] = 10011&#xA;[e] = 011&#xA;[e] = 011&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;However, we have a problem here, this result in 135 bits or 17 bytes (vs 36 bytes for the original code). However, 17 bytes contains 136 bits. How do we avoid corruption in this case? The answer is that we have to include an EOF Marker in there. We do that by just adding a new item to our Huffman table and recording this normally.&#xA;&#xA;&#x9;So, that is all set, and we are ready to go, right?&#xA0; Almost, we still need to decide how to actually encode the literals and compressed data. GZip (and FemtoZip) uses a really nice way of handling that.&#xA;&#xA;&#x9;The use of Huffman table means that it contains the frequencies of individual bytes values, but instead of having just 0 &#x2013; 255 entries in the Huffman table, they uses 513 entries.&#xA;&#xA;&#x9;256 entries are for the actual byte entries.&#xA;&#xA;&#x9;256 entries are just lengths.&#xA;&#xA;&#x9;1 entry for EOF.&#xA;&#xA;&#x9;What does it means, length entries? It basically means, we store the values 256 &#x2013; 511 for lengths. When we read the Huffman value, it will give us a value in the range of 0 &#x2013; 512.&#xA;&#xA;&#x9;If it is 512, this is the EOF marker, and we are done.&#xA;&#xA;&#x9;If it is 0 &#x2013; 255, it is a byte literal, and we can treat it as such.&#xA;&#xA;&#x9;But if it is in the range of 256 &#x2013; 511, it means that this is a length. Note that because lengths also cluster around common values, it is very likely that we&#x2019;ll be able to store most lengths in under a byte.&#xA;&#xA;&#x9;Following a length, we&#x2019;ll store the actual offset back. And again, FemtoZip is using Huffman encoding to do that. This is actually being done by encoding the offset into multiple 4 bits entries. The idea is to gain as much as possible from commonalities in the actual byte patterns for the offset.&#xA;&#xA;&#x9;Yes, it is confusing, and it took me a while to figure it out. But it is also very sleek to see this in action.&#xA;&#xA;&#x9;On my next post, I&#x2019;ll bring it all together and attempt to actually generate something that produces compressed data and can decompress it back successfully&#x2026;</p>
        <a href="https://ayende.com/blog/167170/fun-with-compression-now-on-github" target="_blank"><h1 class="title mb-6">Fun with compression, now on GitHub</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 30, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">My experiments with compression are live here: https://github.com/ayende/Rhea.Compression Note that they consist mostly of porting code from FemtoZip and adding some code that would generate human readable output so I can follow on what is going on.</p>
        <a href="https://ayende.com/blog/167169/using-shared-dictionary-during-compression" target="_blank"><h1 class="title mb-6">Using shared dictionary during compression</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 27, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">After the process of creating the actual dictionary, it is time for us to actually make use of it, isn&#x2019;t it? Again, I&#x2019;m following the code from FemtoZip here, and I&#x2019;m going to explain how it actually uses the dictionary for compression. The magic is happening in the PrefixHash class. Let us see the calling code: var dic = Encoding.UTF8.GetBytes(&quot;asonerryson@eterson&#x27;,&#x27;.mil&#x27;ame&#x27;:&#x27;{&#x27;id&#x27;:&#x27;,&#x27;country&#x27;:&#x27;P&#x27;,&#x27;email&#x27;:&#x27;,&#x27;country&#x27;:&#x27;&quot;);&#xA;&#xA;var text = Encoding.UTF8.GetBytes(&quot;{&#x27;id&#x27;:11,&#x27;name&#x27;:&#x27;Anna West&#x27;,&#x27;country&#x27;:&#x27;Nepal&#x27;,&#x27;email&#x27;:&#x27;awest@twinte.gov&#x27;}&quot;);&#xA;&#xA;var prefixHash = new PrefixHash(dic, true);&#xA;&#xA;var bestMatch = prefixHash.GetBestMatch(0, text);&#xA;Console.WriteLine(Encoding.UTF8.GetString(dic, bestMatch.BestMatchIndex, bestMatch.BestMatchLength));&#xA;&#xA;&#xA;&#xA;The output of this code is: {&#x2018;id&#x2019;:&#xA;How does this work?&#xA;When we create the prefixHash, it generate the following table by hashing every 4 bytes and storing the relevant position in them.&#xA;&#xA;hash[&#xA0; 5] =&#xA0; 58;hash[ 11] =&#xA0; 71;hash[ 13] =&#xA0; 22;hash[ 14] =&#xA0; 11;hash[ 17] =&#xA0; 23;hash[ 30] =&#xA0; 16;hash[ 34] =&#xA0; 61;hash[ 35] =&#xA0;&#xA0; 5;hash[ 37] =&#xA0; 70;hash[ 41] =&#xA0; 65;hash[ 45] =&#xA0; 54;hash[ 49] =&#xA0; 66;hash[ 57] =&#xA0; 36;hash[ 58] =&#xA0; 29;hash[ 63] =&#xA0; 57;hash[ 65] =&#xA0; 60;hash[ 66] =&#xA0; 56;hash[ 67] =&#xA0;&#xA0; 2;hash[ 72] =&#xA0;&#xA0; 0;hash[ 73] =&#xA0; 28;hash[ 78] =&#xA0; 62;hash[ 79] =&#xA0; 35;hash[ 80] =&#xA0; 51;hash[ 87] =&#xA0; 55;hash[ 89] =&#xA0; 15;hash[ 91] =&#xA0;&#xA0; 9;hash[ 96] =&#xA0;&#xA0; 7;hash[ 99] =&#xA0; 67;hash[100] =&#xA0; 52;hash[105] =&#xA0; 21;hash[108] =&#xA0; 25;hash[109] =&#xA0; 69;hash[110] =&#xA0; 68;hash[111] =&#xA0; 64;hash[118] =&#xA0; 17;hash[120] =&#xA0;&#xA0; 4;hash[125] =&#xA0; 33;hash[126] =&#xA0;&#xA0; 3;hash[127] =&#xA0; 26;hash[130] =&#xA0; 18;hash[131] =&#xA0; 31;hash[132] =&#xA0; 59;&#xA;The hash of {&#x2018;id (the first 4 bytes) is 125. And as you can see, that maps to position 33. That means that there is a likelihood that there in position 33 there is a the value {&#x2018;id. What we do then is check, and continue to run through the code as long as we have a match.&#xA;That is how we can figure out that there is a 6 character match starting at position 33. The actual code is more involved, of course, and we need to figure out if there might be another match, elsewhere in the dictionary, that might serve better. Another issue when we need to actually compress is that while we can use the dictionary for compression, it is also actually possible to use the plain text we are compressing as another dictionary as well. Which is what FemtoZip is doing.&#xA;Basically, the logic goes like this. Check the current position for an entry in the dictionary, then check if we already had this value in the plain text we have seen so far. Select the largest match, then output that.&#xA;Here is actually using it all:&#xA;var dic = Encoding.UTF8.GetBytes(&quot;asonerryson@eterson&#x27;,&#x27;.mil&#x27;ame&#x27;:&#x27;{&#x27;id&#x27;:&#x27;,&#x27;country&#x27;:&#x27;P&#x27;,&#x27;email&#x27;:&#x27;,&#x27;country&#x27;:&#x27;&quot;);&#xA;&#xA;var text = Encoding.UTF8.GetBytes(&quot;{&#x27;id&#x27;:11,&#x27;name&#x27;:&#x27;Anna Nepal&#x27;,&#x27;country&#x27;:&#x27;Nepal&#x27;,&#x27;email&#x27;:&#x27;awest@twinte.gov&#x27;}&quot;);&#xA;&#xA;var substringPacker = new SubstringPacker(dic);&#xA;substringPacker.Pack(text, new DebugPackerOutput(), Console.Out);&#xA;&#xA;&#xA;&#xA;The output is meant to be human readable, and the compressed text is:&#xA;&#xA;&lt;-43,6&gt;11,&#x27;n&lt;-60,6&gt;Anna Nepal&lt;-40,13&gt;&lt;-18,8&gt;&lt;-68,8&gt;awest@twinte.gov&#x27;}&#xA;Note that we saved a total of 41 characters due to compression (assuming we don&#x2019;t count the cost of actually encoding this.&#xA;Now, what about those references? They look very strange with those negative numbers. The reason those numbers are negative is actually quite simple. They aren&#x2019;t dictionary entries, like you would think. Instead, they are back references. In other words, the first &lt;-43,6&gt; call is actually saying: go backward 43 bytes, then copy 6 bytes.&#xA;But we just started reading the compressed text, where do we go backward to? The answer is that we go backward into the dictionary. So all the references in the text are always relative to our current position. Let us resolve this compressed string one step at a time.&#xA;&lt;-43,6&gt; means go back 43 bytes into the dictionary and copy 6 bytes, giving us a string of:&#xA;&#xA;{&#x2018;id&#x2019;:&#xA;Then we have &#x201C;11,n&#x201D; literal that we append to the string:&#xA;&#xA;{&#x2018;id&#x2019;:11,&#x2019;n&#xA;Now we need to go 60 bytes back (from the current end of the string) and copy 6 bytes giving us:&#xA;&#xA;{&#x2018;id&#x2019;:11,&#x2019;name&#x2019;:&#x2019;&#xA;The literal &#x201C;Anna Nepal&#x201D; giving us:&#xA;&#xA;{&#x2018;id&#x2019;:11,&#x2019;name&#x2019;:&#x2019;Anna Nepal&#xA;Then we have to go 40 characters back, and copy 13 bytes:&#xA;&#xA;{&#x2018;id&#x2019;:11,&#x2019;name&#x2019;:&#x2019;Anna Nepal&#x2019;,&#x2019;country&#x2019;:&#x2019;&#xA;Now this is fun, we have to go 18 chars back, and for the first time, we aren&#x2019;t hitting the dictionary, we are using the actual string that we uncompressed to generate the rest of the string:&#xA;&#xA;{&#x2018;id&#x2019;:11,&#x2019;name&#x2019;:&#x2019;Anna Nepal&#x2019;,&#x2019;country&#x2019;:&#x2019;Nepal&#x2019;,&#xA;Another backward reference, 68 steps and copying 8 bytes (again to the dictionary):&#xA;&#xA;{&#x2018;id&#x2019;:11,&#x2019;name&#x2019;:&#x2019;Anna Nepal&#x2019;,&#x2019;country&#x2019;:&#x2019;Nepal&#x2019;,&#x2019;email&#x2019;:&#x2019;&#xA;The literal awest@twinte.gov&#x2019;} completes the picture, giving us the full text:&#xA;&#xA;{&#x2018;id&#x2019;:11,&#x2019;name&#x2019;:&#x2019;Anna Nepal&#x2019;,&#x2019;country&#x2019;:&#x2019;Nepal&#x2019;,&#x2019;email&#x2019;:&#x2019;awest@twinte.gov&#x2019;}&#xA;And that is how FemtoZip works. And that is pretty neat. &#xA;The actual implementation is doing Huffman compression as well, but I&#x2019;ll touch on that in a later post.</p>
        <a href="https://ayende.com/blog/167137/shared-dictionary-generation" target="_blank"><h1 class="title mb-6">Shared dictionary generation</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 26, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">As I said, generating a shared dictionary turned out to be a bit more complex than I thought it would be. I hoped to be able to just use a prefix tree and get the highest scoring entries, but that doesn&#x2019;t fly. I turned to femtozip to see how they do that, and it became both easier and harder at the same time. They are doing this using a suffix array and LCP. I decided to port this to C# so I can play with this more easily. We start with the following code:  var dic = new DictionaryOptimizer();&#xA;&#xA; dic.Add(&quot;{&#x27;id&#x27;:1,&#x27;name&#x27;:&#x27;Ryan Peterson&#x27;,&#x27;country&#x27;:&#x27;Northern Mariana Islands&#x27;,&#x27;email&#x27;:&#x27;rpeterson@youspan.mil&#x27;&quot;);&#xA; dic.Add(&quot;{&#x27;id&#x27;:2,&#x27;name&#x27;:&#x27;Judith Mason&#x27;,&#x27;country&#x27;:&#x27;Puerto Rico&#x27;,&#x27;email&#x27;:&#x27;jmason@quatz.com&#x27;&quot;);&#xA; dic.Add(&quot;{&#x27;id&#x27;:3,&#x27;name&#x27;:&#x27;Kenneth Berry&#x27;,&#x27;country&#x27;:&#x27;Pakistan&#x27;,&#x27;email&#x27;:&#x27;kberry@wordtune.mil&#x27;&quot;);&#xA;&#xA; var optimize = dic.Optimize(512);&#xA;&#xA;&#xA;&#xA;This gives me an initial corpus to work with. And let us dig in and figure out what is going how it works. Note that I use a very small sample to reduce the amount of stuff we have to go through.&#xA;The first thing that FemtoZip is doing is to concat all of those entries together and generate a suffix array. A suffix array is all the suffixes from the combined string, and part of it, for the string above, is:&#xA;&#xA;ariana Islands&#x27;,&#x27;email&#x27;:&#x27;rpeterson@youspason&#x27;,&#x27;country&#x27;:&#x27;Puerto Rico&#x27;,&#x27;email&#x27;:&#x27;jason@quatz.com&#x27;{&#x27;id&#x27;:3,&#x27;name&#x27;:&#x27;Kenneth Batz.com&#x27;{&#x27;id&#x27;:3,&#x27;name&#x27;:&#x27;Kenneth Berry&#x27;,&#x27;berry@wordtune.mil&#x27;co&#x27;,&#x27;email&#x27;:&#x27;jmason@quatz.com&#x27;{&#x27;id&#x27;:3,&#x27;ncom&#x27;{&#x27;id&#x27;:3,&#x27;name&#x27;:&#x27;Kenneth Berry&#x27;,&#x27;councountry&#x27;:&#x27;Northern Mariana Islands&#x27;,&#x27;emacountry&#x27;:&#x27;Pakistan&#x27;,&#x27;email&#x27;:&#x27;kberry@wordcountry&#x27;:&#x27;Puerto Rico&#x27;,&#x27;email&#x27;:&#x27;jmason@qd&#x27;:1,&#x27;name&#x27;:&#x27;Ryan Peterson&#x27;,&#x27;country&#x27;:&#x27;Nd&#x27;:2,&#x27;name&#x27;:&#x27;Judith Mason&#x27;,&#x27;country&#x27;:&#x27;Pud&#x27;:3,&#x27;name&#x27;:&#x27;Kenneth Berry&#x27;,&#x27;country&#x27;:&#x27;Pdith Mason&#x27;,&#x27;country&#x27;:&#x27;Puerto Rico&#x27;,&#x27;emads&#x27;,&#x27;email&#x27;:&#x27;rpeterson@youspan.mil&#x27;{&#x27;id&#x27;dtune.mil&#x27;e&#x27;:&#x27;Judith Mason&#x27;,&#x27;country&#x27;:&#x27;Puerto Ricoe&#x27;:&#x27;Kenneth Berry&#x27;,&#x27;country&#x27;:&#x27;Pakistan&#x27;,e&#x27;:&#x27;Ryan Peterson&#x27;,&#x27;country&#x27;:&#x27;Northern Me.mil&#x27;email&#x27;:&#x27;jmason@quatz.com&#x27;{&#x27;id&#x27;:3,&#x27;name&#x27;:email&#x27;:&#x27;kberry@wordtune.mil&#x27;email&#x27;:&#x27;rpeterson@youspan.mil&#x27;{&#x27;id&#x27;:2,&#x27;nenneth Berry&#x27;,&#x27;country&#x27;:&#x27;Pakistan&#x27;,&#x27;emai&#xA;The idea is to generate all the suffixes from the string, then sort them. Then use LCP (longest common prefix) to see what is the shared prefix between any two consecutive entries.&#xA;Together, we can use that to generate a list of all the common substrings. Then we start ranking them by how often they appear. Afterward, it is a matter of selecting the most frequent items that are the largest, so our dictionary entries will show be as useful as possible.&#xA;That gives us a list of potential entries:&#xA;&#xA;&#x27;,&#x27;country&#x27;:&#x27;,&#x27;country&#x27;:&#x27;&#x27;country&#x27;:&#x27;&#x27;,&#x27;email&#x27;:&#x27;country&#x27;:&#x27;,&#x27;email&#x27;:&#x27;ountry&#x27;:&#x27;,&#x27;name&#x27;:&#x27;&#x27;email&#x27;:&#x27;untry&#x27;:&#x27;email&#x27;:&#x27;&#x27;name&#x27;:&#x27;ntry&#x27;:&#x27;name&#x27;:&#x27;mail&#x27;:&#x27;son&#x27;,&#x27;country&#x27;:&#x27;on&#x27;,&#x27;country&#x27;:&#x27;n&#x27;,&#x27;country&#x27;:&#x27;&#x27;,&#x27;country&#x27;:&#x27;P,&#x27;country&#x27;:&#x27;P{&#x27;id&#x27;:try&#x27;:&#x27;ame&#x27;:&#x27;ail&#x27;:&#x27;&#x27;country&#x27;:&#x27;Pcountry&#x27;:&#x27;Pountry&#x27;:&#x27;Puntry&#x27;:&#x27;Pntry&#x27;:&#x27;Pry&#x27;:&#x27;me&#x27;:&#x27;il&#x27;:&#x27;&#x27;id&#x27;:try&#x27;:&#x27;Pry&#x27;:&#x27;Py&#x27;:&#x27;P.mil&#x27;y&#x27;:&#x27;n&#x27;,&#x27;l&#x27;:&#x27;id&#x27;:e&#x27;:&#x27;etersontersonson@mil&#x27;&#x27;:&#x27;Personrsonerryason&#xA;One thing you can note here is that there are a lot of repeated strings. country appears in a lot of permutations, so we need to clear this up as well, remove all the entries that are overlapping, and then pack this into a final dictionary.&#xA;The dictionary resulting from the code above is:&#xA;&#xA;asonerryson@eterson&#x27;,&#x27;.mil&#x27;ame&#x27;:&#x27;{&#x27;id&#x27;:&#x27;,&#x27;country&#x27;:&#x27;P&#x27;,&#x27;email&#x27;:&#x27;,&#x27;country&#x27;:&#x27;&#xA;This contains all the repeated strings that have been deemed valuable enough to put into the dictionary.&#xA;On my next post, I&#x2019;ll talk on how to make use of this dictionary to actually handle compression.</p>
        <a href="https://ardalis.com/resolving-dependencies-in-asp-net-mvc-5-with-structuremap/" target="_blank"><h1 class="title mb-6">Resolving Dependencies in ASP.NET MVC 5 with StructureMap</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 25, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In a previous post I showed how to use StructureMap with ASP.NET MVC 3. It&#x2019;s been a couple of years, so I figured it was time to update that&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ardalis.com/how-do-i-use-structuremap-with-asp-net-mvc-3/" target="_blank"><h1 class="title mb-6">How Do I Use StructureMap with ASP.NET MVC 3</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 25, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Update: If you want to use StructureMap with ASP.NET MVC 5, I have a walkthrough on this now as well. As I write this, the best resource for&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ayende.com/blog/167105/building-a-shared-dictionary" target="_blank"><h1 class="title mb-6">Building a shared dictionary</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 25, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This turned out to be a pretty hard problem. I wanted to do my own thing, but for reference, femtozip is considered to be the master source for such things. The idea of a shared dictionary system is that you have a training corpus, that you use to extract common elements from the training corpus, which you can then use to build a dictionary, which you&#x2019;ll then be able to use to compress all the other data. In order to test this, I generated 100,000 users using Mockaroo. You can find the sample data here: RandomUsers. The data looks like this:  {&quot;id&quot;:1,&quot;name&quot;:&quot;Ryan Peterson&quot;,&quot;country&quot;:&quot;Northern Mariana Islands&quot;,&quot;email&quot;:&quot;rpeterson@youspan.mil&quot;},{&quot;id&quot;:2,&quot;name&quot;:&quot;Judith Mason&quot;,&quot;country&quot;:&quot;Puerto Rico&quot;,&quot;email&quot;:&quot;jmason@quatz.com&quot;},{&quot;id&quot;:3,&quot;name&quot;:&quot;Kenneth Berry&quot;,&quot;country&quot;:&quot;Pakistan&quot;,&quot;email&quot;:&quot;kberry@wordtune.mil&quot;},{&quot;id&quot;:4,&quot;name&quot;:&quot;Judith Ortiz&quot;,&quot;country&quot;:&quot;Cuba&quot;,&quot;email&quot;:&quot;jortiz@snaptags.edu&quot;},{&quot;id&quot;:5,&quot;name&quot;:&quot;Adam Lewis&quot;,&quot;country&quot;:&quot;Poland&quot;,&quot;email&quot;:&quot;alewis@muxo.mil&quot;},{&quot;id&quot;:6,&quot;name&quot;:&quot;Angela Spencer&quot;,&quot;country&quot;:&quot;Poland&quot;,&quot;email&quot;:&quot;aspencer@jabbersphere.info&quot;},{&quot;id&quot;:7,&quot;name&quot;:&quot;Jason Snyder&quot;,&quot;country&quot;:&quot;Cambodia&quot;,&quot;email&quot;:&quot;jsnyder@voomm.net&quot;},{&quot;id&quot;:8,&quot;name&quot;:&quot;Pamela Palmer&quot;,&quot;country&quot;:&quot;Guinea-Bissau&quot;,&quot;email&quot;:&quot;ppalmer@rooxo.name&quot;},{&quot;id&quot;:9,&quot;name&quot;:&quot;Mary Graham&quot;,&quot;country&quot;:&quot;Niger&quot;,&quot;email&quot;:&quot;mgraham@fivespan.mil&quot;},{&quot;id&quot;:10,&quot;name&quot;:&quot;Christopher Brooks&quot;,&quot;country&quot;:&quot;Trinidad and Tobago&quot;,&quot;email&quot;:&quot;cbrooks@blogtag.name&quot;},{&quot;id&quot;:11,&quot;name&quot;:&quot;Anna West&quot;,&quot;country&quot;:&quot;Nepal&quot;,&quot;email&quot;:&quot;awest@twinte.gov&quot;},{&quot;id&quot;:12,&quot;name&quot;:&quot;Angela Watkins&quot;,&quot;country&quot;:&quot;Iceland&quot;,&quot;email&quot;:&quot;awatkins@izio.com&quot;},{&quot;id&quot;:13,&quot;name&quot;:&quot;Gregory Coleman&quot;,&quot;country&quot;:&quot;Oman&quot;,&quot;email&quot;:&quot;gcoleman@browsebug.net&quot;},{&quot;id&quot;:14,&quot;name&quot;:&quot;Andrew Hamilton&quot;,&quot;country&quot;:&quot;Ukraine&quot;,&quot;email&quot;:&quot;ahamilton@rhyzio.info&quot;},{&quot;id&quot;:15,&quot;name&quot;:&quot;James Patterson&quot;,&quot;country&quot;:&quot;Poland&quot;,&quot;email&quot;:&quot;jpatterson@skippad.net&quot;},{&quot;id&quot;:16,&quot;name&quot;:&quot;Patricia Kelley&quot;,&quot;country&quot;:&quot;Papua New Guinea&quot;,&quot;email&quot;:&quot;pkelley@meetz.biz&quot;},{&quot;id&quot;:17,&quot;name&quot;:&quot;Annie Burton&quot;,&quot;country&quot;:&quot;Germany&quot;,&quot;email&quot;:&quot;aburton@linktype.com&quot;},{&quot;id&quot;:18,&quot;name&quot;:&quot;Margaret Wilson&quot;,&quot;country&quot;:&quot;Saudia Arabia&quot;,&quot;email&quot;:&quot;mwilson@brainverse.mil&quot;},{&quot;id&quot;:19,&quot;name&quot;:&quot;Louise Harper&quot;,&quot;country&quot;:&quot;Poland&quot;,&quot;email&quot;:&quot;lharper@skinder.info&quot;},{&quot;id&quot;:20,&quot;name&quot;:&quot;Henry Hunt&quot;,&quot;country&quot;:&quot;Martinique&quot;,&quot;email&quot;:&quot;hhunt@thoughtstorm.org&quot;}&#xA;And what I want to do is to run over the first 1,000 records and extract a shared dictionary. Actually generating the dictionary is surprisingly hard. The first thing I tried is a prefix tree of all the suffixes. That is, given the following entries:&#xA;&#xA;bananalemonorange&#xA;You would have the following tree:&#xA;&#xA;b&#xA;&#xA;ba&#xA;&#xA;ban&#xA;&#xA;bana&#xA;&#xA;banan&#xA;&#xA;banana&#xA;a&#xA;&#xA;an&#xA;&#xA;ana&#xA;&#xA;anan&#xA;&#xA;anana&#xA;ang&#xA;&#xA;ange&#xA;n&#xA;&#xA;na&#xA;&#xA;nan&#xA;&#xA;nana&#xA;nag&#xA;&#xA;nage&#xA;l&#xA;&#xA;le&#xA;&#xA;lem&#xA;&#xA;lemo&#xA;&#xA;lemon&#xA;o&#xA;&#xA;or&#xA;&#xA;ora&#xA;&#xA;oran&#xA;&#xA;orang&#xA;&#xA;orange&#xA;r&#xA;&#xA;ra&#xA;&#xA;ran&#xA;&#xA;rang&#xA;&#xA;range&#xA;g&#xA;&#xA;ge&#xA;e&#xA;My idea was that this will allow me to easily find all the common substrings, and then rank them. But the problem is how do I select the appropriate entries that are actually useful? That is the part where I gave up my simple to follow and explain code and dived into the real science behind it. More on that in my next entry, but in the meantime, I would love it if someone could show me simple code to find the proper terms for the dictionary.</p>
        <a href="https://ayende.com/blog/167106/pretty-graphs-and-operational-concerns-in-ravendb-3-0" target="_blank"><h1 class="title mb-6">Pretty graphs and operational concerns in RavenDB 3.0</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 24, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">It has been a while since I have shown you some of the cool stuff that we have been doing with RavenDB 3.0.  Here is a quick taste:     We have turned a lot of the previously mysterious operational endpoints into pretty graphs, and you can see how the database is behaving in a pretty detailed way.</p>
        <a href="https://ayende.com/blog/167073/decompression-code-discussion" target="_blank"><h1 class="title mb-6">Decompression code &amp; Discussion</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 23, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">As I said, a good &amp; small interview question is this one, it is a good one because it is short, relatively simple to handle, but it should show a lot of things about your code. To start with, being faced with a non trivial task that most people are not that familiar with.  Implement a Decompress(Stream input, Stream output, byte[][] dictionary) routine for the following protocol: Prefix byte &#x2013; composed of the highest bit &#x2B; 7 bits len If the highest bit is not set, this is a uncompressed data, copy the next len from the input to the output. If the highest bit is set, this is compressed data, the next byte will be the index in the dictionary, copy len bytes from that dictionary entry to the output. I couldn&#x2019;t resist doing this myself, and I came up with the following:  public void Decompress(Stream input, Stream output, byte[][] dictionary)&#xA;{&#xA;    var tmp = new byte[128];&#xA;    while (true)&#xA;    {&#xA;        var readByte = input.ReadByte();&#xA;        if (readByte == -1)&#xA;            break;&#xA;            &#xA;        var prefix = (byte) readByte;&#xA;        var compressed = (prefix &amp; 0x80) != 0;&#xA;        var len = prefix &amp; 0x7f;&#xA;&#xA;        if (compressed == false)&#xA;        {&#xA;            while (len &gt; 0)&#xA;            {&#xA;                var read = input.Read(tmp, 0, len);&#xA;                if(read == 0)&#xA;                    throw new InvalidDataException(&quot;Not enough data to read from compressed input stream&quot;);&#xA;                len -= read;&#xA;                output.Write(tmp, 0, read);&#xA;            }&#xA;        }&#xA;        else&#xA;        {&#xA;            readByte = input.ReadByte();&#xA;            if(readByte == -1)&#xA;                throw new InvalidDataException(&quot;Not enough data to read from compressed input stream&quot;);&#xA;            output.Write(dictionary[readByte], 0, len);&#xA;        }&#xA;    }&#xA;}&#xA;&#xA;&#xA;Things to pay attention to: Low memory allocations, error handling, and handling of partial reads from the stream.&#xA;But that is just part of the question. After reading the protocol, and implementing it. The question now turns to what does the protocol says about this kind of compression scheme. The use of just 7 bits to store len drastically limit the compression utility in a general format. It also requires an external dictionary, which most compression formats don&#x2019;t use, they use the actual compressed text itself as the dictionary.&#xA0; Of course, I&#x2019;ve been reading compression algorithms for a while now, so that isn&#x2019;t that fair. But I would expect people to note that that 7 bit limits the compression usability.&#xA;And hopefully, with a bit of a hint, they should note that the external dictionary is useful for small data sets where the repetitions are actually between entry, not per entry.</p>
        <div class="button flex justify-between">
            <a href="260.html"><span class="back arrow"></span></a>

            <a href="262.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
</body>
</html>