
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 185 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-1841">
            <a href="https://andrewlock.net/running-async-tasks-on-app-startup-in-asp-net-core-part-1/" target="_blank">
                <h2 class="title mb-6" id="article-1841">Built in options for running async tasks</h2>
            </a>
            <p class="mb-2">by Andrew Lock</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 08, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Running async tasks on app startup in ASP.NET Core - Part 1</p>
        </article>
        <article id="article-1842">
            <a href="https://ayende.com/blog/185730-A/using-tls-with-rust-part-ii-client-authentication" target="_blank">
                <h2 class="title mb-6" id="article-1842">Using TLS with Rust</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 07, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The task that I have for now is to add client authentication via X509 client certificate. That is both obvious and non obvious, unfortunately. I&#x2019;ll get to that, but before I do so, I want to go back to the previous post and discuss this piece of code:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          fn new(cert_path: &amp;str, key_path: &amp;str, listen_uri: &amp;str) -&gt; Result&lt;Server, ConnectionError&gt; {&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              fn open_cert_file&lt;F,T&gt;(file: &amp;str, method: F) -&gt; Result&lt;Vec&lt;T&gt;, ConnectionError&gt; &#xA;        &#xA;        &#xA;          &#xA;                  where F : Fn(&amp;mut io::BufRead) -&gt; Result&lt;Vec&lt;T&gt;, ()&gt; {&#xA;        &#xA;        &#xA;          &#xA;                  let certfile = fs::File::open(file)?;&#xA;        &#xA;        &#xA;          &#xA;                  let mut reader = io::BufReader::new(certfile);&#xA;        &#xA;        &#xA;          &#xA;                  match method(&amp;mut reader) {&#xA;        &#xA;        &#xA;          &#xA;                      Err(_) =&gt; return Err(ConnectionError::failed_cert(file)),&#xA;        &#xA;        &#xA;          &#xA;                      Ok(certs) =&gt; match certs.len() {&#xA;        &#xA;        &#xA;          &#xA;                          0 =&gt; return Err(ConnectionError::failed_cert(file)),&#xA;        &#xA;        &#xA;          &#xA;                          _ =&gt; Ok(certs)&#xA;        &#xA;        &#xA;          &#xA;                      }&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              let mut config = rustls::ServerConfig::new(rustls::NoClientAuth::new());&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              let certs = open_cert_file(cert_path, rustls::internal::pemfile::certs)?;&#xA;        &#xA;        &#xA;          &#xA;              let key = open_cert_file(key_path, rustls::internal::pemfile::rsa_private_keys)&#xA;        &#xA;        &#xA;          &#xA;                          .or_else(|_| open_cert_file(key_path, rustls::internal::pemfile::pkcs8_private_keys))&#xA;        &#xA;        &#xA;          &#xA;                          .and_then(|keys| match keys.get(0){&#xA;        &#xA;        &#xA;          &#xA;                              None =&gt; Err(ConnectionError::failed_cert(key_path)),&#xA;        &#xA;        &#xA;          &#xA;                              Some(key) =&gt; Ok(key.clone())&#xA;        &#xA;        &#xA;          &#xA;                          })?;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              config.set_single_cert(certs, key)?;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              let listener = TcpListener::bind(listen_uri)?;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              Ok(Server { tls_config: Arc::new(config), tcp_listener: listener })&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          server.rs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;I&#x2019;ll admit that I&#x2019;m enjoying exploring Rust features, so I don&#x2019;t know how idiomatic this code is, but it is certainly dense. This basically does the setup for a TCP listener and setting up of the TLS details so we can accept a connection.Rust allows us to define local functions (inside a parent function), this is mostly just a way to define a private function, since the nested function has no access to the parent scope. The open_cert_file function is just a way to avoid code duplication, but it is an interesting one. It is a generic function that accepts an open ended function of its own. Basically, it will open a file, read it and then pass it to the function it was provided. There is some error handling, but that is pretty much it.The next fun part happens when we want to read the certs and key file. The certs file is easy, it can only ever appear in a single format, but the key may be either PKCS8 or RSA Private Key. And unlike the certs, where we expect to get a collection, we need to get just a single value. To handle that we have:First, we try to open and read the file as a RSA Private Key, if that isn&#x2019;t successful, we&#x2019;ll attempt to read it as PKCS8 file. If either of those attempts was successful, we&#x2019;ll try to get the first key, clone it and return.&#xA0; However, if there was an error in any part of the process, we abort the whole thing (and exit the function with an error).From my review of Rust code, it looks like this isn&#x2019;t non idiomatic code, although I&#x2019;m not sure I would call it idiomatic at this point.&#xA0; The problem with this code is that it is pretty fun to write, when you read it is obvious what is going on, but it is really hard to actually debug this. There is too much going on in too little space and it is not easy to follow in a debugger. The rest of the code is boring, so I&#x2019;m going to skip that and start talking about why client authentication is going to be interesting. Here is the core of the problem:In order to simplify my life, I&#x2019;m using the rustls&#x2019; Stream to handle transparent encryption and decryption. This is similar to how I would do it when using C#, for example. However, the stream interface doesn&#x2019;t have any way for me to handle this explicitly. Luckily, I was able to dive into the code and I think that given the architecture present, I can invoke the handshake manually on the ServerSession and then hand off the session as is to the stream.What I actually had to do was to setup client authentication here:And then manually complete the handshake first:And this is when I run into a problem, when trying to connect via my a client certificate, I got the following error:I&#x2019;m assuming that this is because rustls is actually verifying the certificate against PKI, which is not something that I want. I don&#x2019;t like to use PKI for this, instead, I want to register the allowed certificates thumbprints, but first I need to figure out how to make rustls accept any kind of client certificate. I&#x2019;m afraid that this means that I have to break out the debugger again and dive into the code to figure out where we are being rejected and why&#x2026;After a short travel in the code, I got to something that looks promising:This looks like something that I should be able to control to see if I like or dislike the certificate. Going inside it, it looks like I was right:I think that I should be able to write an implementation of this that would do the validation without checking for the issuer. However, it looks like my plan run into a snag, see:I&#x2019;m not sure that I&#x2019;m a good person to talk about the details of X509 certificate validation. In this case, I think that I could have done enough to validate that the cert is valid enough for my needs, but it seems like there isn&#x2019;t an way to actually provide another implementation of the ClientCertVerifier, because the entire package is private. I guess that this is as far as I can use rustls, I&#x2019;m going to move to the OpenSSL binding, which I&#x2019;m more familiar with and see how that works for me.Okay, I tried using the rust OpenSSL bindings, and here is what I got:So this is some sort of link error, and I could spend half a day to try to resolve it, or just give up on this for now. Looking around, it looks like there is also something called native-tls for Rust, so I might take a peek at it tomorrow.</p>
        </article>
        <article id="article-1843">
            <a href="https://www.meziantou.net/loading-stylesheets-asynchronously-using-a-taghelper-in-asp-net-core.htm" target="_blank">
                <h2 class="title mb-6" id="article-1843">Loading stylesheets asynchronously using a TagHelper in ASP.NET Core</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 07, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In a previous post, I&#x27;ve talked about inlining a CSS file in the html page. In term of performance, this is important to inline the critical CSS. However, the rest of the styles of the page doesn&#x27;t need to be downloaded immediately. For script elements, you can simply add the attribute async to ins</p>
        </article>
        <article id="article-1844">
            <a href="https://ayende.com/blog/185697-A/modeling-data-using-a-multi-model-database" target="_blank">
                <h2 class="title mb-6" id="article-1844">Modeling data using a multi model database</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 04, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Most developers have been weaned on relational modeling and have to make a non trivial mental leap when the times comes to model data in a non relational manner. That is hard enough on its own, but what happens when the data store that you use actually have multi model capabilities. As an industry, we are seeing more and more databases that take this path and offer multiple models to store and query the data as part of their core nature. For example, ArangoDB, CosmosDB, Couchbase, and of course, RavenDB.&#xA;RavenDB, for example, gives you the following models to work with:&#xA;&#xA;Documents (JSON) &#x2013; Multi master with any node accepting reads and writes.&#xA;&#xA;ACID transactions over multiple documents.&#xA;Simple / full text queries.&#xA;Map/Reduce and aggregation queries.&#xA;&#xA;Binary data &#x2013; Attachments to documents.&#xA;Counters (Map&lt;string, int64&gt;) &#x2013; CRDT multi master distributed counters.&#xA;Key/Value &#x2013; strong distributed consistency via Raft protocol.&#xA;Graph queries &#x2013; on top of the document model.&#xA;Revisions &#x2013; built in audit trail for documents&#xA;&#xA;With such a wealth of options, it can be confusing to select the appropriate tool for the job when you need to model your data. In this post, I aim to make sense of the options RavenDB offers and guide you toward making the optimal choices.&#xA;The default and most common model you&#x2019;ll use is going to be the document model. It is the one most appropriate for business data and you&#x2019;ll typically follow the Domain Driven Design approach for modeling your data and entities. In other words, we are talking about Aggregates, where each document is a whole aggregate. References between entities are either purely local to an aggregate (and document) or only between aggregates. In other words, a value in one document cannot point to a value in another document. It can only point to another document as a whole.&#xA;Most of your business logic will be focused on the aggregate level. Even when a single transaction modify multiple documents, most of the business logic is done at each aggregate independently. A good way to handle that is using Domain Events. This allow you to compose independent portions of your domain logic without tying it all in one big knot.&#xA;We talked about modifying documents so far, but a large part of what you&#x2019;ll do with your data is query and present it to users. In these cases, you need to make a conscious and explicit decision. Whatever your display model is going to be based on your documents or a different source. You can use RavenDB ETL to project the data out to a different database, changing its shape to the appropriate view model along the way. RavenDB ETL allow you to replicate a portion of the data in your database to another location, with the ability to modify the results as they are being sent. This can be a great tool to aid you in bridging the domain model and the view model without writing a lot of code.&#xA;This is useful for applications that have a high degree of complexity in their domain and business rules. For most applications, you can simply project the relevant data out at query time, but for more complex systems, you may want to have strict physical separation between your read model and the domain model. In such a scenario, Raven ETL&#xA0; can greatly simplify the task of facilitating the task of moving (and transforming) the data from the write side to the read side.&#xA;When it comes to modeling, we also need to take into account RavenDB&#x2019;s map/reduce indexes. These allow you to define aggregation that will run in the background, in other words, at query time, the work has already been done. This in turn leads to blazing fast aggregation queries and can be another factor in the design of the system. It is common to use map/reduce indexes to aggregation the raw data into a more usable form and work with the results. Either directly from the index or use the output collection feature to turn the results of the map/reduce index to real documents (which can be further indexes, aggregated, etc).&#xA;Thus far, we have only touched on document modeling, mind. There are a bunch of other options as well. We&#x2019;ll start from the simplest option, attachments. At its core, an attachment is just that. A way to attach some binary data to the document. As simple as it sounds, it has some profound implications from a modeling point of view. The need to store binary data somewhere isn&#x2019;t new, obviously and there have been numerous ways to resolve it. In a relational database, a varbinary(max) column is used. In a document database, I&#x2019;ve seen the raw binary data stored directly in the document (either as raw binary data or as BASE64 encoded value). In most cases, this isn&#x2019;t a really good idea. It blow up the size of the document (and the table) and complicate the management of the data. Storing the data on the file system lead to a different set of problems, coordinating transactions between the database and the file system, organizing the data, securing paths such as &#x201C;../../etc/passwd&#x201D;, backups and restore, and many more.&#xA;Attachments&#xA;These are all things that you want your database to handle for you. At the same time, binary data is related to but not part of the document. For those reasons, we use the attachment model in RavenDB. This is meant to be viewed just like attachments in email. The binary data is not stored inside the document, but it is strongly related to it. Common use cases for attachments include profile picture for a user&#x2019;s document, the signatures on a lease document, the excel spreadsheet with details about a loan for a payment plan document or the associated pictures from a home inspection report. A document can have any number of attachments, and an attachment can be of any size. This give you a lot of freedom to attach (pun intended) additional data to your documents without any hassle. Like documents, attachments also work in multi master mode and will be replicated across the cluster with the document.&#xA;Counters&#xA;While attachments can be any raw binary data and has only a name (and optional mime type) for structure, counters are far more strictly defined. A counter is&#x2026; well, a counter. It count things. On the most basic level, it is just a named 64 bits integer that is associated with a document. And like attachments, a document may have any number of such counters. But why is it important to have a 64 bits integer attached to the document? How could something so small can be important enough that we would need a whole new concept for it? After all, couldn&#x2019;t we just store the same counter more simply as a property inside the document?&#xA;To understand why RavenDB have counters, we need to understand what they aren&#x2019;t. The are related to the document, but not of the document. That means that an update to the counter is not going to modify the document as a whole. This, in turn, means that operations on the counters can be very cheap, regardless of how many counters you have in a document or how often you modify the counter. Having the counter separate from the document allow us to do several important things:&#xA;&#xA;Cheap updates&#xA;Distributed modifications&#xA;&#xA;In a multi master cluster, if any node can accept any write, you need to be aware of conflicts, when two updates to the same value were made on two disjoint servers. In the case of documents, RavenDB detect and resolve it according to the pre-defined policy. In the case of counters, there is no such need. A counter in RavenDB is stored using a CRDT. This is a format that allow us to handle concurrent modifications to the same value without losing data or expensive locks. This make counter suitable for for values that changes often. Good examples of counters is tracking views on a page or an ad, you can distribute the operations on a number of servers and still reach the correct final tally. This works both for increment and decrement, obviously.&#xA;Given that counters are basically just map&lt;string, int64&gt; you might expect that there isn&#x2019;t any modeling work to be done here, right? But it turns out that there is actually quite a bit that can be done even with that simple an interface. For example, when tracking views on a page or downloads for a particular package, I&#x2019;m interested not only in the total number of downloads, but also in the downloads per day. In such a case, whenever we want to note another download, we&#x2019;ll increment both the counter for overall download and another counter for downloads for that particular day. In other words, the name of the counter can hold meaningful information.&#xA;Key/Value&#xA;So far, all the data we have talked about were stored and accessed in a multi-master manner. In other words, we could chose any node in the cluster and make a write to it and it would be accepted. Data that is modified on multiple nodes at the same time would either be merged (counters), stored (attachments) or resolved (documents). This is great when you care about the overall availability of your system, we are always accepting writes and always proceed forward. But that isn&#x2019;t always the case, there are situations where you might need to have a higher degree of consistency in your operations. For example, if you are selling a fixed number of items, you want to be sure that two buyers hitting &#x201C;Purchase&#x201D; at the same time don&#x2019;t cause you problems just because their requests used different database servers.&#xA;In order to handle this situation, RavenDB offers the Cmp Xcng model. This is a cluster wide key/value store for your database, it allows you to store named values (integer, strings or JSON objects) in a consistent manner. This feature allow you to ensure consistent behavior for high value data. In fact, you can combine this feature with cluster wide transactions.&#xA;Cluster wide transactions allow you to combine operations on documents with Cmp Xcng ops to create a single consistent transaction. This mode enable you to perform conditional operations to modify your documents based on the globally consistent Cmp Xcng values.&#xA;A good example for Cmp Xcng values include pessimistic locks and their owners, to generate a cluster wide lock that is guaranteed to be consistent and safe regardless of what is going on with the cluster. Other examples can be to store global configuration for your system in all the nodes in the cluster.&#xA;Graph Queries&#xA;Graph data stores are used to hold data about nodes and the edges between them. They are a great tool to handle tasks such as social network, data mining and finding patterns in large datasets. RavenDB, as of release 4.2, has support for graph queries, but it does so in a novel manner. A node in RavenDB is a document, quite naturally, but unlike other features, such as attachments and counters, edges don&#x2019;t have separate physical existence. Instead, RavenDB is able to use the document structure itself to infer the edges between documents. This dynamic nature means that when the time comes to apply graph queries on top of your existing database, you don&#x2019;t have to do a lot of prep work. You can start issuing graph queries directly, and RavenDB will work behind the scenes to make sure that all the data is found, and quickly, too.&#xA;The ability to perform graph queries on your existing document structure is a powerful one, but it doesn&#x2019;t alleviate the need to model your data properly to best take advantage of this. So what does this mean, modeling your data to be usable both in a document form and for graph operations? Usually, when you need to model your data in a graph manner, you think mostly in terms of the connection between the nodes.&#xA;One way of looking at graph modeling in RavenDB is to be explicit about the edges, but I find this awkward and limiting. It is usually better to express the domain model naturally and allow the edges to pop up from the underlying data as you work with it. Edges in RavenDB are properties (or nested objects) that contain a reference to another document. If the edge in a nested object, then all the properties of the object are also the properties on the edge and can be filtered upon.&#xA;For best results, you want to model your edge properties as a single nested object that can be referred to explicitly. This is already a best practice when modeling your data, for better cohesiveness, but graph queries make this a requirement.&#xA;Unlike other graph databases, RavenDB isn&#x2019;t limited to just graph representation. A graph queries in RavenDB is able to utilize the full power of RavenDB queries, which means that you can start your graph operation with a spatial query and then proceed to the rest of the graph pattern match. You should aim to do most of the work in the preparatory queries and not spend most of the time in graph operations.&#xA;A common example of graph operation is fraud detection, with graph queries to detect multiple orders made using many different credit card for the same address. Instead of trying to do the matches using just graph operations, we can define a source query on a map/reduce index that would aggregate all the results for orders on the same address. This would dramatically cut down on the amount of work that the database is required to do to answer your queries.&#xA;Revisions&#xA;The final topic that I want to discuss is this (already very long) post is the notion of Revisions. RavenDB allow the database administrator to define a revisions policy, in which case RavenDB will maintain, automatically and transparently, an immutable log of all changes on documents. This means that you have a built-in audit trail ready for use if you need to. Beyond just having an audit trail, revisions are also very important feature in several key capabilities in RavenDB.&#xA;For example, using revisions, you can get the tuple of (previous, current) versions of any change made in the database using subscriptions. This allow you to define some pretty interesting backend processes, which have full visibility to all the changes that happen to the document over time. This can be very interesting in regression analysis, applying business rules and seeing how the data changes over time.&#xA;Summary&#xA;I tried to keep this post at a high level and not get bogged down in the details. I&#x2019;m probably going to have a few more posts about modeling in general and I would appreciate any feedback you may have or any questions you can raise.</p>
        </article>
        <article id="article-1845">
            <a href="https://ardalis.com/bulk-delete-old-and-big-gmail-email/" target="_blank">
                <h2 class="title mb-6" id="article-1845">Bulk Delete Old and Big GMail Email</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 04, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">My GMail is complaining it&#x27;s running out of space. I remember the days when GMail would show an ever-increasing counter of how much more&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-1846">
            <a href="https://ayende.com/blog/185731-A/reminder-ill-be-in-codemash-is-next-week" target="_blank">
                <h2 class="title mb-6" id="article-1846">Reminder</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 03, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Next week is CodeMash, in Ohio. I&#x2019;m going to be at the conference and I have a talk about extreme performance architecture. I&#x2019;m going to try to condense in 45 minutes the lessons that took us a decade to learn and almost two years to implement. That should be fun, but as much as I enjoy speaking, it is the first time in a while that I&#x2019;m actually going to go to a conference, not just be there at the booth, and that is really exciting for me.I took a look at the schedule and there are some interesting workshops and sessions. Without any particular order, here are the things that popped out as stuff that I would like to be atBTW, to the CodeMash people, not being able to link directly to the sessions is a PITA.Workshops:Up &amp; Running with Graph Databases - Greg Jordan &#x2013; I would love to get a feel to how things are looking from the side consuming the graph API, not the one implementing it. If all goes well, I might do a series of posts on the exercises in the workshop as it pertains to RavenDB.CodeMash CryptoParty - Dusty Burwell &#x2013; I have a love/hate relationship with cryptography. I find it fascinating but the math is usually beyond me,&#xA0; so I can&#x2019;t understand it (that&#x2019;s a joke).Sessions:Making and Baking an Application Security Department - Bill Sempf &#x2013; Following up on the crypto party, this is an are that I care deeply about, so it is worth the 8AM timeslot to learn more about this. I&#x2019;m also interested in how I can, as an infrastructure, meaningfully contribute to the application overall security.7 Reasons why your microservices should use Event Sourcing &amp; CQRS - Hugh McKee &#x2013; I&#x2019;m familiar with both CQRS and microservices, but putting them together seems interesting. I&#x2019;m mostly wondering about the data flow paths in such a system as the data is required on multiple servers.&quot;Did you get my message?&quot; - A comparison of several modern messaging platforms - Jack Bennett &#x2013; This is very close to what I usually do, and I went over ZeroMQ&#x2019;s code a few time, so that would be interesting.Building a better audit log - Craig Hills &#x2013; this is a pain point in many cases, what to log and how, and the tension between logging too much and too little.Database DevOps with Containers - Rob Richardson &#x2013; I think that my interest in this one is pretty obvious .Bluetooth Prototyping with the Raspberry Pi &#x2013; I&#x2019;m using my Raspberry Pis to run clusters of database servers, I wonder if there are other possible uses for a 25$ machine&#x2026;&#xA;Extreme Performance Architecture - Oren Eini &#x2013; I&#x2019;m giving this talk, so I guess I gotta. Pivot: How to proceed when things don&#x27;t work out - Jay Harris &#x2013; This is in the same timeslot as I&#x2019;m speaking at, but I would have like to listen to it. Failure, planning for failure and recovering from it are all very important skills.ZAPping Security Vulnerabilities in Your Development Pipeline - Matthew Smith &#x2013; This seems like it would be a session that cover an eminently useful skill.My users posted what? - Harold Pulcher &#x2013; I don&#x2019;t have a direct use for the topics discussed here, but it seems interesting, and I like learning for leaning sake. At some future time, it always pays off.APIs on the Scale of Decades - Gary Fleming - RavenDB is ten years old, and I&#x2019;m certainly feeling the pressure there.THE STORIES OF THE MOST INFAMOUS BUGS - Ian Zelikman &#x2013; Because who doesn&#x2019;t want to see a clown slip on a banana peel, and this is the high tech equivalent. Data management in a Microservices world - Gerald Venzl &#x2013; This is a topic that I have been thinking a lot about, and more information there would be very useful.Patterns and Architectures Beyond Microservices - Stephen Shary &#x2013; should be interesting, some of the patterns that are mentioned in the description aren&#x2019;t known to me and I have to exert some willpower not to search for them and wait for the session.Post Mortem: Dealing with Failure in Development - BJ Burns &#x2013; Already said that this is an important topic, so this session is also very intereseting.Building A Highly Scalable Service that Survived A Super Bowl - Keith Elder &#x2013; Because if nothing else, the story is likely going to be awesome.Comments are Useless and Other Controversial Opinions About Code - Izzi Bikun &#x2013; This sounds like a fun session.There are a lot of other stuff there that looks good, and I don&#x2019;t even know if I&#x2019;ll be able to get through all these sessions (not actually possible, there are timing conflicts between some of them). But the point of the conference isn&#x2019;t just to sit in the sessions but the hallway interactions and actually talking with people.I&#x2019;m looking forward to that and I&#x2019;m bringing a few books and some swag as well, if anyone is there and is interested. I&#x2019;m really looking forward to it.</p>
        </article>
        <article id="article-1847">
            <a href="https://ayende.com/blog/185698-A/using-tls-with-rust-part-i" target="_blank">
                <h2 class="title mb-6" id="article-1847">Using TLS with Rust</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 02, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The next interesting step in my Rust network protocol exercise is to implement TLS. I haven&#x2019;t looked at that yet, so it is going to be interesting.The first search for &#x201C;Rust TLS&#x201D; gives me the rustls project, which seems to provide a native Rust implementation. There are also native-tls, which uses the system TLS library and binding for OpenSSL. I&#x2019;m not sure how trust worthy rustls is, but I&#x2019;m building a network protocol that is meant as an exercise, so I don&#x2019;t really care. The first thing that I wanted to write was pretty trivial. Just convert the current code to use TLS on the wire, nothing more. I wrote the following code to set things up:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          fn new(cert_path: &amp;str, key_path: &amp;str, listen_uri: &amp;str) -&gt; Result&lt;Server, ConnectionError&gt; {&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              fn open_cert_file&lt;F,T&gt;(file: &amp;str, method: F) -&gt; Result&lt;Vec&lt;T&gt;, ConnectionError&gt; &#xA;        &#xA;        &#xA;          &#xA;                  where F : Fn(&amp;mut io::BufRead) -&gt; Result&lt;Vec&lt;T&gt;, ()&gt; {&#xA;        &#xA;        &#xA;          &#xA;                  let certfile = fs::File::open(file)?;&#xA;        &#xA;        &#xA;          &#xA;                  let mut reader = io::BufReader::new(certfile);&#xA;        &#xA;        &#xA;          &#xA;                  match method(&amp;mut reader) {&#xA;        &#xA;        &#xA;          &#xA;                      Err(_) =&gt; return Err(ConnectionError::failed_cert(file)),&#xA;        &#xA;        &#xA;          &#xA;                      Ok(certs) =&gt; match certs.len() {&#xA;        &#xA;        &#xA;          &#xA;                          0 =&gt; return Err(ConnectionError::failed_cert(file)),&#xA;        &#xA;        &#xA;          &#xA;                          _ =&gt; Ok(certs)&#xA;        &#xA;        &#xA;          &#xA;                      }&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              let mut config = rustls::ServerConfig::new(rustls::NoClientAuth::new());&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              let certs = open_cert_file(cert_path, rustls::internal::pemfile::certs)?;&#xA;        &#xA;        &#xA;          &#xA;              let key = open_cert_file(key_path, rustls::internal::pemfile::rsa_private_keys)&#xA;        &#xA;        &#xA;          &#xA;                          .or_else(|_| open_cert_file(key_path, rustls::internal::pemfile::pkcs8_private_keys))&#xA;        &#xA;        &#xA;          &#xA;                          .and_then(|keys| match keys.get(0){&#xA;        &#xA;        &#xA;          &#xA;                              None =&gt; Err(ConnectionError::failed_cert(key_path)),&#xA;        &#xA;        &#xA;          &#xA;                              Some(key) =&gt; Ok(key.clone())&#xA;        &#xA;        &#xA;          &#xA;                          })?;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              config.set_single_cert(certs, key)?;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              let listener = TcpListener::bind(listen_uri)?;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              Ok(Server { tls_config: Arc::new(config), tcp_listener: listener })&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          server.rs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;There is a lot going on and I spend some time figuring out exactly what needs to be done here. I&#x2019;m kinda proud / kinda scared of this code. It is packed. But on the other hand, if you read it, it is fairly clear, it is just that it does a lot of stuff.I then used this in the following way:And that led to this error when using OpenSSL to connect to it:On the rust side, it died with:The good thing, both sides agree that there is a handshake issue, but I had no idea what was going on. The bad thing, I have no clue why this is failing. According to the docs, this is supposed to work. I tried debugging into rustls and it seems to be failing very early in the handshake process, but I&#x2019;m not familiar enough with either Rust or TLS to really understand why. The core issues seems to be here:Note that we get a payload of None, but when I&#x2019;m debugging through the code in the read_version method, it seems like it returns properly.Oh, I figured it out, the issue is here:Note the highlighted section? If this returns a None, it will silently return from the method. It is easy to miss something like that. Digging (much) deeper, I found:And deeper still, we have:Go back a bit and see what kind of URL I gave to OpenSSL, it was 127.0.0.1, and it seems like rustls doesn&#x2019;t support raw IPs, only hostnames. The limit seems to be the result of this code:This seems to be a known error, it is opened since May 2017 and it is a completely deal breaker for me. I&#x2019;m guessing that this isn&#x2019;t a big issue in general because usually if you have a cert, it is for a hostname and certificates for IPs (which exists, but tend to be issued for private CAs) are far rarer.I changed my cmd line to use:And it started working, but at that point, I was debugging this issue for over an hour, so that is quite enough for today.As an aside, I was able to attach to the rust process using Visual Studio and debug it fairly normally. There is some weirdness that I believe relates to the cleanup, where if you abort a method early it looks like it goes back in time until it exit the method. However, overall it works fairly nicely. I do have to point out that many of the nicer features in the language are making debugging much harder.That said, once thing was absolutely amazing and it was the fact that I was so easily debug into my dependencies, in fact, I was changing the code of my dependencies and re-running it, to help me narrow down exactly where the error was. That was easy, obvious and worked. Very nice!</p>
        </article>
        <article id="article-1848">
            <a href="https://ardalis.com/becoming-a-developer-team-force-multiplier/" target="_blank">
                <h2 class="title mb-6" id="article-1848">Becoming a Developer Team Force Multiplier</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 02, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I have clients who describe me and my team as a &quot;force multiplier&quot; for their development organization. What does this mean, and how can it&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-1849">
            <a href="https://andrewlock.net/using-dependency-injection-with-twilio-sms-and-asp.net-core-2-1/" target="_blank">
                <h2 class="title mb-6" id="article-1849">Using dependency injection with Twilio SMS and ASP.NET Core 2.1</h2>
            </a>
            <p class="mb-2">by Andrew Lock</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 02, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post, I describe how to create a custom ITwilioRestClient, register it with the DI container, and inject it into an MVC controller.&#x2026;</p>
        </article>
        <article id="article-1850">
            <a href="https://ayende.com/blog/185665-A/writing-my-network-protocol-in-rust" target="_blank">
                <h2 class="title mb-6" id="article-1850">Writing my network protocol in Rust</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 01, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">After spending a lot of time writing my network protocol in C, I decided that it would be a nice exercise to do the same in Rust. I keep getting back to this language because I want to like it. I hope that having a straightforward task and the passage of time will make things easier than before.&#xA;I gotta say, the compiler feels a lot nicer now. Check this out:&#xA;&#xA;I really like it. This feels like the compiler is actively trying to help me get in the right path&#x2026;&#xA;And this error message made me even happier:&#xA;&#xA;Thank you, this is clear, concise and to the point.&#xA;I can indeed report that the borrow checker is indeed very much present, but at least now it will tell you what is the magic incantation you need to make it happen:&#xA;&#xA;This is my third or forth foray into Rust, and I stopped a few times before because the learning curve and the&#x2026; Getting Things Done curve were just weren&#x2019;t there for me. In this case, however, I&#x2019;m getting a very different feel all around. There is a lot less messing around and a lot more actually getting to where I want to go. I&#x2019;m still significantly slower, naturally, since I&#x2019;m learning idioms and the mechanics of the language, but there is a lot less friction. And the documentation has been top notch, and I&#x2019;m leaning on that a lot.&#xA;In particular, one of my pet peeves seems to have been resolved. Composite error handling is now as simple as:&#xA;&#xA0;&#xA;&#xA;&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          extern crate custom_error;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          custom_error! {&#xA;        &#xA;        &#xA;          &#xA;              ConnectionError&#xA;        &#xA;        &#xA;          &#xA;              Io{source: io::Error} = &quot;unable to read from the network&quot;,&#xA;        &#xA;        &#xA;          &#xA;              Utf8{source: std::str::Utf8Error} = &quot;Invalid UTF8 character sequence&quot;,&#xA;        &#xA;        &#xA;          &#xA;              Parse{origin: String} = &quot;Unable to parse command: {origin}&quot;&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          impl ConnectionError {&#xA;        &#xA;        &#xA;          &#xA;              fn parsing(origin: &amp;str) -&gt; ConnectionError {&#xA;        &#xA;        &#xA;          &#xA;                  ConnectionError::Parse{ origin: origin.to_string() }&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          errors.rs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;&#xA;&#xA;Removing the ceremony from error handling is a great relief, I have to say.&#xA;It took me a couple of evenings to get to the point where I can setup a TCP server, accept a connection and parse the command. Let me see if I can break it up to manageable parts, even though the whole thing is about 100 lines of code, this is packed.&#xA;I&#x2019;m certainly feeling the fact that Rust actually have a runtime library. I mean, C has one, but it is pretty anemic to say the least. And actually having an OOTB solution for packaging is not really an option today, it is a baseline requirement.&#xA;Here is the code that handles the connection itself.&#xA;&#xA;&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          fn handle_connection(mut stream: TcpStream) -&gt; Result&lt;(), ConnectionError&gt; {&#xA;        &#xA;        &#xA;          &#xA;              stream.write(b&quot;OK\r\n&quot;)?;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              let mut cmd_buffer = Vec::new();&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              loop {&#xA;        &#xA;        &#xA;          &#xA;                  let consumed_bytes = { &#xA;        &#xA;        &#xA;          &#xA;                      let msg = read_full_message(&amp;stream, &amp;mut cmd_buffer)?;&#xA;        &#xA;        &#xA;          &#xA;                      let cmd_str = std::str::from_utf8(msg)?;&#xA;        &#xA;        &#xA;          &#xA;                      let cmd = parse_cmd(&amp;cmd_str)?;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                      dispatch_cmd(&amp;stream, cmd)?;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                      msg.len()&#xA;        &#xA;        &#xA;          &#xA;                  };&#xA;        &#xA;        &#xA;          &#xA;                  cmd_buffer.drain(0 .. consumed_bytes);&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          conn.rs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;&#xA;&#xA;By itself, it is pretty simple. It starts by letting the client know that we are ready (the OK msg) and then read a message from the client, parse it and dispatch it. Rinse, repeat, etc.&#xA;There are a couple of interesting things going on here that might be worth your attention:&#xA;&#xA;The read_full_message() function works on bytes, and it is responsible for finding the message boundaries. The code is meant to handle pipelined messages, partial reads, etc.&#xA;Once we have the range of bytes that represent a single message, we translate them to UTF8 string and use string processing to parse the command. This is simpler than the tokenization we did in C.&#xA;After processing a message, we drain the data we already process and continue with the data already in the buffer. Note that we basically reuse the same buffer, so hopefully there shouldn&#x2019;t be too many allocations along the way.&#xA;&#xA;The buffer handling is the responsibility of the read_full_message() function, which looks like:&#xA;&#xA;&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          lazy_static! {&#xA;        &#xA;        &#xA;          &#xA;              static ref msg_break : TwoWaySearcher&lt;&#x27;static&gt; = {&#xA;        &#xA;        &#xA;          &#xA;                  TwoWaySearcher::new(&quot;\r\n\r\n&quot;.as_bytes())&#xA;        &#xA;        &#xA;          &#xA;              };&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          fn read_full_message&lt;&#x27;a&gt;(mut stream: &amp;TcpStream, buffer: &amp;&#x27;a mut Vec&lt;u8&gt;) -&gt; Result&lt;&amp;&#x27;a [u8], ConnectionError&gt; {&#xA;        &#xA;        &#xA;          &#xA;              let mut to_scan = 0;&#xA;        &#xA;        &#xA;          &#xA;              let mut tmp_buf = [0; 256];&#xA;        &#xA;        &#xA;          &#xA;              loop {&#xA;        &#xA;        &#xA;          &#xA;                  match msg_break.search_in(&amp;buffer[to_scan..]) {&#xA;        &#xA;        &#xA;          &#xA;                      None =&gt; to_scan = min(buffer.len() - 3, 0),&#xA;        &#xA;        &#xA;          &#xA;                      Some(msg_end) =&gt; return Ok(&amp;buffer[0..(to_scan &#x2B; msg_end)])&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;                  let read = stream.read(&amp;mut tmp_buf)?;&#xA;        &#xA;        &#xA;          &#xA;                  if read &#x2B; buffer.len() &gt; 8192 {&#xA;        &#xA;        &#xA;          &#xA;                      return Err(ConnectionError::MessageTooBig)&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;                  buffer.extend_from_slice(&amp;tmp_buf[0..read]);&#xA;        &#xA;        &#xA;          &#xA;              }   &#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          read_msg.rs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;&#xA;&#xA;I&#x2019;m using an inefficient method, where I&#x2019;m reading only 256 bytes at a time from the network, mostly to prove that I can process things that come over in multiple calls. But the basic structure is simple:&#xA;&#xA;Use TwoWaySearcher to search for a byte pattern in the buffer. This is basically memmem() call.&#xA;If the byte pattern (\r\n\r\n) is found, we have a message boundary and can return that to the caller.&#xA;If the message boundary isn&#x2019;t found, we need to read more data from the network.&#xA;I&#x2019;m playing some tricks with the to_scan variable, avoiding the case where I need to scan over data that I have already scanned.&#xA;I&#x2019;m also validating that I&#x2019;m never reading too much from the network and abort the connection if we can&#x2019;t find the message boundary in a reasonable size (8KB).&#xA;&#xA;What remains is some string parsing, which ended up being really easy, since Rust has normal string processing routines.&#xA;&#xA;&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          struct Cmd&lt;&#x27;a&gt; {&#xA;        &#xA;        &#xA;          &#xA;              args: Vec&lt;&amp;&#x27;a str&gt;,&#xA;        &#xA;        &#xA;          &#xA;              headers: HashMap&lt;&amp;&#x27;a str, &amp;&#x27;a str&gt;,&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          fn parse_cmd&lt;&#x27;a&gt;(cmd_str: &amp;&#x27;a str) -&gt; Result&lt;Cmd, ConnectionError&gt; {&#xA;        &#xA;        &#xA;          &#xA;              let mut lines = cmd_str.lines();&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              let cmd_line = match lines.next() {&#xA;        &#xA;        &#xA;          &#xA;                  None =&gt; {&#xA;        &#xA;        &#xA;          &#xA;                      return Err(ConnectionError::parsing(cmd_str));&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;                  Some(v) =&gt; v,&#xA;        &#xA;        &#xA;          &#xA;               };&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              let mut cmd = Cmd {&#xA;        &#xA;        &#xA;          &#xA;                  args: cmd_line.split(&#x27; &#x27;).collect(),&#xA;        &#xA;        &#xA;          &#xA;                  headers: HashMap::new(),&#xA;        &#xA;        &#xA;          &#xA;              };&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              for line in lines {&#xA;        &#xA;        &#xA;          &#xA;                  let parts: Vec&lt;&amp;str&gt; = line.splitn(2, &#x27;:&#x27;).collect();&#xA;        &#xA;        &#xA;          &#xA;                  if parts.len() != 2 {&#xA;        &#xA;        &#xA;          &#xA;                      return Err(ConnectionError::parsing(line));&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;                  cmd.headers.insert(parts[0].trim(), parts[1].trim());&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              Ok(cmd)&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          cmd.rs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;&#xA;&#xA;And this is pretty much it, I gotta say. For that amount of code, it took a long time to get there, but I&#x2019;m pretty happy with the state of the code. Of course, this is still pretty early in the game and it isn&#x2019;t really doing anything really interesting. The TCP server can accept only a single connection (breaking the connection will kill the server, at this point), error handling is the same as not having a single catch in the entire system, etc.&#xA;What I expect to be&#x2026; interesting is the use of SSL and concurrent (hopefully async) I/O. We&#x2019;ll see where that will take us&#x2026;</p>
        </article>
        <div class="button flex justify-between">
            <a href="184.html"><span class="back arrow"></span></a>

            <a href="186.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>