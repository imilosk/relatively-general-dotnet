
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 2 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-11">
            <a href="https://ayende.com/blog/203363-C/using-ai-for-candidate-ranking-with-ravendb" target="_blank">
                <h2 class="title mb-6" id="article-11">Using AI for candidate ranking with RavenDB</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 10, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Hiring the right people is notoriously difficult.I have been personally involved in hiring decisions for about two decades, and it&#xA0;is an unpleasant process. You deal with an utterly overwhelming influx of applications, often from&#xA0;candidates using the &#x201C;spray and pray&#x201D; approach of applying to all&#xA0;jobs.At one point, I got the resume of a divorce lawyer&#xA0;in response to a job posting for a backend engineer role. I was curious enough to follow up on that, and no, that lawyer didn&#x2019;t want to change careers. He was interested in being&#xA0;a divorce lawyer. What kind of clients would want their divorce handled by a database company, I refrained from asking.Companies often resort to expensive external agencies to sift through countless candidates.In the age of AI and LLMs, is that still the case? This post will demonstrate how to build an intelligent candidate screening process using RavenDB and modern AI, enabling you to efficiently accept applications, match them to appropriate job postings, and make an initial go/no-go decision for your recruitment pipeline.We&#x2019;ll start our process by defining a couple of open positions:Staff Engineer, Backend &amp; DevOpsSenior Frontend Engineer (React/TypeScript/SaaS)Here is what this looks like at the database level:Now, let&#x2019;s create a couple of applicants for those positions. We have James &amp; Michael, and they look like this:Note that we are not actually doing a lot here in terms of the data we ask the applicant to provide. We mostly gather the contact information and ask them to attach their resume. You can see the resume attachment in RavenDB Studio. In the above screenshot, it is in the right-hand Attachments pane of the document view.Now we can use RavenDB&#x2019;s new Gen AI attachments feature. I defined an OpenAI connection with gpt-4.1-mini&#xA0;and created a Gen AI task to read &amp; understand the resume. I&#x2019;m assuming that you&#x2019;ve read my post about Gen AI in RavenDB, so I&#x2019;ll&#xA0;skip going over the actual setup.The key is that I&#x2019;m applying the following context extraction script to the Applicants collection:const resumePdf = loadAttachment(&quot;resume.pdf&quot;);&#xD;&#xA;if(!resumePdf) return;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;ai.genContext({name: this.applicantName})&#xD;&#xA;    .withPdf(resumePdf);When I test this script on James&#x2019;s document, I get:Note that we have the attachment in the bottom right - that will also&#xA0;be provided to the model. So we can now write the following prompt for the model:You are an HR data parsing specialist. Your task is to analyze the provided CV/resume content (from the PDF) &#xD;&#xA;and extract the candidate&#x27;s professional profile into the provided JSON schema.&#xD;&#xA;In the requiredTechnologies object, every value within the arrays (languages, frameworks_libraries, etc.) must be a single, &#xD;&#xA;distinct technology or concept. Do not use slashes (/), commas, semicolons, or parentheses () to combine items within a single string. Separate combined concepts into individual strings (e.g., &quot;Ruby/Rails&quot; becomes &quot;Ruby&quot;, &quot;Rails&quot;).We also ask the model to respond with an object matching the following sample:{&#xD;&#xA;  &quot;location&quot;: &quot;The primary location or if interested in remote option (e.g., Pasadena, CA or Remote)&quot;,&#xD;&#xA;  &quot;summary&quot;: &quot;A concise overview of the candidate&#x27;s history and key focus areas (e.g., Lead development of data-driven SaaS applications focusing on React, TypeScript, and Usability).&quot;,&#xD;&#xA;  &quot;coreResponsibilities&quot;: [&#xD;&#xA;    &quot;A list of the primary duties and contributions in previous roles.&quot;&#xD;&#xA;  ],&#xD;&#xA;  &quot;requiredTechnologies&quot;: {&#xD;&#xA;    &quot;languages&quot;: [&#xD;&#xA;      &quot;Key programming and markup languages that the candidate has experience with.&quot;&#xD;&#xA;    ],&#xD;&#xA;    &quot;frameworks_libraries&quot;: [&#xD;&#xA;      &quot;Essential UI, state management, testing, and styling libraries.&quot;&#xD;&#xA;    ],&#xD;&#xA;    &quot;tools_platforms&quot;: [&#xD;&#xA;      &quot;Version control, cloud platforms, build tools, and project management systems.&quot;&#xD;&#xA;    ],&#xD;&#xA;    &quot;data_storage&quot;: [&#xD;&#xA;      &quot;The database technologies the candidate is expected to work with.&quot;&#xD;&#xA;    ]&#xD;&#xA;  }&#xD;&#xA;}Testing this on James&#x2019;s applicant document results in the following output:I actually had to check where the model got the &#x201C;LA Canada&#x201D; issue. That shows up&#xA0;in the real resume PDF, and it is a real place. I triple-checked, because I was sure this was a hallucination at first &#x263A;&#xFE0F;.The last thing we need to do is actually deal with the model&#x2019;s output. We use an update script to apply the model&#x2019;s output to the document. In this case, it is as simple as just storing it in the source document:this.resume = $output;And here is what the output looks like:Reminder: Gen AI tasks in RavenDB use a three-stage approach:Context extraction script - gets data (and attachment) from the source document to provide to the model.Prompt &amp; Schema - instructions for the model, telling it what it should do&#xA0;with the provided context and how it should format the output.Update script - takes the structured output from the model and applies it back to the source document.In our case, this process starts with the applicant uploading their CV, and then we have the Read Resume&#xA0;task running. This parses the PDF and puts the result in the document, which is great, but it is only part of the process.We now have the resume contents in a structured format, but we need to evaluate&#xA0;the candidate&#x2019;s suitability for all the positions they applied for. We are going to do that using the model again, with a new Gen AI task.We start by defining the following context extraction script:// wait until the resume (parsed CV) has been added to the document&#xD;&#xA;if (!this.resume) return; &#xD;&#xA;&#xD;&#xA;&#xD;&#xA;for(const positionId of this.targetPosition) {&#xD;&#xA;    const position = load(positionId);&#xD;&#xA;    if(!position) continue;&#xD;&#xA;    ai.genContext({&#xD;&#xA;        position,&#xD;&#xA;        positionId,&#xD;&#xA;        resume: this.resume&#xD;&#xA;    })&#xD;&#xA;}Note that this relies on the resume field that we created in the previous task. In other words, we set things up in such a way that we run this task after&#xA0;the Read Resume&#xA0;task, but without needing to put them in an explicit pipeline or manage their execution order.Next, note that we output multiple contexts for the same document. Here is what this looks like for James, we have two separate&#xA0;contexts, one for each position James applied for:This is important because we want to process each position and resume independently. This avoids context leakage from one position to another. It also lets us process multiple positions for the same applicant concurrently.Now, we need to tell the model what it is supposed to do:You are a specialized HR Matching AI. Your task is to receive two structured JSON objects &#x2014; one describing a Job Position and one &#xD;&#xA;summarizing a Candidate Resume &#x2014; and evaluate the suitability of the resume for the position.&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;Assess the overlap in jobTitle, summary, and coreResponsibilities. Does the candidate&#x27;s career trajectory align with the role&#x27;s needs (e.g., has matching experience required for a Senior Frontend role)?&#xD;&#xA;Technical Match: Compare the technologies listed in the requiredTechnologies sections. Identify both direct matches (must-haves) and gaps (missing or weak areas). Consider substitutions such as js or ecmascript to javascript or node.js. &#xD;&#xA;&#xD;&#xA;&#xD;&#xA;Evaluate if the candidate&#x27;s experience level and domain expertise (e.g., SaaS, Data Analytics, Mapping Solutions) meet or exceed the requirements.And the output schema that we want to get from the model is:{&#xD;&#xA;  &quot;explanation&quot;: &quot;Provide a detailed analysis here. Start by confirming the high-level match (e.g., &#x27;The candidate is an excellent match because...&#x27;). Detail the strongest technical overlaps (e.g., React, TypeScript, Redux, experience with BI/SaaS). Note any minor mismatches or significant overqualifications (e.g., candidate&#x27;s deep experience in older technologies like ASP.NET classic is not required but demonstrates full-stack versatility).&quot;,  &quot;isSuitable&quot;: false&#xD;&#xA;}Here I want to stop for a moment and talk about what exactly we are doing here. We could&#xA0;ask the model just to judge whether an applicant is suitable for a position and save a bit on the number of tokens we spend. However, getting just a yes/no response from the model is not something I recommend.There are two primary reasons why we want the explanation field as well. First, it serves as a good check on the model itself. The order&#xA0;of properties matters in the output schema. We first ask the model to explain itself, then to render the verdict. That means it is going to be more focused. The other reason is a bit more delicate. You may be required&#xA0;to provide an explanation to the applicant if you reject them. I won&#x2019;t necessarily put this exact justification in the rejection letter to the applicant, but it is something that is quite important to retain in case you need to provide it later.Going back to the task itself, we have the following update script:this.suitability = this.suitability || {};&#xD;&#xA;this.suitability[$input.positionId] = $output;Here we are doing something quite interesting. We extracted the positionId&#xA0;at the start of this process, and we are using it to associate the output from the model with the specific position we are currently evaluating.Note that we are actually evaluating multiple positions for the same applicant at the same time, and we need to execute this update script for each&#xA0;of them. So we need to ensure that we don&#x2019;t overwrite previous work. I&#x2019;m not mentioning this in detail because I covered it in my previous Gen AI post, but it is important to note that we have two&#xA0;tasks sourced from the same document. RavenDB knows how to handle the data being modified by both tasks without triggering an infinite loop. It seems like a small thing, but it is the sort of thing that not&#xA0;having to worry about really simplifies the whole process.With these two tasks, we have now set up a complete pipeline for the initial processing of applicants to open positions. As you can see here:This sort of process allows you to integrate into your system stuff that, until recently, looked like science fiction. A pipeline like the one above is not something you could just build before, but now you can spend a few hours and have this capability ready to deploy.Here is what the tasks look like inside RavenDB:And the final applicant document after all of them have run is:You can see the metadata for the two tasks (which we use to avoid going to the model again when we don&#x2019;t have to), as well as the actual outputs of the model (resume, suitability&#xA0;fields).A few more notes before we close this post. I chose to use two GenAI tasks here, one to read the resume and generate the structured output, and the second to actually evaluate the applicant&#x2019;s suitability.From a modeling perspective, it is easier to split this into distinct steps. You can&#xA0;ask the model to both read the resume and evaluate suitability in a single shot, but I find that it makes it harder to extend the system down the line.Another reason you want to have different tasks for this is that you can use different&#xA0;models for each one. For example, reading the resume and extracting the structured output is something you can run on gpt-4.1-mini&#xA0;or gpt-5-nano,&#xA0;while evaluating applicant suitability can make use of a smarter model.I&#x2019;m really happy with the new RavenDB AI integration features. We got some early feedback that is really&#xA0;exciting, and I&#x2019;m looking forward to seeing what you can do with them.</p>
        </article>
        <article id="article-12">
            <a href="https://devblogs.microsoft.com/dotnet/preparing-for-dotnet-10-gc/" target="_blank">
                <h2 class="title mb-6" id="article-12">Preparing for the .NET 10 GC (DATAS)</h2>
            </a>
            <p class="mb-2">by maoni</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 08, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Learn how DATAS in .NET 10 adapts heap size, what changes to expect versus previous Server Garbage Collection (GC) behavior, and how to decide whether to tune or disable it.</p>
        </article>
        <article id="article-13">
            <a href="https://ayende.com/blog/203331-C/when-perf-optimization-breaks-tests-in-a-good-way" target="_blank">
                <h2 class="title mb-6" id="article-13">When perf optimization breaks tests in a GOOD way</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 07, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">You might have noticed a theme going on in RavenDB. We care&#xA0;a lot about performance. The problem with optimizing performance is that sometimes you have a great idea, you implement it, the performance gains are there&#xA0;to be had - and then a test fails&#x2026; and you realize that your great idea now needs to be 10 times more complex to handle a niche edge case.We did a lot&#xA0;of work around optimizing the performance of RavenDB at the lowest levels for the next major release (8.0), and we got a persistently failing test that we started to look at.Here is the failing message:Restore with MaxReadOpsPerSecond = 1 should take more than &#x27;11&#x27; seconds, but it took &#x27;00:00:09.9628728&#x27;The test in question is ShouldRespect_Option_MaxReadOpsPerSec_OnRestore, part of the MaxReadOpsPerSecOptionTests suite of tests. What it tests is that we can limit how fast RavenDB can restore a database. The reason you want to do that is to avoid consuming too many system resources when performing a big operation. For example, I may want to restore a big&#xA0;database, but I don&#x2019;t want to consume all the IOPS on the server, because there are additional databases running on it.At any rate, we started to get test failures on this test. And a deeper investigation revealed something quite amusing. We made the entire system more efficient. In particular, we managed to reduce the size of the buffers used significantly, so we can push more data faster. It turns out that this is enough to break the test.The fix was to reduce the actual time that we budget as the minimum viable time. And I have to say that this is one of those pull requests that lights a warm fire in my heart.</p>
        </article>
        <article id="article-14">
            <a href="https://devblogs.microsoft.com/dotnet/developer-and-ai-code-reviewer-reviewing-ai-generated-code-in-dotnet/" target="_blank">
                <h2 class="title mb-6" id="article-14">Developer and AI Code Reviewer: Reviewing AI-Generated Code in .NET</h2>
            </a>
            <p class="mb-2">by Wendy Breiding (SHE/HER)</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 07, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Learn how to effectively review AI-generated .NET code with practical strategies for maintaining quality, enforcing standards, and boosting team productivity through thoughtful code review practices.</p>
        </article>
        <article id="article-15">
            <a href="https://www.meziantou.net/how-to-find-an-available-network-port-in-dotnet.htm" target="_blank">
                <h2 class="title mb-6" id="article-15">How to Find an Available Network Port for a server in .NET</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 06, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">When working with network programming in .NET, you might need to find an available port on your system. This is particularly useful when creating server applications, running tests, or developing tools that need to bind to a network port without conflicts.Here&#x27;s a simple way to get an available por</p>
        </article>
        <article id="article-16">
            <a href="https://andrewlock.net/easily-publishing-nuget-packages-from-github-actions-with-trusted-publishing/" target="_blank">
                <h2 class="title mb-6" id="article-16">Publishing NuGet packages from GitHub actions the easy way with Trusted Publishing</h2>
            </a>
            <p class="mb-2">by Andrew Lock</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 30, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post I describe how you can use nuget.org&#x27;s new Trusted Publishing feature to publish NuGet packages from a GitHub Actions workflow&#x2026;</p>
        </article>
        <article id="article-17">
            <a href="https://ayende.com/blog/203299-B/recording-how-to-run-ai-agents-natively-in-your-database" target="_blank">
                <h2 class="title mb-6" id="article-17">Recording</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 29, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">AI agents are only as powerful as their connection to data. In this session, Oren Eini, CEO and Co-Founder of RavenDB, demonstrates why the best place for AI agents to live is inside your database. Moderated by Ariel, Director of Product Marketing at RavenDB, the webinar explores how to eliminate orchestration complexity, keep agents safe, and unlock production-ready AI with minimal code. You&#x2019;ll see how RavenDB integrates embeddings and vector search directly into the database, runs generative AI tasks such as translation and summarization on your documents, and defines AI agents that can query and act on your data safely. Learn how to scope access, prevent hallucinations, and use AI agents to handle HR queries, payroll checks, and issue escalations. Discover how RavenDB supports any LLM provider (OpenAI, DeepSeek, Ollama, and more), works seamlessly on the edge or in the cloud, and gives developers a fast path from prototype to production without a tangle of external services. This session shows how to move beyond chatbots into real, action-driven agents that are reliable, predictable, and simple to extend. If you&#x2019;re exploring AI-driven applications, this is where to start.</p>
        </article>
        <article id="article-18">
            <a href="https://www.meziantou.net/using-git-insteadof-to-automatically-replace-https-urls-with-ssh.htm" target="_blank">
                <h2 class="title mb-6" id="article-18">Using Git insteadOf to Automatically Replace HTTPS URLs with SSH</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 29, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">When working with Git repositories, you often encounter URLs in HTTPS format, especially when cloning from GitHub, GitLab, or other hosting services. However, if you prefer using SSH for authentication (which is often more convenient with key-based auth), manually changing URLs can be tedious. Also</p>
        </article>
        <article id="article-19">
            <a href="https://ardalis.com/ardalis-fall-2025-speaking-tour/" target="_blank">
                <h2 class="title mb-6" id="article-19">Ardalis Fall 2025 Speaking Tour</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 27, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I may have gone a bit overboard this year... I&#x27;ve scheduled myself for 5 developer conferences in 4 weeks during October 2025! If you&#x27;re&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-20">
            <a href="https://ayende.com/blog/203300-B/cryptographic-documents-in-ravendb" target="_blank">
                <h2 class="title mb-6" id="article-20">Cryptographic documents in RavenDB</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: September 26, 2025
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We got an interesting use case from a customer - they need to verify&#xA0;that documents in RavenDB have not been modified by any external party, including users with administrator credentials for the database.This is known as the Rogue Root problem, where you have to protect yourself from potentially malicious root users. That is not&#xA0;an easy problem - in theory, you can safeguard yourself using various means, for example the whole premise of SELinux is based on that. I don&#x2019;t really like that approach, since I assume that if a user has (valid) root access, they also likely have physical access. In other words, they can change the operating system to bypass any hurdles in the way.Luckily, the scenario we were presented with involved detecting changes made by an administrator, which is significantly easier. And we can also use some cryptography tools to help us handle even the case of detecting malicious&#xA0;tampering.First, I&#x2019;m going to show how to make this work with RavenDB, then we&#x2019;ll discuss the implications of this approach for the overall security of the system.The implementationThe RavenDB client API allows you to hook into the saving process of documents, as you can see in the code below. In this example, I&#x2019;m using a user-specific ECDsa key (by calling the GetSigningKeyForUser()&#xA0;method).store.OnBeforeStore &#x2B;= (sender, e) =&gt;&#xD;&#xA;{&#xD;&#xA;    using var obj = e.Session.JsonConverter.ToBlittable(e.Entity, null);&#xD;&#xA;    var date = DateTime.UtcNow.ToString(&quot;O&quot;);&#xD;&#xA;    var data = Encoding.UTF8.GetBytes( e.DocumentId &#x2B; date &#x2B; obj);&#xD;&#xA;    &#xD;&#xA;    using ECDsa key = GetSigningKeyForUser(CurrentUser);&#xD;&#xA;    var signData = key.SignData(data, HashAlgorithmName.SHA256);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;    e.DocumentMetadata[&quot;DigitalSignature&quot;] = new Dictionary&lt;string, string&gt;&#xD;&#xA;    {&#xD;&#xA;        [&quot;User&quot;] = CurrentUser,&#xD;&#xA;        [&quot;Signature&quot;] = Convert.ToBase64String(signData),&#xD;&#xA;        [&quot;Date&quot;] = date,&#xD;&#xA;        [&quot;PublicKey&quot;] = key.ExportSubjectPublicKeyInfoPem()&#xD;&#xA;    };&#xD;&#xA;};What you can see here is that we are using the user&#x2019;s key to generate a signature that is composed of:The document&#x2019;s ID.The current signature time.The JSON content of the entity.After we generate the signature, we add it to the document&#x2019;s metadata. This allows us to verify that the entity is indeed valid and was signed by the proper user. To validate this afterward, we use the following code:bool ValidateEntity&lt;T&gt;(IAsyncDocumentSession session,T entity)&#xD;&#xA;{&#xD;&#xA;    var metadata = session.Advanced.GetMetadataFor(entity);&#xD;&#xA;    var documentId = session.Advanced.GetDocumentId(entity);&#xD;&#xA;    var digitalSignature = metadata.GetObject(&quot;DigitalSignature&quot;) ??&#xD;&#xA;          throw new IOException(&quot;Signature is missing for &quot; &#x2B; documentId);&#xD;&#xA;    var date = digitalSignature.GetString(&quot;Date&quot;);&#xD;&#xA;    var user = digitalSignature.GetString(&quot;User&quot;);&#xD;&#xA;    var signature = digitalSignature.GetString(&quot;Signature&quot;);&#xD;&#xA;    using var key = GetPublicKeyForUser(user);&#xD;&#xA;    using var obj = session.Advanced.JsonConverter.ToBlittable(entity, null);&#xD;&#xA;    var data = Encoding.UTF8.GetBytes(documentId &#x2B; date &#x2B; obj);&#xD;&#xA;    var bytes = Convert.FromBase64String(signature);&#xD;&#xA;    return key.VerifyData(data, bytes, HashAlgorithmName.SHA256);&#xD;&#xA;}Note that here, too, we are using the GetPublicKeyForUser()&#xA0;to get the proper public key to validate the signature. We use the specified user from the metadata to get the key, and we verify the signature against the document ID, the date in the metadata, and the JSON of the entity.We are also saving the public key of the signing user in the metadata. But we haven&#x2019;t used it so far, why are we doing this? The reason we use GetPublicKeyForUser()&#xA0;in the ValidateEntity()&#xA0;call is pretty simple: we want to get the user&#x2019;s key from the same source. This assumes that the user&#x2019;s key is stored in a safe location (a secure vault or a hardware key like YubiKey, etc.). The reason we want to store the public key in the metadata is so we can verify the data on the server&#xA0;side. I created the following index:from c in docs.Companies&#xD;&#xA;let unverified = Crypto.Verify(c)&#xD;&#xA;where unverified is not null&#xD;&#xA;select new &#xD;&#xA;{ &#xD;&#xA;    Problem = unverified&#xD;&#xA;}I&#x2019;m using RavenDB&#x2019;s additional sources&#xA0;feature to add the following code&#xA0;to the index. This exposes the Crypto.Verify()&#xA0;call to the index, and the code uses the public key in the metadata (as well as the other information there) to verify that the document signature is valid.The index code above will filter all the documents whose signature is valid, so you can easily get all the problematic documents. In other words, it is a quick way of saying: &#x201C;Find me all the documents whose verification failed&#x201D;. For compliance, that is quite important and usually requires going over the entire dataset to answer it.The implicationsLet&#x2019;s consider the impact of such a system. We now have cryptographic verification that the document was modified by a specific user. Any tampering with the document will invalidate the digital signature (or require signing it with your key).Combine that with RavenDB&#x2019;s revisions, and you have an immutable log that you can verify using modern cryptography. No, it isn&#x2019;t a blockchain, but it will put a significant roadblock in the path of anyone trying to just modify the data. The fact that we do the signing on the client side, rather than the server, means that the server never actually has access&#xA0;to the signing keys (only the public keys). The server&#x2019;s administrator, in the same manner, doesn&#x2019;t have a way to get those signing keys and forge a document.In other words, we solved the Rogue Root problem, and we ensured that a user cannot repudiate a document they signed. It is easy to audit the system for invalid documents (and, combined with revisions, go back to a valid one).Escape hatch designIf you need this sort of feature for compliance only, you may want to skip the ValidateEntity()&#xA0;call. That would allow an administrator to manually change a document (thus invalidating the digital signature) and still have the rest of the system work. That goes against what we are trying to do, yes, but it is sometimes desirable.That isn&#x2019;t required for the normal course of operations, but it can&#xA0;be required for troubleshooting, for example. I&#x2019;m sure you can think of a number of reasons why it would make things a lot easier to fix if you could just modify the database&#x2019;s data.For example, an Order&#xA0;contains a ZipCode&#xA0;with the value &quot;02116&quot;&#xA0;(note the leading zero), which a downstream system turns into the integer 02116. An administrator can change the value to be &quot; 02116&quot;, with a leading space, preventing this problem (the downstream system will not convert this to a number, thus keeping the leading 0). Silly, yes - but it happens all the time.Even though we are invalidating the digital signature, we may want to do that anyway. The index we defined would alert on this, but we can proceed with processing the order, then fix it up later. Or just make a note of this for compliance purposes. SummaryThis post walks you through building a cryptographic solution to protect document integrity within a RavenDB environment, addressing the Rogue Root problem. The core mechanism is a client-side OnBeforeStore hook that generates an ECDsa&#xA0;digital signature for each document. This design ensures that the private keys are never exposed on the server, preventing a database administrator from forging signatures and providing true non-repudiation.A RavenDB index is used to automatically and asynchronously verify every document&#x27;s signature against its current content. This index filters for any documents where the digital signature is valid, providing an efficient server-side audit mechanism to find all the documents with invalid signatures.The really fun part here is that there isn&#x2019;t really a lot of code or complexity involved, and you get strong cryptographic proof that your data has not been tampered with.</p>
        </article>
        <div class="button flex justify-between">
            <a href="index.html"><span class="back arrow"></span></a>

            <a href="3.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;🚀&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
