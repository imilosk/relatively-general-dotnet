
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 435 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-4341">
            <a href="https://ayende.com/blog/159041/listofparams-and-other-horrible-things-that-you-shouldnt-bring-to-ravendb" target="_blank">
                <h2 class="title mb-6" id="article-4341">ListOfParams and other horrible things that you shouldn&#x2019;t bring to RavenDB</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 09, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In the mailing list, we got asked about an issue with code that looked like this:      1: public abstract class Parameter   2: {   3:     public String Name { get; set; }   4: }   5:&#xA0;    6: public class IntArrayParameter : Parameter   7: {   8:     public Int32[,] Value { get; set; }   9: }&#xA;I fixed the bug, but that was a strange thing to do, I thought. Happily, the person asking that question was actually taking part of a RavenDB course and I could sit with him and understand the whole question.&#xA;It appears that in their system, they have a lot of things like that:&#xA;&#xA;IntParameter&#xA;StringParameter&#xA;BoolParameter&#xA;LongParameter&#xA;And along with that, they also have a coordinating class:&#xA;&#xA;&#xA;   1: public class ListOfParams   2: {   3:    public List&lt;Param&gt; Values {get;set;}   4: }&#xA;The question was, could they keep using the same approach using RavenDB? They were quite anxious about this, since they had a need for the capabilities of this in their software.&#xA;This is why I hate Hello World questions. I could answer just the question that was asked, and that was it. But the problem is quite different.&#xA;You might have recognized it by now, what they have here is Entity Attribute Value system. A well known anti pattern for the relational database world and one of the few ways to actually get a dynamic schema in that world.&#xA;In RavenDB, you don&#x2019;t need all of those things. You can just get things done. Here is the code that we wrote to replace the above monstrosity:&#xA;&#xA;&#xA;   1: public class Item : DynamicObject   2: {   3:     private Dictionary&lt;string, object&gt;  vals = new Dictionary&lt;string, object&gt;();   4:&#xA0;    5:     public string StaticlyDefinedProp { get; set; }   6:&#xA0;    7:     public override bool TryGetMember(GetMemberBinder binder, out object result)   8:     {   9:         return vals.TryGetValue(binder.Name, out result);  10:     }  11:&#xA0;   12:     public override bool TrySetMember(SetMemberBinder binder, object value)  13:     {  14:         if(binder.Name == &quot;Id&quot;)  15:             return false;  16:         vals[binder.Name] = value;  17:         return true;  18:     }  19:&#xA0;   20:     public override bool TrySetIndex(SetIndexBinder binder, object[] indexes, object value)  21:     {  22:         var key = (string) indexes[0];  23:         if(key == &quot;Id&quot;)  24:             return false;  25:         vals[key] = value;  26:         return true;  27:     }  28:&#xA0;   29:     public override bool TryGetIndex(GetIndexBinder binder, object[] indexes, out object result)  30:     {  31:         return vals.TryGetValue((string) indexes[0], out result);  32:     }  33:&#xA0;   34:     public override IEnumerable&lt;string&gt; GetDynamicMemberNames()  35:     {  36:         return GetType().GetProperties().Select(x =&gt; x.Name).Concat(vals.Keys);  37:     }  38: }&#xA;Not only will this class handle the dynamics quite well, it also serializes&#xA0; to idiomatic JSON, which means that querying that is about as easy as you can ask.&#xA;The EAV schema was created because RDBMS aren&#x2019;t suitable for dynamic work, and like many other things from the RDMBS world, this problem just doesn&#x2019;t exists for us in RavenDB.</p>
        </article>
        <article id="article-4342">
            <a href="https://ayende.com/blog/159009/get-thou-out-of-my-head-damn-idea" target="_blank">
                <h2 class="title mb-6" id="article-4342">Get thou out of my head, damn idea</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 08, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Sometimes I get ideas, and they just won&#x2019;t leave my head no matter what I do. In this case, I decided that I wanted to see what it would take to implement an event store in terms of writing a fully managed version. I am not really interested in the actual event store, I care a lot more about the actual implementation idea that I had (I/O queues in append only mode, if you care to know). After giving it some though, I managed to create a version that allow me to write the following code:      1: var diskData = new OnDiskData(new FileStreamSource(), &quot;Data&quot;);   2:&#xA0;    3: var data = JObject.Parse(&quot;{&#x27;Type&#x27;: &#x27;ItemCreated&#x27;, &#x27;ItemId&#x27;: &#x27;1324&#x27;}&quot;);   4: var sp = Stopwatch.StartNew();   5: Parallel.For(0, 1000*10, i =&gt;   6:     {   7:         var tasks = new Task[1000];   8:         for (int j = 0; j &lt; 1000; j&#x2B;&#x2B;)   9:         {  10:             tasks[j] = diskData.Enqueue(&quot;users/&quot; &#x2B; i, data);  11:         }  12:         Task.WaitAll(tasks);  13:     });  14:&#xA0;   15: Console.WriteLine(sp.ElapsedMilliseconds);&#xA;Admittedly, it isn&#x2019;t a really interesting client code, but it is plenty good enough for what I need, and it allowed me to check something really interesting, just how hard would I have to go to actually get really good performance. As it turned out, not that far.&#xA;This code writes 10 million events, and it does so in under 1 minutes (on my laptop, SSD drive). Just to give you some idea, that is &gt; 600 Mb of events, and about 230 events per milliseconds or about 230 thousands events per second. Yes, that is 230,000 events / sec.&#xA;The limiting factor seems to be the disk, and I have some ideas on how to implement that. I still got roughly 12MB/s, so there is certainly room for improvement.&#xA0; &#xA;How does this work? Here is the implementation of the Enqueue method:&#xA;&#xA;&#xA;   1: public Task Enqueue(string id, JObject data)   2: {   3:     var item = new WriteState   4:         {   5:             Data = data,   6:             Id = id   7:         };   8:&#xA0;    9:     writer.Enqueue(item);  10:     hasItems.Set();  11:     return item.TaskCompletionSource.Task;  12: }&#xA;In other words, this is a classic producer/consumer problem.&#xA;The other side is&#xA0; reading the events from the queue and writing them to disk. There is just one thread that is doing that, and it is always appending to the end of the file. Moreover, because of the way it works, we are actually gaining the ability to batch a lot of them together into a stream of really nice IO calls that optimize the actual disk access. When we finished with a batch of items and flushed them to disk, only then are we going to complete the task, so the fun part is that for all intents and purposes, we are doing that while preserving transactionability of the system. Once the Enqueue task returned, we can be sure that the data is fully saved on disk.&#xA;That was an interesting spike, and I wonder where else I would be able to make use of something like this in the future.&#xA;Yes, those are pretty small events, and yes, that is a fake test, but the approach seems to be very solid.&#xA;And just for fun, with absolutely no optimizations what so ever, no caching, no nothing, I am able to load 1,000 events per stream in less than 10 ms.</p>
        </article>
        <article id="article-4343">
            <a href="https://ardalis.com/devreach-2012-sessions/" target="_blank">
                <h2 class="title mb-6" id="article-4343">DevReach 2012 Sessions</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 06, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Thanks to everybody who attended my DevReach sessions. I had two talks and two panels, and both of the talks were standing room only (in the&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-4344">
            <a href="https://benfoster.io/blog/per-request-dependencies-in-aspnet-web-api-using-structuremap/" target="_blank">
                <h2 class="title mb-6" id="article-4344">Per-Request dependencies in ASP.NET Web API using StructureMap</h2>
            </a>
            <p class="mb-2">by Ben Foster</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 06, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post I discuss how to scope dependencies per-request in ASP.NET Web API using StructureMap.</p>
        </article>
        <article id="article-4345">
            <a href="https://ayende.com/blog/158977/awesome-indexing-with-ravendb" target="_blank">
                <h2 class="title mb-6" id="article-4345">Awesome indexing with RavenDB</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 05, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am currently teaching a course in RavenDB, and as usual during a course, we keep doing a lot of work that pushes what we do with RavenDB. Usually because we try to come up with new scenarios on the fly and adapting to the questions from the students. In this case, we were going over the map/reduce stack and we kept coming more and more complex example and how to handle them, and then we got to this scenario. Given the following class structure:      1: public class Animal   2: {   3:     public string Name { get; set; }   4:     public string Species { get; set; }   5:     public string Breed { get; set; }   6: }&#xA;Give me the count of all the species and all the breeds.&#xA0; That is pretty easy to do, right?&#xA0; In SQL, you would write it like this:&#xA;&#xA;&#xA;   1: SELECT Species, Breed, Count(*) FROM Animals   2: GROUP BY Species, Breed&#xA;And that is nice, but it still means that you have to do some work on the client side to merge things up to get the final result, since we want something like this:&#xA;&#xA;Dogs: 6 &#xA;&#xA;German Shepherd: 3 &#xA;Labrador: 1 &#xA;Mixed: 2&#xA;Cats: 3 &#xA;&#xA;Street: 2 &#xA;Long Haired: 1&#xA;In RavenDB, we can express the whole thing in a simple succinct index:&#xA;&#xA;&#xA;   1: public class Animals_Stats : AbstractIndexCreationTask&lt;Animal, Animals_Stats.ReduceResult&gt;   2: {   3:     public class ReduceResult   4:     {   5:         public string Species { get; set; }   6:         public int Count { get; set; }   7:         public BreedStats[] Breeds { get; set; }   8:&#xA0;    9:         public class BreedStats  10:         {  11:             public string Breed { get; set; }  12:             public int Count { get; set; }  13:         }  14:     }  15:&#xA0;   16:     public Animals_Stats()  17:     {  18:         Map = animals =&gt;  19:                 from animal in animals  20:                 select new  21:                     {  22:                         animal.Species,  23:                         Count = 1,  24:                         Breeds = new [] {new {animal.Breed, Count = 1}}  25:                     };  26:         Reduce = animals =&gt;  27:                     from r in animals  28:                     group r by r.Species  29:                     into g  30:                     select new  31:                         {  32:                             Species = g.Key,  33:                             Count = g.Sum(x =&gt; x.Count),  34:                             Breeds = from breed in g.SelectMany(x =&gt; x.Breeds)  35:                                     group breed by breed.Breed  36:                                     into gb  37:                                     select new {Breed = gb.Key, Count = gb.Sum(x =&gt; x.Count)}  38:                         };  39:&#xA0;   40:     }  41: }&#xA;And the result of this beauty?&#xA;&#xA;And that is quite pretty, even if I say so myself.</p>
        </article>
        <article id="article-4346">
            <a href="https://ayende.com/blog/159073/ravendb-bootcamp-milano-special-offer" target="_blank">
                <h2 class="title mb-6" id="article-4346">RavenDB Bootcamp: Milano&#x2013;special offer</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 05, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am on my third consecutive RavenDB course right now, and I just realized that I&#x2019;ll be doing a RavenDB bootcamp in three weeks as well.  This means 10 straight hours of intensive RavenDB, taking you from a newbie status all the way to a master of your (document) domain . RavenDB training has really picked up, which is good in the sense that a lot of people want to use it. It is bad in the sense that I would like to spend a little less time traveling. Therefor, I decided to make things simpler for me by cutting the costs of the RavenDB bootcamp by 35% (!). You can use the following link to register to that. Am I crazy? I hope that I am crazy like the guy on the left, and not the guy on the right. &#xA0; The basic ideas goes like this.  RavenDB training is something that I want to have as many people as possible to take.&#xA0; And I want to do this in as big a batch as possible, as well. I already had to make appointments to get back to the places I was just at to give the next round of training, and my hope is that this special offer will net all the people who care about RavenDB around Milano, and wouldn&#x2019;t have to come back for a while to complete things. Then again, there is also the fact that I was traveling on my wife birthday, which might have something to do with that. I would really like to avoid missing out on other important events. I already in trouble for not paying attention to our anniversary, and that didn&#x2019;t help.</p>
        </article>
        <article id="article-4347">
            <a href="https://ayende.com/blog/158945/thou-shall-not-do-threading-unless-you-know-what-you-are-doing" target="_blank">
                <h2 class="title mb-6" id="article-4347">Thou shall not do threading unless you know what you are doing</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 04, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I had a really bad couple of days. I am pissed, annoyed and angry, for totally not technical reasons. And then I run into this issue, and I just want to throw something really hard at someone, repeatedly. The issue started from this bug report:      1: NetTopologySuite.Geometries.TopologyException was unhandled   2:   HResult=-2146232832   3:   Message= ... trimmed ...   4:   Source=NetTopologySuite   5:   StackTrace:   6:        at NetTopologySuite.Operation.Overlay.Snap.SnapIfNeededOverlayOp.GetResultGeometry(SpatialFunction opCode)   7:        at NetTopologySuite.Operation.Union.CascadedPolygonUnion.UnionActual(IGeometry g0, IGeometry g1)   8:        at NetTopologySuite.Operation.Union.CascadedPolygonUnion.Worker.Execute()   9:        at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean preserveSyncCtx)  10:        at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean preserveSyncCtx)  11:        at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)  12:        at System.Threading.ThreadHelper.ThreadStart()&#xA;At first, I didn&#x2019;t really realized why it was my problem. I mean, it is NTS problem, isn&#x2019;t it?&#xA;Except that this particular issue actually crashed ravendb (don&#x2019;t worry, it is unstable builds only). The reason it crashed RavenDB? An unhandled thread exception.&#xA;What I can&#x2019;t figure out is what on earth is going on. So I took a look at the code, have a look:&#xA;&#xA;I checked, and this isn&#x2019;t code that has been ported from the Java code. You can see the commented code there? That is from the Java version.&#xA;And let us look at what the execute method does?&#xA;&#xA;So let me see if I understand. We have a list of stuff to do, so we spin out threads, reclusively, then we wait on them. I think that the point was to optimize things in some manner by parallelizing the work between the two halves.&#xA;Do you know what the real killer is? If we assume that we have a geometry with just 20 items on it, this will generate twenty two threads.&#xA;Leaving aside the issue of not handling errors properly (and killing the entire process because of this), the sheer cost of creating the threads is going to kill this program.&#xA;Libraries should be made to be thread safe (I already had to fix a thread safety bug there),&#xA0; but they should not be creating their own threads unless it is quite clear that they need to do so.&#xA;I believe that this is a case of a local optimization for a specific scenario, it also carry all of the issues associated with local optimizations. It solves one problem and opens up seven other ones.</p>
        </article>
        <article id="article-4348">
            <a href="https://ayende.com/blog/158915/lucene-is-beautiful" target="_blank">
                <h2 class="title mb-6" id="article-4348">Lucene is beautiful</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 03, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">So, after I finished telling you how much I don&#x2019;t like the lucene.net codebase, what is this post about? Well, I don&#x2019;t like the code, but then again, I generally don&#x2019;t like to read low level code. The ideas behind Lucene are actually quite amazingly powerful in their simplicity. At its core, Lucene is just a set of sorted dictionaries on disk (greatly simplified, I know). Everything else is build on top of that, and if you grok what is going on there, you would be quite amazed at the number of things that this has made possible. Indexing in Lucene is done by a pipeline of documents and fields and analyzers, which all participate together to generate those dictionaries. Searching in lucene is done by traversing those dictionaries in various ways, and combining the results in interesting ways. I am not going to go into details about how it works, you can read all about that here. The important thing is that once you have grasped the essential structure inside lucene, the rest are just details. The concept and the way the implementation fell out are quite beautiful.</p>
        </article>
        <article id="article-4349">
            <a href="https://ayende.com/blog/158914/lucene-net-is-ugly" target="_blank">
                <h2 class="title mb-6" id="article-4349">Lucene.NET is UGLY</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 02, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">If you ever had to go through the Lucene.NET code base, I am sure that you&#x2019;ll agree that the code base is quite ugly. It does a lot&#xA0; of low level stuff, which is almost always nasty, it is a port of a code from another language and framework, which means that it isn&#x2019;t idiomatic code, and it has a lot of&#x2026; strange things going on there.  Exceptions are used far too often. There is a strong tendency to delegate things in such a way that make it hard to figure out where things are actually happening. The big stick approach to thread safety (slap a lock on it). Some really horrible things with regards to mutable shared state with IndexInputs. Here is a good example of many of the issues that I talk about: https://github.com/apache/lucene.net/blob/trunk/src/core/Search/FieldCacheImpl.cs#L207 Read this method, and I think you&#x2019;ll understand. Then again, you can see methods of similar or greater complexity in RavenDB, for example, see here: https://github.com/ayende/ravendb/blob/1.2/Raven.Database/Indexing/IndexingExecuter.cs#L60 My main problem with the Lucene.NET codebase is that it feels alien, it isn&#x2019;t .NET code, and it shows. Then again, Lucene is also quite beautiful, but I&#x2019;ll talk about this in my next post.</p>
        </article>
        <article id="article-4350">
            <a href="https://ayende.com/blog/158913/things-we-learned-from-production-part-v-is-that-a-wrench-in-your-pocket-or-are-you-happy-to-see-me" target="_blank">
                <h2 class="title mb-6" id="article-4350">Things we learned from production, part V&#x2013;Is that a wrench in your pocket or are you happy to see me?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 01, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This post is actually going to be a short one, because it should have been pretty obvious.  An admin in production doesn&#x2019;t have the same toolset that developers have on their dev environment. The ability to break in and inspect the state of the system at any time is something that we developers usually take for granted, but it is something that is quite impossible to do in production. That means that we have to provide the admin with the ability to inspect our current state, we also need to give the admin the ability to make some changes. The most common example is to change system settings without taking the entire system down, but there are other things. Being able to force the system to do something, such as unload a database, force a full GC cycle or tweak the perf hints without getting seven people to sign off on taking the system down (and not having to do so at 3 AM) it a really good thing, as far as pretty much any admin is concerned.</p>
        </article>
        <div class="button flex justify-between">
            <a href="434.html"><span class="back arrow"></span></a>

            <a href="436.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>