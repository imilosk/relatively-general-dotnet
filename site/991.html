
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 991 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-9901">
            <a href="https://ayende.com/blog/760/covariance-without-generics" target="_blank">
                <h2 class="title mb-6" id="article-9901">Covariance Without Generics</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 24, 2005
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A few days ago I asked why you can&#x27;t treat IList&lt;String&gt; as IList&lt;Object&gt;,&#xA0;Wesner Moise commented&#xA0;with the explanation, and Mitch Denny&#xA0;has a post with a fuller explanation. One interesting thing that came up via a comment from Tomer Gabel&#xA0;was that the following code is legal:             static&#xA0;void&#xA0;Main(string[]&#xA0;args)        {        &#xA0;object[]&#xA0;array&#xA0;=&#xA0;GetList();        &#xA0;array[2]&#xA0;=&#xA0;1;        }        public&#xA0;static&#xA0;object[]&#xA0;GetList()        {        &#xA0;return&#xA0;new&#xA0;string[10];        }         &#xA0;This suffer from exactly the same problem that you get with generics. In fact, while the code compiles, trying to run it results in ArrayTypeMismatchException. I never dug deep enough into the runtime so I could tell you how arrays are implemented, but I think that they are just getting special threatment from the runtime. Any Rotor hackers out there that can comment on that?</p>
        </article>
        <article id="article-9902">
            <a href="https://ayende.com/blog/759/rules-delegation-and-yielders-oh-my" target="_blank">
                <h2 class="title mb-6" id="article-9902">Rules, Delegation, and Yielders, oh my!</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 24, 2005
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Like I said, I&#x27;ve just wrote a rule that used pretty much all the new features that C# 2 has to offer. I&#x27;m aware that I tend to like new things for their own sake, but I like to think that I&#x27;m using them wisely. Let&#x27;s take an example, since this is the best way to do it, in my opinion. I present here a case similar to the one I ended up with, and I would appreciate comments about the readability / maintainability of the code.     I have a graph of objects, and I need to run various rules against it. Traversing the graph is trivial, but I usually need to do it while taking all sorts of things into account.&#xA0;In this case, I basically need to compare the two, and generate notifications (using yield return) based on what is going on there. Let&#x27;s see an example, and then I could talk and be pretty sure that you understand what I&#x27;m talking about.    First, let&#x27;s take a relatively simple scenario that bring this and several other concepts that I&#x27;ve talked about earlier. The scenario is simple, we have a context under which we operate, and we need to apply similar&#xA0;rules to different contexts. Most of the rules operate on time, for example: A store must sell at least 50 items a day.    It&#x27;s a simple rule, isn&#x27;t it? But the stores doesn&#x27;t hold the data in a daily format, they hold a list of sales, and each sale has its associated date. The sales are already sorted by date, so it&#x27;s should be very easy to do it, right? Well, it is, if you don&#x27;t have a day without any sales. Does it trigger the rule? That depends, if it&#x27;s a day that the store was closed, it wouldn&#x27;t, but if it was opened and didn&#x27;t sell a thing, there is probably something there that needs more attention. What happens if you want to run the rule with a granularity of a week? A month? A quarter? What happen if the rule has a granularity of a month but the data we has is only for a week. This get messy very fast.    At the end I decided that I would create a class that would encapsulate all those decisions, and that class would use the context to get the various options it needed (for instance, when the store is closed). Here is what I ended up with. Pay attention to GetItemsOnSameDay() and GetItemsOnSameWeek(), that is where the crux is happening.public&#xA0;class&#xA0;StoreWalker    {    &#xA0;Context&#xA0;context;    &#xA0;Convertor&lt;ISalesContext,&#xA0;int&gt;&#xA0;action&#xA0;=&#xA0;DefaultAction;    &#xA0;    &#xA0;public&#xA0;StoreWalker(Context&#xA0;context)    &#xA0;{    &#xA0;&#xA0;this.context&#xA0;=&#xA0;context;    &#xA0;}    &#xA0;    &#xA0;private int&#xA0;DefaultAction(ISalesContext&#xA0;salesContext)    &#xA0;{    &#xA0;&#xA0;return&#xA0;1;    &#xA0;}    &#xA0;    &#xA0;public&#xA0;Convertor&lt;ISalesContext,&#xA0;int&gt;&#xA0;Action    &#xA0;{    &#xA0;&#xA0;set&#xA0;    &#xA0;&#xA0;{&#xA0;    &#xA0;&#xA0;&#xA0;if&#xA0;(value==null)    &#xA0;&#xA0;&#xA0;&#xA0;throw&#xA0;new&#xA0;ArgumentNullException(&quot;value&quot;);    &#xA0;&#xA0;&#xA0;action&#xA0;=&#xA0;value;    &#xA0;&#xA0;}    &#xA0;}    &#xA0;    &#xA0;public&#xA0;int&#xA0;Walk(Store&#xA0;Store)    &#xA0;{    &#xA0;&#xA0;int count&#xA0;=&#xA0;0;    &#xA0;&#xA0;foreach(ISalesContext&#xA0;salesContext&#xA0;in&#xA0;GetItemsOnSameDay(Store))    &#xA0;&#xA0;{    &#xA0;&#xA0;&#xA0;count&#xA0;&#x2B;=&#xA0;action(salesContext);    &#xA0;&#xA0;}    &#xA0;&#xA0;return&#xA0;count;    &#xA0;}    &#xA0;    &#xA0;public&#xA0;IEnumerable&lt;ISalesContext&gt;&#xA0;GetItemsOnSameDay(Store&#xA0;Store)    &#xA0;{    &#xA0;&#xA0;IList&lt;Sale&gt;&#xA0;items&#xA0;=&#xA0;new&#xA0;List&lt;Sale&gt;();    &#xA0;&#xA0;DateTime&#xA0;currentDate&#xA0;=&#xA0;Context.Start;    &#xA0;&#xA0;foreach(Sale&#xA0;item&#xA0;in&#xA0;Context.GetItems(Store))    &#xA0;&#xA0;{    &#xA0;&#xA0;&#xA0;while(currentDate&#xA0;!=&#xA0;item.Date)    &#xA0;&#xA0;&#xA0;{    &#xA0;&#xA0;&#xA0;&#xA0;yield&#xA0;return&#xA0;new&#xA0;SalesContext(items,&#xA0;currentDate);    &#xA0;&#xA0;&#xA0;&#xA0;items&#xA0;=&#xA0;newList&lt;Sale&gt;();    &#xA0;&#xA0;&#xA0;&#xA0;currentDate&#xA0;=&#xA0;currentDate.AddDays(1);    &#xA0;&#xA0;&#xA0;}    &#xA0;&#xA0;&#xA0;items.Add(item);    &#xA0;&#xA0;}    &#xA0;&#xA0;while(currentDate&#xA0;!=&#xA0;Context.End)    &#xA0;&#xA0;{    &#xA0;&#xA0;&#xA0;yield&#xA0;return&#xA0;new&#xA0;Store(items,&#xA0;currentDate);    &#xA0;&#xA0;&#xA0;items&#xA0;=&#xA0;newList&lt;Sale&gt;();    &#xA0;&#xA0;&#xA0;currentDate&#xA0;=&#xA0;currentDate.AddDays(1);    &#xA0;&#xA0;}    &#xA0;}    &#xA0;    &#xA0;public&#xA0;IEnumerable&lt;ISalesContext&gt;&#xA0;GetItemsOnSameWeek(Store&#xA0;Store)    &#xA0;{    &#xA0;&#xA0;IList&lt;Sale&gt;&#xA0;items&#xA0;=&#xA0;new&#xA0;List&lt;Sale&gt;();    &#xA0;&#xA0;DateTime&#xA0;start&#xA0;=&#xA0;Context.Start;    &#xA0;&#xA0;foreach(ISalesContext&#xA0;salesContext&#xA0;in&#xA0;GetItemsOnSameDay(Store))    &#xA0;&#xA0;{    &#xA0;&#xA0;&#xA0;items.AddRange(childStore.Items);    &#xA0;&#xA0;&#xA0;if(salesContext.Date.DayOfWeek&#xA0;==&#xA0;DayOfWeek.Sunday)    &#xA0;&#xA0;&#xA0;{    &#xA0;&#xA0;&#xA0;&#xA0;yield&#xA0;return&#xA0;new&#xA0;SalesContext(items,&#xA0;start,&#xA0;&#xA0;salesContext.Date);    &#xA0;&#xA0;&#xA0;&#xA0;start&#xA0;=&#xA0;&#xA0;salesContext;    &#xA0;&#xA0;&#xA0;&#xA0;items&#xA0;=&#xA0;new&#xA0;List&lt;Sale&gt;();    &#xA0;&#xA0;&#xA0;}    &#xA0;&#xA0;}    &#xA0;}    }        What GetItemsOnSameDay() does is to return provide a way to iterate over a store, and make sure that every day is accountable to. The GetItemsOnSameWeek() builts on GetItemsOnSameDay(). I can very easily add&#xA0;methods that would make the calculations for a month or a quarter, and they would be simple, since they wouldn&#x27;t need to check for missing weeks or months.    The nice part about it is that the whole thing is lazily evaluated, so if you&#x27;re running it on large amounts of data, there is no need to build the graph and then run on it, you run on the graph as you go along, and then the objects are GC&#x27;ed. However, I&#x27;m not sure what the implications of this are performance wise. There are some problems with recursive iterators&#xA0;that you should be concerned about if you&#x27;re using it for large data sets. I don&#x27;t think that this apply here, as it&#x27;s not about blindly forwarding methods calls (as in the case of the recusrive iterators), but each iterator in this case does work on each own, and it make it conceptually much easier to understand the system.    The more esoteric stuff comes later, when you need to run the rules over a store. If I was using .Net 1.1 or Java, I would need to use the Template Method, and for each rule that I would need, I would have to create a sub-class of StoreWalker and put the things that I need to check there. I find it limiting because most of the time I only need a couple of lines to express the difference, and I only use it in one place. I choose to go with Generic Template Delegate.    How do we find out how much items was sold from the store?public&#xA0;int&#xA0;GetNumberOfItemsSold()    {    &#xA0;StoreWalker&#xA0;sw&#xA0;&#xA0;=&#xA0;new&#xA0;StoreWalker(Context);    &#xA0;sw.Action&#xA0;=&#xA0;delegate(ISalesContext&#xA0;salesContext)&#xA0;{&#xA0;return&#xA0;salesContext.Sales.Count;&#xA0;};    &#xA0;return&#xA0;sw.Walk(Store);    }    How do we find the busiest day? This one uses local variables, so it can &quot;remember&quot; the current maximum is.public&#xA0;DateTime&#xA0;GetBusiestDay()    {    &#xA0;&#xA0;StoreWalker&#xA0;sw&#xA0;=&#xA0;new&#xA0;StoreWalker(Context);    &#xA0;&#xA0;int&#xA0;max&#xA0;&#xA0;=&#xA0;-1;    &#xA0;&#xA0;ISalesContext&#xA0;maxSaleContext;    &#xA0;&#xA0;sw.Action&#xA0;=&#xA0;delegate(ISalesContext&#xA0;salesContext)&#xA0;    &#xA0;&#xA0;{    &#xA0;&#xA0;&#xA0;&#xA0;if(g.Children.Count&gt;max)    &#xA0;&#xA0;&#xA0;&#xA0;{    &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;max&#xA0;=&#xA0;salesContext.Sales.Count;    &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;maxSaleContext&#xA0;=&#xA0;salesContext;    &#xA0;&#xA0;&#xA0;&#xA0;}    &#xA0;&#xA0;&#xA0;&#xA0;return&#xA0;1;&#xA0;    &#xA0;};    &#xA0;sw.Walk(Store);    &#xA0;return&#xA0;maxSaleContext&#xA0;==&#xA0;null&#xA0;?&#xA0;DateTime.MinValue&#xA0;:&#xA0;maxSaleContext.Date;    }&#xA0;    Total number of sales?public&#xA0;int&#xA0;GetNumberOfSales()    {    &#xA0;&#xA0;&#xA0;return&#xA0;new&#xA0;StoreWalker(Context).Walk(Store);    }    I chatted with Oren Ellenbogen&#xA0;about this, and he claims that the maintainability of the code is compromised. The idea is that it would cost you five minutes to do it the old way (using Template Method), and then it&#x27;s more maintainable. I argued that while this does require a shift in thinking, it pays off very shortly by using these type of techniques. I certainly don&#x27;t advocate putting a large method inside an anonymous delegate, but even if it&#x27;s a complex calculation that you want to do, you can still get the benefits of merely writing the method and then wiring to the walker&#x27;s action.    Thoughts?</p>
        </article>
        <article id="article-9903">
            <a href="https://ayende.com/blog/758/a-study-in-unusability" target="_blank">
                <h2 class="title mb-6" id="article-9903">A study in unusability</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 24, 2005
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">VS 2005 has a great concept called snippets. It&#x27;s a wonder it didn&#x27;t have it before, since it&#x27;s a very basic item, but at least we got it now. There is a community site where you can get snippets from the community.    All in all, I think that this is a laudable idea, but I find the implementation problematic.    Take a look at the site, it&#x27;s a very clean UI, and you can see the last 5 entries. This is well and good, but I couldn&#x27;t figure out how to get anything else. I consider myself pretty handy in computers, and this is just incomprehensible. Maybe they read Scoble&#x27;s posts about search and took it too far?    I want a list of categories, or even a flat list. I want to browse the site, not search it. I would&#x27;ve been disappointed if they wouldn&#x27;t have search, but having a search with magic pharses (see &quot;recent 5&quot; on the front page? &quot;recent 50&quot; doesn&#x27;t work) is just useless.</p>
        </article>
        <article id="article-9904">
            <a href="https://ayende.com/blog/757/know-those-associations" target="_blank">
                <h2 class="title mb-6" id="article-9904">Know those associations</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 24, 2005
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just had a&#xA;run into a mess of my own cooking. I had a set of classes, where one class held&#xA;references to some other classes, and I didn&#x2019;t map the associations&#xA;properly. Not in the software and defiantly not in my mind.&#xA;&#xA;Enter a lot of frustration about WTF is going on here. &#xA;&#xA;I didn&#x2019;t map all the associations and their cascades,&#xA;which meant that I run into a lot of trouble when I started to really work with&#xA;the model. Luckily I&#x2019;ve a suite of tests that I can run, so I can play around&#xA;with the cascades and see what is going on.&#xA;&#xA;To add to the problem, I tried to do two things with it, the&#xA;first was to follow the business logic and create associations that would make&#xA;it easier to work with the objects. The second was to allow a to clear the&#xA;database for the tests.&#xA;&#xA;This got me into a lot of trouble&#x2026;&#xA;&#xA;I couldn&#x2019;t use NHibernate to do it, because it failed&#xA;to do a mass delete since the associations and cascades where in the way. At&#xA;first I tried to work around that, but pretty soon it became clear that it&#x2019;s&#xA;not going to be possible.&#xA;&#xA;I finally decided to separate the two concerns. I have not&#xA;problem with having testing hooks, but changing the business logic because you want to have easier&#xA;testing is a symptom that you went a long way too far.&#xA;&#xA;I restored the association to the way they were supposed to&#xA;be according to the model, and I&#x2019;m going to keep an eye on that, I didn&#x2019;t&#xA;really paid attention to that before, and it&#x2019;s going to be critical in a&#xA;few days, when I start to put it all together.&#xA;&#xA;For the tests, I&#x2019;m using a simple function that&#xA;deletes all the rows from the database after each test. On the first time that&#xA;the tests are run, the whole database is recreated from scratch.&#xA;&#xA;I&#x2019;m not using Active Record to do it, since other&#xA;tools need the schema as well, and I want to make sure that I don&#x2019;t make accidental&#xA;change to the schema by messing around with the business objects.&#xA;&#xA;Still working on the rules, now it&#x2019;s a rule that is a collection&#xA;of rules. This one had me using just about any feature of C# 2 to get it done&#xA;cleanly. I&#x2019;ll post about it later.</p>
        </article>
        <article id="article-9905">
            <a href="https://ayende.com/blog/756/free-as-a-bird-or-not" target="_blank">
                <h2 class="title mb-6" id="article-9905">Free as a bird? Or not?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 23, 2005
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This slashdot story&#xA0;made me smile. A software bug set inmates free early and late, some by nearly half a year!     I used to be the commander of a high security prison, and I understand how those systems work. What I find interesting is the number of check and balances that most prisons have. I&#x27;m familiar with the inner working of most prisons in Israel, both military and civilians, and it&#x27;s hard to believe that you would get a case of this proprotions.     One case might happen, but then all hell would break lose.     In any case, I find it very hard to believe that the inmates do not know when they are to be released, and while they might not speak if they are released early, they would definately speak if their due date has come and they are still inside. I never knew an inmate that didn&#x27;t know to the day (and usually to the hour) how long he was inside, and how long he still had.     I remember having to go over all the inmates files weekly, checking that all the documents were in order, and that the computer system* was correct. I find it hard to believe that they didn&#x27;t have any kind of human intervantion. I know that when I released an inmate, I went over all the paperwork twice, because you don&#x27;t play around with this kind of stuff.     * A glorified name for Excel sheet.</p>
        </article>
        <article id="article-9906">
            <a href="https://ayende.com/blog/755/covariance-in-delegates" target="_blank">
                <h2 class="title mb-6" id="article-9906">Covariance in delegates</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 22, 2005
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x27;m not sure if it&#x27;s the way to call it, but why does the C# compiler errors on this:public&#xA0;IList&lt;object&gt;&#xA0;GetList()    {    &#xA0;&#xA0;&#xA0;return&#xA0;new&#xA0;List&lt;string&gt;();    }    Seems to me that a generic of a derived type should be able to satisfy the compiler when requesting a generic of a base type.    Any idea what the reasoning behind this decision was?</p>
        </article>
        <article id="article-9907">
            <a href="https://ayende.com/blog/754/tdd-and-sql-express" target="_blank">
                <h2 class="title mb-6" id="article-9907">TDD and SQL Express</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 22, 2005
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Testing against a database is usually a problem, but I run into an unusal one today. My tests would all fail, saying that they couldn&#x27;t connect to the database. I checked the connection string, and then try to connect using VS 2005, and it worked. When I run the tests again, they got the database and run properly.    The only thing that I think of that can cause that is if SQL Express wasn&#x27;t running when I run the tests the first time, and when I accessed the database in VS 2005, it checked for that and started the database.    Strange...</p>
        </article>
        <article id="article-9908">
            <a href="https://ayende.com/blog/753/rhino-mocks-2-4-2-the-unmocker" target="_blank">
                <h2 class="title mb-6" id="article-9908">Rhino Mocks 2.4.2: The Unmocker</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 21, 2005
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Okay, so I&#x27;ve a new release out (any time I push out a release, I just know that I&#x27;ll have to have a new one ready in a short time).    So, what is the story here?    Some time ago I added the ability to easily create stub objects and dynamic mocks. So you could do something like this:            IList&#xA0;list&#xA0;=&#xA0;mocks.DynamicMock&lt;IList&gt;();        SetupResult.For(list.Count).Return(5);        mocks.ReplayAll();        //use&#xA0;list,&#xA0;list.Count&#xA0;will&#xA0;always&#xA0;return&#xA0;5,&#xA0;anything&#xA0;else&#xA0;will&#xA0;return&#xA0;0&#xA0;or&#xA0;null        This works fine and I use it daily in my current project, but it&#x27;s a problem where you get cases where you have a property on your mocked object, let&#x27;s take this code:            public&#xA0;int&#xA0;SetId(Something&#xA0;something)        {        &#xA0;&#xA0;something.Prop&#xA0;=&#xA0;//&#xA0;Get&#xA0;the&#xA0;id                &#xA0;&#xA0;return&#xA0;something.Prop;        }        Now, what do you need in order to connect the setter and getter in this case? Well, before 2.4.2 you needed to know about the value beforehand, which was not always possible. Here is how you do it on 2.4.2, however:            [Test]        public&#xA0;void&#xA0;TestSetId()        {        &#xA0;&#xA0;&#xA0;Something&#xA0;something&#xA0;=&#xA0;mocks.DynamicMock&lt;Something&gt;();        &#xA0;&#xA0;&#xA0;SetupResult.For(something.Prop).CallOriginalMethod();&#xA0;//&#xA0;for&#xA0;the&#xA0;getter                &#xA0;&#xA0;&#xA0;SetupResult.For(something.Prop&#xA0;=&#xA0;0).CallOrigianlMethod();&#xA0;//&#xA0;for&#xA0;the&#xA0;setter                &#xA0;&#xA0;&#xA0;Assert.AreEqual(5,&#xA0;objUnderTest.SetId(Something));        }        What do we have here? We create the mock object, and then we setup two calls, one for the property getter and another for the setter (the syntax may be a little weird for the setter, but it&#x27;s actually the best syntax that we could think of). We tell Rhino that when it get a call to get_Prop, it should just call the original method on the object, and the same for set_Prop. That is a nice way to do it, I think.    Caveats:            There is no either/or with this, it doesn&#x27;t attempt to match arguments to see if it should call the original method or not, it just does.            You can&#x27;t set repeats or exceptions or return values, any call for this method will go to the original object.            You can&#x27;t use it on interfaces or abstract methods, since there isn&#x27;t a method there to pass it to.</p>
        </article>
        <article id="article-9909">
            <a href="https://ayende.com/blog/752/taking-rules-to-court" target="_blank">
                <h2 class="title mb-6" id="article-9909">Taking Rules to Court</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 21, 2005
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">It&#x27;s about time I&#x27;ll post about my trouble making rules again. I&#x27;ve been doing some DATT* work on them, and I got to the point where I can write a rule in an hour or so (including tests, of course), instead of a day.     Partly it is because I&#x27;m now using Fitnesse&#xA0;to write the tests, which allows for a very nice way to declare rules and various states and then test them. I&#x27;m not sure if the problem is with what I&#x27;m doing or the way I&#x27;m doing it, but when I wrote the tests in C# I got a lot of tedious initialization code, one method call, and a lot of verfication code. Using Fitnesse&#xA0;I&#x27;m able to express that in a natural syntax:                                                             create rules                                                            create employee                                    ayende                                                            add employee rule                                    coffee breaks every                                    3                                    hours                                                                                        coffe break                                                            employee                                    coffee break time                                                            ayende                                    13:00                                                            ayende                                    14:00                                                            ayende                                    17:00                                                            ayende                                    20:00                                                                                            validate employee                                    ayende                                                            can&#x27;t take a coffee break on 14:00, take another on 16:00                                                            what are you doing working on 20:00, go home!                            It takes about ten minutes to write that, including the code that makes it run, and it&#x27;s very malleble to change, so I can very easily create new test cases, or modify existing one. Fitnesse is usually used for acceptance tests, and I can certainly see why. The problem in testing rules is that almost by defination, they are first and foremost business concerns, and they usually need something to run on, which mean a lot of state to setup.    There are some patterns about dealing with that, but I found that Fitnesse is easy and add a lot to the fun. This week the FitLibrary for .Net should be out, which will make it even better.     * Design All The Time</p>
        </article>
        <article id="article-9910">
            <a href="https://ayende.com/blog/751/reading-the-license" target="_blank">
                <h2 class="title mb-6" id="article-9910">Reading the license...</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 21, 2005
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just re-read the license that I&#x27;ve on my site. It started by being the standard BSD license, and I simply removed the ALL CAPS from the no warrany clause. Now, I don&#x27;t go around reading licenses very often, especially not mine, but I made some (minor) changes to the site, so I was browsing around randomally and happened to read it.    Check it out:    Redistributions of source code must retain the above copyright notice,&#xA0; this IList of conditions and the following disclaimer.     I know that I didn&#x27;t put it there in purpose, and I can&#x27;t find anywhere else that had this mistake. It&#x27;s fixed now, but it&#x27;s strange...</p>
        </article>
        <div class="button flex justify-between">
            <a href="990.html"><span class="back arrow"></span></a>

            <a href="992.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
