
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 26 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-251">
            <a href="https://devblogs.microsoft.com/dotnet/introducing-mstest-sdk/" target="_blank">
                <h2 class="title mb-6" id="article-251">Introducing MSTest SDK &#x2013; Improved Configuration &amp; Flexibility</h2>
            </a>
            <p class="mb-2">by Marco Rossignoli</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 11, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The new MSTest SDK is here and provides an easier way to configure your MSTest projects. Learn all about this release, how to get started, and its great improvements when using MSTest.</p>
        </article>
        <article id="article-252">
            <a href="https://devblogs.microsoft.com/dotnet/april-2024-updates/" target="_blank">
                <h2 class="title mb-6" id="article-252">.NET April 2024 Updates &#x2013; .NET 8.0.4, 7.0.18, .NET 6.0.29</h2>
            </a>
            <p class="mb-2">by Rahul Bhandari (MSFT)</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 09, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Check out latest April 2024 updates for .NET 8.0, .NET 7.0, and .NET 6.0.</p>
        </article>
        <article id="article-253">
            <a href="https://www.meziantou.net/creating-ico-files-from-multiple-images-in-dotnet.htm" target="_blank">
                <h2 class="title mb-6" id="article-253">Creating ico files from multiple images in .NET</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 08, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Ico files are old but still widely used. One specificity of the ico format is that it can contain multiple images of different sizes. The format is not very complicated but there are not a lot of free tools to create an ico file from a list of images. Let&#x27;s create one in .NET!The specification of t</p>
        </article>
        <article id="article-254">
            <a href="https://ardalis.com/5-rules-dtos/" target="_blank">
                <h2 class="title mb-6" id="article-254">5 Rules for DTOs</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 06, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">If you don&#x27;t like reading, here&#x27;s my YouTube video with samples that covers why these 5 rules will help you write better DTOs: What&#x27;s a DTO&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-255">
            <a href="https://ayende.com/blog/200929-B/vacations-leaky-abstractions-and-modeling-concerns-oh-my" target="_blank">
                <h2 class="title mb-6" id="article-255">Vacations, leaky abstractions, and modeling concerns, oh my!</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 04, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Our task today is to request (and obtain approval for) a vacation. But before we can make that request, we need to handle the challenge of building &#xA0; the vacation requesting system. Along the way, I want to focus a little bit on how to deal with some of the technical issues that may arise, such as concurrency.In most organizations, the actual details of managing employee vacations are a mess of a truly complicated series of internal policies, labor laws, and individual contracts. For this post, I&#x2019;m going to ignore all of that in favor of a much simplified workflow. An employee may Request a Vacation, which will need to be approved by their manager. For the purpose of discussion, we&#x2019;ll ignore all other aspects and set out to figure out how we can create a backend for this system.I&#x2019;m going to use a relational database as the backend for now, using the following schema. Note that this is obviously a highly simplified model, ignoring many real-world requirements. But this is sufficient to talk about the actual issue.After looking at the table structure, let&#x2019;s look at the code (again, ignoring data validation, error handling, and other rather important concerns).app.post(&#x27;/api/vacations/request&#x27;, async (req, res) =&gt; {&#xA;    const { employeeId, dates, reason } = req.body;&#xA;&#xA;&#xA;    await pgsql.query(`BEGIN TRANSACTION;`);&#xA;    const managerId = await pgsql.query(&#xA;      `SELECT manager FROM Employees WHERE id = $1;`,&#xA;      [employeeId]).rows[0].id;&#xA;    const vacReqId = await pgsql.query(&#xA;      `INSERT INTO VacationRequests (empId,approver,reason,status)&#xA;       VALUES ($1,$2,$3,&#x27;Pending&#x27;) RETURNING id;`,&#xA;       [employeeId,managerId,reason]).rows[0].id;&#xA;&#xA;&#xA;    for(const date of date) {&#xA;        await pgsql.query(&#xA;          `INSERT INTO VacationRequestDates&#xA;           (vacReqId, date, mandatory ,notes)&#xA;           VALUES ($1, $2, $3, $4);`, &#xA;          [vacReqId, d.date, d.mandatory, d.notes]);&#xA;    }&#xA;     &#xA;    await pgsql.query(`COMMIT;`);&#xA;&#xA;&#xA;    res.status(201).json({ requestId: result.rows[0].id });&#xA;});We create a new transaction, find who the manager for the employee is, and register a new VacationRequest for the employee with all the dates for that vacation. Pretty simple and easy, right? Let&#x2019;s look at the other side of this, approving a request.Here is how a manager is able to get the vacation dates that they need to approve for their employees. app.get(&#x27;/api/vacations/approval&#x27;, async (req, res) =&gt; {&#xA;  const { whoAmI } = req.body;&#xA; &#xA;  const vacations = await pgsql.query(&#xA;    `SELECT VRD.id, VR.empId, VR.reason, VRD.date, E.name,&#xA;           VRD.mandatory, VRD.notes&#xA;    FROM VacationRequests VR&#xA;    JOIN VacationRequestDates VRD ON VR.id = VRD.vacReqId&#xA;    JOIN Employees E ON VR.empId = E.id&#xA;    WHERE VR.approver = $1 AND VR.status = &#x27;Pending&#x27;`,&#xA;    [whoAmI]);&#xA;&#xA;&#xA;  res.status(200).json({ vacations });&#xA;});As you can see, most of the code here consists of the SQL query itself. We join the three tables to find the dates that still require approval.I&#x2019;ll stop here for a second and let you look at the two previous pieces of code for a bit. I have to say, even though I&#x2019;m writing this code specifically to point out the problems, I had to force myself not to delete it. There was mental pressure behind my eyes as I wrote those lines. The issue isn&#x2019;t a problem with a lack of error handling or security. I&#x2019;m explicitly ignoring that for this sort of demo code. The actual problem that bugs me so much is modeling and behavior. Let&#x2019;s look at the output of the previous snippet, returning the vacation dates that we still need to approve. idempIdnamereasondate8483391Johnbirthday2024-08-018484321Janedentist2024-08-028484391Johnbirthday2024-08-02We have three separate entries that we need to approve, but notice that even though two of those vacation dates belong to the same employee (and are part of the same vacation request), they can be approved separately. In fact, it is likely that the manager will decide to approve John for the 1st of August and Jane for the 2nd, denying John&#x2019;s second vacation day. However, that isn&#x2019;t how it works. Since the actual approval is for the entire vacation request, approving one row in the table would approve all the related dates. When examining the model at the row level, it doesn&#x2019;t really work. The fact that the data is spread over multiple tables in the database is an immaterial issue related to the impedance mismatch between the document model and the relational model.Let&#x2019;s try and see if we can structure the query in a way that would make better sense from our perspective. Here is the new query (the rest of the code remains the same as the previous snippet).SELECT VRD.id, VR.empId, E.name, VR.reason,&#xA;    (&#xA;        SELECT json_agg(VRD)&#xA;        FROM VacationRequestDates VRD&#xA;        WHERE VR.id = VRD.vacReqId&#xA;    ) AS dates&#xA;FROM VacationRequests VR&#xA;JOIN Employees E ON VR.empId = E.id&#xA;WHERE VR.approver = $1 AND VR.status = &#x27;Pending&#x27;This is a little bit more complicated, and the output it gives is quite different. If we show the data in the same way as before, it is much easier to see that there is a single vacation request and that those dates are tied together.idempIdnamereasonstatusdate8483391JohnbirthdayPending2024-08-01and 2024-08-028484321JanedentistPending2024-08-02We are going to ignore the scenario of partial approval because it doesn&#x2019;t matter for the topic I&#x2019;m trying to cover. Let&#x2019;s discuss two other important features that we need to handle. How do we allow an employee to edit a vacation request, and how does the manager actually approve a request.Let&#x2019;s consider editing a vacation request by the employee. On the face of it, it&#x2019;s pretty simple. We show the vacation request to the employee and add the following endpoint to handle the update.app.post(&#x27;/api/vacation-request/date&#x27;, async (req, res) =&gt; {&#xA;  const { id, date, mandatory, notes, vacReqId } = req.body;&#xA; &#xA; if(id typeof == &#x27;number&#x27;) {&#xA;  await pgsql.query(&#xA;    `UPDATE VacationRequestDates&#xA;    SET date = $1, mandatory = $2, notes = $3&#xA;    WHERE id = $4`,&#xA;    [date, mandatory, notes, id]);&#xA; }&#xA; else {&#xA;  await pgsql.query(&#xA;    `INSERT INTO VacationRequestDates (date, mandatory, notes, vacReqId)&#xA;    VALUES ($1, $2, $3, $4)`,&#xA;    [date, mandatory, notes, vacReqId]);&#xA; }&#xA; &#xA;  res.status(200);&#xA;});&#xA;&#xA;&#xA;app.delete(&#x27;/api/vacation-request/date&#x27;, async (req, res) =&gt; {&#xA;  const { id } = req.query;&#xA; &#xA;  await pgsql.query(&#xA;    `DELETE FROM VacationRequestDates WHERE id = $1`,&#xA;    [id]);&#xA;&#xA;&#xA;  res.status(200);&#xA;});Again, this sort of code is like nails on board inside my head. I&#x2019;ll explain why in just a bit. For now, you can see that we actually need to handle three separate scenarios for editing an existing request date, adding a new one, or deleting it. I&#x2019;m now showing the code for updating the actual vacation request (such as the reason for the request) since that is pretty similar to the above snippet. The reason that this approach bugs me so much is because it violates transaction boundaries within the solution. Let&#x2019;s assume that I want to take Thursday off instead of Wednesday and add Friday as well. How would that be executed using the current API?I would need to send a request to update the date on one row in VacationRequestDates and another to add a new one. Each one of those operations would be its own independent transaction. That means that either one can fail. While I wanted to have both Thursday and Friday off, only the request for Friday may succeed, and the edit from Wednesday to Thursday might not.It also means that the approver may see a partial state of things, leading to an interesting problem and eventually an exploitable loophole in the system. Consider the scenario of the approver looking at vacation requests and approving them. I can arrange things so that while they are viewing the request, the employee will add additional dates. When the approver approves the request, they&#x2019;ll also approve the additional dates, unknowingly. Let&#x2019;s solve the problem with the transactional updates on the vacation request and see where that takes us:app.post(&#x27;/api/vacation-request/update&#x27;, async (req, res) =&gt; {&#xA;  const { varRecId, datesUpdates } = req.body;&#xA;  await pgsql.query(`BEGIN TRANSACTION;`);&#xA;&#xA;&#xA;  for (const { op, id, date, mandatory, notes } of datesUpdates) {&#xA;    if (op === &#x27;delete&#x27;) {&#xA;      await pgsql.query(`DELETE FROM VacationRequestDates&#xA;        WHERE id = $1;`,&#xA;        [id]);&#xA;    }&#xA;    else if (op === &#x27;insert&#x27;) {&#xA;      await pgsql.query(`INSERT INTO VacationRequestDates&#xA;        (varRecId, date, mandatory, notes)&#xA;        VALUES ($1, $2, $3, $4);`,&#xA;        [varRecId, date, mandatory, notes]);&#xA;     &#xA;    }&#xA;    else {&#xA;      await pgsql.query(`UPDATE VacationRequestDates&#xA;        SET date = $1, mandatory = $2, notes = $3&#xA;        WHERE id = $4;`,&#xA;        [date, mandatory, notes, id]);&#xA;    }&#xA;  }&#xA;&#xA;&#xA;  await pgsql.query(`COMMIT;`);&#xA;  res.status(200);&#xA;});That is&#x2026; a lot of code to go through. Note that I looked into Sequelize as well to see what kind of code that would produce when using an OR/M, it wasn&#x2019;t meaningfully simpler. There is a hidden bug in the code above. But you probably won&#x2019;t notice it no matter how much you&#x2019;ll look into it. The issue is code that isn&#x2019;t there. The API code above assumes that the caller will send us all&#xA0;the dates for the vacation requests, but it is easy to get into a situation where we may edit the same vacation requests from both the phone and the laptop, and get partial information. In other words, our vacation request on the database has four dates, but I just updated three of them. The last one is&#xA0;part of my vacation request, but since I didn&#x2019;t explicitly refer to that, the code above will ignore that. The end result is probably an inconsistent state.In other words, to reduce the impedance mismatch between my database and the way I work with the user, I leaned too much toward exposing the database to the callers. The fact that the underlying database is storing the data in multiple tables has leaked into the way I model my user interface and the wire API. That leads to a significant amount of complexity.Let&#x2019;s go back to the drawing board. Instead of trying to model the data as a set of rows that would be visually represented as a single unit, we need to actually think about a vacation request as a single unit. Take a look at this image, showing a vacation request form. That is how the business conceptualizes the problem: as a single cohesive unit encompassing all the necessary data for submitting and approving a vacation request.Note that for real systems, we&#x2019;ll require a lot more data, including details such as the actual vacation days taken, how they should be recorded against the employee&#x2019;s leave allowance, etc.The important aspect here is that instead of working with individual rows, we need to raise the bar and move to working with the entity as a whole. In modeling terms, this means that we won&#x2019;t work with rows but with Root Aggregate (from DDD terminology).But I already have all of this code written, so let&#x2019;s see how far I can push things before I even hit my own limits. Let&#x2019;s look at the code that is required to approve a vacation request. Here is the first draft I wrote to do so.app.post(&#x27;/api/vacation-request/approve&#x27;, async (req, res) =&gt; {&#xA;  const { varRecId, approver, status } = req.body;&#xA;&#xA;&#xA;  const res = await pgsql.query(`UPDATE VacationRequests&#xA;   SET status = $1 WHERE id = $2 and approver = $3;`,&#xA;    [status, varRecId, approver]);&#xA; &#xA;  if (res.rowCount == 0) {&#xA;    res.status(400)&#xA;      .send({ error: &#x27;No record found or wrong approver&#x27; });&#xA;  }&#xA;&#xA;&#xA;  res.status(200);&#xA;});Which will give me the vacation requests that I need to approve:idempIdnamereasonstatusdate8483391JohnbirthdayPending2024-08-01 and 2024-08-02And then I actually approve it using:POST /api/vacation-request/approve&#xA;{&quot;varRecId&quot;: 8483, &quot;approver&quot;: 9341, &quot;status&quot;: &quot;Approved&quot;}What is the problem now? Well, what happens if the employee modifies the vacation request between the two requests? The approver may end up approving the wrong details. How do we fix that?You may think that you can use locking on the approve operation, but we actually have just a single statement executed, so that doesn&#x2019;t matter. And given that we have two separate requests, with distinct database transactions between them, that isn&#x2019;t even possible.What we need to implement here is called Offline Optimistic Concurrency. In other words, we need to ensure that the version the manager approved is the same as the one that is currently in the database.In order to do that, we need to modify our schema and add a version&#xA0;column to the VacationRequests table, as you can see in the image.Now, any time that I make any modification on the VacationRequest, I must also increment the value of the Version field and check that it matches my expected value.Here is an example of how this looks like when the Employee is adding a new date to the vacation request. I shortened the code that we previously looked at to update a vacation request, so you can more clearly see the changes required to ensure that changes in the request will be detected between requests.app.post(&#x27;/api/vacation-request/insert-date&#x27;, async (req, res) =&gt; {&#xA;  const { varRecId, version,  } = req.body;&#xA;  await pgsql.query(`BEGIN TRANSACTION;`);&#xA;&#xA;&#xA;  const res = await pgsql.query(`UPDATE VacationRequests&#xA;   SET version = version &#x2B; 1&#xA;    WHERE id = $1 and version = $2;`,&#xA;    [varRecId, version]);&#xA;&#xA;&#xA;  if (res.rowCount == 0) {&#xA;    res.status(400)&#xA;      .send({ error: &#x27;No record found or wrong version&#x27; });&#xA;  }&#xA;&#xA;&#xA;  await pgsql.query(`INSERT INTO VacationRequestDates&#xA;        (varRecId, date, mandatory, notes)&#xA;        VALUES ($1, $2, $3, $4);`,&#xA;    [varRecId, date, mandatory, notes]);&#xA;&#xA;&#xA;  await pgsql.query(`COMMIT;`);&#xA;  res.status(200);&#xA;});And on the other side, approving the request is now:app.post(&#x27;/api/vacation-request/approve&#x27;, async (req, res) =&gt; {&#xA;  const { varRecId, approver, version, status } = req.body;&#xA;&#xA;&#xA;  const res = await pgsql.query(`UPDATE VacationRequests&#xA;   SET status = $1 and version = version &#x2B; 1&#xA;   WHERE id = $2 and approver = $3 and version = $4;`,&#xA;    [status, varRecId, approver, version]);&#xA; &#xA;  if (res.rowCount == 0) {&#xA;    res.status(400)&#xA;      .send({ &#xA;         error: &#x27;No record found or wrong approver or version&#x27;&#xA;       });&#xA;  }&#xA;&#xA;&#xA;  res.status(200);&#xA;});We need to send the version to the client when we read it, and when we approve it, we need to ensure that we send the version back, to verify that there have been no changes.I have to say, given that I set out to do something pretty simple, I&#x2019;m actually shocked at how complex this all turned out to be. The solution above also requires cooperation&#xA0;from all entities. If I&#x2019;m ever writing some code that modifies the vacation requests or manages them manually (for maintenance purposes, debugging, etc) I need to also remember to include the version updates.When I started writing this blog post, I intended to also show you how you can model the same situation differently. But I think that this is quite long enough already, and I&#x2019;ll complete the proper modeling concerns in the next post.</p>
        </article>
        <article id="article-256">
            <a href="https://devblogs.microsoft.com/dotnet/testing-your-native-aot-dotnet-apps/" target="_blank">
                <h2 class="title mb-6" id="article-256">Testing Your Native AOT Applications</h2>
            </a>
            <p class="mb-2">by Marco Rossignoli</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 03, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">MSTest introduces a Native AOT compatible test runner and engine for testing your Native AOT applications.</p>
        </article>
        <article id="article-257">
            <a href="https://devblogs.microsoft.com/dotnet/redis-makes-intelligent-apps-smarter-and-consistent/" target="_blank">
                <h2 class="title mb-6" id="article-257">Making AI powered .NET apps more consistent and intelligent with Redis</h2>
            </a>
            <p class="mb-2">by Catherine Wang</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 02, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Redis makes intelligent apps smarter and consistent by serving as additional knowledge store, caching chat history, and semantically cache request and responses for an API. Combined with traditional caching scenarios, Redis is the multi-purpose data store for your intelligent apps.</p>
        </article>
        <article id="article-258">
            <a href="https://andrewlock.net/working-on-a-git-branch-in-two-different-folders-concurrently/" target="_blank">
                <h2 class="title mb-6" id="article-258">Syncing a git branch between Windows and WSL filesystems</h2>
            </a>
            <p class="mb-2">by Andrew Lock</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 02, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post I show how you can work on a git branch with a repository checked out in Windows, and then sync that to another git folder in WSL&#x2026;</p>
        </article>
        <article id="article-259">
            <a href="https://www.meziantou.net/json-schema-validation-in-dotnet.htm" target="_blank">
                <h2 class="title mb-6" id="article-259">Json schema validation in .NET</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 01, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">It is often useful to validate JSON documents against a JSON schema. For example, you may want to validate the JSON document that you receive from a REST API or a configuration file written by a user. In this post, I describe how to validate JSON data against a JSON schema in .NET.TipUsing PowerShe</p>
        </article>
        <article id="article-260">
            <a href="https://devblogs.microsoft.com/dotnet/bing-on-dotnet-8-the-impact-of-dynamic-pgo/" target="_blank">
                <h2 class="title mb-6" id="article-260">Bing on .NET 8: The Impact of Dynamic PGO</h2>
            </a>
            <p class="mb-2">by Ben Watson</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 29, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Bing Extensible Application Platform&#x27;s upgrade to .NET 8 and how dynamic profile guided optimization continues to deliver performance gains</p>
        </article>
        <div class="button flex justify-between">
            <a href="25.html"><span class="back arrow"></span></a>

            <a href="27.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>