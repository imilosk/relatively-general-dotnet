
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 701 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-7001">
            <a href="https://ayende.com/blog/3103/serialazble-isolation-level-on-rows-that-does-not-exists" target="_blank">
                <h2 class="title mb-6" id="article-7001">Serialazble isolation level on rows that does not exists</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 18, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Recently I was asked how to solve this problem. An external service makes a call to the application, to create / update an entity. This call can arrive in one of few endpoints. The catch is that sometimes the external service send the call to create a new entity to all the end points at the same time. This obviously caused issue when trying to insert the same row twice. I suggested using serializable isolation level to handle this scenario, but I wasn&#x27;t sure what kind of guarantees is makes for rows that do not exists. I decided to write this simple test case (warning: test code / quick hack, don&#x27;t write real code like this!). private static void InsertToDatabase(object state)&#xA;{&#xA;    int value = 0;&#xA;&#xA;    while (true)&#xA;    {&#xA;        value &#x2B;= 1;&#xA;        try&#xA;        {&#xA;            using (SqlConnection connection =&#xA;                    new SqlConnection(&quot;data source=localhost;integrated security=sspi;initial catalog=test&quot;))&#xA;            {&#xA;                connection.Open();&#xA;                using (SqlTransaction transaction =&#xA;                        connection.BeginTransaction(IsolationLevel.Serializable))&#xA;                using (SqlCommand command = connection.CreateCommand())&#xA;                {&#xA;                    command.CommandText = &quot;SELECT Id FROM Items WHERE Id = @id&quot;;&#xA;                    command.Parameters.AddWithValue(&quot;id&quot;, value);&#xA;                    command.Transaction = transaction;&#xA;                    if (command.ExecuteScalar() != null)&#xA;                        continue;&#xA;                    command.CommandText = &quot;INSERT INTO Items (Id) VALUES(@id)&quot;;&#xA;                    command.ExecuteNonQuery();&#xA;                    Console.WriteLine(&quot;{1}: Wrote {0}&quot;, value, Thread.CurrentThread.ManagedThreadId);&#xA;&#xA;                    transaction.Commit();&#xA;                }&#xA;            }&#xA;        }&#xA;        catch (SqlException e)&#xA;        {&#xA;            if (e.Number == 1205) //transaction deadlock&#xA;            {&#xA;                Console.WriteLine(&quot;{0}: Deadlock recovery&quot;, Thread.CurrentThread.ManagedThreadId);&#xA;                continue;&#xA;            }&#xA;            Console.WriteLine(e);&#xA;        }&#xA;    }&#xA;}&#xA;As a note, performance for this really sucks if you have contention, and I got a lot of transaction deadlocks when running it with multiply threads.&#xA;What I have observed was that it indeed inserted only a single id. All other isolation levels (including snapshot) will produce duplicate rows in this scenario.&#xA;Assumption proven, now I only need to find what kind of a lock it takes on a row that doesn&#x27;t exists.</p>
        </article>
        <article id="article-7002">
            <a href="https://ardalis.com/silverlight-hyperlink/" target="_blank">
                <h2 class="title mb-6" id="article-7002">Silverlight Hyperlink</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 17, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Playing with Silverlight and needed a simple way to redirect the page. This isn&#x27;t built-in yet but probably will be. For now, you can call&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-7003">
            <a href="https://ardalis.com/tfs-tips/" target="_blank">
                <h2 class="title mb-6" id="article-7003">TFS Tips</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 16, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x2019;m just wrapping up a long article on Team System 2008 and its new capabilities, especially its continuous integration support and build&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-7004">
            <a href="https://ayende.com/blog/3102/rhino-etl-2-0" target="_blank">
                <h2 class="title mb-6" id="article-7004">Rhino ETL 2.0</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 16, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Rhino ETL was born out of a need. I need to do a lot of ETL type operations. Those include anything from moving data from legacy databases to my database, importing files, importing data over web services, etc. For a while, I have used SSIS for those needs. It has proven... inadequate. Mostly in terms of ease of development, deployment, error handling, etc. This is my third attempt at building an ETL tool. The third time is much shorter and clearer than both previous attempts.  The goals for the project were:  Developer friendly:  Errors Development Deployment Performant - I need to move large amounts of data around, and I need to do it fast. Easy - The hard part should be handling the required transforms, dealing with the logic for in/out, etc. Unlimited - You should not be limited to what the tool gives you, and you should be able to integrate easily with other tools Language agnostic - You should be able to develop solutions for this using C#/VB/Boo DSL - Provide a DSL to make it even easier to work with The overall concept is based around these two classes, and the idea of a pipeline:    Here is a simple operation, which just generate all the even numbers to a million: public class EvenNumberToMillion : AbstractOperation&#xA;{&#xA;&#x9;public override IEnumerable&lt;Row&gt; Execute(IEnumerable&lt;Row&gt; rows)&#xA;&#x9;{&#xA;&#x9;&#x9;for(int i = 2; i&lt; 1000000; i &#x2B;= 2)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;Row row = new Row();&#xA;&#x9;&#x9;&#x9;row[&quot;number&quot;] = i;&#xA;&#x9;&#x9;&#x9;yield return row;&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}&#xA;This is an input operation, it ignores its rows parameter, and yields rows generated by some other way. As you can see, we use the yield rows for each iteration. &#xA;We combine operations into a pipeline using the process. If we wanted to print the numbers, we would have build the following pipeline process:&#xA;public class PrintNumbersProcess : EtlProcess&#xA;{&#xA;&#x9;public override void Initialize()&#xA;&#x9;{&#xA;&#x9;&#x9;Register(new EvenNumberToMillion());&#xA;&#x9;&#x9;Register(new PrintNumbers());&#xA;&#x9;}&#xA;}&#xA;All the output of the first operation goes into the second operation, and so on and so forth. Using the DSL it will look like:&#xA;operation EvenNumbersToMillion:&#xA;&#x9;for i in range(1000000,2):&#xA;&#x9;&#x9;yield Row(Number: i)&#xA;&#xA;operation PrintNumbers:&#xA;&#x9;for row in rows:&#xA;&#x9;&#x9;print row.Number&#xA;&#xA;process PrintNumbersProcess:&#xA;&#x9;EvenNumbersToMillion()&#xA;&#x9;PrintNumbers()&#xA;This is just to demonstrate the concept of the pipeline. Now we can get into the interesting operations. As you already surmised, AbstractOperation is the common base class, and you can inherit it to produce rows from any source. &#xA;Inputs&#xA;Rhino ETL offers special support for getting data from a database. It means that you can define it simple as:&#xA;public class ReadUsers : ConventionInputCommandOperation&#xA;{&#xA;    public ReadUsers() : base(&quot;test&quot;)&#xA;    {&#xA;        Command = &quot;SELECT Id, Name,Email FROM Users&quot;;&#xA;    }&#xA;}&#xA;&#xA;Or, using DSL:&#xA;input &quot;test&quot;, Command = &quot;SELECT id, name, email  FROM Users&quot;&#xA;Note the &quot;test&quot; here, it is the name of the connection string in the app.config.&#xA;Outputs&#xA;On the output side, we have more interesting options. We can use any custom option that we want, of course, but for working with databases, we have the following options:&#xA;Standard DB commands:&#xA;public class FibonacciOutput : ConventionOutputCommandOperation&#xA;{&#xA;    public FibonacciOutput() : base(&quot;test&quot;)&#xA;    {&#xA;        Command = &quot;INSERT INTO Fibonacci (Id) VALUES(@Id)&quot;;&#xA;    }&#xA;}&#xA;You&#x27;ll note that I am not specifying the parameters, those are taken implicitly from the current row.&#xA;Using DSL:&#xA;output &quot;test&quot;, Command = &quot;INSERT INTO Fibonacci (Id) VALUES(@Id)&quot;&#xA;&#xA;SQL Batch operations:&#xA;public class FibonacciOutput : ConventionSqlBatchOpeartion&#xA;{&#xA;    public FibonacciOutput() : base(&quot;test&quot;)&#xA;    {&#xA;        Command = &quot;INSERT INTO Fibonacci (Id) VALUES(@Id)&quot;;&#xA;    }&#xA;}&#xA;Using DSL: Haven&#x27;t written that yet :-(&#xA;Sql Bulk Insert:&#xA; public class FibonacciBulkInsert : SqlBulkInsertOperation&#xA;    {&#xA;        public FibonacciBulkInsert() : base(&quot;test&quot;, &quot;Fibonacci&quot;)&#xA;        {&#xA;        }&#xA;&#xA;        protected override void PrepareSchema()&#xA;        {&#xA;            Schema[&quot;id&quot;] = typeof (int);&#xA;        }&#xA;    }&#xA;Using DSL: Haven&#x27;t written that yet :-(&#xA;Files&#xA;For working with files, we have the support of the excellent FileHelpers library, which makes working with files really easy. &#xA;Reading from a file is simply:&#xA;public class UserRecord&#xA;{&#xA;    public string email;&#xA;    public int id;&#xA;    public string name;&#xA;}&#xA;&#xA;public class ReadUsersFromFile : AbstractOperation&#xA;{&#xA;    public override IEnumerable&lt;Row&gt; Execute(IEnumerable&lt;Row&gt; rows)&#xA;    {&#xA;        using(FileEngine file = FluentFile.For&lt;UserRecord&gt;().From(&quot;users.txt&quot;))&#xA;        {&#xA;            foreach (object obj in file)&#xA;            {&#xA;                yield return Row.FromObject(obj);&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;There is 1:1 translation to Boo here, so I&#x27;ll spare you that. &#xA;Writing is very similar:&#xA;public class WriteUsersToFile : AbstractOperation&#xA;{&#xA;    public override IEnumerable&lt;Row&gt; Execute(IEnumerable&lt;Row&gt; rows)&#xA;    {&#xA;        FluentFile engine = FluentFile.For&lt;UserRecord&gt;();&#xA;        engine.HeaderText = &quot;Id\tName\tEmail&quot;;&#xA;        using(FileEngine file = engine.To(&quot;users.txt&quot;))&#xA;        {&#xA;            foreach (Row row in rows)&#xA;            {&#xA;                UserRecord record = new UserRecord();&#xA;                &#xA;                record.Id = (int)row[&quot;id&quot;];&#xA;                record.Name = (string)row[&quot;name&quot;];&#xA;                record.Email = (string)row[&quot;email&quot;];&#xA;&#xA;                file.Write(record);&#xA;            }&#xA;        }&#xA;        yield break;&#xA;    }&#xA;}&#xA;Joins&#xA;Joins are an interesting concept, and I play with them quite extensively recently. Joins in Rhino ETL are implemented as sub processes. Hash joins are very simple:&#xA;public class JoinUsersAndIds : JoinOperation&#xA;{&#xA;&#x9;protected override Row MergeRows(Row leftRow, Row rightRow)&#xA;&#x9;{&#xA;&#x9;&#x9;Row row = leftRow.Clone();&#xA;&#x9;&#x9;row[&quot;user_id&quot;] = rightRow[&quot;new_id&quot;];&#xA;&#x9;&#x9;return row;&#xA;&#x9;}&#xA;&#xA;&#x9;protected override void SetupJoinConditions()&#xA;&#x9;{&#xA;&#x9;&#x9;InnerJoin&#xA;&#x9;&#x9;&#x9;.Left(&quot;id&quot;)&#xA;&#x9;&#x9;&#x9;.Right(&quot;old_id&quot;);&#xA;&#x9;}&#xA;}&#xA;This is just the operation, you hook it up in the process using:&#xA;Register(new JoinUsersAndIds()&#xA;         &#x9;.Left(new GenerateUsers(25000))&#xA;         &#x9;.Right(new GenerateRandomIds(15000)));&#xA;Each side is capable of accepting a full blown sub process on its own.&#xA;Nested loops joins are appropriate for the more complex cases:&#xA;public class FullJoinUsersToPeopleByEmail : NestedLoopsJoinOperation&#xA;{&#xA;    protected override bool MatchJoinCondition(Row leftRow, Row rightRow)&#xA;    {&#xA;        return LeftJoin(leftRow[&quot;email&quot;], rightRow[&quot;email&quot;]);&#xA;    }&#xA;&#xA;&#x9;protected override Row MergeRows(Row leftRow, Row rightRow)&#xA;    {&#xA;        Row row = new Row();&#xA;        row.Copy(leftRow);&#xA;        row[&quot;person_id&quot;] = rightRow[&quot;id&quot;];&#xA;        return row;&#xA;    }&#xA;}&#xA;Using DSL it looks like this:&#xA;join get_user_roles:&#xA;&#x9;left:&#xA;&#x9;&#x9;input &quot;test&quot;, Command = &quot;SELECT id, name, email  FROM Users&quot;&#xA;&#x9;&#x9;&#xA;&#x9;right:&#xA;&#x9;&#x9;nput &quot;test&quot;, Command = &quot;SELECT userid, roleid FROM UsersToRoles&quot;&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;on left.id ==  right.userid:&#xA;&#x9;&#x9;row.Name = left.Name&#xA;&#x9;&#x9;row.Role = right.RoleId&#xA;(A note about this syntax, this currently generate a nested loop join, I intend to make it generate an optimize version soon).&#xA;Branching&#xA;That was quite a challenge to implement, I kept missing a key point, and that tripped me for a while. Here is how send a row to several sources:&#xA;BranchingOperation split = new BranchingOperation()&#xA;&#x9;.Add(Partial&#xA;&#x9;&#x9;.Register(new MultiplyByThreeOperation())&#xA;&#x9;&#x9;.Register(new Fibonacci.Bulk.FibonacciBulkInsert()))&#xA;&#x9;.Add(Partial&#xA;&#x9;&#x9;.Register(new Fibonacci.Bulk.FibonacciBulkInsert()));&#xA;Register(split);&#xA;(Note, the implementation is not as optimized as it could be.)&#xA;Aggregates&#xA;Well, you got to have those, don&#x27;t you? Here is a simple Row Count aggregate:&#xA;public class RowCount : AbstractAggregationOperation&#xA;{&#xA;    &#x9;protected override void Accumulate(Row row, Row aggregate)&#xA;      {&#xA;            if (aggregate[&quot;count&quot;] == null)&#xA;                aggregate[&quot;count&quot;] = 0;&#xA;&#xA;            int count = (int)aggregate[&quot;count&quot;];&#xA;            aggregate[&quot;count&quot;] = count &#x2B; 1;&#xA;      }&#xA;}&#xA;We are called once per row, and can accumulate all the values that we want. We can use grouping to create more interesting results:&#xA;public class CostPerProductAggregation : AbstractAggregationOperation&#xA;{&#xA;    protected override void Accumulate(Row row, Row aggregate)&#xA;    {&#xA;        aggregate[&quot;name&quot;] = row[&quot;name&quot;];&#xA;        if(aggregate[&quot;cost&quot;]==null)&#xA;            aggregate[&quot;cost&quot;] = 0;&#xA;        aggregate[&quot;cost&quot;] = ((int) aggregate[&quot;cost&quot;]) &#x2B; ((int) row[&quot;price&quot;]);&#xA;    }&#xA;&#xA;    protected override string[] GetColumnsToGroupBy()&#xA;    {&#xA;        return new string[] {&quot;name&quot;};&#xA;    }&#xA;}&#xA;We can also override the FinishAggregation(Row) method to complete any calculations when all the rows are completed. Rhino ETL guarantees that we will get the same aggregate row for all the rows that match the same columns, so that is taken care of.&#xA;Using DSL for that is simply:&#xA;aggregate join_product_names:&#xA;&#x9;accumulate:&#xA;&#x9;&#x9;aggregate.names = [] if aggregate.names is null&#xA;&#x9;&#x9;aggregate.names.Add(row.name)&#xA;&#x9;&#xA;&#x9;terminate:&#xA;&#x9;&#x9;aggregate.result = string.Join(&quot;, &quot;, aggregate.names.ToArray(string))&#xA;That is about it for now, I think. You can get the source for Rhino ETL here:&#xA;https://rhino-tools.svn.sourceforge.net/svnroot/rhino-tools/trunk/rhino-etl&#xA;I plan to have a binary release one I am confident that all the notes in this post are no longer relevant.</p>
        </article>
        <article id="article-7005">
            <a href="https://ayende.com/blog/3101/ssis-vs-csv" target="_blank">
                <h2 class="title mb-6" id="article-7005">SSIS vs. CSV</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 15, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Another team have run into this bug, what this basically means is that SSIS is not capable of importing CSV files. The &quot;spec&quot; for CSV files is about three lines long, including the special cases ( of which there are two ) and it hasn&#x27;t changed in a decade.  It boggles the mind that not only isn&#x27;t SSIS capable of doing this, but they are not going to fix it for SSIS 2008. Looks like you would need to wait to SSIS 201x for a version that can handle CSV files.</p>
        </article>
        <article id="article-7006">
            <a href="https://ayende.com/blog/3100/and-in-nhibernate-land" target="_blank">
                <h2 class="title mb-6" id="article-7006">And in NHibernate Land</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 15, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is just an update. Fabio has been porting large swathes of Hibernate 3.2, Paul is dealing with the continued port of Hibernate Search while Dario has focused on porting Hibernate Validator. He has also just started to port Hibernate Shards, which is going to make things very interesting indeed. Me? I am sitting in the corner, admiring the work and occasionally shouting hurray!</p>
        </article>
        <article id="article-7007">
            <a href="https://ardalis.com/olympics-with-silverlight/" target="_blank">
                <h2 class="title mb-6" id="article-7007">Olympics With Silverlight</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 14, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I missed this last week, but it appears that the 2008 Olympics in China will be made available online via Microsoft Silverlight. Every&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-7008">
            <a href="https://ardalis.com/visual-studio-xaml-editing-tip/" target="_blank">
                <h2 class="title mb-6" id="article-7008">Visual Studio XAML Editing Tip</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 14, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">So I&#x2019;m working in XAML in Visual Studio 2008 and it has some nice statement completion features now, like automatically quoting my&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-7009">
            <a href="https://ayende.com/blog/3099/algorithms-joins-and-performance" target="_blank">
                <h2 class="title mb-6" id="article-7009">Algorithms, joins and performance</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 14, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I thought about moving from hashtables to Dictionary&lt;T,K&gt;, I got interesting results. For simple new Dictionary&lt;string,object&gt;(), I expected a significant improvement, but I got this:   This is actually much worse than the result of hashtable &#x2B; ignore case comparison. When I used that, I got this horrendous result:   I tried various other tricks, but none of them change the fact that making 7.5 million calls are going to cost a lot of time. And I want to support more than just 2,500 x 1,500. I changed the implementation to look like this: rightRowsByJoinKey = {}&#xA;for rightRow in right:&#xA;&#x9;key = rightRow.CreateKey( rightJoinParams )&#xA;&#x9;rightRowsByJoinKey[ key ] = [] unless rightRowsByJoinKey[ key ]&#xA;&#x9;rightRowsByJoinKey[ key ].Add(rightRow)&#xA;&#xA;for leftRow in left:&#xA;&#x9;key = leftRow.CreateKey( leftJoinParams )&#xA;&#x9;for matchingRight in rightRowsByJoinKey[ key ] :&#xA;&#x9;&#x9;yield MergeRows( leftRow, rightRow )&#xA;&#xA;Now I have N &#x2B; M, instead on N*M.&#xA;From performance perspective, it means that doing nested loop join on 2,500 x 1,500 result in 3.5 millions comparisons, which is quite a bit, even for such a small set of rows. It took over 6 seconds to run on my machine.&#xA;A hash join, however,will perform&#xA0; measly 5,000 operations to do the same amount of work. On my machine, 2,500 x 1,500 completes in 0.2 seconds, most of which are spend it just initialization of the framework.&#xA;I try to take that to a spin on with two orders of magnitude more rows, 250,000 x 150,000 has completed in 5.48 seconds. Which is very encouraging.&#xA;Hash join is not applicable if you want to join over anything but equality, which is why we need the nested loops join as well.</p>
        </article>
        <article id="article-7010">
            <a href="https://ayende.com/blog/3098/performance-joins-and-why-you-should-always-have-a-profiler" target="_blank">
                <h2 class="title mb-6" id="article-7010">Performance, Joins and why you should always have a profiler</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 14, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I did some heavy duty import process yesterday, and we run into severe performance issue with Rhino ETL joins. Five joins with about 250,000 records on the initial left and a few tens of thousands on the rights took about 2 hours to complete. That was unacceptable, and I decided that I have to fix this issue. I had a fairly good idea about what the issue was. Rhino ETL supports nested loops joins only at the moment, which means that the join is performed as (pseudo code): for leftRow in left:&#xA;&#x9;for rightRow in right:&#xA;&#x9;&#x9;if MatchJoinCondition(leftRow, rightRow):&#xA;&#x9;&#x9;&#x9;yield MergeRows(leftRow, rightRow)&#xA;Obviously the N*M was what causing the problem right? I quickly built a trivial join test, which joined 2,500 rows on the left with 1,500 rows on the right. Trivial stuff, and should result in 1,500 rows returned.&#xA;It executed in 6 seconds. That was a shock. &#xA;Well 1,500 * 2,500&#xA0; = 3,750,000, but it should be that bad. &#xA;Then I run the code under a profiler, and it completed in 29 seconds, but I also saw this:&#xA; &#xA;It is not the nested loop that cost me all this money, it was the hash table lookups!&#xA;The most expensive call was GetHashCodeOfString, we have some globalization stuff here, because I told the hashtable to be case insensitive, I tried removing that and run it under the profiler again, now it dropped to 18 seconds, and we had this cost structure to deal with:&#xA; &#xA;We still spend almost all of our time just doing hash table lookups, although we dropped by 10 seconds this time.&#xA;I don&#x27;t think that I would have ever consider the cost of simply doing the hashtable lookups as the primary cost of the join operations.</p>
        </article>
        <div class="button flex justify-between">
            <a href="700.html"><span class="back arrow"></span></a>

            <a href="702.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>