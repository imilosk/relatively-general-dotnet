
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 653 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-6521">
            <a href="https://ayende.com/blog/3546/stupid-micro-benchmarking-proxy-performance" target="_blank">
                <h2 class="title mb-6" id="article-6521">Stupid Micro Benchmarking: Proxy Performance</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 21, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Let us take a look at this class:     public class Trivial&#xA;{&#xA;    public void EmptyStandard()&#xA;    {&#xA;&#xA;    }&#xA;&#xA;    public virtual void EmptyVirtual()&#xA;    {&#xA;&#xA;    }&#xA;&#xA;    [MethodImpl(MethodImplOptions.NoInlining)]&#xA;    public void EmptyNoInline()&#xA;    {&#xA;&#xA;    }&#xA;&#xA;    [MethodImpl(MethodImplOptions.NoInlining)]&#xA;    public virtual void EmptyVirtualNoInline()&#xA;    {&#xA;&#xA;    }&#xA;}&#xA;&#xA;&#xA;Now let us see what is the effect of using Dynamic Proxy on performance, here is the test rig:&#xA;&#xA;&#xA;  int count = 100000000;&#xA;var trivial = new Trivial();&#xA;Stopwatch sp = Stopwatch.StartNew();&#xA;for (int i = 0; i &lt; count; i&#x2B;&#x2B;)&#xA;    trivial.EmptyStandard();&#xA;Console.WriteLine(&quot;EmptyStandard: &quot; &#x2B; sp.ElapsedMilliseconds);&#xA;sp.Reset();&#xA;sp.Start();&#xA;for (int i = 0; i &lt; count; i&#x2B;&#x2B;)&#xA;    trivial.EmptyVirtual();&#xA;Console.WriteLine(&quot;EmptyVirtual: &quot; &#x2B; sp.ElapsedMilliseconds);&#xA;sp.Reset();&#xA;sp.Start();&#xA;for (int i = 0; i &lt; count; i&#x2B;&#x2B;)&#xA;    trivial.EmptyNoInline();&#xA;Console.WriteLine(&quot;EmptyNoInline: &quot; &#x2B; sp.ElapsedMilliseconds);&#xA;sp.Reset();&#xA;sp.Start();&#xA;for (int i = 0; i &lt; count; i&#x2B;&#x2B;)&#xA;    trivial.EmptyVirtualNoInline();&#xA;Console.WriteLine(&quot;EmptyVirtualNoInline: &quot; &#x2B; sp.ElapsedMilliseconds);&#xA;&#xA;&#xA;trivial = (Trivial)new ProxyGenerator().CreateClassProxy(typeof (Trivial));&#xA;&#xA;sp.Reset();&#xA;sp.Start();&#xA;for (int i = 0; i &lt; count; i&#x2B;&#x2B;)&#xA;    trivial.EmptyVirtual();&#xA;Console.WriteLine(&quot;Proxy EmptyVirtual: &quot; &#x2B; sp.ElapsedMilliseconds);&#xA;&#xA;&#xA;sp.Reset();&#xA;sp.Start();&#xA;for (int i = 0; i &lt; count; i&#x2B;&#x2B;)&#xA;    trivial.EmptyVirtualNoInline();&#xA;Console.WriteLine(&quot;Proxy EmptyVirtualNoInline: &quot; &#x2B; sp.ElapsedMilliseconds);&#xA;&#xA;&#xA;The result of this is:&#xA;&#xA;&#xA;  EmptyStandard: 382&#xA;    EmptyVirtual: 397&#xA;&#xA;    EmptyNoInline: 557&#xA;&#xA;    EmptyVirtualNoInline: 520&#xA;&#xA;    Proxy EmptyVirtual: 6628&#xA;&#xA;    Proxy EmptyVirtualNoInline: 6372&#xA;&#xA;&#xA;On first glance, it is horrible, using a proxy have a 10x perf penalty. But notice just how many times I am running the code. a hundred million times, to be able to get anything observable.&#xA;&#xA;As usual, this micro benchmark basically means that I don&#x27;t really care about such things :-)</p>
        </article>
        <article id="article-6522">
            <a href="https://ayende.com/blog/3545/enabling-change-by-hard-coding-everything-the-smart-way" target="_blank">
                <h2 class="title mb-6" id="article-6522">Enabling change by hard coding everything: the smart way</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 21, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Okay, hopefully this post has caused enough interest in the subject. Let us explore what I said:     I consider hard coding as much as possible as a key concept in enabling change.   The first part that you need to notice is &quot;as much as possible&quot;. This is another way of saying YAGNI. That is, if you don&#x27;t really need it flexible, just hard code it. JFHCI is my new motto. When accepting an order, we want to give 5 percent discount for preferred members. How are we going to handle this scenario?  We will hard code it!     public void SumbitOrder()&#xA;{&#xA;&#x9;if ( User.IsPrferred ) &#xA;&#x9;&#x9;AddDiscountPrecentage(5);&#xA;&#x9;// do other interesting stuff&#xA;}&#xA;&#xA;&#xA;Oh, you also need to change that? Bummer, I guess we can&#x27;t hard code this. And at this point, the typical reaction is usually one of the following:&#xA;&#xA;&#xA;  Let us go with a rules engine! &#xA;&#xA;  Let us build a DSL! &#xA;&#xA;  We should write a framework! &#xA;&#xA;  Put it in XML! &#xA;&#xA;&#xA;From the tone of this post, you can probably understand that this is not something that I am going to suggest. I am going to suggest that we will still should hard code it. But this time, we should hard code it in a smart fashion.&#xA;&#xA;It is easier to show the code than to explain:&#xA;&#xA;&#xA;  public class DiscountPreferredMembers : OnOrderSubmittal&#xA;{&#xA;&#x9;public override void Execute()&#xA;&#x9;{&#xA;&#x9;&#x9;if ( User.IsPreferred )&#x9;&#xA;&#x9;&#x9;&#x9;Order.AddDiscountPrecentage(5);&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;As you can see, the business rule is still hard coded. But now we also have a structure to it. With just a tiny bit of infrastructure, we can take this code and start adding other interesting aspects to it. Deploying a DLL containing this class to a specified folder will automatically pick it up and run it at the appropriate times.&#xA;&#xA;Our solution is incredibly simple. We hard code the rules, which is the easiest approach to getting things done. Because we have a structured way of doing that, we can now apply the ways in which we use it. For instance, if we wanted to support runtime replacements of rules, that is easy, all we need to do is to provide a FileSystemWatcher and reload them. If we want to add a rule, we just create a new class for that. If we want to modify a rule, we go and change the hard coded logic.&#xA;&#xA;This post and the previous ones has been intentionally written in a somewhat inflammatory fashion. I want to encourage people to get used to thinking about things in the simplest possible way. Embrace hard coding, it will make your life easier.&#xA;&#xA;Readability is improved, testing is easy, maintainability is a snap.&#xA;&#xA;Just hard code it!</p>
        </article>
        <article id="article-6523">
            <a href="https://ayende.com/blog/3544/basic-intellisense" target="_blank">
                <h2 class="title mb-6" id="article-6523">Basic intellisense</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 21, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In many cases, intellisense is the killer feature that will make all the difference in using a language. However, it is significantly harder than just defining the syntax rules. The main problem is that we need to deal with the current context. Let us take a look at what we would like our intellisense to do for the Quote Generation DSL.        On empty line, show &quot;specification&quot;    On specification parameter, show all available modules.    On empty line inside specification block, show all actions (requires, users_per_machine, same_machine_as)    On action parameter, find appropriate value (available modules for the requires and same_machine_as actions, pre-specified user counts for the users_per_machine)   And this is for a scenario when we don&#x27;t even want to deal with intellisense for the CLR API that we can use&#x2026;   #Develop will give us the facilities, but it can&#x27;t give us the context, this is something that we need to provide.Let us see how this works, shall we?  First, we need to decide what will invoke the intellisense. In this case, I decided to use the typical ctrl&#x2B;space, so I added this:     this.editorControl.ActiveTextAreaControl.TextArea.KeyDown&#x2B;=delegate(object sender, KeyEventArgs e)&#xA;{&#xA;    if (e.Control == false)&#xA;        return;&#xA;    if (e.KeyCode != Keys.Space)&#xA;        return;&#xA;    e.SuppressKeyPress = true;&#xA;    ShowIntellisense((char)e.KeyValue);&#xA;};&#xA;&#xA;&#xA;I don&#x27;t think that this code requires any explanation, so we will move directly to the ShowIntellisense method:&#xA;&#xA;&#xA;  private void ShowIntellisense(char value)&#xA;{&#xA;    ICompletionDataProvider completionDataProvider = new CodeCompletionProvider(this.imageList1);&#xA;&#xA;    codeCompletionWindow = CodeCompletionWindow.ShowCompletionWindow(&#xA;        this,                // The parent window for the completion window&#xA;        editorControl, &#x9;     // The text editor to show the window for&#xA;        &quot;&quot;,&#x9;       &#x9;     // Filename - will be passed back to the provider&#xA;        completionDataProvider,// Provider to get the list of possible completions&#xA;        value&#x9;&#x9;     // Key pressed - will be passed to the provider&#xA;        );&#xA;    if (this.codeCompletionWindow != null)&#xA;    {&#xA;        // ShowCompletionWindow can return null when the provider returns an empty list&#xA;        this.codeCompletionWindow.Closed &#x2B;= CloseCodeCompletionWindow;&#xA;    }&#xA;}&#xA;&#xA;&#xA;We aren&#x27;t doing much here, simply invoking the facilities that #Develop gives us for intellisense. The interesting bit of work all happen in CodeCompletionProvider. There is a lot of boiler plate code there, so we will scan it shortly, and then arrive to the real interesting part:&#xA;&#xA;&#xA;  public class CodeCompletionProvider : ICompletionDataProvider&#xA;{&#xA;    private ImageList imageList;&#xA;&#xA;    public CodeCompletionProvider(ImageList imageList)&#xA;    {&#xA;        this.imageList = imageList;&#xA;    }&#xA;&#xA;    public ImageList ImageList&#xA;    {&#xA;        get&#xA;        {&#xA;            return imageList;&#xA;        }&#xA;    }&#xA;&#xA;    public string PreSelection&#xA;    {&#xA;        get&#xA;        {&#xA;            return null;&#xA;        }&#xA;    }&#xA;&#xA;    public int DefaultIndex&#xA;    {&#xA;        get&#xA;        {&#xA;            return -1;&#xA;        }&#xA;    }&#xA;&#xA;    public CompletionDataProviderKeyResult ProcessKey(char key)&#xA;    {&#xA;        if (char.IsLetterOrDigit(key) || key == &#x27;_&#x27;)&#xA;        {&#xA;            return CompletionDataProviderKeyResult.NormalKey;&#xA;        }&#xA;        return CompletionDataProviderKeyResult.InsertionKey;&#xA;    }&#xA;&#xA;    /// &lt;summary&gt;&#xA;    /// Called when entry should be inserted. Forward to the insertion action of the completion data.&#xA;    /// &lt;/summary&gt;&#xA;    public bool InsertAction(ICompletionData data, TextArea textArea, int insertionOffset, char key)&#xA;    {&#xA;        textArea.Caret.Position = textArea.Document.OffsetToPosition(&#xA;            Math.Min(insertionOffset, textArea.Document.TextLength)&#xA;            );&#xA;        return data.InsertAction(textArea, key);&#xA;    }&#xA;&#xA;    public ICompletionData[] GenerateCompletionData(string fileName, TextArea textArea, char charTyped)&#xA;    {&#xA;        return new ICompletionData[] {&#xA;             new DefaultCompletionData(&quot;Text&quot;, &quot;Description&quot;, 0),&#xA;             new DefaultCompletionData(&quot;Text2&quot;, &quot;Description2&quot;, 1)&#xA;        };&#xA;    }&#xA;}&#xA;&#xA;&#xA;The properties should be self explanatory. ProcessKey allows you decide how to handle the current keypress. Here, you get to see only normal keys (send to the actual text control) and insertion (add the current text to the text control). Another is CompletionDataProviderKeyResult.BeforeStartKey, which tells the control to ignore this key. That is important when you want to narrow the selection choice based on what the user it typing.&#xA;&#xA;InsertAction simply instructs the editor in where to place the newly added text. This is important if the user enabled intellisense in the middle of a term, and you want to fix that term.&#xA;&#xA;GenerateCompletionData is where the real interest lies. Everything else is just user experience, a very important detail, but basically just a detail. GenerateComletionData is where the power lies. (note, this is the appropriate Muhahaha! moment).&#xA;&#xA;The current implementation isn&#x27;t doing much, just returning a hard coded list of values. Note that even this trivial implementation, without any context whatsoever will give you a lot of value. Just because you can now expose more easily the DSL structure. And let us not forget the marketing side of that, if you have intellsense, even if none too intelligent one, you are already way ahead of the game. And here is out result:&#xA;&#xA;&#xA0;&#xA;&#xA;I&#x27;ll go over providing the actual context for the code in another post.</p>
        </article>
        <article id="article-6524">
            <a href="https://ayende.com/blog/3543/enabling-change-by-hard-coding-everything" target="_blank">
                <h2 class="title mb-6" id="article-6524">Enabling change by hard coding everything</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 21, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I had a discussion today about how to make change easier. My take on that was a bit of a surprise to the other guy, &quot;Just hard code everything&quot;.  Yes, I consider hard coding as much as possible as a key concept in enabling change.  I am going to leave this as is for now, and post a continuation for that tomorrow, just to see what kind of response this has.</p>
        </article>
        <article id="article-6525">
            <a href="https://ayende.com/blog/3542/custom-syntax-highlighting" target="_blank">
                <h2 class="title mb-6" id="article-6525">Custom Syntax Highlighting</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 20, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Just using the Boo syntax isn&#x27;t really enough in many cases, you want to handle your own custom keywords, behaviors, etc.  #Develop make this a piece of cake, since it defines the syntax highlighting using an XML file, and handles the actual parsing and coloring on its on. Here is the overall structure of such a file:     &lt;?xml version=&quot;1.0&quot;?&gt;&#xA;&lt;SyntaxDefinition name=&quot;Boo&quot; &#xA;                  extensions=&quot;.boo&quot;&gt;&#xA;  &lt;Environment&gt;&#xA;    &lt;Default bold=&quot;false&quot;&#xA;             italic=&quot;false&quot;&#xA;             color=&quot;SystemColors.WindowText&quot;&#xA;             bgcolor=&quot;SystemColors.Window&quot; /&gt;&#xA;    &lt;Selection bold=&quot;false&quot;&#xA;               italic=&quot;false&quot;&#xA;               color=&quot;SystemColors.HighlightText&quot;&#xA;               bgcolor=&quot;SystemColors.Highlight&quot; /&gt;&#xA;  &lt;/Environment&gt;&#xA;&#xA;  &lt;Digits name=&quot;Digits&quot;&#xA;          bold=&quot;false&quot;&#xA;          italic=&quot;false&quot;&#xA;          color=&quot;DarkBlue&quot; /&gt;&#xA;&#xA;  &lt;RuleSets&gt;&#xA;    &lt;RuleSet ignorecase=&quot;false&quot; &gt;&#xA;      &lt;Delimiters&gt;&amp;amp;&amp;lt;&amp;gt;~!@$%^*()-&#x2B;=|\#/{}[]:;&quot;&#x27; ,&#x9;.?&lt;/Delimiters&gt;&#xA;&#xA;      &lt;Span name=&quot;LineComment&quot;&#xA;            stopateol=&quot;true&quot;&#xA;            bold=&quot;false&quot;&#xA;            italic=&quot;false&quot;&#xA;            color=&quot;Gray&quot; &gt;&#xA;        &lt;Begin &gt;#&lt;/Begin&gt;&#xA;      &lt;/Span&gt;&#xA;&#xA;      &lt;KeyWords name=&quot;JumpStatements&quot;&#xA;                bold=&quot;false&quot;&#xA;                italic=&quot;false&quot;&#xA;                color=&quot;Navy&quot; &gt;&#xA;        &lt;Key word=&quot;break&quot;/&gt;&#xA;        &lt;Key word=&quot;continue&quot;/&gt;&#xA;        &lt;Key word=&quot;return&quot;/&gt;&#xA;        &lt;Key word=&quot;yield&quot;/&gt;&#xA;        &lt;Key word=&quot;goto&quot; /&gt;&#xA;      &lt;/KeyWords&gt;&#xA;&#xA;    &lt;/RuleSet&gt;&#xA;  &lt;/RuleSets&gt;&#xA;&lt;/SyntaxDefinition&gt;&#xA;&#xA;&#xA;As you can see, this is pretty easy to work with. Now let us add our own keywords:&#xA;&#xA;&#xA;  &lt;KeyWords name=&quot;DslKeywords&quot;&#xA;          bold=&quot;false&quot;&#xA;          italic=&quot;false&quot;&#xA;          color=&quot;DarkOrange&quot; &gt;&#xA;  &lt;Key word=&quot;specification&quot;/&gt;&#xA;  &lt;Key word=&quot;users_per_machine&quot;/&gt;&#xA;  &lt;Key word=&quot;requires&quot;/&gt;&#xA;  &lt;Key word=&quot;same_machine_as&quot;/&gt;&#xA;&lt;/KeyWords&gt;&#xA;&#xA;&#xA;Now we need to load the new language definition (don&#x27;t forget to change the name, I changed it to &quot;dsl&quot;) to the editor an select it:&#xA;&#xA;&#xA;  HighlightingManager.Manager.AddSyntaxModeFileProvider(&#xA;    new FileSyntaxModeProvider(@&quot;C:\Path\to\language\definition&quot;));&#xA;//.. setup text editor&#xA;editorControl.SetHighlighting(&quot;dsl&quot;);&#xA;&#xA;&#xA;The result?</p>
        </article>
        <article id="article-6526">
            <a href="https://ardalis.com/recent-podcasts/" target="_blank">
                <h2 class="title mb-6" id="article-6526">Recent Podcasts</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 19, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">My recent DotNetRocks interview with Carl Franklin and Mark Dunn is live now. The three of us discuss our experiences as small business&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-6527">
            <a href="https://ayende.com/blog/3541/smarter-syntax-highlighting" target="_blank">
                <h2 class="title mb-6" id="article-6527">Smarter Syntax Highlighting</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 19, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">My previous approach isn&#x27;t really suited to anything but the most trivial of tasks. What we can do, however, is to utilize existing components that already built this functionality. Let us say that we want to embed a Boo&#x27;s code editor in our application. Here is what we need to do:     public class TextEditorForm : Form&#xA;{&#xA;    public TextEditorForm()&#xA;    {&#xA;        var editorControl = new TextEditorControl&#xA;        {&#xA;            Dock = DockStyle.Fill&#xA;        };&#xA;        Controls.Add(editorControl);&#xA;        editorControl.Document.FormattingStrategy = new BooFormattingStrategy();&#xA;        editorControl.SetHighlighting(&quot;Boo&quot;);&#xA;    }&#xA;}&#xA;public class BooFormattingStrategy : DefaultFormattingStrategy&#xA;{&#xA;    public override void IndentLines(TextArea textArea, int begin, int end)&#xA;    {&#xA;    }&#xA;&#xA;    protected override int SmartIndentLine(TextArea area, int line)&#xA;    {&#xA;        IDocument document = area.Document;&#xA;        LineSegment lineSegment = document.GetLineSegment(line - 1);&#xA;        if (document.GetText(lineSegment).EndsWith(&quot;:&quot;))&#xA;        {&#xA;            LineSegment segment = document.GetLineSegment(line);&#xA;            string str = base.GetIndentation(area, line - 1) &#x2B; Tab.GetIndentationString(document);&#xA;            document.Replace(segment.Offset, segment.Length, str &#x2B; document.GetText(segment));&#xA;            return str.Length;&#xA;        }&#xA;        return base.SmartIndentLine(area, line);&#xA;    }&#xA;}&#xA;&#xA;&#xA;And that gives us this:&#xA;&#xA; &#xA;&#xA;Nice :-)</p>
        </article>
        <article id="article-6528">
            <a href="https://ayende.com/blog/3540/poor-mans-syntax-highlighting" target="_blank">
                <h2 class="title mb-6" id="article-6528">Poor man&#x27;s syntax highlighting</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 19, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Before getting to the more complex scenarios of creating professional DSL, I wanted to start by showing how you can easily create your own syntax highlighting.  This was the result:    And this is the actual code that makes this happens:     private void codeTextBox_TextChanged(object sender, EventArgs e)&#xA;{&#xA;    int prevSelectionStart = codeTextBox.SelectionStart;&#xA;    int prevSelectionLength = codeTextBox.SelectionLength;&#xA;    codeTextBox.SelectionStart = 0;&#xA;    codeTextBox.SelectionLength = codeTextBox.TextLength;&#xA;    codeTextBox.SelectionColor = DefaultForeColor;&#xA;&#xA;    var keyWords = new[] { &quot;specification&quot;, &quot;requires&quot;, &quot;users_per_machine&quot;, &quot;same_machine_as&quot; };&#xA;    foreach (string keyWord in keyWords)&#xA;    {&#xA;        MatchCollection matches = Regex.Matches(codeTextBox.Text, keyWord);&#xA;        foreach (Match match in matches)&#xA;        {&#xA;            codeTextBox.SelectionStart = match.Index;&#xA;            codeTextBox.SelectionLength = match.Length;&#xA;            codeTextBox.SelectionColor = Color.DarkOrchid;&#xA;        }&#xA;    }&#xA;    foreach (Match match in Regex.Matches(codeTextBox.Text, @&quot;@[\w\d_]&#x2B;&quot;))&#xA;    {&#xA;        codeTextBox.SelectionStart = match.Index;&#xA;        codeTextBox.SelectionLength = match.Length;&#xA;        codeTextBox.SelectionColor = Color.DarkSeaGreen;&#xA;    }&#xA;    foreach (Match match in Regex.Matches(codeTextBox.Text, @&quot; \d&#x2B;&quot;))&#xA;    {&#xA;        codeTextBox.SelectionStart = match.Index;&#xA;        codeTextBox.SelectionLength = match.Length;&#xA;        codeTextBox.SelectionColor = Color.DarkRed;&#xA;    }&#xA;&#xA;    codeTextBox.SelectionStart = prevSelectionStart;&#xA;    codeTextBox.SelectionLength = prevSelectionLength;&#xA;}&#xA;&#xA;&#xA;The code in the book comes with the following warning:&#xA;&#xA;&#xA;  The code suffers from multiple bugs, issues and is generally not suited for anything but the simplest scenarios.</p>
        </article>
        <article id="article-6529">
            <a href="https://ayende.com/blog/3539/help-can-you-think-about-a-ui-representation" target="_blank">
                <h2 class="title mb-6" id="article-6529">Help: Can you think about a UI representation?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 19, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am currently writing the chapter about creating professional DSL. One of the subjects that I am dealing with is creating graphical representations of a textual DSL.  Here is the DSL script in question:     specification @vacations:&#xA;&#x9;requires @scheduling_work&#xA;&#x9;requires @external_connections&#xA;&#x9;&#xA;specification @salary:&#xA;&#x9;users_per_machine 150&#xA;&#x9;&#xA;specification @taxes:&#xA;&#x9;users_per_machine 50&#xA;&#xA;specification @pension:&#xA;&#x9;same_machine_as @health_insurance&#xA;&#xA;&#xA;I am not sure what kind of UI representation this should have.&#xA;&#xA;For that matter, let us take the example that I commonly use, of a rule engine for an ordering system:&#xA;&#xA;&#xA;  when order.total &gt; 1000 and order.payment_method = &#x27;CreditCard&#x27;:&#xA;&#x9;apply_discout_of 5.precent&#xA;&#xA;&#xA;How would you visualize that?</p>
        </article>
        <article id="article-6530">
            <a href="https://ayende.com/blog/3538/hibernatingrhinos-com-status" target="_blank">
                <h2 class="title mb-6" id="article-6530">HibernatingRhinos.com status</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 18, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">As you know, I had a server crash, that took down the server, and result in a very trying times trying to contact support. VPSLand support insisted repeatedly that all the data was lost and that there isn&#x27;t anything to be done about it.&#xA;Somehow, however, a technical person got involved. The first time I heard about that was when I got an alert for a full disk in the hosted server, which made me hopeful. A few hours later it was up again. I hurriedly logged in and backed up everything that I cared about to both S3 and locally. It went down a few more times, but at this point, I am past caring.&#xA;The server will move to a different host as soon as I have the time for that. That old adage about the customer being right? It might not always be right, but I am not going to do business with a place that isn&#x27;t going to do the most they can do to help me.</p>
        </article>
        <div class="button flex justify-between">
            <a href="652.html"><span class="back arrow"></span></a>

            <a href="654.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>