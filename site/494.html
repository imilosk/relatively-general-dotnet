
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 494 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-4931">
            <a href="https://ayende.com/blog/4802/concurrentdictionary-getoradd-may-call-the-valuefactory-method-more-than-once" target="_blank">
                <h2 class="title mb-6" id="article-4931">ConcurrentDIctionary.GetOrAdd may call the valueFactory method more than once</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 05, 2011
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Originally posted at 3/28/2011When you assume, you are making an ass out of yourself, you stupid moronic idiot with no sense whatsoever. The ass in question, if anyone cares to think about it, is yours truly.  Let us take a look at the following code snippet:     var concurentDictionary = new ConcurrentDictionary&lt;int, int&gt;();&#xA;var w = new ManualResetEvent(false);&#xA;int timedCalled = 0;&#xA;var threads = new List&lt;Thread&gt;();&#xA;for (int i = 0; i &lt; Environment.ProcessorCount; i&#x2B;&#x2B;)&#xA;{&#xA;    threads.Add(new Thread(() =&gt;&#xA;    {&#xA;        w.WaitOne();&#xA;        concurentDictionary.GetOrAdd(1, i1 =&gt;&#xA;        {&#xA;            Interlocked.Increment(ref timedCalled);&#xA;            return 1;&#xA;        });&#xA;    }));&#xA;    threads.Last().Start();&#xA;}&#xA;&#xA;w.Set();//release all threads to start at the same time&#xA;foreach (var thread in threads)&#xA;{&#xA;    thread.Join();&#xA;}&#xA;&#xA;Console.WriteLine(timedCalled);&#xA;  &#xA;&#xA;What would you say would be the output of this code?&#xA;&#xA;Well, I assumes that it would behave in an atomic fashion, that the implementation is something like:&#xA;&#xA;&#xA;  if(TryGetValue(key, out value))&#xA;   return value;&#xA;&#xA;lock(this)&#xA;{&#xA;   if(TryGetValue(key, out value))&#xA;      return value;&#xA;&#xA;   AddValue( key, valueFactory());&#xA;}&#xA;  &#xA;&#xA;Of course, the whole point of the ConcurentDictionary is that there are no locks. Well, that is nice, except that because I assumed that the call is only made once, I called that with a function that had side effects when called twice.&#xA;&#xA;That was a pure hell to figure out, because in my mind, of course that there was no error with this function.</p>
        </article>
        <article id="article-4932">
            <a href="https://ayende.com/blog/4801/leaving-the-relational-mindset-ravendbs-trees" target="_blank">
                <h2 class="title mb-6" id="article-4932">Leaving the relational mindset &#x2013; RavenDB&#x2019;s trees</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 04, 2011
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Originally posted at 3/24/2011One of the common problems with people coming over to RavenDB is that they still think in relational terms, and implicitly accept relational limitations. The following has been recently brought up at a client meeting. The problem was that they got an error when rendering a page similar to that:    The error is one of RavenDB&#x2019;s Safe-By-Default, and is triggered when you are making too many calls. This is usually something that you want to catch early, and fail fast rather than add additional load to the system. But the problem that the customer was dealing with is that they needed to display different icons for each level of the tree, depending if the item was a container or a leaf.  Inside Raven, categories were modeled as:     { // categories/1&#xA;  &quot;ParentId&quot;: null,&#xA;  &quot;Name&quot;: &quot;Welcome ...&quot;&#xA;}&#xA;&#xA;{ // categories/2&#xA;   &quot;ParentId&quot;: &quot;categories/1&quot;,&#xA;   &quot;Name&quot;: &quot;Chapter 2...&quot;&#xA;}&#xA;  &#xA;&#xA;They had a few more properties, but none that really interests us for this post. The original code was pretty na&#xEF;ve, and did something like:&#xA;&#xA;&#xA;  public IEnumerable&lt;TreeNode&gt; GetNodesForLevel(string level)&#xA;{&#xA;  var categories = from cat in session.Query&lt;Category&gt;()&#xA;                   where cat.ParentId == level&#xA;                   select cat;&#xA;                   &#xA;  foreach(var category in categories)&#xA;  {&#xA;    var childrenQuery = from cat in session.Query&lt;Category&gt;()&#xA;                         where cat.ParentId == category.Id&#xA;                         select cat;&#xA;                         &#xA;     yield return new TreeNode&#xA;     {&#xA;      Name = category.Name,&#xA;      HasChildren = childrenQuery.Count() &gt; 0&#xA;     };&#xA;  }&#xA;}&#xA;  &#xA;&#xA;As you can imagine, this has caused some issues, because we have a classic Select N&#x2B;1 here.&#xA;&#xA;Now, if we were using SQL, we could have done something like:&#xA;&#xA;&#xA;  select *, (select count(*) from Categories child where child.ParentId = parent.Id)&#xA;from Categories parent&#xA;where parent.ParentId = @val&#xA;  &#xA;&#xA;The problem there is that this is a correlated subquery, and that can get expensive quite easily. Other options include denormalizing the count into the Category directly, but we will ignore that.&#xA;&#xA;What we did in Raven is define a map/reduce index to do all of the work for us. It is elegant, but it requires somewhat of a shift in thinking, so let me introduce that one part at a time:&#xA;&#xA;&#xA;  from cat in docs.Categories &#xA;let ids = new [] &#xA;{ &#xA;    new { cat.Id, Count = 0, cat.ParentId }, &#xA;    new { Id = cat.ParentId, Count = 1, ParentId = (string)null } &#xA;} &#xA;from id in ids &#xA;select id &#xA;  &#xA;&#xA;We are doing something quite strange, we need to project two items for every category. The syntax for that is awkward, I&#x2019;ll admit, but it is pretty clear what is going on in here.&#xA;&#xA;Using the categories shown above, we get the following output:&#xA;&#xA;&#xA;  { &quot;Id&quot;: &quot;categories/1&quot;, &quot;Count&quot; = 0, ParentId: null }&#xA;{ &quot;Id&quot;: null, &quot;Count&quot; = 1, ParentId: null }&#xA;&#xA;{ &quot;Id&quot;: &quot;categories/2&quot;, &quot;Count&quot; = 0, ParentId: &quot;categories/1&quot; }&#xA;{ &quot;Id&quot;: &quot;categories/1&quot;,  &quot;Count&quot; = 1, ParentId: null }&#xA;  &#xA;&#xA;The reason that we are doing this is that we need to be able to aggregate across all categories, whatever they are in a parent child relationship or not. In order to do that, we project one record for ourselves, with count set to zero (because we don&#x2019;t know that we are anyone&#x2019;s parents) and one for our parent. Note that in the parent case, we don&#x2019;t know what his parent is, so we set it to null. &#xA;&#xA;The next step is to write the reduce part, which runs over the results of the map query:&#xA;&#xA;&#xA;  from result in results&#xA;group result by result.Id into g &#xA;let parent = g.FirstOrDefault(x=&gt;x.ParentId != null)&#xA;select new &#xA;{ &#xA;     Id = g.Key, &#xA;     Count = g.Sum(x=&gt;x.Count), &#xA;     ParentId = parent == null ? null : parent.ParentId&#xA;}&#xA;  &#xA;&#xA;Here you can see something quite interesting, we are actually group only on the Id of the results. So given our current map results, we will have three groups:&#xA;&#xA;&#xA;  Id is null&#xA;&#xA;  Id is &#x201C;categories/1&#x201D;&#xA;&#xA;  Id&#xA0; is &#x201C;categories/2&#x201D;&#xA;&#xA;&#xA;Note that in the projection part, we are trying to find the parent for the current grouping, we do that by looking for the first record that was emitted, the one where we actually include the ParentId from the record. We then use count to check how many children a category have. Again, because we are emitting a record with Count equal to zero for the each category, they will be included even if they don&#x2019;t have any children.&#xA;&#xA;The result of all of that is that we will have the following items indexed:&#xA;&#xA;&#xA;  { &quot;Id&quot;: null, &quot;Count&quot;: 1, &quot;ParentId&quot;: null }&#xA;{ &quot;Id&quot;: &quot;categories/1&quot;, &quot;Count&quot;: 1, &quot;ParentId&quot;: null }&#xA;{ &quot;Id&quot;: &quot;categories/2&quot;, &quot;Count&quot;: 0, &quot;ParentId&quot;: &quot;categories/1&quot; }&#xA;  &#xA;&#xA;We can now query this index very efficiently to find who are the children of a specific category, and what is the count of their children.&#xA;&#xA;How does this solution compare to writing the correlated sub query in SQL? Well, there are two major advantages:&#xA;&#xA;&#xA;  You are querying on top of the pre-computed index, that means that you don&#x2019;t need to worry about things like row locks, number of queries, etc. Your queries are going to be blazing fast, because there is no computation involved in generating a reply.&#xA;&#xA;  If you are using the HTTP mode, you get caching by default. Yep, that is right you don&#x2019;t need to do anything, and you don&#x2019;t need to worry about managing the cache, or deciding when to expire things, you can just take advantage on the native RavenDB caching system, which will handle all of that for you.&#xA;&#xA;&#xA;Admittedly, this is a fairly simple example, but using similar means, we can create very powerful solutions. It all depends on how we are thinking on our data.</p>
        </article>
        <article id="article-4933">
            <a href="https://ayende.com/blog/4800/and-on-the-first-day-you-push-changes-to-production" target="_blank">
                <h2 class="title mb-6" id="article-4933">And on the first day, you push changes to production</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 03, 2011
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Originally posted at 3/22/2011We recently got a few more employees to Hibernating Rhinos, and I noticed something that was very amusing. It wasn&#x2019;t really intentional, really, but both new developers had pushed code that went into production on the first day on the job.  In contrast, when I got into my new job in 2005, I started a project that by September of 2009, still haven&#x2019;t been able to go into production (and to my knowledge, still isn&#x2019;t in production and likely never will).  It does make one more cautious, I&#x2019;ll admit, but &#x201C;every push is a production release&#x201D; has paid up many times over.</p>
        </article>
        <article id="article-4934">
            <a href="https://www.meziantou.net/subscribe-to-routed-events-even-if-they-are-handled.htm" target="_blank">
                <h2 class="title mb-6" id="article-4934">Subscribe to routed events even if they are handled</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 03, 2011
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">WPF introduces the routed events. These are no longer specific to a single control but are &quot;routed&quot; through the hierarchy of controls.To stop an event, just mark it as handled by setting the property Handled to True in a handler. The WPF routing engine stops propagating it. Anyway, that&#x27;s what you</p>
        </article>
        <article id="article-4935">
            <a href="https://ayende.com/blog/4799/uber-prof-nuget" target="_blank">
                <h2 class="title mb-6" id="article-4935">Uber Prof &amp; NuGet</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 01, 2011
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Fitzchak has all the details in our company blog.</p>
        </article>
        <article id="article-4936">
            <a href="https://ayende.com/blog/4798/code-review-sharparchitecture-multitenant" target="_blank">
                <h2 class="title mb-6" id="article-4936">Code Review</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 01, 2011
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Originally posted at 3/22/2011It has been suggested that I&#x2019;ll look at a more modern implementation of SharpArchitecture, and I was directed toward the MultiTenant project.   The first thing to notice is the number of projects. It is actually hard to keep the number of projects down, as I well know, but this has several strange choices.    I am not really sure what is the point in separating the controllers into a separate assembly, or why we have a separate project for the ApplicationServices.  I am not the only one thinking so, I think:      Then there is the Core project:    Personally, I wouldn&#x2019;t create a project for just two files, but I can live with that. I don&#x2019;t like attributes like DomainSignature. It is hard for me to really say what, except that I think that they encourage a way of thinking that puts the model in the Center of All Things. I am usually much more interested in what something is doing than how it is shaped.  The data project is mostly concerned with setting up NHibernate via Fluent NHibernate.   Next up is the Framework project. And there we run into the following marker interfaces. I really don&#x2019;t like marker interfaces, and having those here doesn&#x2019;t seem to be adding anything important to the application.      It seems that there is a lot going on simply to try to get a fallback to a non tenant situation, but the problem here is that it is usually much better to be explicit about those sort of things. You have the CentralSession, and you have the TenantSession, and you are working with each in a different manner. It makes the infrastructure easier to manage and usually result in code that is clearer to follow.  So far, it has all been pretty much uninteresting, I would strongly encourage merging the solution into just two projects, the web &amp; the tests projects, but that is about it.  Now we move into the fancy bits, the controllers project. And there we find the following piece of code:     public class TenantListQuery : NHibernateQuery, ITenantListQuery&#xA;{&#xA;  public IPagination&lt;TenantViewModel&gt; GetPagedList(int pageIndex, int pageSize)&#xA;  {&#xA;    var query = Session.QueryOver&lt;Tenant&gt;()&#xA;      .OrderBy(customer =&gt; customer.Name).Asc;&#xA;&#xA;    var countQuery = query.ToRowCountQuery();&#xA;    var totalCount = countQuery.FutureValue&lt;int&gt;();&#xA;&#xA;    var firstResult = (pageIndex - 1) * pageSize;&#xA;    TenantViewModel viewModel = null;&#xA;    var viewModels = query.SelectList(list =&gt; list&#xA;                            .Select(mission =&gt; mission.Id).WithAlias(() =&gt; viewModel.Id)&#xA;                            .Select(mission =&gt; mission.Name).WithAlias(() =&gt; viewModel.Name)&#xA;                            .Select(mission =&gt; mission.Domain).WithAlias(() =&gt; viewModel.Domain)&#xA;                            .Select(mission =&gt; mission.ConnectionString).WithAlias(() =&gt; viewModel.ConnectionString))&#xA;      .TransformUsing(Transformers.AliasToBean(typeof(TenantViewModel)))&#xA;      .Skip(firstResult)&#xA;      .Take(pageSize)&#xA;      .Future&lt;TenantViewModel&gt;();&#xA;&#xA;    return new CustomPagination&lt;TenantViewModel&gt;(viewModels, pageIndex, pageSize, totalCount.Value);&#xA;  }&#xA;}&#xA;  &#xA;&#xA;I quite like this code. It is explicit about what it is doing. There is a good reason to hide this sort of thing behind a class, because while it is easy to read, it is also a lot of detailed code that should be abstracted. I like the use of futures to reduce the number of queries, and that we have explicit paging here. I also like the projection directly into the view model. &#xA;&#xA;What I don&#x2019;t like is that I really don&#x2019;t understand how the Session instance is being selected. Oh, I understand how MultiTenantSessionFactoryKeyProvider is working, and that we get the central database because we aren&#x2019;t using a tenanted entity, but it still seems too much magic here I would rather a CentralSession instead.&#xA;&#xA;Another thin that I liked was the code structure:&#xA;&#xA;&#xA;&#xA;All of the code is grouped by feature in a very nice fashion.&#xA;&#xA;My main peeve with the application is that this is basically it. We are talking about an application that is basically two CRUD pages, nothing more. Yes, it is a sample app to show something very specific, but I would have liked to see some more meat there to look at. &#xA;&#xA;Multi tenancy is a hard problem, and this application spend quite a bit of time doing what is essentially connection string management.</p>
        </article>
        <article id="article-4937">
            <a href="https://ayende.com/blog/4797/ravendb-on-net-rocks" target="_blank">
                <h2 class="title mb-6" id="article-4937">RavenDB on .NET Rocks</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 31, 2011
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Carl and Richard talk to Oren Eini, aka Ayende Rahein, about RavenDB. RavenDB is a NoSQL JSON document database. Oren explains how he came to the realization that he needed to build his own data store, and the advantages of document databases over relational databases. Is SQL dead? Not hardly, but RavenDB is an interesting addition to your data solution!   You can listen to it here.</p>
        </article>
        <article id="article-4938">
            <a href="https://ardalis.com/introducing-pair-programming-at-cinci-day-of-agile/" target="_blank">
                <h2 class="title mb-6" id="article-4938">Introducing Pair Programming at Cinci Day Of Agile</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 30, 2011
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Last weekend I presented at the Cincinnati Day of Agile event on Introducing Pair Programming (see on slideshare).&#xA0; The event was nearly&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-4939">
            <a href="https://ayende.com/blog/4796/the-nhibernate-course-is-arrived-to-paris" target="_blank">
                <h2 class="title mb-6" id="article-4939">The NHibernate Course is arrived to Paris</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 30, 2011
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">My NHibernate Course (4 days of digging into the heart &amp; core of NHibernate) is arriving to Paris.   On the 18th April Sebastien Lambla will be teaching this course (in French).  During the course we build a practical application together, that demonstrates all important data management patterns in Nhibernate. You will learn how to use this O/R mapping tool efficiently in your applications to save time and effort on communicating with database storage.   Click here to register.</p>
        </article>
        <article id="article-4940">
            <a href="https://ayende.com/blog/4795/case-study-the-first-ravendbs-production-deployment-story" target="_blank">
                <h2 class="title mb-6" id="article-4940">Case Study: the first RavenDB&#x2019;s production deployment story</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 30, 2011
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">When I sat down over some years ago to actually decide how to go about dealing with that document database idea that wouldn&#x2019;t let me sleep, I did several things. One of them was draw down the architecture of the system, and how to approach the technical challenges that we were seeing. But a much more interesting aspect was deciding to make this into a commercial product. One of the things that I did there was build a business plan for RavenDB. According to that business plan, we were supposed to hit the first production deployment of RavenDB round about now.  In practice, adoption of RavenDB has far outstripped my hopes, and we actually had production deployments for RavenDB within a few months of the public release. What actually took longer than deploying RavenDB was getting the stories back about it . I am going to start posting those as soon as I get the authorization for the customers to do so.  The following is from the first production deployment of RavenDB&#x2026;         1.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Who are you? (Name, company, position)   Henning Christiansen, Senior Consultant at Webstep Fokus, Norway (www.webstep.no) I am working on a development team for a client in the financial sector.  2.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; In what kind of project / environment did you deploy RavenDB?  The client is, naturally, very focused on delivering solutions and value to the business at a high pace. The solutions we build are both for internal and external end users. On top of the result oriented environment, there is a heavy focus on building sustainable and maintainable solutions. It is crucial that modules can be changed, removed or added in the future.   In this particular project, we built a solution based on NServiceBus for communication and RavenDB for persistence. This project is part of a larger development effort, and integrates with both old and new systems. The project sounds unimpressive when described in short, but I&#x27;ll give it a go:  The project&#x27;s main purpose was to replace an existing system for distribution of financial analysis reports. Analysts/researchers work on reports, and submit them to a proprietary system which adds additional content such as tables and graphs of relevant financial data, and generates the final report as XML and PDF. One of the systems created during this project is notified when a report is submitted, pulls it out of the proprietary system, tags it with relevant metadata and stores it in a RavenDB instance before notifying subscribing systems that a new report is available. The reports are instantly available on the client&#x27;s website for customers with research access.   One of the subscribing systems is the distribution system which distributes the reports by email or sms depending on the customer&#x27;s preferences. The customers have a very fine-grained control over their subscriptions, and can filter them on things such as sector, company, and report type among other things. The user preferences are stored in RavenDB. When a user changes preferences, notifications are given to other systems so that other actions can be performed based on what the customers are interested in.  3.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; What made you select a NoSQL solution for your project?  We knew the data would be read a lot more than it would be written, and it needed to be read fast. A lot of the team members were heavily battle-scarred from struggling with ORMs in the past, and with a very tight deadline we weren&#x27;t very interested in spending a lot of time maintaining schemas and mappings.   Most of what we would store in this project could be considered a read model (&#xE0; la CQRS) or an aggregate root (DDD), so a NoSQL solution seemed like a perfect fit. Getting rid of the impedance mismatch couldn&#x27;t hurt either. We had a lot of reasons that nudged us in the direction of NoSQL, so if it hadn&#x27;t been RavenDB it would have been something else.  4.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; What made you select RavenDB as the NoSQL solution?  It was the new kid on the block when the project started, and had a few very compelling features such as a native .NET API which is maintained and shipped with the database itself. Another thing was the transaction support. A few of us had played a bit with RavenDB, and compared to other NoSQL solutions it seemed like the most hassle-free way to get up and running in a .NET environment. We were of course worried about RavenDB being in an early development stage and without reference projects, so we had a plan B in case we should hit a roadblock with RavenDB. Plan B was never put into action.  5.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; How did you discover RavenDB?  I subscribe to your blog (http://ayende.com/Blog/) :)  There was a lot of fuss about NoSQL at the time, and RavenDB received numerous positive comments on Twitter and in blog posts.  6.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; How long did it take to learn to use RavenDB?  I assume you&#x27;re asking about the basics, as there&#x27;s a lot to be learnt if you want to. What the team struggled with the most with was indexes. This was before dynamic indexes, so we had to define every index up front, and make sure they were in the database before querying. Breaking free from the RDBMS mindset and wrapping our heads around how indexes work, map/reduce, and how and when to apply the different analyzers took some time, and the documentation was quite sparse back then. The good thing is that you don&#x27;t really need to know a lot about this stuff to be able to use RavenDB on a basic level.  The team members were differently exposed to RavenDB, so guessing at how long it took to learn is hard. But in general I think it&#x27;s fair to say that indexes was the team&#x27;s biggest hurdle when learning how to use RavenDB.   7.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; What are you doing with RavenDB?  On this particular project we weren&#x27;t using a lot of features, as we were learning to use RavenDB while racing to meet a deadline.  Aside from storing documents, we use custom and dynamic indexes, projections, the client API, and transactions. We&#x27;re also doing some hand-rolled Lucene queries.  On newer projects however, with more experience and confidence with RavenDB, and as features and bundles keep on coming, we&#x27;re doing our best to keep up with the development and making the best use of RavenDB&#x27;s features to solve our problems.  8.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; What was the experience, compared to other technologies?  For one thing, getting up and running with RavenDB is super-easy and only takes a couple of minutes. This is very different from the RDBMS&#x2B;ORM experience, which in comparison seems like a huge hassle. Working with an immature and rapidly changing domain model was also a lot easier, as we didn&#x27;t need to maintain mappings. Also, since everything is a document, which in turn easily maps to an object, you&#x27;re sort of forced to always work through your aggregate roots. This requires you to think through your domain model perhaps a bit more carefully than you&#x27;d do with other technologies which might easier allow you to take shortcuts, and thus compromise your domain model.  9.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; What do you consider to be RavenDB strengths?  It&#x27;s fast, easy to get started with, and it has a growing community of helpful and enthusiastic users. Our support experience has also been excellent, any issues we&#x27;ve had have usually been fixed within hours. The native .NET API is also a huge benefit if you&#x27;re working in a .NET environment  10.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; What do you consider to be RavenDB weaknesses?  If we&#x27;re comparing apples to apples, I can&#x27;t think of any weaknesses compared to the other NoSQL solutions out there aside from the fact that it&#x27;s new. Hence it&#x27;s not as heavily tested in production environments as some of the older NoSQL alternatives might be. The relatively limited documentation, which admittedly has improved tremendously over the last few months, was also a challenge. The community is very helpful, so anything you can&#x27;t find in the documentation can normally be answered by someone on the forum. There&#x27;s also a lot of blog posts and example applications out there.  I find the current web admin UI a bit lacking in functionality, but hopefully the new Silverlight UI will take care of that.  11.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Now that you are in production, do you think that choosing RavenDB was the right choice?  Yes, definitely. We&#x27;ve had a few pains and issues along the way, but that&#x27;s the price you have to pay for being an early adopter. They were all quickly sorted out, and now everything&#x27;s been ticking along like clockwork for months. I&#x27;m confident that choosing RavenDB over another persistence technology has allowed us to develop faster and spend more time on the problem at hand.  12.&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; What would you tell other developers who are evaluating RavenDB?  I have little experience with other document databases, but obviously tested a bit and read blog posts when evaluating NoSQL solutions for this project. Since we decided to go with RavenDB there&#x27;s been a tremendous amount of development done, and at this time none of the competitors are even close featurewise.</p>
        </article>
        <div class="button flex justify-between">
            <a href="493.html"><span class="back arrow"></span></a>

            <a href="495.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>