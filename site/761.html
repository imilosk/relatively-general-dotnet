
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Home â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<script>
    const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

    function getUserPref() {
        const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
        return storedTheme || (lightModePref.matches ? "light" : "dark");
    }

    function setTheme(newTheme) {
        if (newTheme !== "light" && newTheme !== "dark") {
            return console.warn(
                `Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
            );
        }

        const root = document.documentElement;

        // root already set to newTheme, exit early
        if (newTheme === root.getAttribute("data-theme")) {
            return;
        }

        root.setAttribute("data-theme", newTheme);

        const colorThemeMetaTag = document.querySelector("meta[name='theme-color']");
        const bgColour = getComputedStyle(document.body).getPropertyValue("--theme-bg");
        colorThemeMetaTag.setAttribute("content", `hsl(${bgColour})`);
        if (typeof localStorage !== "undefined") {
            localStorage.setItem("theme", newTheme);
        }
    }

    // initial setup
    setTheme(getUserPref());

    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("theme-toggle").addEventListener("click", () => {
            const theme = localStorage.getItem("theme");

            if (theme === "dark") {
                setTheme("light");
            } else {
                setTheme("dark");
            }
        });

        document.getElementById("toggle-navigation-menu").addEventListener("click", (e) => {
            const button = e.target;
            const ariaExpanded = button.getAttribute("aria-expanded");
            const header = document.getElementById("main-header");

            if (ariaExpanded === "true") {
                button.setAttribute("aria-expanded", "false");
                header.classList.remove("menu-open");
            } else {
                button.setAttribute("aria-expanded", "true");
                header.classList.add("menu-open");
            }
        });
    });
</script>

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <theme-toggle class="ms-auto">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main">
    <section aria-label="Blog post list">
        <a href="https://ayende.com/blog/2501/nhibernate-query-generator-more-collections-magic" target="_blank"><h1 class="title mb-6">NHibernate Query Generator - More Collections Magic</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 05, 2007
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I wouldn&#x27;t have expected it to be this hard*, but it is alive! Here is the query:       1:  User one = User.FindOne(   2:         Where.User.Blogs   3:              .With(JoinType.InnerJoin)   4:                   .Name == &quot;Ayende @ Blog&quot;   5:  );&#xA;And the generated SQL:&#xA;&#xA;&#xA;&#xA;   1:  SELECT    2:     this_.Id as Id4_1_,   3:     this_.Name as Name4_1_,   4:     this_.Email as Email4_1_,   5:     blog1_.Id as Id3_0_,   6:     blog1_.Name as Name3_0_,   7:     blog1_.Author as Author3_0_    8:  FROM Users this_ inner join Blogs blog1_    9:     on this_.Id=blog1_.Author   10:  WHERE blog1_.Name = @p0&#xA;And, because Rob has asked, here is how you do a more complex query, over Many To Many association:&#xA;&#xA;&#xA;&#xA;   1:  User one = User.FindOne(   2:      Where.User.Name == &quot;Ayende&quot; &amp;&amp;   3:      Where.User.Roles.With().Name == &quot;Administrator&quot;   4:  );&#xA;And the generated SQL:&#xA;&#xA;&#xA;&#xA;   1:  SELECT this_.Id as Id0_1_,   2:     this_.Name as Name0_1_,   3:     this_.Email as Email0_1_,   4:     roles3_.UserId as UserId__,   5:     role1_.Id as RoleId,   6:     role1_.Id as Id9_0_,   7:     role1_.Name as Name9_0_    8:  FROM Users this_ inner join UsersRoles roles3_    9:     on this_.Id=roles3_.UserId   10:        inner join Roles role1_   11:           on roles3_.RoleId=role1_.Id   12:  WHERE this_.Name = @p0 and role1_.Name = @p1&#xA;It is in the repository now, but right now I would consider it beta stage, it works, but the generation will probably die if you have any sort of interesting schemas (specifically, if you have collections of value types, it is supposed to die horribly with confusing error message).&#xA;I intend to do a screen cast about this area of querying, searching and persistence soon.&#xA;* Right now code generation competes with template magic and three stars code in my internal dislike list. Trying to get the sort of syntax that you see about is really stretching C# to its limits. When can I get a Method Missing implementation&#xA0;on C#? That would actually make my life easier?</p>
        <a href="https://ayende.com/blog/2500/generic-entity-equality" target="_blank"><h1 class="title mb-6">Generic Entity Equality</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 05, 2007
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Just got bit by reference equality vs. value equality again. Since this is the third time that I am writing this base class, I decided to put it in the blog for future reference (I wrote it first and forgot to overload the == / != operators).    By the way, this is the perfect example of a Mixin.    Updated: Ben Scheirman&#xA0;reminded me that I need to handle trasient objects as well.                      /// &lt;summary&gt;                        /// This is a trivial class that is used to make sure that Equals and GetHashCode                        /// are properly overloaded with the correct semantics. This is exteremely important                        /// if you are going to deal with objects outside the current Unit of Work.                        /// &lt;/summary&gt;                        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;                        /// &lt;typeparam name=&quot;TKey&quot;&gt;&lt;/typeparam&gt;                        public abstract class EqualityAndHashCodeProvider&lt;T, TKey&gt;                        &#xA0;&#xA0;&#xA0; where T : EqualityAndHashCodeProvider&lt;T, TKey&gt;                        {                        &#xA0;&#xA0;&#xA0; private int? oldHashCode;                                &#xA0;                        &#xA0;&#xA0;&#xA0; /// &lt;summary&gt;                        &#xA0;&#xA0;&#xA0; /// Determines whether the specified &lt;see cref=&quot;T:System.Object&quot;&gt;&lt;/see&gt; is equal to the current &lt;see cref=&quot;T:System.Object&quot;&gt;&lt;/see&gt;.                        &#xA0;&#xA0;&#xA0; /// &lt;/summary&gt;                        &#xA0;&#xA0;&#xA0; /// &lt;param name=&quot;obj&quot;&gt;The &lt;see cref=&quot;T:System.Object&quot;&gt;&lt;/see&gt; to compare with the current &lt;see cref=&quot;T:System.Object&quot;&gt;&lt;/see&gt;.&lt;/param&gt;                        &#xA0;&#xA0;&#xA0; /// &lt;returns&gt;                        &#xA0;&#xA0;&#xA0; /// true if the specified &lt;see cref=&quot;T:System.Object&quot;&gt;&lt;/see&gt; is equal to the current &lt;see cref=&quot;T:System.Object&quot;&gt;&lt;/see&gt;; otherwise, false.                        &#xA0;&#xA0;&#xA0; /// &lt;/returns&gt;                        &#xA0;&#xA0;&#xA0; public override bool Equals(object obj)                        &#xA0;&#xA0; &#xA0;{                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; T other = obj as T;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (other == null)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return false;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; //to handle the case of comparing two new objects                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; bool otherIsTransient = Equals(other.Id ,default(TKey));                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; bool thisIsTransient = Equals(this.Id, default(TKey));                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (otherIsTransient &amp;&amp; thisIsTransient)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return ReferenceEquals(other, this);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return other.Id.Equals(Id);                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; /// &lt;summary&gt;                        &#xA0;&#xA0;&#xA0; /// Serves as a hash function for a particular type. &lt;see cref=&quot;M:System.Object.GetHashCode&quot;&gt;&lt;/see&gt; is suitable for use in hashing algorithms and data structures like a hash table.                        &#xA0;&#xA0;&#xA0; /// &lt;/summary&gt;                        &#xA0;&#xA0;&#xA0; /// &lt;returns&gt;                        &#xA0;&#xA0;&#xA0; /// A hash code for the current &lt;see cref=&quot;T:System.Object&quot;&gt;&lt;/see&gt;.                        &#xA0;&#xA0;&#xA0; /// &lt;/returns&gt;                        &#xA0;&#xA0;&#xA0; public override int GetHashCode()                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; //This is done se we won&#x27;t change the hash code                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (oldHashCode.HasValue)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return oldHashCode.Value;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; bool thisIsTransient = Equals(this.Id, default(TKey));                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; //When we are transient, we use the base GetHashCode()                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; //and remember it, so an instance can&#x27;t change its hash code.                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (thisIsTransient)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; oldHashCode = base.GetHashCode();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return oldHashCode.Value;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return Id.GetHashCode();                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; /// &lt;summary&gt;                        &#xA0;&#xA0;&#xA0; /// Get or set the Id of this entity                        &#xA0;&#xA0;&#xA0; /// &lt;/summary&gt;                        &#xA0;&#xA0;&#xA0; public abstract TKey Id { get; set; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; /// &lt;summary&gt;                        &#xA0;&#xA0;&#xA0; /// Equality operator so we can have == semantics                        &#xA0;&#xA0;&#xA0; /// &lt;/summary&gt;                        &#xA0;&#xA0;&#xA0; public static bool operator ==(EqualityAndHashCodeProvider&lt;T, TKey&gt; x, EqualityAndHashCodeProvider&lt;T, TKey&gt; y)                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return Equals(x, y);                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; /// &lt;summary&gt;                        &#xA0;&#xA0;&#xA0; /// Inequality operator so we can have != semantics                        &#xA0;&#xA0;&#xA0; /// &lt;/summary&gt;                        &#xA0;&#xA0;&#xA0; public static bool operator !=(EqualityAndHashCodeProvider&lt;T, TKey&gt; x, EqualityAndHashCodeProvider&lt;T, TKey&gt; y)                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return !(x == y);                        &#xA0;&#xA0;&#xA0; }                        }</p>
        <a href="https://ayende.com/blog/2499/obscuring-http" target="_blank"><h1 class="title mb-6">Obscuring HTTP</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 05, 2007
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Jeff Perrin&#xA0;do a really great job is sumrising what the biggest issue with WebForm is:Now the first problem with Webforms is not that it&#x2019;s an abstraction, or even that it&#x2019;s a leaky one (they all are). The problem is that what Webforms attempts to abstract away is actually simpler than the abstraction!</p>
        <a href="https://ayende.com/blog/2498/more-views-from-an-or-m-person" target="_blank"><h1 class="title mb-6">More views from an OR/M person</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 05, 2007
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Rob Conery&#xA0;responded in a comment to my previous post, which includes some interesting points of discussion.I think, in your example above, that it&#x27;s only fair to also include the &quot;under the hood&quot; stuff you need to map these associations. In other words - I count the XML mapping as line of code too :) since this is code and it does have to be maintained.    Okay, no problem, I am using [ActiveRecord] attributes, so that puts me about 1-2 lines of attributes per property &#x2B; 1 to 2 lines of code per entity. You can see the mapping in the first example that I have posted.Your code sample RE the forum bits is a great exhibition of the power of the NHibernate query tool, but at the same time it reminds me of LINQ - why not just write SQL? I understand that in many cases you&#x27;d want to abstract that stuff away in case you change DBs    I am not using OR/M because I want to keep the DB abstracted. I am using an OR/M because it frees me from a lot of persistence related concerns and allows me to concentrate on the domain and the business problems.In terms of perf vs maintainability - I really think this needs more consideration. To be honest, who&#x27;s the app for anyway? The dev team or the client?    Only in the most extreme cases, and even then, after you have measured. Because the client is king, you want to ensure that you can keep giving value from the code that you have written. I am not seeing a problem between maintainable applications and performant applications, on the contrary. Maintainable applications give you a lot more flexibility in performance tuning.Less lines of code - more direct: (SELECT * FROM MyView).    Also, less performant, no?    BTW, why did you bring MySQL to the discussion?</p>
        <a href="https://ayende.com/blog/2497/on-the-advantages-of-one-off-tools" target="_blank"><h1 class="title mb-6">On the advantages of one off tools</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 05, 2007
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I don&#x27;t like general purpose code generation, but I am fan of special purpose ones. The main reason that I don&#x27;t like the general purpose ones is in my experience they have invariably fell into the &quot;Generate code that I don&#x27;t like&quot; or &quot;Requires too much futzing to get to work the way I want it.&quot; Part of it is related to the fact that I consider generated code as a maintainability concern as well, and I am very nervous about trying to do that. Nevertheless, I do like code generation, I tend to write simple code-generators for a lot of purposes. In my current project, we have a lot of churn in database schema wise (add field, rebuild, get a new DB), but we also have all kinds of ETL process to and from the DB, so that makes life more interesting. I wrote a code generator based on SMO that reads the DB schema after NHibernate generates it, and basically handles ~85% of the ETL process mess. The nice thing about doing a one off tool is that I can make a lot of assumptions about the structure that I will be using (all tables has PK named Id, for instances) that a general purpose tool cannot make.</p>
        <a href="https://ayende.com/blog/2496/as-an-or-m-person" target="_blank"><h1 class="title mb-6">As an OR/M Person...</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 05, 2007
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I really should learn not to read blogs at 1AM, nevertheless...    Rob Conery (SubSonic) talks about why OR/M sucks:If you&#x27;re an ORM person, ask yourself how much code you need to write to support a many to many relationship...    Just to demonstrate:         1: [HasAndBelongsToMany(Table=&quot;UsersToRoles&quot;, ColumnKey =&quot;`User`&quot;, ColumnRef = &quot;Role&quot;)]         2: public ISet&lt;Role&gt; Users { get { ... } set { ... } }        I also get lovely relational DB as a side benefit, but that is beside the point. Rob brings the point about &quot;what is a DB from OO point of view&quot; which came out in the OR/M Smackdown, I will give the same answer that I did then, if the tools does that, feel free to shot the tool.Your goal should always be performance - don&#x27;t sacrifice extra connections just to satisfy the ORM design model.    Rob, that sounds like a limitation of the tool, not the technology.    And my firstmost goal&#xA0;is rarely performance, actually, it is maintainability.Think of the code you&#x27;d have to write in an ORM model to get something like a summary thread list for a forum app - you&#x27;d want to show the name of the thread, the number of replies, and the date/author of the last reply. How do you do this with ORM? The answer: lots of code.    Ha? Didn&#x27;t checked it, but it is something in the order of: &quot;select thread.Name, count(thread.Replies), r.DatePublished, r.User.Name from Thread thread, Reply r where r.Id = (select max(r.Id) from Reply where r.Thread = thread)&quot;.&#xA0; Not really that much code at all, actually. Worst case scenario,&#xA0;I resort to something like this, which is still not a lot of code.</p>
        <a href="https://ayende.com/blog/2495/nhibernate-query-generator-collection-querying" target="_blank"><h1 class="title mb-6">NHibernate Query Generator - Collection querying</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 05, 2007
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In the repository (Exists / NotExists):        1:  [Test]   2:  public void CanQueryOverCollections()   3:  {   4:      User one = User.FindOne(Where.User.Blogs.Exists(   5:                                  Where.Blog.Name == &quot;Ayende @ Blog&quot;   6:                                  ));   7:      Assert.IsNotNull(one);   8:  }&#xA0;&#xA;Will result in:&#xA;&#xA0;&#xA;   1:  SELECT this_.Id as Id4_0_, this_.Name as Name4_0_, this_.Email as Email4_0_    2:  FROM Users this_ WHERE exists (SELECT this_0_.Id as y0_ FROM Blogs    3:  this_0_ WHERE this_0_.Name = @p0)&#xA;&#xA0;&#xA;Fluent interfaces? Take that.</p>
        <a href="https://ayende.com/blog/2494/repository-t-syntactic-sugar-and-ddd" target="_blank"><h1 class="title mb-6">Repository&lt;T&gt;, Syntactic Sugar and DDD</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 05, 2007
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am toying around with several ideas about the use of Repository&lt;T&gt; in DDD context. Right now it is theoretical because my current project has little need for DDD. At the moment, I am using the static access for Repository&lt;T&gt; as my gateway for the repositories.       1:  public class OrdersController : BaseController   2:  {   3:      public void CalculateTaxes(int customerId)   4:      {   5:          Customer customer = Repository &lt;Customer&gt;.Load(customerId);   6:          ICollection&lt;Order&gt; orders = Repository&lt;Order&gt;.FindAll(Where.Order.Customer == customer &amp;&amp;   7:                         Where.Order.Status == OrderStatus.ReadyToShip &amp;&amp;   8:                         Where.Order.Date &gt;= DateTime.Today);   9:  &#xA0;  10:          Employee lowestEmployeeResponsibleForCustomer =   11:              Repository&lt;Employee&gt;.FindFirst(Where.Employees.Customers.Contains(customer),   12:                  OrderBy.Employee.Level.Asc);  13:  &#xA0;  14:          foreach (Order order in orders)  15:          {  16:              customer.ApplyDiscount(order);  17:              lowestEmployeeResponsibleForCustomer.Dispatch(order);  18:          }  19:      }  20:  }&#xA;Another style may utilize a base controller as the place to put the repositories, like this:&#xA; &#xA;The resulting code looks like this:&#xA;&#xA;&#xA;&#xA;   1:  public class OrdersController : BaseController   2:  {   3:      public void CalculateTaxes(int customerId)   4:      {   5:          Customer customer = Customers.Load(customerId);   6:          ICollection&lt;Order&gt; orders = Orders.FindAll(Where.Order.Customer == customer &amp;&amp;   7:                         Where.Order.Status == OrderStatus.ReadyToShip &amp;&amp;   8:                         Where.Order.Date &gt;= DateTime.Today);   9:  &#xA0;  10:          Employee lowestEmployeeResponsibleForCustomer =   11:              Employees.FindFirst(Where.Employees.Customers.Contains(customer),   12:                  OrderBy.Employee.Level.Asc);  13:  &#xA0;  14:          foreach (Order order in orders)  15:          {  16:              customer.ApplyDiscount(order);  17:              lowestEmployeeResponsibleForCustomer.Dispatch(order);  18:          }  19:      }  20:  }&#xA0;&#xA0;&#xA;I really like the Repository&lt;T&gt; static accessor for stuff like tests that requires data setup, but I think that using it in the controllers may be over doing it. I like the second approach better, because the syntax doesn&#x27;t have &lt;T&gt; all over the place, as well. It is also nicer from the point of view of syntax and it allows to replace the current IRepository&lt;User&gt; with IUserRepository very easily. &#xA;Thoughts?</p>
        <a href="https://ayende.com/blog/2493/performance-and-explicit-domain-models" target="_blank"><h1 class="title mb-6">Performance and Explicit Domain Models</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 05, 2007
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Udi talks about limitations for DDD as a result of performance constraints. He says:  Ayende and I had an email conversation that started with me asking what would happen if I added an Order to a Customer&#x2019;s &#x201C;Orders&#x201D; collection, when that collection was lazy loaded. My question was whether the addition of an element would result in NHibernate hitting the database to fill that collection. His answer was a simple &#x201C;yes&#x201D;. In the case where a customer can have many (millions) of Orders, that&#x2019;s just not a feasible solution. He then goes on to describe several solutions for the issue, including [ThreadStatic] events, something I have never consider but has some interesting possibilities. I wanted to add another option to the mix. You can extend NHibernate so calling customer.Orders.Add( new Order() ) will not force a load of the collection if the collection is not loaded, but would still add the new order to the unit of work. What is the caveat? It violates the principal of least surprise. My NHibernate.Generics collection used to do just that, I did it on the belief that it would save performance in un-needed trips to the database. I paid for that performance in grief when I found bugs where this failed:       1:  customer.Orders.Add(new Order())   2:  // sometime later, still in the same Unit of Work   3:  if(customer.Orders.Contains(theOrder)==false)   4:  {   5:    //do something bad   6:  }&#xA0;&#xA;Basically, the&#xA0;order was not persisted yet, and when the collection was loaded from the database, it&#xA0;didn&#x27;t include the newly added instance, which&#xA0;caused quite a bit of confusion. We have run into it several times, and&#xA0;it convinced me that I really shouldn&#x27;t do things that would surprise the naive developer, since&#xA0;that&#xA0;tends to be me.&#xA;&#xA0;&#xA;I wanted to mention this, since it is&#xA0;a viable alternative for this scenario, since you aren&#x27;t likely to load the Orders collection any time soon anyway.</p>
        <a href="https://ayende.com/blog/2492/debugging-nhibernate" target="_blank"><h1 class="title mb-6">Debugging NHibernate</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: June 04, 2007
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Today we had a problem with an NHibernate query that was failing which had quite stumped. Pulling the usual tricks didn&#x27;t work, debugging NHibernate was problematic, since the failing query was damn complex, and I had no clear idea why this was failing. After a while, I decided that trying the top down approach will not work, and that I need more structure in finding out the issue.    Did I mentioned that the query was complex? The object model is big as well, and the query managed to touch just about all of it. Getting it slimmed down to a reproducable version was hard, because I wasn&#x27;t sure what caused the issue, but eventually I managed to get it to fail the way I wanted it. (In the process I walked through parts of NHibernate that I haven&#x27;t met before, interesting.    The end result are these tests (there is a reason that I know that C# has a 512 characters limits on identifiers):            CanMakeCriteriaQueryAcrossBothAssociationsWhenBothAssoicationsHasSameColumnKeyNameAndUsingPagingInSqlServer2005            CanLoadCollectionUsingLeftOuterJoinWhenBothCollectionsHasTheSameColumnKeyNameAndOneIsNull    I still don&#x27;t have an answer, but now I have much harder questions...This post is dedicated to Rinat, who says that she doesn&#x27;t knows NHibernate, but can make queries so complex both NHibernate and SQL Server begs for mercy.</p>
        <div class="button flex justify-between">
            <a href="760.html"><span class="back arrow"></span></a>

            <a href="762.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
</body>
</html>