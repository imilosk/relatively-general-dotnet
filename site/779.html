
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 779 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-7781">
            <a href="https://ayende.com/blog/2583/nhibernates-xml-in" target="_blank">
                <h2 class="title mb-6" id="article-7781">NHibernate&#x27;s Xml In</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 21, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I wrote it because of a particular problem that I have run into, which is not something that I have heard much discussion about. In my application, I need to query the database about a certain data, and the best way to do that would be using an in query. For the purpose of discussion, I want to find all the customers associated with the current user.    Unfortantely, I can&#x27;t do something as simple as &quot;Where.Customer.User == CurrentUser&quot;, because a customer may be associated to a user in many complex and interesting ways (the end result is a 3 pages query, btw). Therefor, I make the calculation of who are the relevant customers for a user when they login, and cache that.    So, I need to ask the database for all the customers assoicated with the user, and since I already know about the user&#x27;s customers. In() was a natrual way to go. The problem is that I actually began to run into SQL Server 2,100 parameters per query limit when important users (who has a lot of associations) started to use that.    Can you say, major stumbling block? There are several solutions for that, and the one I choose is to extend NHibernate to perform an IN query on an XML datatype, as described here. You can see the implementation here.    Why use an IN on XML instead of a join against the data? I can send it to the database using BulkCopy and then join against that very easily, no? (I describe one such way here)    Using Bulk Copy&#xA0;&amp; Join approach would probably turn out to be faster than an IN on an XPath (haven&#x27;t tested, though). But&#xA0;as it turn out, I had several reasons for that:            Using the BulkCopy&#xA0;&amp; Join approach would mean that I need to perform two DB Queries, instead of one.            Someone should be responsible for clearing the joined table at one point, that is another thing to deal with.            It requires a two steps process, with no easy way to back out of that if there is a small amount of items that we want to check.            Caching    Using the BulkCopy &amp; Join basically means that I have no real way to avoid hitting the database altogether. Using this approach, I am merely adding a (potentially large) parameter to the query, and let NHibernate deals with everything else.    The way you use this is simple:            session.CreateCriteria(typeof(Customer))        &#xA0;&#xA0;&#xA0; .Add(XmlIn.Create(&quot;id&quot;, potentiallyLargeAmount))        &#xA0;&#xA0;&#xA0; List();        It will automatically default to normal IN behavior if you are not running on SqlServer 2005 or if the amount of items that you are checking is smaller than 100.</p>
        </article>
        <article id="article-7782">
            <a href="https://ayende.com/blog/2582/hierarchical-containers" target="_blank">
                <h2 class="title mb-6" id="article-7782">Hierarchical Containers</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 21, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is somewhat of a specific scenario, but let us assume that you have an application where you want to specialize the services of the applications by the current user. If the user belongs to the Northwind customer, you want to have one behavior, and if it belongs to the Southsand customer, you want to have a different behavior. All users from all others customers get the default behavior. To make it simple, let us talk about NHibernate configuration. You have a default schema that you use for most customers, and you specialize that for those customers that wants extra. This means that you need to keep a session factory per customer, because you have different schema that in the default one (changing the connection string is not enough). To be clear, this is not about entity inheritance, this is about specialization of the entire application, which I just happened to demonstrate via NH configuration. Now, Windsor supports this ability by having a parent container and child containers, but Binsor didn&#x27;t expose this functionality easily, I did some work on it today, and the end result is that you can configure it like this: We have the global container (implicit to Binsor, since we created it before we run the Binsor script), then we run over the configuration files and create a container per each file. We register them in the ContainerSelector, which is an application level service (below). import HierarchicalContainers&#xA;import System.IO&#xA;&#xA;Component(&quot;nhibernate_unit_of_work&quot;, IUnitOfWorkFactory, NHibernateUnitOfWorkFactory,&#xA;&#x9;configurationFileName: &quot;&quot;&quot;..\..\hibernate.cfg.xml&quot;&quot;&quot;)&#xA;&#x9;&#xA;Component(&quot;nhibernate_repository&quot;, IRepository, NHRepository)&#xA;Component(&quot;container_selector&quot;, ContainerSelector)&#xA;&#xA;for configFile in Directory.GetFiles(&quot;&quot;&quot;..\..\Configurations&quot;&quot;&quot;, &quot;*.cfg.xml&quot;):&#xA;&#x9;continue if Path.GetFileName(configFile) == &quot;hibernate.cfg.xml&quot;&#xA;&#x9;print &quot;Build child configuration for ${configFile}&quot;&#xA;&#x9;child = RhinoContainer(IoC.Container)&#xA;&#x9;using IoC.UseLocalContainer(child):&#xA;&#x9;&#x9;Component(&quot;nhibernate_unit_of_work&quot;, IUnitOfWorkFactory, NHibernateUnitOfWorkFactory,&#xA;&#x9;&#x9;&#x9;configurationFileName: configFile)&#xA;&#x9;&#x9;Component(&quot;nhibernate_repository&quot;, IRepository, NHRepository)&#xA;&#x9;#need to remove both .cfg and .xml&#xA;&#x9;containerName = Path.GetFileNameWithoutExtension(Path.GetFileNameWithoutExtension(configFile))&#xA;&#x9;IoC.Container.Resolve(ContainerSelector).Register(containerName, child)&#xA;You can use it like this, and enter/leave the context of the a client at will:&#xA;RhinoContainer container = new RhinoContainer(&quot;Windsor.boo&quot;);&#xA;IoC.Initialize(container);&#xA;ContainerSelector containerSelector = IoC.Resolve&lt;ContainerSelector&gt;();&#xA;containerSelector.PrintChildContainers();&#xA;using(UnitOfWork.Start())&#xA;{&#xA;    Console.WriteLine(&#xA;        NHibernateUnitOfWorkFactory.CurrentNHibernateSession&#xA;            .Connection.ConnectionString&#xA;        );&#xA;}&#xA;using(containerSelector.Enter(&quot;Northwind&quot;))&#xA;{&#xA;    using (UnitOfWork.Start())&#xA;    {&#xA;        Console.WriteLine(&#xA;            NHibernateUnitOfWorkFactory.CurrentNHibernateSession&#xA;                .Connection.ConnectionString&#xA;            );&#xA;    }&#xA;}&#xA;using (containerSelector.Enter(&quot;Southsand&quot;))&#xA;{&#xA;    using (UnitOfWork.Start())&#xA;    {&#xA;        Console.WriteLine(&#xA;            NHibernateUnitOfWorkFactory.CurrentNHibernateSession&#xA;                .Connection.ConnectionString&#xA;            );&#xA;    }&#xA;}&#xA;&#xA;Because this is a fairly complex topic, I have created a simple reference implementation that you can get here:&#xA;https://rhino-tools.svn.sourceforge.net/svnroot/rhino-tools/trunk/SampleApplications/HierarchicalContainers</p>
        </article>
        <article id="article-7783">
            <a href="https://ayende.com/blog/2581/exceptions-usability" target="_blank">
                <h2 class="title mb-6" id="article-7783">Exceptions Usability</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 20, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just made a small change to the EnsureMaxNumberOfQueriesPerRequestModule, when it detects that the amount of queries performed goes beyond the specified value, it would also include the queries that it detected in the exception message. Very minor change, but the affect is that I can just scroll the page and say: &quot;Oh, I have a SELECT N&#x2B;1 here&quot;, directly off the exception page. On a side note, I am getting better at optimizing NHibernate based application, and I strongly suggest anyone using NHibernate to look at Multi Query in 1.2 (and Multi Criteria on the trunk) for those kind of things. It give you quite a bit of power. I run into several places today that we would read &amp; write large amount of data on a single request, and that triggered the max query limit. It took a while, but some interesting usage of both batching &amp; multi queries dropped the database roundtrips by an order of magnitude. Nice.</p>
        </article>
        <article id="article-7784">
            <a href="https://ayende.com/blog/2580/efficently-loading-deep-object-graphs" target="_blank">
                <h2 class="title mb-6" id="article-7784">Efficently loading deep object graphs</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 20, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Here is an interesting approach to get deep object graphs effectively.&#xA0; This will ensure that you will get all the relevant collections without having to lazy load them and without a huge cartesian product. Especially useful if you want to load a collection of items with the associated deep object graph.public Policy GetPolicyEagerly(int policyId)&#xA;{&#xA;&#x9;IList list = ActiveRecordUnitOfWorkFactory.CurrentSession.CreateMultiQuery()&#xA;&#x9;&#x9;.Add(@&quot;from Policy policy left join fetch policy.PolicyLeadAssociations                                  where policy.Id = :policyId&quot;)&#xA;&#x9;&#x9;.Add(@&quot;from Policy policy left join fetch policy.PolicyEmployeeAssociations                                  where policy.Id = :policyId&quot;)&#xA;&#x9;&#x9;.Add(@&quot;from Policy policy left join fetch policy.PolicyManagerAssociations                                  where policy.Id = :policyId&quot;)&#xA;&#x9;&#x9;.Add(@&quot;from Policy policy left join fetch policy.PolicyDepartmentAssociations                                  where policy.Id = :policyId&quot;)&#xA;&#x9;&#x9;.Add(@&quot;from Policy policy left join fetch policy.PolicyCustomerAssociations                                  where policy.Id = :policyId&quot;)&#xA;&#x9;&#x9;.SetEntity(&quot;policy&quot;, Policy)&#xA;&#x9;&#x9;.List();&#xA;&#x9;IList firstResultList = (IList) list[0];&#xA;&#x9;if(firstResultList.Count==0)&#xA;&#x9;&#x9;return null;&#xA;&#x9;return = (Policy) firstResultList [0];&#xA;}&#xA;The domain above is a fake one, by the way, don&#x27;t try to make any sense of it.</p>
        </article>
        <article id="article-7785">
            <a href="https://ayende.com/blog/2579/shocking-rob" target="_blank">
                <h2 class="title mb-6" id="article-7785">Shocking Rob</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 20, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am posting this mainly because I want to see how far I can shock Rob Conery   The exception is raised by the EnsureMaxNumberOfQueriesPerRequestModule, and it is currently set on the development level, for QA/Staging, I would probably reduce it further, although I have some pages where I  Oh, and to Rob, that was a classic error of doing query per node (instead of doing a single query) (added an eager load instead of a query and was done). I am doing some performance tuning right now, and all in all, it is very boring. Find a hot spot, consolidate data access, use MultiCriteria or MultiQuery, move on.</p>
        </article>
        <article id="article-7786">
            <a href="https://ayende.com/blog/2578/imprisoning-mort" target="_blank">
                <h2 class="title mb-6" id="article-7786">Imprisoning Mort</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 20, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Nick Malik responded to the discussion around his Tools for Mort post. He has a very unique point of view.  If you cannot make sure that Mort will write maintainable code, make him write less code.&#xA0;&#xA0;&#xA0; Then when it comes time for you (not Mort) to maintain it (he can&#x27;t), you don&#x27;t.&#xA0; You write it again. Okay, so you have a tool that makes sure that Mort doesn&#x27;t write a lot of code with it. Now Mort has left and I need to maintain the code. How do I do it? I can&#x27;t do it with the tools that Mort has used, because there are intentionally crippled. You guessed it, time to rewrite, and it is not just a rewrite of Mort&#x27;s code, it is a rewrite that would need to add functionality that existed in Mort&#x27;s framework, but crippled so Mort wouldn&#x27;t damage himself with it. Sorry, that is the wrong approach to take.   Someone &#x27;smart&#x27; has written the &#x27;hard&#x27; stuff for Mort, and made it available as cross cutting concerns and framework code that he doesn&#x27;t have to spend any time worrying about.&#xA0; Mort&#x27;s code is completely discardable. I thought that Pie-In-The-Sky frameworks were already widely acknowledged as a Bad Thing.   Does Mort put process first or people first?&#xA0; He puts people first, of course.&#xA0; He writes the code that a customer wants and gets it to the customer right away.&#xA0; The customer changes the requirements and Mort responds.&#xA0; If it sounds like a quick iteration, that is because it is. Agile doesn&#x27;t mean iterations, agile means working software and enabling change. You says that Mort can respond quickly to changes in the application, but is only during the first few iterations, after that, Mort is too busy fighting with the code to be able to significantly add any value to the application.  Possible Answer: We can have Mort consume a service.&#xA0; He can&#x27;t change it.&#xA0; He can&#x27;t screw it up.&#xA0; But he can still deliver value I really don&#x27;t have your faith in Mort&#x27;s inability to screw things up. What do you do when Mort decide to &quot;improve&quot; performance by making the service calls in an endless loop on another thread? After getting those points across, I would like to protest most strongly about the general tone of Nick&#x27;s post. It is extremely derogatory toward Mort, and it preclude&#xA0;in advance the ability to improve. I am a Mort on&#xA0;quite&#xA0;a few levels (the entire WinFX stack comes to mind), does&#xA0;this mean that I&#xA0;am bound to write unmaintainable code and should be locked down to&#xA0;a very small set of &quot;safe&quot; choices, which&#xA0;were chosen for me by those Above Me ? Sorry, I really can&#x27;t accept this approach, and while it explains some of the stuff that Microsoft puts out, the only thing that it helps is to stifle innovation and development on the platform. If this is Nick&#x27;s idea about how things should be, it is very sad. I seriously hope that this isn&#x27;t the accepted position at Microsoft.</p>
        </article>
        <article id="article-7787">
            <a href="https://ayende.com/blog/2577/did-you-know-find-out-if-an-exception-was-thrown-from-a-finally-block" target="_blank">
                <h2 class="title mb-6" id="article-7787">Did you know: Find out if an exception was thrown from a finally block!</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 20, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is a big biggie for me, because it enables a much nicer syntax for a lot of stuff. But first, let us show this:using(new ExceptionDetector())&#xA;{&#xA;&#x9;if(new Random().Next(1,10)%2 == 0)&#xA;          throw new Exception();&#xA;}&#xA;How can you tell, from the ExceptionDetector, if an exception was thrown or not? Well, conventional wisdom, and what I thought about until 15 minutes ago, says that you can&#x27;t. I want to thank Daniel Fortunov, for teaching me this trick:public class ExceptionDetector : IDisposable&#xA;{&#xA;    public void Dispose()&#xA;    {&#xA;        if (Marshal.GetExceptionCode()==0)&#xA;            Console.WriteLine(&quot;Completed Successfully!&quot;);&#xA;        else&#xA;            Console.WriteLine(&quot;Exception!&quot;);&#xA;    }&#xA;}&#xA;Amazing!</p>
        </article>
        <article id="article-7788">
            <a href="https://ayende.com/blog/2576/having-a-good-foundation" target="_blank">
                <h2 class="title mb-6" id="article-7788">Having a good foundation</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 19, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I talked about the tree problem that I had to create, we need to create something very similar (but for another object graph) today. It took me roughly three days to get it all working correctly, it took Rinat about two and a half hours to get it to work on the next set.</p>
        </article>
        <article id="article-7789">
            <a href="https://ayende.com/blog/2575/documentation-can-be-ambiguous-in-the-most-insidious-ways" target="_blank">
                <h2 class="title mb-6" id="article-7789">Documentation can be ambiguous in the most insidious ways</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 19, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Frans had a long comment to my last post, I started to reply in a comment, but it grew too big for that. &#xA0;Let&#x27;s use ObjectBuilder from the entlib as an example. Anyone who hasn&#x27;t read the code or its non-existing dev docs, go read the code and the unittests, then come back here and explain in detail how it works inside and proof you&#x27;re right. xJust to answer that, I have read the OB source, and I have never bothered to look at whatever documentation that exists for it.After reading the code and the tests, I was able to extend OB to support generic inferencing capabilities. (Given IRepository&lt;T&gt; whose implementor is NHibernateRepository&lt;T&gt;, when asked for IRepository&lt;Customer&gt;, return NHibernateRepository&lt;Customer&gt;). That is an advanced feature of IoC, added to a container that I wasn&#x27;t familiar with, without affecting the rest of the functionality. Oh, and while I can probably give a short description of how OB&#xA0; works, I am by no means an expert, nor can I really explain how OB works, but I was able to go in, understand the area that I wanted to modify, make a change that greatly benefit me, without breaking anything else. That is the value in maintainable code. And this is for the people that thinks that I bash the P&amp;P code. I made similar changes to ObjectBuilder and to Windsor, at around the same time frame. I had harder time dealing with the ObjectBuilder, but that is probably due to unfamilariarity with the project. The simple fact that I was able to do a significant change without having to grok the entire ObjectBuilder says quite a but the quality of the code. &#xA0; If you can reverse engineer that from unit-test code, well, good for you and I&#x27;m sure your boss will be very happy to hear that you won&#x27;t create a single bug ever again This is something that you have repeated several times, and I want to explicitly disagree with this statement: understanding the code doesn&#x27;t mean no bugs, it means less bugs, for sure, but no zero bugs. Most bugs occur not because you misunderstand what the code does, but because of simple mistake (if instead of if not, for instance) or not considering this particular scenario (who would ever try to paste 2Mb of text here?). Understanding helps reduce it, but it can&#x27;t eliminate it. I&#xA0;doubt&#xA0;you can make the claim that LLBLGen has no bugs. What I find a little funny is that you apparently forget which kind of comments were placed inside the nhibernate sourcecode before it went v1.0: things like &quot;// I have no idea what this does&quot; or &quot;// why is this done here?&quot; or similar comments. Apparently, the people who ported the hibernate code over to .NET didn&#x27;t understand how it worked by simply looking at the code AND with all the unittests in mind. There are similar comments there right now, and they exists in the original Hibernate source code as well. I will freely admit that there are parts of NHibernate that I have no idea how they work. What I do know is that this lack of knowledge about the way some parts work has not hinder my ability to work with NHibernate or extend it. By digging into sourcecode and understanding what it precisely does already takes a lot of time as you have to parse and interpret every line in the code and REMEMBER the state of the variables it touches! Can you do that in your head? I can&#x27;t. That is not something that I can do, due to this limitation, I am working in a way that ensures that I do not need to understand the entire system and the implications of each and every decision at any given one point. I consider this approach a best practice, because this means that I can work on a piece of code without having to deal with the implications of dozens other components being affected.&#xA0;Documentation wouldn&#x27;t help here, unless I would have a paragraph per line of code, and keep them in sync at all times, and remember to read it at all times. Add to that the wide range of decisions one has to make to build a system like that and with just the end-result in your hand it&#x27;s a hell of a job to come to the level where you understand why things are done that way. I disagree, I can determain intent from code and from tests, and I can change the code and see tests breaks if necessary. That is much faster way then trying to analyze the flow of each instruction in the application.  Typical example: saving an entity graph recursively in the right order. That&#x27;s a heck of a complex pipeline, with several algorithms processing the data after eachother, and the code branches out to a lot of different subsystems.  If one can determine by JUST LOOKING AT THE CODE why it is designed the way it is, more power to him/her, but I definitely won&#x27;t be able to do so. What I find surprising is that some people apparently think they can, with no more info than the end result of the code.  You wouldn&#x27;t be able to understand that from the end result of the code, but having a test in place will allow you to walk through that in isolation, if needed, and understand what is going on. Here is a secret, I can usually understand what NHibernate is doing in such scenarios without looking at the code. Because the logic is fairly straight-forward to understand (but not to implement). I taught myself NHibernate by building the NHibernate Query Analyzer, no documentation, very little help from other people at the time, but a lot of going through the code and grokking the way it works.  What I find even more surprising is that it apparently is a GOOD thing that there&#x27;s no documentation. No, what I am saying is that I would rather have a good code with unit tests than code that has extensive documentation. Again, I am not documentation at the right level, high level architecture, broad implementation notes, build scripts documentation. To go further from that seems to be to get to the point of diminishing returns. It apparently is EASIER to read code, interpret every line, remember every variable&#x27;s state it touches, follow call graphs all over the place, write down pre-/post- conditions along the way That is the part that I think we disagree about, I don&#x27;t need to do that.  Perhaps they&#x27;re payed by the hour Around 90% of the time that I spent on NHibernate is time that goes out of my own free time, not paid for anyone. You can rest assure that I care a lot about not wasting my own time. This is the real world, and good, unit tested, code is maintainable, proved by the fact that people goes in and make safe changes to it, without having to load all the premutations of the system to your head.</p>
        </article>
        <article id="article-7790">
            <a href="https://ayende.com/blog/2574/navigating-large-code-bases" target="_blank">
                <h2 class="title mb-6" id="article-7790">Navigating large code bases</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 19, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just needed to find an answer to a question in MonoRail. MonoRail code base is over 75,000 lines of code, including all the supporting projects and tests. Castle.MonoRail.Framework has about 37,700 lines of code. The question was something that I never really thought about, and had no idea where to start looking at. I opened the solution and started hunting. It took about five or six minutes to find the correct spot, another two to verify my assumption and be shocked that there is a private method there :-) and then I was done. Under ten minutes, to find a question that I never thought about in a significant code base. ReSharper helps, of course, but nothing beats well structured code for maintainability.  Oh, and MonoRail has very little implementation documentation.</p>
        </article>
        <div class="button flex justify-between">
            <a href="778.html"><span class="back arrow"></span></a>

            <a href="780.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
