
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 337 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-3361">
            <a href="https://ayende.com/blog/170977/the-state-of-a-failure-condition" target="_blank">
                <h2 class="title mb-6" id="article-3361">The state of a failure condition</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 11, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x2019;m looking over of a bunch of distributed algorithm discussion groups, and I recently saw several people making the same bad assumption. The issue is that in a distributed system, you have to assume that any communication between system can fail.  Because that is taken into account in any distributed algorithm, there is a school of thought that believe that errors shouldn&#x2019;t generate replies. That is horrifying to me.  Let me give a concrete example. In the Raft algorithm, nodes will participate in an election in order to decide who is the leader. A node can decide to vote for a certain candidate, to reject a candidate or it may be down and not responsive. Since we have to handle the non responsive node anyway, it is easy to assume that we only need to reply to the candidate when we actually vote for it. After all, no reply is a negative reply already, no? The issue with this design decision is that this is indeed correct, but it is also boneheaded*. There are two reasons here. The minor one is that a non reply will force us to wait until a pre-configured timeout happen, after which we can go into failure handling. But actually sending a reply when we know that we refuse to vote for a node can give that node more information, and cut down the time it takes for the node to respond to negative replies. As important as that is, this isn&#x2019;t really my main concern. My main concern here is that not sending a reply leaves the administrator trying to figure out what is going on with essentially zero data. On the other hand, if the node send a &#x201C;you are missing X,Y and Z for me to consider you applicable&#x201D;, that is something that can be traced, that can be shown and acted upon. It may seem like a small thing, overall, but it is something with crucial importance for operations. Those are hard enough when you have a single node. When you have a distributed system, you have to plan for that explicitly.  * I am using this terminology intentionally. Anyone who don&#x2019;t consider production support and monitoring for their software from the get go never had to support complex production systems, where every nugget of information can be crucial.</p>
        </article>
        <article id="article-3362">
            <a href="https://benfoster.io/blog/stripe-failed-payments-how-to/" target="_blank">
                <h2 class="title mb-6" id="article-3362">How to handle failed subscription payments in Stripe</h2>
            </a>
            <p class="mb-2">by Ben Foster</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 10, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Getting deep into the Stripe Subscription lifecycle, I explain what happens when subscription payments fail in Stripe and how you can handle this within your own applications.</p>
        </article>
        <article id="article-3363">
            <a href="https://enterprisecraftsmanship.com/posts/make-hard-coding-your-default-choice/" target="_blank">
                <h2 class="title mb-6" id="article-3363">Make hard-coding your default choice</h2>
            </a>
            <p class="mb-2">by Vladimir Khorikov</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 08, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Hard coding is often considered an anti-pattern. Having values that can change over time hard-coded in the source code requires recompilation every time these values actually change.&#xA; While this statement is true, I think that hard coding should be the default choice when developing an application.&#xA; Hard coding vs configuration file When you work on a project or feature, there always are some magic numbers or strings that potentially can change in future.</p>
        </article>
        <article id="article-3364">
            <a href="https://www.meziantou.net/asp-net-5-static-files.htm" target="_blank">
                <h2 class="title mb-6" id="article-3364">ASP.NET 5 &amp; Static Files</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 05, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A website is composed of static files (CSS, JS, HTML, others) and dynamic pages. In this post, we will focus on the static files. In the good old days to serve static files, it was enough to copy it in a folder of the web project and it was directly accessible once the site hosted in IIS. With ASP.</p>
        </article>
        <article id="article-3365">
            <a href="https://enterprisecraftsmanship.com/posts/interfaces-vs-interfaces/" target="_blank">
                <h2 class="title mb-6" id="article-3365">Interfaces vs Interfaces</h2>
            </a>
            <p class="mb-2">by Vladimir Khorikov</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 02, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Today, I&#x2019;d like to discuss the differences between interfaces, abstractions and .NET interfaces, as well as what the term &quot;implementation details&quot; means.</p>
        </article>
        <article id="article-3366">
            <a href="https://www.meziantou.net/sql-geography-google-maps-geolocalisation.htm" target="_blank">
                <h2 class="title mb-6" id="article-3366">SQL Geography, Google Maps &amp; Geolocalisation</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 29, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The geography type has appeared with SQL Server 2008R2. Its purpose is to store and manipulate spatial data. It allows to represent points, lines, or polygons on the globe and to make calculations such as measuring the type distances between 2 points, checking if 2 areas intersect, etc.We will make</p>
        </article>
        <article id="article-3367">
            <a href="https://ayende.com/blog/170946/the-ravendb-comic-strip-part-iii-high-availability-sleeping-soundly" target="_blank">
                <h2 class="title mb-6" id="article-3367">The RavenDB Comic Strip</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 28, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20"></p>
        </article>
        <article id="article-3368">
            <a href="https://ayende.com/blog/170945/special-offer-29-discount-for-all-our-products" target="_blank">
                <h2 class="title mb-6" id="article-3368">Special Offer</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 27, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Well, it is nearly the 29 May, and that means that I have been married for four years. To celebrate that, I am offering a 29% discount on all our products (RavenDB, NHibernate Profiler, Entity Framework Profiler). All you have to do is purchase any of our products using the following coupon code:  4th Anniversary This offer is valid to the end of the month only.</p>
        </article>
        <article id="article-3369">
            <a href="https://ayende.com/blog/170916/ravendb-sharding-adding-a-new-shard-to-an-existing-cluster-splitting-the-shard" target="_blank">
                <h2 class="title mb-6" id="article-3369">RavenDB Sharding</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 22, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In my previous post, we have increased the capacity of the cluster by moving all new work to the new set of servers. In this post, I want to deal with a slightly harder problem, how to handle it when it isn&#x2019;t new data that is causing the issue, but existing data. So we can&#x2019;t just throw a new server, but need to actually move data between nodes.&#xA;We started with the following configuration:&#xA;&#xA;var shards = new Dictionary&lt;string, IDocumentStore&gt;&#xA;{&#xA;    {&quot;Shared&quot;, new DocumentStore {Url =&quot;http://rvn1:8080&quot;, DefaultDatabase = &quot;Shared&quot;}},&#xA;    {&quot;EU&quot;, new DocumentStore {Url = &quot;http://rvn2:8080&quot;, DefaultDatabase = &quot;Europe&quot;}},&#xA;    {&quot;NA&quot;, new DocumentStore {Url = &quot;http://rvn3:8080&quot;, DefaultDatabase = &quot;NorthAmerica&quot;}},&#xA;};&#xA;&#xA;And what we want is to add another server for EU and NA. Our new topology would be:&#xA;&#xA;var shards = new Dictionary&lt;string, IDocumentStore&gt;&#xA;{&#xA;    {&quot;Shared&quot;, new DocumentStore {Url =&quot;http://rvn1:8080&quot;, DefaultDatabase = &quot;Shared&quot;}},&#xA;    {&quot;EU1&quot;, new DocumentStore {Url = &quot;http://rvn2:8080&quot;, DefaultDatabase = &quot;Europe1&quot;}},&#xA;    {&quot;NA1&quot;, new DocumentStore {Url = &quot;http://rvn3:8080&quot;, DefaultDatabase = &quot;NorthAmerica1&quot;}},&#xA;    {&quot;EU2&quot;, new DocumentStore {Url = &quot;http://rvn4:8080&quot;, DefaultDatabase = &quot;Europe2&quot;}},&#xA;    {&quot;NA2&quot;, new DocumentStore {Url = &quot;http://rvn5:8080&quot;, DefaultDatabase = &quot;NorthAmerica2&quot;}},&#xA;};&#xA;&#xA;There are a couple of things that we need to pay attention to. First, we no longer use the EU / NA shard keys, they have been removed in favor of EU1 &amp; EU2 / NA1 &amp; NA2. We&#x2019;ll also change the sharding configuration so it would split the new data between the two new nodes for each region evenly (see previous post for the details on exactly how this is done). But what about the existing data? We need to have some way of actually moving the data. That is when our ops tools come into play.&#xA;We use the smuggler to move the data between the servers:&#xA;&#xA;Raven.Smuggler.exe  between http://rvn2:8080 http://rvn2:8080 --database=Europe --database2=Europe1 --transform-file=transform-1.js --incremental&#xA;Raven.Smuggler.exe  between http://rvn2:8080 http://rvn4:8080 --database=Europe --database2=Europe2 --transform-file=transform-2.js --incremental&#xA;Raven.Smuggler.exe  between http://rvn3:8080 http://rvn3:8080 --database=NorthAmerica --database2=NorthAmerica1 --transform-file=transform-1.js --incremental&#xA;Raven.Smuggler.exe  between http://rvn3:8080 http://rvn5:8080 --database=NorthAmerica --database2=NorthAmerica2 --transform-file=transform-2.js --incremental&#xA;&#xA;&#xA;The commands are pretty similar, with just the different options, so let us try to figure out what is going on. We are asking the smuggler to move the data between two databases in an incremental fashion, while applying a transform script. The transform-1.js file looks like this:&#xA;&#xA;function(doc) { &#xA;    var id = doc[&#x27;@metadata&#x27;][&#x27;@id&#x27;]; &#xA;    var node = (parseInt(id.substring(id.lastIndexOf(&#x27;/&#x27;)&#x2B;1)) % 2);&#xA;&#xA;    if(node == 1)&#xA;        return null;&#xA;&#xA;    doc[&quot;@metadata&quot;][&quot;Raven-Shard-Id&quot;] = doc[&quot;@metadata&quot;][&quot;Raven-Shard-Id&quot;] &#x2B; (node&#x2B;1);&#xA;&#xA;    return doc;&#xA;}&#xA;&#xA;And the tranasform-2.js is exactly the same except that it return early if node is 0. In this way, we are able to split the data into the two new servers.&#xA;Note that the reason we use an incremental approach means that we can do this, even if it takes a long while, then the window of time when we switch is very narrow, and require us to only pass the recently changed data.&#xA;That still leaves the question of how are we going to deal with old ids. We are still going to have things like &#x201C;EU/customers/###&#x201D; in the database, even if those documents are on one of the two new nodes. We handle this, like most low level sharding behaviors, by customizing the sharding strategy. In this case, we modify the PotentialsServersFor(&#x2026;) method:&#xA;&#xA;public override IList&lt;string&gt; PotentialShardsFor(ShardRequestData requestData)&#xA;{&#xA;    var potentialShardsFor = base.PotentialShardsFor(requestData);&#xA;    if (potentialShardsFor.Contains(&quot;EU&quot;))&#xA;    {&#xA;        potentialShardsFor.Remove(&quot;EU&quot;);&#xA;        potentialShardsFor.Add(&quot;EU1&quot;);&#xA;        potentialShardsFor.Add(&quot;EU2&quot;);&#xA;    }&#xA;    if (potentialShardsFor.Contains(&quot;NA&quot;))&#xA;    {&#xA;        potentialShardsFor.Remove(&quot;NA&quot;);&#xA;        potentialShardsFor.Add(&quot;NA1&quot;);&#xA;        potentialShardsFor.Add(&quot;NA2&quot;);&#xA;    }&#xA;    return potentialShardsFor;&#xA;}&#xA;&#xA;In this case, we are doing a very simple thing, when the default shard resolution strategy detect that we want to go to the old EU node, we&#x2019;ll tell it to go to both EU1 and EU2. A more comprehensive solution would narrow it down to the exact server, but that depend on how exactly you split the data, and is left as an exercise for the reader.</p>
        </article>
        <article id="article-3370">
            <a href="https://ayende.com/blog/170915/ravendb-sharding-adding-a-new-shard-to-an-existing-cluster-the-easy-way" target="_blank">
                <h2 class="title mb-6" id="article-3370">RavenDB Sharding</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 21, 2015
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Continuing on the theme of giving a full answer to interesting questions on the mailing list in the blog, we have the following issue.&#xA0;&#xA;We have a sharded cluster, and we want to add a new node to the cluster, how do we do it? I&#x2019;ll discuss a few ways in which you can handle this scenario. But first, let us lay out the actual scenario.&#xA;We&#x2019;ll use the Customers &amp; Invoices system, and we put the data in the various shard along the following scheme:&#xA;&#xA;&#xA;&#xA;Customers&#xA;Sharded by region&#xA;&#xA;&#xA;Invoices&#xA;Sharded by customer&#xA;&#xA;&#xA;Users&#xA;Shared database (not sharded)&#xA;&#xA;&#xA;&#xA;We can configure this using the following:&#xA;&#xA;var shards = new Dictionary&lt;string, IDocumentStore&gt;&#xA;{&#xA;    {&quot;Shared&quot;, new DocumentStore {Url =&quot;http://rvn1:8080&quot;, DefaultDatabase = &quot;Shared&quot;}},&#xA;    {&quot;EU&quot;, new DocumentStore {Url = &quot;http://rvn2:8080&quot;, DefaultDatabase = &quot;Europe&quot;}},&#xA;    {&quot;NA&quot;, new DocumentStore {Url = &quot;http://rvn3:8080&quot;, DefaultDatabase = &quot;NorthAmerica&quot;}},&#xA;};&#xA;ShardStrategy shardStrategy = new ShardStrategy(shards)&#xA;    .ShardingOn&lt;Company&gt;(company =&gt;company.Region, region =&gt;&#xA;    {&#xA;        switch (region)&#xA;        {&#xA;            case &quot;USA&quot;:&#xA;            case &quot;Canada&quot;:&#xA;                return &quot;NA&quot;;&#xA;            case &quot;UK&quot;:&#xA;            case &quot;France&quot;:&#xA;                return &quot;EU&quot;;&#xA;            default:&#xA;                return &quot;Shared&quot;;&#xA;        }&#xA;    })&#xA;    .ShardingOn&lt;Invoice&gt;(invoice =&gt; invoice.CompanyId)&#xA;    .ShardingOn&lt;User&gt;(user=&gt; &quot;Shared&quot;);&#xA;&#xA;&#xA0;&#xA;&#xA;So far, so good. Now, we have so much work that we can&#x2019;t just have two servers for customers &amp; invoices, we need more. We change the sharding configuration to include 2 new servers, and we get:&#xA;&#xA;var shards = new Dictionary&lt;string, IDocumentStore&gt;&#xA;     {&#xA;         {&quot;Shared&quot;, new DocumentStore {Url = &quot;http://rvn1:8080&quot;, DefaultDatabase = &quot;Shared&quot;}},&#xA;         {&quot;EU&quot;, new DocumentStore {Url = &quot;http://rvn2:8080&quot;, DefaultDatabase = &quot;Europe&quot;}},&#xA;         {&quot;NA&quot;, new DocumentStore {Url = &quot;http://rvn3:8080&quot;, DefaultDatabase = &quot;NorthAmerica&quot;}},&#xA;        {&quot;EU2&quot;, new DocumentStore {Url = &quot;http://rvn4:8080&quot;, DefaultDatabase = &quot;Europe-2&quot;}},&#xA;        {&quot;NA2&quot;, new DocumentStore {Url = &quot;http://rvn5:8080&quot;, DefaultDatabase = &quot;NorthAmerica-2&quot;}},&#xA;     };&#xA;&#xA;    var shardStrategy = new ShardStrategy(shards);&#xA;    shardStrategy.ShardResolutionStrategy = new NewServerBiasedShardResolutionStrategy(shards.Keys, shardStrategy)&#xA;        .ShardingOn&lt;Company&gt;(company =&gt; company.Region, region =&gt;&#xA;        {&#xA;            switch (region)&#xA;            {&#xA;                case &quot;USA&quot;:&#xA;                case &quot;Canada&quot;:&#xA;                    return &quot;NA&quot;;&#xA;                case &quot;UK&quot;:&#xA;                case &quot;France&quot;:&#xA;                    return &quot;EU&quot;;&#xA;                default:&#xA;                    return &quot;Shared&quot;;&#xA;            }&#xA;        })&#xA;        .ShardingOn&lt;Invoice&gt;(invoice =&gt; invoice.CompanyId)&#xA;        .ShardingOn&lt;User&gt;(user =&gt; user.Id, userId =&gt; &quot;Shared&quot;);&#xA;&#xA;Note that we have a new shard resolution strategy, what is that? This is how we control lower level details of the sharding behavior, in this case, we want to control where we&#x2019;ll write new documents.&#xA;&#xA;public class NewServerBiasedShardResolutionStrategy : DefaultShardResolutionStrategy&#xA;{&#xA;    public NewServerBiasedShardResolutionStrategy(IEnumerable&lt;string&gt; shardIds, ShardStrategy shardStrategy)&#xA;        : base(shardIds, shardStrategy)&#xA;    {&#xA;    }&#xA;&#xA;    public override string GenerateShardIdFor(object entity, ITransactionalDocumentSession sessionMetadata)&#xA;    {&#xA;        var generatedShardId = base.GenerateShardIdFor(entity, sessionMetadata);&#xA;        if (entity is Company)&#xA;        {&#xA;            if (DateTime.Today &lt; new DateTime(2015, 8, 1) ||&#xA;                DateTime.Now.Ticks % 3 != 0)&#xA;            {&#xA;                return generatedShardId &#x2B; &quot;2&quot;;&#xA;            }&#xA;            return generatedShardId;&#xA;        }&#xA;        return generatedShardId;&#xA;    }&#xA;}    &#xA;&#xA;What is the logic? If we have a new company, we&#x2019;ll call the GenerateShardIdFor(entity) method, and for the next 3 months, we&#x2019;ll create all new companies (and as a result, their invoices) in the new servers. After the 3 months have passed, we&#x2019;ll still generate the new companies on the new servers at a rate of two thirds on the new servers vs. one third on the old servers.&#xA;Note that in this case, we didn&#x2019;t have to modify any data whatsoever. And over time, the data will balance itself out between the servers. In my next post, we&#x2019;ll deal with how we actually split an existing shard into multiple shards.</p>
        </article>
        <div class="button flex justify-between">
            <a href="336.html"><span class="back arrow"></span></a>

            <a href="338.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>