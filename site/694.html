
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 694 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-6931">
            <a href="https://ayende.com/blog/3224/the-problem-of-over-aggressive-caching" target="_blank">
                <h2 class="title mb-6" id="article-6931">The problem of over aggressive caching</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 28, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Following the recent profiling effort, I decided to put far more aggressive caching into SvnBridge.  I set it up so it would cache the full revision from TFS on any query, and then serve it from the cache. When I run it against the test server it worked beautifully. Then I had run into this issue:    I am pretty sure that this is not going to be an acceptable scenario. To be rather exact, I would find it acceptable if it was a one time cost, but the problem is that this is a cost that you have to pay per revision. And that is unacceptable. The major problem is that this uses the underlying QueryItems() method, which returns all of the results, including those from previous revisions. This means that on a busy server (like tfs03), the cost of doing such a query is high.  The number of files returned is actually pretty small (910 in this case), but I assume that it have to check all the files on the server for permission before it allows me to get them.   I wonder how Rhino Security would handle this situation, it wouldn&#x27;t even get the data out of the DB, and the query enhancement is pretty light weight. I assume it would be pretty fast.  Anyway, this is obviously a bad approach. For now, I made it load only the path (and its descendants) that we need, this mean that we don&#x27;t get the same benefit of preemptive caching and might talk to the server a bit too much. However, it turn out that the way SvnBridge and SVN makes requests in a way that make this style of caching work fairly well. We always ask for the directory before asking for the descendant, and we have fairly long conversations about the same revision, so that is good candidate.  That isn&#x27;t optimal for big projects, with a lot of files and a lot of activity, however. Because the way I handle it now, we download the entire project metadata for each revision, that can be a lot for those kind of projects, and having to download them each and every time is a waste.  SvnBridge already contains a very smart piece of code (the UpdateDiffCalculator class) that can figure out the differences between two revisions and only get the items that it needs. The problem is that the caching layer is built mainly in order to support that class.  I think that I&#x27;ll need to get a bit smarter about this in the future, but for now it seems to be doing the work very well.</p>
        </article>
        <article id="article-6932">
            <a href="https://ayende.com/blog/3223/svnbridge-and-multiple-tfs-servers" target="_blank">
                <h2 class="title mb-6" id="article-6932">SvnBridge and Multiple TFS Servers</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 28, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The most highly rated request for SvnBridge was adding support for multiple TFS servers without having to run multiple instances of SvnBridge, which was a hassle.  Today I finished working on the implementation, and the UI got a new check box:     Funny, but this took almost three days to implement.   Yes, I don&#x27;t do WinForms much, and I am pretty sure somewhere there is a way to do checkboxes, but I like writing code.*  What actually took a lot of time was working on the path routing inside SvnBridge, so it would send the proper response to the client, which would return it right back to it. The SVN WebDAV protocol is full of indirection, and that is not saying the least.  At any rate, this now works, and you can use a single instance.  Now, how do I do that? Well, using the Microsoft Mind Reading Patent technology, of course:     I mean, don&#x27;t you know that telepathy enabled software is the next big thing?  Now, all you have to do is start SvnBridge, and you can access any TFS server in your possession.   Just issue this command to get the SvnBridge code:     svn checkout http://localhost:8081/tfs03.codeplex.com/SvnBridge   Note the tfs03.codeplex.com in the URL ? This has nothing to do with how we specify which server we use. I am using mind reading technology, I remind you.  If we want to specify a port, we will use:      svn checkout http://localhost:8081/my-team-system-server:8080/MyProject   SvnBridge will also auto detect http and https, so you don&#x27;t have to worry about this.  * No, I didn&#x27;t spend three days writing my CheckboxControl.</p>
        </article>
        <article id="article-6933">
            <a href="https://ayende.com/blog/3222/find-out-the-right-directory" target="_blank">
                <h2 class="title mb-6" id="article-6933">Find out the right directory</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 28, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Another interesting challenge. Given the following API:     public interface IFileRepository&#xA;{&#xA;&#x9;void Save(IFile file);&#xA;&#xA;&#x9;IFile[] GetFiles(string path, Recursion recursion);&#xA;}&#xA;&#xA;public enum Recursion&#xA;{&#xA;&#x9;None,&#xA;&#x9;OneLevel,&#xA;&#x9;Full&#xA;}&#xA;&#xA;&#xA;And assuming that you are saving to a relational database, how are you going to build the GetFiles method?&#xA;&#xA;Oh, and just to make things interesting, Save(IFile) may only perform a single SQL INSERT statement.</p>
        </article>
        <article id="article-6934">
            <a href="https://ayende.com/blog/3221/resharper-is-smarter-than-me" target="_blank">
                <h2 class="title mb-6" id="article-6934">ReSharper is smarter than me</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 27, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Given the following block of code:     if (presenter.GetServerUrlFromRequest!=null)&#xA;&#x9;GetServerUrlFromRequest.Checked = presenter.GetServerUrlFromRequest.Value;&#xA;else&#xA;&#x9;GetServerUrlFromRequest.Checked = true;&#xA;&#xA;&#xA;Resharper gave me the following advice:&#xA;&#xA; &#xA;&#xA;And turned the code to this piece:&#xA;&#xA;&#xA;  GetServerUrlFromRequest.Checked = !(presenter.GetServerUrlFromRequest!=null) ||                                   presenter.GetServerUrlFromRequest.Value;&#xA;&#xA;&#xA;And while it has the same semantics, I actually had to dechiper the code to figure out what it was doing.&#xA;&#xA;I choose to keep the old version.</p>
        </article>
        <article id="article-6935">
            <a href="https://ayende.com/blog/3220/profiling-with-dottrace" target="_blank">
                <h2 class="title mb-6" id="article-6935">Profiling with dotTrace</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 27, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I have a tiny feature and a bug fix that I want to implement before I am going to focus solely improving SvnBridge performance. This is a really quick analysis of a single scenario.  Start dotTrace and set the application to profile then start it. There are a lot of options, but the default was always good for me.     In the application, prepare it for the scenario that you are going to perform. (In SvnBridge&#x27;s case, this means just setting up the server to talk to):       Perform some actions against the application:    When you are done, hit Get Snapshot:      Now, I tend to go to the hotspots and check what is costing me.     The first line, WaitMessage call is fine, this is the WinForms client that is not doing much at the moment.  The second I can&#x27;t really figure out, it is starting a thread, but that doesn&#x27;t take so long. I am pretty sure that this is a case of mis-measuring, or just me not understanding this, but never mind that.  The rest of the calls, which takes huge amount of time, are... remote calls. I guess I should stop talking to TFS :-)</p>
        </article>
        <article id="article-6936">
            <a href="https://ayende.com/blog/3219/adaptive-domain-models-with-rhino-commons" target="_blank">
                <h2 class="title mb-6" id="article-6936">Adaptive Domain Models with Rhino Commons</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 27, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Udi Dahan has been talking about this for a while now. As usual, he makes sense, but I am working in different enough context that it takes time to assimilate it.&#xA;At any rate, we have been talking about this for a few days, and I finally sat down and decided that I really need to look at it with code. The result of that experiment is that I like this approach, but am still not 100% sold.&#xA;The first idea is that we need to decouple the service layer from our domain implementation. But why? The domain layer is under the service layer, after all. Surely the service layer should be able to reference the domain. The reasoning here is that the domain model play several different roles in most applications. It is the preferred way to access our persistent information (but they should not be aware of persistence), it is the central place for business logic, it is the representation of our notions about the domain, and much more that I am probably leaving aside.&#xA;The problem here is there is a dissonance between the requirements we have here. Let us take a simple example of an Order entity.&#xA; As you can see, Order has several things that I can do. It can accept an new line, and it can calculate the total cost of the order.&#xA;But those are two distinct responsibilities that are based on the same entity. What is more, they have completely different persistence related requirements.&#xA;I talked about this issue here, over a year ago.&#xA;So, we need to split the responsibilities, so we can take care of each of them independently. But it doesn&#x27;t make sense to split the Order entity, so instead we will introduce purpose driven interfaces. Now, when we want to talk about the domain, we can view certain aspect of the Order entity in isolation.&#xA;This leads us to the following design:&#xA;&#xA;And now we can refer to the separate responsibilities independently. Doing this based on the type open up to the non invasive API&#xA0;approaches that I talked about before. You can read Udi&#x27;s posts about it to learn more about the concepts. Right now I am more interested in discussing the implementation.&#xA;First, the unit of abstraction that we work in is the IRepository&lt;T&gt;, as always.&#xA;The major change with introducing the idea of a ConcreteType to the repository. Now it will try to use the ConcreteType instead of the give typeof(T) that it was created with. This affects all queries done with the repository (of course, if you don&#x27;t specify ConcreteType, nothing changes).&#xA;The repository got a single new method:&#xA;&#xA;T Create();&#xA;&#xA;This allows you to create new instances of the entity without knowing its concrete type. And that is basically it.&#xA;Well, not really :-)&#xA;I introduced two other concepts as well.&#xA;&#xA;public interface IFetchingStrategy&lt;T&gt;&#xA;{&#xA;&#x9;ICriteria Apply(ICriteria criteria);&#xA;}&#xA;&#xA;IFetchingStrategy can interfere in the way queries are constructed. As a simple example, you could build a strategy that force eager load of the OrderLines collection when the IOrderCostCalculator is being queried.&#xA;There is not complex configuration involved in setting up IFetchingStrategy. All you need to do is register your strategies in the container, and let the repository do the rest.&#xA;However, doesn&#x27;t this mean that we now need to explicitly register repositories for all our entities (and for all their interfaces)?&#xA;Well, yes, but no. Technically we need to do that. But we have help, EntitiesToRepositories.Register, so we can just put the following line somewhere in the application startup and we are done.&#xA;&#xA;EntitiesToRepositories.Register(&#xA;&#x9;IoC.Container, &#xA;&#x9;UnitOfWork.CurrentSession.SessionFactory, &#xA;&#x9;typeof (NHRepository&lt;&gt;),&#xA;&#x9;typeof (IOrderCostCalculator).Assembly);&#xA;&#xA;And this is it, you can start working with this new paradigm with no extra steps.&#xA;As a side benefit, this really pave the way to complex multi tenant applications.</p>
        </article>
        <article id="article-6937">
            <a href="https://ayende.com/blog/3218/elegant-code" target="_blank">
                <h2 class="title mb-6" id="article-6937">Elegant Code</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 27, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just finished writing this, and I find it very pleasing to look at:     public class EntitiesToRepositories&#xA;{&#xA;&#x9;public static void Register(&#xA;&#x9;&#x9;IWindsorContainer windsorContainer,&#xA;&#x9;&#x9;ISessionFactory sessionFactory,&#xA;&#x9;&#x9;Type repository,&#xA;&#x9;&#x9;params Assembly[] assemblies&#xA;&#x9;&#x9;)&#xA;&#x9;{&#xA;&#x9;&#x9;if(typeof(IRepository&lt;&gt;).IsAssignableFrom(repository))&#xA;&#x9;&#x9;&#x9;throw new ArgumentException(&quot;Repository must be a type inheriting from IRepository&lt;T&gt;, &quot; &#x2B;                                     &quot;and must be an open generic type. Sample: typeof(NHRepository&lt;&gt;).&quot;);&#xA;&#xA;&#x9;&#x9;foreach (IClassMetadata meta in sessionFactory.GetAllClassMetadata().Values)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;Type mappedClass = meta.GetMappedClass(EntityMode.Poco);&#xA;&#x9;&#x9;&#x9;if (mappedClass == null)&#xA;&#x9;&#x9;&#x9;&#x9;continue;&#xA;&#x9;&#x9;&#x9;foreach (Type interfaceType in mappedClass.GetInterfaces())&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;if(IsDefinedInAssemblies(interfaceType, assemblies)==false)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;continue;&#xA;&#x9;&#x9;&#x9;&#x9;windsorContainer.Register(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;Component.For(typeof(IRepository&lt;&gt;).MakeGenericType(interfaceType))&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;.ImplementedBy(repository.MakeGenericType(interfaceType))&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;.CustomDependencies(Property.ForKey(&quot;ConcreteType&quot;).Eq(mappedClass))&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;);&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;&#xA;&#x9;private static bool IsDefinedInAssemblies(Type type, Assembly[] assemblies)&#xA;&#x9;{&#xA;&#x9;&#x9;return Array.IndexOf(assemblies, type.Assembly) != -1;&#xA;&#x9;}&#xA;}</p>
        </article>
        <article id="article-6938">
            <a href="https://ayende.com/blog/3217/upfront-optimizations" target="_blank">
                <h2 class="title mb-6" id="article-6938">Upfront Optimizations</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 26, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Developers tends to be micro optimizers by default, in most cases. In general it is accepted that this is a Bad Thing. This is a very common quote:     In my last project, I wasn&#x27;t willing to allow discussion on the performance of the application until we got to final QA stages. (We found exactly two bottle necks in the application, by the way, and it cost us 1 hour and 1 day to fix them). You could say that I really believe that premature optimization is a problem.  However, the one thing that I will think of in advance (hopefully far in advance), is reducing the amount of remote calls.     This is something that you should think of in advance, because a remote call is several orders of magnitudes than just about anything else that you can do in your application except maybe huge prime generation.  In general, you need to think about two things:     How can we reduce remote calls?    How can we fail (in development) for exceeding some amount of remote calls per a unit of work?   What I have found is that batching makes for a really nice model for reducing remote calls, and ensuring failure on high number of remote calls to be the most effective way to reduce their number.  This is generally not something that you can retrofit into the system, the model of work is completely different. You can try, but you end up with a Frankenstein that is going to be slow and hard to work with.  So, at any rate, this is what I wanted to say. Ignore performance until very late in the game, but do think about remote calls and the distribution of the application components as early as possible.  No, this is not BDUF, it is setting the architecture for the application, and having the right fundamental approach as early as possible.  &#xA0;  ,</p>
        </article>
        <article id="article-6939">
            <a href="https://ayende.com/blog/3216/the-devil-is-in-the-details" target="_blank">
                <h2 class="title mb-6" id="article-6939">The devil is in the details</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 26, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Quite often, I hear about a new approach or framework, and they are interesting concepts, with obviously trivial implementations.  In fact, the way I usually learn about new approach is by writing my own spike to explore how such a thing can work. (As an alternative, I will go and read the code, if it is an OSS project).  The problem is that obviously trivial implementations tends to ignore a lot of the fine details. Even for the trivial things, there are a lot of details to consider before you can call something production ready.  Production ready is a tough concept to define, but it is generally means that you have taken into account things like:     Performance    Error handling    Security   And many, many more.   One of the release criteria of Rhino Mocks is the ability to mock IE COM interfaces, as a simple example. That is actually much tougher than it looks (go figure out what RVA is and come back to tell me), as a good example;  But mocking is a complex issue as it is, let us take unit testing as an example, it is very simple concept, after all. How hard is it to build? Let us see:     public class MyUnitTestingFramework&#xA;{&#xA;&#x9;public static void Main(string[] args)&#xA;&#x9;{&#xA;&#x9;&#x9;foreach(string file in args)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;foreach(Type type in Assembly.Load(file).GetTypes())&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;foreach(MethodInfo method in type.GetMethods())&#xA;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;if(IsTest(method)==false)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;continue;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;try&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;object instance = Activator.CreateInstance(type);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;method.Invoke(instance, new object[0]);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;catch(Exception e)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Console.WriteLine(&quot;Test failed {0}, because: {1}&quot;, method, e);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;&#x9;&#xA;&#x9;public static bool IsTest(MethodInfo method)&#xA;&#x9;{&#xA;&#x9;&#x9;foreach(object att in method.GetCustomerAttributes(true))&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;if(att.GetType().Name == &quot;Test&quot;)&#xA;&#x9;&#x9;&#x9;&#x9;return true;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;return false;&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;Yeah, I have created Rhino Unit!&#xA;&#xA;Well, not hardly.&#xA;&#xA;I can write an OR/M, IoC container and Proxies in an hour (each, not all of them). Knowing how to do this is important, but doing so for real is generally a mistake. I am currently using a homegrown-written-in-an-hour IoC container, I really don&#x27;t like it. I keep hitting the limitations, and the cost of actually getting a container up to par with the standard expectation is huge. I know that I can&#x27;t use a written-in-an-hour-OR/M without sedation. &#xA;&#xA;Here is the general outline of the cost to feature ratio for doing this on any of the high end tools:&#xA;&#xA; &#xA;&#xA;There really isn&#x27;t much of a complexity involved, just a lot of small details that you need to take care of, which is where all the cost goes.&#xA;&#xA;One thing that I am not telling you is that I didn&#x27;t show the entire graph, here is the same graph, this time with more of the timeline shown. After a while, the complexity tends to go away (if it isn&#x27;t, the project fails and dies, see previous graph).&#xA;&#xA; &#xA;&#xA;Nevertheless, the initial cost for rolling your own like this is significant. This is also the reason why I wince every time someone tells me that they just write their own everything. (yeah, I know, I am not one that can point fingers. I think that I mentioned before that I feel no overwhelming need to be self consistent).&#xA;&#xA;My own response for those graphs tend to follow the same path almost invariably:&#xA;&#xA;&#xA;  Build my own spike code to understand the challenges involved in building something like this.&#xA;&#xA;  Evaluate existing players against my criteria.&#xA;&#xA;  Evaluate comparability with the rest of my stack.&#xA;&#xA;&#xA;If it passes my criteria, I&#x27;ll tend to use that over building my own. If it doesn&#x27;t, well, at least I have a good reason to do it.&#xA;&#xA;Programming to learn is a good practice, one that is important not to lose. At the same time, it is crucial to remember that you shouldn&#x27;t take out the toys to play in front of the big boys unless you carry a big stick and are not afraid to use it.</p>
        </article>
        <article id="article-6940">
            <a href="https://ayende.com/blog/3215/svnbridge-frustrations" target="_blank">
                <h2 class="title mb-6" id="article-6940">SvnBridge Frustrations</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 26, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is how I am feeling at the moment (more below):     One of the major disadvantages of having to dog food the source control I am using to write the source control is that it is incredibly fragile.  It is fairly easy to violate some invariant in a non obvious way, which make for problems down the road. The problem is that those problems are symptoms, not the real issue. As a result, I have this:     I try to clean it up often, but at one point I got to SvnBridge5.  Thank god that SVN has such a good patching mechanism.</p>
        </article>
        <div class="button flex justify-between">
            <a href="693.html"><span class="back arrow"></span></a>

            <a href="695.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>