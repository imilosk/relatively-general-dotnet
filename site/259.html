
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Home â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<script>
    const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

    function getUserPref() {
        const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
        return storedTheme || (lightModePref.matches ? "light" : "dark");
    }

    function setTheme(newTheme) {
        if (newTheme !== "light" && newTheme !== "dark") {
            return console.warn(
                `Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
            );
        }

        const root = document.documentElement;

        // root already set to newTheme, exit early
        if (newTheme === root.getAttribute("data-theme")) {
            return;
        }

        root.setAttribute("data-theme", newTheme);

        const colorThemeMetaTag = document.querySelector("meta[name='theme-color']");
        const bgColour = getComputedStyle(document.body).getPropertyValue("--theme-bg");
        colorThemeMetaTag.setAttribute("content", `hsl(${bgColour})`);
        if (typeof localStorage !== "undefined") {
            localStorage.setItem("theme", newTheme);
        }
    }

    // initial setup
    setTheme(getUserPref());

    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("theme-toggle").addEventListener("click", () => {
            const theme = localStorage.getItem("theme");

            if (theme === "dark") {
                setTheme("light");
            } else {
                setTheme("dark");
            }
        });

        document.getElementById("toggle-navigation-menu").addEventListener("click", (e) => {
            const button = e.target;
            const ariaExpanded = button.getAttribute("aria-expanded");
            const header = document.getElementById("main-header");

            if (ariaExpanded === "true") {
                button.setAttribute("aria-expanded", "false");
                header.classList.remove("menu-open");
            } else {
                button.setAttribute("aria-expanded", "true");
                header.classList.add("menu-open");
            }
        });
    });
</script>

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <theme-toggle class="ms-auto">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main">
    <section aria-label="Blog post list">
        <a href="https://ayende.com/blog/168518/what-is-new-in-ravendb-3-0-meta-discussion" target="_blank"><h1 class="title mb-6">What is new in RavenDB 3.0</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: September 24, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is a big release, it is a big deal for us.  It took me 18(!) blog posts to discuss just the items that we wanted highlighted, out of over twelve hundred resolved issues and tens of thousands of commits by a pretty large team.  Even at a rate of two posts a day, this still took two weeks to go through.  We are also working on the new book, multiple events coming up as well as laying down the plans for RavenDB vNext. All of this is very exciting, but for now, I want to ask your opinion. Based on the previous posts in this series, and based on your own initial impressions of RavenDB, what do you think? This is me signing off, quite tired.</p>
        <a href="https://ayende.com/blog/168517/what-is-new-in-ravendb-3-0-operations-optimizations" target="_blank"><h1 class="title mb-6">What is new in RavenDB 3.0</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: September 23, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the important roles operations has is going to an existing server and checking if everything is fine. This is routine maintenance stuff. It can be things like checking if we have enough disk space for our expected growth, or if we don&#x2019;t have too many indexes. Here is some data from this blog&#x2019;s production system:  Note that we have the squeeze button, for when you need to squeeze every bit of perf out of the system. Let us see what happens when I click it (I used a different production db, because this one was already optimized). Here is what we get:  You can see that RavenDB suggest that we&#x2019;ll merge indexes, so we can reduce the overall number of indexes we have. We can also see recommendations for deleting unused indexes in general. The idea is that we keep track of those stats and allow you to make decisions based on those stats. So you don&#x2019;t have to go by gut feeling or guesses.</p>
        <a href="https://ayende.com/blog/168515/what-is-new-in-ravendb-3-0-operations-the-nitty-gritty-details" target="_blank"><h1 class="title mb-6">What is new in RavenDB 3.0</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: September 22, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">After looking at all the pretty pictures, let us take a look at what we have available for us for behind the cover for ops.&#xA;&#xA;&#x9;The first such change is abandoning performance counters. In 2.5, we reported a lot of our state through performance counters. However, while they are a standard tool and easy to work with using admin tools, they were also unworkable. We have had multiple times where RavenDB would hang because performance counters were corrupted, they require specific permissions and in general they were a lot of hassle. Instead of relying on performance counters, we are now using the metrics.net package to handle that. This gives us a lot more flexibility. We can now generate a lot more metrics, and we have. All of those are available in the /debug/metrics endpoint, and on the studio as well.&#xA;&#xA;&#x9;Another major change we did was to consolidate all of the database administration details to a centralized location:&#xA;&#xA;&#x9;Manage your server gives us all the tools we need to manage the databases on this server.&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;You can manage permissions, backup and restore, watch what is going on and in general do admin style operations.&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;In particular, note that we made it slightly harder to use the system database. The intent now is that the system database is reserved for managing the RavenDB server itself, and all users&#x2019; data will reside in their own databases.&#xA;&#xA;&#x9;You can also start a compaction directly from the studio:&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;&#xA0;&#xA;&#xA;&#x9;Compactions are good if you want to ask RavenDB to return some disk space to the OS (by default we reserve it for our own usage).&#xA;&#xA;&#x9;Restore &amp; backup are possible via the studio, but usually, admins want to script those out. We had Raven.Backup.exe to handle scripted backup for a while now. And you could restore using Raven.Server.exe --restore&#xA0; from the command line.&#xA;&#xA;&#x9;The problem was that this restored the database to disk,&#xA0; but didn&#x2019;t wire it to the server, so you had the extra step of doing that. This was useful for restoring system databases, not so much for named databases.&#xA;&#xA;&#x9;We now have:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;Raven.Server.exe&#xA0; --restore-system-database --restore-source=C:\backups\system\2014-09-17 --restore-destination=C:\Raven\Data\System&#xA;&#x9;&#xA;&#x9;&#x9;Raven.Serve.exe --restore-database=http://localhost:8080 --restore-source=C:\backups\RealEstateRUs\2014-09-17 --restore-database-name=C:\Raven\Data\Databases\RealEstateRUs&#xA;&#xA;&#xA;&#x9;Which make a clear distinction between those operations.&#xA;&#xA;&#x9;Another related issue is how Smuggler handles error. Previously, the full export process had to complete successfully for you to have a valid output. Now we are more robust for errors such as unreliable network or timeouts. That means that if your network has a tendency to cut connections off at the knee, you will be able to resume (assuming you use incremental export) and still get your data.&#xA;&#xA;&#x9;We have also made a lot of changes in the Smuggler to make it work more nicely in common deployment scenarios, where request size and time are usually limited. The whole process is more robust for errors now.&#xA;&#xA;&#x9;Speaking of making things more robust, another area where we put attention to was memory usage over time. Beyond just reducing our memory usage in common scenarios, we have also improved our GC story. We can now invoke explicit GCs when we know that we created a lot of garbage that needs to be rid off. We&#x2019;ll also invoke Large Object Heap compaction if needed, utilizing the new features in the .NET framework.&#xA;&#xA;&#x9;That is quite enough for a single post, but still doesn&#x2019;t cover all the operations change, I&#x2019;ll cover the stuff that should make your drool on the next post.</p>
        <a href="https://ayende.com/blog/168516/what-is-new-in-ravendb-3-0-operations-production-view" target="_blank"><h1 class="title mb-6">What is new in RavenDB 3.0</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: September 22, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the most challenging things to do in production is to know what is going on? In order to facilitate that, we have dedicate some time to exposing the internal guts of RavenDB to the outside world (assuming that the outside world has the appropriate permissions). One way to look at that is to subscribe to the log stream from RavenDB, you can do it like this:  This gives you the following:  Note that this requires no configuration changes, or restarting the server or database. As long as your logs subscription is active, we&#x2019;ll send you a live stream of all the log activity in RavenDB, which should allow you to get a lot of useful insights about what exactly it is that RavenDB is doing. This is especially important if you need to do any sort of trouble shooting, because that is when you need to have logs, and restarting the server to enable them is often out of the question (it would likely resolve the issue you want to understand). And honestly, this is a feature that we need to support customers, it is going to be much easier to just say &#x201C;let us look at the logs&#x201D;, rather than having to go over how to configure them, etc. Another thing to note is the fact that this can all be done remotely, you don&#x2019;t have to have access to the physical server. It does require you to have admin permissions on the server, so not any user can do that. Another production view that is available to you is the Traffic Watcher:  This gives you the option of looking at the requests that are actually hitting the server. It is a subset of information from the logs, but it is usually a lot more interesting to watch. And again, this can be done remotely as well. You can watch all databases, or just a single one. But most importantly from support perspective is the new Debug Info! package. And yes, it deserver the bang in the name. What this does is gather a lot of important information from the database, all the current stats, and a lot of stuff that we need to figure out what is going on. The idea is that if you have a problem, we won&#x2019;t have to ask for a lot of separate pieces of information, you can get it all as a single shot. Oh, and we can also grab the actual stack trace information from your system, so we even know exactly what your system is doing.  In my next post, I&#x2019;ll discuss one last operational concern, optimizations.</p>
        <a href="https://ayende.com/blog/168513/what-is-new-in-ravendb-3-0-operations-the-pretty-pictures-tour" target="_blank"><h1 class="title mb-6">What is new in RavenDB 3.0</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: September 19, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This has been the most important change in RavenDB 3.0, in my opinion. Not because of complexity and scope, pretty much everything here is much simpler than other features than we have done. But this is important because it makes RavenDB much easier to operate. Since the get go, we have tried to make sure that RavenDB would be a low friction system. We usually focused on the developer experience, and that showed when we had to deal with operational issues.&#xA;&#xA;&#x9;Things were more complex than they should. Now, to be fair, we had the appropriate facilities to figure things out, ranging from debug endpoints, to performance counters to a great debug log story. The problem is that in my eye, we were merely on par with other systems. RavenDB wasn&#x2019;t created to be on par, RavenDB was created so when you use this, you would sigh and say &#x201C;that is how it should be done&#x201D;. With RavenDB 3.0, I think we are much closer to that.&#xA;&#xA;&#x9;Because we have done so much work here, I&#x2019;m going to split things to multiple posts. This one is the one with all the pretty pictures, as you can imagine. Next one will talk about the actual operational behavior changes we made.&#xA;&#xA;&#x9;Let me go over some of those things with you. Here you can see the stats view, including looking at an index details.&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;That is similar to what we had before. But it gets interesting when we want to start actually looking at the data more deeply. Here are the indexing stats on my machine:&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;You can see that the Product/Sales index has a big fanout, by the fact that it has more items out than in, for example. You can also see how much items we indexed per batch, and how we do parallel indexing.&#xA;&#xA;&#x9;We also have a lot more metrics to look at. The current requests view along several time frames.&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;The live index work view:&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;The indexing batch size and the perfetching stats graph gives us live memory consumption usage for indexing, as well as some view on what indexing strategy is currently in use.&#xA;&#xA;&#x9;Combining those stats, we have a lot of information at our fingertips, and can get a better idea about what exactly is going on inside RavenDB.&#xA;&#xA;&#x9;But so far, this is just to look at things, let us see what else we can do. RavenDB does a lot of things in the background. From bulk insert work to set based operations. We added a view that let you see those tasks, and cancel them if you need to:&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;&#xA0;&#xA;&#xA;&#x9;You can now see all the work done by the replication background processes, which will give you a better idea on what your cluster is doing. And of course there is the topology view that we already looked at.&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;We also added views for most of the debug endpoints that RavenDB has. Here we are looking at the subscribed changes connections.&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;&#xA0;&#xA;&#xA;&#x9;We get a lot of metrics available for us now. In fact, we went a bit crazy there and started tracking a lot of stuff. This will help you understand what is going on internally. And you can also get nice histograms.&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;There is a lot of stuff there, so I won&#x2019;t cover it all, but I would show you what I think is one of the nicest features:&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;This will give you real stats about resource usage in your system. Including counts of documents per collection and the size on disk.&#xA;&#xA;&#x9;Okay, that is enough with the pretty pictures, on my next post, I&#x2019;ll talk about the actual changes we made to support operations better.</p>
        <a href="https://ayende.com/blog/168482/what-is-new-in-ravendb-3-0-sql-replication" target="_blank"><h1 class="title mb-6">What is new in RavenDB 3.0</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: September 19, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">SQL Replication has been a part of RavenDB for quite some time,showing up for the first time in the 1.0 build as the Index Replication Bundle. This turned out to be a very useful feature, and in 3.0 we had a dedicated developer for this for several weeks, banging it into new and interesting shapes.&#xA;&#xA;&#x9;We started out with a proper design for how you want to use it. And I&#x2019;m just going to take you through the process for a bit, then talk about the backend changes.&#xA;&#xA;&#x9;We start by defining a named connection string (note that you can actually test this immediately):&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;And then we define the actual replication behavior:&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;Note that we have the Tools control in the top? Clicking it and selecting Simulate will give you:&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;So you can actually see the commands that we are going to execute to replicate a specific document. That is going to save a lot of head scratching about &#x201C;why isn&#x2019;t this replicating properly&#x201D;.&#xA;&#xA;&#x9;You can even run this simulation against your source db, to check for errors such as constraint violations, etc.&#xA;&#xA;&#x9;The SQL Replication bundle now support forcing query recompilation, which avoid bad query plans caching in SQL Server:&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;And for the prudent DBA, we have done a lot to give you additional information. In particular, you can look at the metrics and see what is going on.&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;And:&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;In this case, I actually don&#x2019;t have a relational database on this machine to test this, but I&#x2019;m sure that you can figure it out.&#xA;&#xA;&#x9;The nice thing about it, we&#x2019;ll report separate metrics per table, so your DBA can see if a particular table is causing a slow down.&#xA;&#xA;&#x9;Overall, we streamlined everything and tried to give you as much information upfront as possible, as well as tracking the entire process. You&#x2019;ll find it much easier to work with and troubleshoot if needed.&#xA;&#xA;&#x9;This actually ties very well with our next topic, the operations changes in RavenDB to make it easier to manager. But that will be in the a future post.</p>
        <a href="https://ayende.com/blog/168450/what-changed-in-ravendb-3-0-replication" target="_blank"><h1 class="title mb-6">What changed in RavenDB 3.0: Replication</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: September 18, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Replication is kinda important to RavenDB. It is the building block for high availability and transparent failover, it is how we do scale out in many cases. I think that you won&#x2019;t be surprised to hear that we have done a lot of work around that area as well.&#xA;&#xA;&#x9;Some of that was internal, just optimizing how we are doing things. One such case was optimizing the addition of a new node to a cluster. Previously, that would mean that are carefully laid out plans for how to allocate memory for replication would have to be disrupted, and a lot of the time, we would need to do extra work to server both existing and new replication destinations. In RavenDB 3.0, we have specifically addressed this, and now we can do much better for this scenario, or even the more common one when you have one slower node.&#xA;&#xA;&#x9;But for the most part, a lot of the changes that has been made were done to make it easier to work with replication. The following screen shot shows a lot of the new features all at once:&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;Now, instead of defining the failover replication behavior on a client side (which meant that different clients could have different failover behavior), we define this behavior on the server side (note that server side behavior will override the client side behavior). This means that your admin can change the cluster from master/slave to the multi master topology and you won&#x2019;t have to change your code, it will be picked by the clients automatically.&#xA;&#xA;&#x9;Conflict resolution has also became easier. RavenDB now ships with three automatic conflict resolvers (prefer local, prefer remote, prefer latest). Another one is planned for post 3.0, which will allow you to write a server side conflict resolution script to handle custom logic.&#xA0; Of course, the usual conflict resolutions (client side listener, server side trigger) are still there and humming along quite nicely.&#xA;&#xA;&#x9;Below the replication destinations, you can see the server hilo prefix. This is a feature we had in RavenDB for several years, but it has never been really utilized. This allows multiple servers to accept new documents concurrently without having to fear conflicting ids.&#xA;&#xA;&#x9;Another feature that we added was better tracking of the health of the entire cluster. One part of that is the ability to visualize the topology:&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;From the client side of things, the behavior of the client in the presence of failure has been greatly improved. We do automatic failover, of course, but now we do the health checks of the down servers as a background task. That means that after the initial &#x201C;server is down&#x201D; shock, we immediately switch over to the secondary nodes, and we&#x2019;ll handle the primary recovering and switch back to it within a few seconds. That means that we won&#x2019;t have the complex backoff strategy or the hit that this took when every N request.&#xA;&#xA;&#x9;Another change we made to the client side was the ability to explicitly define the failover configuration on the client. That was a feature that people requested, mostly to handle the &#x201C;we start the first time and the server is down&#x201D; scenario. Not an hugely common situation, but it completes the entire feature set quite nicely.</p>
        <a href="https://ayende.com/blog/168449/what-is-new-in-ravendb-3-0-queries-improvements" target="_blank"><h1 class="title mb-6">What is new in RavenDB 3.0</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: September 18, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">RavenDB is an ACID database for documents, and it is a BASE database for queries. That design principle has serve us very well since the start, because it allow us to modify the way we are handling things internally without violating the promises we give to the user.&#xA0; In particular, the ability to hand out potentially stale information has been crucial for a lot of performance optimizations in RavenDB.  That said, while is has been a core feature of RavenDB from the start, I haven&#x2019;t found a single user who had a hankering for longer staleness latency. That is a long way to say that we managed to reduce further the number of times RavenDB will return query results marked as stale. We have talked about some of this in the previous posts, with regards to better batching and optimization in the indexing process itself, but we already talked about this. In RavenDB 3.0, we are using smarter algorithm to detect if an index has potentially changed, in particular, we can detect if the index isn&#x2019;t covering any of the changed documents that it hasn&#x2019;t had a chance to index yet. If we know that no document yet to be indexed is going to be indexed by this index, we can short circuit indexing and declare the index as non stale. In practice, this should resolve a common misconception &#x201C;I changed one document, all indexes became stale&#x201D; by having a better match between what the user thinks is going on and the externally observed behavior. Your applications would be a little faster, but that should be the sole difference from your point of view. Another change that does require you to take active action is nested transformers. The idea is that transformers often encompass some piece of business logic related to how to pull an entity / entities for a particular task. It would be nice not to have to duplicate this logic (and maintain it over time). With RavenDB 3.0, you can now nest transformers and have one transformer call another to do some part of the work. Here is how this looks:  //ProductsTransformerTransformResults = products =&gt;    from doc in products    select new    {        Name = doc.Name.Reverse()    };// another transformerTransformResults = products =&gt;    from doc in products    select new    {        Product = doc,        Transformed = TransformWith(&quot;ProductTransformer&quot;, doc)    };&#xA;The 2nd transformer calls to the ProductsTransformer by name, allow it to run its own processing (and potentially call yet another transformer, etc). Note that a transformer cannot recurse either directly on indirectly. In other words ,you cannot call yourself, or another transformer that has called you.&#xA;There has been a lot of other changes, of course, but a lot of them are too small to merit such a mention. Better support for querying unsigned integers is hardly earth shattering. But there has been a lot of those kind of changes. It means that you&#x2019;ll have a smoother experience overall. &#xA;Next post, replication .</p>
        <a href="https://ayende.com/blog/168419/what-is-new-in-ravendb-3-0-query-diagnostics" target="_blank"><h1 class="title mb-6">What is new in RavenDB 3.0</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: September 17, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We talked a lot about the changes we made for indexing, now let us talk about the kind of changes we are talking about from the query side of things. More precisely, this is when we start asking questions about our queries.&#xA;&#xA;&#x9;Timing queries. While it is rare that we have slow queries in RavenDB, it does happen, and when it does, we treat it very seriously. However, in the last few cases that we have seen, the actual problem wasn&#x2019;t with RavenDB, it was with sending the data back to the client when we had a large result set and large number of documents.&#xA;&#xA;&#x9;In RavenDB 3.0, we have added the ability to get detailed statistics about what is the cost of the query in every stage of the pipeline.&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;RavenQueryStatistics stats;&#xA;var users = session.Query&lt;Order&gt;(&quot;Orders/Totals&quot;)&#xA;    .Statistics(out stats)&#xA;    .Customize(x =&gt; x.ShowTimings())&#xA;    .Where(x=&gt;x.Company == &quot;companies/11&quot; || x.Employee == &quot;employees/2&quot;)&#xA;    .ToList();&#xA;&#xA;foreach (var kvp in stats.TimingsInMilliseconds)&#xA;{&#xA;    Console.WriteLine(kvp.Key &#x2B; &quot;: &quot; &#x2B; kvp.Value);&#xA;}&#xA;&#xA;Console.WriteLine(&quot;Total: &quot; &#x2B; stats.DurationMilliseconds);&#xA;&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;We can now ask RavenDB to explain us its reasoning when doing so:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;Lucene search: 10&#xA;&#x9;&#xA;&#x9;&#x9;Loading documents: 2&#xA;&#x9;&#xA;&#x9;&#x9;Transforming results: 0&#xA;&#x9;&#xA;&#x9;&#x9;Total: 21&#xA;&#xA;&#xA;&#x9;As you can see, the total time for this query is 21 ms, and we have 12 ms accounted for in the actual search time. The rest is network traffic.&#xA0; This can help you diagnose more easily where the problem is, and hence, how to solve it.&#xA;&#xA;&#x9;Query timeout and cancellation. As I mentioned, we don&#x2019;t really have long queries in RavenDB very often. But that is actually is something that happens, and we need a way to deal with that. RavenDB now places a timeout on the amount of time a query gets to run (including querying Lucene, loading documents or transforming the results). A query that doesn&#x2019;t complete in time will be cancelled, and an error will be returned to the user.&#xA;&#xA;&#x9;You can also view the currently executing queries and kill a long running query (if you have specified a high timeout, for example).&#xA;&#xA;&#x9;Explaining queries. Sometimes it is easy to understand why RavenDB has decided to give you documents in a certain order. You asked them sorted by date, and you get them sorted by date. But when you are talking about complex queries, that is much harder. RavenDB will sort the results by default based on relevancy, and that can sometimes be a bit puzzling to understand.&#xA;&#xA;&#x9;Here is how we can do this:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;session.Advanced.DocumentQuery&lt;Order&gt;(&quot;Orders/Totals&quot;)&#xA;                    .Statistics(out stats)&#xA;                    .WhereEquals(&quot;Company&quot;, &quot;companies/11&quot;)&#xA;                    .WhereEquals(&quot;Employee&quot;, &quot;employees/3&quot;)&#xA;                    .ExplainScores()&#xA;                    .ToList();&#xA;&#xA;var explanation = stats.ScoreExplantaions[&quot;orders/759&quot;];&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;The result of this would be something that looks like this:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;0.6807194 = (MATCH) product of:&#xA;  1.361439 = (MATCH) sum of:&#xA;    1.361439 = (MATCH) weight(Employee:employees/3 in 469), product of:&#xA;      0.4744689 = queryWeight(Employee:employees/3), product of:&#xA;        2.869395 = idf(docFreq=127, maxDocs=830)&#xA;        0.165355 = queryNorm&#xA;      2.869395 = (MATCH) fieldWeight(Employee:employees/3 in 469), product of:&#xA;        1 = tf(termFreq(Employee:employees/3)=1)&#xA;        2.869395 = idf(docFreq=127, maxDocs=830)&#xA;        1 = fieldNorm(field=Employee, doc=469)&#xA;  0.5 = coord(1/2)&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;And if we were to ask for the explanation for orders/237, we will get:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;6.047595 = (MATCH) sum of:&#xA;  4.686156 = (MATCH) weight(Company:companies/11 in 236), product of:&#xA;    0.8802723 = queryWeight(Company:companies/11), product of:&#xA;      5.32353 = idf(docFreq=10, maxDocs=830)&#xA;      0.165355 = queryNorm&#xA;    5.32353 = (MATCH) fieldWeight(Company:companies/11 in 236), product of:&#xA;      1 = tf(termFreq(Company:companies/11)=1)&#xA;      5.32353 = idf(docFreq=10, maxDocs=830)&#xA;      1 = fieldNorm(field=Company, doc=236)&#xA;  1.361439 = (MATCH) weight(Employee:employees/3 in 236), product of:&#xA;    0.4744689 = queryWeight(Employee:employees/3), product of:&#xA;      2.869395 = idf(docFreq=127, maxDocs=830)&#xA;      0.165355 = queryNorm&#xA;    2.869395 = (MATCH) fieldWeight(Employee:employees/3 in 236), product of:&#xA;      1 = tf(termFreq(Employee:employees/3)=1)&#xA;      2.869395 = idf(docFreq=127, maxDocs=830)&#xA;      1 = fieldNorm(field=Employee, doc=236)&#xA;&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;In other words, we can see that orders/237 is ranked much higher than orders/759. That is because is matched both clauses of the query. And a match on Company is a much stronger indication for relevancy because Companies/11 appears only in 10 documents out out 830, while Employees/3 appears in 127 out of 830.&#xA;&#xA;&#x9;For details about this format, see this presentation, it actually talks about Solr here, but this data comes from Lucene, so it applies to both.&#xA;&#xA;&#x9;That is it about queries diagnostics, next, we&#x2019;ll deal with transformers and another important optimization, the staleness reduction system.</p>
        <a href="https://ayende.com/blog/168418/what-is-new-in-ravendb-3-0-indexing-enhancements" target="_blank"><h1 class="title mb-6">What is new in RavenDB 3.0</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: September 17, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We talked previously about the kind of improvements we have in RavenDB 3.0 for the indexing backend. In this post, I want to go over a few features that are much more visible.&#xA;&#xA;&#x9;Attachment indexing. This is a feature that I am not so hot about, mostly because we want to move all attachment usages to RavenFS. But in the meantime, you can reference the contents of an attachment during index. That can let you do things like store large text data in an attachment, but still make it available for the indexes. That said, there is no tracking of the attachment, so if it change, the document that referred to it won&#x2019;t be re-indexed as well. But for the common case where both the attachments and the documents are always changed together, that can be a pretty nice thing to have.&#xA;&#xA;&#x9;Optimized new index creation. In RavenDB 2.5, creating a new index would force us to go over all of the documents in the database, not just the documents that we have in that collection. In many cases, that surprised users, because they expected there to be some sort of physical separation between the collections. In RavenDB 3.0, we changed things so creating a new index on a small collection (by default, less than 131,072 items) will be able to only touch the documents that belong to the collections being covered by that index. This alone represent a pretty significant change in the way we are processing indexes.&#xA;&#xA;&#x9;In practice, this means that creating a new index on a small index would complete much more rapidly. For example, I reset an index on a production instance, it covers about 7,583 documents our of 19,191. RavenDB was able to index that in just 690 ms, out of about 3 seconds overall that took for the index reset to take place.&#xA;&#xA;&#x9;What about the cases where we have new indexes on large collections? At this point, in 2.5, we would do round robin indexing between the new index and the existing ones. The problem was that 2.5 was biased toward the new index. That meant that it was busy indexing the new stuff, while the existing indexes (which you are actually using) took longer to run. Another problem was that in 2.5 creating a new index would effectively poison a lot of performance heuristics.&#xA0; Those were built for the assumptions of all indexes running pretty much in tandem. And when we have one or more that weren&#x2019;t doing so&#x2026; well, that caused things to be more expensive.&#xA;&#xA;&#x9;In 3.0, we have changed how this works. We&#x2019;ll have separate performance optimization pipelines for each group of indexes based on its rough indexing position. That lets us take advantage of batching many indexes together. We are also not going to try to interleave the indexes (running first the new index and then the existing ones). Instead, we&#x2019;ll be running all of them in parallel, to reduce stalls and to increase the speed in which everything comes up to speed.&#xA;&#xA;&#x9;This is using our scheduling engine to ensure that we aren&#x2019;t actually overloading the machine with computation work (concurrent indexing) or memory (number of items to index at once). I&#x2019;ve very proud in what we have done here, and even though this is actually a backend feature, it is too important to get lost in the minutia of all the other backend indexing changes we talked about in my previous post.&#xA;&#xA;&#x9;Explicit Cartesian/fanout indexing. A Cartesian index (we usually call them fanout indexes) is an index that output multiple index entries per each document. Here is an example of such an index:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;from postComment in docs.PostComments&#xA;from comment in postComment.Comments&#xA;where comment.IsSpam == false&#xA;select new {&#xA;    CreatedAt = comment.CreatedAt,&#xA;    CommentId = comment.Id,&#xA;    PostCommentsId = postComment.__document_id,&#xA;    PostId = postComment.Post.Id,&#xA;    PostPublishAt = postComment.Post.PublishAt&#xA;}&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;For a large post, with a lot of comments, we are going to get an entry per comment. That means that a single document can generate hundreds of index entries.&#xA0; Now, in this case, that is actually what I want, so that is fine.&#xA;&#xA;&#x9;But there is a problem here. RavenDB has no way of knowing upfront how many index entries a document will generate, that means that it is very hard to allocate the appropriate amount of memory reserves for this, and it is possible to get into situations where we simply run out of memory. In RavenDB 3.0, we have added explicit instructions for this. An index has a budget, by default, each document is allowed to output up to 15 entries. If it tries to output more than 15 entries, that document indexing is aborted, and it won&#x2019;t be indexed by this index.&#xA;&#xA;&#x9;You can override this option either globally, or on an index by index basis, to increase the number of index entries per document that are allowed for an index (and old indexes will have a limit of 16,384 items, to avoid breaking existing indexes).&#xA;&#xA;&#x9;The reason that this is done is so either you didn&#x2019;t specify a value, in which case we are limited to the default 15 index entries per document, or you did specify what you believe is a maximum number of index entries outputted per document, in which case we can take advantage of that when doing capacity planning for memory during indexing.&#xA;&#xA;&#x9;Simpler auto indexes. This feature is closely related to the previous one. Let us say that we want to find all users that have an admin role and has an unexpired credit card. We do that using the following query:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;var q = from u in session.Query&lt;User&gt;()&#xA;        where u.Roles.Any(x=&gt;x.Name == &quot;Admin&quot;) &amp;&amp; u.CreditCards.Any(x=&gt;x.Expired == false)&#xA;        select u;&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;In RavenDB 2.5, we would generate the following index to answer this query:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;from doc in docs.Users&#xA;from docCreditCardsItem in ((IEnumerable&lt;dynamic&gt;)doc.CreditCards).DefaultIfEmpty()&#xA;from docRolesItem in ((IEnumerable&lt;dynamic&gt;)doc.Roles).DefaultIfEmpty()&#xA;select new {&#xA;    CreditCards_Expired = docCreditCardsItem.Expired,&#xA;    Roles_Name = docRolesItem.Name&#xA;}&#xA;&#x9;&#x9;&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;And in RavenDB 3.0 we generate this:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;from doc in docs.Users&#xA;select new {&#xA;    CreditCards_Expired = (&#xA;        from docCreditCardsItem in ((IEnumerable&lt;dynamic&gt;)doc.CreditCards).DefaultIfEmpty()&#xA;        select docCreditCardsItem.Expired).ToArray(),&#xA;    Roles_Name = (&#xA;        from docRolesItem in ((IEnumerable&lt;dynamic&gt;)doc.Roles).DefaultIfEmpty()&#xA;        select docRolesItem.Name).ToArray()&#xA;}&#xA;&#x9;&#x9;&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;Note the difference between the two. The 2.5 would generate multiple index entries per document, while RavenDB 3.0 generate just one. What is worse is that 2.5 would generate a Cartesian product, so the number of index entries outputted in 2.5 would be the number of roles for a user times the number of credit cards they have.&#xA0; In RavenDB 3.0, we have just one entry, and the overall cost is much reduced. It was a big change, but I think it was well worth it, considering the alternative.&#xA;&#xA;&#x9;In my next post, I&#x2019;ll talk about the other side of indexing, queries. Hang on, we still have a lot to go through.</p>
        <div class="button flex justify-between">
            <a href="258.html"><span class="back arrow"></span></a>

            <a href="260.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
</body>
</html>