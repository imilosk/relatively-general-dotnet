
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 721 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-7201">
            <a href="https://ayende.com/blog/3113/rhino-security-part-ii-discussing-the-implementation" target="_blank">
                <h2 class="title mb-6" id="article-7201">Rhino Security</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 24, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just finished testing an annoying but important feature, NHibernate&#x27;s second level cache integration with Rhino Security. The security rules are a natural candidate for caching, since they change to change on an infrequent basis but are queried often. As such, it is obvious why I spent time ensuring that the whole thing works successfully. At any rate, what I wanted to talk about today was structure of the framework. You can see the table layout below.  A few things to note:  The tables are all in the &quot;security&quot; schema, I find that it makes more sense this way, but you can set it to work with &quot;security_Operation&quot; if you really like (or the DB doesn&#x27;t support schemas). User is referenced a few times, but is not shown here. As I mentioned earlier, the user entity is an external concept. We are using the mapping rewriting technique that we discussed earlier. (more below)   Here is the main interface for Rhino Security:   The tasks it performs are:  Enhance a query with security information. Get an explanation about why permission was given / denied. Perform an explicit permission check on entity or feature. The last two are fairly easy to understand, but what does the last one means? It means that if I want to perform a &quot;select * from accounts&quot; and I enhance the query, I will give this baby:  SELECT THIS_.ID&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AS ID4_0_, &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; THIS_.SECURITYKEY AS SECURITY2_4_0_, &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; THIS_.NAME&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AS NAME4_0_ FROM&#xA0;&#xA0; ACCOUNTS THIS_ WHERE&#xA0; @p0 = (SELECT&#xA0;&#xA0; THIS_0_.ALLOW AS Y0_ &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; FROM&#xA0;&#xA0;&#xA0;&#xA0; SECURITY_PERMISSIONS THIS_0_ &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; INNER JOIN SECURITY_OPERATIONS OP1_ &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ON THIS_0_.OPERATION = OP1_.ID &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LEFT OUTER JOIN SECURITY_ENTITIESGROUPS ENTITYGROU2_ &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ON THIS_0_.ENTITIESGROUP = ENTITYGROU2_.ID &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LEFT OUTER JOIN SECURITY_ENTITYREFERENCESTOENTITIESGROUPS ENTITIES7_ &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ON ENTITYGROU2_.ID = ENTITIES7_.GROUPID &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LEFT OUTER JOIN SECURITY_ENTITYREFERENCES ENTITYKEY3_ &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ON ENTITIES7_.ENTITYREFERENCEID = ENTITYKEY3_.ID &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHERE&#xA0;&#xA0;&#xA0; OP1_.NAME IN (@p1,@p2) &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AND (THIS_0_.&quot;User&quot; = @p3 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; OR THIS_0_.USERSGROUP IN (@p4)) &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AND ((THIS_.SECURITYKEY = THIS_0_.ENTITYSECURITYKEY &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; OR THIS_.SECURITYKEY = ENTITYKEY3_.ENTITYSECURITYKEY) &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; OR (THIS_0_.ENTITYSECURITYKEY IS NULL  &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AND THIS_0_.ENTITIESGROUP IS NULL)) &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ORDER BY THIS_0_.LEVEL DESC, &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; THIS_0_.ALLOW ASC); Isn&#x27;t it cute?&#xA0; This is much better than some home grown security system that I have seen (some of which I have built, actually), since it is stable with regards to the cost of the query that it will use. I mention before that it is possible to de-normalize the information into a single table, but since this requires more invasive approach from the application side, and since I have not seen performance issues with this yet, I&#x27;ll leave it at this point for the moment. Advance: Working with non DB backed users In most applications, the user is a fully fledged entity, even if your authentication is elsewhere. Just keeping things like preferences will necessitate that, but let us assume that we really have that as a non DB entity. In this case, we would need to make modifications to the tables (which we generally do, anyway, although automatically), and re-map the user references as an IUserType that can get the user from an id instead of a foreign key to entity. I think I&#x27;ll wait until someone really needs it to make a demo of it. Anyway, this is the main magic. It was fairly hard to get it right, as a matter of fact. But the query enhancement was one of the things that made security a breeze in my last project. We had a custom security module, but many of the concepts are the same. The next part we will talk a bit about the IsAllowed and how that works. There is some nice magic there as well.</p>
        </article>
        <article id="article-7202">
            <a href="https://ayende.com/blog/3112/nhibernate-and-the-second-level-cache-tips" target="_blank">
                <h2 class="title mb-6" id="article-7202">NHibernate and the second level cache tips</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 24, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I have been tearing my hair our today, because I couldn&#x27;t figure out why something that should have worked didn&#x27;t ( second level caching , obviously ). Along the way, I found out several things that you should be aware of. First of all, let us talk about what the feature is, shall we? NHibernate is design as an enterprise OR/M product, and as such, it has very good support for running in web farms scenarios. This support include running along side with distributed caches, including immediate farm wide updates.&#xA0; NHibernate goes to great lengths to ensure cache consistency in these scenarios (it is not perfect, but it is very good). A lot of the things that tripped me today were related to just that, NHibernate was working to ensure cache consistency and I wasn&#x27;t aware of that. The way it works, NHibernate keeps three caches.   The entities cache - the entity data is disassembled and then put in the cache, ready to be assembled to entities again. The queries cache - the identifiers of entities returned from queries, but no the data itself (since this is in the entities cache). The update timestamp cache - the last time a table was written to. The last cache is very important, since it ensures that the cache will not serve stale results.  Now, when we come to actually using the cache, we have the following semantics.   Each session is associated with a timestamp on creation. Every time we put query results in the cache, the timestamp of the executing session is recorded. The timestamp cache is updated whenever a table is written to, but in a tricky sort of way:  When we perform the actual writing, we write a value that is somewhere in the future to the cache. So all queries that hit the cache now will not find it, and then hit the DB to get the new data. Since we are in the middle of transaction, they would wait until we finish the transaction. If we are using low isolation level, and another thread / machine attempts to put the old results back in the cache, it wouldn&#x27;t hold, because the update timestamp is into the future.  When we perform the commit on the transaction, we update the timestamp cache with the current value. Now, let us think about the meaning of this, shall we? If a session has perform an update to a table, committed the transaction and then executed a cache query, it is not valid for the cache. That is because the timestamp written to the update cache is the transaction commit timestamp, while the query timestamp is the session&#x27;s timestamp, which obviously comes earlier. The update timestamp cache is not updated until you commit the transaction! This is to ensure that you will not read &quot;uncommited values&quot; from the cache. Another gotcha is that if you open a session with your own connection, it will not be able to put anything in the cache (all its cached queries will have invalid timestamps!) In general, those are not things that you need to concern yourself with, but I spent some time today just trying to get tests for the second level caching working, and it took me time to realize that in the tests I didn&#x27;t used transactions and I used the same session for querying as for performing the updates.</p>
        </article>
        <article id="article-7203">
            <a href="https://ardalis.com/ohio-day-of-net/" target="_blank">
                <h2 class="title mb-6" id="article-7203">Ohio Day of .NET</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 23, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Several user groups in southern and central Ohio are putting together a Day of .NET event this spring. The Central Ohio Day of .NET 200&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-7204">
            <a href="https://ayende.com/blog/3111/convention-based-security-a-monorail-sample" target="_blank">
                <h2 class="title mb-6" id="article-7204">Convention based security: A MonoRail Sample</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 23, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I was asked how I would got about building a real world security with the concept of securing operations instead of data.  This is a quick &amp; dirty implementation of the concept by marrying Rhino Security to MonoRail. This is so quick and dirty that I haven&#x27;t even run it, so take this as a concept, not the real implementation, please. The idea is that we can map each request to an operation, and use the convention of &quot;id&quot; as a special meaning to perform operation security that pertain to specific data. Here is the code: public class RhinoSecurityFilter : IFilter&#xA;{&#xA;    private readonly IAuthorizationService authorizationService;&#xA;&#xA;    public RhinoSecurityFilter(IAuthorizationService authorizationService)&#xA;    {&#xA;        this.authorizationService = authorizationService;&#xA;    }&#xA;&#xA;    public bool Perform(ExecuteWhen exec, IEngineContext context, IController controller,&#xA;                        IControllerContext controllerContext)&#xA;    {&#xA;        string operation = &quot;/&quot; &#x2B; controllerContext.Name &#x2B; &quot;/&quot; &#x2B; controllerContext.Action;&#xA;        string id = context.Request[&quot;id&quot;];&#xA;        object entity = null;&#xA;        if (string.IsNullOrEmpty(id) == false)&#xA;        {&#xA;            Type entityType = GetEntityType(controller);&#xA;            entity = TryGetEntity(entityType, id);&#xA;        }&#xA;&#xA;        if(entity==null)&#xA;        {&#xA;            if (authorizationService.IsAllowed(context.CurrentUser, operation) == false)&#xA;            {&#xA;                DenyAccessToAction();&#xA;            }&#xA;        }&#xA;        else&#xA;        {&#xA;            if (authorizationService.IsAllowed(context.CurrentUser, entity, operation) == false)&#xA;            {&#xA;                DenyAccessToAction();&#xA;            }&#xA;        }&#xA;        return true;&#xA;    }&#xA;}&#xA;It just perform a security check using the /Controller/Action names, and it tries to get the entity from the &quot;id&quot; parameter if it can.&#xA;Then, we can write our base controller:&#xA;[Filter(ExecuteWhen.BeforeAction,typeof(RhinoSecurityFilter))]&#xA;public class AbstractController : SmartDispatcherController&#xA;{&#xA;&#xA;}&#xA;Now you are left with configuring the security, but you already have a cross cutting security implementation. &#xA;As an example, hitting this url: /orders/list.castle?id=15&#xA;Will perform a security check that you have permission to list customer&#x27;s 15 orders.&#xA;This is pretty extensive, probably overly so, however. A better alternative would be to define an attribute with the ability to override the default operation name, so you can group several action into the same operation.&#xA;You would still need a way to bypass that, however, since there are some thing where you would have to allow access and perform custom permissions, no matter how flexible Rhino Security is, or you may be required to do multiply checks to verify that, and this system doesn&#x27;t allow for it.&#xA;Anyway, this is the overall idea, thoughts?</p>
        </article>
        <article id="article-7205">
            <a href="https://ayende.com/blog/3110/designing-the-security-model" target="_blank">
                <h2 class="title mb-6" id="article-7205">Designing the Security Model</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 23, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Right now I want to talk more deeply than merely the security infrastructure, I want to talk about how you use this security infrastructure.  There are several approaches for those. One of them, which I have seen used heavily in CSLA, is to simply make the check in the properties. Something like this: public class Comment&#xA;{&#xA;&#x9;public virtual IPAddress OriginIP &#xA;&#x9;{ &#xA;&#x9;&#x9;get &#xA;&#x9;&#x9;{ &#xA;&#x9;&#x9;&#x9;CanReadProperty(true); &#xA;&#x9;&#x9;&#x9;return originIP; &#xA;&#x9;&#x9;} &#xA;&#x9;&#x9;set &#xA;&#x9;&#x9;{ &#xA;&#x9;&#x9;&#x9;CanWriteProperty(true); &#xA;&#x9;&#x9;&#x9;originIP = value; &#xA;&#x9;&#x9;} &#xA;&#x9;}&#xA;&#xA;&#x9;public virtual bool CanDelete() { ... }&#xA;}&#xA;We can move to a declarative model with attributes, like this:&#xA;[SecuredEntity]&#xA;public class Comment&#xA;{&#xA;&#x9;[SecuredProperty]&#xA;&#x9;public virtual IPAddress OriginIP&#xA;&#x9;{&#xA;&#x9;&#x9;get { return originIP; }&#xA;&#x9;&#x9;set { originIP = value; }&#xA;&#x9;}&#xA;}&#xA;We can take it a step further and decide that we don&#x27;t want to explicitly state this, and just assume it by convention.&#xA;A while ago I decided to make a system work in this exact fashion. Of course, I am a big believer of convention over configuration, so we defined the following rules for the application:&#xA;&#xA;Need to secure&#xA0; Read / Write / Delete&#xA;Need to support custom operation as well, like &quot;Assign work&quot;, &quot;Authorize time sheet&quot;, etc&#xA;Developers will forget to make security calls, we need to develop a system that protects us from this.&#xA;We built a really nice implementation that hooked directly into the container and the data access later, you literally could not make a security breach, because you were always running under the context of a user, and the data was filtered for you by the data access in a generic fashion. For that matter, we didn&#x27;t have to worry about authorization in the business code, we made in memory modification and then persisted that. If we had a security violation, we simply showed an error to the user.&#xA;We didn&#x27;t have to define anything in the code either, it was all convention based and implicit. The only complexity was in configuring the security system itself, but that was the nature of the beast, after all. We though that we found the ultimate security pattern, and were quite pleased with ourselves. Until we started user testing. Then we run into... interesting issues.&#xA;We had the idea of a rule in the system, which could be used by the administrators to set policies. It worked just fine in our testing, until we started to get impossible errors from the users. I think that you can understand what it was by now, right? (Yes, the usual, developers always test as admin)&#xA;Normal users didn&#x27;t have permissions to read those rules, but the system really needed them to perform core parts of its tasks. We are always running under the user context and we are always making the security check. The system was designed, up front, to be very explicit about it. Now we found that there really were reasons where the system needed access to the entities without performing those security checks.&#xA;Another &quot;interesting issue&quot; that came up was the issue of information aggregation. As it turn out, it was always the wrong idea to report that there is only a single entity in the system, just because the user has access to just that one. I&#x27;ll let you draw the conclusion about the HR users that found out that they really couldn&#x27;t see how many hours an employee worked in this month.&#xA;It was a big problem, and we had to scramble around and hack-a-lot the ultimate security solution that we so loved.&#xA;The security system had two major issues:&#xA;&#xA;It was too granular.&#xA;It didn&#x27;t have any operating context.&#xA;Since then, I have learned a lot about how to design and implement security modules, and my current design has the following requirements:&#xA;&#xA;Security decisions are made on a use case level&#xA;Have a standard, enforced, approach of dealing with security&#xA;Make security decision easy to code.&#xA;How does this translate to code?&#xA;Well, first I need to define what a use case is in the code. For a web application, it is almost always at the page / request level, and that makes it very easy to deal with.&#xA;In my last project, we had the following base class defined:&#xA;public abstract class AbstractController&#xA;{&#xA;&#x9;public abstract AssertUserIsAllowed();&#xA;}&#xA;Since all the controllers in the application inherited from AbstractController, we had a single place that we put all the security checks. We still had to deal with security in other places, such as when we loaded data from the database, or wanted partial views, but this approach meant that we had remembered what was going on. If we needed to make security decisions elsewhere, we commented that in the assert. &#xA;But this was in a Rhino Igloo application, where by necessity we had to have a controller per page. Using MonoRail, we usually have a single controller that handles several actions, in which case I would tend to write something like this:&#xA;[AllowEveryone]&#xA;public void Login()&#xA;{&#xA;&#x9;...&#xA;}&#xA;&#xA;[AllowAuthenticatedUsers]&#xA;public void Index()&#xA;{&#xA;&#x9;...&#xA;}[ActionPerformsCustomSecurityCheck]&#xA;public void Save(...)&#xA;{&#xA;&#x9;...&#xA;}&#xA;And then I would mandate that all actions would have to have security attributes on them (Mandate as in, if it doesn&#x27;t have security attribute, you can&#x27;t access it).&#xA;Well, actually, right now I would probably route it through Rhino Security, which would give me more flexibility than this model, and would keep it out of the code.&#xA;Nevertheless, I would put security at the use case level. This is where I have the context to ask the correct questions. Anything else tend to lead to an increasingly complex set of special rules.</p>
        </article>
        <article id="article-7206">
            <a href="https://ayende.com/blog/3109/rhino-security-overview-part-i" target="_blank">
                <h2 class="title mb-6" id="article-7206">Rhino Security Overview: Part I</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 22, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A few months ago I spoke about how I would build a security infrastructure for an enterprise application, I went over the design goals that I had and the failing of previous attempts. Since then, I got a few requests to implement that, and since this is really neat piece of work, I decided to go ahead and build it. The main goals, allow me to remind you, are:  Flexible Performant Does not constrain the domain model Easy to work with Understandable No surprises You can read the post about it to get a feeling about what I had in mind when I thought it up.  When it came the time to actually implement them, however, it turn out that as usual, the implementation is significantly different than the design in all the details. Here is the overall detail of the entities involved. The main part that we have here is the security model, but notice that the application domain model is off to the side, and have very little to do with the security model. In fact, there is only a single requirement from the application domain model, the User entity needs to implement an interface with a single property, that is all. (more below)   &#xA0; From the point of view of interactions with the security system, we have two extensions points that we need to supply, a User entity implementing IUser, and a set of services implementing IEntityInformationExtractor&lt;TEntity&gt;:   The use of IEntityInformationExtractor&lt;TEntity&gt; is an interesting one. Rhino Security is using all my usual infrastructure, so it can take advantage of Windsor&#x27; generic specialization to do some nice tricks. Components of IEntityInformationExtractor&lt;TEntity&gt; are registered in the container, and resolved at runtime when there is a need for them. This means that you can either implement a generic one for your model, or specialize as needed using generics. I like this approach very much, frankly. From the point of view of the security model, we have the following:  User - the external User entity that is mapped into the security domain. Permissions are defined for users. Users Group - a named grouping of users. Permissions are defined for users groups. Entity - an external entity. Permissions are defined on entities. Entities Groups - a named groups of entities. Permissions are defined on entities groups. Operation - a named operation in the system, using the &quot;/Account/Financial/View&quot; pattern. Permission - Allow or deny an operation for user / users group for an entity / entities group. Here are a few examples of the kind of rules that we can defined with this method:  Allow &quot;/Account/Financial/View&quot; for &quot;Ayende&quot; on &quot;All Accounts&quot;, level 1 Allow &quot;/Account/Financial/View&quot; for &quot;Accounting Department&quot; on &quot;All Accounts&quot;, Level 1 Allow &quot;/Case/Assign&quot; for &quot;HelpDesk&quot; on &quot;Standard cases&quot;, level 1 Allow &quot;/Employee&quot; for &quot;Joe Smith&quot; on &quot;Direct Reports of Joe Smith&quot;, level 1 The major shift here is that we treat both entities and users groups as very cheap resources. Instead of having a just a few and structuring around them, we define what we want and then structure the groups around them. The burden them moves from complex code to maintaining the structure. I find this a very reasonable tradeoff for a simple security model and the flexibility that it gives me. Next time, setting up the security model...</p>
        </article>
        <article id="article-7207">
            <a href="https://ayende.com/blog/3108/sqlite-vs-sql-ce" target="_blank">
                <h2 class="title mb-6" id="article-7207">SQLite vs. SQL CE</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 22, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Those two seems to be the most common embedded databases in the .NET world. This is important to me, since I want to do testing against embedded database. SQL CE can be used with SQL Management Studio, which is nice, but it has three major issues for me so far:  It doesn&#x27;t support memory only operations. SQLite does, and it means a difference of 12 seconds vs. 40 seconds in running ~100 tests that hit the DB. This is important, especially kicking up everything seems to take about 10 seconds anyway (using Test Driven.Net) It doesn&#x27;t support paging (WTF!) It doesn&#x27;t support comparing to a sub query, so this is not legal:select * from account where 1 = (select allow from permissions) Right now I am experimenting with just how much I can twist around to get everything to break. I am on the third NH bug this week, and counting :-)</p>
        </article>
        <article id="article-7208">
            <a href="https://ayende.com/blog/3107/dealing-with-hierarchical-structures-in-databases" target="_blank">
                <h2 class="title mb-6" id="article-7208">Dealing with hierarchical structures in databases</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 22, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I have a very simple requirement, I need to create a hierarchy of users&#x27; groups. So you can do something like:  Administrators  DBA  SQLite DBA If you are a member of SQLite DBA group, you are implicitly a member of the Administrators group. In the database, it is trivial to model this:   Except that then we run into the problem of dealing with the hierarchy. We can&#x27;t really ask questions that involve more than one level of the hierarchy easily.&#xA0; Some databases has support for hierarchical operators, but that is different from one database to the next. That is a problem, since I need it to work across databases, and without doing too much fancy stuff. We can work around the problem by introducing a new table:   Now we move the burden of the hierarchy from the query phase to the data entry phase.  From the point of view of the entity, we have this:  Please ignore the death star shape and concentrate on the details :-)  Here is how we are getting all the data in the tree: public virtual UsersGroup[] GetAssociatedUsersGroupFor(IUser user)&#xA;{&#xA;    DetachedCriteria directGroupsCriteria = DetachedCriteria.For&lt;UsersGroup&gt;()&#xA;        .CreateAlias(&quot;Users&quot;, &quot;user&quot;)&#xA;        .Add(Expression.Eq(&quot;user.id&quot;, user.SecurityInfo.Identifier))&#xA;        .SetProjection(Projections.Id());&#xA;&#xA;    DetachedCriteria allGroupsCriteria = DetachedCriteria.For&lt;UsersGroup&gt;()&#xA;        .CreateAlias(&quot;Users&quot;, &quot;user&quot;, JoinType.LeftOuterJoin)&#xA;        .CreateAlias(&quot;AllChildren&quot;, &quot;child&quot;, JoinType.LeftOuterJoin)&#xA;        .Add(&#xA;            Subqueries.PropertyIn(&quot;child.id&quot;, directGroupsCriteria) ||&#xA;            Expression.Eq(&quot;user.id&quot;, user.SecurityInfo.Identifier));&#xA;&#xA;    ICollection&lt;UsersGroup&gt; usersGroups = &#xA;        usersGroupRepository.FindAll(allGroupsCriteria, Order.Asc(&quot;Name&quot;));&#xA;    return Collection.ToArray&lt;UsersGroup&gt;(usersGroups);&#xA;}&#xA;&#xA;Note that here we don&#x27;t care whatever we are associated with a group directly or indirectly. This is an important consideration in some scenarios (mostly when you want to display information to the user), so we need some way to chart the hierarchy, right?&#xA;Here is how we are doing this:&#xA;public virtual UsersGroup[] GetAncestryAssociation(IUser user, string usersGroupName)&#xA;{&#xA;    UsersGroup desiredGroup = GetUsersGroupByName(usersGroupName);&#xA;    ICollection&lt;UsersGroup&gt; directGroups =&#xA;        usersGroupRepository.FindAll(GetDirectUserGroupsCriteria(user));&#xA;    if (directGroups.Contains(desiredGroup))&#xA;    {&#xA;        return new UsersGroup[] { desiredGroup };&#xA;    }&#xA;    // as a nice benefit, this does an eager load of all the groups in the hierarchy&#xA;    // in an efficient way, so we don&#x27;t have SELECT N &#x2B; 1 here, nor do we need&#xA;    // to load the Users collection (which may be very large) to check if we are associated&#xA;    // directly or not&#xA;    UsersGroup[] associatedGroups = GetAssociatedUsersGroupFor(user);&#xA;    if (Array.IndexOf(associatedGroups, desiredGroup) == -1)&#xA;    {&#xA;        return new UsersGroup[0];&#xA;    }&#xA;    // now we need to find out the path to it&#xA;    List&lt;UsersGroup&gt; shortest = new List&lt;UsersGroup&gt;();&#xA;    foreach (UsersGroup usersGroup in associatedGroups)&#xA;    {&#xA;        List&lt;UsersGroup&gt; path = new List&lt;UsersGroup&gt;();&#xA;        UsersGroup current = usersGroup;&#xA;        while (current.Parent != null &amp;&amp; current != desiredGroup)&#xA;        {&#xA;            path.Add(current);&#xA;            current = current.Parent;&#xA;        }&#xA;        if (current != null)&#xA;            path.Add(current);&#xA;        // Valid paths are those that are contains the desired group&#xA;        // and start in one of the groups that are directly associated&#xA;        // with the user&#xA;        if (path.Contains(desiredGroup) &amp;&amp; directGroups.Contains(path[0]))&#xA;        {&#xA;            shortest = Min(shortest, path);&#xA;        }&#xA;    }&#xA;    return shortest.ToArray();&#xA;}&#xA;As an aside, this is about as complex a method as I can tolerate, and even that just barely.&#xA;I mentioned that the burden was when creating it, right? Here is what I meant:&#xA;public UsersGroup CreateChildUserGroupOf(string parentGroupName, string usersGroupName)&#xA;{&#xA;    UsersGroup parent = GetUsersGroupByName(parentGroupName);&#xA;    Guard.Against&lt;ArgumentException&gt;(parent == null,&#xA;                                     &quot;Parent users group &#x27;&quot; &#x2B; parentGroupName &#x2B; &quot;&#x27; does not exists&quot;);&#xA;&#xA;    UsersGroup group = CreateUsersGroup(usersGroupName);&#xA;    group.Parent = parent;&#xA;    group.AllParents.AddAll(parent.AllParents);&#xA;    group.AllParents.Add(parent);&#xA;    parent.Directchildren.Add(group);&#xA;    parent.AllChildren.Add(group);&#xA;    return group;&#xA;}&#xA;We could hide it all inside the Parent&#x27;s property setter, but we still need to deal with it.&#xA;And that is all you need to do in order to get it cross database hierarchical structures working.</p>
        </article>
        <article id="article-7209">
            <a href="https://ayende.com/blog/3106/performance-threading-and-double-checked-locks" target="_blank">
                <h2 class="title mb-6" id="article-7209">Performance, threading and double checked locks</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 21, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A very common pattern for lazy initialization of expensive things is this: GetDescriptionsHelper.Delegate getDescription;&#xA;if (GetDescriptionsHelper.Cache.TryGetValue(entityType, out getDescription) == false)&#xA;{&#xA;&#x9;MethodInfo getDescriptionInternalGeneric = getDescriptionInternalMethodInfo.MakeGenericMethod(entityType);&#xA;&#x9;getDescription = (GetDescriptionsHelper.Delegate)Delegate.CreateDelegate(&#xA;&#x9;&#x9;typeof(GetDescriptionsHelper.Delegate),&#xA;&#x9;&#x9;getDescriptionInternalGeneric);&#xA;&#xA;&#x9;GetDescriptionsHelper.Cache.Add(entityType, getDescription);&#xA;}&#xA;This tends to break down when we are talking about code that can run in multiply threads. So we start writing this:&#xA;lock(GetDescriptionsHelper.Cache)&#xA;{&#xA;&#x9;GetDescriptionsHelper.Delegate getDescription;&#xA;&#x9;if (GetDescriptionsHelper.Cache.TryGetValue(entityType, out getDescription) == false)&#xA;&#x9;{&#xA;&#x9;&#x9;MethodInfo getDescriptionInternalGeneric = getDescriptionInternalMethodInfo.MakeGenericMethod(entityType);&#xA;&#x9;&#x9;getDescription = (GetDescriptionsHelper.Delegate)Delegate.CreateDelegate(&#xA;&#x9;&#x9;&#x9;typeof(GetDescriptionsHelper.Delegate),&#xA;&#x9;&#x9;&#x9;getDescriptionInternalGeneric);&#xA;&#x9;&#xA;&#x9;&#x9;GetDescriptionsHelper.Cache.Add(entityType, getDescription);&#xA;&#x9;}&#xA;}&#xA;Except, this is really bad for performance, because we always lock when we try to get the value out. So we start playing with it and get this:&#xA;GetDescriptionsHelper.Delegate getDescription;&#xA;if (GetDescriptionsHelper.Cache.TryGetValue(entityType, out getDescription) == false)&#xA;{&#xA;&#x9;lock(GetDescriptionsHelper.Cache)&#xA;&#x9;{&#x9;&#xA;&#x9;&#x9;MethodInfo getDescriptionInternalGeneric = getDescriptionInternalMethodInfo.MakeGenericMethod(entityType);&#xA;&#x9;&#x9;getDescription = (GetDescriptionsHelper.Delegate)Delegate.CreateDelegate(&#xA;&#x9;&#x9;&#x9;typeof(GetDescriptionsHelper.Delegate),&#xA;&#x9;&#x9;&#x9;getDescriptionInternalGeneric);&#xA;&#x9;&#xA;&#x9;&#x9;GetDescriptionsHelper.Cache.Add(entityType, getDescription);&#xA;&#x9;}&#xA;}&#xA;This code has a serious error in it, in the right conditions, two threads will evaluate the if at the same time, and then try to enter the lock at the same time. The end result is an exception as the second of them will try to add the entity type again.&#xA;So we come out with the doubly checked lock, like this:&#xA;GetDescriptionsHelper.Delegate getDescription;&#xA;if (GetDescriptionsHelper.Cache.TryGetValue(entityType, out getDescription) == false)&#xA;{&#xA;&#x9;lock(GetDescriptionsHelper.Cache)&#xA;&#x9;{&#x9;&#xA;&#x9;&#x9;if (GetDescriptionsHelper.Cache.TryGetValue(entityType, out getDescription) )&#xA;&#x9;&#x9;&#x9;return;&#xA;&#xA;&#x9;&#x9;MethodInfo getDescriptionInternalGeneric = getDescriptionInternalMethodInfo.MakeGenericMethod(entityType);&#xA;&#x9;&#x9;getDescription = (GetDescriptionsHelper.Delegate)Delegate.CreateDelegate(&#xA;&#x9;&#x9;&#x9;typeof(GetDescriptionsHelper.Delegate),&#xA;&#x9;&#x9;&#x9;getDescriptionInternalGeneric);&#xA;&#x9;&#xA;&#x9;&#x9;GetDescriptionsHelper.Cache.Add(entityType, getDescription);&#xA;&#x9;}&#xA;}&#xA;Now we are handling this condition as well. But my preference of late has been to use this code in multi threaded environments.&#xA;Update: I should be wrong more often, I got some very good replies to this post. The code below happened to work by chance and luck alone, apparently. The solution above is the more correct one.&#xA;Actually, it is more complex than that. It is still possible to have readers attempt to read the Cache variable (which is of type Dictionary&lt;Type, Delegate&gt;) while it is being written to inside the lock. There is a potential for serious&#xA0; bit of mayhem in that case.&#xA;The safe thing to do in this case would be to lock it always before access, but for things that are going to be used frequently (hot spots) this can be a problem. Reader/Writer lock is much worse in terms or performance than the usual lock statement, and ReaderWriterLockSlim is for .NET 3.5 only.&#xA;An interesting dilemma, and I apologize for misleading you earlier.&#xA;GetDescriptionsHelper.Delegate getDescription;&#xA;if (GetDescriptionsHelper.Cache.TryGetValue(entityType, out getDescription) == false)&#xA;{&#xA;&#x9;MethodInfo getDescriptionInternalGeneric = getDescriptionInternalMethodInfo.MakeGenericMethod(entityType);&#xA;&#x9;getDescription = (GetDescriptionsHelper.Delegate)Delegate.CreateDelegate(&#xA;&#x9;&#x9;typeof(GetDescriptionsHelper.Delegate),&#xA;&#x9;&#x9;getDescriptionInternalGeneric);&#xA;&#xA;&#x9;GetDescriptionsHelper.Cache[entityType] = getDescription;&#xA;}&#xA;can you spot the main difference? We are not using locks, and we are using the indexer instead of the Add() method.&#xA;Empirical evidence suggest that using the indexer in a multi threaded environment is safe, in that it doesn&#x27;t corrupt the dictionary and one of the values will remain there.&#xA;This means that assuming that the cost of creating the value isn&#x27;t very high, it is just fine to have it created twice on those rare cases, the end result is after the initial flurry, we have the value cached, even if it was calculated more than once. In the long run, it doesn&#x27;t matter.</p>
        </article>
        <article id="article-7210">
            <a href="https://ayende.com/blog/3105/challenge-strongly-typing-weakly-typed-code" target="_blank">
                <h2 class="title mb-6" id="article-7210">Challenge</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 21, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">How would you make the following code work? public static class Security&#xA;{&#xA;&#x9;public static string GetDescription(Type entityType, Guid securityKey)&#xA;&#x9;{&#xA;&#x9;&#x9;Guard.Against&lt;ArgumentException&gt;(securityKey == Guid.Empty, &quot;Security Key cannot be empty&quot;);&#xA;&#x9;&#x9;IEntityInformationExtractor&lt;TEntity&gt; extractor = IoC.Resolve&lt;IEntityInformationExtractor&lt;TEntity&gt;&gt;();&#xA;&#x9;&#x9;return extractor.GetDescription(securityKey);&#xA;&#x9;}&#xA;}&#xA;You can&#x27;t change the entity type parameter to a generic parameter, because you only know about it at runtime. This is usually called with:&#xA;Security.GetDescription(Type.GetType(permission.EntityTypeName), permission.EntitySecurityKey.Value);</p>
        </article>
        <div class="button flex justify-between">
            <a href="720.html"><span class="back arrow"></span></a>

            <a href="722.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	"> Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
