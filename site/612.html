
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 612 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-6111">
            <a href="https://ayende.com/blog/3968/using-active-record-to-write-less-code" target="_blank">
                <h2 class="title mb-6" id="article-6111">Using Active Record to write less code</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 22, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The presentations from Oredev are now available, and among them is my talk about Active Record.  You can watch it here, the blurb is:     What would you say if I told you that you can stop writing data access code in .Net? Aren&#x27;t you tired of writing the same thing over and over again, opening connection, querying the database, figuring out what to return, getting back untype data that you need to start putting on the form? Do you really see some value in writing yet another UPDATE statement?The Active Record framework allows you to fully utilize the power of the database, but without the back breaking work that it used to take. Active Record uses .Net objects to relieve you from the repeating task of persistence. Those objects are schema aware and can persist and load themselves without you needing to write a single line of SQL. Building business application using Active Record is a pleasure, the database stuff just happens, and you are free to implement the business functionality.   To be frank, I consider this to be one of the best presentations that I gave. Everything just ticked.</p>
        </article>
        <article id="article-6112">
            <a href="https://ayende.com/blog/3967/nhibernate-mapping-many-to-any" target="_blank">
                <h2 class="title mb-6" id="article-6112">NHibernate Mapping - &lt;many-to-any/&gt;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 22, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">&lt;many-to-any/&gt; is the logical extension of the &lt;any/&gt; feature that NHibernate has. At the time of this writing, if you do a Google search on &lt;many-to-any/&gt;, the first result is this post. It was written by me, in 2005, and contains absolutely zero useful information. Time to fix that.  Following up on the &lt;any/&gt; post, let us say that we need to map not a single heterogeneous association, but a multiple heterogeneous one, such as this:     In the database, it would appear as:     How can we map such a thing?  Well, that turn out to be pretty easy to do:     &lt;set name=&quot;Payments&quot; table=&quot;OrderPayments&quot; cascade=&quot;all&quot;&gt;&#xA;&#x9;&lt;key column=&quot;OrderId&quot;/&gt;&#xA;&#x9;&lt;many-to-any id-type=&quot;System.Int64&quot;&#xA;&#x9;&#x9;&#x9;meta-type=&quot;System.String&quot;&gt;&#xA;&#x9;&#x9;&lt;meta-value value=&quot;CreditCard&quot;&#xA;&#x9;&#x9;&#x9;class=&quot;CreditCardPayment&quot;/&gt;&#xA;&#x9;&#x9;&lt;meta-value value=&quot;Wire&quot;&#xA;&#x9;&#x9;&#x9;class=&quot;WirePayment&quot;/&gt;&#xA;&#x9;&#x9;&lt;column name=&quot;PaymentType&quot; &#xA;&#x9;&#x9;&#x9;not-null=&quot;true&quot;/&gt;&#xA;&#x9;&#x9;&lt;column name=&quot;PaymentId&quot;&#xA;&#x9;&#x9;&#x9;not-null=&quot;true&quot;/&gt;&#xA;&#x9;&lt;/many-to-any&gt;&#xA;&lt;/set&gt;&#xA;&#xA;&#xA;Now, let us look at how we use this when we insert values:&#xA;&#xA;&#xA;  using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var order = new Order&#xA;&#x9;{&#xA;&#x9;&#x9;Payments = new HashSet&lt;IPayment&gt;&#xA;        {&#xA;        &#x9;new CreditCardPayment&#xA;        &#x9;{&#xA;        &#x9;&#x9;Amount = 6,&#xA;                CardNumber = &quot;35434&quot;,&#xA;                IsSuccessful = true&#xA;        &#x9;},&#xA;            new WirePayment&#xA;            {&#xA;            &#x9;Amount = 3,&#xA;                BankAccountNumber = &quot;25325&quot;,&#xA;                IsSuccessful = false&#xA;            }&#xA;        }&#xA;&#x9;};&#xA;&#x9;session.Save(order);&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;This will produce some very interesting SQL:&#xA;&#xA; &#xA;&#xA; &#xA;&#xA; &#xA;&#xA; &#xA;&#xA; &#xA;&#xA;I think that the SQL make it pretty clear what is going on here, so let us move to a more fascinating topic, what does NHibernate do when we read them?&#xA;&#xA;Here is the code:&#xA;&#xA;&#xA;  using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var order = session.Get&lt;Order&gt;(1L);&#xA;&#x9;foreach (var payment in order.Payments)&#xA;&#x9;{&#xA;&#x9;&#x9;Console.WriteLine(payment.Amount);&#xA;&#x9;}&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;And the SQL:&#xA;&#xA; &#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA; &#xA;&#xA; &#xA;&#xA; &#xA;&#xA;As you can see, this is about as efficient as you can get. We load the order, we check what tables we need to check, and the we select from each of the tables that we found to get the actual values in the association.&#xA;&#xA;True heterogeneous association, not used very often, but when you need it, you really love it when you do.</p>
        </article>
        <article id="article-6113">
            <a href="https://ayende.com/blog/3966/nhibernate-mapping-any" target="_blank">
                <h2 class="title mb-6" id="article-6113">NHibernate Mapping - &lt;any/&gt;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 21, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Sometimes, well known associations just don&#x2019;t cut it. We sometimes need to be able to go not to a single table, but to a collection of table. For example, let us say that an order can be paid using a credit card or a wire transfer. The data about those are stored in different tables, and even in the object model, there is no inheritance association them.  From the database perspective, it looks like this:     As you can see, based on the payment type, we need to get the data from a different table. That is somewhat of a problem for the standard NHibernate mapping, which is why we have &lt;any/&gt; around.  Just to close the circle before we get down into the mapping, from the object model perspective, it looks like this:     In other words, this is a non polymorphic association, because there is no mapped base class for the association. In fact, we could have used System.Object instead, but even for a sample, I don&#x2019;t like it.  The mapping that we use are:     &lt;class name=&quot;Order&quot;&#xA;&#x9;&#x9;&#x9; table=&quot;Orders&quot;&gt;&#xA;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;native&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#xA;&#x9;&lt;any name=&quot;Payment&quot; id-type=&quot;System.Int64&quot; meta-type=&quot;System.String&quot; cascade=&quot;all&quot;&gt;&#xA;&#x9;&#x9;&lt;meta-value value=&quot;CreditCard&quot; class=&quot;CreditCardPayment&quot;/&gt;&#xA;&#x9;&#x9;&lt;meta-value value=&quot;Wire&quot; class=&quot;WirePayment&quot;/&gt;&#xA;&#x9;&#x9;&lt;column name=&quot;PaymentType&quot;/&gt;&#xA;&#x9;&#x9;&lt;column name=&quot;PaymentId&quot;/&gt;&#xA;&#x9;&lt;/any&gt;&#xA;&#xA;&lt;/class&gt;&#xA;&#xA;&lt;class name=&quot;CreditCardPayment&quot;&#xA;&#x9;&#x9;&#x9; table=&quot;CreditCardPayments&quot;&gt;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;native&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;property name=&quot;IsSuccessful&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;Amount&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;CardNumber&quot;/&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&lt;class name=&quot;WirePayment&quot;&#xA;&#x9;&#x9;&#x9; table=&quot;WirePayments&quot;&gt;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;native&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;property name=&quot;IsSuccessful&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;Amount&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;BankAccountNumber&quot;/&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&#xA;Pay special attention to the &lt;any/&gt; element. Any &lt;meta-value/&gt; declaration is setting up the association between the type as specified in the PaymentType column and the actual class name that it maps to. The only limitation is that all the mapped class must have the same data type for the primary key column.&#xA;&#xA;Let us look at what this will give us:&#xA;&#xA;&#xA;  using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var order = new Order&#xA;&#x9;{&#xA;&#x9;&#x9;Payment = new CreditCardPayment&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;Amount = 5,&#xA;&#x9;&#x9;&#x9;CardNumber = &quot;1234&quot;,&#xA;&#x9;&#x9;&#x9;IsSuccessful = true&#xA;&#x9;&#x9;}&#xA;&#x9;};&#xA;&#x9;session.Save(order);&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;Which produces:&#xA;&#xA; &#xA;&#xA; &#xA;&#xA;And for selecting, it works just the way we would expect it to:&#xA;&#xA;&#xA;  using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var person = session.Get&lt;Order&gt;(1L).Payment;&#xA;&#x9;Console.WriteLine(person.Amount);&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;The generated SQL is:&#xA;&#xA; &#xA;&#xA; &#xA;&#xA;An interesting limitation is that you cannot do an eager load on &lt;any/&gt;, considering the flexibility of the feature, I am most certainly willing to accept that limitation.</p>
        </article>
        <article id="article-6114">
            <a href="https://ayende.com/blog/3965/test-refacotring" target="_blank">
                <h2 class="title mb-6" id="article-6114">Test refacotring</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 20, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just posted about a horribly complicated test, I thought I might as well share the results of its refactoring:     [TestFixture]&#xA;public class IndexedEmbeddedAndCollections : SearchTestCase&#xA;{&#xA;&#x9;private Author a;&#xA;&#x9;private Author a2;&#xA;&#x9;private Author a3;&#xA;&#x9;private Author a4;&#xA;&#x9;private Order o;&#xA;&#x9;private Order o2;&#xA;&#x9;private Product p1;&#xA;&#x9;private Product p2;&#xA;&#x9;private ISession s;&#xA;&#x9;private ITransaction tx;&#xA;&#xA;&#x9;protected override IList Mappings&#xA;&#x9;{&#xA;&#x9;&#x9;get&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;return new string[]&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&quot;Embedded.Tower.hbm.xml&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;&quot;Embedded.Address.hbm.xml&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;&quot;Embedded.Product.hbm.xml&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;&quot;Embedded.Order.hbm.xml&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;&quot;Embedded.Author.hbm.xml&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;&quot;Embedded.Country.hbm.xml&quot;&#xA;&#x9;&#x9;&#x9;};&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;&#xA;&#x9;protected override void OnSetUp()&#xA;&#x9;{&#xA;&#x9;&#x9;base.OnSetUp();&#xA;&#xA;&#x9;&#x9;a = new Author();&#xA;&#x9;&#x9;a.Name = &quot;Voltaire&quot;;&#xA;&#x9;&#x9;a2 = new Author();&#xA;&#x9;&#x9;a2.Name = &quot;Victor Hugo&quot;;&#xA;&#x9;&#x9;a3 = new Author();&#xA;&#x9;&#x9;a3.Name = &quot;Moliere&quot;;&#xA;&#x9;&#x9;a4 = new Author();&#xA;&#x9;&#x9;a4.Name = &quot;Proust&quot;;&#xA;&#xA;&#x9;&#x9;o = new Order();&#xA;&#x9;&#x9;o.OrderNumber = &quot;ACVBNM&quot;;&#xA;&#xA;&#x9;&#x9;o2 = new Order();&#xA;&#x9;&#x9;o2.OrderNumber = &quot;ZERTYD&quot;;&#xA;&#xA;&#x9;&#x9;p1 = new Product();&#xA;&#x9;&#x9;p1.Name = &quot;Candide&quot;;&#xA;&#x9;&#x9;p1.Authors.Add(a);&#xA;&#x9;&#x9;p1.Authors.Add(a2); //be creative&#xA;&#xA;&#x9;&#x9;p2 = new Product();&#xA;&#x9;&#x9;p2.Name = &quot;Le malade imaginaire&quot;;&#xA;&#x9;&#x9;p2.Authors.Add(a3);&#xA;&#x9;&#x9;p2.Orders.Add(&quot;Emmanuel&quot;, o);&#xA;&#x9;&#x9;p2.Orders.Add(&quot;Gavin&quot;, o2);&#xA;&#xA;&#xA;&#x9;&#x9;s = OpenSession();&#xA;&#x9;&#x9;tx = s.BeginTransaction();&#xA;&#x9;&#x9;s.Persist(a);&#xA;&#x9;&#x9;s.Persist(a2);&#xA;&#x9;&#x9;s.Persist(a3);&#xA;&#x9;&#x9;s.Persist(a4);&#xA;&#x9;&#x9;s.Persist(o);&#xA;&#x9;&#x9;s.Persist(o2);&#xA;&#x9;&#x9;s.Persist(p1);&#xA;&#x9;&#x9;s.Persist(p2);&#xA;&#x9;&#x9;tx.Commit();&#xA;&#xA;&#x9;&#x9;tx = s.BeginTransaction();&#xA;&#xA;&#x9;&#x9;s.Clear();&#xA;&#x9;}&#xA;&#xA;&#x9;protected override void OnTearDown()&#xA;&#x9;{&#xA;&#x9;&#x9;// Tidy up&#xA;&#x9;&#x9;s.Delete(&quot;from System.Object&quot;);&#xA;&#xA;&#x9;&#x9;tx.Commit();&#xA;&#xA;&#x9;&#x9;s.Close();&#xA;&#xA;&#x9;&#x9;base.OnTearDown();&#xA;&#x9;}&#xA;&#xA;&#x9;[Test]&#xA;&#x9;public void CanLookupEntityByValueOfEmbeddedSetValues()&#xA;&#x9;{&#xA;&#x9;&#x9;IFullTextSession session = Search.CreateFullTextSession(s);&#xA;&#xA;&#x9;&#x9;QueryParser parser = new MultiFieldQueryParser(new string[] { &quot;name&quot;, &quot;authors.name&quot; }, new StandardAnalyzer());&#xA;&#xA;&#x9;&#x9;Lucene.Net.Search.Query query = parser.Parse(&quot;Hugo&quot;);&#xA;&#x9;&#x9;IList result = session.CreateFullTextQuery(query).List();&#xA;&#x9;&#x9;Assert.AreEqual(1, result.Count, &quot;collection of embedded (set) ignored&quot;);&#xA;&#x9;}&#xA;&#xA;&#x9;[Test]&#xA;&#x9;public void CanLookupEntityByValueOfEmbeddedDictionaryValue()&#xA;&#x9;{&#xA;&#x9;&#x9;IFullTextSession session = Search.CreateFullTextSession(s);&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;//PhraseQuery&#xA;&#x9;&#x9;TermQuery  query = new TermQuery(new Term(&quot;orders.orderNumber&quot;, &quot;ZERTYD&quot;));&#xA;&#x9;&#x9;IList result = session.CreateFullTextQuery(query).List();&#xA;&#x9;&#x9;Assert.AreEqual(1, result.Count, &quot;collection of untokenized ignored&quot;);&#xA;&#x9;&#x9;query = new TermQuery(new Term(&quot;orders.orderNumber&quot;, &quot;ACVBNM&quot;));&#xA;&#x9;&#x9;result = session.CreateFullTextQuery(query).List();&#xA;&#x9;&#x9;Assert.AreEqual(1, result.Count, &quot;collection of untokenized ignored&quot;);&#xA;&#x9;}&#xA;&#xA;&#x9;[Test]&#xA;&#x9;[Ignore]&#xA;&#x9;public void CanLookupEntityByUpdatedValueInSet()&#xA;&#x9;{&#xA;&#x9;&#x9;Product p = s.Get&lt;Product&gt;(p1.Id);&#xA;&#x9;&#x9;p.Authors.Add(s.Get&lt;Author&gt;(a4.Id));&#xA;&#x9;&#x9;tx.Commit();&#xA;&#xA;&#x9;&#x9;QueryParser parser = new MultiFieldQueryParser(new string[] { &quot;name&quot;, &quot;authors.name&quot; }, new StandardAnalyzer());&#xA;&#x9;&#x9;IFullTextSession session = Search.CreateFullTextSession(s);&#xA;&#x9;&#x9;Query query = parser.Parse(&quot;Proust&quot;);&#xA;&#x9;&#x9;IList result = session.CreateFullTextQuery(query).List();&#xA;&#x9;&#x9;//HSEARCH-56&#xA;&#x9;&#x9;Assert.AreEqual(1, result.Count, &quot;update of collection of embedded ignored&quot;);&#xA;&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;It is almost the same as before, the changed are mainly structural, but it is so much easier to read, understand and debug.</p>
        </article>
        <article id="article-6115">
            <a href="https://ayende.com/blog/3964/a-horrible-horrible-horrible-test" target="_blank">
                <h2 class="title mb-6" id="article-6115">A horrible, HORRIBLE, horrible test</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 20, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I think, without question, that this is one of the most horrible nasty tests that I have seen. It has been ported as is from the java code, and you can literally feel the nastiness in reading it:     [Test]&#xA;public void IndexedEmbeddedAndCollections()&#xA;{&#xA;&#x9;Author a = new Author();&#xA;&#x9;a.Name = &quot;Voltaire&quot;;&#xA;&#x9;Author a2 = new Author();&#xA;&#x9;a2.Name = &quot;Victor Hugo&quot;;&#xA;&#x9;Author a3 = new Author();&#xA;&#x9;a3.Name = &quot;Moliere&quot;;&#xA;&#x9;Author a4 = new Author();&#xA;&#x9;a4.Name = &quot;Proust&quot;;&#xA;&#xA;&#x9;Order o = new Order();&#xA;&#x9;o.OrderNumber = &quot;ACVBNM&quot;;&#xA;&#xA;&#x9;Order o2 = new Order();&#xA;&#x9;o2.OrderNumber = &quot;ZERTYD&quot;;&#xA;&#xA;&#x9;Product p1 = new Product();&#xA;&#x9;p1.Name = &quot;Candide&quot;;&#xA;&#x9;p1.Authors.Add(a);&#xA;&#x9;p1.Authors.Add(a2); //be creative&#xA;&#xA;&#x9;Product p2 = new Product();&#xA;&#x9;p2.Name = &quot;Le malade imaginaire&quot;;&#xA;&#x9;p2.Authors.Add(a3);&#xA;&#x9;p2.Orders.Add(&quot;Emmanuel&quot;, o);&#xA;&#x9;p2.Orders.Add(&quot;Gavin&quot;, o2);&#xA;&#xA;&#xA;&#x9;ISession s = OpenSession();&#xA;&#x9;ITransaction tx = s.BeginTransaction();&#xA;&#x9;s.Persist(a);&#xA;&#x9;s.Persist(a2);&#xA;&#x9;s.Persist(a3);&#xA;&#x9;s.Persist(a4);&#xA;&#x9;s.Persist(o);&#xA;&#x9;s.Persist(o2);&#xA;&#x9;s.Persist(p1);&#xA;&#x9;s.Persist(p2);&#xA;&#x9;tx.Commit();&#xA;&#xA;&#x9;s.Clear();&#xA;&#xA;&#x9;IFullTextSession session = Search.CreateFullTextSession( s );&#xA;&#x9;tx = session.BeginTransaction();&#xA;&#xA;&#x9;QueryParser parser = new MultiFieldQueryParser( new string[] { &quot;name&quot;, &quot;authors.name&quot; }, new StandardAnalyzer() );&#xA;&#xA;&#x9;Lucene.Net.Search.Query query = parser.Parse( &quot;Hugo&quot; );&#xA;&#x9;IList result = session.CreateFullTextQuery( query ).List();&#xA;&#x9;Assert.AreEqual( 1, result.Count, &quot;collection of embedded ignored&quot; );&#xA;&#xA;&#x9;//update the collection&#xA;&#x9;Product p = (Product) result[0];&#xA;&#x9;p.Authors.Add( a4 );&#xA;&#xA;&#x9;//PhraseQuery&#xA;&#x9;query = new TermQuery( new Term( &quot;orders.orderNumber&quot;, &quot;ZERTYD&quot; ) );&#xA;&#x9;result = session.CreateFullTextQuery( query).List();&#xA;&#x9;Assert.AreEqual( 1, result.Count, &quot;collection of untokenized ignored&quot; );&#xA;&#x9;query = new TermQuery( new Term( &quot;orders.orderNumber&quot;, &quot;ACVBNM&quot; ) );&#xA;&#x9;result = session.CreateFullTextQuery( query).List();&#xA;&#x9;Assert.AreEqual( 1, result.Count, &quot;collection of untokenized ignored&quot; );&#xA;&#xA;&#x9;tx.Commit();&#xA;&#xA;&#x9;s.Clear();&#xA;&#xA;&#x9;tx = s.BeginTransaction();&#xA;&#x9;session = Search.CreateFullTextSession( s );&#xA;&#x9;query = parser.Parse( &quot;Proust&quot; );&#xA;&#x9;result = session.CreateFullTextQuery( query ).List();&#xA;&#x9;//HSEARCH-56&#xA;&#x9;Assert.AreEqual( 1, result.Count, &quot;update of collection of embedded ignored&quot; );&#xA;&#xA;&#x9;// Tidy up&#xA;&#x9;s.Delete(a);&#xA;&#x9;s.Delete(a2);&#xA;&#x9;s.Delete(a3);&#xA;&#x9;s.Delete(a4);&#xA;&#x9;s.Delete(o);&#xA;&#x9;s.Delete(o2);&#xA;&#x9;s.Delete(p1);&#xA;&#x9;s.Delete(p2);&#xA;&#x9;tx.Commit();&#xA;&#xA;&#x9;s.Close();&#xA;}&#xA;&#xA;&#xA;Point to anyone who want to start a list of how many good test metrics this test violates.&#xA;&#xA;Oh, and right now, this test fails.</p>
        </article>
        <article id="article-6116">
            <a href="https://ayende.com/blog/3963/buying-the-pot-as-a-way-of-winning-the-database-wars" target="_blank">
                <h2 class="title mb-6" id="article-6116">Buying the pot as a way of winning the database wars?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 20, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The news are just out, Oracle is buying Sun.  This is especially interesting since Oracle has previously bought InnoDB (a key component for MySQL in the enterprise) and Sun has bought MySQL. This means that, off the top of my head, Oracle is now the owner of the following database products:     Oracle DB    BerkleyDB    MySQL &amp; InnoDB   I am pretty sure that they have others, but even so, that is quite a respectable list, I should think.  Of course, with Sun, Oracle is also getting Java&#x2026;</p>
        </article>
        <article id="article-6117">
            <a href="https://ayende.com/blog/3962/where-is-the-roi" target="_blank">
                <h2 class="title mb-6" id="article-6117">Where is the ROI?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 20, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Justin has a post called: Keep your IQueryable in check, in which he basically says that while he finds value in the Query Object pattern that I recently talked about, he is concerned by the fact that I am returning an IQueryable (or ICriteria or IQuery) from the query object. The problem is that the UI layer can then modify the query in potentially undesirable ways. The example that he gave is:     latePayingCustomQuery  &#xA;  .Where(c =&gt; c.LastName.StartsWith(&quot;E&quot;))  &#xA;  .Skip((page - 1) * itemCount)  &#xA;  .Take(10);  &#xA;&#xA;&#xA;Which perform a query on an unindex string column, which is slow.&#xA;&#xA;He suggests limiting what the user can do by providing a IPagable &amp;&amp; ISortable that would limit the options of the UI layer to abuse it.&#xA;&#xA;My response to that is: And&#x2026;?&#xA;&#xA;I am not in favor of doing things to protect developers, but there is also another side to that. &#xA;&#xA;What is the worst thing that can possibly happen? That part of the application would be slow. We will find it during testing, or (heaven forbid), on production. &#xA;&#xA;And&#x2026;?&#xA;&#xA;How is this in any way different than anything else that we are doing? Presumably the developer who wrote the code didn&#x2019;t wrote it just because he felt like it, there was a business reason behind it. At that point, we treat this issue as a standard perf issue, and fix it.&#xA;&#xA;The cost of doing that in the rare cases where it will happen vs. the cost of creating the limited abstraction, forcing developers to deal with that, etc. More than that, I can assure you that you will need to break out of the straightjacket at some point, why put it on in the first place?&#xA;&#xA;This is a question that I routinely ask my clients. Why do you want that? &#x201C;To stop developers from&#x2026;&#x201D;&#xA;&#xA;To which I reply: &#x201C;What is the cost of doing it this way? What is the cost of a mistake? What is the cost of fixing that mistake? What is the difference between that and just another bug?&#x201D; &#xA;&#xA;There is a reason that I choose the ALT.Net logo to be running with scissors. Power tools are here to be used. Yes, there are things that you want to hide, but those are by far the exception, not the norm.</p>
        </article>
        <article id="article-6118">
            <a href="https://ayende.com/blog/3961/nhibernate-mapping-join" target="_blank">
                <h2 class="title mb-6" id="article-6118">NHibernate Mapping - &lt;join/&gt;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 20, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We have previously explored the one-to-one mapping, which let you create 1:1 association in the database, but there is actually another way to map several tables to an object model. We aren&#x2019;t constrained by the database model, and we can merge several tables into a single entity.   We do that using the &lt;join/&gt; element:     &lt;join&#xA;        table=&quot;tablename&quot;                        (1)&#xA;        schema=&quot;owner&quot;                           (2)&#xA;        catalog=&quot;catalog&quot;                        (3)&#xA;        fetch=&quot;join|select&quot;                      (4)&#xA;        inverse=&quot;true|false&quot;                     (5)&#xA;        optional=&quot;true|false&quot;&gt;                   (6)&#xA;&#xA;        &lt;key ... /&gt;&#xA;&#xA;        &lt;property ... /&gt;&#xA;        ...&#xA;&lt;/join&gt;&#xA;&#xA;&#xA;Let us explore this a bit, assuming the we have the following database model:&quot;&#xA;&#xA; &#xA;&#xA;And what we want is to map this to the following object model:&#xA;&#xA; &#xA;&#xA;We can do this will the following mapping:&#xA;&#xA;&#xA;  &lt;class name=&quot;Person&quot;&#xA;&#x9; table=&quot;People&quot;&gt;&#xA;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;identity&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;property name=&quot;Name&quot; /&gt;&#xA;&#xA;&#x9;&lt;join table=&quot;Addresses&quot;&gt;&#xA;&#x9;&#x9;&lt;key column=&quot;PersonId&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;Line1&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;Line2&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;City&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;Country&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;ZipCode&quot;/&gt;&#xA;&#x9;&lt;/join&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&#xA;And getting a Person will now result in the following SQL:&#xA;&#xA; &#xA;&#xA;NHibernate will now take care of mapping everything to its place, and making sure that everything works just right.&#xA;&#xA;By now you should be able to figure out what fetch means, and inverse should also be familiar. Optional is interesting, what is basically says is that we should always use an outer join to get the values from the Addresses table and if all the mapped properties are null, it wouldn&#x2019;t create a new row in the Addresses table.&#xA;&#xA;On the face of it, it looks like a nice way to merge tables together, but that isn&#x2019;t actually the primary reason for this feature. You can use it for that, for sure, but that is mostly useful in legacy databases. In most cases, your object model should be more granular than the database model, not the other way around.&#xA;&#xA;The really interesting part about this feature is that it allows us to mix &amp; match inheritance strategies. It let us create a table per hierarchy that store all the extra fields on another table, for example. That significantly reduce the disadvantage of using a table per hierarchy or table per subclass, since we can tell very easily what is the type of the class that we are using, and act appropriately.</p>
        </article>
        <article id="article-6119">
            <a href="https://ardalis.com/space-coast-asp-net-mvc-and-solid-principles-talk/" target="_blank">
                <h2 class="title mb-6" id="article-6119">Space Coast ASP.NET MVC and SOLID Principles Talk</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 19, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Last week I visited the Space Coast .NET user group in Florida (courtesy of INETA) to talk about ASP.NET MVC and SOLID software development&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-6120">
            <a href="https://ayende.com/blog/3960/nhibernate-mapping-one-to-one" target="_blank">
                <h2 class="title mb-6" id="article-6120">NHibernate Mapping - &lt;one-to-one/&gt;</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 19, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In the database world, we have three kind of associations: 1:m, m:1, m:n.  However, occasionally we want to have a one to one relationship. We could simulate it easily enough on the database side using two many to one relations, but that would require us to add the association column to both tables, and things gets&#x2026; tricky when it comes the time to insert or update to the database, because of the cycle that this creates.  NHibernate solves the problem by introducing a one-to-one mapping association, which allow you to define the two relationships based on a single column in the database, which controls the two way association.     &lt;one-to-one&#xA;        name=&quot;PropertyName&quot;                                (1)&#xA;        class=&quot;ClassName&quot;                                  (2)&#xA;        cascade=&quot;all|none|save-update|delete&quot;              (3)&#xA;        constrained=&quot;true|false&quot;                           (4)&#xA;        fetch=&quot;join|select&quot;                                (5)&#xA;        property-ref=&quot;PropertyNameFromAssociatedClass&quot;     (6)&#xA;        access=&quot;field|property|nosetter|ClassName&quot;         (7)&#xA;/&gt;&#xA;&#xA;&#xA;1, 2, 3, 6, 7 were all discussed elsewhere, so I&#x2019;ll skip them and move directly to showing how this can be used.&#xA;&#xA;We have the follow object model:&#xA;&#xA; &#xA;&#xA;And the database model:&#xA;&#xA; &#xA;&#xA;&#xA;&#xA;Note that while in the object model we have a bidirectional mapping, in the database we have only a single reference on the employees table. In the relational model, all associations are naturally bidirectional, but that is not true on the object model. In order to bridge this inconsistency, we map them as:&#xA;&#xA;&#xA;  &lt;class name=&quot;Employee&quot;&#xA;&#x9;&#x9;table=&quot;Employees&quot;&gt;&#xA;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;native&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&#xA;&#x9;&lt;property name=&quot;Role&quot;/&gt;&#xA;&#xA;&#x9;&lt;many-to-one name=&quot;Person&quot;&#xA;&#x9;&#x9;unique=&quot;true&quot;&#xA;&#x9;&#x9;column=&quot;Person&quot;/&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&lt;class name=&quot;Person&quot;&#xA;&#x9;&#x9;table=&quot;People&quot;&gt;&#xA;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;native&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;property name=&quot;Name&quot; /&gt;&#xA;&#x9;&lt;one-to-one name=&quot;Employee&quot;&#xA;&#x9;&#x9;&#x9;class=&quot;Employee&quot;/&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&#xA;We have a unique many-to-one association from Employee to Person, but a one to one from Person to Employee. This will reuse the many-to-one association defined in the Employee mapping.&#xA;&#xA;Let see how this works for saving and loading the data:&#xA;&#xA;&#xA;  using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var person = new Person&#xA;&#x9;{&#xA;&#x9;&#x9;Name = &quot;test&quot;,&#xA;&#x9;};&#xA;&#x9;var employee = new Employee&#xA;&#x9;{&#xA;&#x9;&#x9;Person = person,&#xA;&#x9;&#x9;Role = &quot;Manager&quot;&#xA;&#x9;};&#xA;&#x9;person.Employee = employee;        session.Save(person);        session.Save(employee);&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;// person to employee&#xA;using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var employee = session.Get&lt;Person&gt;(1).Employee;&#xA;&#x9;Console.WriteLine(employee.Role);&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;// employee to person&#xA;using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var person = session.Get&lt;Employee&gt;(1).Person;&#xA;&#x9;Console.WriteLine(person.Name);&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;And the SQL that would be generated would be:&#xA;&#xA; &#xA;&#xA;This is quite interesting. We can see that we insert the entities as we expect, but when we pull a person out, we do a join to the employee, to get the one-to-one association. For that matter, even in the second scenario, we do a join to get the associated employee.&#xA;&#xA;The reason that we have to do it is quite interesting as well. NHibernate makes some guarantees about the way the object model and the database model map to one another. And one of those guarantees is that if there is no association in the database, we will get back a null in the object model.&#xA;&#xA;Generally, this works very well, since we can tell whatever an association exists or not using the value in the table (for many-to-one associations). But for one-to-one association, if we want to keep this guarantee, we have to check the associated table to verify if we need to have a null or a proxy there. That is somewhat annoying, but we can get around that by specifying constrained=&#x201D;true&#x201D;. This tell NHibernate that in this case, whenever there is a Person, there must also be a matching Employee value. We can specify it like this:&#xA;&#xA;&#xA;  &lt;one-to-one name=&quot;Employee&quot; &#xA;&#x9;constrained=&quot;true&quot;&#xA;&#x9;foreign-key=&quot;none&quot;&#xA;&#x9;class=&quot;Employee&quot;/&gt;&#xA;&#xA;&#xA;Something else to note is that we must specify this with foreign-key=&#x201D;none&#x201D;, because otherwise NHibernate&#x2019;s Schema Export feature would create two foreign keys for us, which would create a circular reference that wouldn&#x2019;t allow us to insert anything into the database.&#xA;&#xA;When setting this, we can see that there is a dramatic change in NHibernate&#x2019;s behavior:&#xA;&#xA; &#xA;&#xA;Instead of generating joins, NHibernate now uses standard selects to get the data. And we don&#x2019;t have to pre-populate the information on loading the entity, we can delay that as we usually do with NHibernate.&#xA;&#xA;And the last thing that we will explore for &lt;one-to-one/&gt; is the fetch attribute. It defaults to select, so we have already seen how that works, but when we set fetch=&#x201D;join&#x201D;, we get an interesting flashback. Well, almost:&#xA;&#xA; &#xA;&#xA;Again, we use a join to get the value upfront, but since we are now using constrained=&#x201D;true&#x201D;, we can use an inner join instead of a left outer join, which is more efficient in most cases.</p>
        </article>
        <div class="button flex justify-between">
            <a href="611.html"><span class="back arrow"></span></a>

            <a href="613.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;🚀&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
