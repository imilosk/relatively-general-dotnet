
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Home â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<script>
    const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

    function getUserPref() {
        const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
        return storedTheme || (lightModePref.matches ? "light" : "dark");
    }

    function setTheme(newTheme) {
        if (newTheme !== "light" && newTheme !== "dark") {
            return console.warn(
                `Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
            );
        }

        const root = document.documentElement;

        // root already set to newTheme, exit early
        if (newTheme === root.getAttribute("data-theme")) {
            return;
        }

        root.setAttribute("data-theme", newTheme);

        const colorThemeMetaTag = document.querySelector("meta[name='theme-color']");
        const bgColour = getComputedStyle(document.body).getPropertyValue("--theme-bg");
        colorThemeMetaTag.setAttribute("content", `hsl(${bgColour})`);
        if (typeof localStorage !== "undefined") {
            localStorage.setItem("theme", newTheme);
        }
    }

    // initial setup
    setTheme(getUserPref());

    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("theme-toggle").addEventListener("click", () => {
            const theme = localStorage.getItem("theme");

            if (theme === "dark") {
                setTheme("light");
            } else {
                setTheme("dark");
            }
        });

        document.getElementById("toggle-navigation-menu").addEventListener("click", (e) => {
            const button = e.target;
            const ariaExpanded = button.getAttribute("aria-expanded");
            const header = document.getElementById("main-header");

            if (ariaExpanded === "true") {
                button.setAttribute("aria-expanded", "false");
                header.classList.remove("menu-open");
            } else {
                button.setAttribute("aria-expanded", "true");
                header.classList.add("menu-open");
            }
        });
    });
</script>

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <theme-toggle class="ms-auto">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main">
    <section aria-label="Blog post list">
        <a href="https://ayende.com/blog/166564/ravendb-conf-videos-tailored-database-solutions-with-voron" target="_blank"><h1 class="title mb-6">RavenDB Conf Videos</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 29, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this talk, I&#x2019;m creating, live on stage, a database for handling time series data with the goal of handling 100 billion events per year.  And it actually worked!</p>
        <a href="https://ayende.com/blog/166563/ravendb-conf-videos-panel-discussion-the-good-ugly-of-working-with-ravendb" target="_blank"><h1 class="title mb-6">RavenDB Conf Videos</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 28, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this panel discussion, the speakers in RavenDB Conference talks with the attendees and share their own experience of using RavenDB in anger.</p>
        <a href="https://ayende.com/blog/166562/ravendb-conf-videos-diving-into-voron" target="_blank"><h1 class="title mb-6">RavenDB Conf Videos</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 25, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This low level talk is all about Voron, how it actually works, the design decisions that we had to do, the things that didn&#x2019;t work&#x2026;</p>
        <a href="https://ayende.com/blog/166561/ravendb-conf-videos-introduction-to-document-database-modeling-with-ravendb" target="_blank"><h1 class="title mb-6">RavenDB Conf Videos</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 24, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We recorded the recent RavenDB conference, and we are starting to make them available now. The first to show up is Mauro Servienti&#x2019;s intro talk to RavenDB. https://www.youtube.com/watch?v=0WEMNKk3HHU</p>
        <a href="https://ayende.com/blog/166530/corax-the-problem-of-space" target="_blank"><h1 class="title mb-6">Corax: The problem of space</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 23, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Corax is a research project that we have, to see how we can build a full text search library on top of Voron. Along the way, we take the chance to find out how Lucene does things, and what we can do better. Pretty much from the get go, Corax is likely to use more disk space than Lucene, probably significantly so. I would be happy if we could get a merely 50% increase over Lucene  The reason that this is the case is that Lucene goes to great length to save disk space. From storing all integers in variable length format, to prefix compression to implicitly referencing data in other files. For example, you can see that when you try reading term positions:  TermPositions are ordered by term (the term is implicit, from the .tis file). Positions entries are ordered by increasing document number (the document number is implicit from the .frq file). The downside of saving every little bit is that it is a lot more complex to read the data, requiring multiple caches and complex code path to actually get it properly. It make a lot of sense, when Lucene was created, disk space was at a premium. I won&#x2019;t go as far as to say that disk space doesn&#x2019;t matter, but given a trade off of using more disk space vs. using more memory / complexity, it is much easier to justify disk space usage today*. * The caveat here is that you need to be careful, because just accessing the disk can be very slow.  One of the major things that we wanted to deal with Corax is reducing index corruption issues, and seeing if we can simplify things into a transactional system. As a side effect of that, we don&#x2019;t need to have index segments, and we don&#x2019;t need to do merges to free disk space. The problem is that in order to handle this, we need to make track additional information that Lucene doesn&#x2019;t need to. Let us look at the actual data we keep. Here is a very simple index:  using (var fullTextIndex = new FullTextIndex(StorageEnvironmentOptions.CreateMemoryOnly(), new DefaultAnalyzer())){    using (var indexer = fullTextIndex.CreateIndexer())    {        indexer.NewIndexEntry();        indexer.AddField(&quot;Name&quot;, &quot;Oren Eini&quot;);        indexer.AddField(&quot;Email&quot;,&quot;Ayende@ayende.com&quot;);        indexer.NewIndexEntry();        indexer.AddField(&quot;Name&quot;, &quot;Arava Eini&quot;);        indexer.AddField(&quot;Email&quot;,&quot;Arava@houseof.dog&quot;);       indexer.Flush();    }}&#xA;For each field, we are going to create a multi tree. And for each unique term in the field we have a list of (Index Entry Id, term frequency, boost).&#xA;&#xA;@fld_Name &#xA;&#xA;arava&#xA;&#xA;{ 2, 1, 1.0 }&#xA0; (index id 2, freq 1, boost 1.0)&#xA;eini&#xA;&#xA;{ 1,1,1.0 }&#xA;{ 2,1,1.0 }&#xA;oren&#xA;&#xA;{ 1,1,1 }&#xA;@fld_Email&#xA;&#xA;arava@houseof.dog&#xA;&#xA;{ 2,1,1.0 }&#xA;ayende@ayende.com&#xA;&#xA;{ 1,1,1.0 }&#xA;This is pretty much the equivalent to the way Lucene store things. Possible space optimizations here include not storing default values (term frex or boost of 1), storing index entry ids as variable ints, etc.&#xA;The problem is that while this is actually enough for the way Lucene does things, it is not enough for the way Corax does things. Let us consider the case of deleting a document. How would you go about doing this using the information above?&#xA;Lucene does this by marking a document id as deleted, and will purge its details on the next segments merge. That works, but only because a segment merge actually read &amp; write all of the relevant segments data. Without a segments merge, deleting a document is actually something that would require us to scan all the data in the entire database. This is not really practical. Therefor, we need to store additional data so we can delete it later on. In this case, we have the Docs tree, which has keys for (index entry id, field id and term num). This looks like this:&#xA;&#xA;Docs&#xA;&#xA;[1,1,1]: oren&#xA;[1,1,2]: eini&#xA;[1,2,1]: ayende@ayende.com&#xA;[2,1,1]: arava&#xA;[2,1,2]: eini&#xA;[2,2,1]: arava@houseof.dog&#xA;Using this information, we can now remove all traces of a document when it is deleted. However, the problem here is that we need to also keep the terms per document in the index. That really blow up the index size, obviously. &#xA;The reason for this peculiar way of storing the document fields in this manner is that we also want to reuse this information for sorting. When Lucene needs to sort data, it has to read all of the data from the fields, then recreate the values for all relevant documents. Corax can just serve the data already there. &#xA;A pretty obvious step to save space would be to track the terms separately, and use an id in the Docs tree, not the full term. That leads to an interesting problem, because we are going to need to be able to go from term &#x2013;&gt; id and id &#x2013;&gt; term, which pretty much require storing them twice, unfortunately. &#xA;Final note, Corax is a research project.</p>
        <a href="https://ayende.com/blog/166529/success-from-opening-a-champagne-bottle-to-hiding-under-the-bed-with-said-bottle" target="_blank"><h1 class="title mb-6">Success: From Opening a Champagne Bottle To Hiding Under the Bed with Said Bottle</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 22, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">During the RavenDB courses* in the past few weeks, I was talking with one of the attendees and I came up with what I think is a great analogy.  * Yes, courses, in the past 4 weeks, I&#x2019;ve given the RavenDB course 3 times. That probably explains why I don&#x2019;t remember which course it was. What are your success metrics? From Opening a Champagne Bottle To Hiding Under the Bed with Said Bottle? The first success&#xA0; metric is when you have enough users (and, presumably, revenue) to cross the threshold to the Big Boys League. Let us call this the 25,000 users range.&#xA0; That is the moment when you throw a party, go to the store and grab a whole case of champagne bottles and make fancy speeches. Of course, the problem with success is that you can have too much of it. A system that does just fine (maybe creeks a little ) on a 25,000 users is going to behave pretty differently when you have 100,000 users. That is the moment when you find your engineers under the bed, with a half empty bottle of champagne and muttering things about Out Of Capacity errors and refusing to come out until we fire all the users.  In just about any system, you need to define the success points. Because Twitter was very luck that it managed to grow even though it had so many problems when its user base exploded. It is far more likely that users will figure out that your service is&#x2026; well, your engineers are drunk and hiding under the bed, so the service looks accordingly. And yes, you can try to talk to people about SLA, and metrics and capacities. But I have found that an image like that tend to give you a lot more focused answers. Even if a lot of the time the answer is &#x201C;I don&#x2019;t know&#x201D;. That is a place to start, because this make it a lot more acute than just &#x201C;how many req/sec do we need to support?&#x201D;.</p>
        <a href="https://ayende.com/blog/166497/the-nice-thing-about-working-in-a-large-team" target="_blank"><h1 class="title mb-6">The nice thing about working in a large team&#x2026;</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 21, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">There are a lot of stuff that are hard to do when you are working on a large team. But the really nice thing is the velocity in which you can move. I just started the morning with the following commands:  And I have another PR pending for a different branch that I&#x2019;m going to have to look at. Overall, I think that this is a pretty cool thing to have. We can push forward in many direction at once, and it can be pretty awesome to look at all the good thins that are coming our way.</p>
        <a href="https://ayende.com/blog/166465/optimizing-voron-and-the-cost-of-multi-trees" target="_blank"><h1 class="title mb-6">Optimizing Voron and the cost of Multi Trees</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 18, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the nice features that Voron got from LMDB is the notion of multi trees. If I recall correctly, LMDB calls them duplicate items, or something like that. Basically, it is the ability to store multiple values for a single key.&#xA;&#xA;&#x9;Update: The behavior described in this post has been in LMDB for the over 3 years. It is just something that&#xA0;Voron didn&#x27;t have. Please note that this post discuss the Voron&#x27;s limitation and its solution, not LMDB, which has had the solution for a long time.&#xA;&#xA;&#x9;Those items are actually stored as a nested tree, which effectively gives us a great way to handle duplicates. From an API standpoint, this looks like this:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;// store&#xA;tree.MultiAdd(tx, &quot;Eini&quot;, &quot;users/1&quot;);&#xA;tree.MultiAdd(tx, &quot;Eini&quot;, &quot;users/3&quot;);&#xA;tree.MultiAdd(tx, &quot;Eini&quot;, &quot;users/5&quot;);&#xA;&#x9;&#x9;&#xA;&#xA;&#xA;//read &#xA;using(var it = tree.MultiRead(tx, &quot;Eini&quot;))&#xA;{&#xA;    if(it.Seek(Slice.BeforeAllKeys) == false)&#xA;        yield break;&#xA;    do&#xA;    {&#xA;        yield return it.CurrentKey; // &quot;users/1&quot;, &quot;users/3&quot;, &quot;users/5&quot;&#xA;    }while(it.MoveNext());&#xA;}&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;Internally, we handle this in the following fashion:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;If a multi add operation is the very first such operation, we&#x2019;ll add it as a simple key/value pair in the tree.&#xA;&#x9;&#xA;&#x9;&#x9;If a multi add operation is the 2nd such operation, we&#x2019;ll create a new tree, and add both operations to the new tree. The original tree will have the key/nested tree reference stored.&#xA;&#xA;&#xA;&#x9;That lead to a very easy to use API, which is quite useful in many cases. However, it also have space usage implication. In particular, a tree means that we have to allocate at least one page to it. And that means that we have to allocate 4KB to hold any multi tree with more than a single value. Since there are actually a lot of scenarios where we would want to store a small number of small values, that can often lead to a lot of waste on our part. We use 4KB to store data that we could have stored in just 64 bytes, for example. That means that when we want to actually store things that might be duplicated, we actually need to consider the taken space consideration as well.&#xA;&#xA;&#x9;I think that this is a pretty bad idea, because it leads us to do things with composite keys under some scenarios. That is something that Voron should be able to just handle for me.&#xA0; So we changed that, in fact, what we did was changed the way we approach multi trees in general. Now, for every multi value, we can store up to 1KB of items in the same page as the key, before we devolve into a full blown multi tree.&#xA;&#xA;&#x9;The idea is that we can use the same Page mechanism we use elsewhere, and just have a nested page inside the parent page. As long as the nested page is small enough, we can just store it embedded. That result in some nice space saving. Since usually we have items in the following counts: zero, one, few, lots.&#xA;&#xA;&#x9;We need this to help with Corax, and in general, that would reduce the amount of space we need to use in many cases.</p>
        <a href="https://ayende.com/blog/166369/the-corax-experiment-api" target="_blank"><h1 class="title mb-6">The Corax Experiment: API</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 17, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I posted before about design practice for how I would approach building a search engine library. I decided to bite the bullet and actually try to do this. Using Voron, that turned out to be a really simple thing to do. Of course, this doesn&#x2019;t do a tenth of what Lucene does, but it actually does quite a lot. The code is available here, and I want to emphasize again, this is purely experimental / research project.&#xA;&#xA;&#x9;The entire thing comes to less than 500 lines of code. And it is pretty functional even at this stage.&#xA;&#xA;&#x9;Corax is composed of:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;Analysis&#xA;&#x9;&#xA;&#x9;&#x9;Indexing&#xA;&#x9;&#xA;&#x9;&#x9;Querying&#xA;&#xA;&#xA;&#x9;Analysis of the documents is handled via analyzers:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   1: public interface IAnalyzer&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   2: {&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   3:     ITokenSource CreateTokenSource(string field, ITokenSource existing);&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   4:     bool Process(string field, ITokenSource source);&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   5:&#xA0; &#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   6: }&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;An analyzer create a token source, which accept a TextReader and produces token. For each token, the Process method is called, and it is used to do things to the relevant token. For example, here is the default analyzer:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   1: public class DefaultAnalyzer : IAnalyzer&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   2: {&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   3:     readonly IFilter[] _filters =&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   4:     {&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   5:         new LowerCaseFilter(), &#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   6:         new RemovePossesiveSuffix(), &#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   7:         new StopWordsFilter(), &#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   8:     };&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   9:&#xA0; &#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  10:&#xA0; &#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  11:     public ITokenSource CreateTokenSource(string field, ITokenSource existing)&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  12:     {&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  13:         return existing ?? new StringTokenizer();&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  14:     }&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  15:&#xA0; &#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  16:     public bool Process(string field, ITokenSource source)&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  17:     {&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  18:         for (int i = 0; i &lt; _filters.Length; i&#x2B;&#x2B;)&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  19:         {&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  20:             if (_filters[i].ProcessTerm(source) == false)&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  21:                 return false;&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  22:         }&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  23:         return true;&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  24:     }&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  25: }&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;The idea here is to match, fairly closely, what Lucene is doing, but hopefully with clearer code. This analyzer will text a stream of text, break it up to discrete tokens, lower case them, remove the possessive &#x2018;s suffix and clear stop words. Note that each of the filters are actually modifying the token in place.&#xA0; And the tokenizer is pretty simple, but it does the job for now.&#xA;&#xA;&#x9;Now, let us move to indexing. With Lucene, the recommendation is that you&#x2019;ll reuse your document and field instance, to avoid create garbage for the GC. With Corax, I took it a step further:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   1: using (var indexer = fullTextIndex.CreateIndexer())&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   2: {&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   3:     indexer.NewDocument();&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   4:     indexer.AddField(&quot;Name&quot;, &quot;Oren Eini&quot;);&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   5:&#xA0; &#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   6:     indexer.NewDocument();&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   7:     indexer.AddField(&quot;Name&quot;, &quot;Ayende Rahien&quot;);&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   8:&#xA0; &#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   9:     indexer.Flush();&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  10: }&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;There are a couple of things to note here. An index can create indexers, it is intended to have multiple concurrent indexers running at the same time. Note that unlike Lucene, we don&#x2019;t have Document or Field classes. Instead, we call methods on the indexer to create a new document and then add fields to the current document. When you are done with a document, you start a new one, or flush to complete the entire operation. For long running indexing, the indexer will flush itself automatically for you.&#xA;&#xA;&#x9;I think that this API gives us the best approach. It guide you toward using a single instance, with internal optimizations to make it memory efficient. Multiple instances can be used concurrently to speed up indexing time. And it knows when to spill flush itself for you, so you don&#x2019;t have to worry about that.&#xA0; Although you do have to complete the operation by calling Flush() at the end.&#xA;&#xA;&#x9;How about searching? That turned out to be pretty similar as well. All you have to do is create a searcher:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   1: using (var searcher = fti.CreateSearcher())&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   2: {&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   3:     QueryResults queryResults = searcher.QueryTop(new TermQuery(&quot;Name&quot;, &quot;Arava&quot;), 10);&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   4:     Console.WriteLine(queryResults.TotalResults);&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   5:     foreach (var match in queryResults.Results)&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   6:     {&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   7:         Console.WriteLine(match.DocumentId &#x2B; &quot; - &quot; &#x2B; match.Score);&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   8:     }&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;   9: }&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#xA;&#xA;&#xA;&#x9;We create a searcher, and then we can utilize it to perform queries.&#xA;&#xA;&#x9;So far, this has been all about the API we have, I&#x2019;ll talk about the actual implementation in my next post.</p>
        <a href="https://ayende.com/blog/166305/finding-a-port-in-a-storm-or-how-to-get-a-consistent-build-experience" target="_blank"><h1 class="title mb-6">Finding a port in a storm: Or how to get a consistent build experience</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 16, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">RavenDB is a server product, as such, we are obvious going to have to talk over the network. That is great, except that it means we need a system wide resource, a TCP port. And that isn&#x2019;t so great, because it turn out that there are a lot of things that can try to grab a port and use it. And I don&#x2019;t speak about things like Skype taking over port 80. I&#x2019;m talking about the use of dynamic or ephemeral ports. That means that during the build, we can have something (for example, Chrome, or DropBox, or anything that uses the web) make a call and suddenly that port is busy and you can&#x2019;t bind to it. The default ports we use for tests are in the 8070 &#x2013; 8090 range, but we have had consistent build failures because something is taking the ports. Finally I took the time to investigate, and I discovered that:      1: C:\Work\ravendb-3.0 [master]&gt; netsh int ipv4 show dynamicport tcp   2:&#xA0;    3: Protocol tcp Dynamic Port Range   4: ---------------------------------   5: Start Port      : 1025   6: Number of Ports : 64510&#xA;So, on the two machines I tested this on, we had the dynamic port range cover everything from port 1025 and up. This sucks. And probably explains the issue. This is how we fixed it (I hope):&#xA;&#xA;&#xA;   1: netsh int ipv4 set dynamicportrange tcp startport=10000 numberofports=55535&#xA;&#xA;Basically, everything below port 10,000 is free for us to use. And yes, this post is here mostly so I&#x2019;ll not have to remember it in the future.</p>
        <div class="button flex justify-between">
            <a href="264.html"><span class="back arrow"></span></a>

            <a href="266.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
</body>
</html>