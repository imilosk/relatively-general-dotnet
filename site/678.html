
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 678 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-6771">
            <a href="https://ayende.com/blog/3352/challenge-why-did-the-tests-fail" target="_blank">
                <h2 class="title mb-6" id="article-6771">Challenge</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 05, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">For a few days, some (~4) of SvnBridge integration tests would fail. Not always the same ones (but usually the same group), and only if I run them all as a group, never if I run each test individually, or if I run the entire test class (which rules out most of the test dependencies that causes this). This was incredibly annoying, but several attempts to track down this issue has been less than successful.  Today I got annoyed enough to say that I am not leaving until I solve this. Considering that a full test run of all SvnBridge&#x27;s tests is... lengthy, that took a while, but I finally tracked down what was going on. The fault was with this method:     protected string Svn(string command)&#xA;{&#xA;&#x9;StringBuilder output = new StringBuilder();&#xA;&#x9;string err = null;&#xA;&#x9;ExecuteInternal(command, delegate(Process svn)&#xA;&#x9;{&#xA;&#x9;&#x9;ThreadPool.QueueUserWorkItem(delegate&#xA;&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;err = svn.StandardError.ReadToEnd();&#xA;&#x9;&#x9;});&#xA;&#x9;&#x9;ThreadPool.QueueUserWorkItem(delegate&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;string line;&#xA;&#x9;&#x9;&#x9;while ((line = svn.StandardOutput.ReadLine()) != null)&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;Console.WriteLine(line);&#xA;&#x9;&#x9;&#x9;&#x9;output.AppendLine(line);&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;});&#xA;&#x9;});&#xA;&#x9;if (string.IsNullOrEmpty(err) == false)&#xA;&#x9;{&#xA;&#x9;&#x9;throw new InvalidOperationException(&quot;Failed to execute command: &quot; &#x2B; err);&#xA;&#x9;}&#xA;&#x9;return output.ToString();&#xA;}&#xA;&#xA;&#xA;This will execute svn.exe and gather its input. Only sometimes it would not do so.&#xA;&#xA;I fixed it by changing the implementation to:&#xA;&#xA;&#xA;  protected static string Svn(string command)&#xA;{&#xA;&#x9;var output = new StringBuilder();&#xA;&#x9;var err = new StringBuilder();&#xA;&#x9;var readFromStdError = new Thread(prc =&gt;&#xA;&#x9;{&#xA;&#x9;&#x9;string line;&#xA;&#x9;&#x9;while ((line = ((Process)prc).StandardError.ReadLine()) != null)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;Console.WriteLine(line);&#xA;&#x9;&#x9;&#x9;err.AppendLine(line);&#xA;&#x9;&#x9;}&#xA;&#x9;});&#xA;&#x9;var readFromStdOut = new Thread(prc =&gt;&#xA;&#x9;{&#xA;&#x9;&#x9;string line;&#xA;&#x9;&#x9;while ((line = ((Process) prc).StandardOutput.ReadLine()) != null)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;Console.WriteLine(line);&#xA;&#x9;&#x9;&#x9;output.AppendLine(line);&#xA;&#x9;&#x9;}&#xA;&#x9;});&#xA;&#x9;ExecuteInternal(command, svn =&gt;&#xA;&#x9;{&#xA;&#x9;&#x9;readFromStdError.Start(svn);&#xA;&#x9;&#x9;readFromStdOut.Start(svn);&#xA;&#x9;});&#xA;&#xA;&#x9;readFromStdError.Join();&#xA;&#x9;readFromStdOut.Join();&#xA;&#xA;&#x9;if (err.Length!=0)&#xA;&#x9;{&#xA;&#x9;&#x9;throw new InvalidOperationException(&quot;Failed to execute command: &quot; &#x2B; err);&#xA;&#x9;}&#xA;&#x9;return output.ToString();&#xA;}&#xA;&#xA;&#xA;And that fixed the problem. What was the problem?</p>
        </article>
        <article id="article-6772">
            <a href="https://ayende.com/blog/3351/review-umbrella-project" target="_blank">
                <h2 class="title mb-6" id="article-6772">Review</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 04, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The Umbrella project from nVentive. I had the chance of sitting with Francois Tanguay in DevTeach and he showed me a bit about it. I was impressed. Umbrella is the ultimate utility library, using all the advantages C# 3.0 can give it. In fact, I think of it a bit like boost for C#.   I tried to read the code, and it was hard. Because of the util nature of Umbrella, there isn&#x27;t a lot of context around the code, so you have to parse the code to understand what it is doing. Luckily, there are a lot of unit tests, which allows me to get the context. I strongly recommend reading the tests in stead of the code, they are a far better way to get an understanding on what the project can offer.  I&#x27;ll go with my usual style, top to bottom, and review what I can.  Binding  This is a concept that I am familiar with from boost. It is also called memoization currying, and is used frequently in functional languages. Here are a few tests, which would explain it much better:     [Fact]&#xA;public void Bind_With_One_Param()&#xA;{&#xA;&#x9;Func&lt;int, int&gt; echo = (i) =&gt; i;&#xA;&#xA;&#x9;var always10 = echo.Bind(10);&#xA;&#x9;Assert.Equal(10, always10());&#xA;}&#xA;&#xA;[Fact]&#xA;public void Bind_First_With_Two_Params()&#xA;{&#xA;&#x9;Func&lt;double, double, double&gt; power = Math.Pow;&#xA;&#xA;&#x9;var twoToTheN = power.BindFirst(2.0);&#xA;&#x9;Assert.Equal(1024.0, twoToTheN(10.0));&#xA;}&#xA;&#xA;  [Fact]&#xA;public void Bind_Chaining()&#xA;{&#xA;&#x9;Func&lt;int, int, int, int, long&gt; func = (a, b, c, d) =&gt; a &#x2B; b &#x2B; c &#x2B; d;&#xA;&#xA;&#x9;var chain = func.BindFirst(1).BindFirst(2).BindFirst(3).Bind(4);&#xA;&#x9;Assert.Equal(func(1, 2, 3, 4), chain());&#xA;}&#xA;&#xA;&#xA;If you are working with delegates a lot, this is a really nice way to handle that.&#xA;&#xA;Clock&#xA;&#xA;This is a simple abstraction (IClock, SystemClock, FreezedClock) over the current time, which allows you to play around with time with total disregard to the system time. Basically, an abstraction on top of DateTime.Now. The main goal is usually to enable unit testing, but I have found this approach to be very useful for handling out of time processing. What does this mean? If I want to process payroll for February, I should be able to do so, and all calculations should be set to whatever date I am talking about, not the current date. (In fact, in such systems, there is usually the target date and effective date, both of which are used to calculate various things, but I digress.)&#xA;&#xA;Collections&#xA;&#xA;Collections are important, no doubt about that, and Umbrella has a lot to offer there. The first interesting example is automatic conversion between types, supported by the CollectionAdapter. Here is the test that shows how this works:&#xA;&#xA;&#xA;  [Fact]&#xA;public void CanConvertBetweenCollectionsTypes()&#xA;{&#xA;&#x9;var ints = new List&lt;int&gt;();&#xA;&#x9;ICollection&lt;string&gt; strings = new CollectionAdapter&lt;int, string&gt;(&#xA;&#x9;&#x9;ints,&#xA;&#x9;&#x9;Funcs&lt;string, int&gt;.Convert,&#xA;&#x9;&#x9;Funcs&lt;int, string&gt;.Convert);&#xA;&#xA;&#x9;strings.Add(&quot;1&quot;);&#xA;&#x9;Assert.Equal(1, ints[0]);&#xA;}&#xA;&#xA;&#xA;Note the Funcs.Convert calls, we will discuss them later. The abstraction is quite complete and very useful. This is also a good way of implementing covariance with generics, I think.&#xA;&#xA;There is a wealth of extension methods for dealing with collections. The most important one, as far as I am concerned, is the AddRange over ICollection&lt;T&gt;. I keep wanting that, and it is only there for List&lt;T&gt;. Having it as an extension method is sweet.&#xA;&#xA;&#xA;  [Fact]&#xA;public void AddRange_And_ReplaceWith()&#xA;{&#xA;    ICollection&lt;int&gt; collection = new List&lt;int&gt;();&#xA;    &#xA;&#xA;      collection.AddRange(new int[] { 1, 2 });&#xA;&#xA;    collection.ReplaceWith(new int[] { 3, 4 });&#xA;&#xA;    Assert.Equal(2, collection.Count);&#xA;    Assert.Equal(3, collection.ElementAt(0));&#xA;    Assert.Equal(4, collection.ElementAt(1));&#xA;}&#xA;&#xA;&#xA;Another interesting extension method is Subscribe. I don&#x27;t like the name, because it has nothing to do with what the code does, but it is a really nice idea nonetheless:&#xA;&#xA;&#xA;  [Fact]&#xA;public void Subscribe()&#xA;{&#xA;&#x9;using (collection.Subscribe(1))&#xA;&#x9;{&#xA;&#x9;&#x9;Assert.Equal(1, collection.Count);&#xA;&#x9;}&#xA;&#x9;Assert.Empty(collection);&#xA;}&#xA;&#xA;&#xA;Inside the using block, the collection has the element, but during dispose, it is removed. I think that the reason it is called this way is that it is being used by ObservableExtensions (later).&#xA;&#xA;Dictionary also get some love, with FindOrCreate and GetValueOrDefault, both of which are very welcome. Enumerable get a much needed ForEach extension method, as well as other interesting bits, ranging from bool None(predicate) to checking if it is empty to IndexOf, etc. LazyList make an appearance, as it should.&#xA;&#xA;What I find very interesting is SyncronizedDictionary. It is interesting because of the way it is implemented, and because dictionaries are almost always a source of hard to realize threading issues in many applications. The implementation made me laugh, however:&#xA;&#xA;&#xA;  public TValue this[TKey key]&#xA;{&#xA;    get { return Lock.Read(item =&gt; item[key]); }&#xA;    set { Lock.Write(item =&gt; item[key] = value); }&#xA;}&#xA;&#xA;&#xA;It made me laugh because it is so simple. I traced down the implementation, and I liked it. It comes down to using Reader Writer Lock, which is what you are supposed to be doing. Obvious Umbrella has attained its critical mass.&#xA;&#xA;Components&#xA;&#xA;Ubmrella is also big enough to include its own Service Locator implementation, which can be plugged into an IoC container. I think that I&#x27;ll skip this part.&#xA;&#xA;Composites&#xA;&#xA;All the building blocks for the composite patterns are here, and in a very interesting fashion. Take a look at this:&#xA;&#xA;&#xA;  public class CompositeFoo : Composite&lt;IFoo&gt;, IFoo&#xA;{&#xA;    #region IFoo Members&#xA;&#xA;    public void Do(int i)&#xA;    {&#xA;        Items.ForEach(item =&gt; item.Do(i));&#xA;    }&#xA;&#xA;    #endregion&#xA;}&#xA;&#xA;&#xA;And now we can use this like this:&#xA;&#xA;&#xA;  [Fact]&#xA;public void SelectMany()&#xA;{&#xA;&#x9;var foo = new CompositeFoo&#xA;&#x9;          &#x9;{&#xA;&#x9;          &#x9;&#x9;new Foo(),&#xA;&#x9;          &#x9;&#x9;new OtherFoo(),&#xA;&#x9;          &#x9;&#x9;new OtherFoo(),&#xA;&#x9;          &#x9;&#x9;new CompositeFoo&#xA;&#x9;          &#x9;&#x9;&#x9;{&#xA;&#x9;          &#x9;&#x9;&#x9;&#x9;new Foo(),&#xA;&#x9;          &#x9;&#x9;&#x9;&#x9;new OtherFoo()&#xA;&#x9;          &#x9;&#x9;&#x9;}&#xA;&#x9;          &#x9;};&#xA;&#x9;IEnumerable&lt;IFoo&gt; items = foo.SelectMany();&#xA;&#xA;    Assert.Equal(5, items.Count());&#xA;    Assert.Equal(2, items.OfType&lt;Foo&gt;().Count());&#xA;    Assert.Equal(3, items.OfType&lt;OtherFoo&gt;().Count());&#xA;}&#xA;&#xA;&#xA;I don&#x27;t use composites all that much, but it is an elegant approach.&#xA;&#xA;Conditions&#xA;&#xA;You can almost classify this as an extension of the composite pattern, by allowing to compose conditions. This is really useful when you have to build complex conditions are runtime.&#xA;&#xA;&#xA;  [Fact]&#xA;public void True()&#xA;{&#xA;    IMessage&lt;Null, bool&gt; lhs = new Message&lt;Null, bool&gt;(notUsed =&gt; true);&#xA;    IMessage&lt;Null, bool&gt; rhs = new Message&lt;Null, bool&gt;(notUsed =&gt; true);&#xA;&#xA;    var andMessage = lhs.And(rhs);&#xA;&#xA;    Assert.True(andMessage.Send());&#xA;}&#xA;&#xA;&#xA;However, did you note the IMessage? I will get to that in a bit, and we will discuss this, it is an important part of Umbrella, but not one I like.&#xA;&#xA;Containers&#xA;&#xA;Couldn&#x27;t figure out what this is supposed to do. Seems to be relation to the service locator impl.&#xA;&#xA;Contracts&#xA;&#xA;Couldn&#x27;t figure out what this is supposed to do. Seems to be relation to the service locator impl.&#xA;&#xA;Conversions&#xA;&#xA;There are some nice things there, mostly accessible via Conversion().To&lt;TTarget&gt;(), handling Enums is nice:&#xA;&#xA;&#xA;  [Fact]&#xA;public void StringFromEnum()&#xA;{&#xA;    Assert.Equal(&quot;Cancelled&quot;, Status.Cancelled.Conversion().To&lt;string&gt;());&#xA;    Assert.Equal(&quot;VER&quot;, Status.Verified.Conversion().To&lt;string&gt;());&#xA;}&#xA;&#xA;public enum Status&#xA;{&#xA;    [Description(&quot;VER&quot;)]&#xA;    Verified,&#xA;    Cancelled&#xA;}&#xA;&#xA;&#xA;Or standard type conversions:&#xA;&#xA;&#xA;  [Fact]&#xA;public void CanConvertInt32ToString()&#xA;{&#xA;    Assert.Equal(&quot;1&quot;, 1.Conversion().To&lt;string&gt;());&#xA;}&#xA;&#xA;[Fact]&#xA;public void CanConvertStringToInt32()&#xA;{&#xA;    Assert.Equal(1, &quot;1&quot;.Conversion().To&lt;int&gt;());&#xA;}&#xA;&#xA;&#xA;Decorator&#xA;&#xA;Again, the building blocks for the decorator pattern. This time, I don&#x27;t see much use of this, since it doesn&#x27;t seem to provide much value.&#xA;&#xA;Equality&#xA;&#xA;Provide a set of extension methods that extend equality comparisons. Mostly over enumerables and the like, from a brief look.&#xA;&#xA;Events&#xA;&#xA;There are the expected Raise() set of extension methods, but I find Observe and Notify far more interesting:&#xA;&#xA;&#xA;  using(order.Observe(UpdateForm))&#xA;{&#xA;&#x9;form.Show();&#xA;}&#xA;&#xA;&#xA;And:&#xA;&#xA;&#xA;  public int Value&#xA;{&#xA;    get { return value; }&#xA;    set&#xA;    {&#xA;        this.value = value;&#xA;        this.Notify(PropertyChanged, item =&gt; item.Value);&#xA;    }&#xA;} &#xA;&#xA;&#xA;During the using statement, all NotifyPropertyChanged events will be captured. This is nice. The Notify() will handle property notifications without using strings. I don&#x27;t deal much with INotifyPropertyChanged, however, so I care little for this.&#xA;&#xA;There is also an implementation of observable, which may be useful. Again, this is not something I tend to use.&#xA;&#xA;Expressions&#xA;&#xA;Linq expressions are immutable, which make it a harder to build them. Umbrella solve this by giving us editable expressions, which are builders on top of normal extensions. Nice.&#xA;Extensions&#xA;&#xA;This is a very loaded term in a utility project, and it contains a lot of things.&#xA0; Some of the things I liked are date handling:&#xA;&#xA;&#xA;  [Fact]&#xA;public void Equal()&#xA;{&#xA;    DateTime x = new DateTime(2008, 2, 1);&#xA;    DateTime y = new DateTime(2008, 2, 2);&#xA;&#xA;    Assert.True(x.Equal(y, DateTimeUnit.ToMonth));&#xA;    Assert.False(x.Equal(y, DateTimeUnit.ToDay));&#xA;}&#xA;&#xA;[Fact]&#xA;public void Truncate()&#xA;{&#xA;    Assert.Equal(new DateTime(2008, 2, 1), new DateTime(2008, 2, 2).Truncate(DateTimeUnit.ToMonth));&#xA;}&#xA;&#xA;&#xA;There are a lot of things around date, but I think that this is a representative method:&#xA;&#xA;&#xA;  public static DateTime BeginningOfWeek(this DateTime self)&#xA;{&#xA;&#x9;return (self - self.DayOfWeek.DaysSince(Extensions.WeekBeginsOn).Days())&#xA;&#x9;&#x9;&#x9;&#x9;.BeginningOfDay();&#xA;}&#xA;&#xA;&#xA;There are also the standard (by now), &quot;foo&quot;.IsNullOrEmpty() and &quot;foo&quot;.HasValue(), additions to &#xA;&#xA;I can&#x27;t figure out the concept of Extension Points, however. Or, to be rather exact, I can&#x27;t see what value it brings to the table.&#xA;&#xA;What is really sweet is the handling of bit manipulation:&#xA;&#xA;&#xA;  [Fact]&#xA;public void Enum_Add()&#xA;{&#xA;    BindingFlags flags = BindingFlags.Public;&#xA;    flags = flags.Add(BindingFlags.NonPublic);&#xA;&#xA;    Assert.Equal(BindingFlags.Public | BindingFlags.NonPublic, flags);&#xA;}&#xA;&#xA;[Fact]&#xA;public void Enum_Remove()&#xA;{&#xA;    BindingFlags flags = BindingFlags.Public | BindingFlags.NonPublic;&#xA;    flags = flags.Substract(BindingFlags.NonPublic);&#xA;&#xA;    Assert.Equal(BindingFlags.Public, flags);&#xA;}&#xA;&#xA;&#xA;And the correspond read approach:&#xA;&#xA;&#xA;  [Fact]&#xA;public void Enum_ContainsAll()&#xA;{&#xA;    BindingFlags flags = BindingFlags.Public | BindingFlags.NonPublic;&#xA;&#xA;    Assert.True(flags.ContainsAll(BindingFlags.Public));&#xA;    Assert.True(flags.ContainsAll(BindingFlags.NonPublic));&#xA;    Assert.True(flags.ContainsAll(BindingFlags.Public | BindingFlags.NonPublic));&#xA;&#xA;    Assert.False(flags.ContainsAll(BindingFlags.Public | BindingFlags.Instance));&#xA;    Assert.False(flags.ContainsAll(BindingFlags.Instance));&#xA;&#xA;}&#xA;&#xA;[Fact]&#xA;public void Enum_ContainsAny()&#xA;{&#xA;&#x9;BindingFlags flags = BindingFlags.Public | BindingFlags.NonPublic;&#xA;&#xA;&#x9;Assert.True(flags.ContainsAny(BindingFlags.Public));&#xA;&#x9;Assert.True(flags.ContainsAny(BindingFlags.NonPublic));&#xA;&#x9;Assert.True(flags.ContainsAny(BindingFlags.Public | BindingFlags.NonPublic));&#xA;&#x9;Assert.True(flags.ContainsAny(BindingFlags.Public | BindingFlags.Instance));&#xA;&#xA;&#x9;Assert.False(flags.ContainsAny(BindingFlags.Instance));&#xA;}&#xA;&#xA;&#xA;Factories&#xA;&#xA;Seems to be relation to the service locator impl.&#xA;&#xA;Locator&#xA;&#xA;This is the service locator impl, I am ignoring that.&#xA;&#xA;Messages&#xA;&#xA;Messages are pretty important in Umbrella. They are defined as:&#xA;&#xA;&#xA;  public interface IMessage&lt;TRequest, TResponse&gt;&#xA;{&#xA;    TResponse Send(TRequest request);&#xA;}&#xA;&#xA;&#xA;I strongly disagree with the term message here, however. A message in inanimate object, it doesn&#x27;t act on its own. Messages in Umbrella are actions. In fact, the default implementation of a message is around a Func&lt;TRequest, TResponse&gt;.&#xA;&#xA;Once you have those messages, however, you can start dealing with them in interesting ways. As a simple example, you can create a DisposableMessage, which will wrap another message and call Send() on it. Or bind the output of one message to the input of another, or simply chain them all together. A lot of the actions inside Umbrella are happening using those messages.&#xA;&#xA;Reflection&#xA;&#xA;This is a probably my favorite part in Umbrella. It abstract away all the gory reflection details:&#xA;&#xA;&#xA;  [Fact]&#xA;public void Instance()&#xA;{&#xA;    Foo foo = new Foo();&#xA;&#xA;    IReflectionExtensionPoint fooReflection = foo.Reflection();&#xA;&#xA;    Assert.Equal(foo.I, fooReflection.Get(&quot;i&quot;));&#xA;&#xA;    fooReflection.Set(&quot;i&quot;, 2);&#xA;&#xA;    Assert.Equal(2, foo.I);&#xA;&#xA;    Assert.Equal(2, fooReflection.Get(&quot;I&quot;));&#xA;&#xA;    fooReflection.Set(&quot;I&quot;, 3);&#xA;&#xA;    Assert.Equal(3, foo.I);&#xA;&#xA;    Assert.Equal(3, fooReflection.Get(&quot;GetI&quot;));&#xA;&#xA;    fooReflection.Set(&quot;SetI&quot;, 4);&#xA;&#xA;    Assert.Equal(4, foo.I);&#xA;}&#xA;&#xA;&#xA;Leaving aside how much easier it make it to write the code, it also means that I now have an extension point to replace how it works if I need to. Nice.&#xA;&#xA;Security&#xA;&#xA;This appears to be based on contracts, which I already stated that I don&#x27;t understand.&#xA;&#xA;Serialization&#xA;&#xA;This is cool, and I think that I figured out what extension point is for. Take a look at the code:&#xA;&#xA;&#xA;  int instance = 1;&#xA;instance.Serialization().Binary(new MemoryStream());&#xA;instance.Serialization().Xml(new MemoryStream());&#xA;&#xA;&#xA;This is a general pattern of usage in the code, you have an extension method that return an ExtensionPoint&lt;T&gt;, on top of which you can add additional extension methods, and build up a nice API in this fashion. It also make this big library much more discoverable.&#xA;&#xA;Sources&#xA;&#xA;A way to get values, not sure what it is for, however.&#xA;&#xA;Threading&#xA;&#xA;This give us a way to handle locking in a really nice fashion, as we have already seen with SyncronizedDictionary. Just create a SynchronizableLock&lt;T&gt; and start calling Lock.Read(lambda) and Lock.Write(lambda).&#xA;&#xA;I really like this.&#xA;&#xA;Validation&#xA;&#xA;This is bare bone at the moment, but it is looking really nice. Check this out:&#xA;&#xA;&#xA;  [Fact]&#xA;public void String_NotNullOrEmpty_WithNull()&#xA;{&#xA;&#x9;string value = null;&#xA;&#xA;&#x9;var ex = Assert.Throws&lt;ArgumentNullException&gt;(() =&gt; value.Validation().NotNullOrEmpty(&quot;value&quot;));&#xA;&#x9;Assert.Equal(&quot;value&quot;, ex.ParamName);&#xA;}&#xA;&#xA;&#xA;Values&#xA;&#xA;Again, this is making heavy use of messages and and I am pretty sure that I don&#x27;t understand the intended usage. Digging through the code I found some interesting ideas about registering for disposal, which looks interesting. Basically, you can do the following inside classes that inherit from container:&#xA;&#xA;&#xA;  Disposable.Add(new MyLock());&#xA;&#xA;&#xA;And it will be disposed when the container is disposed. Nice.&#xA;&#xA;Web&#xA;&#xA;Contains implementations of sources on session and web principals. I don&#x27;t get sources, so I am not sure what I can make of this.&#xA;&#xA;Summary&#xA;&#xA;This has been a brief overview, but no means have I gone through the whole thing. Umbrella is big. At first, extension points are very strange, but they make sense once you realize how Umbrella is architected. They allow to extend a type and preserve the original value nicely.&#xA;&#xA;There are some things that I really like, (Reflection, SyncronizedDictionary, Lock.Write) and some I can&#x27;t figure out (sources, values, etc). I strongly suggest reading through the code, if only to get some ideas about patterns that are useful for C# 3.0.</p>
        </article>
        <article id="article-6773">
            <a href="https://ayende.com/blog/3350/review-mass-transit-samples" target="_blank">
                <h2 class="title mb-6" id="article-6773">Review</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 04, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Yesterday I reviewed Mass Transit itself, unfortunately, I missed the samples folder, which means that I didn&#x27;t get critical information about how to use Mass Transit. I am going to do the same review for the samples, trying to get a feeling for how using Mass Transit feels.  Audit  This seems to be only partially done, it apparently should show how we can fire off events using Mass Transit. Again, I am impress by how simple the Cunsumes&lt;TMsg&gt;.All makes the code, but there is nothing there as of now.  Heavy Load  Load testing, not something that I am particularly interested at right this moment.  Publish Subscribe  This example more or less show how you can use Pub / Sub. Nothing really interesting there, but it has cleared my mind about a few things. Specifically, I was bothered by the tie of the service bus to a specific end point. What I missed was that this was the entry point end point, and that communication can (and does) flow to other end points. Once I grasped that, it became much easier to understand what was going on there.  What really bothers me, however, is this:     &lt;component id=&quot;serviceBus&quot;&#xA;&#x9;&#x9;   lifestyle=&quot;singleton&quot;&#xA;&#x9;&#x9;   service=&quot;MassTransit.ServiceBus.IServiceBus, MassTransit.ServiceBus&quot;&#xA;&#x9;&#x9;   type=&quot;MassTransit.ServiceBus.ServiceBus, MassTransit.ServiceBus&quot;&gt;&#xA;&#x9;&lt;parameters&gt;&#xA;&#x9;&#x9;&lt;endpointToListenOn&gt;${serverEndpoint}&lt;/endpointToListenOn&gt;&#xA;&#x9;&#x9;&lt;!-- Setter Injection --&gt;&#xA;&#x9;&#x9;&lt;SubscriptionCache&gt;${subscriptionCache}&lt;/SubscriptionCache&gt;&#xA;&#x9;&lt;/parameters&gt;&#xA;&lt;/component&gt;&#xA;&lt;component id=&quot;serverEndpoint&quot;&#xA;&#x9;&#x9;   lifestyle=&quot;singleton&quot;&#xA;&#x9;&#x9;   service=&quot;MassTransit.ServiceBus.IEndpoint, MassTransit.ServiceBus&quot;&#xA;&#x9;&#x9;   type=&quot;MassTransit.ServiceBus.MSMQ.MsmqEndpoint, MassTransit.ServiceBus.MSMQ&quot;&gt;&#xA;&#x9;&lt;parameters&gt;&#xA;&#x9;&#x9;&lt;uriString&gt;msmq://localhost/test_server&lt;/uriString&gt;&#xA;&#x9;&lt;/parameters&gt;&#xA;&lt;/component&gt;&#xA;&#xA;&#xA;That sound you just heard was me, fleeing in terror. The idea that I would need to write so much XML is abhorrent to me. My idea syntax would be something like this:&#xA;&#xA;&#xA;  facility MassTransitFacility, startable = true:&#xA;&#x9;standardCustomersServiceBus = &quot;msmq://localhost/standard_customers&quot;&#xA;&#x9;enterpriseCustomersServiceBus = &quot;msmq://localhost/enterprise_customers&quot;&#xA;&#xA;  extend OrdersController:&#xA;&#x9;standardCustomerPublisher = @standardCustomersServiceBus&#xA;&#x9;enterpriseCustomersPublisher = @enterpriseCustomersServiceBus&#xA;&#xA;&#xA;And this will allow us to define both service bus and the end points in the container, and start them as soon as they are ready. No need to do anything in the actual application code beyond just creating the container.&#xA;&#xA;Web Request Reply&#xA;&#xA;This is very interesting, because it shows how you can handle request reply scenarios, which are very common in data handling scenarios. In this case, the code sample show an async request / reply, using MonoRail&#x27;s async actions: &#xA;&#xA;&#xA;  public IAsyncResult BeginAsync(string requestText)&#xA;{&#xA;&#x9;_request = _bus.Request()&#xA;&#x9;&#x9;.From(this)&#xA;&#x9;&#x9;.WithCallback(ControllerContext.Async.Callback, ControllerContext.Async.State)&#xA;&#x9;&#x9;.Send(new RequestMessage(CorrelationId, requestText));&#xA;&#xA;&#x9;return _request;&#xA;}&#xA;&#xA;public void EndAsync()&#xA;{&#xA;&#x9;PropertyBag.Add(&quot;responseText&quot;, msg.Text &#x2B; &quot; (and my response)&quot;);&#xA;&#x9;RenderView(&quot;Default&quot;);&#xA;}&#xA;&#xA;public void Consume(ResponseMessage message)&#xA;{&#xA;&#x9;msg = message;&#xA;&#x9;_request.Complete();&#xA;}&#xA;&#xA;&#xA;I find it very nice. I did wonder at first how the standard EndSend() is involved here, but then I realized that it is not. It doesn&#x27;t make sense for message passing semantics. When you pass the this pointer to the From() method, it will register that for accepting messages from the bus. I do wonder about such things as timeouts and memory leaks. From my observation, a failure in handling the response of a message would leak the handler instance.&#xA;&#xA;To conclude, after reviewing the samples, I feel that I have a much better understanding of Mass Transit, which is good. It hasn&#x27;t shifted my thinking, the way reading NServiceBus did, but that is probably because I have already read NServiceBus code.</p>
        </article>
        <article id="article-6774">
            <a href="https://ayende.com/blog/3349/reviewing-mass-transit" target="_blank">
                <h2 class="title mb-6" id="article-6774">Reviewing Mass Transit</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 04, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A while ago I took a look at NServiceBus and its Distributor, after catching this post talking about Mass Transit, I decided that I really need to take an additional look at this project. Mass Transit is very similar in purpose to NServiceBus, and it uses a very similar approach. However, it has a radically different style. A lot of the concepts are shared between both projects.   As usual, I am going to post here my thoughts as I read through the code.  Opening the project is a bit overwhelming, although not as much as with NServiceBus. We have 22 projects (NServiceBus had 47 when I checked that). I tried to think how to express my initial impression, and finally settled on using the old adage about a picture worth a thousand words.     Looks like there is a lot of interesting concepts there. One thing that really stand out is that 8 of those projects are test projects. That make me feel much better about the project.  Build  The build projects handle creating the appropriate queues, there is a single class in all three projects, so I am will just ignore them.  Dashboard  The dashboard application is using MonoRail, Windsor &amp; Brail. This make me happy, even though the dashboard is obviously in its initial stages. One point that I dislike is the use of XML configuration for Windsor.   Deferment Service  I had to look up in the dictionary to figure out what deferment means, but take a single look at the actual code made it obvious:     public interface IDefermentService&#xA;{&#xA;    int Defer(object msg, TimeSpan amountOfTimeToDefer);&#xA;}&#xA;&#xA;&#xA;There is no usable implementation for this, and there aren&#x27;t enough tests to make it possible to understand how this is supposed to be used, either.&#xA;&#xA;So far, nothing really interesting, but I am used to getting mixed results when following the Top to Bottom Review style that I like.&#xA;&#xA;Host&#xA;&#xA;The host is a window service that can host Mass Transit. In essence, it takes a configurator, which is an object that can return hosted services, and use that to start itself up, spinning up those services. A hosted service is a way to register and unregister to incoming messages. &#xA;&#xA;There are a lot of things there that I am vague about. There is a lot of code to deal with arguments, argument maps, etc. I am not sure what it is doing there, and what it is trying to do. But I haven&#x27;t read the tests yet.&#xA;&#xA;The tests contains this sample, which I am not sure that I like. It looks like the service is dealing with too many things, from subscribing to messages to hosting the bus itself through message handling. This also cause my thread safety spider sense to tingle quite heavily.&#xA;&#xA;I am not really interested in the configuration, from a very cursory glance, it seems to me that I would move all of that to the container and deal with it there.&#xA;&#xA;Patterns&#xA;&#xA;I am always suspicious when I am seeing patterns as a topic of itself. It reminds me of the application that reach GoF-complete status by implementing all of the GoF patterns. That said, I really should look inside before talking.&#xA;&#xA;After reading the code, I can say that there isn&#x27;t a lot of useful code there. It seems to be intended to be a repository for implementing patterns for Enterprise Integration Patterns. Something that I find very interesting is this piece of code:&#xA;&#xA;&#xA;  public class HeartbeatMonitor :&#xA;&#x9;Consumes&lt;Heartbeat&gt;.All&#xA;{&#xA;&#x9;private IServiceBus _bus;&#xA;&#xA;&#x9;public HeartbeatMonitor(IServiceBus bus)&#xA;&#x9;{&#xA;&#x9;&#x9;_bus = bus;&#xA;&#x9;}&#xA;&#xA;&#x9;public void Consume(Heartbeat message)&#xA;&#x9;{&#xA;&#x9;&#x9;// do something with the heartbeat&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;The Consumes&lt;Heartbeat&gt;.All is a really nice tagging idea. It wouldn&#x27;t have occur to me, but it is a very natural way to specify what is going on there.&#xA;&#xA;Subscriptions&#xA;&#xA;Subscriptions in service buses play a critical role in ensuring that message would reach their destination as they should.&#xA;&#xA;What appears to be a default implementation is a subscription service that is backed by a database to store those subscriptions. This looks like a really simple way of handling that, but it is not really interesting.&#xA;&#xA;What is interesting is the distributed subscription cache, it is using Memcached in order to store the information. There are some issues there that bother me, however. There is minor issues with multi threaded access to that may cause issue, mainly with dictionaries used to store state. What really bothers me, however, is that a cache is not a good place to store information. By definition you can&#x27;t rely on it staying there.&#xA;&#xA;I haven&#x27;t seen so far how the persistent storage get to update the cache. I think that I am missing something here. I assume that there are some messages flying around here that I am not seeing.&#xA;&#xA;Yes, there is, and it is in the SubscriptionService, which I haven&#x27;t looked deeply at yet.&#xA;&#xA;I really like the way the tests are organized, by the way.&#xA;&#xA;Transports&#xA;&#xA;Mass Transit supports MSMQ and in the process of adding support to ActiveMQ. It is interesting to compare the two, but before I do that, I want to take a look at the MSMQ implementation. There isn&#x27;t anything interesting with the Send implementation, but the Receive is interesting.&#xA;&#xA;It is using GetMessageEnumerator2() to go through the messages and decide if there is any message that is worth dispatching. NServiceBus use a Peek &amp; Read approach, instead, and then handle the message internally. There is a potential resource leak there, because the enumerator isn&#x27;t using a using statement to free the enumerator in the case of exception.&#xA;&#xA;The ActiveMQ implementation has just been started, from the looks of things, but just from the short code sample that there is there I can tell that it is smells heavily of Java. This is natural, since ActiveMQ is written in Java, but it is amusing to be able to recognize the style.&#xA;&#xA;Service Bus&#xA;&#xA;Finally! There are things to be said against reading top to bottom when the last project contains all the interesting meat. So far, I have only dealt with various infrastructure stuff, not really interesting, to tell you the truth.&#xA0; Let us dive into the code...&#xA;&#xA;There are formatters, which serialize an message instance to the wire. I was amused to find out that Mass Transit supports binary, XML and, of all things, JSON. I am not sure who is going to consume that, but I hope it is not running in a browser.&#xA;&#xA;It looks like the Health Monitoring that appeared in the patterns section has been merged to the main line. Now we start to see how this is used. Here is an example of a service that just send a healthy heartbeat:&#xA;&#xA;&#xA;  public class HealthClient : IHostedService&#xA;{&#xA;&#x9;readonly IServiceBus _bus;&#xA;&#x9;readonly Timer _timer = new Timer(3000);&#xA;&#xA;&#x9;public HealthClient(IServiceBus bus)&#xA;&#x9;{&#xA;&#x9;&#x9;_bus = bus;&#xA;&#x9;&#x9;_timer.Elapsed &#x2B;= delegate&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;_bus.Publish(new Heartbeat(3, _bus.Endpoint.Uri));&#xA;&#x9;&#x9;};&#xA;&#x9;}&#xA;&#xA;&#x9;public void Start()&#xA;&#x9;{&#xA;&#x9;&#x9;_timer.Start();&#xA;&#x9;}&#xA;&#xA;&#x9;public void Stop()&#xA;&#x9;{&#xA;&#x9;&#x9;_timer.Stop();&#xA;&#x9;}&#xA;&#xA;&#x9;public void Dispose()&#xA;&#x9;{&#xA;&#x9;&#x9;_timer.Dispose();&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;I like this. There isn&#x27;t a single line that I would consider wasted.&#xA;&#xA;However, there are a few things that concerns me about this sample. First and foremost, the bus seems to be tied directly to a specific end point. I am pretty sure that I don&#x27;t like this. The problem here is that this means that I now need to configure a bus per end point, and I find myself reluctant to do that. But let us deal with this issue later, in the mean time, I want to read the rest of the health monitoring part.&#xA;&#xA;Having done that, I am not sure that I like what I am seeing. Let us take a look at the other side of the health monitoring:&#xA;&#xA;&#xA;  public class HealthService : IHostedService&#xA;{&#xA;    private readonly IServiceBus _bus;&#xA;&#xA;    public HealthService(IServiceBus bus)&#xA;    {&#xA;        _bus = bus;&#xA;    }&#xA;&#xA;    public void Start()&#xA;    {&#xA;        _bus.AddComponent&lt;HeartbeatMonitor&gt;();&#xA;        _bus.AddComponent&lt;Investigator&gt;();&#xA;        _bus.AddComponent&lt;Reporter&gt;();&#xA;    }&#xA;&#xA;    public void Stop()&#xA;    {&#xA;        _bus.RemoveComponent&lt;Reporter&gt;();&#xA;        _bus.RemoveComponent&lt;Investigator&gt;();&#xA;        _bus.RemoveComponent&lt;HeartbeatMonitor&gt;();&#xA;    }&#xA;}&#xA;&#xA;&#xA;This is the heart of what is bothering me. Why do we have to register and unregister those components? A component is a term from IoC containers, not from service buses. Using this approach give you much more control over what is going on (you can shut down services very easily this way), but I dislike it. I would route message handlers through the container and be done with it. If I wanted to dynamic start / shutdown of services, it is easy enough to do without this.&#xA;&#xA;The way Mass Transit handles subscriptions is interesting. And I strongly suggest taking a look. When the service start working, it ask to get all the current subscriptions, and hold it locally. There are provisions in place to handle subscription updates, but they haven&#x27;t been implemented yet.&#xA;&#xA;Moving on from subscriptions, probably the most beautiful part of Mass Transit is this:&#xA;&#xA;&#xA;  public class Consumes&lt;TMessage&gt; where TMessage : class&#xA;{&#xA;&#x9;public interface All&#xA;&#x9;{&#xA;&#x9;&#x9;void Consume(TMessage message);&#xA;&#x9;}&#xA;&#xA;&#x9;public interface For&lt;TCorrelationId&gt; : All, CorrelatedBy&lt;TCorrelationId&gt;&#xA;&#x9;{&#xA;&#x9;}&#xA;&#xA;&#x9;public interface Selected : All&#xA;&#x9;{&#xA;&#x9;&#x9;bool Accept(TMessage message);&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;Comparing the syntax that this enable vs. the syntax that NServiceBus need... I really like this. And I am very annoyed that I have not thought about this myself.&#xA;&#xA;And not it is 05:38 AM my time, and while the Mass Transit codebase is interesting, is isn&#x27;t quite that much of a page turner.&#xA;&#xA;I took a look at the Service Bus implementation, and found more or less what I expected. Especially frustrating is that I can see that there are a lot of features that are not used in Mass Transit itself, they are there to be exposed to users of the library. &#xA;&#xA;The problem with that is that there is no reference for seeing how they are used. A sample application or two to show off what it is doing and how it is doing it would be most welcome. Especially since it would give better sense for how this works as a whole.&#xA;&#xA;Update: I am an idiot, there are samples, I just missed them.&#xA;&#xA;I am still unclear on the ServiceBus / Endpoint one to one mapping. I don&#x27;t like this as it stand, but I am missing something. Mass Transit is 0.1, and it shows. It looks promising, and there are some interesting ideas there that I would like to see followed up. &#xA;&#xA;I would like to see a service bus that doesn&#x27;t try to be a container as well (NServiceBus &amp; Mass Transit both share this fault to some extent), but rather build on top of the container and just provided the pub / sub services.&#xA;&#xA;Sigh, I really don&#x27;t want to have to write one.</p>
        </article>
        <article id="article-6775">
            <a href="https://ayende.com/blog/3348/hunting-for-the-missing-item-exception" target="_blank">
                <h2 class="title mb-6" id="article-6775">Hunting for the missing item exception</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 04, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">There was a known, but irreproducible, in SvnBridge for a long while now.  The essence of the bug is that under some circumstances, updating from SvnBridge would fail. The reason for failure was an assertion failure. Somehow, someone made a change to a file that doesn&#x27;t exists.  Did you note the some circumstances part? That is the critical issue there. It is the circumstances that I wasn&#x27;t able to reproduce. As a matter of fact, I wasn&#x27;t able to narrow what happened. I sometimes got it, and when I had a repro, I could fix it. But all too often, trying to reproduce the same steps would not cause the bug, but work as expected.  Annoying as hell, as you might imagine.  Today I finally managed to figure out what was going on. You can see the repro on the right. This is a timeline, where each user is colored differently.  As you can see, it require a failure unusual set of circumstances, and the way the SVN protocol work make it harder to figure out. (When you ask for changes on an item, you are actually requesting all changes on its parent, which is a critical issue here).  It is also important which side of the rename you are asking about, and... but now I am probably boring you with technical details that are not interesting even to geeks.  I have been in weird bug fixing mode for SvnBridge for a while now, and it is... interesting to see what crops up. Right now most bugs takes quite a long time to track and fix, unfortunately.  Oh, and as a parting shot, take a look here at how I tracked that one:</p>
        </article>
        <article id="article-6776">
            <a href="https://ayende.com/blog/3347/let-us-make-the-ui-complex-just-because-we-feel-like-it" target="_blank">
                <h2 class="title mb-6" id="article-6776">Let us make the UI complex, just because we feel like it</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 04, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Let us take a look at this dialog, shall we?     What I see is that we have two text fields and two checkboxes, in a fairly big dialog, to express the following bit of information:     I honestly have no idea what the purpose of this is. To make it harder to input the information, presumably. Given a URL, I now need to split it apart manually, I need to know that https is usually on 443, etc.  It also mean that when I am talking to a user, I need to give her three pieces of information, and explain where to put each of them, rather than sending a URL that she can just copy / paste in place and be done with it.</p>
        </article>
        <article id="article-6777">
            <a href="https://ayende.com/blog/3346/architecting-twitter" target="_blank">
                <h2 class="title mb-6" id="article-6777">Architecting Twitter</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 03, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">There are some interesting discussions about the way Twitter is architected. Frankly, I think that having routine outages over such a long period is a sign of either negligence or incompetence. The problem isn&#x27;t that hard, for crying out loud.  With that in mind, I set out to try architecting such a system. As far as I am concerned, twitter can be safely divided into two separate applications, the server side and the client side. The web UI, by the way, is considered part of the client.  The server responsibilities:     Accept twits from the client, this include:         Analyzing the message content, (@foo should go to foo, #tag should be tagged, etc)      Forward the message to all the followers of the particular user       Answer to queries about twits from people that a certain person is following    Answer to queries about a person    It should scale    Clients are assumed to be badly written   The client responsibilities:     Display information to the user    Pretty slicing &amp; dicing of the data   Obviously, I am talking as someone who knows that there is even the need to scale, but let us leave this aside.  I am going to ignore the client, I don&#x27;t care much about this bit. For the server, it turn out that we have a fairly simple way of handling that.  We will split it into several pieces, and deal with each of them independently. The major ones are read, write and analysis.   There isn&#x27;t much need to deal with analysis. We can handle that using on the backend, without really affecting the application, so we will start with processing writes.  Twitter, like most systems, is heavily skewed toward reads. In addition to that, we don&#x27;t really need instant responsiveness. It is allowed to take a few moments before the new message is visible to all the followers.  As such, the process of handling new twits is fairly simple. A gateway server will accept the new twit and place it in a queue. A set of worker server will take the new twits out of the queue and start processing them.  There are several ways of doing that, either by distributing load by function or by simple round robin. Myself, I tend toward round robin unless there is a process that is significantly slower than the others, or require extra requirements (sending email may require opening a port in the firewall, as such, it cannot run on just any machine, but only on machines dedicated to it).  &#xA0; The process of handling a twit is fairly straightforward. As I mentioned, we are heavily skewed toward reads, so it is worth taking more time when processing a write to make sure that a read is as simple as possible.  This means that our model should support the following qualities:     Simple - Reading the timeline should involve no joins and no complexity whatsoever. Preferably, it should involve a query that uses a clustered index and that is it.    Cacheable - There should be as few a factors that affects the data that we need to handle as possible.    Shardable - the ability to split the work into multiple databases would mean that we will be able to scale out very easily.   As such, the model on the right seems like a good one (obviously this is very over simplified, but it works as an example).  This means that in order to display the timeline for a particular user, we will need to perform exactly two queries. One to the routing database, to find out what server this user data is sitting on, the second, to perform a trivial select on the timelines table.  What this means, in turn, is that the process for writing a new twit can be described using the following piece of code:     followers = GetFollowersFor(msg.Author)&#xA;followers.UnionWith( GetRepliesToIn(msg.Text) )&#xA;&#xA;for follower in followers:&#xA;&#x9;DirectPublish(follower, msg)&#xA;&#xA;&#xA;DirectPublish would simply locate the appropriate server and insert a new message, that is all.&#xA;&#xA;If we will take a pathological case of someone who has 10,000 followers, what this means is that each time this person will publish a new twit, the writer section of the application will have to go and write the message 10,000 times. Ridiculous, isn&#x27;t it?&#xA;&#xA;Not really. This model allows us to keep very low contention, since we don&#x27;t have any need for complex coordination, it is easily scalable for additional servers as needed, and it means that even in the case of several such pathological users suddenly starting to send high amount of messages, the application as a whole is not really affected. That is quite a side from the fact that inserting 10,000 rows is not really big. Especially since we are splitting it across several servers. &#xA;&#xA;But if it really bothered me, I would designate separate machines for handling such high volume users. It will ensure that regular traffic in the site can still flow while some machine in the back of the data center is slowly processing the big volume. In fact, I would probably decide that it is worth my time using bulk insert techniques for those users.&#xA;&#xA;All of that said, we now have a system where the database end is trivially simple (probably because the problem, as shown in this post, is trivial, I am pretty sure that the real world is more complex, but never mind that), scaling out the writing part is a matter of adding more workers to process more messages. Scaling out the database is a matter of putting more boxes in the data center, nothing truly complex. Scaling the read portion is a good place for judicious use of caching, but the model lends itself well for that.&#xA;&#xA;Now, feel free to tell me what I am off the hook...</p>
        </article>
        <article id="article-6778">
            <a href="https://ayende.com/blog/3345/painless-persistence-with-castle-active-record" target="_blank">
                <h2 class="title mb-6" id="article-6778">Painless Persistence with Castle Active Record</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 03, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">About a year ago me and Hammett gave a few talks about Castle in JAOO. I am not sure why the recording of the talk came up now, but it have.  You can watch this presentation here: http://www.infoq.com/presentations/eini-verissimo-castle-active-record  For all the people who wanted to see a video of one of my presentation, there you go.</p>
        </article>
        <article id="article-6779">
            <a href="https://ayende.com/blog/3344/bug-hunting-story" target="_blank">
                <h2 class="title mb-6" id="article-6779">Bug Hunting Story</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 03, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The bug: SvnBridge will not accept a change to a filename using multi byte format.  Let us start figuring out what is going on, shall we?  Hm... looks like when TortoiseSVN is PUT-ing the file, it uses the directory name instead of the actual file name. Obviously, this is a client bug, and I can close this bug and move on to doing other things. Except that I am pretty sure that SVN can handle non ASCII characters...  Let us compare the network trace from SVN and SvnBridge and see what is going on...  Oh, I got the problem. TortoiseSVN is requesting a CHECKOUT, and we return the wrong URL. Obviously I did something astoundingly stupid there when I processed that request. Indeed, taking a look at what is going on there is... interesting.  Finally I realize that the problem is that while TortoiseSVN sends the URL in seemingly reasonable format, it is obviously being read wrongly by SvnBridge. It is using ASCII encoding to read this, while it probably should use UTF8. Because of that, the URL looks something like /tfsrtm08/test/????.txt, and ? is the query string terminator, no wonder I have issues.  But, how does it work for standard SVN servers. Hm, looks like when TortoiseSVN uses Url Encoding for the URL when taking to a standard SVN server. Why is it doing this?   Hm... looks like the URL that TortoiseSVN uses when it is request a CHECKOUT is the one that is returned in the response to a PROPFIND request.  Sure, that is easy to fix, we will just Url Encode the response from the PROPFIND handler.  Except that it doesn&#x27;t work...  Oh, we also handle some of that in the file node class, so we will fix it there.  Yeah!  Except that it still doesn&#x27;t work!  Grr! Looks like the way we handle Url Encoding is too invasive, we need to only UrlEncode non ASCII characters, this means that we should not encode characters such as &#x27;/&#x27;, for example.  Let us try this again, shall we?  Hm... it still doesn&#x27;t work. What is going on.  Excuse me while I am having a nervous breakdown, please.  Oh! When we send the response to the CHECKOUT request, we send the URL for the PUT request in the location header, and we haven&#x27;t Url Encoded that yet.  And now it works... :-D  Let us run the test and commit...  We have a broken test.  *Sob*  Well, okay, that is actually a test that is supposed to be broken (it is testing the way we Url Encode urls, after all).  Number of code lines changed, less than 20.  Number of hours spent of this bug: over eight hours.  Conclusion, I am not really being productive today. I am off to visit the code generation wizard...</p>
        </article>
        <article id="article-6780">
            <a href="https://ardalis.com/customer-service-is-key/" target="_blank">
                <h2 class="title mb-6" id="article-6780">Customer Service Is Key</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 02, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A few months ago I went to MIX08, which was I must say an excellent conference with a very different focus from DevConnections, TechEd, and&#x2026;Keep Reading &#x2192;</p>
        </article>
        <div class="button flex justify-between">
            <a href="677.html"><span class="back arrow"></span></a>

            <a href="679.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>