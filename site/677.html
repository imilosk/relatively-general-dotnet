
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 677 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-6761">
            <a href="https://ardalis.com/batch-javascript-libraries-for-increased-performance/" target="_blank">
                <h2 class="title mb-6" id="article-6761">Batch JavaScript Libraries for Increased Performance</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 28, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x2019;ve been meaning to set up batched loading of the JavaScript libraries used by Lake Quincy Media&#x2019;s administration application for some time&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-6762">
            <a href="https://ayende.com/blog/3458/some-finalizer-pitfalls" target="_blank">
                <h2 class="title mb-6" id="article-6762">Some finalizer pitfalls</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 28, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The use of finalizer to ensure eventual release of resources is recommended, but one thing that is not discussed often is the implications of adding a finalizer.  No, I am not talking about the extra wait time before the class memory is released, this is fairly well known. I am talking about two major additional issues that don&#x27;t get enough attention, in my opinion.  Specifically, invalid instances and threading.   An object that has a finalizer will may be executed in more than one thread. Luckily, the CLR ensure that our finalizer will not be able to run if there is any code that is using the class, so it is not as bad as it seems at first.   However, something that make absolute sense was a bit of a surprise to me, when I figured it out, finalizers will run for invalid instances as well. What do I mean by that? Invalid instance is an object whose ctor threw an exception. It is in invalid state.  But, before it threw an exception, it might have acquired resources that needs to be released, so it goes to the GC finalizer as well. In fact, since you can&#x27;t call Dispose on such an object, it must go to the finalizers for cleanup.   Remember the invalid state bit part? This is important!  Your object is in invalid state, and it is asked to cleanup itself. If it can&#x27;t do so even in invalid state, an exception will be thrown. This exception on the finalizer thread will kill the application.  Here is the proof of concept code:     public class BadClass : IDisposable&#xA;{&#xA;&#x9;FileStream fs;&#xA;&#xA;&#x9;public BadClass(int i)&#xA;&#x9;{&#xA;&#x9;&#x9;if (i%2 == 0)&#xA;&#x9;&#x9;&#x9;throw new InvalidDataException(&quot;evens are bad for your health&quot;);&#xA;&#x9;&#x9;fs = new FileStream(Path.GetTempFileName(), FileMode.Create);&#xA;&#x9;}&#xA;&#xA;&#x9;~BadClass()&#xA;&#x9;{&#xA;&#x9;&#x9;fs.Dispose();&#xA;&#x9;}&#xA;&#xA;&#x9;public void Dispose()&#xA;&#x9;{&#xA;&#x9;&#x9;fs.Dispose();&#xA;&#x9;&#x9;GC.SuppressFinalize(this);&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;And the code to execute it:&#xA;&#xA;&#xA;  for (int i = 0; i &lt; 1000; i&#x2B;&#x2B;)&#xA;{&#xA;&#x9;try&#xA;&#x9;{&#xA;&#x9;&#x9;using (new BadClass(i))&#xA;&#x9;&#x9;{&#xA;&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;&#x9;catch (Exception)&#xA;&#x9;{&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;Trying to figure out what is going on in this scenario is tough. Going back to the threaded aspect of it. What this means is that such an object is a time bomb, and it will blow up at some future date to kill your application, but you are not likely to know what exactly caused it to be this way.&#xA;&#xA;In my situation, I figured it out by putting new StackTrace(true) in the constructor of the object, and breaking into the debugger on the finalizer.&#xA0; But until it occurred to me to look for it there...</p>
        </article>
        <article id="article-6763">
            <a href="https://ayende.com/blog/3457/challenge-what-does-this-code-do" target="_blank">
                <h2 class="title mb-6" id="article-6763">Challenge</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 28, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Without compiling this, can you answer me whatever this piece of code will compile? And if so, what does it do?      var dummyVariable1 = 1;&#xA;var dummyVariable2 = 3;&#xA;var a = dummyVariable1&#x2B;-&#x2B;-&#x2B;-&#x2B;-&#x2B; &#x2B; &#x2B; &#x2B; &#x2B; &#x2B; &#x2B;-&#x2B;-&#x2B;-&#x2B;-&#x2B;-&#x2B; &#x9;dummyVariable2;&#xA;&#xA;&#xA;Oh, and I want to hear reasons, too.</p>
        </article>
        <article id="article-6764">
            <a href="https://ayende.com/blog/3456/code-critique-transactional-file" target="_blank">
                <h2 class="title mb-6" id="article-6764">Code Critique: Transactional File</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 27, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Update: To clarify, the only purpose of this code is to give atomic writes, it either complete successfully or it is rolled back.   Okay, this looks like it is too simple to work, thoughts?     /// &lt;summary&gt;&#xA;/// Allow to overwrite a file in a transactional manner.&#xA;/// That is, either we completely succeed or completely fail in writing to the file.&#xA;/// Read will correct previous failed transaction if a previous write has failed.&#xA;/// Assumptions:&#xA;///  * You want to always rewrite the file, rathar than edit it.&#xA;///  * The underlying file system has at least transactional metadata.&#xA;///  * Thread safety is provided by the calling code.&#xA;/// &#xA;/// Write implementation:&#xA;///  - Rename file to &quot;[file].old_copy&quot; (overwrite if needed&#xA;///  - Create new file stream with the file name and pass it to the client&#xA;///  - After client is done, flush &amp; close the stream&#xA;///  - Delete old file&#xA;/// &#xA;/// Read implementation:&#xA;///  - If old file exists, remove new file and rename old file&#xA;/// &#xA;/// &lt;/summary&gt;&#xA;public static class TransactionalFile&#xA;{&#xA;&#x9;public static void Read(string name, Action&lt;Stream&gt; action)&#xA;&#x9;{&#xA;&#x9;&#x9;if (File.Exists(name &#x2B; &quot;.old_copy&quot;))&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;File.Delete(name);&#xA;&#x9;&#x9;&#x9;File.Move(name &#x2B; &quot;.old_copy&quot;, name);&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;using (&#xA;&#x9;&#x9;&#x9;var stream = new FileStream(name, FileMode.Open, FileAccess.Read, FileShare.None, 0x1000,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FileOptions.SequentialScan))&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;action(stream);&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;&#xA;&#x9;public static void Write(string name, Action&lt;Stream&gt; action)&#xA;&#x9;{&#xA;&#x9;&#x9;File.Delete(name &#x2B; &quot;.old_copy&quot;);&#xA;&#xA;&#x9;&#x9;if (File.Exists(name))&#xA;&#x9;&#x9;&#x9;File.Move(name, name &#x2B; &quot;.old_copy&quot;);&#xA;&#xA;&#x9;&#x9;using (&#xA;&#x9;&#x9;&#x9;var stream = new FileStream(name, FileMode.CreateNew, FileAccess.Write, FileShare.None, 0x1000,&#xA;&#x9;&#x9;&#x9;                            FileOptions.WriteThrough | FileOptions.SequentialScan))&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;action(stream);&#xA;&#x9;&#x9;&#x9;stream.Flush();&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;File.Delete(name &#x2B; &quot;.old_copy&quot;);&#xA;&#x9;}&#xA;}</p>
        </article>
        <article id="article-6765">
            <a href="https://ayende.com/blog/3455/the-exception-i-hate-the-most" target="_blank">
                <h2 class="title mb-6" id="article-6765">The exception I hate the most</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 27, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">And just for fun, it is reproducable if you run 824 tests, but not if you run a single test!     Update: Found the guilty test, and it is one that used to work, damn it!</p>
        </article>
        <article id="article-6766">
            <a href="https://ayende.com/blog/3454/high-performant-way-for-waking-really-fast" target="_blank">
                <h2 class="title mb-6" id="article-6766">High performant way for waking REALLY fast</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 27, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Precondition: Extremely sleepy.&#xA;Solution: Go to a coffee shop, order their strongest coffee, add lots of sugar. Go to the table and take a sip. Spill the coffee on top of the hideously expensive MacBook Pro.&#xA;Result: Instant wakefulness.&#xA;The MBP seems fine, and I am using it to type this, but that was a big scare.</p>
        </article>
        <article id="article-6767">
            <a href="https://ayende.com/blog/3453/the-sewer-architecture" target="_blank">
                <h2 class="title mb-6" id="article-6767">The Sewer Architecture</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 27, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">On Friday, I had an encounter with the sewers at my house. On Call team has came and fixed the issue, which was a plugged pipe somewhere down the street very fast, so no harm was done (although checking the sewers just after taking a shower is not my idea of fun).  That did, however, let me learn a bit about the way sewers are constructed.  Broadly, the sewer is based on the idea of pipes and pools ( at least, those are the Hebrew terms, translated ). The idea is that the sewer flows in the pipes, toward where ever it goes. But if we have the pipes, why do we need the pools as well?  The pools are there for capacity control. They help to ensure that even if there is increase demand for the sewer, it won&#x27;t back fire on you (literally, yuck!) when used.  If the downstream pipe cannot accept the sewer that we have locally, it is gathered in the pool, and will trickle downstream based on whatever &quot;bandwidth&quot; it will get.  Usually, you have several such pools, each of which can take quite a bit of sewer water, so you tend not to have issues with the sewer unless it is a real problem. Reduced capacity for the sewer is not noticed, because the pools absorbe the spike in usage and moderate it.  In my house, we had the following issue:     &#xA0;  Three pools down from the actual drain (about 100 meters from my house, actually), we finally found the culprit, a semi plugged pipe that wasn&#x27;t draining properly. The interesting thing here is that it is likely that it wasn&#x27;t functioning correctly for a long time (weeks, at least).   Now, last I checked, this blog was mainly technical stuff, and while I am sure that there are Sewer Geek somewhere, I am not part of that particular subculture. Why am I telling you that?  Because there are a lot of parallels with software. Specifically, with building software that can withstand the harsh environment called production. The idea of pools for the sewers closely match the idea of queued messaging for communication, for example.  And I have seen application survive any number of transient failures as a result of this type of architecture.  So, this was a trip in the sewers, hope you held your noses.</p>
        </article>
        <article id="article-6768">
            <a href="https://ayende.com/blog/3452/no-testing-no-software" target="_blank">
                <h2 class="title mb-6" id="article-6768">No testing, no software</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 27, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just tried to spike something, and as usual, I created a console app and started hacking.  It is a non trivial spike, so I started refactoring it to allow proper separation and actually let me handle the complexity that I am trying to contain.  I couldn&#x27;t continue the spike. Literally. I had no idea how to go about it.  I am currently in the process of moving the spike code into a proper environment, one that has tests, so I can actually work in small increment, and not try to implement the whole thing in a single go.  About an hour later, I have this mostly complete and working, and I can see how the tests helped me get into a situation where I can actually make a small set of changes are get things working.</p>
        </article>
        <article id="article-6769">
            <a href="https://ayende.com/blog/3451/mocking-the-file-system" target="_blank">
                <h2 class="title mb-6" id="article-6769">Mocking the file system</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 27, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I have the following piece of code:     And I wasn&#x27;t sure about how I can test this thing. For production, this will use a File Stream, and getting those to produce errors is non trivial in most situations. A bit of thinking, however, told me that I can write a test for the error handling section of this fairly easily, like this:  &#xA0;     I love having powerful tools at my reach.</p>
        </article>
        <article id="article-6770">
            <a href="https://ayende.com/blog/3450/testing-interleaved-async-file-writing" target="_blank">
                <h2 class="title mb-6" id="article-6770">Testing interleaved async file writing</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 26, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Here is another interesting aspect that I run into when thinking about writing to files. What will happen if I start two async write operations? Will they get interleaved? Will they get interleaved? Will I get errors when using this?  Here is using a single stream:     var path = &quot;test.txt&quot;;&#xA;&#xA;if (File.Exists(path))&#xA;&#x9;File.Delete(path);&#xA;&#xA;var handles = new List&lt;WaitHandle&gt;();&#xA;using (&#xA;&#x9;var stream = new FileStream(path, FileMode.CreateNew, FileAccess.Write, FileShare.None, 0x1000,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; FileOptions.Asynchronous))&#xA;{&#xA;&#x9;for (int i = 0; i &lt; 64; i&#x2B;&#x2B;)&#xA;&#x9;{&#xA;&#x9;&#x9;var handle = new ManualResetEvent(false);&#xA;&#x9;&#x9;var bytes = Encoding.UTF8.GetBytes( i &#x2B; Environment.NewLine);&#xA;&#x9;&#x9;stream.BeginWrite(bytes, 0, bytes.Length, delegate(IAsyncResult ar)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;stream.EndWrite(ar);&#xA;&#x9;&#x9;&#x9;handle.Set();&#xA;&#x9;&#x9;}, stream);&#xA;&#x9;&#x9;handles.Add(handle);&#xA;&#x9;}&#xA;&#x9;WaitHandle.WaitAll(handles.ToArray());&#xA;&#x9;stream.Flush();&#xA;&#xA;}&#xA;&#xA;&#xA;This worked perfectly, the writes are written in a sequential manner, with no interleaving.&#xA;&#xA;The situation changes somewhat when we work with several streams, instead. Here is the code:&#xA;&#xA;&#xA;  var path = &quot;test.txt&quot;;&#xA;&#xA;if (File.Exists(path))&#xA;&#x9;File.Delete(path);&#xA;&#xA;var handles = new List&lt;WaitHandle&gt;();&#xA;&#xA;for (int i = 0; i &lt; 64; i&#x2B;&#x2B;)&#xA;{&#xA;&#x9;var stream = new FileStream(path, FileMode.OpenOrCreate, FileAccess.Write, FileShare.ReadWrite, 0x1000,&#xA;&#x9;                            FileOptions.Asynchronous);&#xA;&#x9;var handle = new ManualResetEvent(false);&#xA;&#x9;var bytes = Encoding.UTF8.GetBytes(i &#x2B; Environment.NewLine);&#xA;&#x9;stream.BeginWrite(bytes, 0, bytes.Length, delegate(IAsyncResult ar)&#xA;&#x9;{&#xA;&#x9;&#x9;stream.EndWrite(ar);&#xA;&#x9;&#x9;stream.Flush();&#xA;&#x9;&#x9;stream.Dispose();&#xA;&#x9;&#x9;handle.Set();&#xA;&#x9;}, stream);&#xA;&#x9;handles.Add(handle);&#xA;}&#xA;WaitHandle.WaitAll(handles.ToArray());&#xA;&#xA;&#xA;The output of this code on my machine is: 63&#xA;&#xA;Although I am pretty sure that it is possible to get other things as well.&#xA0; But considering that the way IO operations work in generate ( Write( position, buffer) ), that makes a lot of sense. &#xA;&#xA;Interestingly, in regards to the single stream version, the documentation states:&#xA;&#xA;&#xA;  Multiple simultaneous asynchronous requests render the request completion order uncertain.&#xA;&#xA;&#xA;It doesn&#x27;t say anything about the actual write order, however, the completion order is not an issue, as far as I am concerned, but the order of the data on disk is very important.&#xA;&#xA;Another interesting question was how a single file stream work with multiple threads calling BeginWrite in parallel. Here is the code:&#xA;&#xA;&#xA;  var path = &quot;test.txt&quot;;&#xA;&#xA;if (File.Exists(path))&#xA;&#x9;File.Delete(path);&#xA;&#xA;var handles = new List&lt;WaitHandle&gt;();&#xA;using (&#xA;&#x9;var stream = new FileStream(path, FileMode.CreateNew, FileAccess.Write, FileShare.None, 0x1000,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; FileOptions.Asynchronous))&#xA;{&#xA;&#x9;for (int i = 0; i &lt; 64; i&#x2B;&#x2B;)&#xA;&#x9;{&#xA;&#x9;&#x9;var handle = new ManualResetEvent(false);&#xA;&#x9;&#x9;var bytes = Encoding.UTF8.GetBytes(i &#x2B; Environment.NewLine);&#xA;&#x9;&#x9;ThreadPool.QueueUserWorkItem(delegate&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;Thread.Sleep(10);&#xA;&#x9;&#x9;&#x9;stream.BeginWrite(bytes, 0, bytes.Length, delegate(IAsyncResult ar)&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;stream.EndWrite(ar);&#xA;&#x9;&#x9;&#x9;&#x9;handle.Set();&#xA;&#x9;&#x9;&#x9;}, stream);&#xA;&#x9;&#x9;});&#xA;&#x9;&#x9;handles.Add(handle);&#xA;&#x9;}&#xA;&#x9;WaitHandle.WaitAll(handles.ToArray());&#xA;&#x9;stream.Flush();&#xA;&#xA;}&#xA;&#xA;&#xA;The result of this code looks like this:&#xA;&#xA; &#xA;&#xA;Obviously, we have a race condition with the known position of the stream. Adding a lock for the stream.BeginWrite results in this:&#xA;&#xA; &#xA;&#xA;I am actually fine with this, because as far as I can tell, this might very well be the actual execution order.&#xA;&#xA;Another observation that is very important is the fact that the Position property of the stream is update immediately when you can BeginWrite(). &#xA;&#xA;That was a somewhat random walk over the BeginWrite implementation, I admit, but I hope it will make sense soon.</p>
        </article>
        <div class="button flex justify-between">
            <a href="676.html"><span class="back arrow"></span></a>

            <a href="678.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;🚀&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
