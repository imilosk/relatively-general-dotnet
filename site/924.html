
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Home â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main">
    <section aria-label="Blog post list">
        <a href="https://ayende.com/blog/1070/castle-demo-app-monorail-at-a-glance" target="_blank"><h1 class="title mb-6">Castle Demo App</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 20, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Okay, so far we saw that MonoRail can be used to serve static files just as well as a 1993 Gopher Server. Considerring that Gopher is dead, we might want to add some stuff to our application. But allow me to give you a very short overview of the way MonoRail works.     MonoRail has Controllers and Views. A controller is a normal class that inherit from the Castle.MonoRail.Framework.Controller class. When a request comes in, MonoRail analyze the URL and dispatch the request to the proper controller method. This is important, unlike in ASP.Net web forms, where the smallest piece you handle was the Page, here the smallest piece is a controller&#x27;s method. This has various implications on the way you structure you application, but we will touch those a little later.     Controllers are usually named [DescriptiveName]Controller, and any public method without parameters is an action. In the case of our previous example, the HomeController.Default action matched the /home/default.rails URL. Later we&#x27;ll see how to use parameterized method and databinding to     Views are used to show information to the user, there is usually one to one match between a view and an action, although several actions can use the same view (or a single action can use several views). The file path of a view is significant, since this is used to match the action to the view. So the view for the HomeController.Default action is: &quot;Views/Home/Default.boo&quot;.     Okay, that is enough theory for now, I think. Let&#x27;s see what we can do with this information. Our goal now is to show the user a list of projects. Because currently the database is empty, we will manually populate it with dummy data, so we can see the results of our actions. Here is the script to create the data:             --Cleaning things that may have remained from our tests earlier                        DELETE FROM UsersProjects                        DELETE FROM Bugs                        DELETE FROM Projects                        DELETE FROM Users                                &#xA0;                        DECLARE @UserID int                                &#xA0;                        INSERT INTO Users                        SELECT &#x27;Dummy&#x27;,&#x27;Dummy@Foo.com&#x27;,&#x27;Unhashed password&#x27;                                &#xA0;                        SELECT @UserId = SCOPE_IDENTITY()                                &#xA0;                        INSERT INTO Projects                        SELECT &#x27;Default Project&#x27;,@UserID                                &#xA0;                        INSERT INTO Projects                        SELECT &#x27;Second Project&#x27;,@UserID         Now we can have something real.     We&#x27;ll start by adding&#xA0;the following references:             MythicalBugTracker.Model                 Castle.ActiveRecord.dll                 NHibernate.dll         Add the following the HomeController&#x27;s Default method:              &#xA0;&#xA0;&#xA0; public void Default()                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Project[] projects = Project.FindAll();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; PropertyBag.Add(&quot;Projects&quot;, projects);                        &#xA0;&#xA0;&#xA0; }             Edit the Views\Home\Default.boo file so it will look like this:             &lt;p&gt;Projects:&lt;/p&gt;                        &lt;ul&gt;                        &lt;%                        &#xA0;&#xA0;&#xA0;&#xA0; for project in Projects:                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; output &quot;&lt;li&gt;${project.Name}&lt;/li&gt;&quot;                                 %&gt;                        &lt;/il&gt;         We need to add the Active Record configuration to the web.config file. Add the following line to the &lt;configSections&gt; node:             &lt;section name=&quot;activerecord&quot;                        &#xA0;&#xA0;&#xA0;&#xA0; type=&quot;Castle.ActiveRecord.Framework.Config.ActiveRecordSectionHandler, Castle.ActiveRecord&quot; /&gt;         Add the Active Record and Connection String information:             &lt;connectionStrings&gt;                        &#xA0;&#xA0;&#xA0;&#xA0; &lt;add name=&quot;MythicalBugsTracker&quot; connectionString=&quot;Data Source=.\SQLEXPRESS;AttachDbFilename=C:\MythicalBugTracker\Data\MythicalBugTracker.mdf;Integrated Security=True;&quot;/&gt;                        &lt;/connectionStrings&gt;                                &#xA0;                        &lt;activerecord isWeb=&quot;true&quot;&gt;                        &#xA0;&#xA0;&#xA0;&#xA0; &lt;config&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;add key=&quot;hibernate.connection.driver_class&quot; value=&quot;NHibernate.Driver.SqlClientDriver&quot; /&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;add key=&quot;hibernate.dialect&quot;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; value=&quot;NHibernate.Dialect.MsSql2000Dialect&quot; /&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;add key=&quot;hibernate.connection.provider&quot;&#xA0;&#xA0;&#xA0;&#xA0; value=&quot;NHibernate.Connection.DriverConnectionProvider&quot; /&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;add key=&quot;hibernate.connection.connection_string&quot; value=&quot;ConnectionString = ${MythicalBugsTracker}&quot; /&gt;                        &#xA0;&#xA0;&#xA0;&#xA0; &lt;/config&gt;                        &lt;/activerecord&gt;         Important: Notice that we set the isWeb attribute to true. This is needed so&#xA0;Active Record would store its state properly. Failing to do these could cause random failures, especially under load.     We are almost set to go, now we just need to initalize Active Record, we do this by adding global.asax file and putting the initalization in the Application_Start event:             &lt;%@ Application Language=&quot;C#&quot; %&gt;                                &#xA0;                        &lt;script runat=&quot;server&quot;&gt;                        &#xA0;&#xA0;&#xA0;                                 &#xA0;&#xA0;&#xA0; void Application_Start(object sender, EventArgs e)                                 &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Castle.ActiveRecord.Framework.IConfigurationSource source =                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;System.Configuration.ConfigurationManager.GetSection(&quot;activerecord&quot;) as        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;Castle.ActiveRecord.Framework.IConfigurationSource;                                &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Castle.ActiveRecord.ActiveRecordStarter.Initialize(        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; typeof(MythicalBugTracker.Model.User).Assembly,&#xA0;        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;source);                        &#xA0;&#xA0;&#xA0; }                        &lt;/script&gt;         Now we can go to http://localhost:8080/Home/default.rails&#xA0;again, and see what kind of monster we created. Here is the result:             Projects:                             Default Project                             Second Project                 It&#x27;s still not an enterprise ready web site, but we made some steps away from gopher fame.</p>
        <a href="https://ayende.com/blog/1069/castle-demo-app-the-first-monorail-page" target="_blank"><h1 class="title mb-6">Castle Demo App</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 20, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">So we finally made it to actually talk about MonoRail. :-) Just to set the expectations straight, we are going to create a web site for to&#xA0;the Mythical Bug Tracker application, using MonoRail and Brail. It&#x27;s going be functional, but it is not going to look pretty. I&#x27;m not a designer, and I&#x27;m not going to waste my time talking about CSS and color coordination when you can go to someone who actually knows something about them and learn something useful.     In two sentences, what is MonoRail?     MonoRail is a Model - View - Controller framework for ASP.Net applications. It replaces the WebForms model, and simplify development by quite a bit. MonoRail encourages complete seperation of business logic and UI logic. To render the pages, MonoRail uses View Engines, one of those ViewEngines is called NVelocity, and it is a port of the Velocity project from Java. The second View Engine is called Brail and it was written by me, so I think you can guess what we&#x27;re going to be working with now :-) You can go here&#xA0;for a more objective comparisson of the view engines.     Before we start, we need to create a new class library project called MythicalBugTracker.Web. Add the following references:             Castle.MonoRail.Framework.dll                 Castle.MonoRail.Views.Brail.dll                 Boo.Lang.dll                 Boo.Lang.Compiler.dll                 Boo.Lang.Parser.dll                 Castle.Components.Common.EmailSender.dll                 Castle.Components.Common.EmailSender.SmtpEmailSender.dll         Add a web.config file with the following information:             &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;                        &lt;configuration&gt;                        &#xA0; &lt;configSections&gt;                        &#xA0;&#xA0;&#xA0; &lt;section name=&quot;monoRail&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; type =&quot;Castle.MonoRail.Framework.Configuration.MonoRailSectionHandler, Castle.MonoRail.Framework&quot;/&gt;                        &#xA0; &lt;/configSections&gt;                                &#xA0;                        &#xA0; &lt;monoRail&gt;                        &#xA0;&#xA0;&#xA0; &lt;controllers&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;assembly&gt;MythicalBugTracker.Web&lt;/assembly&gt;                        &#xA0;&#xA0;&#xA0; &lt;/controllers&gt;                        &#xA0;&#xA0;&#xA0; &lt;viewEngine viewPathRoot=&quot;Views&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; customEngine=&quot;Castle.MonoRail.Views.Brail.BooViewEngine, Castle.MonoRail.Views.Brail&quot;/&gt;                        &#xA0; &lt;/monoRail&gt;                                &#xA0;                        &#xA0; &lt;system.web&gt;                        &#xA0;&#xA0;&#xA0; &lt;httpHandlers&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;add verb=&quot;*&quot; path=&quot;*.rails&quot;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; type=&quot;Castle.MonoRail.Framework.MonoRailHttpHandlerFactory, Castle.MonoRail.Framework&quot;/&gt;                        &#xA0;&#xA0;&#xA0; &lt;/httpHandlers&gt;                             &#xA0;&#xA0;&#xA0; &lt;httpModules&gt;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;add name=&quot;monorail&quot; type=&quot;Castle.MonoRail.Framework.EngineContextModule, Castle.MonoRail.Framework&quot; /&gt;                        &#xA0;&#xA0;&#xA0; &lt;/httpModules&gt;                &#xA0; &lt;/system.web&gt;                                &#xA0;                        &lt;/configuration&gt;         We define MonoRail, the controllers assembly and&#xA0;the view engine. We also mapped the &quot;.rails&quot; extention to MonoRail. I promise that it will all be much clearer in a couple of minutes, but basically we just tell the ASP.Net runtime to use MonoRail for processing request, and we configure MonoRail with the appropriate parameters.     Now we need to setup the project so we can execute it, this require a bit of tinkering with the project&#x27;s settings:             Go to MythicalBugTracker.Web properties &gt; Build and change the Output Path to &quot;bin\&quot; only.                 Go to MythicalBugTracker.Web properties &gt; Debug                 Select &quot;Start External Program&quot; and put &quot;C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\WebDev.WebServer.exe&quot; in the text box.                 In the &quot;Command line arguments&quot;, put the this: &quot;/port:8080&quot; &quot;/path:F:\MythicalBugTracker\MythicalBugTracker.Web&quot;         This is just manually configuring the ASP.Net Development Server to run when we run out project, and making sure that the compiled output of the assembly is in the bin directory, where the ASP.Net Development Server expects it. One thing to note if you try to run this on IIS, make sure that you&#x27;ve mapped the &quot;.rails&quot; extention to the asp_net ISAPI filter, otherwise it will not work.     We&#x27;re nearly done with the setup, now all we need is to create the following directories in our project:             Controllers                 Views         It&#x27;s a bit of a setup, but there is a MonoRail integration package for VS.Net that makes it all automatic. (I&#x27;m working with a newer build than the one the integration was built against, which is why I&#x27;m doing everything manually.).     Now we can start writing code, we&#x27;ll start by create a HomeController class on the Controllers directory, here is the entire class defination:             public class HomeController : Controller                        {                        &#xA0;&#xA0;&#xA0; public void Default()                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0; }                        }         Now, create a folder called &quot;Home&quot; in the Views folder, and create a file called &quot;Default.boo&quot; with the following text:              I thought I would get some real content here!             (And they tell me I&#x27;m not funny, Huh!)     Press Ctrl&#x2B;F5 and point your browser to: http://localhost:8080/Home/default.rails     Okay, so we could do it more easily if we were using plain old HTML, but now we know that we have the environment setup correctly, we can move on to slightly more complicated things.</p>
        <a href="https://ayende.com/blog/1068/found-vs-net-filesystemwatcher-problem" target="_blank"><h1 class="title mb-6">Found VS.Net &amp; FileSystemWatcher problem</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 20, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Like I said, I had a problem with the FileSystemWatcher not picking up the changes that VS.Net was doing.&#xA;Justin suggested&#xA0;playing with the NotifyFilter property, and it worked! The issue turned out to be that VS.Net doesn&#x27;t write to the file, but rather copy a temporary file that it keeps on the side over the file. All I had to do was to add the NotifyFilters.CreationTime and it worked.&#xA;I noticed the problem while working with Brail, and I&#x27;ll commit the stuff tonight. It does mean that to be able to really play with my Castle Demo App, you&#x27;ll need to use the latest revision of Castle (but that is always a good thing :-) ).</p>
        <a href="https://ayende.com/blog/1067/price-of-indirection" target="_blank"><h1 class="title mb-6">Price of Indirection</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 20, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">How goes that old saying? &#xA;Anything in computers can be solved by adding another layer of indirection, except too many levels of indirection.&#xA;I find myself contemplating that a lot lately. I&#x27;m fighting performace troubles quite a bit lately. And right now my pet devil is this creature and its friends:&#xA;CREATE VIEW LastBusinessDayTransactions&#xA;AS&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SELECT * FROM Transactions&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHERE TransactionDate = (SELECT max(TradeDate) FROM TradeDates&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHERE TradeDate &lt; (SELECT max(TradeDate) FROM TradeDates))&#xA;&#xA;This is supposed to be a view that will return the transactions from the lats business days (assuming that the max trade date is the current date).&#xA;The issue is that doing anything on this view is slow. Selecting isn&#x27;t bad, but inserting / updating is very slow. I&#x27;m pretty sure that it&#x27;s considered bad manners to update / insert to views, though.&#xA;What interest me is that even selecting speed can be significantly improved by pre-calculating the last trade date value outside the select statement. So far I haven&#x27;t found a way to do this using a view (and it has got to stay a view, unfortantely.</p>
        <a href="https://ayende.com/blog/1066/filesystemwatcher-visual-studio-2005" target="_blank"><h1 class="title mb-6">FileSystemWatcher &amp; Visual Studio 2005</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 20, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Okay, I&#x27;ve this very strange bug. I got an application that watch over a folder for changes in the files. When I edit the files in Visual Studio 2005, the application doesn&#x27;t do anything. But when I edit the file in notepad, the change event is fired and everything is fine. Anyone knows what is going on there?&#xA;Here is sample code the shows the problem:&#xA;&#xA;&#xA;import System&#xA;&#xA;import System.IO&#xA;&#xA;&#xA0;&#xA;&#xA;class Bug:&#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; watch as FileSystemWatcher&#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; &#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; def StartWatching():&#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; watcher = FileSystemWatcher(&quot;&quot;&quot;C:\Test&quot;&quot;&quot;, Filter: &quot;*.*&quot;)&#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; watcher.Changed &#x2B;= def(source, e as FileSystemEventArgs):&#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; print &quot;${e.FullName} has changed ${DateTime.Now}&quot;&#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; watcher.EnableRaisingEvents = true;&#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; print &quot;Watching...&quot;&#xA;&#xA;&#xA0;&#xA;&#xA;Bug().StartWatching.BeginInvoke()&#xA;&#xA;&#xA0;&#xA;&#xA;Console.Read()</p>
        <a href="https://ayende.com/blog/1065/i-made-it-into-the-polish-wikipedia" target="_blank"><h1 class="title mb-6">I made it into the Polish Wikipedia</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 20, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x27;m not sure how, but I&#x27;m on the Polish Wikipedia (at least I think that PL is polish).&#xA;Anyone can translate what is said there?&#xA;Update: It would be nice if I provided a link, wouldn&#x27;t it? I could&#x27;ve swore that I did so. Opps.&#xA;Here is the link.&#xA;Thanks to Matthijs&#xA0;for noticing.</p>
        <a href="https://ayende.com/blog/1064/castle-demo-app-many-to-many-relations" target="_blank"><h1 class="title mb-6">Castle Demo App</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 19, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We have users and we have bugs, but it is still not enough to create a good application, we need to group the bugs to projects, and we need to be able to assign users to projects. So, without further ado, let&#x2019;s write the Project class.     What do we need to have in a project? The project name, the default assignee (remember that all bugs are assigned always.), the bugs in the project and the users working on it. With that said, let&#x2019;s start with building a simple Project class.              [ActiveRecord(&quot;Projects&quot;)]        public class Project : ActiveRecordBase&lt;Project&gt;             We define the class as usual, with an [ActiveRecord] attribute pointing to the Projects table and inheriting from ActiveRecordBase&lt;T&gt;.                                            &#xA0;&#xA0;&#xA0; [PrimaryKey(PrimaryKeyType.Identity,                        &#xA0;&#xA0;&#xA0;&#xA0; Access = PropertyAccess.NosetterCamelcaseUnderscore)]                        &#xA0;&#xA0;&#xA0; public int Id                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;get { return _id; }                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; [Property]                        &#xA0;&#xA0;&#xA0; public string Name                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _name; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { _name = value; }                        &#xA0;&#xA0;&#xA0; }        The Id and Name declarations we are already familiar with, so let&#x2019;s move to the more interesting stuff. A project has a relation of one to many to bugs. We&#x2019;ve already seen how we create one to many connections when we added the AssignedBugs and OpenBugs to the User class.            &#xA0;&#xA0;&#xA0; [HasMany(typeof(Bug), ColumnKey = &quot;Project&quot;, RelationType = RelationType.Set,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CustomAccess = &quot;NHibernate.Generics.GenericAccessor, NHibernate.Generics&quot;,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Lazy = true)]                        &#xA0;&#xA0;&#xA0; public EntitySet&lt;Bug&gt; Bugs                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _bugs; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { _bugs = value; }                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; [HasMany(typeof(Bug), ColumnKey = &quot;Project&quot;, RelationType = RelationType.Set,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CustomAccess = &quot;NHibernate.Generics.GenericAccessor, NHibernate.Generics&quot;,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Where = &quot;Status = 1&quot;, Lazy = true)]                        &#xA0;&#xA0;&#xA0; public EntitySet&lt;Bug&gt; OpenBugs                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _openBugs; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { _openBugs = value; }                        &#xA0;&#xA0;&#xA0; }        The only difference we have is that the ColumnKey is set to the Project column (which currently doesn&#x2019;t exist, we will create it in a couple of minutes.) We define another relation to the default assignee, like this:            &#xA0;&#xA0;&#xA0; [BelongsTo]                        &#xA0;&#xA0;&#xA0; public User DefaultAssignee                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _defaultAssignee.Value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { _defaultAssignee.Value = value; }                        &#xA0;&#xA0;&#xA0; }                        All the relations between the objects are using EntityRef&lt;T&gt; and EntitySet&lt;T&gt;, which are initialized in the constructor:            &#xA0;&#xA0;&#xA0; public Project()                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; _bugs = new EntitySet&lt;Bug&gt;(                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(Bug bug) { bug.Project = this; },                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(Bug bug) { bug.Project = null; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; );                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; _openBugs = new EntitySet&lt;Bug&gt;();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; _defaultAssignee = new EntityRef&lt;User&gt;();                        &#xA0;&#xA0;&#xA0; }        Note that the only collection with behavior is the _bugs collection, _OpenBugs and _defaultAssignee don&#x2019;t have actions associated with them (since we don&#x2019;t care about add/removing to the OpenBugs collection, and there is no reverse collection from the Default Assignee to the project. Now we only need to make the modifications to the Bug class.    First, we add an EntityRef&lt;Project&gt; variable, and initialize it in the constructor, notice that we pass two methods that will be executed when a project is set / replaced.            &#xA0;&#xA0;&#xA0; _project = new EntityRef&lt;Project&gt;(AddBugToProject, RemoveBugFromProject);        Those two methods are similar to the ones we defined for Users re-assignment:            &#xA0;&#xA0;&#xA0; private void AddBugToProject(Project project)                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.Bugs.Add(this);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (Status == BugStatus.Opened)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.OpenBugs.Add(this);                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; private void RemoveBugFromProject(Project project)                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.Bugs.Remove(this);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (Status == BugStatus.Opened)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.OpenBugs.Remove(this);                        &#xA0;&#xA0;&#xA0; }        As you recall, we would like to keep the objects and the database in sync, even across smart actions, so we make sure that status changes to the bug update the OpenBugs collection in the assigned user and in the parent project, since I started to get quite a bit of code in the property setter, I broke it into separate methods, here is how the Update Project Status method look like:            &#xA0;&#xA0;&#xA0; private void UpdateProjectStatus(BugStatus value)                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (Project != null) // during database load                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (_status == BugStatus.Opened)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Project.OpenBugs.Remove(this);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (value == BugStatus.Opened)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Project.OpenBugs.Add(this);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0; }                        Let&#x2019;s just fix the database schema so that it would match what we did so far, we&#x2019;ll start with the Projects table:                                            CREATE TABLE [dbo].[Projects](                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Id] [int] IDENTITY(1,1) NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Name] [nvarchar](255) COLLATE Hebrew_CI_AS NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [DefaultAssignee] [int] NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CONSTRAINT [PK_Projects] PRIMARY KEY CLUSTERED                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; (                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Id] ASC                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; )                        )                        Now we can update the Bugs table with the new relationship. Because we update an existing table, the process is a bit awkward:            ALTER TABLE [Bugs]                        ADD [Project] INT NULL                        GO                        INSERT INTO Projects(Name, DefaultAssignee)                        VALUES(&#x27;Default Project&#x27;, 1)                        GO                        UPDATE Bugs                        SET Project = 1                        GO                        ALTER TABLE [Bugs]                        ALTER COLUMN [Project] INT NOT NULL                        GO                        ALTER TABLE [dbo].[Bugs]&#xA0; WITH CHECK ADD&#xA0;                                 CONSTRAINT [FK_Bugs_Projects] FOREIGN KEY([Project])                        REFERENCES [dbo].[Projects] ([Id])                        GO                        As a sanity check, I wrote the following test:            &#xA0;&#xA0;&#xA0; [Test]                        &#xA0;&#xA0;&#xA0; public void ProjectBugs()                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User dar = new User(&quot;Dar&quot;, &quot;Fubar&quot;, &quot;Dar@bar.com&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; dar.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Project project = new Project(&quot;Test Project&quot;, dar);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Bug bug = new Bug(project, &quot;Nasty&quot;, &quot;Figure it out!&quot;, dar);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; bug.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, project.Bugs.Count);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, project.OpenBugs.Count);                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; using (new SessionScope())                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Project fromDb = Project.Find(project.Id);                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreNotSame(project, fromDb);                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, fromDb.Bugs.Count);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, fromDb.OpenBugs.Count);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0; }        As you can see, since the default mode of a bug is open, and since it is automatically added to the project on creation, we suddenly get an project bug as well as an open bug. The new SessionScope requires some explanation, though. The issue here is that Active Record is smart enough to realize that there is already an existing Project with the Id that I&#x27;m trying to load from the database, so what will happen if I won&#x27;t use the sessionScope is that I&#x27;ll get the same instance as I already has. This is very useful most of the time, but not when I&#x27;m testing that the instance I get from the database is valid. Because of this, I open a new SessionScope, and force Active Record to ignore the fact that it already has the object that I want in memory.    So far, we&#x2019;ve gone over much of the things we&#x2019;ve done before, it&#x2019;s time we will try something new. I mentioned that we need to be able to assign users to projects. Users can belong to multiply projects, and a project has mutliply users assigned to it. This means that we need to use a many to many connection between Users and Projects, let&#x27;s see how we implement that, shall we?    We&#x27;ll start by adding a Users property to the Project class, as usual, the field will be of type EntitySet&lt;User&gt;, but the property type will be ICollection&lt;User&gt; (EntitySet and EntityRef are implementation details):            &#xA0;&#xA0;&#xA0; [HasAndBelongsToMany(typeof(User),RelationType.Set,Table=&quot;UsersProjects&quot;,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CustomAccess = &quot;NHibernate.Generics.GenericAccessor, NHibernate.Generics&quot;,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ColumnKey=&quot;Project&quot;,ColumnRef=&quot;`User`&quot;,Lazy=true)]                        &#xA0;&#xA0;&#xA0; public ICollection&lt;User&gt; Users                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _users; }                        &#xA0;&#xA0;&#xA0; }        Okay, a couple of new things here. First, we have the HasAndBelongToMany, which is the way Active Record define many to many relationships, then we have the table that connects the objects. We already know what CustomAccess mean (needed to support the EntitySet / EntityRef). We need to pay attention to ColumnKey and ColumnRef. The ColumnKey specify which column refers to the primary key of the current project, and the ColumnRef specify which column refers to the primary key of the associated User.    It&#x27;s important to note that the User column in the ColumnRef is surrounded by backticks (the ` character, it&#x27;s not dirt on your screen, I assure you.), we need it to tell Active Record to wrap the calls to User with quotes (in SQL Server case, it&#x27;s sent as [User]).     Here is how we initialized the _users field:            &#xA0;&#xA0;&#xA0; _users = new EntitySet&lt;User&gt;(                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(User user) { user.Projects.Add(this); },                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(User user) { user.Projects.Remove(this); },                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; InitializeOnLazy.Always);        As usual, we pass delegates that handles the connection on the other side, but now we also pass a InitializeOnLazy.Always. Why do we need it? It&#x27;s needed because one side of the connection must be responsible for persisting the connection. I decided that the side responsible for this would be the Project, so we need to add this value to tell the EntitySet to threat it a little differently.    We define the connection on the other side in much the same way. Here is how the Projects property on the User class looks:            &#xA0;&#xA0;&#xA0; [HasAndBelongsToMany(typeof(Project), RelationType.Set, Table = &quot;UsersProjects&quot;,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CustomAccess = &quot;NHibernate.Generics.GenericAccessor, NHibernate.Generics&quot;,                        &#xA0;&#xA0;&#xA0;&#xA0; ColumnKey = &quot;`User`&quot;, ColumnRef = &quot;Project&quot;, Lazy = true, Inverse=true)]                        &#xA0;&#xA0;&#xA0; public ICollection&lt;Project&gt; Projects                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _projects; }                        &#xA0;&#xA0;&#xA0; }        As you can see, we need to reverse the ColumnKey and ColumnRef values. We still use backticks for the User column, since it&#x27;s reserved word in SQL Server. We also specify that the connection is the respnsibility of the other side by adding Inverse = true to the attribute. Initializing the _projects field is done as usual, and we don&#x27;t pass any special values to it:                                            &#xA0;&#xA0;&#xA0; _projects = new EntitySet&lt;Project&gt;(                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(Project project) { project.Users.Add(this); },                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(Project project) { project.Users.Remove(this); });        Now we can define the table UsersProjects, like this:            CREATE TABLE [dbo].[UsersProjects](                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Id] [int] IDENTITY(1,1) NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Project] [int] NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [User] [int] NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CONSTRAINT [PK_UsersProjects] PRIMARY KEY CLUSTERED                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; (                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Id] ASC                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; )                        )                                 GO                        ALTER TABLE [dbo].[UsersProjects]&#xA0; WITH CHECK ADD&#xA0;                                 CONSTRAINT [FK_UsersProjects_Projects] FOREIGN KEY([Project])                        REFERENCES [dbo].[Projects] ([Id])                        GO                        ALTER TABLE [dbo].[UsersProjects]&#xA0; WITH CHECK ADD&#xA0;                                 CONSTRAINT [FK_UsersProjects_Users] FOREIGN KEY([User])                        REFERENCES [dbo].[Users] ([Id])                        GO        This is it, we have a many to many relationship between users and projects. Now we can test that everything works:            &#xA0;&#xA0;&#xA0; [Test]                        &#xA0;&#xA0;&#xA0; public void ProjectsUsers()                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User dar = new User(&quot;Dar&quot;, &quot;Fubar&quot;, &quot;Dar@bar.com&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; dar.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User foo = new User(&quot;Foo&quot;, &quot;Bar&quot;, &quot;Foo@bar.org&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; foo.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Project project = new Project(&quot;Test Project&quot;, dar);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.Users.Add(foo);                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, foo.Projects.Count);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; using (new SessionScope())                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Project fromDb = Project.Find(project.Id);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreNotSame(project, fromDb);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, fromDb.Users.Count);                                &#xA0;                        &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;User userFromDb = User.Find(foo.Id);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreNotSame(foo, userFromDb);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, foo.Projects.Count);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0; }        This is quite a bit of code, but basically we create two users (the default assignee don&#x27;t necessarily belongs to the project) add it to the project and save the project. It is the project state was changed. Remember that we decided that the responsability of the connection is on the Project, that is what it means. If we will save the user foo, nothing will happen in the database.    We then open a new SessionScope to avoid getting the same instance from Active Record caching, get the data from the database, and make sure that the connection is live on both ends.    So far, it&#x27;s pretty simple. There is quite a bit more to Active Record, &#xA0;from cascades to composite keys to life cycle and validations, all of which I&#x27;m not going to cover. What we have now are the basis of Active Record, which is more than enough to move forward. It&#x27;s time we start writing some code that has some visible affects.    On my next post in this series... skimming the surface of MonoRail... stay tuned.</p>
        <a href="https://ayende.com/blog/1063/profiling-sql-server" target="_blank"><h1 class="title mb-6">Profiling SQL Server</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 19, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I know about SQL Profiler and Execution plans. What I need is a way to measure how much a stored procedure cost in time.&#xA;What I mean is that I&#x27;ve this:&#xA;&#xA;Start&#xA;&#xA;Step 1&#xA;Step 2&#xA;Step 3&#xA;&#xA;Step 3.1&#xA;Step 3.1&#xA;I want to know how much time each procedure takes, preferably in real time &quot;The current running procedure is X, started fifteen minutes ago&quot;.&#xA;Any ideas?</p>
        <a href="https://ayende.com/blog/1062/piping-primary-keys-and-three-hours-ill-not-get-back" target="_blank"><h1 class="title mb-6">Piping, Primary Keys and Three Hours I&#x27;ll not get back</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 19, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Okay, so I mentioned that I&#x27;d a query that violated a primary key constraint, and I couldn&#x27;t figure out why. Well, I finally got a hold of what was going on. It&#x27;s simple and non-obvious at the same time. Let&#x27;s start with a code example that shows the problem and then I&#x27;ll put in a couple of words about the reasons behind it. First, let&#x27;s create a table with a unique constraint (easier than a primary key):&#xA;CREATE TABLE Foo&#xA;(&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Bar INT UNIQUE&#xA;)&#xA;Now, let&#x27;s insert some data into the table:&#xA;INSERT INTO Foo&#xA;SELECT 1 UNION ALL &#xA;SELECT 2 UNION ALL&#xA;SELECT 3&#xA;So far, everything is nice and cozy, but now I want to add more numbers, so I want to make sure that I won&#x27;t break the code, so now I&#x27;ll add a guard clause to the next inserts:&#xA;INSERT INTO Foo&#xA;SELECT Kabum FROM&#xA;(&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SELECT 4 as Kabum UNION ALL &#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SELECT 5 as Kabum UNION ALL &#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SELECT 5 as Kabum&#xA;) Bang&#xA;WHERE NOT EXISTS &#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; (SELECT 1 FROM Foo where Bang.Kabum = Bar)&#xA;Running the above result in this error:&#xA;Violation of UNIQUE KEY constraint &#x27;UQ__Foo__5832119F&#x27;. Cannot insert duplicate key in object &#x27;dbo.Foo&#x27;.&#xA;Do you realize what happened here? We failed because when we checked it was just fine to put 5 into Foo, but when we actually did put the second 5 into Foo, that caused a constraint violation. Go figure that when you&#x27;re dealing with sixteen million records.&#xA;The solution to this problem is to add a distinct to the select statement, that would make sure that your own query isn&#x27;t causing the very same query to fail.&#xA;On that note, I wonder if I can call it a concurrency bug.</p>
        <a href="https://ayende.com/blog/1061/best-practice" target="_blank"><h1 class="title mb-6">Best Practice</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 19, 2006
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I realized that I didn&#x27;t explain a little of the background story about the last post. For some reason the (real, not the one I posted) query is violating a primary key constraint. When I tried to check it, it would think for a long while, and then spit out the error.&#xA;I know it&#x27;s evil to optimize buggy code, but at least now when it fails, it fails fast.</p>
        <div class="button flex justify-between">
            <a href="923.html"><span class="back arrow"></span></a>

            <a href="925.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>