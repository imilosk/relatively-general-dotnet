
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 624 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-6231">
            <a href="https://ayende.com/blog/3655/nhprof-logging-interception" target="_blank">
                <h2 class="title mb-6" id="article-6231">NHProf</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 21, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the goals that I set for myself with the NHibernate Profiler is to be able to run on unmodified NHibernate 2.0. The way that I do that is by intercepting and parsing the log stream from NHibernate. &#xA;NHibernate logging is extremely rich and detailed, so anything I wanted to do so far was possible. I am pretty sure that there would come a time when a feature would require more invasive approaches, running profiler code in the client application to gather more information, but for now this is enough.&#xA;I did run into several problems with logging interception. Ideally, I want this to happen on the fly, as we go. So I really want to get the real time logging stream. The problem is how to do so. I started with the UdpAppender, but that doesn&#x27;t work on Vista in the released version. Remoting Appender is what I am using now, but it has one critical issue, it is an async appender, so message can (and do) appear out of order.&#xA;The message order is pretty important to the profiler. It can deal with that, but it would lead to surprising results. So that one is out as well.&#xA;The only other appender that comes out of the box with log4net and can be used remotedly is the telnet appender, which is next on the list for exploring. It does mean that the profiler has to connect to the application, rather than the other way around, which can be a problem.&#xA;I built an appender that fit my needs, and I am using it now to test how the profiler works, but before starting to deal with the telnet appender, I thought it would be a good time to ask.&#xA;How important is &quot;running on unmodified NHibernate&quot; is? &#xA;I am not talking about having a profiler build of NHibernate, I am talking about doing things like using the profiler appender, or registering an HttpModule.</p>
        </article>
        <article id="article-6232">
            <a href="https://ardalis.com/speaking-at-dog-food-conference-in-columbus-ohio-november-2008/" target="_blank">
                <h2 class="title mb-6" id="article-6232">Speaking at Dog Food Conference in Columbus Ohio November 2008</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 20, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x2019;m giving an overview of ASP.NET MVC at the &#x201C;Dog Food&#x201D; conference in Columbus, Ohio, next month. The details and schedule are as follows&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-6233">
            <a href="https://ardalis.com/insidious-dependencies/" target="_blank">
                <h2 class="title mb-6" id="article-6233">Insidious Dependencies</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 19, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In the last year or so I&#x2019;ve really seen the light on how to really write loosely-coupled code. I thought I knew something about this concept&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-6234">
            <a href="https://ardalis.com/incenting-behavior/" target="_blank">
                <h2 class="title mb-6" id="article-6234">Incenting Behavior</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 19, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Ayende recently commented on Spolsky&#x2019;s latest Inc. column about how commission schemes typically backfire for companies due to local&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-6235">
            <a href="https://ardalis.com/hosting-company-breached/" target="_blank">
                <h2 class="title mb-6" id="article-6235">Hosting Company Breached</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 18, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Fasthosts, &#x201C;the UK&#x2019;s number 1 web host&#x201D; (by self acclamation I&#x2019;m sure) is in the news today because apparently all of their customers&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-6236">
            <a href="https://ardalis.com/devreach-2008/" target="_blank">
                <h2 class="title mb-6" id="article-6236">DevReach 2008</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 16, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I spent most of the last week speaking at DevReach in Sofia, Bulgaria. This was DevReach&#x2019;s third year, but was my first time speaking there&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-6237">
            <a href="https://ardalis.com/fiddler-for-firefox/" target="_blank">
                <h2 class="title mb-6" id="article-6237">Fiddler for Firefox</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 16, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In my tools talk at DevReach earlier this week I mentioned that I use Fiddler with IE and FireBug with Firefox to see HTTP traffic involved&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-6238">
            <a href="https://ayende.com/blog/3654/when-select-is-broken-or-just-slow" target="_blank">
                <h2 class="title mb-6" id="article-6238">When select IS broken (or just slow)</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 16, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Usually, &quot;select&quot; isn&#x27;t broken is a good motto to follow. Occasionally, there are cases where this is case. In particular, it may not be that it is broken, it may very well be that the way it works doesn&#x27;t match the things that we need it to do.&#xA;I spoke about an optimization story that happened recently, in which we managed to reduce the average time from 5 - 10 seconds to 5 - 15 milliseconds.&#xA;What we needed was to walk a tree structure, which was stored in a database, and do various interesting tree based operations on it. The most natural way of working with trees is with recursion, and SQL is just not the right way of dealing with it.&#xA;Deciding to load the entire table to memory, build a real tree structure and perform all the operations on that tree structure has paid off tremendously. What is important to remember is that we hadn&#x27;t had to do anything radical to the data model or the way the application worked. We only had to modify the implementation of the component that exposed that tree to the application.&#xA;One of the things that we had to deal was the case where the amount of data we have to deal with would exceed available memory. At least, we thought we had to deal with it.&#xA;But our tree was very simple, it consisted of a few properties and that it. Let us do the math about this, shall we?&#xA;&#xA;  Name - 50 chars, unicode - 100 bytes&#xA;&#xA;  4 decimal fields - 16 bytes each = 64 bytes&#xA;&#xA;  3 boolean fields - 3 bytes&#xA;&#xA;  Parent point - 4 bytes&#xA;&#xA;  Set of children - average of 10 per node - 40 bytes &#x2B; ~50 bytes bookkeeping&#xA;&#xA;This is very rough, of course, but that would do. It puts the memory cost of a node at just under 256 bytes. We will use that number, because it is easier to work with.&#xA;Now, with 256 bytes per node, how many can we reasonably use?&#xA;Well, 100 MB will take 409,600 nodes or so. Which is pretty good number, I say. A table of that size is considered big, by most people. A GB of memory will give us 4,194,304 items in the tree, and keep the traversal speed near instantaneous. At that point, I would start thinking about the size of the node, because 256 bytes is big size. More realistic size would be 64 bytes or so (drop the name, pack the decimals, use linked list for children) which would give me 16,777,216 nodes for the same memory requirement.&#xA;All of those numbers are greater than the current and expected size of the data set, so there isn&#x27;t a reason to care much beyond that.&#xA;The important thing here is to understand that the usual truth about &quot;let the tool do the optimization&quot; doesn&#x27;t really hold true when you have specific scenarios. For solving very specific, very narrow circumstances, you can generally come up with a much better approach than the generic one.&#xA;Of course, this approach would not allow any generalization, and it doesn&#x27;t have other benefits that using the common platform might have offered (needing to do our own transactions, for example).&#xA;Keep that in mind.</p>
        </article>
        <article id="article-6239">
            <a href="https://ayende.com/blog/3653/making-the-complex-trivial-rich-domain-querying" target="_blank">
                <h2 class="title mb-6" id="article-6239">Making the complex trivial: Rich Domain Querying</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 16, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">It is an extremely common issue and I talked about it in the past quite a few times. I have learned a lot since then, however, and I want to show you can create rich, complex, querying support with very little effort. We will start with the following model:   And see how we can query it. We start by defining search filters, classes that look more or less like our domain. Here is a simple example: public abstract class AbstractSearchFilter&#xA;{&#xA;&#x9;protected IList&lt;Action&lt;DetachedCriteria&gt;&gt; actions = new List&lt;Action&lt;DetachedCriteria&gt;&gt;();&#xA;&#x9;&#xA;&#x9;public void Apply(DetachedCriteria dc)&#xA;&#x9;{&#xA;&#x9;&#x9;foreach(var action in actions)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;action(dc);&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;public class PostSearchFilter : AbstractSearchFilter&#xA;{&#xA;&#x9;private string title;&#xA;&#x9;&#xA;&#x9;public string Title&#xA;&#x9;{&#xA;&#x9;&#x9;get { return title; }&#xA;&#x9;&#x9;set&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;title = value;&#xA;&#x9;&#x9;&#x9;actions.Add(dc =&gt; &#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;if(title.Empty())&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;return;&#xA;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;dc.Add(Restictions.Like(&quot;Title&quot;, title, MatchMode.Start));&#xA;&#x9;&#x9;&#x9;});&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}&#xA;&#xA;public class UserSearchFilter : AbstractSearchFilter&#xA;{&#xA;&#x9;private string username;&#xA;&#x9;private PostSearchFilter post;&#xA;&#x9;&#xA;&#x9;public string Username&#xA;&#x9;{&#xA;&#x9;&#x9;get { return username; }&#xA;&#x9;&#x9;set&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;username = value;&#xA;&#x9;&#x9;&#x9;actions.Add(dc =&gt;&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;if(username.Empty())&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;return;&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;dc.Add(Restrictions.Like(&quot;Username&quot;, username, MatchMode.Start));&#xA;&#x9;&#x9;&#x9;});&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;&#x9;&#xA;&#x9;public PostSearchFilter Post&#xA;&#x9;{&#xA;&#x9;&#x9;get { return post; }&#xA;&#x9;&#x9;set&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;post = value;&#xA;&#x9;&#x9;&#x9;actions.Add(dc=&gt;&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;if(post==null)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;return;&#xA;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;var postDC = dc.Path(&quot;Posts&quot;); // Path is an extension method for GetCriteriaByPath(name) ?? CreateCriteria(path)&#xA;&#x9;&#x9;&#x9;&#x9;post.Apply(postDC);&#xA;&#x9;&#x9;&#x9;);&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}&#xA;Now that we have the code in front of us, let us talk about it. The main idea here is that we move the responsibility of deciding what to query to the hands of the client. It can make decisions by just setting our properties. Not only that, but we support rich domain queries using this approach. Notice what we are doing in UserSearchFilter.Post.set, we create a sub criteria and pass it to the post search filter, to apply itself on that. Using this method, we completely abstract all the need to deal with our current position in the tree. We can query on posts directly, through users, through comments, etc. We don&#x27;t care, we just run in the provided context and apply our conditions on it.&#xA;Let us take the example of wanting to search all the users who posts about NHibernate.&#xA0; I can express this as:&#xA;usersRepository.FindAll(&#xA;  new UserSearchFilter&#xA;  {&#xA;    Post = new PostSearchFilter&#xA;        {&#xA;            Title = &quot;NHibernate&quot;&#xA;        }&#xA;  }&#xA;);&#xA;But that is only useful for static scenarios, and in those cases, it is easier to just write the query using the facilities NHibernate already gives us. Where does it shine?&#xA;There is a really good reason that I chose this design for the query mechanism. JSON.&#xA;I can ask the json serializer to serialize a JSON string into this object graph. Along the way, it will make all the property setting (and query building) that I need. On the client side, I just need to build the JSON string (an easy task, I think you would agree), and send it to the server. On the server side, I just need to build the filter classes (another very easy task). Done, I have a very rich, very complex, very complete solution.&#xA;Just to give you an idea, assuming that I had fully fleshed out the filters above, here is how I search for users name &#x27;ayende&#x27;, who posted about &#x27;nhibernate&#x27; with the tug &#x27;amazing&#x27; and has a comment saying &#x27;help&#x27;:&#xA;{ // root is user, in this case&#xA;&#x9;Name: &#x27;ayende&#x27;,&#xA;&#x9;Post:&#xA;&#x9;{&#xA;&#x9;&#x9;Title: &#x27;NHibernate&#x27;,&#xA;&#x9;&#x9;Tag:&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;Name: [&#x27;amazing&#x27;]&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;Comment:&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;Comment: &#x27;Help&#x27;&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}Deserializing that into our filter object graph gives us immediate results that we can pass the the repository to query with exactly zero hard work.</p>
        </article>
        <article id="article-6240">
            <a href="https://ayende.com/blog/3652/a-bug-story" target="_blank">
                <h2 class="title mb-6" id="article-6240">A bug story</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 15, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I run into a bug today with the way NHibernate dealt with order clauses. In particular, it can only happen if you are:  Use parameters in the order clause Using SQL Server 2005 Using a limit clause If you met all three conditions, you would run into a whole host of problems (in particular, NH-1527 and NH-1528). They are all fixed now, and I am writing this post as the build run. The underlying issue is that SQL Server 2005 syntax for paging is broken, badly. Let us take the this statement: SELECT   THIS_.ID         AS ID0_0_,&#xA;         THIS_.AREA       AS AREA0_0_,&#xA;         THIS_.PARENT     AS PARENT0_0_,&#xA;         THIS_.PARENTAREA AS PARENTAREA0_0_,&#xA;         THIS_.TYPE       AS TYPE0_0_,&#xA;         THIS_.NAME       AS NAME0_0_&#xA;FROM     TREENODE THIS_&#xA;WHERE    THIS_.NAME LIKE ?&#xA;         AND THIS_.ID &gt; ?&#xA;ORDER BY (SELECT THIS_0_.TYPE AS Y0_&#xA;          FROM   TREENODE THIS_0_&#xA;          WHERE  THIS_0_.TYPE = ?) ASC&#xA;And let us say that we want to get a paged view of the data. How can we do it? Here is the code:&#xA;SELECT   TOP 1000 ID0_0_,&#xA;                  AREA0_0_,&#xA;                  PARENT0_0_,&#xA;                  PARENTAREA0_0_,&#xA;                  TYPE0_0_,&#xA;                  NAME0_0_&#xA;FROM     (SELECT ROW_NUMBER()&#xA;                   OVER(ORDER BY __HIBERNATE_SORT_EXPR_0__) AS ROW,&#xA;                 QUERY.ID0_0_,&#xA;                 QUERY.AREA0_0_,&#xA;                 QUERY.PARENT0_0_,&#xA;                 QUERY.PARENTAREA0_0_,&#xA;                 QUERY.TYPE0_0_,&#xA;                 QUERY.NAME0_0_,&#xA;                 QUERY.__HIBERNATE_SORT_EXPR_0__&#xA;          FROM   (SELECT THIS_.ID         AS ID0_0_,&#xA;                         THIS_.AREA       AS AREA0_0_,&#xA;                         THIS_.PARENT     AS PARENT0_0_,&#xA;                         THIS_.PARENTAREA AS PARENTAREA0_0_,&#xA;                         THIS_.TYPE       AS TYPE0_0_,&#xA;                         THIS_.NAME       AS NAME0_0_,&#xA;                         (SELECT THIS_0_.TYPE AS Y0_&#xA;                          FROM   TREENODE THIS_0_&#xA;                          WHERE  THIS_0_.TYPE = ?) AS __HIBERNATE_SORT_EXPR_0__&#xA;                  FROM   TREENODE THIS_&#xA;                  WHERE  THIS_.NAME LIKE ?&#xA;                         AND THIS_.ID &gt; ?) QUERY) PAGE&#xA;WHERE    PAGE.ROW &gt; 10&#xA;ORDER BY __HIBERNATE_SORT_EXPR_0__&#xA;&#xA;&#xA;Yes, in this case, we could use TOP 1000 as well, but that doesn&#x27;t work if we want pages data that isn&#x27;t started at the beginning of the data set.&#xA;Now, here is an important fact, the question marks that you see? Those are positional parameters. Do you see the bug now?&#xA;SQL Server 2005 (and 2008) paging support is broken. I find it hard to believe that a feature that is just a tad less important than SELECT is so broken. Any other database get it right, for crying out load.&#xA;Anyway, by now you noticed that when we processed the statement to add the limit clause, we had re-written the structure of the statement and changed the order of the parameters. Tracking that problem down was a pain, just to give an idea, here is a bit of the change that I had to make:&#xA;/// &lt;summary&gt;&#xA;/// We need to know what the position of the parameter was in a query&#xA;/// before we rearranged the query.&#xA;/// This is used only by dialects that rearrange the query, unfortunately, &#xA;/// the MS SQL 2005 dialect have to re shuffle the query (and ruin positional parameter&#xA;/// support) because the SQL 2005 and 2008 SQL dialects have a completely broken &#xA;/// support for paging, which is just a tad less important than SELECT.&#xA;/// See  &#x9; NH-1528&#xA;/// &lt;/summary&gt;&#xA;public int? OriginalPositionInQuery;&#xA;I fixed the issue, but it is an annoying problem that keep occurring. Paging in SQL Server 2005/8 is broken!&#xA;Oh, and just to clarify some things. The ability to use complex expressions for the order by clause using the projection API is fairly new for NHibernate, it is incredibly powerful and really scares me.</p>
        </article>
        <div class="button flex justify-between">
            <a href="623.html"><span class="back arrow"></span></a>

            <a href="625.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>