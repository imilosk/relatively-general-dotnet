
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 173 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-1721">
            <a href="https://ayende.com/blog/188961-B/upsert-patching-in-ravendb" target="_blank">
                <h2 class="title mb-6" id="article-1721">Upsert patching in RavenDB</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 07, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Trevor asked a really interesting question in the mailing list. Assume that we have the following model:And what we want to do is to be able to add a note to a book. The API looks like so:public void SubmitNote(string isbn, string note);The requirements are simple: There is one book per ISBNNotes on the book shouldn&#x2019;t be duplicatedThe Book document may be large, and we don&#x2019;t actually care about it, just want to add itIf there is a note on an non existent book, we need to create itThe key observation here is that Trevor doesn&#x2019;t want to load the document, modify it and save it back. What he is looking for is a way to send the change to the database server and have it happen there. Luckily, RavenDB has the right set of features for this, the Patching API. Here is how you&#x2019;ll write the code to update the document without having to load it:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          string note = &quot;Great book&quot;;&#xA;        &#xA;        &#xA;          &#xA;          using (var s = store.OpenSession())&#xA;        &#xA;        &#xA;          &#xA;          {&#xA;        &#xA;        &#xA;          &#xA;              s.Advanced.Patch&lt;Book, Note&gt;(&quot;978-1719946216&quot;, &#xA;        &#xA;        &#xA;          &#xA;                  x=&gt;x.Notes, notes=&gt;notes.Add(new Note&#xA;        &#xA;        &#xA;          &#xA;                  {&#xA;        &#xA;        &#xA;          &#xA;                      Text = note&#xA;        &#xA;        &#xA;          &#xA;                  }));&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;             s.SaveChanges();&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          patch1.cs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;We can send the update to the server, have the change happen there, with no need to load and save the document. And we get strongly typed API and compiler validation, joy all around.This is great, but it misses something. If we&#x2019;ll run this code twice, we&#x2019;ll have a duplicated comment, which is something that we don&#x2019;t want to do. Luckily, we have more options. The strongly typed API we just wrote is sitting on top of the actual patch API, which is much more powerful. Let&#x2019;s see how we can tackle this requirement, shall we?&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          using (var s = store.OpenSession())&#xA;        &#xA;        &#xA;          &#xA;          {&#xA;        &#xA;        &#xA;          &#xA;              string note = &quot;Great book&quot;;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              s.Advanced.Defer(new PatchCommandData(&quot;978-1719946216&quot;, null, &#xA;        &#xA;        &#xA;          &#xA;                 new PatchRequest&#xA;        &#xA;        &#xA;          &#xA;                 {&#xA;        &#xA;        &#xA;          &#xA;                     Script = @&quot;&#xA;        &#xA;        &#xA;          &#xA;          if(this.Notes.some( n =&gt; n.Text === $note))&#xA;        &#xA;        &#xA;          &#xA;            return;&#xA;        &#xA;        &#xA;          &#xA;          this.Notes.push({Text: $note});&#xA;        &#xA;        &#xA;          &#xA;          &quot;,&#xA;        &#xA;        &#xA;          &#xA;                     Values = { [&quot;note&quot;] = note }&#xA;        &#xA;        &#xA;          &#xA;                 }, null));&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;             s.SaveChanges();&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          patch2.cs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;Now, we send a script to the server, which will execute it. If the note already exists, that means that we will not modify the document. So we got that out of the way. But we are still missing a piece of the puzzle, as you can probably see from the title of the post. What happens if the Book document does not exists?Luckily, we thought about this issue and RavenDB is ready to help here as well. When you send a patch request to RavenDB, you can send a single script, or two. The second one will be executed if the document does not exists, like so:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          using (var s = store.OpenSession())&#xA;        &#xA;        &#xA;          &#xA;          {&#xA;        &#xA;        &#xA;          &#xA;              string note = &quot;Great book&quot;;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              s.Advanced.Defer(new PatchCommandData(&quot;978-1719946216&quot;, null,&#xA;        &#xA;        &#xA;          &#xA;                 patch: new PatchRequest&#xA;        &#xA;        &#xA;          &#xA;                 {&#xA;        &#xA;        &#xA;          &#xA;                     Script = @&quot;&#xA;        &#xA;        &#xA;          &#xA;          if(this.Notes.some( n =&gt; n.Text === $note))&#xA;        &#xA;        &#xA;          &#xA;              return;&#xA;        &#xA;        &#xA;          &#xA;          this.Notes.push({Text: $note});&#xA;        &#xA;        &#xA;          &#xA;          &quot;,&#xA;        &#xA;        &#xA;          &#xA;                    Values = { [&quot;note&quot;] = note&#xA;        &#xA;        &#xA;          &#xA;                 },&#xA;        &#xA;        &#xA;          &#xA;                 patchIfMissing: new PatchRequest&#xA;        &#xA;        &#xA;          &#xA;                 {&#xA;        &#xA;        &#xA;          &#xA;                     Script = @&quot;&#xA;        &#xA;        &#xA;          &#xA;          this.Notes = [{Text: $note}];&#xA;        &#xA;        &#xA;          &#xA;          this[&#x27;@metadata&#x27;] = {&#x27;@collection&#x27;: &#x27;Books&#x27;};&#xA;        &#xA;        &#xA;          &#xA;          &quot;,&#xA;        &#xA;        &#xA;          &#xA;                     Values = { [&quot;note&quot;] = note&#xA;        &#xA;        &#xA;          &#xA;                 }));&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              s.SaveChanges();&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          patch3.cs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;If the document exists, we will run the patch script and modify the document. If the document does not exists, we will create an empty document and then run the patchIfMissing script to populate it. The code above handles all of the stated requirements, and we can call it a day.But as long as we are here, let&#x2019;s add another requirement. The only information we have from the SubmitNote(isbn, note) call is the ISBN of the book. Presumably we want to do things to this book, for example, figure out what the title is. Using this mechanism, how do we do this? When we return from the SaveChanges call, there is no way to tell if the document was newly created or already there?The answer here is to ask RavenDB to do so. And we can modify our patchIfMissing a bit to do so. Note the changes in that are in the code:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          using (var s = store.OpenSession())&#xA;        &#xA;        &#xA;          &#xA;          {&#xA;        &#xA;        &#xA;          &#xA;              string note = &quot;Great book&quot;;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              s.Advanced.Patch&lt;Book, Note&gt;(&quot;978-1719946216&quot;,&#xA;        &#xA;        &#xA;          &#xA;                  x =&gt; x.Notes, notes =&gt; notes.Add(new Note&#xA;        &#xA;        &#xA;          &#xA;                  {&#xA;        &#xA;        &#xA;          &#xA;                      Text = note&#xA;        &#xA;        &#xA;          &#xA;                  }));&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              s.Advanced.Defer(new PatchCommandData(&quot;978-1719946216&quot;, null,&#xA;        &#xA;        &#xA;          &#xA;                 patch: new PatchRequest&#xA;        &#xA;        &#xA;          &#xA;                 {&#xA;        &#xA;        &#xA;          &#xA;                     Script = @&quot;&#xA;        &#xA;        &#xA;          &#xA;          if(this.Notes.some( n =&gt; n.Text === $note))&#xA;        &#xA;        &#xA;          &#xA;              return;&#xA;        &#xA;        &#xA;          &#xA;          this.Notes.push({Text: $note});&#xA;        &#xA;        &#xA;          &#xA;          &quot;,&#xA;        &#xA;        &#xA;          &#xA;                     Values =&#xA;        &#xA;        &#xA;          &#xA;                     {&#xA;        &#xA;        &#xA;          &#xA;                         [&quot;note&quot;] = &quot;Great book!!&quot;&#xA;        &#xA;        &#xA;          &#xA;                     }&#xA;        &#xA;        &#xA;          &#xA;                 },&#xA;        &#xA;        &#xA;          &#xA;                 patchIfMissing: new PatchRequest&#xA;        &#xA;        &#xA;          &#xA;                 {&#xA;        &#xA;        &#xA;          &#xA;                     Script = @&quot;&#xA;        &#xA;        &#xA;          &#xA;          this.Notes = [{Text: $note}];&#xA;        &#xA;        &#xA;          &#xA;          this[&#x27;@metadata&#x27;] = {&#x27;@collection&#x27;: &#x27;Books&#x27;};&#xA;        &#xA;        &#xA;          &#xA;          put(&#x27;tasks/update-book-data/&#x27;&#x2B;$isbn, {&#xA;        &#xA;        &#xA;          &#xA;              &#x27;Task&#x27;: &#x27;Found out more about this book&#x27;,&#xA;        &#xA;        &#xA;          &#xA;              &#x27;ISBN&#x27;: $isbn,&#xA;        &#xA;        &#xA;          &#xA;              &#x27;@metadata&#x27;: { &#x27;@collection&#x27;: &#x27;Tasks&#x27; }&#xA;        &#xA;        &#xA;          &#xA;          });&#xA;        &#xA;        &#xA;          &#xA;          &quot;,&#xA;        &#xA;        &#xA;          &#xA;                     Values =&#xA;        &#xA;        &#xA;          &#xA;                     {&#xA;        &#xA;        &#xA;          &#xA;                         [&quot;note&quot;] = &quot;Great book!&quot;,&#xA;        &#xA;        &#xA;          &#xA;                         [&quot;isbn&quot;] = &quot;978-1719946216&quot;&#xA;        &#xA;        &#xA;          &#xA;                     }&#xA;        &#xA;        &#xA;          &#xA;                 }));&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              s.SaveChanges();&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          patch4.cs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;If we need to execute the missing patch code, we&#x2019;ll create the new document and in the same transaction, we&#x2019;ll also create a task document to fetch additional information about this book. Your code will usually subscribe to the Tasks collection and execute additional work as a result of that.And this is it, everything we need to, in a single operation. Note that in many cases, you don&#x2019;t actually have a single such call, though. Let&#x2019;s say that you are getting a batch of work all at once. Your API will actually look like:public void SumbitNotes(Dictionary&lt;string, string&gt; isbnToNotes);In this case, we are going to execute the code above for all the items that we got in the call, but call SaveChanges once. All of them would operate as a single transaction and a single round trip to the server.</p>
        </article>
        <article id="article-1722">
            <a href="https://ayende.com/blog/188931-C/using-ravendb-in-php" target="_blank">
                <h2 class="title mb-6" id="article-1722">Using RavenDB in PHP</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 06, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">After build an R client for RavenDB, I decided to see what it would take to build a basic RavenDB client for PHP in the same manner. It turned out to be fairly simple, and you can find the relevant code here.Here are some basic CRUD operations:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          &lt;?php&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          $rvn = new RavenDB(&quot;http://live-test.ravendb.net&quot;, &quot;Demo&quot;);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          $new_user = array(&#xA;        &#xA;        &#xA;          &#xA;              &#x27;User&#x27; =&gt; &#x27;Oren&#x27;, &#xA;        &#xA;        &#xA;          &#xA;              &#x27;Emails&#x27; =&gt; array(&quot;ayende@ayende.com&quot;, &quot;oren@ravendb.net&quot;), &#xA;        &#xA;        &#xA;          &#xA;              &quot;@metadata&quot; =&gt; array(&quot;@collection&quot; =&gt; &quot;Users&quot;)&#xA;        &#xA;        &#xA;          &#xA;          );&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          $rvn-&gt;put(&quot;users/ayende&quot;, $new_user);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          $name = $rvn-&gt;get(&quot;users/ayende&quot;)-&gt;{&#x27;User&#x27;};&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          echo $name . &quot;\n&quot;;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          $users = $rvn-&gt;query(&#xA;        &#xA;        &#xA;          &#xA;            &quot;from Users where Emails in (\$emails)&quot;, &#xA;        &#xA;        &#xA;          &#xA;            array(&quot;emails&quot; =&gt; array(&quot;oren@ravendb.net&quot;, &quot;ayende@ravendb.cloud&quot;))&#xA;        &#xA;        &#xA;          &#xA;          );&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          $rvn-&gt;del(&quot;users/ayende&quot;);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          var_dump($users);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          ?&gt;&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          crud.php&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;As you can see, the API is quite straightforward to use. It isn&#x2019;t the full blown API that we usually provide, but it is more than enough to get you going.Incidentally, we also published our REST API documentation recently, so you can see how you expand this code to do even more for you.</p>
        </article>
        <article id="article-1723">
            <a href="https://www.meziantou.net/visual-studio-tips-and-tricks-open-the-documentation-of-a-symbol.htm" target="_blank">
                <h2 class="title mb-6" id="article-1723">Visual Studio Tips and tricks: Open the documentation of a symbol</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 06, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">When you write code, you sometimes need to read the documentation of a method or a class to understand how it works. The IntelliSense already provides useful information, but the documentation can contain useful remarks or links that you may need. You can open your favorite search engine and search</p>
        </article>
        <article id="article-1724">
            <a href="https://ayende.com/blog/188930-C/the-futility-of-using-ravendb-as-an-in-memory-database" target="_blank">
                <h2 class="title mb-6" id="article-1724">The futility of using RavenDB as an in memory database</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 05, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I was reminded recently that the RavenDB documentation aren&#x2019;t putting enough emphasis on the fact that RavenDB can run as an in memory database.&#xA0; In fact, topologies that other databases seem to think are fancy are trivial in RavenDB. You can run your cluster in a mixed mode, with a couple of nodes that are persistent and write to disk, but having other nodes that are using pure in memory storage. Combined with RavenDB&#x2019;s routing capabilities, you&#x2019;ll end up with a cluster where the nodes you&#x2019;ll usually interact with are going to be purely in memory, but with the backend pushing data to other nodes that are persisting to disk. On the face of it, you have both the speed of in memory database with the persistence that your data craves.&#xA;So why aren&#x2019;t we making a whole lot of a big deal out of this? This is a nice feature, and surely it can be used as a competitive advantage, no?&#xA;The problem is that it isn&#x2019;t going to play out as you would expect it to be.&#xA;Consider the case where you dataset* is larger than memory. In that case, you are going to have to go to disk anyway. At this point, it doesn&#x2019;t really matter whatever you are swapping to the page file or reading from a data file. On the other hand, if the dataset you work with can fit entirely in memory, you are going to see significant speedups. Except that with RavenDB, you won&#x2019;t.&#xA;That sound bad, so let me try to express this better. If you dataset can fit into memory, RavenDB is already going to be serving it completely from memory. You don&#x2019;t need to do anything to avoid disk I/O, by default, RavenDB is already going to do that for you. And if you dataset is larger than memory, RavenDB is going to ensure that we make only the minimum amount of I/O in order to serve your requests.&#xA;In other words, because of the way RavenDB is architected, you aren&#x2019;t going to see any major advantages by going the pure in memory route. We are already providing most of them out of the box, while still maintain ACID guarantees as well as on disk persistence.&#xA;There are some advantages of running in memory only mode. Transactions are somewhat faster, but we have spent a lot of time optimizing our transactional hot path, you can get to hundreds of thousands of individual writes on a single node while maintaining full persistence and ACID compliance. In the vast majority of the cases, you simply don&#x2019;t need the additional boost. It costs too much on to give up persistence.&#xA;So the answer is that you can run RavenDB purely in memory, and you can also do that in mixed mode cluster, but for the most part, it just doesn&#x2019;t give you enough bang for the buck. You are going to be as fast for reads and almost as fast for writes (almost certainly faster than what you actually need) anyway.&#xA;* Well, working set, at least, but I&#x2019;m being fast and loose with the terms here.</p>
        </article>
        <article id="article-1725">
            <a href="https://andrewlock.net/converting-a-netstandard-2-library-to-netcore-3/" target="_blank">
                <h2 class="title mb-6" id="article-1725">Converting a .NET Standard 2.0 library to .NET Core 3.0</h2>
            </a>
            <p class="mb-2">by Andrew Lock</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 05, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Upgrading to ASP.NET Core 3.0 - Part 1</p>
        </article>
        <article id="article-1726">
            <a href="https://ayende.com/blog/188929-C/accessing-ravendb-data-from-r" target="_blank">
                <h2 class="title mb-6" id="article-1726">Accessing RavenDB data from R</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 04, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">R is a popular environment for working with data, mostly for statistical analysis and exploration. It is widely used by data scientists, statistician and people who get a pile of data and need to figure out how to get something out of it.RavenDB stores data and it can be nice to go through it using R. And now you can quite easily, as you can see here:Inside your R environment, load (or save locally) using:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          source(&quot;https://gist.githubusercontent.com/ayende/15f8b480f4c4a3378eefef66b366a310/raw/ac6d8e947e611425d934ca1a55f32398928f3d4c/rvn.r&quot;)&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          source.r&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;And you are read to R(ock) .In order to set things up, you&#x2019;ll need to tell R where to find your server, you can do this using:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          # unsecured&#xA;        &#xA;        &#xA;          &#xA;          rvn &lt;- raven(&quot;http://live-test.ravendb.net&quot;, &quot;demo&quot;)&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          # secured - Windows&#xA;        &#xA;        &#xA;          &#xA;          rvn &lt;- raven(&quot;https://a.rock-n.roll.ravendb.cloud&quot;, &quot;Metrics&quot;, thumbprint=&quot;a909502dd82ae41433e6f83886b00d4277a32a7b&quot;)&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          # secured - Linux&#xA;        &#xA;        &#xA;          &#xA;          rvn &lt;- raven(&quot;https://a.rock-n.roll.ravendb.cloud&quot;, &quot;Metrics&quot;, keyfile=&quot;/path/to/cert.key&quot;, certfile=&quot;/path/to/cert.crt&quot;)&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          setup.r&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;Note that you can access both secured and unsecured servers, but you need to be aware of how where your R script is running. If this is running on Windows, you&#x2019;ll need to install the PFX and provide the thumbprint. On Linux, you&#x2019;ll need to provide the paths to the cert.key and cert.crt files, instead. This is because on Windows, R is compiled against schannel and&#x2026; you probably don&#x2019;t care, right?Now that you have everything setup, you can start having fun with R. To issue a query, just call: rvn$query(), as shown above.Note that you can write any query you&#x2019;ll like here. For example, let&#x2019;s say that I wanted to analyze the popularity of products, I can do it using:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          &gt; products_popularity = rvn$query(&quot;from Orders group by Lines[].Product select key() as Product, count()&quot;)&#xA;        &#xA;        &#xA;          &#xA;          &gt; plot(products_popularity$Count)&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          products.r&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;And the result would be:Doesn&#x2019;t seem like something pop up from the data, but I&#x2019;m not a data scientist.You can also manipulate data using:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          &gt; rvn$del(&quot;orders/1-A&quot;)&#xA;        &#xA;        &#xA;          &#xA;          &gt; rvn$put(&quot;users/oren&quot;, list(Name=&quot;Oren&quot;,Status=&quot;Adding R to CV&quot;,Tags=list(&quot;it&quot;,&quot;just&quot;,&quot;works&quot;)))&#xA;        &#xA;        &#xA;          &#xA;          &gt; &gt; rvn$get(&quot;users/oren&quot;)&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          crud.r&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;And here is the result in RavenDB:And now, go forth and figure out what this all means.</p>
        </article>
        <article id="article-1727">
            <a href="https://www.meziantou.net/how-to-use-csharp-8-indices-and-ranges-in-dotnet-standard-2-0-and-dotn.htm" target="_blank">
                <h2 class="title mb-6" id="article-1727">How to use C# 8 Indices and Ranges in .NET Standard 2.0 and .NET Framework</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 04, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This post is part of the series &#x27;C# 8&#x27;. Be sure to check out the rest of the blog posts of the series!C# 8: Nullable Reference TypesHow to use Nullable Reference Types in .NET Standard 2.0 and .NET FrameworkHow to use C# 8 Indices and Ranges in .NET Standard 2.0 and .NET Framework (this post)TipYou</p>
        </article>
        <article id="article-1728">
            <a href="https://ayende.com/blog/188897-C/soliciting-feedback-ravendb-time-series-queries" target="_blank">
                <h2 class="title mb-6" id="article-1728">Soliciting feedback: RavenDB time series queries</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 01, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">RavenDB 5.0 will come out with support for time series. I talked about this briefly in the past, and now we are the point where we are almost ready for the feature to stand on its own. Before we get to that point, I have a few questions before the design is set. Here is what a typical query is going to look like:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          declare timeseries daily_heartrate(doc) {&#xA;        &#xA;        &#xA;          &#xA;            from doc.Heartrate between &#x27;2018-01-01&#x27; and &#x27;2019-01-01&#x27;&#xA;        &#xA;        &#xA;          &#xA;            group by 1d&#xA;        &#xA;        &#xA;          &#xA;            select min(), max(), avg()&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;        &#xA;          &#xA;          from Users as u&#xA;        &#xA;        &#xA;          &#xA;          where id(u) == &#x27;users/oren&#x27;&#xA;        &#xA;        &#xA;          &#xA;          select daily_heartrate(u) as DailyHeartrate, u.Name&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          ts1.sql&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;We intend to make the queries as obvious as possible, so I&#x2019;m not going to explain it. If you can&#x2019;t figure out what the query above is meant to do, I would like to know, though.What sort of queries would you look to do with the data? For example, here is something that we expect users to want to do, compare and contrast different time periods, which you&#x2019;ll be able to do with the following manner:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          declare timeseries daily_heartrate(doc, $start, $end) {&#xA;        &#xA;        &#xA;          &#xA;            from doc.Heartrate between $start and $end&#xA;        &#xA;        &#xA;          &#xA;            group by 1d&#xA;        &#xA;        &#xA;          &#xA;            select min(), max(), avg()&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;        &#xA;          &#xA;          from Users as u&#xA;        &#xA;        &#xA;          &#xA;          where id(u) == &#x27;users/oren&#x27;&#xA;        &#xA;        &#xA;          &#xA;          load daily_heartrate(u, &#x27;2019-09-01&#x27;, &#x27;2019-10-01&#x27;) as previous,&#xA;        &#xA;        &#xA;          &#xA;               daily_heartrate(u, &#x27;2019-10-01&#x27;, &#x27;2019-11-01&#x27;) as current&#xA;        &#xA;        &#xA;          &#xA;          select previous as Previous, current as Current, timeseries.diff(current, previous) as Diff, u.Name&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          ts2.sql&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;The output of this query will give you the daily summaries for the last two months, as well as a time based diff between the two (meaning that it will match on the same dates, ignoring missing values, etc). What other methods for the &#x201C;timeseries.*&#x201D; would you need? The other factor that we want to get feedback on is what sort of visualization do you want to see on top of this data in the RavenDB Studio?</p>
        </article>
        <article id="article-1729">
            <a href="https://ayende.com/blog/188865-C/bad-sorting-and-other-pitfalls" target="_blank">
                <h2 class="title mb-6" id="article-1729">Bad sorting and other pitfalls</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 30, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">While tracing a bug, I ended up with the following minimum reproduction:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          var s = new[]&#xA;        &#xA;        &#xA;          &#xA;          {&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;              &quot;2015-10-16T23:21:28.5487637&#x2B;02:00&quot;,&#xA;        &#xA;        &#xA;          &#xA;          };&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          Console.WriteLine(s.Length);&#xA;        &#xA;        &#xA;          &#xA;          Array.Sort(s, (a,b)=&gt;  DateTime.Parse(a) &gt; DateTime.Parse(b) ? 1 : -1 );&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          bad.sort.cs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;&#xA;The error you&#x2019;ll get is: Unable to sort because the IComparer.Compare() method returns inconsistent results. Either a value does not compare equal to itself, or one value repeatedly compared to another value yields different results.The nasty thing about this is that if we had just 16 items in the array, this code would work. So this would appear to successfully work most times, and then break.The underlying issue is that Array.Sort will use different sorting algorithms based on the size of the array to be sorted. Under 16 items, it&#x2019;ll use an insertion sort, but over that, an introspection sort will be used (up to a limit, and then heap sort. Go read the code.).What is key here is that our comparison function is broken. It doesn&#x2019;t understand that two values can be equal. Because of that, comparing two equal values result in both of them being smaller than one another. That cause an error, and .NET issues this error. When you know what went wrong, the fix is pretty easy:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          Array.Sort(s, (a,b)=&gt;  {&#xA;        &#xA;        &#xA;          &#xA;             if ( DateTime.Parse(a) == DateTime.Parse(b)) return 0;&#xA;        &#xA;        &#xA;          &#xA;             return  DateTime.Parse(a) &gt; DateTime.Parse(b) ? 1 : -1&#xA;        &#xA;        &#xA;          &#xA;          });&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          good.sort.cs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;Now we properly handle this scenario, and everything will work.</p>
        </article>
        <article id="article-1730">
            <a href="https://ardalis.com/sketch-themes-for-prototypes/" target="_blank">
                <h2 class="title mb-6" id="article-1730">Sketch Themes for Prototypes</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: October 30, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Last week during one of my devBetter coaching sessions, the conversation turned to spikes and Minimum Viable Products (and even not-so&#x2026;Keep Reading &#x2192;</p>
        </article>
        <div class="button flex justify-between">
            <a href="172.html"><span class="back arrow"></span></a>

            <a href="174.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>