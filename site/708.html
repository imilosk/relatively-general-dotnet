
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 708 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-7071">
            <a href="https://ayende.com/blog/3217/upfront-optimizations" target="_blank">
                <h2 class="title mb-6" id="article-7071">Upfront Optimizations</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 26, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Developers tends to be micro optimizers by default, in most cases. In general it is accepted that this is a Bad Thing. This is a very common quote:     In my last project, I wasn&#x27;t willing to allow discussion on the performance of the application until we got to final QA stages. (We found exactly two bottle necks in the application, by the way, and it cost us 1 hour and 1 day to fix them). You could say that I really believe that premature optimization is a problem.  However, the one thing that I will think of in advance (hopefully far in advance), is reducing the amount of remote calls.     This is something that you should think of in advance, because a remote call is several orders of magnitudes than just about anything else that you can do in your application except maybe huge prime generation.  In general, you need to think about two things:     How can we reduce remote calls?    How can we fail (in development) for exceeding some amount of remote calls per a unit of work?   What I have found is that batching makes for a really nice model for reducing remote calls, and ensuring failure on high number of remote calls to be the most effective way to reduce their number.  This is generally not something that you can retrofit into the system, the model of work is completely different. You can try, but you end up with a Frankenstein that is going to be slow and hard to work with.  So, at any rate, this is what I wanted to say. Ignore performance until very late in the game, but do think about remote calls and the distribution of the application components as early as possible.  No, this is not BDUF, it is setting the architecture for the application, and having the right fundamental approach as early as possible.  &#xA0;  ,</p>
        </article>
        <article id="article-7072">
            <a href="https://ayende.com/blog/3216/the-devil-is-in-the-details" target="_blank">
                <h2 class="title mb-6" id="article-7072">The devil is in the details</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 26, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Quite often, I hear about a new approach or framework, and they are interesting concepts, with obviously trivial implementations.  In fact, the way I usually learn about new approach is by writing my own spike to explore how such a thing can work. (As an alternative, I will go and read the code, if it is an OSS project).  The problem is that obviously trivial implementations tends to ignore a lot of the fine details. Even for the trivial things, there are a lot of details to consider before you can call something production ready.  Production ready is a tough concept to define, but it is generally means that you have taken into account things like:     Performance    Error handling    Security   And many, many more.   One of the release criteria of Rhino Mocks is the ability to mock IE COM interfaces, as a simple example. That is actually much tougher than it looks (go figure out what RVA is and come back to tell me), as a good example;  But mocking is a complex issue as it is, let us take unit testing as an example, it is very simple concept, after all. How hard is it to build? Let us see:     public class MyUnitTestingFramework&#xA;{&#xA;&#x9;public static void Main(string[] args)&#xA;&#x9;{&#xA;&#x9;&#x9;foreach(string file in args)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;foreach(Type type in Assembly.Load(file).GetTypes())&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;foreach(MethodInfo method in type.GetMethods())&#xA;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;if(IsTest(method)==false)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;continue;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;try&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;object instance = Activator.CreateInstance(type);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;method.Invoke(instance, new object[0]);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;catch(Exception e)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Console.WriteLine(&quot;Test failed {0}, because: {1}&quot;, method, e);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;&#x9;&#xA;&#x9;public static bool IsTest(MethodInfo method)&#xA;&#x9;{&#xA;&#x9;&#x9;foreach(object att in method.GetCustomerAttributes(true))&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;if(att.GetType().Name == &quot;Test&quot;)&#xA;&#x9;&#x9;&#x9;&#x9;return true;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;return false;&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;Yeah, I have created Rhino Unit!&#xA;&#xA;Well, not hardly.&#xA;&#xA;I can write an OR/M, IoC container and Proxies in an hour (each, not all of them). Knowing how to do this is important, but doing so for real is generally a mistake. I am currently using a homegrown-written-in-an-hour IoC container, I really don&#x27;t like it. I keep hitting the limitations, and the cost of actually getting a container up to par with the standard expectation is huge. I know that I can&#x27;t use a written-in-an-hour-OR/M without sedation. &#xA;&#xA;Here is the general outline of the cost to feature ratio for doing this on any of the high end tools:&#xA;&#xA; &#xA;&#xA;There really isn&#x27;t much of a complexity involved, just a lot of small details that you need to take care of, which is where all the cost goes.&#xA;&#xA;One thing that I am not telling you is that I didn&#x27;t show the entire graph, here is the same graph, this time with more of the timeline shown. After a while, the complexity tends to go away (if it isn&#x27;t, the project fails and dies, see previous graph).&#xA;&#xA; &#xA;&#xA;Nevertheless, the initial cost for rolling your own like this is significant. This is also the reason why I wince every time someone tells me that they just write their own everything. (yeah, I know, I am not one that can point fingers. I think that I mentioned before that I feel no overwhelming need to be self consistent).&#xA;&#xA;My own response for those graphs tend to follow the same path almost invariably:&#xA;&#xA;&#xA;  Build my own spike code to understand the challenges involved in building something like this.&#xA;&#xA;  Evaluate existing players against my criteria.&#xA;&#xA;  Evaluate comparability with the rest of my stack.&#xA;&#xA;&#xA;If it passes my criteria, I&#x27;ll tend to use that over building my own. If it doesn&#x27;t, well, at least I have a good reason to do it.&#xA;&#xA;Programming to learn is a good practice, one that is important not to lose. At the same time, it is crucial to remember that you shouldn&#x27;t take out the toys to play in front of the big boys unless you carry a big stick and are not afraid to use it.</p>
        </article>
        <article id="article-7073">
            <a href="https://ayende.com/blog/3215/svnbridge-frustrations" target="_blank">
                <h2 class="title mb-6" id="article-7073">SvnBridge Frustrations</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 26, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is how I am feeling at the moment (more below):     One of the major disadvantages of having to dog food the source control I am using to write the source control is that it is incredibly fragile.  It is fairly easy to violate some invariant in a non obvious way, which make for problems down the road. The problem is that those problems are symptoms, not the real issue. As a result, I have this:     I try to clean it up often, but at one point I got to SvnBridge5.  Thank god that SVN has such a good patching mechanism.</p>
        </article>
        <article id="article-7074">
            <a href="https://ayende.com/blog/3214/di-ioc-are-not-about-testing" target="_blank">
                <h2 class="title mb-6" id="article-7074">DI &amp; IoC are not about testing!</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 26, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Dependency Injection &amp; Inversion of Control Containers are not about testing!  I hear this a lot recently. Dave Laribee mentioned that in the Hanselminutes podcast, The creators of Guise seems to think that this is the main concern (01:30 in the video).  Oh, those techniques help, obviously. But it is not about unit testing.  For me, it is like saying that the main purpose interfaces is to enable easier testing.  DI &amp; IoC are about decoupling, better flexibility, having a central place to go to and increasing the maintainability of out applications. Testing is important, but that is not the first and foremost reason.</p>
        </article>
        <article id="article-7075">
            <a href="https://ayende.com/blog/3213/async-actions-in-monorail" target="_blank">
                <h2 class="title mb-6" id="article-7075">Async Actions in Monorail</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 25, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the ways to significantly increase the scalability of our applications is to start performing more and more things in an asynchronous manner. This is important because most actions that we perform in a typical application are not CPU bound, they are I/O bound.   Here is a simple example:     public class HomeController : SmartDispatcherController&#xA;{&#xA;&#x9;IUserRepository userRepository;&#xA;&#x9;&#xA;&#x9;public void Index()&#xA;&#x9;{&#xA;&#x9;&#x9;PropertyBag[&quot;userInfo&quot;] = userRepository.GetUserInformation(CurrentUser);&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;GetUserInformation() is a web service call, and it can take a long time to run. Now, if we have the code as above, while the web service call is being processed, we can&#x27;t use this thread for any other request. This has a significant implications on our scalability. &#xA;&#xA;ASP.Net has support for just those scenarios, using async requests. You can read more about it here, including a better explanation of the &#xA;&#xA;I recently added support for this to MonoRail (it is currently on a branch, and will be moved to the trunk shortly).&#xA;&#xA;Let us say that you have found that the HomeController.Index() method is a problem from scalability perspective. You can now rewrite it like this:&#xA;&#xA;&#xA;  public class HomeController : SmartDispatcherController&#xA;{&#xA;&#x9;IUserRepository userRepository;&#xA;&#x9;&#xA;&#x9;public IAsyncResult BeginIndex()&#xA;&#x9;{&#xA;&#x9;&#x9;return userRepository.BeginGetUserInformation(CurrentUser, &#xA;&#x9;&#x9;&#x9;ControllerContext.Async.Callback,&#xA;&#x9;&#x9;&#x9;ControllerContext.Async.State);&#xA;&#x9;}&#xA;&#xA;&#x9;public void EndIndex()&#xA;&#x9;{&#xA;&#x9;&#x9;PropertyBag[&quot;userInfo&quot;] = userRepository.EndGetUserInformation(ControllerContext.Async.Result);&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;That is all the change that you need to do to turn an action async. We are using the standard .NET async semantics, and MonoRail will infer them automatically and use the underlying ASP.Net async request infrastructure.&#xA;&#xA;&quot;BeginIndex/EndIndex&quot; are the method pairs that compose the async method index. Note that the only thing that needs to be change is turning a synchronous action to an asynchronous action is splitting the action method into an IAsyncResult Begin[ActionName]() and void End[ActionName](). Everything else is exactly the same.&#xA;&#xA;This is a major improvement for scaling an application. The more I learn about async programming, the more it makes sense to me, and I think that I am moving more and more to this paradigm.</p>
        </article>
        <article id="article-7076">
            <a href="https://ayende.com/blog/3212/non-invasive-api-take-2" target="_blank">
                <h2 class="title mb-6" id="article-7076">Non Invasive API, take 2</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 25, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A few days ago I presented my typical way of handling container driven polymorphism.      // only use for selection&#xA;public interface IRegion&lt;T&gt; : IRegion {}&#xA;&#xA;public void SetRegion(DependencyObject containerElement, string regionName)&#xA;{&#xA;&#x9;IRegion region = (IRegion) IoC.TryResolve(typeof(IRegion&lt;&gt;).MakeGenericType(containerElement.GetType()));&#xA;&#xA;&#x9;if (region != null)&#xA;&#x9;&#x9;_regions.Add(regionName, region);&#xA;}&#xA;&#xA;&#xA;I got an email with some good questions, and it is worth a second post to clarify. The questions:&#xA;&#xA;&#xA;  The only thing I don&#x2019;t like is that a lookup in the form of TryResolve(typeof(IRegion&lt;&gt;).MakeGenericType(containerElement.GetType())) would infer an explicit wrapper type for ever possible UI container type. On one hand it gives me the fine grain control I need to specify a different wrapper for an inherited UI container. But on the other hand, it means that ListBox, TreeView, ComboBox and TabControl would all need their own custom wrappers even though they all derive from ItemsControl and all handle adding and removing child entities in the same way.&#xA;&#xA;  But if containerElement == typeof(ListBox), won&#x2019;t TryResolve(typeof(IRegion&lt;&gt;).MakeGenericType(containerElement.GetType())) fail to resolve? TryResolve expects an explicit match. It would need to find a registration for IRegion&lt;ListBox&gt;, not IRegion&lt;ItemContainer&gt; right? (Assuming Unity here.)&#xA;&#xA;  Even if that worked, what if I want all elements that inherit from ItemContainer to be handled by IRegion&lt;ItemContainer&gt; except TreeView? Say I need to handle TreeView differently for some reason. What&#x2019;s a nice way to handle the 80% rule generically but still allow an override for special cases?&#xA;&#xA;&#xA;My response to that is very simple. Take the same approach, but bigger. Here is all we need to make this happen.&#xA;&#xA;&#xA;  public void SetRegion(DependencyObject containerElement, string regionName)&#xA;{&#xA;&#x9;Type current = containerElement.GetType()&#xA;&#x9;while(current != typeof(DependencyObject))&#xA;&#x9;{&#xA;&#x9;&#x9;IRegion region = (IRegion) IoC.TryResolve(typeof(IRegion&lt;&gt;).MakeGenericType(current));&#xA;&#x9;&#xA;&#x9;&#x9;if (region != null)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;_regions.Add(regionName, region);&#xA;&#x9;&#x9;&#x9;return;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;current = current.BaseType;&#xA;&#x9;}&#xA;}&#xA;&#xA;&#xA;Now, we can register the following:&#xA;&#xA;&#xA;  IRegion&lt;TreeView&gt;&#xA;&#xA;  IRegion&lt;MyCustomRegion&gt;&#xA;&#xA;  IRegion&lt;ItemsControl&gt;&#xA;&#xA;&#xA;And no matter what we will send to SetRegion, we can modify the behavior merely by changing the registration of IRegion&lt;T&gt; implementations. Note that this doesn&#x27;t assumes any capacity on the container (except the basic resolve-generic-service one).&#xA;&#xA;This is also a very natural model to follow, in nearly all cases (there is an issue here regarding whatever we should consider interfaces as well, but that is beside the point for this demo, and I would generally not do that anyway).</p>
        </article>
        <article id="article-7077">
            <a href="https://ayende.com/blog/3211/unity-annoyances" target="_blank">
                <h2 class="title mb-6" id="article-7077">Unity Annoyances</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 24, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This has nothing to do with the code itself, and anything to do with how it is managed. Take a look here:     The weekly drop is an MSI. I don&#x27;t like MSI. They taint my system, put things in places I don&#x27;t want, and in general annoys me.  Okay, so let us just grab the source directly, right? That is what I tend to do anyway.  Oh, I forgot, there isn&#x27;t any source repository available.      A zip file is the least I would expect.</p>
        </article>
        <article id="article-7078">
            <a href="https://ayende.com/blog/3210/challenge-find-the-version" target="_blank">
                <h2 class="title mb-6" id="article-7078">Challenge</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 24, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Okay, here is something that I had to deal with today. I had to implement the dated-rev-report command in SvnBridge. This command sends a date to the server, and get the first revision id that was committed before to that date. Because code is unambiguous, if we were using SQL, it would have been:     CREATE PROC DatedRevReport &#xA;&#x9;@requestedDate DATETIME&#xA;AS&#xA;&#x9;SELECT TOP 1 RevisionId&#xA;&#x9;FROM Revisions&#xA;&#x9;WHERE CommittedDate &lt; @requestedDate&#xA;&#x9;ORDER BY CommittedDate DESC&#xA;&#xA;&#xA;Simple, right? Except that the interface that I have to TFS is not SQL (and I would be pretty sad if it was, so that is a good thing). I have to go through the TFS API in order to get that result.&#xA;&#xA;Here is the API that I have to work with (actually, that is a drastically simplified API, but it contains all the stuff required to solve this issue).&#xA;&#xA;&#xA;  public interface ISourceControl&#xA;{&#xA;&#x9;int GetLatestId();&#xA;&#x9;LogItem QueryLog(VersionSpec from, VersionSpec to, int countToReturn);&#xA;}&#xA;&#xA;public class LogItem&#xA;{&#xA;&#x9;public SourceItemHistory[] History;&#xA;}&#xA;&#xA;public class History&#xA;{&#xA;&#x9;public int ChangeSetId;&#xA;&#x9;public DateTime CommitDateTime;&#xA;}&#xA;&#xA;public class DateVersionSpec : VersionSpec&#xA;{&#xA;&#x9;public DateTime Date;&#xA;}&#xA;&#xA;public class ChangesetVersionSpec : VersionSpec&#xA;{&#xA;&#x9;public int ChangesetId;&#xA;}&#xA;&#xA;&#xA;Your task, if you agree to accept it, is to build implement the following method:&#xA;&#xA;&#xA;  public int GetVersionForDate(DateTime date)&#xA;{&#xA;&#x9;// your implementation here&#xA;}&#xA;&#xA;&#xA;One important consideration is that you should reduce remote calls. I managed to get it down to 4 remote calls for the worst case scenario. It could have been 3, but TFS has some... finicky date handling.&#xA;&#xA;So, how would you solve the issue?</p>
        </article>
        <article id="article-7079">
            <a href="https://ayende.com/blog/3209/re-how-to-create-fully-encapsulated-domain-models" target="_blank">
                <h2 class="title mb-6" id="article-7079">Re</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 24, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A while ago Udi talked about How to create fully encapsulated Domain Models. He gave a great example, but more importantly, he gave some general rules of the thumb about how to create such a system.  Those rules are, if I understand them correctly:     Every message should resolve to a single method call on a domain object. The message handler is responsible for setting up the environment to call this method (getting the parameters, mostly).    The domain model should not throw exceptions. This is mostly because attempting to handle exceptions often lead to handling too much or too little. It is easier to define all the domain operations as throwing no exceptions, in which case all exceptions are infrastructure exceptions (or bugs).    Communication to the outside world is done using events. To decouple the domain from the service layer.   Things that I am not sure about:     What are the roles of services using this model. As a simple example, when new user is created, we should send a welcome email. This involves technical services (IEmailSender, ITemplateEngine, etc) and probably a domain service as well (INotifications.SendWelcome) I am not sure where those fit in.    Rules - Same thing. How do I handle things like executing a set of rules in a business action?   Anyway, I thought that it would be interesting to see how I would approach Udi&#x27;s sample using my own style. What I ended up with is this:     public class AddGameToCartMessageHandler : BaseMessageHandler&lt;AddGameToCartMessage&gt;     {      &#xA0;&#xA0;&#xA0; IRepository&lt;TradeInCart&gt; tradesRepository;      &#xA0;&#xA0;&#xA0; IRepository&lt;Game&gt; gamesRepository;            &#xA0;&#xA0;&#xA0; public AddGameToCartMessageHandler(      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; IRepository&lt;TradeInCart&gt; tradesRepository,       &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; IRepository&lt;Game&gt; gamesRepository)      &#xA0;&#xA0;&#xA0; {      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.tradesRepository = tradesRepository;      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.gamesRepository = gamesRepository;      &#xA0;&#xA0;&#xA0; }     &#xA0;&#xA0;&#xA0; [Transaction]     &#xA0;&#xA0;&#xA0; public override void Handle(AddGameToCartMessage m)      &#xA0;&#xA0;&#xA0; {      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Future&lt;TradeInCart&gt; cart = tradesRepository.GetFuture&lt;TradeInCart&gt;(m.CartId);&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Future&lt;TradeInCart&gt; g = gamesRepository.GetFuture&lt;Game&gt;(m.GameId);     &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SetupErrorHandling();     &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; cart.Value.Add(g.Value);     &#xA0;&#xA0;&#xA0; }            &#xA0;&#xA0;&#xA0; private void SetupErrorHandling()      &#xA0;&#xA0;&#xA0; {      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Domain.FailureEvents.GameReportedLost = delegate      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Bus.Return((int) ErrorCodes.GameReportedLost);      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; };&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Domain.FailureEvents.CartIsFull = delegate      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Bus.Return((int) ErrorCodes.CartIsFull);      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; };     &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Domain.FailureEvents.MaxNumberOfSameGamePerCartReached = delegate     &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Bus.Return((int) ErrorCodes.MaxNumberOfSameGamePerCartReached);      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; };      &#xA0;&#xA0;&#xA0; }      }   It doesn&#x27;t look that different, but let us look at the details, shall we?     We don&#x27;t deal with the session. That is duplicate code that can get quite annoying.    Transactions are implicit. This saves the whole (who forgot to call tx.Commit() ) again.    The use of futures to get both cart and game at the cost of a single call to the DB.    Moved error handling to a separate method.    We do not use events, this saves us the trouble of having to unregister them (or manage them using weak references)    What we can&#x27;t see is that an attempt from the domain model to call a delegate that wasn&#x27;t registered would raise an error. I don&#x27;t believe in ignoring errors.   I am not sure what to do about the transaction when we run into a domain error. Should we assume that the domain is smart enough to revert state changes? I am pretty sure that this is not something that we would like to assume. But, does it make sense to rollback the transaction?&#xA0; An attempt to add a game that was report lost should probably trigger some alert somewhere, we don&#x27;t want to roll that back, obviously.  Thoughts?</p>
        </article>
        <article id="article-7080">
            <a href="https://ayende.com/blog/3208/nservicebus-distributor-review" target="_blank">
                <h2 class="title mb-6" id="article-7080">NServiceBus Distributor Review</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 24, 2008
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Okay, NServiceBus Distributor deserve its own post. Broadly, the way it works is fairly simple.   Here is a simplified diagram, showing the workers and their queues, as well as the distributor and its queue. In here they are shown running on separate machines, but they could also be on the different processes.     Now, let us zoom into the distributor a bit, shall we?     Hm, we actually have two queues for the distributor, one is for workers, reporting for work (on the left), the second is applicative messages, which needs to be processed.  The reason that I think this is beautiful is quite simple, you submit work to the distributor queue, which forward it to one of the workers. So far, pretty standard stuff. The fun part starts when you talk about managing the workers.   On startup, each of the workers will send T notifications to the distributor, where T is the number of threads it is configured to use (yes, workers are threads in a machine, not a machine). When the distributor send a message to a worker, it also take it out from the available list. When the worker is done, it tells the distributor that it is ready again, at which point it become available to more work.  Very elegant solution. It is even more elegant when you look at the code to handle that:     private void messageBusTransport_TransportMessageReceived(     &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; object sender,       &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; TransportMessageReceivedEventArgs e)      {      &#xA0;&#xA0;&#xA0; if (disabled)      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.Rollback();     &#xA0;&#xA0;&#xA0; string destination = this.workerManager.PopAvailableWorker();     &#xA0;&#xA0;&#xA0; if (destination == null)     &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.Rollback();      &#xA0;&#xA0;&#xA0; else      &#xA0;&#xA0;&#xA0; {      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; logger.Debug(&quot;Sending message to: &quot; &#x2B; destination);      &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.messageBusTransport.Send(e.Message, destination);      &#xA0;&#xA0;&#xA0; }      }   Notice what happens if we don&#x27;t have an available worker. We simply rollback our current action and move on. We will try again in a short while, and hopefully then we will have a worker to dispatch to.  What about failure scenarios?  Well, at most a worker can &quot;lose&quot; a single message, since if it crashed, it will not report itself as available. If a machine crashes, then we might lose a bunch of messages (all the messages currently worked on by the workers on that machine), but it doesn&#x27;t hurt the overall system stability. When that machine comes back online, it will immediately starts to process those messages again.  Hm, there is actually an issue here with this scenario, since the workers will start working on their existing messages, but at the same time will report that they are ready for work. This just means that they will have work already queued by the time they are finished (and then they would report they are available again, of course). In general, I am okay with that.  What about the distributor itself? Again, crashing the distributor is generally not an issue. We are talking about using a durable transport here, so unprocessed messages will be saved and received when the distributor comes back again.  At the moment, I am not sure what happens if the distributor goes down for a lengthy period of time.</p>
        </article>
        <div class="button flex justify-between">
            <a href="707.html"><span class="back arrow"></span></a>

            <a href="709.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;🚀&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
