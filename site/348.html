
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 348 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-3471">
            <a href="https://ayende.com/blog/173697/the-siren-song-of-the-framework" target="_blank">
                <h2 class="title mb-6" id="article-3471">The siren song of the framework</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 21, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In a recent blog post, I talked about a problem we found in NLog with our usage scenario. I mentioned that we&#x2019;ll probably have our own solution to fit our needs. Eric Smith replied with:  So I guess there is no chance of contributing to the NLog project to improve it instead of creating yet another logging framework? And the short answer for that is that there is very little chance for that. Primarily because what we are doing is not really suitable for consumption elsewhere. Let us consider something that we found to be very useful. The Metrics.NET is a great way to get various metrics, and we have been using it (and contributed to it) for several years. But when looking at our 4.0 work, we also looked at what it would take to support metrics, and we had to flat out reject Metrics.NET for our use. Why is that? Primarily because it is doing too much. It is extremely flexible and can do quite a lot, but we don&#x2019;t need it to do a lot, and we don&#x2019;t want to pay for the stuff we don&#x2019;t use. For example, Histograms. The problematic issue for us was here: public void Update(long value, string userValue = null)&#xA;{&#xA;    this.last = new UserValueWrapper(value, userValue);&#xA;    this.reservoir.Update(value, userValue);&#xA;}&#xA;&#xA;&#xA;Which ends up calling:&#xA;public void Update(long value, string userValue = null)&#xA;{&#xA;    long c = this.count.Increment();&#xA;    if (c &lt;= this.values.Length)&#xA;    {&#xA;        values[(int)c - 1] = new UserValueWrapper(value, userValue);&#xA;    }&#xA;    else&#xA;    {&#xA;        long r = NextLong(c);&#xA;        if (r &lt; values.Length)&#xA;        {&#xA;            values[(int)r] = new UserValueWrapper(value, userValue);&#xA;        }&#xA;    }&#xA;}&#xA;&#xA;&#xA;So that means that we&#x2019;ll have two allocations for each time we update the histogram, which can happen a lot.&#xA0; We don&#x2019;t want to pay that price. &#xA;Now, we can certainly modify Metrics.NET to meet our needs, in fact, we have done just that, and ended up about 6 files that we needed, after we cleaned them up according to our current requirements. Contributing them back wouldn&#x2019;t make much sense, they are full of constraints that are meant to allow us to run a database server for months on end with predictable and reliable performance under very high load. They don&#x2019;t make sense in many other scenarios, and it can be incredibly limiting. &#xA;For a logging framework, we can most certainly add another option to NLog to do what we consider the right thing, but at this point, that wouldn&#x2019;t really make sense. We don&#x2019;t use a lot of the features, and reduce the surface area would mean reducing complexities. We can target something very narrow and get very high performance (in both CPU utilization and memory costs) much more easily &amp; cheaply than trying to convert an existing codebase.&#xA;This is not a new concept. There is a very real cost to making something reusable. And in our case, RavenDB doesn&#x2019;t need frameworks internally, we have a very good grasp about what is going on, and we want to have full ownership of every bit that is executed.</p>
        </article>
        <article id="article-3472">
            <a href="https://benfoster.io/blog/customising-claims-transformation-in-aspnet-core-identity/" target="_blank">
                <h2 class="title mb-6" id="article-3472">Customising claims transformation in ASP.NET Core Identity</h2>
            </a>
            <p class="mb-2">by Ben Foster</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 21, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">How to transform claims and customise claims identity creation in ASP.NET Core Identity.</p>
        </article>
        <article id="article-3473">
            <a href="https://ayende.com/blog/173762/ravendb-3-0-stable-release-30100" target="_blank">
                <h2 class="title mb-6" id="article-3473">RavenDB 3.0 stable release 30100</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 20, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Last week we released a stable release of RavenDB 3.0, which includes a whole bunch of fixes (full list is here) and optimizations. This is going to be the last stable release for RavenDB* 3.0, and we are going to be focusing our efforts in getting 3.5 out the door. We expect a early access version to be available this month . * Barring unforeseen major issues.</p>
        </article>
        <article id="article-3474">
            <a href="https://ayende.com/blog/173669/code-through-the-looking-glass-and-a-linear-search-to-rule-them" target="_blank">
                <h2 class="title mb-6" id="article-3474">Code through the looking glass</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 18, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The final piece for this candidate is the code to actually search through the sorted array. As you&#x27;ll recall, the candidate certainly made our computer pay for that sorting and merging. But we are fine now, we have manage to recover from all of that abuse, and we are ready to rock. Here is how the search (over sorted array) was implemented.  public List&lt;int&gt; EmailSearcher(string email)&#xA;{&#xA;    List&lt;int&gt; answer = new List&lt;int&gt;();&#xA;    for (int i = 0; i &lt; emailsArray.Length; i&#x2B;&#x2B;)&#xA;    {&#xA;        if (emailsArray[i].STR.ToString().Equals(email, StringComparison.OrdinalIgnoreCase))&#xA;        {&#xA;            answer = emailsArray[i].ID;&#xA;            return answer;&#xA;        }&#xA;    }&#xA;&#xA;    return answer;&#xA;}&#xA;&#xA;&#xA;And with that, I have nothing left to say.</p>
        </article>
        <article id="article-3475">
            <a href="https://enterprisecraftsmanship.com/posts/reference-data-as-code/" target="_blank">
                <h2 class="title mb-6" id="article-3475">Reference data as code</h2>
            </a>
            <p class="mb-2">by Vladimir Khorikov</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 17, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this article, I&#x2019;d like to write about a powerful technique that can potentially save you a lot of work and make your code much more concise: representing reference data as code.</p>
        </article>
        <article id="article-3476">
            <a href="https://ayende.com/blog/173668/code-through-the-looking-glass-sorting-large-data-sets" target="_blank">
                <h2 class="title mb-6" id="article-3476">Code through the looking glass</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 17, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The task in question was to read a CSV file (which is large, but can fit in memory) and allow quick searches on the data by email to find the relevant users. Most candidates handle that with a dictionary, but since our candidate decided to flip things around, he also included an implementation of doing this with sorted arrays. That is actually quite nice, in theory. In practice, it ended up something like this:  In order to truly understand the code, I have to walk you through a&#xA0; bunch of it.  It starts with the following fields:  List&lt;Structure&gt; emails = new List&lt;Structure&gt;();&#xA;&#xA;Structure[] namesArray = new Structure[0];&#xA;Structure, by the way, is a helper class that just has a key and a list of ids.&#xA0; The duplicate is strange, but whatever, let move on.&#xA;The class constructor is reading one line at a time and add an structure instance with the email and the line id to the emails list.&#xA;&#xA;public void ToArray()&#xA;{&#xA;    emailsArray = this.emails.ToArray();&#xA;}&#xA;&#xA;&#xA;This code just copy emails to the array, we are not sure why yet, but then we have:&#xA;&#xA;public void Sort()&#xA;{&#xA;    Array.Sort(emailsArray, delegate(Structure x, Structure y) { return x.STR.CompareTo(y.STR); });&#xA;}&#xA;&#xA;&#xA;So far, this is right in line with the &quot;use a sorted array&quot; method that the candidate talked about. There is a small problem here, because emails are allowed to be duplicated, but no fear, our candidate can solve that&#x2026;&#xA;&#xA;public void UnifyIdLists()&#xA;{&#xA;    for (int i = 0; i &lt; emailsArray.Length; i&#x2B;&#x2B;)&#xA;    {&#xA;        if (i &#x2B; 1 == emailsArray.Length)&#xA;            break;&#xA;        if (emailsArray[i].STR.Equals(emailsArray[i &#x2B; 1].STR))&#xA;        {&#xA;            emailsArray[i].ID.AddRange(emailsArray[i &#x2B; 1].ID);&#xA;            emailsArray[i &#x2B; 1] = null;&#xA;            List&lt;Structure&gt; temp = emailsArray.ToList&lt;Structure&gt;();&#xA;            temp.RemoveAll(item =&gt; item == null);&#xA;            emailsArray = temp.ToArray();&#xA;        }&#xA;    }&#xA;}&#xA;&#xA;&#xA;The intent of this code is to merge all identical email values into a single entry in the list. &#xA;Now, to put things in perspective, we are talking about a file that is going to be around the 500MB in size, and there are going to be about 3.5 million lines in it.&#xA;That means that the emailsArray alone is going to take about 25MB. &#xA;Another aspect to consider is that we are using dummy data in our test file. Do you want to guess how many duplicates there are going to be there? Each of which is generating two 25MB allocations and multiple passes over an array of 3.5 million items in size.&#xA;Oh, and for the hell of it, the code above doesn&#x27;t even work. Consider the case when we have three duplicates&#x2026;</p>
        </article>
        <article id="article-3477">
            <a href="https://ayende.com/blog/173667/code-through-the-looking-glass-im-the-god-of-all-oop" target="_blank">
                <h2 class="title mb-6" id="article-3477">Code through the looking glass</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 16, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We typically don&#x27;t look too deeply into the overall design on a candidate&#x27;s code. Most coding tasks just aren&#x27;t big enough to warrant it.  When we do, it is typically because the candidate has done something&#x2026; peculiar. For example, we have had a candidate that send a submission with no less than 17 classes to manager reading a CSV file and populating a dictionary. At some point we knew that this candidate wasn&#x27;t going to move forward, but it became a challenge, to try to outline how the data actually traveled through that particular maze. But as much as we love Mr. Goldberg, I&#x27;m afraid that dear Rubbie isn&#x27;t going to be remembered for much longer.  Here is how this candidate code started:  static void Main(string[] args)&#xA;{&#xA;    //Call for parsing method&#xA;    HelperClass cr = new HelperClass();&#xA;    cr.CsvParser();&#xA;    cr.ToArray();&#xA;    cr.Sort();&#xA;    cr.UnifyIdLists();&#xA;    //ask the user to enter input&#xA;    string input = cr.InputReader();&#xA;&#xA;&#xA;I actually started explaining the issues in this code, but I run out of&#x2026; pretty much everything. &#xA;I have a challenge for you, can you think of a single OOP principle that isn&#x27;t being broken here?&#xA;For&#x2026; fun, I guess, you can also look at the following code, which come just after the one above:&#xA;&#xA;Start:&#xA;    //check input type&#xA;    switch (cr.InputTester(input))&#xA;    {&#xA;        case 0:&#xA;            //valid email structure, but the input is not found in the file&#xA;            List&lt;int&gt; emails = new List&lt;int&gt;();&#xA;            emails = cr.EmailSearcher(input);&#xA;            if (emails.Count == 0)&#xA;            {&#xA;                Console.WriteLine(&quot;The input you have entered has not been found in the file. \nPlease try again.&quot;);&#xA;                input = cr.InputReader();&#xA;                goto Start;&#xA;            }&#xA;&#xA;I guess someone heard that loops are a performance bottleneck in most applications and decided to do away with them.</p>
        </article>
        <article id="article-3478">
            <a href="https://ayende.com/blog/173666/code-through-the-looking-glass-all-you-need-is-a-dictionary-and-o-n" target="_blank">
                <h2 class="title mb-6" id="article-3478">Code through the looking glass</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 15, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The first question that ask in the coding task goes something like this: &quot;Given a CSV file containing users&#x27; data, who is large, but can fully fit into memory, we want to be able to search by email address very quickly and get all the matching user ids. Optimize for fast queries over fast startup&quot;. The intent is basically that you&#x27;ll read the file and load that into a dictionary, then use that to perform queries. This candidate has done just that, although things started being strange pretty much from the get go&#x2026;  Dictionary&lt;int, string&gt; emails = new Dictionary&lt;int, string&gt;();&#xA;That seemed like a pretty strange way to set things up, but we have seen crazier. At this point I thought that they are probably storing the hash code of the email in the dictionary, and the string value is the concatenated list of all the matching ids.&#xA;The truth was&#x2026; far more interesting. Here is the code for querying:&#xA;&#xA;public Dictionary&lt;int, int&gt; EmailSearcher(string email)&#xA;{&#xA;    Dictionary&lt;int, int&gt; answer = new Dictionary&lt;int, int&gt;();&#xA;    int count = 0;&#xA;    foreach (var entry in emails)&#xA;    {&#xA;        if (entry.Value.ToString().Equals(email, StringComparison.OrdinalIgnoreCase))&#xA;        {&#xA;            answer.Add(count, entry.Key);&#xA;            count&#x2B;&#x2B;;&#xA;        }&#xA;&#xA;    }&#xA;    return answer;&#xA;}&#xA;&#xA;&#xA;This code actually have multiple levels of strangeness. The obvious one is that this is doing a linear search on the dictionary, but look at the return type as well&#x2026;&#xA;The candidate was well aware that this code is not able to handle large amount of information, so the candidate sent us an alternative implementation. But I&#x27;ll talk about that in my next post.</p>
        </article>
        <article id="article-3479">
            <a href="https://ayende.com/blog/173665/code-through-the-looking-glass-finding-todays-log-file" target="_blank">
                <h2 class="title mb-6" id="article-3479">Code through the looking glass</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 14, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">You might have noticed that we are looking for more people again. Mostly because I gripe about some of the bad ones here every now and then.&#xA;One of my absolute requirements is that I want to read a candidate&#x27;s code before hiring them. Some of them have made significant contributions to Open Source code, but a large number don&#x27;t have any significant body of code that they can show. That is why we ask candidates to send us a coding test.&#xA;We had people flat out refuse to do the coding test, and some who thought that the questions were incredibly hard and unrealistic. We had people who sent in code that was so bad it caused migraines, we had people who sent in code that wouldn&#x27;t compile, we&#xA0; had people do stuff like read a 15TB file (16,492,674,416,640)! times. And just to clarify, that is factorial(16492674416640). I don&#x27;t know what the actual value of this number is, but is it big.&#xA;The nice thing is that you can usually tell right away when the code is bad. We also play a game called &quot;guess the candidate&#x27;s background&quot;. We have about 89% success rate there*.&#xA;Spotting good code is much harder, because a really successful submission is going to be boring. It does what needs to be done, and that is it. Our most recent hire&#x27;s code submission was so boring, we had to analyze it using our standard metrics to find issues (our standard metrics are for production code running in a high performance DB for months on end, not the same metrics we evaluate code submissions).&#xA;And then&#x2026; then there is this candidate, whose code is so unique that I decided to dedicate a full week to explore it. The code looks good, documented, there are explanations that show what is going on and they are going in the right direction, on the surface of it.&#xA;And then there is the devil in the details. I have quite a lot to write about this particular submission, but I&#x27;ll just start with the following:&#xA;&#xA;&#xA;//Find today&#x27;s log file in the directory&#xA;public string LogFileFinder()&#xA;{&#xA;    string[] files = Directory.GetFiles(LoggingAggregation.Program.GlobalVar.path, &quot;*.log&quot;);&#xA;    for (int i = 0; i &lt; files.Length; i&#x2B;&#x2B;)&#xA;    {&#xA;        int slash = files[i].LastIndexOf(@&quot;\&quot;);&#xA;        int dot = files[i].LastIndexOf(&quot;.&quot;);&#xA;        string fileName = files[i].Substring(slash &#x2B; 1, dot - slash - 1);&#xA;        string fileDate = DateTime.Now.ToString(&quot;yyyy-MM-dd&quot;);&#xA;        if (fileName.Equals(fileDate))&#xA;            return fileName &#x2B; &quot;.log&quot;;&#xA;    }&#xA;&#xA;    return null;&#xA;}&#xA;&#xA;&#xA;&#xA;Now, another way to write this code would be:&#xA;&#xA;&#xA;Path.Combine(LoggingAggregation.Program.GlobalVar.path, DateTime.Now.ToString(&quot;yyyy-MM-dd&quot;) &#x2B;&quot;.log&quot;) &#xA;&#xA;&#xA;&#xA;I literally stared at this piece of code for several minutes, trying to figure out what is actually going on there. I wasn&#x27;t able to.&#xA;As an aside, we sent the candidate a rejection notice, along with a few pointers to some of the more egregious things that were wrong in the code.&#xA0; They know how to code, it is just that it goes sideway in the middle.&#xA;* The game call to guess the candidate&#x27;s default language settings. That is, someone who write C# code, but has been brought up on C, so have a C style to the code.</p>
        </article>
        <article id="article-3480">
            <a href="https://ayende.com/blog/173671/logging-yourself-to-death" target="_blank">
                <h2 class="title mb-6" id="article-3480">Logging yourself to death</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: March 10, 2016
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of our clients had opened a support incident. Under certain conditions, RavenDB will issue so much I/O requests that it will effectively lock the I/O system. The condition was cold boot when you have many hundreds of databases on the server, and you force all of them to start immediately. We applied a policy to rate limit the number of concurrently loading databases, sent a hotfix, and was done.&#xA;Everyone was happy, there were birds singing, babies chasing puppies and long walks on the beach.&#xA;Then the customer called back, &#x201C;ever since we applied the hotfix, everything became slower&#x201D;. A code review of the changes by two different team members uninvolved in the original hotfix produced similar conclusion, the affected code was only on the db load code path, and there was no possible way it could impact requests. Attempts to reproduce this locally has been unsuccessful.&#xA;Working with the customer, we managed to figure out that the problem was related to high CPU usage, which also ruled out the hotfix, since that would have been slowness because of a lock. Digging further, we discovered that most of the time was spent in GC work. That gave us a good handle to start digging. We discovered that on the production system, RavenDB was allocating roughly 4GB / second.&#xA;That is&#x2026; a lot of memory to allocate. And the size of the Gen2 heap was really high.&#xA;But what was causing all of this angst?&#xA;As it turned out, during the previous support incidents, the log level has been changed to use Debug. And we output a lot to the log. Now, while that is pretty obvious, and easily resolved, we dug down deeper and found out exactly what was causing this.&#xA;To understand what is going on, you have to remember the current situation, we are on a busy server, hundreds of databases, and a log level set to debug. The logs were writing to the same disk as the databases, which happened to be on a remote SAN.&#xA0; Combined with the I/O pressure from all of those databases, that meant that I/O writes to the log could take quite a bit of time.&#xA;Now, RavenDB is configured to use async logging exactly for this purpose. So we&#x2019;ll not pay for slow I/O in the logs. And NLog is a mature project, which already considered the case of flooding and potential memory leak as a result of too many log messages.&#xA;This is implemented in the following method:&#xA;&#xA;public void Enqueue(AsyncLogEventInfo logEventInfo)&#xA;{&#xA;    lock (this)&#xA;    {&#xA;        if (this.logEventInfoQueue.Count &gt;= this.RequestLimit)&#xA;        {&#xA;            InternalLogger.Debug(&quot;Async queue is full&quot;);&#xA;            switch (this.OnOverflow)&#xA;            {&#xA;                case AsyncTargetWrapperOverflowAction.Discard:&#xA;                    InternalLogger.Debug(&quot;Discarding one element from queue&quot;);&#xA;                    this.logEventInfoQueue.Dequeue();&#xA;                    break;&#xA;                // other options removed for brevity&#xA;            }&#xA;        }&#xA;&#xA;        this.logEventInfoQueue.Enqueue(logEventInfo);&#xA;    }&#xA;}&#xA;&#xA;The log is configured to use Discard on overflow, which is why I&#x2019;m showing only this code.&#xA;I wasn&#x2019;t aware that NLog just took a lock like that, but that isn&#x2019;t what bothering me. What this code is doing is saying: &#x201C;Okay, I run to the limit, let us discard&#xA0;the stuff that is in the queue the longest time&#x201D;.&#xA;What this effectively did was to keep references to the log entries in memory, just long enough for them to hit Gen2, and then just discard them. In the meantime, any new entry would go into the queue, where it would mature into Gen2, but likely will be discarded as well.&#xA;There is a word for it, and it goes like this:</p>
        </article>
        <div class="button flex justify-between">
            <a href="347.html"><span class="back arrow"></span></a>

            <a href="349.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
