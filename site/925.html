
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 925 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-9241">
            <a href="https://ayende.com/blog/1067/price-of-indirection" target="_blank">
                <h2 class="title mb-6" id="article-9241">Price of Indirection</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 20, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">How goes that old saying? &#xA;Anything in computers can be solved by adding another layer of indirection, except too many levels of indirection.&#xA;I find myself contemplating that a lot lately. I&#x27;m fighting performace troubles quite a bit lately. And right now my pet devil is this creature and its friends:&#xA;CREATE VIEW LastBusinessDayTransactions&#xA;AS&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SELECT * FROM Transactions&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHERE TransactionDate = (SELECT max(TradeDate) FROM TradeDates&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHERE TradeDate &lt; (SELECT max(TradeDate) FROM TradeDates))&#xA;&#xA;This is supposed to be a view that will return the transactions from the lats business days (assuming that the max trade date is the current date).&#xA;The issue is that doing anything on this view is slow. Selecting isn&#x27;t bad, but inserting / updating is very slow. I&#x27;m pretty sure that it&#x27;s considered bad manners to update / insert to views, though.&#xA;What interest me is that even selecting speed can be significantly improved by pre-calculating the last trade date value outside the select statement. So far I haven&#x27;t found a way to do this using a view (and it has got to stay a view, unfortantely.</p>
        </article>
        <article id="article-9242">
            <a href="https://ayende.com/blog/1066/filesystemwatcher-visual-studio-2005" target="_blank">
                <h2 class="title mb-6" id="article-9242">FileSystemWatcher &amp; Visual Studio 2005</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 20, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Okay, I&#x27;ve this very strange bug. I got an application that watch over a folder for changes in the files. When I edit the files in Visual Studio 2005, the application doesn&#x27;t do anything. But when I edit the file in notepad, the change event is fired and everything is fine. Anyone knows what is going on there?&#xA;Here is sample code the shows the problem:&#xA;&#xA;&#xA;import System&#xA;&#xA;import System.IO&#xA;&#xA;&#xA0;&#xA;&#xA;class Bug:&#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; watch as FileSystemWatcher&#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; &#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; def StartWatching():&#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; watcher = FileSystemWatcher(&quot;&quot;&quot;C:\Test&quot;&quot;&quot;, Filter: &quot;*.*&quot;)&#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; watcher.Changed &#x2B;= def(source, e as FileSystemEventArgs):&#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; print &quot;${e.FullName} has changed ${DateTime.Now}&quot;&#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; watcher.EnableRaisingEvents = true;&#xA;&#xA;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; print &quot;Watching...&quot;&#xA;&#xA;&#xA0;&#xA;&#xA;Bug().StartWatching.BeginInvoke()&#xA;&#xA;&#xA0;&#xA;&#xA;Console.Read()</p>
        </article>
        <article id="article-9243">
            <a href="https://ayende.com/blog/1065/i-made-it-into-the-polish-wikipedia" target="_blank">
                <h2 class="title mb-6" id="article-9243">I made it into the Polish Wikipedia</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 20, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x27;m not sure how, but I&#x27;m on the Polish Wikipedia (at least I think that PL is polish).&#xA;Anyone can translate what is said there?&#xA;Update: It would be nice if I provided a link, wouldn&#x27;t it? I could&#x27;ve swore that I did so. Opps.&#xA;Here is the link.&#xA;Thanks to Matthijs&#xA0;for noticing.</p>
        </article>
        <article id="article-9244">
            <a href="https://ayende.com/blog/1064/castle-demo-app-many-to-many-relations" target="_blank">
                <h2 class="title mb-6" id="article-9244">Castle Demo App</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 19, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We have users and we have bugs, but it is still not enough to create a good application, we need to group the bugs to projects, and we need to be able to assign users to projects. So, without further ado, let&#x2019;s write the Project class.     What do we need to have in a project? The project name, the default assignee (remember that all bugs are assigned always.), the bugs in the project and the users working on it. With that said, let&#x2019;s start with building a simple Project class.              [ActiveRecord(&quot;Projects&quot;)]        public class Project : ActiveRecordBase&lt;Project&gt;             We define the class as usual, with an [ActiveRecord] attribute pointing to the Projects table and inheriting from ActiveRecordBase&lt;T&gt;.                                            &#xA0;&#xA0;&#xA0; [PrimaryKey(PrimaryKeyType.Identity,                        &#xA0;&#xA0;&#xA0;&#xA0; Access = PropertyAccess.NosetterCamelcaseUnderscore)]                        &#xA0;&#xA0;&#xA0; public int Id                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;get { return _id; }                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; [Property]                        &#xA0;&#xA0;&#xA0; public string Name                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _name; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { _name = value; }                        &#xA0;&#xA0;&#xA0; }        The Id and Name declarations we are already familiar with, so let&#x2019;s move to the more interesting stuff. A project has a relation of one to many to bugs. We&#x2019;ve already seen how we create one to many connections when we added the AssignedBugs and OpenBugs to the User class.            &#xA0;&#xA0;&#xA0; [HasMany(typeof(Bug), ColumnKey = &quot;Project&quot;, RelationType = RelationType.Set,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CustomAccess = &quot;NHibernate.Generics.GenericAccessor, NHibernate.Generics&quot;,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Lazy = true)]                        &#xA0;&#xA0;&#xA0; public EntitySet&lt;Bug&gt; Bugs                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _bugs; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { _bugs = value; }                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; [HasMany(typeof(Bug), ColumnKey = &quot;Project&quot;, RelationType = RelationType.Set,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CustomAccess = &quot;NHibernate.Generics.GenericAccessor, NHibernate.Generics&quot;,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Where = &quot;Status = 1&quot;, Lazy = true)]                        &#xA0;&#xA0;&#xA0; public EntitySet&lt;Bug&gt; OpenBugs                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _openBugs; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { _openBugs = value; }                        &#xA0;&#xA0;&#xA0; }        The only difference we have is that the ColumnKey is set to the Project column (which currently doesn&#x2019;t exist, we will create it in a couple of minutes.) We define another relation to the default assignee, like this:            &#xA0;&#xA0;&#xA0; [BelongsTo]                        &#xA0;&#xA0;&#xA0; public User DefaultAssignee                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _defaultAssignee.Value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { _defaultAssignee.Value = value; }                        &#xA0;&#xA0;&#xA0; }                        All the relations between the objects are using EntityRef&lt;T&gt; and EntitySet&lt;T&gt;, which are initialized in the constructor:            &#xA0;&#xA0;&#xA0; public Project()                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; _bugs = new EntitySet&lt;Bug&gt;(                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(Bug bug) { bug.Project = this; },                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(Bug bug) { bug.Project = null; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; );                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; _openBugs = new EntitySet&lt;Bug&gt;();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; _defaultAssignee = new EntityRef&lt;User&gt;();                        &#xA0;&#xA0;&#xA0; }        Note that the only collection with behavior is the _bugs collection, _OpenBugs and _defaultAssignee don&#x2019;t have actions associated with them (since we don&#x2019;t care about add/removing to the OpenBugs collection, and there is no reverse collection from the Default Assignee to the project. Now we only need to make the modifications to the Bug class.    First, we add an EntityRef&lt;Project&gt; variable, and initialize it in the constructor, notice that we pass two methods that will be executed when a project is set / replaced.            &#xA0;&#xA0;&#xA0; _project = new EntityRef&lt;Project&gt;(AddBugToProject, RemoveBugFromProject);        Those two methods are similar to the ones we defined for Users re-assignment:            &#xA0;&#xA0;&#xA0; private void AddBugToProject(Project project)                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.Bugs.Add(this);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (Status == BugStatus.Opened)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.OpenBugs.Add(this);                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; private void RemoveBugFromProject(Project project)                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.Bugs.Remove(this);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (Status == BugStatus.Opened)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.OpenBugs.Remove(this);                        &#xA0;&#xA0;&#xA0; }        As you recall, we would like to keep the objects and the database in sync, even across smart actions, so we make sure that status changes to the bug update the OpenBugs collection in the assigned user and in the parent project, since I started to get quite a bit of code in the property setter, I broke it into separate methods, here is how the Update Project Status method look like:            &#xA0;&#xA0;&#xA0; private void UpdateProjectStatus(BugStatus value)                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (Project != null) // during database load                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (_status == BugStatus.Opened)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Project.OpenBugs.Remove(this);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (value == BugStatus.Opened)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Project.OpenBugs.Add(this);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0; }                        Let&#x2019;s just fix the database schema so that it would match what we did so far, we&#x2019;ll start with the Projects table:                                            CREATE TABLE [dbo].[Projects](                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Id] [int] IDENTITY(1,1) NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Name] [nvarchar](255) COLLATE Hebrew_CI_AS NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [DefaultAssignee] [int] NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CONSTRAINT [PK_Projects] PRIMARY KEY CLUSTERED                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; (                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Id] ASC                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; )                        )                        Now we can update the Bugs table with the new relationship. Because we update an existing table, the process is a bit awkward:            ALTER TABLE [Bugs]                        ADD [Project] INT NULL                        GO                        INSERT INTO Projects(Name, DefaultAssignee)                        VALUES(&#x27;Default Project&#x27;, 1)                        GO                        UPDATE Bugs                        SET Project = 1                        GO                        ALTER TABLE [Bugs]                        ALTER COLUMN [Project] INT NOT NULL                        GO                        ALTER TABLE [dbo].[Bugs]&#xA0; WITH CHECK ADD&#xA0;                                 CONSTRAINT [FK_Bugs_Projects] FOREIGN KEY([Project])                        REFERENCES [dbo].[Projects] ([Id])                        GO                        As a sanity check, I wrote the following test:            &#xA0;&#xA0;&#xA0; [Test]                        &#xA0;&#xA0;&#xA0; public void ProjectBugs()                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User dar = new User(&quot;Dar&quot;, &quot;Fubar&quot;, &quot;Dar@bar.com&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; dar.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Project project = new Project(&quot;Test Project&quot;, dar);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Bug bug = new Bug(project, &quot;Nasty&quot;, &quot;Figure it out!&quot;, dar);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; bug.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, project.Bugs.Count);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, project.OpenBugs.Count);                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; using (new SessionScope())                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Project fromDb = Project.Find(project.Id);                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreNotSame(project, fromDb);                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, fromDb.Bugs.Count);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, fromDb.OpenBugs.Count);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0; }        As you can see, since the default mode of a bug is open, and since it is automatically added to the project on creation, we suddenly get an project bug as well as an open bug. The new SessionScope requires some explanation, though. The issue here is that Active Record is smart enough to realize that there is already an existing Project with the Id that I&#x27;m trying to load from the database, so what will happen if I won&#x27;t use the sessionScope is that I&#x27;ll get the same instance as I already has. This is very useful most of the time, but not when I&#x27;m testing that the instance I get from the database is valid. Because of this, I open a new SessionScope, and force Active Record to ignore the fact that it already has the object that I want in memory.    So far, we&#x2019;ve gone over much of the things we&#x2019;ve done before, it&#x2019;s time we will try something new. I mentioned that we need to be able to assign users to projects. Users can belong to multiply projects, and a project has mutliply users assigned to it. This means that we need to use a many to many connection between Users and Projects, let&#x27;s see how we implement that, shall we?    We&#x27;ll start by adding a Users property to the Project class, as usual, the field will be of type EntitySet&lt;User&gt;, but the property type will be ICollection&lt;User&gt; (EntitySet and EntityRef are implementation details):            &#xA0;&#xA0;&#xA0; [HasAndBelongsToMany(typeof(User),RelationType.Set,Table=&quot;UsersProjects&quot;,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CustomAccess = &quot;NHibernate.Generics.GenericAccessor, NHibernate.Generics&quot;,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ColumnKey=&quot;Project&quot;,ColumnRef=&quot;`User`&quot;,Lazy=true)]                        &#xA0;&#xA0;&#xA0; public ICollection&lt;User&gt; Users                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _users; }                        &#xA0;&#xA0;&#xA0; }        Okay, a couple of new things here. First, we have the HasAndBelongToMany, which is the way Active Record define many to many relationships, then we have the table that connects the objects. We already know what CustomAccess mean (needed to support the EntitySet / EntityRef). We need to pay attention to ColumnKey and ColumnRef. The ColumnKey specify which column refers to the primary key of the current project, and the ColumnRef specify which column refers to the primary key of the associated User.    It&#x27;s important to note that the User column in the ColumnRef is surrounded by backticks (the ` character, it&#x27;s not dirt on your screen, I assure you.), we need it to tell Active Record to wrap the calls to User with quotes (in SQL Server case, it&#x27;s sent as [User]).     Here is how we initialized the _users field:            &#xA0;&#xA0;&#xA0; _users = new EntitySet&lt;User&gt;(                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(User user) { user.Projects.Add(this); },                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(User user) { user.Projects.Remove(this); },                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; InitializeOnLazy.Always);        As usual, we pass delegates that handles the connection on the other side, but now we also pass a InitializeOnLazy.Always. Why do we need it? It&#x27;s needed because one side of the connection must be responsible for persisting the connection. I decided that the side responsible for this would be the Project, so we need to add this value to tell the EntitySet to threat it a little differently.    We define the connection on the other side in much the same way. Here is how the Projects property on the User class looks:            &#xA0;&#xA0;&#xA0; [HasAndBelongsToMany(typeof(Project), RelationType.Set, Table = &quot;UsersProjects&quot;,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CustomAccess = &quot;NHibernate.Generics.GenericAccessor, NHibernate.Generics&quot;,                        &#xA0;&#xA0;&#xA0;&#xA0; ColumnKey = &quot;`User`&quot;, ColumnRef = &quot;Project&quot;, Lazy = true, Inverse=true)]                        &#xA0;&#xA0;&#xA0; public ICollection&lt;Project&gt; Projects                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _projects; }                        &#xA0;&#xA0;&#xA0; }        As you can see, we need to reverse the ColumnKey and ColumnRef values. We still use backticks for the User column, since it&#x27;s reserved word in SQL Server. We also specify that the connection is the respnsibility of the other side by adding Inverse = true to the attribute. Initializing the _projects field is done as usual, and we don&#x27;t pass any special values to it:                                            &#xA0;&#xA0;&#xA0; _projects = new EntitySet&lt;Project&gt;(                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(Project project) { project.Users.Add(this); },                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(Project project) { project.Users.Remove(this); });        Now we can define the table UsersProjects, like this:            CREATE TABLE [dbo].[UsersProjects](                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Id] [int] IDENTITY(1,1) NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Project] [int] NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [User] [int] NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CONSTRAINT [PK_UsersProjects] PRIMARY KEY CLUSTERED                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; (                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Id] ASC                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; )                        )                                 GO                        ALTER TABLE [dbo].[UsersProjects]&#xA0; WITH CHECK ADD&#xA0;                                 CONSTRAINT [FK_UsersProjects_Projects] FOREIGN KEY([Project])                        REFERENCES [dbo].[Projects] ([Id])                        GO                        ALTER TABLE [dbo].[UsersProjects]&#xA0; WITH CHECK ADD&#xA0;                                 CONSTRAINT [FK_UsersProjects_Users] FOREIGN KEY([User])                        REFERENCES [dbo].[Users] ([Id])                        GO        This is it, we have a many to many relationship between users and projects. Now we can test that everything works:            &#xA0;&#xA0;&#xA0; [Test]                        &#xA0;&#xA0;&#xA0; public void ProjectsUsers()                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User dar = new User(&quot;Dar&quot;, &quot;Fubar&quot;, &quot;Dar@bar.com&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; dar.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User foo = new User(&quot;Foo&quot;, &quot;Bar&quot;, &quot;Foo@bar.org&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; foo.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Project project = new Project(&quot;Test Project&quot;, dar);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.Users.Add(foo);                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, foo.Projects.Count);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; project.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; using (new SessionScope())                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Project fromDb = Project.Find(project.Id);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreNotSame(project, fromDb);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, fromDb.Users.Count);                                &#xA0;                        &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;User userFromDb = User.Find(foo.Id);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreNotSame(foo, userFromDb);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, foo.Projects.Count);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0; }        This is quite a bit of code, but basically we create two users (the default assignee don&#x27;t necessarily belongs to the project) add it to the project and save the project. It is the project state was changed. Remember that we decided that the responsability of the connection is on the Project, that is what it means. If we will save the user foo, nothing will happen in the database.    We then open a new SessionScope to avoid getting the same instance from Active Record caching, get the data from the database, and make sure that the connection is live on both ends.    So far, it&#x27;s pretty simple. There is quite a bit more to Active Record, &#xA0;from cascades to composite keys to life cycle and validations, all of which I&#x27;m not going to cover. What we have now are the basis of Active Record, which is more than enough to move forward. It&#x27;s time we start writing some code that has some visible affects.    On my next post in this series... skimming the surface of MonoRail... stay tuned.</p>
        </article>
        <article id="article-9245">
            <a href="https://ayende.com/blog/1063/profiling-sql-server" target="_blank">
                <h2 class="title mb-6" id="article-9245">Profiling SQL Server</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 19, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I know about SQL Profiler and Execution plans. What I need is a way to measure how much a stored procedure cost in time.&#xA;What I mean is that I&#x27;ve this:&#xA;&#xA;Start&#xA;&#xA;Step 1&#xA;Step 2&#xA;Step 3&#xA;&#xA;Step 3.1&#xA;Step 3.1&#xA;I want to know how much time each procedure takes, preferably in real time &quot;The current running procedure is X, started fifteen minutes ago&quot;.&#xA;Any ideas?</p>
        </article>
        <article id="article-9246">
            <a href="https://ayende.com/blog/1062/piping-primary-keys-and-three-hours-ill-not-get-back" target="_blank">
                <h2 class="title mb-6" id="article-9246">Piping, Primary Keys and Three Hours I&#x27;ll not get back</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 19, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Okay, so I mentioned that I&#x27;d a query that violated a primary key constraint, and I couldn&#x27;t figure out why. Well, I finally got a hold of what was going on. It&#x27;s simple and non-obvious at the same time. Let&#x27;s start with a code example that shows the problem and then I&#x27;ll put in a couple of words about the reasons behind it. First, let&#x27;s create a table with a unique constraint (easier than a primary key):&#xA;CREATE TABLE Foo&#xA;(&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Bar INT UNIQUE&#xA;)&#xA;Now, let&#x27;s insert some data into the table:&#xA;INSERT INTO Foo&#xA;SELECT 1 UNION ALL &#xA;SELECT 2 UNION ALL&#xA;SELECT 3&#xA;So far, everything is nice and cozy, but now I want to add more numbers, so I want to make sure that I won&#x27;t break the code, so now I&#x27;ll add a guard clause to the next inserts:&#xA;INSERT INTO Foo&#xA;SELECT Kabum FROM&#xA;(&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SELECT 4 as Kabum UNION ALL &#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SELECT 5 as Kabum UNION ALL &#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SELECT 5 as Kabum&#xA;) Bang&#xA;WHERE NOT EXISTS &#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; (SELECT 1 FROM Foo where Bang.Kabum = Bar)&#xA;Running the above result in this error:&#xA;Violation of UNIQUE KEY constraint &#x27;UQ__Foo__5832119F&#x27;. Cannot insert duplicate key in object &#x27;dbo.Foo&#x27;.&#xA;Do you realize what happened here? We failed because when we checked it was just fine to put 5 into Foo, but when we actually did put the second 5 into Foo, that caused a constraint violation. Go figure that when you&#x27;re dealing with sixteen million records.&#xA;The solution to this problem is to add a distinct to the select statement, that would make sure that your own query isn&#x27;t causing the very same query to fail.&#xA;On that note, I wonder if I can call it a concurrency bug.</p>
        </article>
        <article id="article-9247">
            <a href="https://ayende.com/blog/1061/best-practice" target="_blank">
                <h2 class="title mb-6" id="article-9247">Best Practice</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 19, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I realized that I didn&#x27;t explain a little of the background story about the last post. For some reason the (real, not the one I posted) query is violating a primary key constraint. When I tried to check it, it would think for a long while, and then spit out the error.&#xA;I know it&#x27;s evil to optimize buggy code, but at least now when it fails, it fails fast.</p>
        </article>
        <article id="article-9248">
            <a href="https://ayende.com/blog/1060/optimization-story" target="_blank">
                <h2 class="title mb-6" id="article-9248">Optimization Story</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 19, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just got out of struggling with a very long query. If you missed it, I&#x27;m working on SQL quite a bit lately, and I keep discovering new things about it. Here is a query similar to the one I was working on, the idea is to update the Summary table with new information about actions that haven&#x27;t been summed yet. For instance, a transaction that occured three days ago, but only now entered the database. This query took over 20 minutes to run before I killed it. (Sorry for the rather complex query, I&#x27;m afraid it doesn&#x27;t really translate itself with simpler ones).&#xA;INSERT INTO LogSummary&#xA;(&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; PartitionId,&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SummaryDate,&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ActionId,&#xA0;&#xA0; &#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SuccessCount,&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; FailCount&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA;)&#xA;SELECT&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; dbo.LogSummaryPartitionId(td.TradeDate),&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; td.TradeDate,&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; la.ActionId,&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SUM(case Result when &#x27;V&#x27; then 1 else 0 end) as SuccessCount,&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SUM(case Result when &#x27;X&#x27; then 1 else 0 end) as FailCount&#xA;FROM LogActions la join (SELECT TradeDate FROM TradeDates where Status = 1) td&#xA;ON&#xA0;&#xA0;&#xA0; la.Date = td.TradeDate&#xA;WHERE NOT EXISTS (SELECT 1 FROM LogSummary ls&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHERE ls.PartitonId = dbo.LogSummaryPartitionId(td.TradeDate)&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AND&#xA0;&#xA0; ls.SummaryDate = td.TradeDate&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AND ls.ActionId = la.ActionID)&#xA;GROUP BY ls.ActionId, td.TradeDate&#xA;&#xA;&#xA0;&#xA;&#xA;&#xA;I know that this query doesn&#x27;t make much sense, by the way, it is the best I could come up with for the purpose of discussion.&#xA;If we look at the query we can see that we have a call to LogSummaryPartitionId() function and a subquery make sure we are not inserting duplicate rows (which also call to LogSummaryPartitionId() ). When you consider that the first LogSummaryPartitionId() call and the sub query needed to run per row, and that the second LogSummaryPartitionId() call run per each row in both queries, I think you can realize why it took such a long time to run.&#xA;Considerring that the information from LogSummaryPartitionId() doesn&#x27;t change that often, I decided to move it outside the query, so it would be calculated once, instead of per row. It ended up looking like this:&#xA;SELECT dbo.LogSummaryPartitionId(TradeDate) as PartitionId, TradeDate&#xA;INTO #TradeDateWithPartitionId&#xA;FROM TradeDates WHERE Status = 1&#xA;&#xA0;&#xA;INSERT INTO LogSummary&#xA;(&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; PartitionId,&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SummaryDate,&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ActionId,&#xA0;&#xA0; &#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SuccessCount,&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; FailCount&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA;)&#xA;SELECT&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; td.PartitonId,&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; td.TradeDate,&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; la.ActionId,&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SUM(case Result when &#x27;V&#x27; then 1 else 0 end) as SuccessCount,&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SUM(case Result when &#x27;X&#x27; then 1 else 0 end) as FailCount&#xA;FROM LogActions la join #TradeDateWithPartitionId td&#xA;ON&#xA0;&#xA0;&#xA0; la.Date = td.TradeDate&#xA;WHERE NOT EXISTS (SELECT 1 FROM LogSummary ls&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHERE ls.PartitonId = td.PartitonId&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AND&#xA0;&#xA0; ls.SummaryDate = td.TradeDate&#xA;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; AND ls.ActionId = la.ActionID)&#xA;GROUP BY ls.ActionId, td.TradeDate&#xA;&#xA0;&#xA;DROP TABEL #TradeDateWithPartitionId&#xA;This query run in twenty seconds. Now that I call impressive.</p>
        </article>
        <article id="article-9249">
            <a href="https://ayende.com/blog/1059/castle-demo-app-lazy-loading-and-scopes" target="_blank">
                <h2 class="title mb-6" id="article-9249">Castle Demo App</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 19, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">First, a bug correction, in an earlier post I said that the user&#x27;s OpenBugs property should be initalized exactly the same as AssignedBugs, this is a mistake, it should be initialized like this:              _openBugs =         new EntitySet&lt;Bug&gt;();     The reason for this is that addition/removal to the OpenBugs shouldn&#x27;t affect the AssignedBugs collection, which is what I accidently did.     Okay, so now we have Users and Bugs (they do seem to go hand in hand together, don&#x27;t they? :-) ), but we have a potential problem in our hands that we need to pay attention to: When we load a user, all its bugs will be loaded as well.     What happens when we load a user for autentication? We will also load all its bugs, and that can be quite a large number of bugs. It&#x27;s wasteful in memory, time and network bandwidth. So, what do we do? I don&#x27;t to give up the connection from the user to its bugs, it&#x27;ll make my code much simpler, but it has the potential of seriously impacting the performance of my application. What would be best is if I could load the user&#x27;s bugs on demand, so I would still get the ease of use, but without the performance.     It turns out that there is such a way, and it&#x27;s called Lazy Loading. What this means is that Active Record will wait until you access the bugs collection of a user before it will load it. Here is how we define it:             &#xA0;&#xA0;&#xA0; [HasMany(typeof(Bug), ColumnKey = &quot;AssignedTo&quot;, RelationType = RelationType.Set,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CustomAccess = &quot;NHibernate.Generics.GenericAccessor, NHibernate.Generics&quot;,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Lazy=true)]                        &#xA0;&#xA0;&#xA0; public ICollection&lt;Bug&gt; AssignedBugs                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _assignedBugs; }                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; [HasMany(typeof(Bug), ColumnKey = &quot;AssignedTo&quot;, RelationType = RelationType.Set,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CustomAccess = &quot;NHibernate.Generics.GenericAccessor, NHibernate.Generics&quot;,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Where = &quot;Status = 1&quot;,Lazy = true)]                        &#xA0;&#xA0;&#xA0; public ICollection&lt;Bug&gt; OpenBugs                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _openBugs; }                        &#xA0;&#xA0;&#xA0; }                         I bolded the part we changed. It is a fairly simple change, and it has the potential of saving us quite&#xA0;a bit in performance. So, I run the tests again, to see if this tiny change borke something, and get an error on this test:             &#xA0;&#xA0;&#xA0; [Test]                        &#xA0;&#xA0;&#xA0; public void GetUsersBugs()                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User user = new User(&quot;Foo&quot;, &quot;Bar&quot;, &quot;Foo@bar.com&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; user.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Bug nastyBug = new Bug(&quot;Nasty&quot;, &quot;Figure it out!&quot;, user);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; nastyBug.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Bug minorBug = new Bug(&quot;Minor&quot;, &quot;Spelling Mistake in the logs&quot;, user);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; minorBug.Status = BugStatus.Fixed;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; minorBug.Save();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User userDb = User.Find(user.Id);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(2, userDb.AssignedBugs.Count); //Failed to lazily initialize a collection - no session                     &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, userDb.OpenBugs.Count);                        &#xA0;&#xA0;&#xA0; }         Hm, that is a problem, what is this session that the exception talks about? This requires a little bit of detail with regard to how Active Record works:    When you issue a command that needs to touch the database, a session (which is parallel to a database connection, but with quite a bit more added to it) is created and destroyed on the fly. What happened here is that the session that was associated with the userDb variable, but it was disposed after loading it from the database, when we tried to access the AssignedBugs collection, Active Record tried to use the session, but that has already been disposed.    So, we have a problem, but there is also a solution, we need to tell Active Record to keep the session alive, and we can do that with a&#xA0; SessionScope. Now the following code will work correctly:            &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; using (new SessionScope())                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; User userDb = User.Find(user.Id);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(2, userDb.AssignedBugs.Count);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Assert.AreEqual(1, userDb.OpenBugs.Count);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        The session is kept open until it is disposed, so this means that we can access lazy loaded collection at will.    A couple of notes about this post:            You need to think about what parts of your objects you would lazy load. While it has the potential to increase performance, it also has the potential of creating a large number of queries against the database. (Load all users, load user 1&#x27;s bug, load user 2&#x27;s bug.... load user 1000&#x27;s bugs, etc). There are solutions to those problems, but they will be much easier if you think of them ahead of time. One nice thing that Active Record allows is to tell it to usually load a collection in a lazy fashion, but in spesific cases to load all the data in one database trip.            As you saw, even such a little change as adding a Lazy = true to the attribute can break the application. This is even more so with cascades (which I may or may not talk about). Those two are both issues that need consideration at the beginning of the application. Getting it right isn&#x27;t that hard, but getting them wrong means that you&#x27;ll have some work to do.            On general, I don&#x27;t recommend using SessionScope like in the example above, it&#x27;s usually preferred to use&#xA0;the Session Per Request, which I&#x27;ll show when we get to the MonoRail part.</p>
        </article>
        <article id="article-9250">
            <a href="https://ayende.com/blog/1058/castle-demo-app-active-record-relations" target="_blank">
                <h2 class="title mb-6" id="article-9250">Castle Demo App</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: February 17, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">For this part, I&#x27;m going to use NHibernate.Generics, which is an extention to NHibernate that allows to use generic collections for relationship between classes. You need to download it from here&#xA0;and add a reference to:            NHibernate.Generics.dll            Iesi.Collections.dll    Okay, so we have a User, now we need a Bug class, so we can store the information about our bugs. I&#x27;m going to skip the parts that I&#x27;ve already covered and move to the new stuff. Here is how the Bug class looks like:          There are three interesting properties here, BugStatus, Text and AssignedTo. Let&#x27;s go over each one in turn.     BugStatus is an enum defined like this:             public enum BugStatus : byte                        {                        &#xA0;&#xA0;&#xA0; Opened&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; = 1,                        &#xA0;&#xA0;&#xA0; Duplicated&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; = 2,                        &#xA0;&#xA0;&#xA0; CouldNotRepreduce&#xA0;&#xA0; = 3,                        &#xA0;&#xA0;&#xA0; Fixed&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; = 4,                        &#xA0;&#xA0;&#xA0; WontFix&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; = 5 //Urgh!                        }                        As you can see, it&#x27;s just a normal enum (with the backing store specified as a byte). You can also see that I&#x27;ve some strong feeling about Won&#x27;t Fix bugs :-) Here is how I defined the Status property on the Bug class:            &#xA0;&#xA0;&#xA0; [Property]                        &#xA0;&#xA0;&#xA0; public BugStatus Status                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _status; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { _status = value; }                        &#xA0;&#xA0;&#xA0; }        It&#x27;s just a normal property, with the [Property] attribute to decorate it and tell Active Record that it should save it to the database. No special handling required for enums.    The second interesting property is Text, since we might want to store large amount of text there. The issue in this case is a bug in ActiveRecord/NHibernate (which will probably be fixed in the next release) where text larger than 4,000 character is being silently truncated. The fix for this is explicitly stating that this property may contain large amount of text. All we need to do is specify the column type as StringClob, like this:                                            &#xA0;&#xA0;&#xA0; [Property(ColumnType=&quot;StringClob&quot;)]                        &#xA0;&#xA0;&#xA0; public string Text                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _text; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { _text = value; }                        &#xA0;&#xA0;&#xA0; }                        Now we get to the AssignedTo property, which is a fair bit more interesting. I&#x27;m following the Hot Potato Bug Tracking phylosophy, which basically says that a bug always has someone assigned to take care of it. This mean that there is a connection between a Bug and a User. How do we specify this?            &#xA0;&#xA0;&#xA0; [BelongsTo]                        &#xA0;&#xA0;&#xA0; public User AssignedTo                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _assignedTo.Value; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; set { _assignedTo.Value = value; }                        &#xA0;&#xA0;&#xA0; }        This requires some explanation, in general, just specifying that this Bug [BelongsTo] a user is enough. But right now NHibernate doesn&#x27;t support generic collections right now, in order to support that you need to use NHibernate.Generics, which provides this functionality. The _assignedTo variable isn&#x27;t of type User, it&#x27;s actually defined as:            &#xA0;&#xA0;&#xA0; EntityRef&lt;User&gt; _assignedTo;                                &#xA0;                        &#xA0;&#xA0;&#xA0; public Bug()                                 &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; _assignedTo = new EntityRef&lt;User&gt;(                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(User user) { user.AssignedBugs.Add(this); },                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(User user) { user.AssignedBugs.Remove(this); }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; );                        &#xA0;&#xA0;&#xA0; }                        What this basically says is that _assignedTo is a reference to another class, and the part in the constructor we define the actions that will happen when the reference is changed. In this case, we add or remove the current instance to the Bugs collection of the user. This ensure that the right thing happens both in the database and in our objects. In general, you can just use it as is, and don&#x27;t need to poke inside. If you wish to understand deeper, I suggest you look in NHibernate.Generics documentation.    But what about the other side? If I&#x27;ve a user, how do I know what bugs are assigned to it? Well, that turns out to be fairly simple as well, we need to add the following to the User class:            &#xA0;&#xA0;&#xA0; EntitySet&lt;Bug&gt; _assignedBugs;                                &#xA0;                        &#xA0;&#xA0;&#xA0; [HasMany(typeof(Bug), ColumnKey=&quot;AssignedTo&quot;,RelationType=RelationType.Set,                                                 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CustomAccess = &quot;NHibernate.Generics.GenericAccessor, NHibernate.Generics&quot;)]                        &#xA0;&#xA0;&#xA0; public ICollection&lt;Bug&gt; AssignedBugs                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; get { return _assignedBugs; }                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; public User()                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; _assignedBugs = new EntitySet&lt;Bug&gt;(                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(Bug bug) { bug.AssignedTo = this; },                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; delegate(Bug bug) { bug.AssignedTo = null; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; );                        &#xA0;&#xA0;&#xA0; }                        What does this mean? Well, here we tell Active Record that a user has many assigned bugs, that it should threat them as a set and how to locate them in the database. Again, we use the NHibernate.Generics&#xA0;addin to get generic collection support. And we define actions that will happen when a bug is assigned to / from the user. The use of NHibernate.Generics&#xA0;add a little of complication to the attributes, but you get generic collection and smart behavior in return, so I think that it is more than worth&#xA0;it. :-)    Okay, that was quite a bit to chew on, let&#x27;s finish with a couple of notes on the Bugs tables:            CREATE TABLE [dbo].[Bugs](                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Id] [int] IDENTITY(1,1) NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Title] [nvarchar](255) NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Text] [nvarchar](max) NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Status] [tinyint] NOT NULL,                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [AssignedTo] [int] NOT NULL,                        &#xA0;CONSTRAINT [PK_Bugs] PRIMARY KEY CLUSTERED                                 (                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Id] ASC                        ))                        GO                        ALTER TABLE [dbo].[Bugs]&#xA0; WITH CHECK ADD&#xA0; CONSTRAINT [FK_Bugs_Users] FOREIGN KEY([AssignedTo])                        REFERENCES [dbo].[Users] ([Id])                GO                        The only thing of note here is the Status column, which is defined as a tinyint, as you recall, a Bug&#x27;s Status is actually an enum whose backing store is byte, so I persisted it as a tinyint, which has the same size. (Both can have ranges of 0 - 255, which is more than enough for most enums.).</p>
        </article>
        <div class="button flex justify-between">
            <a href="924.html"><span class="back arrow"></span></a>

            <a href="926.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>