
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 449 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-4481">
            <a href="https://ayende.com/blog/156641/get-off-my-bed-and-a-ravendb-course-discounts-for-munich-and-chicago" target="_blank">
                <h2 class="title mb-6" id="article-4481">Get off my bed! And a RavenDB Course Discounts for Munich and Chicago</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 21, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I can&#x2019;t sleep, due to a literal doggie pile on my bed. Hence, I lay awake and ponder things like pricing strategies and other interesting topics.&#xA;&#xA;&#x9;&#xA;&#xA;&#x9;In fact, as you can see, I put both dogs to sleep when taking about this.&#xA;&#xA;&#x9;The big one is a female German Shepherd, named Arava, and the smaller one is a charming fellow named Oscar.&#xA;&#xA;&#x9;And this is relevant to the discussion on a technical blog exactly how?&#xA;&#xA;&#x9;Well, as I said, Arava is a German Shepherd, and I have an upcoming RavenDB Course in Munich next month. If you go and register to the course, you can use Arava as the coupon code to get a 25% discount.&#xA;&#xA;&#x9;And before I forget Oscar (and hence get the biggest puppy eyes stare in the world), if you go and register to the Chicago RavenDB Bootcamp in late August, and use Oscar as the coupon code, you&#x2019;ll get a 20% discount (what can I do, he is smaller).&#xA;&#xA;&#x9;The offer will remain open until I wake up, you have some time, I still need to find some way to get them off the bed : &#x2013;).</p>
        </article>
        <article id="article-4482">
            <a href="https://ayende.com/blog/156418/geo-location-spatial-searches-with-ravendb-part-iv-searching" target="_blank">
                <h2 class="title mb-6" id="article-4482">Geo Location &amp; Spatial Searches with RavenDB&#x2013;Part IV-Searching</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 21, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Now we have all of the data loaded in, we need to be able to search on it. In order to do that, we define the following index:   It is a very simple one, mapping the start and end of each range for each location. The next step is actually doing the search, and this is where we run into some issues. The problem was with the data:  Let us take the first range and translate that to IP addresses in the format that you are probably more used to: Start: 0.177.195.68 End: 255.177.195.68 Yep, it is little endian vs. big endian here to bite us once more. It took me a while to figure it out, I&#x2019;ll admit. In other words, we have to reverse the IP address before we can search on it properly. Thankfully, that is easily done, and we have the following masterpiece:   The data source that we have only support IPv4, so that is what we allow. We reverse the IP, then do a range search based on this. Now we can use it like this:  var location = session.GetLocationByIp(IPAddress.Parse(&quot;209.85.217.172&quot;));&#xA;&#xA;&#xA;Which tells us that this is a Mountain View, CA, USA address.&#xA;More importantly for our purposes, it tells us that this is located at: 37.4192, -122.0574 We will use that shortly to do spatial searches for RavenDB events near you, which I&#x2019;ll discuss in my next post.&#xA;Oh, and just for fun. You might remember that in previous posts I mentioned that MaxMind (the source for this geo location information) had to create its own binary format because relational databases took several second to process each query?&#xA;The query above completed in 53 milliseconds on my machine, without any tuning on our part. And that is before we introduce caching into the mix.</p>
        </article>
        <article id="article-4483">
            <a href="https://ayende.com/blog/156417/geo-location-spatial-searches-with-ravendb-part-iii-importing" target="_blank">
                <h2 class="title mb-6" id="article-4483">Geo Location &amp; Spatial Searches with RavenDB&#x2013;Part III-Importing</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 20, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The following are sample from the data sources that MaxMind provides for us:    The question is, how do we load them into RavenDB? Just to give you some numbers, there are 1.87 million blocks and over 350,000 locations. Those are big numbers, but still small enough that we can work with the entire thing in memory. I wrote a quick &amp; ugly parsing routines for them: public static IEnumerable&lt;Tuple&lt;int, IpRange&gt;&gt; ReadBlocks(string dir)&#xA;{&#xA;    using (var file = File.OpenRead(Path.Combine(dir, &quot;GeoLiteCity-Blocks.csv&quot;)))&#xA;    using (var reader = new StreamReader(file))&#xA;    {&#xA;        reader.ReadLine(); // copy right&#xA;        reader.ReadLine(); // header&#xA;&#xA;        string line;&#xA;        while ((line = reader.ReadLine()) != null)&#xA;        {&#xA;            var entries = line.Split(&#x27;,&#x27;).Select(x =&gt; x.Trim(&#x27;&quot;&#x27;)).ToArray();&#xA;            yield return Tuple.Create(&#xA;                int.Parse(entries[2]),&#xA;                new IpRange&#xA;                {&#xA;                    Start = long.Parse(entries[0]),&#xA;                    End = long.Parse(entries[1]),&#xA;                });&#xA;        }&#xA;    }&#xA;}&#xA;&#xA;public static IEnumerable&lt;Tuple&lt;int, Location&gt;&gt; ReadLocations(string dir)&#xA;{&#xA;    using (var file = File.OpenRead(Path.Combine(dir, &quot;GeoLiteCity-Location.csv&quot;)))&#xA;    using (var reader = new StreamReader(file))&#xA;    {&#xA;        reader.ReadLine(); // copy right&#xA;        reader.ReadLine(); // header&#xA;&#xA;        string line;&#xA;        while ((line = reader.ReadLine()) != null)&#xA;        {&#xA;            var entries = line.Split(&#x27;,&#x27;).Select(x =&gt; x.Trim(&#x27;&quot;&#x27;)).ToArray();&#xA;            yield return Tuple.Create(&#xA;                int.Parse(entries[0]),&#xA;                new Location&#xA;                {&#xA;                    Country = NullIfEmpty(entries[1]),&#xA;                    Region = NullIfEmpty(entries[2]),&#xA;                    City = NullIfEmpty(entries[3]),&#xA;                    PostalCode = NullIfEmpty(entries[4]),&#xA;                    Latitude = double.Parse(entries[5]),&#xA;                    Longitude = double.Parse(entries[6]),&#xA;                    MetroCode = NullIfEmpty(entries[7]),&#xA;                    AreaCode = NullIfEmpty(entries[8])&#xA;                });&#xA;        }&#xA;    }&#xA;}&#xA;&#xA;private static string NullIfEmpty(string s)&#xA;{&#xA;    return string.IsNullOrWhiteSpace(s) ? null : s;&#xA;}&#xA;&#xA;&#xA;&#xA;And then it was a matter of bringing it all together:&#xA;var blocks = from blockTuple in ReadBlocks(dir)&#xA;             group blockTuple by blockTuple.Item1&#xA;             into g&#xA;             select new&#xA;             {&#xA;                 LocId = g.Key,&#xA;                 Ranges = g.Select(x =&gt; x.Item2).ToArray()&#xA;             };&#xA;&#xA;var results =&#xA;    from locTuple in ReadLocations(dir)&#xA;    join block in blocks on locTuple.Item1 equals block.LocId into joined&#xA;    from joinedBlock in joined.DefaultIfEmpty()&#xA;    let _ = locTuple.Item2.Ranges = (joinedBlock == null ? new IpRange[0] : joinedBlock.Ranges)&#xA;    select locTuple.Item2;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA0;&#xA;The advantage of doing things this way is that we only have to write to RavenDB once, because we merged the results in memory. That is why I said that those are big results, but still small enough for us to be able to process them easily in memory.&#xA;Finally, we wrote them to RavenDB in batches of 1024 items.&#xA;The entire process took about 3 minutes and wrote 353,224 documents to RavenDB, which include all of the 1.87 million ip blocks in a format that is easy to search through.&#xA;In our next post, we will discuss actually doing searches on this information.</p>
        </article>
        <article id="article-4484">
            <a href="https://benfoster.io/blog/if-then-if-then-if-then-mvc/" target="_blank">
                <h2 class="title mb-6" id="article-4484">If Then, If Then, If Then, MVC</h2>
            </a>
            <p class="mb-2">by Ben Foster</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 20, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Fed up of spaghetti controller actions? Encapsulate reusable behaviours with custom Action Filters and View Results.</p>
        </article>
        <article id="article-4485">
            <a href="https://ayende.com/blog/156386/geo-location-spatial-searches-with-ravendb-part-ii-modeling" target="_blank">
                <h2 class="title mb-6" id="article-4485">Geo Location &amp; Spatial Searches with RavenDB&#x2013;Part II&#x2013;Modeling</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 19, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I mentioned in the previous post that the data is coming in a highly relational format, and that the MaxMind advice is to not load this into a relational database, because then queries take a long time. Instead, they have their own efficient binary format.  I decided to put this into RavenDB, and that brought the question, how are we actually going to work with this? How do we model the data? In our code, we defined the following, which I guess would pretty closely match how you model the data in a relational database:  Except&#x2026; In this case, we are actually storing the whole thing as a single entry, like so:  This allows us to query things efficiently and easily. But before we can get there, we need to actually load the data in, which is the topic of my next post.</p>
        </article>
        <article id="article-4486">
            <a href="https://ayende.com/blog/156385/geo-location-spatial-searches-with-ravendb-part-i-setup" target="_blank">
                <h2 class="title mb-6" id="article-4486">Geo Location &amp; Spatial Searches with RavenDB&#x2013;Part I&#x2013;Setup</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 18, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the things that we are putting into the new version of the RavenDB Website is some smarts about courses. We want to be able to figure out where a visitor is coming from, and show him relevant courses near him. This is a fairly standard feature, I guess. But I think we solved this in an interesting fashion. First, we had to figure out how to know where a visitor is coming from. This is done via geo location. There are plenty of geo location API, such as:  The problem is that a service like that is limited to ~1000 queries per hour, and we didn&#x2019;t want that. Other option include paid services, again, with either hard limits on the number of queries per hour or an open credit line. Neither option was very interesting to us. Instead, we thought we would try something out. Max Mind is offering a database that can be used for geo location purposes. They have two options, a free database and a paid option. I took the free version for a spin. Here is the GoeLiteCity-Blocks information:  Note that we have repeated rows per location, which allows us to map multiple ranges for each location. And finally, we have GoLiteCity-Location, which map a location id to an actual location:  Anyone who used a relational database should be familiar with the data format, right? I found it really interesting that MaxMind state on their site:  Note that queries made against the CSV data imported into a SQL database can take up to a few seconds. If performance is an issue, the binary format is much faster, and can handle thousands of lookups per second. They actually have a custom binary format to allow faster queries, but I think that I can do something about this. In the next post in this series, I&#x2019;ll talk about how to import this data into RavenDB and the model concerns that we have with it.</p>
        </article>
        <article id="article-4487">
            <a href="https://ardalis.com/how-can-i-view-msmq-messages-and-queues/" target="_blank">
                <h2 class="title mb-6" id="article-4487">How Can I View MSMQ Messages and Queues?</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 17, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x2019;m working with NServiceBus to send messages to and from different parts of my application. NServiceBus is a mature tool that sits on top&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-4488">
            <a href="https://ayende.com/blog/156577/on-umbracos-nhibernates-pullout" target="_blank">
                <h2 class="title mb-6" id="article-4488">On Umbraco&#x2019;s NHibernate&#x2019;s Pullout</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 15, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I was asked to comment on this topic:  Here is the link to the full article, but here is the gist:  Performance.The culprit of v5 is our usage of NHibernate. This doesn&#x27;t mean that NHibernate is evil, just that it has turned out to be the wrong fit for our project (in part due to our architecture and db schema, in part due to lack of proper NHibernate experience on the team). It&#x27;s a badly tamed NHibernate that is caused the many N&#x2B;1 SQL statements. The long term solution is to replace NHibernate with native, optimized SQL calls but it&#x27;s a bigger operation that we&#x27;ll look into over the summer. The short team solution is to continue with finding as many bottlenecks as we can as tune those, combined with introducing a Lucene based cache provider which will cache queries and results which will survive app pool restarts (much like the v4 XML cache). The architecture has been prepared for the latter and we&#x27;ll have this in place by the end of May. Another thing that causes massive performance issues is that we&#x27;re seeing a trend where people are calling ToList() on razor queries to compensate for the lack of LINQ features in our implementation. Unfortunately, this causes most (if not all) of the database to be loaded into memory, naturally causing big performance issues (and an enormous number of N&#x2B;1 SQL calls). This leads us to... And a while later:  V5 couldn&#x27;t be fixed. We needed to completely rewrite the entire business layer to ever get v5 into being the type of product people expect from Umbraco I marked the parts that I intend to respond to in yellow, green highlight is for some additional thoughts later on, keep it in mind. Now, to be fair, I looked at Umbraco a few times, but I never actually used it, and I never actually dug deep.  The entire problem can be summed in this page, from the Umbraco documentation site. This is the dynamic model that Umbraco exposes to the views to actually generate the HTML. From the docs:  DynamicModel is a dynamic object, this gives us a number of obvious benefits, mostly a much lighter syntax for accessing data, as well as dynamic queries, based on the names of your DocumentTypes and their properties, but at the same time, it does not provide intellisense.  Any time you provide the view with a way to generate queries, it is a BIG issue. For the purpose of discussion, I&#x2019;ll focus on the following example,&#xA0; also taken from Umbraco docs:     1:  @inherits PartialViewMacroPage   2:  @using Umbraco.Cms.Web   3:  @using Umbraco.Cms.Web.Macros   4:  @using Umbraco.Framework   5:  &#xA0;   6:  @{   7:      @* Get the macro parameter and check it has a value - otherwise set to empty hive Id *@   8:      var startNodeID = String.IsNullOrEmpty(Model.MacroParameters.startNodeID) ? HiveId.Empty.ToString() : Model.MacroParameters.startNodeID;   9:  }  10:  &#xA0;  11:  @* Check that startNodeID is not an empty HiveID AND also check the string is a valid HiveID *@  12:  @if (startNodeID != HiveId.Empty.ToString() &amp;&amp; HiveId.TryParse(startNodeID).Success)  13:  {  14:      @* Get the start node as a dynamic node *@  15:      var startNode = Umbraco.GetDynamicContentById(startNodeID);  16:  &#xA0;  17:      @* Check if the startNode has any child pages, where the property umbracoNaviHide is not True *@      18:      if (startNode.Children.Where(&quot;umbracoNaviHide != @0&quot;, &quot;True&quot;).Any())  19:      {  20:          &lt;ul&gt;  21:              @* For each child page under startNode, where the property umbracoNaviHide is not True *@  22:              @foreach (var page in startNode.Children.Where(&quot;umbracoNaviHide != @0&quot;, &quot;True&quot;))  23:              {   24:                  &lt;li&gt;&lt;a href=&quot;@page.Url&quot;&gt;@page.Name&lt;/a&gt;&lt;/li&gt;  25:              }  26:          &lt;/ul&gt;  27:      }      28:  }&#xA;&#xA;&#xA;This is a great example of why you should never do queries from the views. Put simply, you don&#x2019;t have any idea what is going to happen. Let us start going through the onion, and see where we get.&#xA;Umbraco.GetDynamicContentById &#x2013; Is actually UmbracoHelper.GetDynamicContentById, which looks like this:&#xA;&#xA;&#xA;I mean, I guess I could just stop right here, look at the first line, and it should tell you everything. But let us dig deeper. Here is what GetById looks like:&#xA;&#xA;&#xA;Note that with NHibernate, this is a worst practice, because it forces a query, rather than allow us to use the session cache and a more optimized code paths that Load or Get would use.&#xA;Also, note that this is generic on top of an IQueryable, so we have to go one step back and look at Cms().Content, which is implemented in:&#xA;&#xA;&#xA;I just love how we dispose of the Unit of Work that we just created, before it is used by any client. But let us dig a bit deeper, okay?&#xA;&#xA;&#xA;&#xA;&#xA;And we still haven&#x2019;t found NHibernate! That is the point where I give up, I am pretty sure that Umbraco 5 is using NHibernate, I just can&#x2019;t find how or where.&#xA;Note that in those conditions, it is pretty much settled that any optimizations that you can offer isn&#x2019;t going to work, since you don&#x2019;t have any good way to apply it, it is so hidden behind all those layers.&#xA;But I am pretty sure that it all end up with a Linq query on top of&#xA0; a session.Query&lt;Content&gt;(), so I&#x2019;ll assume that for now.&#xA;So we have this query in line 15, to load the object, then, on line 18, we issue what looks like a query:&#xA;if (startNode.Children.Where(&quot;umbracoNaviHide != @0&quot;, &quot;True&quot;).Any())&#xA;&#xA;&#xA;We actually issue two queries here, one to load the Children collection, and the second in the Where(). It took a while to figure out what the Where was, but I am pretty sure it is:&#xA;&#xA;&#xA;Which translate the string to a Linq query, which then have to be translated to a string again. To be perfectly honest, I have no idea if this is executed against the database ( I assume so ) or against the in memory collection.&#xA;Assuming it is against the database, then we issue the same query again, two lines below that.&#xA;And this is in a small sample, think about the implications for a more complex page. When you have most of you data access so abstracted, it is very hard to see what is going on, let alone do any optimizations. And when you are doing data access in the view, the very last thing that the developer has in his mind is optimizing data access.&#xA;This is just setting up for failure. Remember what I said about: replace NHibernate with native, optimized SQL calls, this is where it gets interesting. Just about every best practice of NHibernate was violated here, but the major problem is not the NHibernate usage. The major problem is that there is very little correlation between what is happening and the database. And the number of queries that are likely to be required to generate each page are truly enormous.&#xA;You don&#x2019;t issues queries from the view, that is the #1 reason for SELECT N&#x2B;1, and when you create a system where that seems to be the primary mode of operation, that is always going to cause you issues.&#xA;Replace NHibernate with optimized SQL calls, but you are still making tons of direct calls to the DB from the views. &#xA;I actually agree with the Umbraco decision, it should be re-written. But the starting point isn&#x2019;t just the architectural complexity. The starting point should be the actual interface that you intend to give to the end developer.</p>
        </article>
        <article id="article-4489">
            <a href="https://ayende.com/blog/156321/tertiary-includes-in-ravendb" target="_blank">
                <h2 class="title mb-6" id="article-4489">Tertiary includes in RavenDB</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 14, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">For a while, I was absolutely against this, in fact, I refused to implement this several times when asked, because it is complicate to do and indicate design problems in your domain model. During a course today, I found out that I might want to refuse, but the feature is actually in the product for the last two&#x2B; years, we just didn&#x2019;t know about this. But what are tertiary includes in the first place? Let us imagine that we have something like this:  Now, I want to load an order, but also show its Customer and Products. Those are secondary includes, and are very easy to do with RavenDB: var orders = session.Query&lt;Order&gt;()                  .Include(&quot;Customer&quot;)&#xA;                  .Include(&quot;Lines,Product&quot;)&#xA;                  .ToList();&#xA;&#xA;&#xA;There is also a strongly typed option for this, of course. &#xA;What this does is instruct RavenDB to load into the session the Customer and the associated Products into the session, so when you do something like this:&#xA;var cust = session.Load&lt;Customer&gt;(order.Customer);&#xA;&#xA;&#xA;The value will be loaded from the session cache, without going to the sever. As I said, this is a feature that we have had for quite a while, and it is a really nice one, because it drastically reduce the number of queries that you have to make.&#xA;The problem is that some people want to take it one step further, they want to be able to search on an Order, but also load the Location of a Product. I don&#x2019;t really like this, and as I said, when asked for this feature, I consistently said that it isn&#x2019;t there because it represent a remnant of relational thinking in your design.&#xA;But as it turned out, we do support this, although quite by accident.&#xA;The reason is quite simple, we evaluate Includes only after we evaluate the TranformResults function. Which means that the TranformResults function gets to choose whatever you want to include. Here is how it works:&#xA;TranformResults  = (database, results) =&gt;&#xA;   from result in results&#xA;   select new &#xA;   {&#xA;     Order = result,&#xA;     Locations = result.SelectMany(x=&gt;x.Lines).Select(x=&gt;database.Load&lt;Product&gt;(x.Product).Location)&#xA;   }&#xA;&#xA;&#xA;And then, you can just ask to Include(&#x201C;Locations&#x201D;), and you are pretty much set.&#xA;Except, that this is a really awkward thing to do, and I don&#x2019;t really like it at all.&#xA;Sure, I don&#x2019;t like this feature, but people will use it, and if it already there, we might as well make it elegant. Therefor, we now have the option of doing:&#xA;TranformResults  = (database, results) =&gt;&#xA;   from result in results&#xA;   let _ = database.Include(result.SelectMany(x=&gt;x.Lines).Select(x=&gt;x.Product))&#xA;   select result;&#xA;&#xA;&#xA;I think you&#x2019;ll agree that this is much nicer all around, this tells the server to include the data, without us needing to explicitly ask this from the client.</p>
        </article>
        <article id="article-4490">
            <a href="https://ayende.com/blog/153217/why-scalability-matters" target="_blank">
                <h2 class="title mb-6" id="article-4490">Why scalability matters?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 13, 2012
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Otherwise, you get this:  And that is one sale that isn&#x2019;t going to happen!</p>
        </article>
        <div class="button flex justify-between">
            <a href="448.html"><span class="back arrow"></span></a>

            <a href="450.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>