
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 25 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-241">
            <a href="https://ayende.com/blog/201185-B/the-code-that-lived-in-my-head-rent-free-for-30-years" target="_blank">
                <h2 class="title mb-6" id="article-241">The code that lived in my head rent free for 30 years</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 07, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I have a piece of code that has been living, rent-free, in my head for the past 30 years or so.In middle school (I was 12 - 13 at the time), I was taught Pascal as the entry-level programming language. I found it to be a really fascinating topic, as you can imagine. One of the things I did was try to read other people&#x2019;s code and see what sense I could make out of it. That was way&#xA0;before the Internet was a thing, though. Even at that time, Pascal was mostly on its way out, and there wasn&#x2019;t much code that a kid could access. To give some context, at the time, if you wanted to move data from one place to the next, the only real option was to physically disassemble your computer, take out the hard disk, wrap it in a towel for protection, and carry it to your destination. I recall doing that and then spending some hours at a friend&#x2019;s house, trying to figure out the right jumper configuration so the BIOS would recognize two&#xA0;drives at once. Because of this, I had a great interest in disk parking, a technique that helps ensure that taking the hard drive from one location to the next wouldn&#x2019;t ruin it. I remember running into a particular piece of code to handle disk parking in Pascal and being quite excited by this. Here I had something that I needed&#xA0;to do, and also in a language that I was familiar with. I remember staring at the code and trying to make sense of it for a while. I couldn&#x2019;t figure it out. In fact, I couldn&#x2019;t even begin to understand what was going on there. I remember feeling both frustrated and stupid because I could understand the syntax but not what it was doing.In fact, it was so far above my head that I was upset about it for days, to the point that decades later, it still pops into my head. When it came back for a visit this week, I decided to try to figure it out once and for all. That led to the first problem, which is that I cannot actually recall&#xA0;the code. I remember it was in Pascal, that it dealt with parking the disk needles, and it was full of weird numbers that I couldn&#x2019;t grasp. &#xA0;Turning to Google didn&#x2019;t help much, I found some code samples, but nothing that really jived with what I recalled. I ended up cobbling something that more or less matches what I had in my head. program DiskPark;&#xA;&#xA;&#xA;function ParkHead(drive: char): Boolean;&#xA;var&#xA;  regs: Registers;&#xA;begin&#xA;  with regs do&#xA;  begin&#xA;    AH := $13;  &#xA;    AL := Ord(drive) - Ord(&#x27;A&#x27;) &#x2B; $80;&#xA;    DL := AL;  &#xA;    Intr($13, regs); &#xA;    ParkHead := (Flags and FCarry) = 0;&#xA;  end;&#xA;end;&#xA;&#xA;&#xA;begin&#xA;  if ParkHead(&#x27;A&#x27;) then&#xA;    WriteLn(&#x27;Success: parked&#x27;)&#xA;  else&#xA;    WriteLn(&#x27;Failure, no idea why!&#x27;);&#xA;end.The actual code that I remember was beefier, and I think that it handled a bunch of additional scenarios, but it had been 30 years, I can&#x2019;t recall it. Amusingly enough, I actually had to update my publishing software, since I never thought I would be publishing Pascal code snippets &#x1F642;.What is interesting is that, as I look at this code and try to view it through the glasses of my 12-year-old self, I can understand exactly the frustration. Look at this code, it is filled with random numbers and letters. What is AH or the Intr() call? I mean, looking at this, there is no place to get started understanding this.Let&#x2019;s look at this line:AH := $13;There is no definition of AH anywhere, I can&#x2019;t tell where it is coming from. And $13, what is that about? A bad luck omen because I can&#x2019;t figure it out, I think&#x2026;The problem was that my 12-year-old self wrote programs like &#x201C;Guess the number&#x201D;, and really advanced stuff was bubble sort. I approached the code above with the same mindset. There is a logic&#xA0;to this that I can figure out if I can just stare at this long enough.The problem is that the code above is basically arbitrary, there is nothing intrinsic about it.The weird variables that come from nowhere (AL, DL, and AH) are registers (at the time, I don&#x2019;t believe I was even aware that those existed). The weird numbers are just arguments that we pass to the BIOS when you invoke a command. In the same sense, consider this code:return syscall(437, ptr, 525376);This line will tell you absolutely nothing about the reasoning behind the code. While the numbers seem arbitrary,in this case, they correspond to calling SYS_openat&#xA0;with the flags O_APPEND | O_CREAT | O_CLOEXEC. The whole program above is just the way you have to go to invoke a system call (as we would call it today), and there is no logic or sense to it. Just something that you have to know. And once you do know, all of this can be packaged into a much simpler, higher-level concept: the system call. (Yes, it is an interrupt invocation, not the same thing. You may go stand in the pedantic corner, mind.)Hopefully, I wouldn&#x2019;t ever have to think about this program any longer. I managed to not only understand what it does, but actually grok&#xA0;it.</p>
        </article>
        <article id="article-242">
            <a href="https://devblogs.microsoft.com/dotnet/openai-dotnet-library/" target="_blank">
                <h2 class="title mb-6" id="article-242">Announcing the official OpenAI library for .NET</h2>
            </a>
            <p class="mb-2">by .NET Team</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 06, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The initial beta release of the official OpenAI library for .NET is now available.</p>
        </article>
        <article id="article-243">
            <a href="https://devblogs.microsoft.com/dotnet/introducing-mstest-34/" target="_blank">
                <h2 class="title mb-6" id="article-243">MSTest 3.4 is here with WinUI support and new analyzers!</h2>
            </a>
            <p class="mb-2">by Amaury Lev&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 05, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">MSTest 3.4 is available. Learn all about the highlighted features and fixes that will make your testing experience always better.</p>
        </article>
        <article id="article-244">
            <a href="https://devblogs.microsoft.com/dotnet/array-mapping-in-ef-core-8/" target="_blank">
                <h2 class="title mb-6" id="article-244">A beginner&#x2019;s guide to mapping arrays in EF Core 8</h2>
            </a>
            <p class="mb-2">by Arthur Vickers</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 04, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">EF Core 8 introduces support for mapping typed arrays of simple values to database columns so the semantics of the mapping can be used in the SQL generated from LINQ queries.</p>
        </article>
        <article id="article-245">
            <a href="https://andrewlock.net/conditionally-skipping-a-trigger-job-in-gitlab-based-on-a-previous-job/" target="_blank">
                <h2 class="title mb-6" id="article-245">Conditionally skipping a trigger job in GitLab based on a previous job</h2>
            </a>
            <p class="mb-2">by Andrew Lock</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 04, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post I describe the approaches I explored to conditionally skip a trigger job in GitLab based on a previous job using dynamic pipelines&#x2026;</p>
        </article>
        <article id="article-246">
            <a href="https://devblogs.microsoft.com/dotnet/refactor-your-code-using-alias-any-type/" target="_blank">
                <h2 class="title mb-6" id="article-246">Refactor your code using alias any type</h2>
            </a>
            <p class="mb-2">by David Pine</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 03, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Explore the &quot;alias any type&quot; C# 12 feature through a complete demo application.</p>
        </article>
        <article id="article-247">
            <a href="https://www.meziantou.net/create-a-multi-arch-docker-image-for-a-dotnet-application.htm" target="_blank">
                <h2 class="title mb-6" id="article-247">Create a multi-arch Docker image for a .NET application</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 03, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We are in a transition period where x64 architectures are not the only architectures available. Apple has switched to ARM with the M1 chip, and Microsoft is also pushing for ARM now. If you want to run your application on ARM64 and x64 architectures, you need to create a Docker image for each archi</p>
        </article>
        <article id="article-248">
            <a href="https://ayende.com/blog/201153-B/building-a-serverless-secured-dead-drop" target="_blank">
                <h2 class="title mb-6" id="article-248">Building a serverless secured dead drop</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 30, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I ran into this fascinating article&#xA0;(I wrote another blog post&#xA0;discussing it) and that got me thinking. How would I approach building a dead-drop implementation? For that matter, what do we need&#xA0;from a dead-drop system?I think that the following are reasonable (loosely based on what Secure Drop aims for):Completely anonymous:No accounts, no registrations.No server-side state about users.&#xA0;Prevent metadata tracking:It&#x2019;s not just message contents that are hidden.Cannot tell if A talks to B or C.Accessible via Tor to protect against traffic analysis.Cannot tell who is talking to me at all.Assume that the server may be compromised by a malicious entity.No special trust should be granted to the server.Reasoning(You can skip this part to read the actual implementation below)Let&#x2019;s consider an actual usage scenario. We have Whistleblower Will (WW from now on) who wants to send sensitive information to Journalist Jane (JJ from now on). Let&#x2019;s assume that the adversary in this case is a Big Bad Behemoth. I believe that the current villain de jour is Boeing, which is a huge&#xA0;company and had a couple of strange incidents with whistleblowers recently.If WW wants to send stuff to JJ, why can&#x2019;t he just email jj@nice.journalist from his personal email ww1994@aol.com ? Practically speaking, email today is being sent using TLS anyway, so we can assume that no one can read the message in the middle. Moreover, &#xA0;even pretty sophisticated traffic analysis would find it difficult to track the email, as WW is talking to AOL (or GMail, or their likely email provider), and then AOL is communicating with the nice.journalist server (which is likely hosted by Exchange, Gmail, etc.) In other words, any such message would likely be lost in the noise of regular traffic.However, while that is likely&#xA0;to happen, it isn&#x2019;t guaranteed.&#xA0;Given the risk of life &amp; limb involved in our scenario, we would like to ensure that this is the case. I&#x2019;m writing this post because it is an interesting scenario, not because I actually have a use case. As usual in my encryption posts, this is merely my musings on the matter, don&#x2019;t take me as an authority on the subject. That said, I&#x2019;m actually quite interested in realistic threat models here. Please provide any feedback, I would love to know more about this.One thing to pay attention to with regards to this scenario, however, is that if my threat model is a Bad Company that is one thing, but what if my threat model includes a nation state? I would point you to this wonderful article: This World of Ours&#xA0;by James Mickens which manages to be both hilarious and informative. The level of capability that you face when your opponent is a nation state is high.When thinking about nation-states and whistleblowers&#x2026; Snowden is the first name that comes to mind. In this case, the issue isn&#x2019;t whether there is some plaintext being sent over the wire for everyone who cares to listen. Assume you are sending such an email from AOL to Gmail. Both companies will provide any data they have, including the full contents of any messages, if provided with an appropriate court order.Moving from legal (but dubious) actions to the other side, I&#x2019;m fairly certain that it would take very little investigative work to find an appropriate person who: Works at an email provider.Has access to the email contents.Is able to make use of an appropriate cash infusion in their life.I would also further assume that the actual amount required is surprisingly low. Another thing to consider is that our whistleblower may want to provide the information to the journalist, but may absolutely&#xA0;not want to be identified. That includes being identified by the journalist. In short, the whole mindset when building something like a dead drop is extremely paranoid. With that in mind, let&#x2019;s see how we can build such a system.ImplementationThe concept behind this system is that a journalist will publish their public key in some manner, probably in their newspaper. That is a fairly simple and obvious step, of course. The issue with needing a dead drop isn&#x2019;t about being able to hide the contents&#xA0;of the messages. If that were the case, a PGP encrypted message would suffice. The real issue is that we want to hide the fact that we are even communicating at all. Note that this isn&#x2019;t about any form of instant messaging. This is about dropping a message (text, files, etc.) and having it sent securely to the other side. The key aspect is that not only are the contents hidden, but also the fact that we even sent it in the first place. And even if you are watching the source or the destination, you can&#x2019;t tell who the other side is. For reference, think of spycraft techniques in the Cold War era.Given a journalist public key, the whistleblower will package all the data they want to send in a zip file and encrypt that using the public key. That is easy enough, the problem now is that we need to push that file somewhere and then have the journalist get it. That is where our system has a role.In the design of the system, I tried to intentionally reduce the amount of information that we provide to the server. That way, even if the server is malicious, there isn&#x2019;t much that they can do with what they have.I decided to use a serverless architecture here, for two primary reasons. The first reason is that I&#x2019;m currently teaching a Cloud Development course and that was a nice project to play with. The second reason is that by running everything as a serverless function, I reduced the amount of data that I can easily aggregate since invocations are independent of one another.From a client perspective, here is the manner in which I&#x2019;m able to send my sensitive information to a journalist. We need two pieces of information, first is the address of the dead drop, in this case I&#x2019;m using a dummy .onion service and the journalist public key. The public key is used to encrypt the information so only the journalist can see it. Let&#x2019;s look at the code first, and then discuss what is going on there:BASE_URL = &quot;https://deaddrop0j22dp4vl2id.onion&quot; # example only&#xA;JOURNALIST_PUB_KEY = base64.b64decode(&#x27;GVT0GzjFRvMxcDh9c6jpmXkHoGB5KoIp9vyU3RozT2A=&#x27;)&#xA;&#xA;&#xA;data = open(&#x27;secrets.zip&#x27;, &#x27;rb&#x27;).read() # file to send&#xA;searler = SealedBox(PublicKey(JOURNALIST_PUB_KEY))&#xA;enc_file = searler.encrypt(data)&#xA;&#xA;&#xA;with torpy.http.requests() as s:&#xA;    res = s.get(BASE_URL &#x2B; &quot;/upload-url&quot;).json()&#xA;    s.put(res.get(&#x27;url&#x27;),files={&#x27;file&#x27;:enc_file}).raise_for_status()&#xA;    file_id = res.get(&#x27;id&#x27;).encode(&#x27;ascii&#x27;) &#x2B; b&#x27;=&#x27;&#xA;    enc_id = searler.encrypt(base64.urlsafe_b64decode(base64_id))&#xA;    s.put(BASE_URL &#x2B;&quot;/register-id&quot;, data=enc_id).raise_for_status()The first step is to encrypt the data to send (in this case, the file secrets.zip) using SealedBox. That is the act of encrypting the data using a public key so only the corresponding private key can open it. The next step is to use Tor to call GET /upload-url to get a JSON object back, with url and id properties. The output of this request looks something like this:{&#xA;  &quot;id&quot;: &quot;ArMvWgDBEXyVap-O7VbD-ELzDJ0ZB_2ir9E51RVv9-4&quot;,&#xA;  &quot;url&quot;: &quot;https://cloud-dead-drop.s3.amazonaws.com/uploads/ArMvWgDBEXyVap-O7VbD-ELzDJ0ZB&#xA;_2ir9E51RVv9-4?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=ASIARAM4NNC5DUOXEDI7%2F20240522%2Fil-central-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20240522T18412&#xA;7Z&amp;X-Amz-Expires=3600&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Security-Token=IQoJb3JpZ2&#xA;luX2VjEE-redacted-Z1BIyzgmj%2F9NhhNqdIPwnSV%2F6nvRhWrthEz0H8jRNU6U%2BoPh7zZTtQ&#xA;IrU5ahNmpWjLNGUnqNMYfNCNU%2FRX%2BUyERFwlMT7yrYIbxUyWUDwde1IXOHjkTns07kXmBlLG1u&#xA;Bvt6RDrE0xjFs%3D&amp;X-Amz-Signature=c9498fb-redacted-9150ce4cb85&quot;&#xA;&#xA;}The output is basically a random name of the file and an S3 presigned URL. Note that the file id is a base64 value, with the padding removed, which is why I have to add back the = character when decoding the value. We can use that URL to upload the file to S3 (or a compatible service), and then we PUT /register-id with the encrypted&#xA0;file id, again using the journalist public key. In other words, we have broken the upload process into four separate stages:Encrypt the fileRequest an upload url and get a random file idUpload the encrypted fileEncrypt the file id and register itThe entire process is done over Tor, ensuring that our physical location is not leaked. It&#x2019;s interesting to note that just using Tor isn&#x2019;t enough. A&#xA0;Harvard student making bomb threats was arrested because he used Tor via the campus WiFi. It was easy enough to narrow down &#x201C;all Tor users in a particular time frame from location&#x201D; and go through them one at a time.SecureDrop has a whole list&#xA0;of steps&#xA0;to take in order to increase your safety at this stage, by the way, Tor is basically just the start here, and physical security is of paramount importance. This looks like a really convoluted way to do things, I know, but there is some logic behind everything. Let&#x2019;s look at the actual implementation and see how all those pieces look from the other side. In terms of the architectural diagram, here is what we use to generate the upload URL:The following code implements the logic for the upload-url endpoint. As you can see, there is really nothing&#xA0;here. We generate a random 32-byte token, which will serve as the file id, generate the pre-signed URL, and hand it over to the caller.upload_bucket = os.environ.get(&#x27;UPLOAD_BUCKET&#x27;)&#xA;s3 = boto3.client(&#x27;s3&#x27;)&#xA;def generate_upload_url(event, context):&#xA;    id = secrets.token_urlsafe(32)&#xA;    resp = s3.generate_presigned_url(&#x27;put_object&#x27;,&#xA;      Params={&#x27;Bucket&#x27;: upload_bucket, &#x27;Key&#x27;: &#x27;uploads/&#x27; &#x2B; id },&#xA;      ExpiresIn=3600)  &#xA;    body = json.dumps({&#x27;id&#x27;: id, &#x27;url&#x27;: resp})&#xA;    return {&#x27;statusCode&#x27;: 200,&#x27;body&#x27;: body}The caller is free to make one or more such calls and use (or not) the pre-signed URLs that it got. The backend doesn&#x2019;t have any say in this, nor any way to influence the caller. The intent here is that we split the responsibilities, instead of having an upload that the server can gather information about. If we assume a malicious server, then requesting an upload URL doesn&#x2019;t provide much information, just the Tor exit node IP that was used. Proper setup would mean that the S3 bucket we use is not logging anything. Even if we assume that it is doing so, the only data in the log would be the Tor exit node IP. A malicious server would also have access to the actual uploaded file, but that is not usable without the private key of the journalist.At this point we have an uploaded file, but how do we actually get the journalist to know&#xA0;about it? This is the part where the real&#xA0;fun happens. First, let&#x2019;s look at the architectural diagram, then we&#x2019;ll discuss how it works in detail.There are a lot&#xA0;of moving pieces here. The design is intentionally meant to be hard to pierce since we are trying to ensure that even if the system is operated by a malicious entity, it will still retain much of its secured capabilities. (Again, this is a mental exercise for me, something to do for fun. If your life/liberty is at stake here, you probably want to get a second opinion on this design).How do we let the journalist know that we have a new file for them (and along the way, not let anyone else know about it)? The whistleblower has the file id from the server, the one used as the file name for the upload. I&#x2019;m using Libsodium SealedBox. SealedBox is a way to encrypt a value given a public key in such a way that only the owner of the associated private key can access it. SealedBox has an envelope size of 48 bytes. In other words, encrypting a 32-byte id &#x2B; 48 envelope gives us exactly 80 bytes. The whistleblower will use SealedBox to encrypt the file name, and then call the register id endpoint. Here is the associated lambda backend for the register-id&#xA0;endpoint:queue_url = os.environ.get(&#x27;NOTIFICATIONS_QUEUE&#x27;)&#xA;sqs = boto3.client(&#x27;sqs&#x27;) &#xA;&#xA;&#xA;def register_id(event, context):&#xA;    return register_id_internal(event[&#x27;body&#x27;])&#xA;def register_id_internal(msg):&#xA;    # 32 bytes payload &#x2B; SealedBox = 80 bytes -&gt; base 64 == 108 bytes&#xA;    if len(msg) != 108: &#xA;        return {&#x27;statusCode&#x27;: 400, &#x27;body&#x27;: &#x27;Invalid ID&#x27;}&#xA;    sqs.send_message(QueueUrl=queue_url, MessageBody=msg)&#xA;    return {&#x27;statusCode&#x27;: 204}It&#x2026; doesn&#x2019;t do much (you may have noticed a theme here), we are simply verifying that the size of the value matched, and then we send that to an SQS queue. By the way, if we are sending 80 bytes, why are we receiving 108 bytes? This is because we are using lambda, and the binary data is being base64&#x2019;ed by the lambda infrastructure.Just registering the (encrypted) file id in the queue isn&#x2019;t really helpful. It is just&#x2026; sitting there, who is going to read or operate on that? That is where the two timers come into place. Note that the architecture diagram has events that happen every minute and every 5 minutes. &#xA0;Every minute, we have a lambda running to maybe publish a decoy value. Its code looks like this:queue_url = os.environ.get(&#x27;NOTIFICATIONS_QUEUE&#x27;)&#xA;sqs = boto3.client(&#x27;sqs&#x27;) &#xA;&#xA;&#xA;def maybe_publish_decoy(event, context):&#xA;    if secrets.randbelow(4) != 0:&#xA;        return # 75% of the time, do nothing&#xA;    # 25% of the time, generate a decoy message&#xA;    return register_id_internal(&#xA;        base64.urlsafe_b64encode(secrets.token_bytes(80)).decode(&#x27;ascii&#x27;)&#xA;    )The maybe_publish_decoy() lambda will usually do nothing, but 25% of the time it will register a decoy value in an SQS queue. Note that the actual message we generate is just random bytes, nothing meaningful. Remember that when a user registers a file id, the file also&#xA0;ends up in the queue. Because both user ids and decoy ids end up in the same queue, and they both look like random bits, there is no way for an external observer to tell which is which. For that matter, there is no way to tell for the system itself. Once a decoy is posted to the queue, there is no way to know whether it is a decoy value or a real one. The last component in our system is actually working with the messages in the queue. Those are handled by the publish_ids() lambda, which is invoked every 5 minutes. Let&#x2019;s look at the code:MAX_MSGS = 8&#xA;upload_bucket = os.environ.get(&#x27;UPLOAD_BUCKET&#x27;)&#xA;def publish_ids(event, context):&#xA;    while True:&#xA;        result = sqs.receive_message(QueueUrl=queue_url,&#xA;                                     MaxNumberOfMessages=MAX_MSGS)&#xA;        msgs = result.get(&#x27;Messages&#x27;, [])&#xA;        ids = [msg[&#x27;Body&#x27;] for msg in msgs]&#xA;        while len(ids) &lt; MAX_MSGS:&#xA;             rnd = secrets.token_bytes(80)&#xA;             fake_id = base64.urlsafe_b64encode(rnd).decode(&#x27;ascii&#x27;)&#xA;            ids.append(fake_id)&#xA;&#xA;&#xA;        ids = sorted(ids, key=lambda _: secrets.randbelow(1024))&#xA;        output = byte(&#x27;\n&#x27;.join(ids), &#x27;ascii&#x27;)&#xA;        now = datetime.datetime.now(datetime.timezone.utc).isoformat()&#xA;        s3.put_object(Bucket=upload_bucket, Key=&#x27;ids/&#x27; &#x2B; now, Body=output)&#xA;&#xA;&#xA;        if len(msgs) == 0:&#xA;            break&#xA;        sqs.delete_message_batch(QueueUrl=queue_url, Entries=[&#xA;           {&#x27;Id&#x27;: msg[&#x27;MessageId&#x27;], &#x27;ReceiptHandle&#x27;: msg[&#x27;ReceiptHandle&#x27;]}&#xA;           for msg in msgs&#xA;        ])Every 5 minutes, the publis_ids()&#xA0;lambda runs, and it starts by reading messages from the queue. We read a batch of maximum 8 messages at a time, and round up with made up ids if there are not enough messages to store. Here is what such a file looks like:K7VruHnGhlpzWssB92OpMUjAw0-FoDyED_6p4w2LMgcV7JrsVB4SQdH7VNQzAT-jywYZsVhHM8lNF-JiWWUgXONK_Qb2DJw29aLVqw9rvIs=&#xA;HG3vHyYVCC42gzeZqgugwIciPqzeQEdNcQrFdqcpUcY5dMRInZKA_ZSFBuyvPdAfJnZm8wkS-jE0cdXZUZmp1wx2CZYWcPGu1uXocdWn2D4=&#xA;OpJWZRfQkMGuXRci8x8YrHx0REE4PdBZctj27gXjH0JvRtaSFMweL47q9nB9r6XomGnOfu5632JbEuMKPOEkkdYiVvst-1Qpw1TNzTPcQmY=&#xA;drjhGt6d-aV3h8_BjC81cE5kayXiWikgD8qxWEPYL0T4l8BrW-MadhanXcr465vIs7eBzK-DdwrmtqO8rQsrHN60-f2KirpN-qHpdlpxSbk=&#xA;rDKdp0CHSm4-Dvf8BOToLQSv79GpfqLnV3fXLECwUK9HdVEDeRK-T3SycyDmwvjUgjkH0vNMB9Yx_AeaHIS87hD2mCpyEGYKNpGMsnWZlHg=&#xA;CQ-5sgobc29-1x6adr09tOgk2yb4WNirzZ2dflQOHkXKDY0uk5B9pq_KKDjNoyWZVsRazgvqRPz3mqan2yKb3P0xAQDmF2CjyN6hMR3bjsQ=&#xA;44DYBoGFiPeN8dP7FGn579W7vFgUp8-lblI7nfFP3a0TUqo5sjCnV_Ozr4aPXbdVam6kpyhkpqkQeSeroQNP_x7iq2dpNskjx2x4WO8ezJ0=&#xA;TMC5ralR9BjHwTf0xk36kuUcbseD6HVkZgK3e1bpckyk62O_trNINa7FMNLLEwUZeQRvUBuj1CRhNWiz0wRjBvv_hxpbi9ToFymJXkz1ocA=We then write the file to another S3 folder, note that we use the iso format for the file name, which gives us lexical sorting for the values by time. Here is what this looks like on the bucket itself:As you can see, roughly every 5 minutes, we have some values being written out. The file size is always the same, and we can&#x2019;t tell based on the presence of a file if there were messages posted at a given time. In the time frame shown here, I didn&#x2019;t post any messages, but you can see that we still have two files written at 04:15, likely because there were enough messages in the queue to force us to run a second file (basically, a race condition between the decoy lambda and the publish lambda). That is a desirable&#xA0;outcome, by the way.This is&#x2026; pretty much it, I have to say. &#xA0;There aren&#x2019;t any additional behaviors or things to explore. This Rube Goldberg machine is meant to create a system that breaks apart the different sections and loses&#xA0;information as we move forward. I&#x2019;ll cover the impact of this design in the case of a malicious server later on in the post. For now, I want to cover how the journalist can read the data. The server currently holds two folders:uploads/ - allows anonymous GET for files, auto-expires in 14 days, uploads require a pre-signed URLids/ - allow anonymous GET and LIST, auto-expires in 14 days, only written to be the backend (from the queue)A journalist is going to be running a check every 5 - 10 minutes, using Tor, on the contents of the ids/&#xA0;bucket, like so:def read_messages(session, base_url, reveal, last_file = &quot;&quot;):&#xA;    while True:&#xA;        res = session.get(base_url, params={&#xA;            &#x27;prefix&#x27;: &#x27;ids/&#x27;, &#xA;            &#x27;start-after&#x27;: last_file, &#xA;            &#x27;list-type&#x27;: 2})&#xA;        res.raise_for_status()&#xA;        dict_data = xmltodict.parse(res.content)&#xA;        contents = dict_data.get(&#x27;ListBucketResult&#x27;).get(&#x27;Contents&#x27;)&#xA;        if len(contents) == 0:&#xA;            time.sleep(5 * 60)&#xA;            continue&#xA;        for file in contents:&#xA;            last_file = file.get(&#x27;Key&#x27;)&#xA;            data = session.get(base_url &#x2B; last_file)&#xA;            for line in io.BytesIO(data.content).readlines():&#xA;                id = base64.urlsafe_b64decode(line)&#xA;                try:&#xA;                    file_name = reveal.decrypt(id)&#xA;                    yield file_name&#xA;                except:&#xA;                    passWhat we are doing here is scanning the id/&#xA0;folder, getting all the id files that we haven&#x2019;t seen yet. For each of those files, we get it, and try to decrypt each of the lines in it. When done processing all the files in the folder, we&#x2019;ll wait 5 minutes, and then read the next&#xA0;file. This relies on the fact that S3 buckets return items in lexical sort order, and our publish_ids()&#xA0;lambda generates the file names in the ids/&#xA0;folder using lexically sorted timestamps.If there are many journalists listening on the system, each one of them will be making 1 - 2 remote calls every 5 minutes, seeing if there are any ids in there that they can decrypt. Note that this gives the server absolutely no information about what data each journalist is able to access. It also drastically reduces the amount of information that you need to deal with and distribute. Each journalist will need to go through roughly 250 KB per day of ids to scan for messages aimed at them. That is assuming that we have a low load system, with &lt; 8 messages / every 5 minutes. Note that this is still over 2,300 messages/day.Assuming that we have a very high load and have to push 100,000 messages a day, the amount of data that each journalist will have to scan is under 10 MB. Those are good numbers, especially since we don&#x2019;t intend&#xA0;this to be a high-traffic system.With the file id in hand, the journalist can now download and decrypt the data, like so:BASE_URL = &quot;https://deaddrop0j22dp4vl2id.onion&quot; # example only&#xA;PRIVATE_KEY = &#x27;Iei28jYsIl5E/Kks9BzGeg/36CKsrojEh65IUE2eNvA=&#x27;&#xA;key = PrivateKey(base64.b64decode(PRIVATE_KEY))&#xA;reveal = SealedBox(key)&#xA;with torpy.http.requests() as s:&#xA;    for msg in read_messages(s, BASE_URL, reveal):&#xA;        res = s.get(BASE_URL &#x2B; &quot;uploads/&quot; &#x2B; msg)&#xA;        try:&#xA;            print(reveal.decrypt(res.content))&#xA;        except:&#xA;            passWe get the file ids, download them from the S3 bucket, and decrypt them. And now the journalist can start actually looking at the data. To reply, the whistleblower would need to send their own public key to the journalist, and subscribe in the same manner to the updates. Note that this is not&#xA0;meant to be an online protocol, and you can scan the data once a day or once a week, without any real problems. That makes this system attractive since you can schedule a weekly trip to a remote location where you can anonymously check if you have anything new in your &#x201C;mailbox&#x201D;, without anyone being able to tell.With the raw technical details out of the way, let&#x2019;s consider some of the implications of this sort of system design.The cautious playbookA journalist would publish their public key, likely in their paper or website. They are interested in&#xA0;getting such information from anonymous sources. At the same time, they need to ensure that no one can tell if someone sent them information. A whistleblower wants to send information, but be protected from anything knowing that they sent it. Ideally, we should even limit the knowledge that any information was&#xA0;sent.The way SecureDrop recommends, access to the system is only via Tor and usually from a location that isn&#x2019;t near your usual haunts, which you traveled to without a phone, paid in cash, using a live-cd Tails instance. The idea of adding additional layers beyond the system encryption is that even with a powerful adversary, the number of hurdles they have to go through is very high. You have to break the system encryption, and then Tor, and then you reach some coffee shop in the middle of nowhere and need to go over footage to try to identify someone. The crazy thing is that this is actually viable. It isn&#x2019;t science fiction today to obtain the security footage (which we can safely assume exists), run it through a facial recognition system and get a list of people to check. So we need to have multiple layers of defense in place. From the point of view of this dead drop system, all the data is encrypted, the only information you have is about analyzing traffic patterns. A good way to alleviate even that is to not&#xA0;run everything at once. The whole point of breaking it into discrete steps is that you can execute it in isolation. You can get the upload url, upload the file, and then actually register the id a day later, for example. That makes timing analysis a lot&#xA0;harder.Or consider a few bots that would (via different Tor exit nodes for each operation):Request upload urls on an ongoing basis Occasionally upload random files to those urlsRead the ids/ folder filesDownload&#xA0;some of those urlsIf we have a few of those bots, and they send each other&#xA0;&#x201C;messages&#x201D; that generate decoy traffic, it is going to be much harder to track who and what is happening, since you&#x2019;ll have activity (anonymized via Tor) that hides the real actions.I think that those bots are likely to be another important layer of security, defeating traffic analysis and masking actual usage by people.Consequences of a&#xA0;malicious takeoverLet&#x2019;s consider for a moment what will happen if the system is taken over by a malicious party. In this case, we assume that there is a valid system that was taken over. Therefore, we need to figure out the impact of old&#xA0;messages that were sent and new&#xA0;messages that will be sent from now on.The design of the system calls for the following important configurations:Disabling logging on access (S3, endpoints, etc).All files (ids, uploads, etc) are deleted within 14 days.We are routing data in such a way that information is lost (registered id will be merged with decoys, etc)Assuming that a proper system was taken over by a malicious party, the only additional information that they now have is all the contents of the uploads/&#xA0;folder, which aren&#x2019;t visible to other parties (you have to know the file name to download). Given that the files are encrypted, there isn&#x2019;t much that is leaked. And the bots I talked about will mask the real traffic with dummy files. Once the system has been taken over, we can assume that the following happens: There is correlation now between calls to upload-url and the actual uploaded file. You can also correlate a registered id with an upload, assuming sufficiently low traffic (which is likely). Those are the only additional bits of information that you gain from having access to the system. When we register an id to be published, the whistleblower sends the encrypted&#xA0;value, which the server has no way of correlating to the recipient.The server can now do traffic analysis, for example, monitor that someone is reading the ids/&#xA0;folder and then downloading a file from the uploads/&#xA0;folder. But that is of limited utility, that would be:Masked by the bots traffic.Only give you the Tor exit node. A malicious party could also disable expiration and retain long-term all the uploaded files, in case they get the keys at a later time, but beyond that, I can&#x2019;t think of anything else that they will get from actually having control over the system. In particular, for the whistleblower, there is no data leakage about who they are or who they are talking to. Even with the collaboration of the journalist, if the whistleblower didn&#x2019;t provide that information, they remain anonymous.Side channelsAnother aspect of this system is that we don&#x2019;t need&#xA0;to go with the id registration and publication to journalists. The fact that this is stored (and encrypted) means that you now don&#x2019;t need to pass potentially a lot of data to a journalist, but can just give them the id itself. That is 108 bytes in base64 format, and doesn&#x2019;t convey any additional information beyond that.The question is, of course, if you can pass the id, why not just pass the encrypted file directly. Attacks and mitigationsThe design of the system makes certain attacks impossible to execute or impossible to hide. For example, you can perform denial of service attacks on a journalist by sending many&#xA0;messages that they would have to go through (you have the public key, after all). But that is obviously detectable. In general, denial of service attacks on the system can be mitigated by requiring proof of work to submit the files. What about blocking&#xA0;access from a source or to a particular journalist? There is no identifying the source, so you cannot block based on that. You can also not block the journalist, since the server doesn&#x2019;t have any idea who the destination is. You can&#xA0;block access to the system, simply by ignoring id registrations. From the outside world, it will look like someone just didn&#x2019;t send us any messages. However, that is easily detectable. A journalist can send a message to herself, and upon not receiving it, detect that the system is not operationable.Key leakageWhat happens if the key pair of a journalist leaks? That would be catastrophic for the journalist and the sources because it would enable decryption of any messages that were sent. This is mitigated by only keeping messages for a maximum of 14 days, but we must assume that an adversary has copies of all the messages that were ever sent.In this scenario, key leadage would compromise all communications intended for the journalist. Technically speaking, we can try to do a key exchange using this system, and have a temporary key assigned for a particular conversation. The problem is that this sort of system is mostly offline, with days or weeks between interactions.That means that we need to persist the keys (and can thus assume that a key pair leak will also leak any &#x201C;temporary&#x201D; keys). Something that you can do is publish not just a&#xA0;public key but several over time, with built-in expiry. Let&#x2019;s say that you publish your key in January, and replace that with a new key in February. In March, you&#x2019;ll destroy the January key, so you don&#x2019;t have a way to leak that. Having rotating keys is a cute idea, but I think in practice this is too complex. People have a hard enough time remembering things like their passwords, requiring them to remember (and change) multiple passphrases is too much. On a yearly basis, however, that makes a lot more sense. But then again, what does &#x201C;destroy the old key&#x201D; mean exactly.SummaryWell, this post has gone on entirely&#xA0;too long. I actually started writing it to play around with serverless system architecture, but I got sidetracked into everything else. It is long enough that I won&#x2019;t try to dive into the serverless aspect in this post. Maybe in a future one.As a reminder, this is a nice design, and the blog post and research consumed quite a few very enjoyable evenings, but I&#x2019;m not a security or cryptography expert. If you require a system like this, I would recommend consulting an actual professional.</p>
        </article>
        <article id="article-249">
            <a href="https://devblogs.microsoft.com/dotnet/catching-up-on-microsoft-build-2024-essential-sessions-for-dotnet-developers/" target="_blank">
                <h2 class="title mb-6" id="article-249">Catch Up on Microsoft Build 2024: Essential Sessions for .NET Developers</h2>
            </a>
            <p class="mb-2">by James Montemagno</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 30, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Get up to date on all of the .NET sessions from Microsoft Build 2024 covering .NET 9, .NET Aspire, .NET MAUI, ASP.NET Core, EF Core, and so much more!</p>
        </article>
        <article id="article-250">
            <a href="https://devblogs.microsoft.com/dotnet/fsharp-developer-stories-how-weve-finally-fixed-a-9yearold-performance-issue/" target="_blank">
                <h2 class="title mb-6" id="article-250">F# developer stories: how we&#x2019;ve finally fixed a 9-year-old performance issue</h2>
            </a>
            <p class="mb-2">by Petr Semkin</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: May 29, 2024
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Some bugs carry exciting narratives &#x2014; attempting to resolve them lets you trace the history of the repository and the community.</p>
        </article>
        <div class="button flex justify-between">
            <a href="24.html"><span class="back arrow"></span></a>

            <a href="26.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>