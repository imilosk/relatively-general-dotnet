
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 524 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-5231">
            <a href="https://ayende.com/blog/4573/nhibernate-is-lazy-just-live-with-it" target="_blank">
                <h2 class="title mb-6" id="article-5231">NHibernate is lazy, just live with it</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 04, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">At a client site, I found the following in all the mapping files:     &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;&#xA;&lt;hibernate-mapping xmlns=&quot;urn:nhibernate-mapping-2.2&quot; default-lazy=&quot;false&quot;&gt;&#xA;    &lt;class name=&quot;Machine&quot; table=&quot;Machines&quot; lazy=&quot;false&quot;&gt;&#xA;        &lt;id name=&quot;Id&quot;&gt;&#xA;            &lt;generator class=&quot;identity&quot;/&gt;&#xA;        &lt;/id&gt;&#xA;        &lt;property name=&quot;Name&quot;/&gt;&#xA;        &lt;set name=&quot;Parts&quot; table=&quot;Parts&quot; lazy=&quot;false&quot;&gt;&#xA;            &lt;key column=&quot;BlogId&quot;/&gt;&#xA;            &lt;one-to-many class=&quot;Part&quot;/&gt;&#xA;        &lt;/set&gt;&#xA;    &lt;/class&gt;&#xA;&lt;/hibernate-mapping&gt;&#xA;  &#xA;&#xA;I think that you can figure out by now what is wrong. It is too bad that the &lt;blink/&gt; tag has gone out of use, because that would be an accurate reflection of how I responded when I saw that. After I finished frothing at the mouth, I explained that you never ever do things like, because it leads to pain, mayhem and tears. &#xA;&#xA;The lead dev heard me out, then explained that their situation wasn&#x2019;t a standard web application, their server had some business functionality, but it served mainly as a way for clients to come in and get some data. The architecture looks like this:&#xA;&#xA; &#xA;&#xA;As you can imagine, NHibernate is sitting in the Application tier, but a lot of the work is done on the smart client application.&#xA;&#xA;The lead dev explained that in their scenario, they needed to send the full entity to the smart client app, so they didn&#x2019;t want lazy loading. Their scenario also precluded the need to do lazy loading over the network, so all was good, and they made the decision to use lazy=&#x201D;false&#x201D; intentionally. Their model was pretty good about not having deeply connected object graphs, too.&#xA;&#xA;I hit Google and searched for the relevant posts:&#xA;&#xA;&#xA;  ayende strippers &#x2013; Which leads to the post: The Stripper Pattern. &#xA;&#xA;  castrate ayende * &#x2013; Which leads to the post: Don&#x2019;t castrate your architecture &#xA;&#xA;&#xA;* Googling that made me very nervous.&#xA;&#xA;I include the search terms as a reminder to myself that post titles are important, because that is how I search for them after the fact. And I got some really strong (and strange) looks when I did that.&#xA;&#xA;After we discussed that we put it aside and moved to other topics. Until we came to the part where we profiled the system.&#xA;&#xA;We immediately found some trouble spots that we needed to resolve. One of them was getting a list of machines that required fixing.&#xA;&#xA;The problem was that the code looked something like this:&#xA;&#xA;&#xA;  public IEnumerable&lt;Machine&gt; GetMachinesRequiringFixes()&#xA;{&#xA;    return (from machine in session.Linq&lt;Machine&gt;()&#xA;           where machine.Status == Statuses.Broken&#xA;           select machine).Take(10);&#xA;}&#xA;  &#xA;&#xA;Looks easy, right?&#xA;&#xA;Except that this seemingly innocent piece of code was responsible for 400 queries.&#xA;&#xA;What went wrong? How could loading 10 machines result in that many queries?&#xA;&#xA;Well, let us look what NHibernate did, shall we?&#xA;&#xA;select top 10 * from Machines where Status = &#x27;Broken&#x27;&#xA;&#xA;&#xA;This gives NHibernate ten machines instances, except that when NHibernate investigate the mapping for a Machine, it realizes that it needs to load the Parts collection, since it was marked lazy=&#x201D;false&#x201D;, so NHibernate will execute ten queries for loading each Machine&#x2019;s Parts.&#xA;&#xA;select * from Parts where MachineId = 40&#xA;select * from Parts where MachineId = 41&#xA;select * from Parts where MachineId = 42&#xA;select * from Parts where MachineId = 43&#xA;select * from Parts where MachineId = 44&#xA;select * from Parts where MachineId = 45&#xA;select * from Parts where MachineId = 46&#xA;select * from Parts where MachineId = 47&#xA;select * from Parts where MachineId = 48&#xA;select * from Parts where MachineId = 49&#xA;&#xA;&#xA;But each Part also has an association for a MaintenanceHistory, which was also marked lazy=&#x201D;false&#x201D;, so NHibernate had to load those as well. (I&#x2019;ll spare you that one :-) ).&#xA;&#xA;From the client perspective, Machine,Parts &amp; Maintenance History where all part of the same entity, and they wanted to be able to be able return that to the user in a single call. (More on that fallacy in my next post).&#xA;&#xA;The problem is that when you set lazy=&#x201D;false&#x201D;, you literally ties NHibernate&#x2019;s hands. Now, you could start playing with the fetch mode option, to change that to join or subselect, but the problem is that this works when you have only one collection association (in the entire graph), because otherwise you run into sever Cartesian products issues.&#xA;&#xA;Now, NHibernate has the ability to handle just that scenario, but by setting lazy=&#x201D;false&#x201D;, you prevent NHibernate from having the chance to actually utilize them.&#xA;&#xA;There is a good reason why lazy is set to true by default, and while I am sure that there is some limited number of scenarios where lazy=&#x201D;false&#x201D; is the appropriate choice, it isn&#x2019;t for your scenario.</p>
        </article>
        <article id="article-5232">
            <a href="https://ayende.com/blog/4572/microsoft-data-and-positioning" target="_blank">
                <h2 class="title mb-6" id="article-5232">Microsoft.Data and Positioning</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 04, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just read a very insightful post from Evan Nagle about the topic. In it, Evan hit a key point:     Technically (and commercially) speaking, Microsoft has a slew of perfectly legitimate reasons for splattering the landscape with these &quot;watered down&quot; technologies. But, culturally speaking, it&#x27;s painful to the professional Microsoft developer. It is. Because the Microsoft developer&#x27;s personal and professional identity is tied up in the Microsoft stack, and that stack is now catering to a bunch of cat ladies and acne-laden teenagers. That&#x27;s the real issue here.   If Microsoft thinks that they can get the market for bad developers, good for them. But that needs to be highly segmented. It should be clear that going with that route is leading you to a walled garden and that writing real apps this way is not good. The best comparison I can think of is Access apps in the 90s. There was a clear separation between &#x201C;just wanna write some forms over data app over the weekend&#x201D; and &#x201C;I want to build a real application&#x201D;. When you built an app in Access, you had very clear idea about the limitations of the application, and you knew that if you wanted something more, it would be a complete re-write.  That was a good thing, because it meant that you could do the quick &amp; dirty things, but when things got messy, you knew that you had to make the jump.  The problem with things like Microsoft.Data is that there is no such line in the sand. And when you call it &#x201C;Microsoft.*&#x201D; you give it a seal of approval for everything. And when you have a piece of code that is explicitly designed to support bad coding practices, it is like peeing in the pool. If there is only one pool, it is going to affect everyone. There wouldn&#x2019;t be nearly as much objection if it was called WebMatrix.Data, because that would clearly put it in someone else&#x2019;s pool, and it that turn into a putrid swamp, I don&#x2019;t really care.   There is another issue here, and it is not just that the community is afraid of inheriting horrible Microsoft.Data projects. It is much more than that.   Salary data is from the UK, because that is the first site I found with the numbers)     C# average salary: &#xA3;42,000    VB.NET average salary: &#xA3;34,000   Now, I really can&#x2019;t think of a good technical reason why VB.Net programmers are paid so much less, but those data points match what I have seen about salaries for developers in both positions.  In other words, VB.Net developers are getting paid a lot less for doing the same job.  Now, why is that? Is it because of the legacy of VisualBasic still haunts the VB guys? Because there is still the impression that VB is a toy language? I don&#x2019;t know, but I think that at least in part, that is true. And that is what happen when a platform gets a reputation for being messy. People know in their bones that building stuff there is going to be costly, because maintaining this stuff is so hard.   Microsoft has repeatedly stated that they are after the people who currently go to PHP. Let me do the same comparison:     PHP average salary: &#xA3;32,500    Ruby average salary: &#xA3;45,000    Python average salary: &#xA3;47,500   I don&#x2019;t like those numbers. I really don&#x2019;t like them.   Put simply, if Microsoft attempts to make the .NET platform more approachable for the PHP guys, it is also going to devalue the entire platform. I am pretty sure that this is something that they don&#x2019;t want. Having a lot of hobbist programmer but fewer professional ones is going to hurt the Microsoft eco system.  Microsoft, if you want to create a PHP haven in the .NET world, that is great, but make sure that it is completely isolated, because otherwise you are going to hurt everyone who has a commercial stake in your platform.  I think that there is a lot of sense from commercial point of view in WebMatrix, but it should be clear that this isn&#x2019;t .NET programming, this is WebMatrix programming. So if Microsoft succeed in gaining market share for this, it won&#x2019;t be the .NET developers who would suddenly look at a 30% less money, it would be WebMatrix developers who would have to carry that stigma.</p>
        </article>
        <article id="article-5233">
            <a href="https://ayende.com/blog/4571/microsoft-data-because-the-90s-were-so-good-we-want-to-do-them-again" target="_blank">
                <h2 class="title mb-6" id="article-5233">Microsoft.Data, because the 90s were so good, we want to do them again</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 03, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just saw this post, and I had to double check the date of the post twice to be sure that I am reading about something that is going to come out soon, rather than something that have come out in 2002.  This is the code that is being proudly presented as an achievement:     using (var db = Database.Open(&quot;Northwind&quot;)) {&#xA;    foreach (var product in db.Query(&quot;select * from products where UnitsInStock &lt; 20&quot;)) {&#xA;        Response.Write(product.ProductName &#x2B; &quot; &quot; &#x2B; product.UnitsInStock);&#xA;    }&#xA;}&#xA;  &#xA;&#xA;Allow me to give you the exact statements used:&#xA;&#xA;&#xA;  The user doesn&#x2019;t have to learn about connection strings or how to create a command with a connection and then use a reader to get the results. Also, the above code is tied to Sql Server since we&#x2019;re using specific implementations of the connection, command, and reader(SqlConnection, SqlCommand, SqlDataReader).&#xA;&#xA;  Compare this with code below it. We&#x2019;ve reduced the amount of lines required to connect to the database, and the syntax for accessing columns is also a lot nicer, that&#x2019;s because we&#x2019;re taking advantage of C#&#x2019;s new dynamic feature.&#xA;&#xA;&#xA;I really don&#x2019;t know where to start. Yes, compared to raw ADO.Net I guess that this is improvement. But being beaten only thrice a week instead of daily is also an improvement. &#xA;&#xA;I mean, seriously, are you freaking kidding me? Are you telling me that you are aiming to make the life of people writing code like this easier? &#xA;&#xA;We have direct use of Response.Write &#x2013; because it is so hard to create maintainable code, we decided to just give up from the get go. Beyond that, putting SQL directly in the code like that, including the parameters, is an open invitation for SQL injection.&#xA;&#xA;Next, let us talk seriously, okay. Anyone who had to write ADO.Net code already wrapped it up. Anyone who didn&#x2019;t isn&#x2019;t going to.&#xA;&#xA;But given all the times that we have heard &#x201C;no resources to fix XYZ&#x201D; from Microsoft, are you telling me that creating a framework that is intended for really bad programmers to slide down the maintainability scale more easily? Is that a valuable use of resources?&#xA;&#xA;Writing code like that is actively harmful, period. There is really no need to deal with those low level stuff in this day and age.</p>
        </article>
        <article id="article-5234">
            <a href="https://ayende.com/blog/4570/abstracting-the-persistence-medium-isnt-going-to-let-you-switch-persistence-abstractions" target="_blank">
                <h2 class="title mb-6" id="article-5234">Abstracting the persistence medium isn&#x2019;t going to let you switch persistence abstractions</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 02, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This came in as a comment for my post about encapsulating DALs:     Just for the sake of DAL - what if I want to persist my data in another place, different than a relational database? For instance, in a object-oriented database, or just serialize the entities and store them somewhere on the disk... What about then ? NHibernate cannot handle this situation, can it ? Wouldn&#x27;t I be entitled to abstract my DAL so that it can support such case ?   The problem here is that it assume that such a translation is even possible.   Let us take the typical Posts &amp; Comments scenario. In a relational model, I would model this using two tables. Now, let us say that I have the following DAL operations:     GetPost(id)     GetPostWithComments(id)     GetRecentPostsWithCommentCount(id)    The implementation of this should be pretty obvious on a relational system.   But when you move to a document database, for example, suddenly this &#x201C;abstract&#x201D; API becomes an issue.  How do you store comments? As separate documents, embedded in the post? If they are embedded in the post, GetPost will now have the comments, which isn&#x2019;t what happens with the relational implementation. If they are separate documents, you complicated the implementation of GetPostWithComments, and GetRecentPostsWithCommentCount now have a SELECT N&#x2B;1 problem.  Now, to be absolutely clear, you can certainly do that, there are fairly simple solutions for that, but this isn&#x2019;t how you would build the system if you started from a document database standpoint.  What you would end up with in a document database design is probably just:     GetPost(id)     GetRecentPosts(id)    Things like methods for eagerly loading stuff just don&#x2019;t happen there, because if you need to eagerly load stuff, they are embedded in the document.  Again, you can make this work, but you end up with a highly procedural API that is very unpleasant to work with. Consider the Membership Provider API as a good example of that. The API is a PITA to work with compared to APIs that don&#x2019;t need to work to the lowest common denominator.  When talking about data stores, that usually means limit yourself to key/value store operations, and even then, there is stuff that leaks through. Let me show you an example that you might be familiar with:     The MembershipProvider is actually a good example of an API that try to fit several different storage systems. It has a huge advantage from the get go because it comes with two implementations for two different storage systems (RDBMS and ActiveDirectory).   Note the API that you have, not only is it highly procedural, but it can also assume nothing about its implementation. It makes for code that is highly coupled to this API and to this form of working with data in procedural fashion. This make it much harder to work with compared to code using a system that enable automatic change tracking and data store synchronization (pretty much every ORM).  That is one problem of such APIs, it greatly increase the cost of working with it. Another problem is that stuff still leaks through.  Take a look at the GetNumberOfUsersOnline method. That is a method that can only be answered efficiently on a relational database. The ActiveDirectoryMembershipProvider just didn&#x2019;t implement this method, because it isn&#x2019;t possible to answer that question from ActiveDirectory.  By that same token, you can&#x2019;t implement FindUsersByEmail, FindUsersByName on a key/value store (well, you can maintain a reverse index, of course), nor can you implement GetAllUsers.  You can&#x2019;t abstract the nature of the underlying data store that you use, it is going to leak through. The issues isn&#x2019;t so much if you can make it work, you usually can, the issue is if you can make it work efficiently. Typical problems that show up is that you try to map concepts that simply do not exists in the underlying data store.  Relations is a good example of something that it is very easy to do in SQL but very hard to do using almost anything else. You can still do that, of course, but now your code is full of SELECT N&#x2B;1 and you can waive goodbye to your performance. If you build an API for a document database and try to move it to a relational one, you are going to get hit with &#x201C;OMG! It takes 50 queries to save this entity on a database, and 1 request to save it on a DocDb&#x201D;, leaving aside the problem that you are also going to have problems reading it from a relational database (the API would assume that you give back the full object).  In short, abstractions only work as long as you can assume that what you are abstracting is roughly similar. Abstracting the type of the relational database you use is easy, because you are abstracting the same concept. But you can&#x27;t abstract away different concepts. Don&#x2019;t even try.</p>
        </article>
        <article id="article-5235">
            <a href="https://ayende.com/blog/4569/package-management-for-net-nu" target="_blank">
                <h2 class="title mb-6" id="article-5235">Package management for .NET: Nu</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 01, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Package management for .NET has long been an issue. I won&#x2019;t rehash the story, but you can read about a lot of the problems here.  There has been several attempts to replicate the success of Gems in Ruby, but none has really taken hold. Dru Sellers &amp; Rob Reynolds had decided to take a slightly different approach. Instead of trying to replicate Ruby&#x2019;s gems, just use them.  That is how Nu was created (and I really want to know what that name was picked, I nearly titled this post Dr. No). Before you can use Nu, you need to install it, which means that you have to make the following one time steps:     Install Ruby (you can also use Iron Ruby, but the Ruby installer is just sweet &amp; painless).    gem install nu   Once this is done, all you need to do to install a piece of software is just write:     nu install rhino.mocks    nu install nhibernate   And Nu will get the latest version (including resolving dependencies) and put them in your lib folder.  After executing the two commands above, I have the following contents in my lib directory.     castle.core    castle.dynamicproxy2    log4net    nhibernate    rhino.mocks   I like it, it is going to make things so much simpler!</p>
        </article>
        <article id="article-5236">
            <a href="https://ayende.com/blog/4568/silverlight-queues-design" target="_blank">
                <h2 class="title mb-6" id="article-5236">Silverlight Queues: Design</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 31, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I got a question about the feasibility of porting Rhino Queues to Silverlight, but that isn&#x2019;t really something that can fit in that scenario. So I set down to write the design for a Silverlight queuing system. Just to be clear, I have no intention currently to actually build this at this time (well, not unless someone is willing to pay for it or I get a project that requires it). This is merely a way to get the design problem off my head.  Why can&#x2019;t we just port Rhino Queues to Silverlight?  There are two reasons, one is technical, the second relates to the different way that Silverlight applications are used. The first problem is that Rhino Queues requires a way to listen to incoming messages, but Silverlight offers no way of doing such (reasonably so, FWIW, since that would turn the Silverlight app to a server, and there are probably security issues with that).  The second problem is simply that the way most Silverlight solutions are structured, there is going to be a WAN between the Silverlight app and the server, and WAN between each client. Direct connections between the Server &amp; Silverlight client is likely to be possible only when using HTTP, and there isn&#x2019;t going to be any direct communication between different clients.  This usually looks something like this:     Rhino Queues is built on the notion of independent agents, each of them containing a full queuing stack. That model will not work for Silverlight. In Silverlight, we need to support all the usual queuing features, but each agent (Silverlight application) is no longer independent.  The Silverlight Queues model will be slightly different. We introduce a Queues server component which will hold the queues &amp; messages internally.      On the client side, the process of sending messages is:     Queues.Send(&#x201C;server&#x201D;, &#x201C;Orders&#x201D;, new Buy{ &#x2026; });    Message is saved to isolated storage    A background thread send the messages from isolated storage to the Queues server.   The process of receiving messages is:     A background thread periodically pools (an alternative is a Comet using something like WebSync) the server for new messages.    Messages are written to isolated storage    The Silverlight acknowledge the receipt of the messages.   There are some twists here, though.  In a Silverlight application, there are going to be several possible use cases:     Each Silverlight application has its own &#x201C;queue&#x201D; in the Queues server. That allows a one-way messaging platform with point to point notification. That is likely to be common in Silverlight applications that handle business transactions.     Topics, in addition to a queue per client, we might also want to allow subscription to topics, for example, I may be interested in getting notifications when the system settings have changed. That is something that is shared among all (or a lot) of clients. The Queues server should support this as well.   An interesting approach to make the Queues server even more stateless is to remove the process of acknowledgement and change it to &#x201C;give me all messages after&#x2026;&#x201D;  Yes, I know that this is a very high level design, but there really isn&#x2019;t much here that I can call very complex.  How much interest is there in Queuing system in Silverlight?</p>
        </article>
        <article id="article-5237">
            <a href="https://ayende.com/blog/4567/the-false-myth-of-encapsulating-data-access-in-the-dal" target="_blank">
                <h2 class="title mb-6" id="article-5237">The false myth of encapsulating data access in the DAL</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 30, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is a question that I get routinely, both from random strangers and when I am at clients.     I would like to design a system/application using NHibernate. But I also want to so flexible that in future ,if I unplug the NHibernate and use ADO.NET Entity framework or other framework then my application should not       crash.   In short, I am completely opposed for even trying doing something like that.  It is based on flawed assumptions  A lot of the drive behind this is based on the historical drive built in the time where data access layers directly accessed a database using its own dialect, resulting in the need to create just such an encapsulation in order to support multiple databases.  The issue with this drive is that it is no longer a factor, all modern OR/Ms can handle multiple databases effectively. Moreover, modern OR/M are no longer just ways to execute some SQL and get a result back, which is how old style DAL were written. An OR/M takes on a lot more responsibilities, from things like change tracking to cache management, from ensuring optimistic concurrency&#xA0; to managing optimal communication with the database.  And those features matter, a lot. Not only that, but they are different between each OR/M.  It doesn&#x2019;t work, and you&#x2019;ll find that out too late  The main problem is that no matter how hard you try, there are going to be subtle and not so subtle differences between different OR/Ms, those changes can drastically affect how you build your application.  Here are a few examples, using NHibernate and EF.                     Feature          NHibernate          Entity Framework                        Futures          Yes          No                        Batching          Yes          No                        Transaction handling          Requires explicit code          Implicitly handled                        Caching          1st &amp; 2nd level caching          1st level caching only               This isn&#x2019;t intended to be a NH vs. EF, and it doesn&#x2019;t even pretend to be unbiased, I am simply pointing out a few examples of features that you can take advantage of which can greatly benefit you in one situation, which do not exists in another.  It has a high cost  In order to facilitate this data access encapsulation, you have to do one of two things:     Use the lowest common denominator, preventing you from using the real benefits of the OR/M in question.     Bleed those features through the DAL, allowing you to make use of those features, but preventing you from switching at a later time.    Either of those add complexity, reduce flexibility and creates confusion down the road. And in general, it still doesn&#x2019;t work.  There are other barriers than the API  Here is an example from a real client, which insists on creating this encapsulation and hiding NHibernate inside their DAL. They run into the previously mentioned problems, where there are NHibernate features specifically designed to solve some of their problems, but which they have hard time to implement through their DAL.  Worse, from the migration perspective, most of the barrier for moving from NHibernate isn&#x2019;t in the API. Their entity model make a heavy use on NHibernate&#x2019;s &lt;any/&gt; feature, which large percentage other OR/Ms do not support. And that is merely the example that spring most forcibly to mind, there are others.  The real world doesn&#x2019;t support it, even for the simplest scenarios  A while ago I tried porting the NerdDinner application to NHibernate. Just to point it out, that application have a single entity, and was designed with a nice encapsulation between the data access and the rest of the code. In order to make the port, I had to modify significant parts of the codebase. And that is about the simplest example that can be.  The role of encapsulation  Now, I know that some people would read this as an attack of encapsulation of data access, but that isn&#x2019;t the case. By all mean, encapsulate to your heart&#x2019;s content. But the purpose of this encapsulation is important. Trying to encapsulate to make things easier to work with, great. Trying to encapsulate so that you can switch OR/Ms? Won&#x2019;t work, will be costly and painful.  So how do you move between OR/Ms?  There are reasons why some people want to move from one data access technology to the other. I was involved in several such efforts, and the approach that we used in each of those cases was porting, rather than trying to drop a new IDaataAccess implementation.</p>
        </article>
        <article id="article-5238">
            <a href="https://ayende.com/blog/4566/ef-prof-and-code-only" target="_blank">
                <h2 class="title mb-6" id="article-5238">EF Prof and Code Only</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 30, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just finish touching up a new feature for EF Prof, support for Entity Framework&#x2019;s Code Only feature. What you see below is EF Prof tracking the Code Only Nerd Dinner example:     I tried to tackle the same thing in CTP3, but I was unable to resolve it. Using CTP4, it was about as easy as I could wish it.  Just for fun, the following screen shot looks like it contains a bug, but it doesn&#x2019;t (at least, not to my knowledge). If you can spot what the bug is, I am going to hand you a 25% discount coupon for EF Prof. If you can tell me why it is not a bug, I would double that.  As an aside, am I the only one that is bothered by the use of @@IDNETITY by EF? I thought that we weren&#x2019;t supposed to make use of that. Moreover, why write this complex statement when you can write SELECT @@IDENTITY?</p>
        </article>
        <article id="article-5239">
            <a href="https://ayende.com/blog/4565/a-question-of-an-untenable-situation" target="_blank">
                <h2 class="title mb-6" id="article-5239">A question of an untenable situation</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 29, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the most common issues that I run into in my work is getting all sort of questions which sound really strange. For example, I recently got a question that went something like this:     What is the impact of reflection on NHibernate&#x2019;s performance?   I started to answer that there isn&#x2019;t one that you would notice, even beyond the major optimizations that NH had in that role, you are accessing a remote database, which is much more expensive. But then they told me that they profiled the application and found some stuff there about that.  I asked them what their scenario was, and the exchange went like that:     Well, when we load a million rows&#x2026;   And that is your problem&#x2026;  To be fair, they actually had a reasonable reason to want to do that. I disagree with the solution that they had, but it was a reasonable approach to the problem at hand.</p>
        </article>
        <article id="article-5240">
            <a href="https://ayende.com/blog/4564/reviewing-communitycourses-a-ravendb-application" target="_blank">
                <h2 class="title mb-6" id="article-5240">Reviewing CommunityCourses: A RavenDB application</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: July 28, 2010
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The code for CommunityCourses can be found here: http://github.com/adam7/CommunityCourses  This is a RavenDB application whose existence I learned about roughly an hour ago. The following is a typical code review about the application, not limited to just RavenDB.  Tests  When I first opened the solution, I was very happy to see that there are tests for the application, but I was disappointed when I actually opened it.      The only tests that exists seems to be the default ones that comes with ASP.Net MVC.  I would rather have no test project than a test project like that.  Account Controller, yet again  Annoyed with the test project, I headed for my favorite target for frustration, the MVC AccountController and its horrid attempt at creating DI or abstractions.  Imagine my surprise when I found this lovely creature instead:     [HandleError]&#xA;public partial class AccountController : Controller&#xA;{&#xA;    public virtual ActionResult LogOn()&#xA;    {&#xA;        return View();&#xA;    }&#xA;&#xA;    [AcceptVerbs(HttpVerbs.Post)]&#xA;    public virtual ActionResult LogOn(string userName, string password)&#xA;    {&#xA;        if (FormsAuthentication.Authenticate(userName, password))&#xA;        {&#xA;            FormsAuthentication.SetAuthCookie(userName, false);&#xA;            return RedirectToAction(&quot;Index&quot;, &quot;Home&quot;);&#xA;        }&#xA;        else&#xA;        {&#xA;            ModelState.AddModelError(&quot;logon&quot;, &quot;Invalid username or password&quot;);&#xA;            return View();&#xA;        }&#xA;    }&#xA;&#xA;    public virtual ActionResult LogOff()&#xA;    {&#xA;        FormsAuthentication.SignOut();&#xA;        return RedirectToAction(&quot;Index&quot;, &quot;Home&quot;);&#xA;    }&#xA;}&#xA;  &#xA;&#xA;Yes, simple, work, simple, uncomplicated! You don&#x2019;t have to think when reading this code, I like it. That is how the Account Controller should have been, by default. &#xA;&#xA;The model&#xA;&#xA;I then turned into the model. Community Courses is a RavenDB application, so I am very interested in seeing how this is handled. The first thing that I noticed was this:&#xA;&#xA; &#xA;&#xA;That was interesting, I am not used to seeing static classes in the model. But then I looked into those classes, and it all became clear:&#xA;&#xA; &#xA;&#xA;This is essentially a lookup class. &#xA;&#xA;Then I switched to the rest of the model, the following image shows a partial view of the model, annotated a bit:&#xA;&#xA; &#xA;&#xA;The classes with the Id property (highlighted) are presumed to be Root Entities (in other words, they would each reside in their own document). I am not absolutely sure that this is the case yet, but I am sure enough to point out a potential problem.&#xA;&#xA;Did you notice that we have references to things like Address, Person and Centre in the model? They are marked with red and green points.&#xA;&#xA;A green point is when we reference a class that doesn&#x2019;t have an id, and is therefore considered to be a value type which is embedded in the parent document. A red point, however, indicate what I believe will be a common problem for people coming to RavenDB from an OR/M background. &#xA;&#xA;RavenDB doesn&#x2019;t support references (this is by design), and the result of referencing a Root Entity in another Root Entity is that the referenced entity is embedded inside the referencing document. This is precisely what you want for value types like Address, and precisely what you don&#x2019;t want for references. You can see in TasterSession that there are actually two references to Tutor, one for the Tutor data and one for the TutorId. I think that this is an indication for hitting that problem.&#xA;&#xA;For myself, I would prefer to not denormalize the entire referenced entity, but only key properties that are needed for processing the referencing entity. That make is easier to understand the distinction between the Person instance that is mapped to people/4955 and the Person instance that is help in Centre.Contact.&#xA;&#xA;Session management&#xA;&#xA;Next on the list, because it is so easy to get it wrong (I saw so many flawed NHibernate session management):&#xA;&#xA; &#xA;&#xA;This is great, we have a session per request, which is what I would expect in a we application.&#xA;&#xA;I might quibble with the call to SaveChanges, though. I like to make that one an explicit one, rather than implicit, but that is just that, a quibble.&#xA;&#xA;Initializing RavenDB&#xA;&#xA;This is worth speaking about (it happens in Application_Start):&#xA;&#xA; &#xA;&#xA;RavenDB is pretty conventional, and Community Courses override one of those conventions to make it easier to work with MVC. By default, RavenDB will use ids like: &#x201C;people/391&#x201D;, &#x201C;centres/912&#x201D;, by changing the identity parts separator, it will ids like: &#x201C;people-952&#x201D;, &#x201C;centres-1923&#x201D;. The later are easier to work with in MVC because they don&#x2019;t contain a routing character.&#xA;&#xA;Centre Controller&#xA;&#xA;This is a simple CRUD controller, but it is worth examining nonetheless:&#xA;&#xA; &#xA;&#xA;Those are all pretty simple. The only thing of real interest is the Index action, which uses a query on an index to get the results.&#xA;&#xA;Currently the application doesn&#x2019;t support paging, but it probably should, which wouldn&#x2019;t complicate like all that much (adding Skip &amp; Take, that is about it).&#xA;&#xA;Next, the Create/Edit actions:&#xA;&#xA; &#xA;&#xA;&#xA;&#xA;They are short &amp; to the point, nothing much to do here. I like this style of coding very much. You could fall asleep while writing it. The only comment beyond that is that those methods are so similar that I would consider merging them into a single action.&#xA;&#xA;Course Controller&#xA;&#xA;Things are starting to get much more interesting here, when we see this method:&#xA;&#xA; &#xA;&#xA;Overall, it is pretty good, but am very sensitive to making remote calls, so I would change the code to make only a single remote call:&#xA;&#xA;CourseViewModel ConvertToCourseViewModel(Course course)&#xA;{&#xA;    var ids = new List&lt;string&gt; { course.CentreId, course.TutorId, course.UnitId };&#xA;    if(course.VerifierId != null)&#xA;        ids.Add(course.VerifierId);&#xA;    ids.AddRange(course.StudentIds);&#xA;&#xA;    var results = MvcApplication.CurrentSession.Load&lt;object&gt;(ids.ToArray());&#xA;&#xA;    var courseViewModel = new CourseViewModel&#xA;    {&#xA;        Centre = (Centre)results[0],&#xA;        CentreId = course.CentreId,&#xA;        EndDate = course.EndDate,&#xA;        Id = course.Id,&#xA;        Name = course.Name,&#xA;        StartDate = course.StartDate,&#xA;        StudentIds = course.StudentIds,&#xA;        Tutor = (Person)results[1],&#xA;        TutorId = course.TutorId,&#xA;        Unit = (Unit)results[2],&#xA;        UnitId = course.UnitId,                &#xA;        VerifierId = course.VerifierId&#xA;    };&#xA;    int toSkip = 3;&#xA;    if (course.VerifierId != null)&#xA;    {&#xA;        toSkip &#x2B;= 1;&#xA;        courseViewModel.Verifier = (Person)results[3];&#xA;    }&#xA;&#xA;    courseViewModel.Students = results.Skip(toSkip).Cast&lt;Person&gt;().ToList();&#xA;&#xA;    return courseViewModel;&#xA;}&#xA;&#xA;&#xA;This is slightly more complex, but I think that the benefits outweigh the additional complexity.&#xA;&#xA;5N&#x2B;1 requests ain&#x2019;t healthy&#xA;&#xA;The following code is going to cause a problem:&#xA;&#xA; &#xA;&#xA;It is going to cause a problem because it makes a single remote call (the Query) and for every result from this query it is going to perform 5 remote calls inside ConvertToCourseViewModel.&#xA;&#xA;In other words, if we have twenty courses to display, this code will execute a hundred remote calls. That is going to be a problem. Let us look at how the document courses-1 looks like:&#xA;&#xA;{&#xA;    &quot;CentreId&quot;: &quot;centres-1&quot;,&#xA;    &quot;Status&quot;: &quot;Upcoming&quot;,&#xA;    &quot;Name&quot;: &quot;NHibernate&quot;,&#xA;    &quot;StartDate&quot;: &quot;/Date(1280361600000)/&quot;,&#xA;    &quot;EndDate&quot;: &quot;/Date(1280534400000)/&quot;,&#xA;    &quot;UnitId&quot;: &quot;units-1&quot;,&#xA;    &quot;TutorId&quot;: &quot;people-1&quot;,&#xA;    &quot;VerifierId&quot;: null,&#xA;    &quot;StudentIds&quot;: [&#xA;        &quot;people-1&quot;&#xA;    ]&#xA;}&#xA;&#xA;&#xA;And here is how the UI looks like:&#xA;&#xA; &#xA;&#xA;I think you can figure out what I am going to suggest, right? Instead of pulling all of this data at read time (very expensive), we are going to denormalize the data at write time, leading to a document that looks like this:&#xA;&#xA;{&#xA;    &quot;CentreId&quot;: { &quot;Id&quot;:  &quot;centres-1&quot;, &quot;Name&quot;: &quot;SkillsMatter London&quot; },&#xA;    &quot;Status&quot;: &quot;Upcoming&quot;,&#xA;    &quot;Name&quot;: &quot;NHibernate&quot;,&#xA;    &quot;StartDate&quot;: &quot;/Date(1280361600000)/&quot;,&#xA;    &quot;EndDate&quot;: &quot;/Date(1280534400000)/&quot;,&#xA;    &quot;UnitId&quot;: { &quot;Id&quot;: &quot;units-1&quot;, &quot;Name&quot;: &quot;1 - Introduction to Face Painting&quot;},&#xA;    &quot;TutorId&quot;: { &quot;Id&quot;: &quot;people-1&quot;, &quot;Name&quot;: &quot;Mr Oren Eini&quot; },&#xA;    &quot;VerifierId&quot;: null,&#xA;    &quot;StudentIds&quot;: [&#xA;        { &quot;Id&quot;: &quot;people-1&quot;, &quot;Name&quot;: &quot;Ayende Rahien&quot; }&#xA;    ]&#xA;}&#xA;&#xA;&#xA;Using this approach, we can handle the Index action shown above with a single remote call. And that is much better.&#xA;&#xA;I am going to ignore actions whose structure we already covered (Edit, Details, etc), and focus on the interesting ones, the next of which is:&#xA;&#xA; &#xA;&#xA;This is an excellent example of how things should be. (Well, almost, I would remove the unnecessary Store call and move the StudentIds.Add just before the foreach, so all the data access happens first, it makes it easier to scan). Using an OR/M, this code would generate 8 remote calls, but because Raven&#x2019;s documents are loaded as a single unit, we have only 3 here (and if we really wanted, we can drop it to one). &#xA;&#xA;Next, we update a particular session / module in a student. &#xA;&#xA; &#xA;&#xA;We can drop the unnecessary calls to Store, but beside that, it is pretty code. I don&#x2019;t like that moduleId / sessionId are compared to the Name property, That seems confusing to me. &#xA;&#xA;Charting with RavenDB&#xA0;&#xA;&#xA;I am showing only the parts that are using RavenDB here:&#xA;&#xA;&#xA;&#xA;There is one problem with this code, it doesn&#x2019;t work. Well, to be bit more accurate, it doesn&#x2019;t work if you have enough data. This code ignores what happen if you have enough people to start paging, and it does a lot of work all the time. It can be significantly improved by introducing a map/ reduce index to do all the hard work for us:&#xA;&#xA; &#xA;&#xA;&#xA;&#xA;This will perform the calculation once, updating it whenever a document changes. It will also result in much less traffic going on the network, since the data that we will get back will look like this:&#xA;&#xA; &#xA;&#xA;Person Controller doesn&#x2019;t contain anything that we haven&#x2019;t seen before. So we will skip that and move directly to&#x2026;&#xA;&#xA;Taster Session Controller&#xA;&#xA; &#xA;&#xA;I sincerely hope that those comments were generated by a tool.&#xA;&#xA;The following three methods all shared the same problem:&#xA;&#xA; &#xA;&#xA;They all copy Centre &amp; Person to the TasterSession entity. The problem with that is that it generate the following JSON:&#xA;&#xA; &#xA;&#xA;References in RavenDB are always embedded in the referencing entity. This should be a denomralized reference instead (just Id &amp; Name, most probably).&#xA;&#xA;Other aspects&#xA;&#xA;I focused exclusively on the controller / Raven code, and paid absolutely no attention to any UI / JS / View code. I can tell you that the UI looks &amp; behaves really nice, but that is about it. &#xA;&#xA;&#xA;&#xA;&#xA;&#xA;Summary&#xA;&#xA;All in all, this was a codebase that was a pleasure to read. There are some problems, but they are going to be easy to fix.</p>
        </article>
        <div class="button flex justify-between">
            <a href="523.html"><span class="back arrow"></span></a>

            <a href="525.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>