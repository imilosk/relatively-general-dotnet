
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 620 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-6191">
            <a href="https://ayende.com/blog/3818/nh-prof-balancing-functionality-simplicity-and-form" target="_blank">
                <h2 class="title mb-6" id="article-6191">NH Prof</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 18, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">There are two features that I want to get done before I call a feature freeze on NH Prof and just deal with any bugs and improvements that come up until I feel it is mature enough to call it v1.0.  One of them is filtering capability. This was a pretty common request once people started realizing the kind of things that they can do with NH Prof.  Ad hoc filtering into NHibernate&#x2019;s activity can bring up a lot of insight, and I certainly think that this would be an good feature to have.  The problem is that while this is a good feature, it also introduce a significant amount of complexity. This wouldn&#x2019;t be a problem if the complexity was on the application side. We can deal with complexity.  The problem is that I think that this introduce a not insignificant amount of complexity into the user&#x27;s&#x2019; hands. Take a look at the mock UI that I created:    This isn&#x2019;t the way it will end up looking, but it is a good place to start the conversation.  What is your opinion?</p>
        </article>
        <article id="article-6192">
            <a href="https://ayende.com/blog/3817/nh-prof-new-feature-url-tracking" target="_blank">
                <h2 class="title mb-6" id="article-6192">NH Prof new feature</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 18, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Now that is what I call a hard to build feature. Well, it wasn&#x2019;t hard, it was just tedious to do. This feature required me to modify 66 files(!). Since I pride myself on the mostly frictionless nature of NH Prof, that was annoying. The real issue was that this required that I would change all layers in the application to start tracking the URL from which the event was generated. Since we have a rigid separation between the different parts, and since we track so many things, it was mainly an annoying task to go and add a URL to all of them.  Anyway, you probably don&#x2019;t really care about my trouble in implementing this feature, let us talk about the actual feature.  We can track which URL opened a session:       And even which URL is responsible for each session:    This is the first of the last three features that I have left. I&#x2019;ll discuss the other two shortly.</p>
        </article>
        <article id="article-6193">
            <a href="https://ardalis.com/devreach-dvds/" target="_blank">
                <h2 class="title mb-6" id="article-6193">DevReach DVDs</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 17, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Earlier this week, I received a package of DVDs from the DevReach conferenceI was invited to speak at last October. I&#x2019;ve already written&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-6194">
            <a href="https://ayende.com/blog/3816/did-i-miss-something-since-when-can-you-do-it" target="_blank">
                <h2 class="title mb-6" id="article-6194">Did I miss something? Since when can you do it?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 17, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">It works :-)</p>
        </article>
        <article id="article-6195">
            <a href="https://ayende.com/blog/3815/the-other-side-of-build-vs-buy-decisions" target="_blank">
                <h2 class="title mb-6" id="article-6195">The other side of build vs. buy decisions</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 17, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is one of the most common arguments in the software world. I am usually firmly in the &#x201C;just buy this stuff&#x201D; party. Yes, I know that it looks like I am the guy that the &#x201C;build it ourselves&#x201D; party threw out because he was too radical, but do not let the misconception fool you.  I firmly believe that if you can get what you want by just buying something off the shelve, I think you should do it. The only qualification to that whatever you buy should be able to meet your needs.  What we have here is an email I just sent to a company I bought a 2,000$ component from. I did that after doing a fair amount of study on the topic, understanding what I need and what is the cost of trying to build that. I think that I&#x2019;ll let the email stand on its own.      It has been 3 business days since I first indicated that I had critical issues with [product name].     Up to this point, I have had no further communication from you.     To repeat, I cannot [description of the problem]. Rendering the entire purchase unusable to me.     At this point in time, this issue is stopping me from releasing my software.      I am deeply disturbed by this lack of communication from you. I do not expect an immediate resolution, but I believe that three business days for a critical failure in the software is more than a reasonable time to respond to my issue.     This indicate a general problem with your support option, and is a cause for grave concern with regards to the level of trust that I can put in any component that I buy from you.     I expect to hear from you by Monday with regards to this issue, and I hope we will be able to reach a speedy resolution of this issue.     Assuming that we don&#x27;t, I would like to remind you of Section 7 and 8 of our contract. [relating to warranty and refunds]   And no, I do not intend to disclose who that company is.</p>
        </article>
        <article id="article-6196">
            <a href="https://ayende.com/blog/3814/the-really-long-way-to-query-with-nhibernate" target="_blank">
                <h2 class="title mb-6" id="article-6196">The REALLY long way to query with NHibernate</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 17, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am doing some work on NHibernate, mostly rediscovering how things works. It is quite amazing how those things work, to tell you the truth. A few days ago I had a conversation about the NH source and I made three rapid discoveries that reduce the complexity of a feature by three orders of magnitude.  The code that I am showing is how NHibernate manages its queries internally (well, one way of doing that). This is internal information, so not only you would never do that, but you canot even do that.                    1: using (var s = sessions.OpenSession())&#xA;&#xA;         2: using (var tx = s.BeginTransaction())&#xA;&#xA;         3: {&#xA;&#xA;         4:     var sessionImplementor = ((ISessionImplementor)s);&#xA;&#xA;         5:     var q = new QueryTranslator(&quot;query&quot;,&#xA;&#xA;         6:                                 &quot;query&quot;,&#xA;&#xA;         7:                                 sessionImplementor.EnabledFilters,&#xA;&#xA;         8:                                 sessionImplementor.Factory);&#xA;&#xA;         9:&#xA0; &#xA;&#xA;        10:     var p = q.GetPersisterUsingImports(&quot;Animal&quot;);&#xA;&#xA;        11:     var entityName = q.CreateNameFor(p.EntityName);&#xA;&#xA;        12:     q.AddFromClass(entityName, p);&#xA;&#xA;        13:&#xA0; &#xA;&#xA;        14:     q.SetAliasName(&quot;a&quot;, entityName);&#xA;&#xA;        15:&#xA0; &#xA;&#xA;        16:     var currentName = q.Unalias(&quot;a.Id&quot;);&#xA;&#xA;        17:     var pathParser = new PathExpressionParser();&#xA;&#xA;        18:     pathParser.Start(q);&#xA;&#xA;        19:     foreach (var token in new StringTokenizer(currentName, &quot;.&quot;, true))&#xA;&#xA;        20:     {&#xA;&#xA;        21:         pathParser.Token(token, q);&#xA;&#xA;        22:     }&#xA;&#xA;        23:     pathParser.End(q);&#xA;&#xA;        24:&#xA0; &#xA;&#xA;        25:     q.AddFromJoinOnly(pathParser.Name, pathParser.WhereJoin);&#xA;&#xA;        26:&#xA0; &#xA;&#xA;        27:     q.AddNamedParameter(&quot;id&quot;);&#xA;&#xA;        28:&#xA0; &#xA;&#xA;        29:     q.AppendWhereToken(new SqlString(pathParser.WhereColumns[0]));&#xA;&#xA;        30:     q.AppendWhereToken(new SqlString(&quot;=&quot;));&#xA;&#xA;        31:     q.AppendWhereToken(new SqlString(Parameter.Placeholder));&#xA;&#xA;        32:&#xA0; &#xA;&#xA;        33:     q.RenderSqlAndPostInstansiate();&#xA;&#xA;        34:     var fromDb = q.List(sessionImplementor, &#xA;&#xA;        35:         CreateQueryParameters(sessionImplementor, &#xA;&#xA;        36:             &quot;id&quot;, &#xA;&#xA;        37:             new TypedValue(NHibernateUtil.Int32, 1, sessionImplementor.EntityMode)));&#xA;&#xA;        38:&#xA0; &#xA;&#xA;        39:     var contains = s.Contains(fromDb[0]);&#xA;&#xA;        40:     Assert.IsTrue(contains);&#xA;&#xA;        41:&#xA0; &#xA;&#xA;        42:     tx.Commit();&#xA;&#xA;        43: }&#xA;    &#xA;  &#xA;&#xA;&#xA;I just thought that this is an interesting piece of code.</p>
        </article>
        <article id="article-6197">
            <a href="https://ayende.com/blog/3813/rhino-dht-persistent-distributed-storage" target="_blank">
                <h2 class="title mb-6" id="article-6197">Rhino.DHT &#x2013; Persistent &amp; Distributed Storage</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 17, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is an interesting project, even if I say so myself. For several reasons, I need a fast and easy key/value store. After looking a bit around to see what there is out there, I decided that I might as well write my own. I already wrote a distributed cache in the past, and it is a very simple project to do. The twist for now was that I had to do this in a persistent manner. A system restart should not rewipe the cache.  More than that, I wanted to duplicate some of the more interesting aspects of Amazon&#x2019;s Dynamo of multi valued keys. I usually like to claim that the API that I strive for is simple. In this case, I don&#x2019;t think that I can say so. It is simple, if you understand that there is a small twist. It is not just a simple distributed hashtable, we have the notion of versioned concurrency here as well.  Here is the class diagram:     The first thing to pay attention to is that every piece of the API contains the notion of a version. More than that, it usually contain the notion of versions.  I think that the best way of describing this would be with picture, so let us imagine the DHT initially.     It is empty, has no values, cleared of any versions. And the Actor A had to interfere and put&#xA0; value in my DHT&#x2026;     Actor A puts a value keyed &#x2018;a&#x2019; with no previous versions. The DHT tag the key/value pair with the version 1 and move on with its life. Sometimes later Actor B comes along and decides to also put a value keyed by &#x2018;a&#x2019; with no previous version&#x2026;               The DHT noticed that it already have a key named &#x2018;a&#x2019; that isn&#x2019;t a direct ancestor of the new key, so it create a new version and store it. But what about the first version? Don&#x2019;t we have concurrency issue here?  Indeed we do. Let us see how the world looks like to Actor C, who just wanted to check on the value of &#x2018;a&#x2019;.     When Actor C asks for the value of &#x2018;a&#x2019;, it gets a surprise, it gets two versions of &#x2018;a&#x2019;. #1 and #2. It is now Actor C&#x2019;s responsibility to merge them somehow and send the updated version to the DHT.     Now, Actor C is saving key &#x2018;a&#x2019; with a set of previous versions (#1 and #2). When the DHT notice that we write a value that is covering all the existing values, it will remove the previous versions and keep the latest one.  Now, at this point Actor B wakes up and decides that it also wants to save something for &#x2018;a&#x2019;, and it tries to save base on the #2 version.  &#xA0;  At that point, we go to the same behavior, we now have no direct ancestry between the existing value and the new value. As such, we maintain both of them until a client is kind enough to merge them.    Hopefully, by now I was able to explain what I am doing and why the notion of versions is such an important concept.  Other interesting aspects of the project is the distribution part, here we follow the pretty common memcached mode, of isolated nodes that are brought together by the client library. That isn&#x2019;t really interesting, but it is worth mentioning.  Finally, persistence in this case is using Esent. Esent is the embedded DB that is embedded (fun intended) into Windows. That was my first real foray into implementing production level code with Esent. The code is very low level, but it is both fun to write and give you the sense of incredible power.</p>
        </article>
        <article id="article-6198">
            <a href="https://ayende.com/blog/3812/opinionated-api" target="_blank">
                <h2 class="title mb-6" id="article-6198">Opinionated API</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 16, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Recently I found myself doing a lot more API design that use the following method. A method that takes a delegate which accepts a parameter that allow you to perform the actual operations that are required.  This is very good for things like handling semantics, and since we only allow access to the desired operation through the parameter to the delegate, we can be pretty sure that we will have a consistent operation experience. Let us take the following example:                    1: table.Batch(actions =&gt;&#xA;&#xA;         2: {&#xA;&#xA;         3:     actions.Put(&quot;test&quot;, new int[0], new byte[] { 1 });&#xA;&#xA;         4:     actions.Put(&quot;test&quot;, new int[0], new byte[] { 2 });&#xA;&#xA;         5:     var values = actions.Get(&quot;test&quot;);&#xA;&#xA;         6:     Assert.Equal(2, values.Length);&#xA;&#xA;         7:&#xA0; &#xA;&#xA;         8:     Assert.Equal(1, values[0].Version);&#xA;&#xA;         9:     Assert.Equal(new byte[] { 1 }, values[0].Data);&#xA;&#xA;        10:&#xA0; &#xA;&#xA;        11:     Assert.Equal(2, values[1].Version);&#xA;&#xA;        12:     Assert.Equal(new byte[] { 2 }, values[1].Data);&#xA;&#xA;        13: });&#xA;    &#xA;  &#xA;&#xA;&#xA;As an aside, it is 3 AM now and I have been coding almost non stop since 9AM yesterday. I hate it when I have idea rush.</p>
        </article>
        <article id="article-6199">
            <a href="https://ayende.com/blog/3811/rhino-service-bus-saga-and-state" target="_blank">
                <h2 class="title mb-6" id="article-6199">Rhino Service Bus</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 16, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In a messaging system, a saga orchestrate a set of messages. The main benefit of using a saga is that it allows us to manage the interaction in a stateful manner (easy to think and reason about) while actually working in a distributed and asynchronous environment.  In Rhino Service Bus, I built the notion of sagas from the beginning. And I initially went with the approach that mix the saga&#x2019;s behavior and the saga state in the same class. That did not turn out so well. While it works for simple matters, anything of sufficient complexity started to bring issue. Mainly, it was an issue of managing dependencies and managing state. It is possible to get this worked out, but I decided to follow Udi&#x2019;s footsteps and create an explicit separation between the two.  Here is how it works, we have the state class:                    1: public class BaristaState&#xA;&#xA;         2: {&#xA;&#xA;         3:     public bool DrinkIsReady { get; set; }&#xA;&#xA;         4:&#xA0; &#xA;&#xA;         5:     public bool GotPayment { get; set; }&#xA;&#xA;         6:&#xA0; &#xA;&#xA;         7:     public string Drink { get; set; }&#xA;&#xA;         8: }&#xA;    &#xA;  &#xA;&#xA;&#xA;This is just a standard class, nothing special here. But here is the actual saga class. This contains the behavior for the saga, with the state being maintained in the state class.&#xA;&#xA;&#xA;  &#xA;    &#xA;         1: public class BaristaSaga :&#xA;&#xA;         2:     ISaga&lt;BaristaState&gt;,&#xA;&#xA;         3:     InitiatedBy&lt;PrepareDrink&gt;,&#xA;&#xA;         4:     Orchestrates&lt;PaymentComplete&gt;&#xA;&#xA;         5: {&#xA;&#xA;         6:     private readonly IServiceBus bus;&#xA;&#xA;         7:&#xA0; &#xA;&#xA;         8:     public BaristaState State { get; set; }&#xA;&#xA;         9:&#xA0; &#xA;&#xA;        10:     public Guid Id { get; set; }&#xA;&#xA;        11:&#xA0; &#xA;&#xA;        12:     public bool IsCompleted { get; set; }&#xA;&#xA;        13:&#xA0; &#xA;&#xA;        14:     public BaristaSaga(IServiceBus bus)&#xA;&#xA;        15:     {&#xA;&#xA;        16:         this.bus = bus;&#xA;&#xA;        17:         State = new BaristaState();&#xA;&#xA;        18:     }&#xA;&#xA;        19:&#xA0; &#xA;&#xA;        20:     public void Consume(PrepareDrink message)&#xA;&#xA;        21:     {&#xA;&#xA;        22:         State.Drink = message.DrinkName;&#xA;&#xA;        23:&#xA0; &#xA;&#xA;        24:         for (int i = 0; i &lt; 10; i&#x2B;&#x2B;)&#xA;&#xA;        25:         {&#xA;&#xA;        26:             Console.WriteLine(&quot;Barista: preparing drink: &quot; &#x2B; drink);&#xA;&#xA;        27:             Thread.Sleep(500);&#xA;&#xA;        28:         }&#xA;&#xA;        29:         State.DrinkIsReady = true;&#xA;&#xA;        30:         SubmitOrderIfDone();&#xA;&#xA;        31:     }&#xA;&#xA;        32:&#xA0; &#xA;&#xA;        33:     public void Consume(PaymentComplete message)&#xA;&#xA;        34:     {&#xA;&#xA;        35:         Console.WriteLine(&quot;Barista: got payment notification&quot;);&#xA;&#xA;        36:         State.GotPayment = true;&#xA;&#xA;        37:         SubmitOrderIfDone();&#xA;&#xA;        38:     }&#xA;&#xA;        39:&#xA0; &#xA;&#xA;        40:     private void SubmitOrderIfDone()&#xA;&#xA;        41:     {&#xA;&#xA;        42:         if (State.GotPayment &amp;&amp; State.DrinkIsReady)&#xA;&#xA;        43:         {&#xA;&#xA;        44:             Console.WriteLine(&quot;Barista: drink is ready&quot;);&#xA;&#xA;        45:             bus.Publish(new DrinkReady&#xA;&#xA;        46:             {&#xA;&#xA;        47:                 CorrelationId = Id,&#xA;&#xA;        48:                 Drink = State.Drink&#xA;&#xA;        49:             });&#xA;&#xA;        50:             IsCompleted = true;&#xA;&#xA;        51:         }&#xA;&#xA;        52:     }&#xA;&#xA;        53: }&#xA;    &#xA;  &#xA;&#xA;&#xA;There are a few things to notice in here. The saga class is a standard component, we use DI to inject dependencies to the class so it can perform whatever it is that it wants. The state property is used to maintain the state of the saga between message invocations.&#xA;&#xA;This results in a simpler design for some parts of the code, and I think that overall it is a very simple model to talk and reason about.</p>
        </article>
        <article id="article-6200">
            <a href="https://ayende.com/blog/3810/avoid-object-initializers-the-using-statement" target="_blank">
                <h2 class="title mb-6" id="article-6200">Avoid object initializers &amp; the using statement</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 15, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This piece of code has a huge bug in it. Can you see it?     I&#x2019;ll give you a hint, what is going to happen if Key, IV or Mode are going to throw an exception? Well, let us check the actual generated code from Reflector.     As you can see, we first set the value to a local variable, we set the properties and only then we enter the using clause. If any of the properties will throw out an exception, we will never enter the using block, and the object will never be disposed.  Personally, I think that this is an issue with the compiler, that it should be able to generate safe code for this scenario. As it is, the code looks fine, but the subtle bug can come and bite you.  Beware.</p>
        </article>
        <div class="button flex justify-between">
            <a href="619.html"><span class="back arrow"></span></a>

            <a href="621.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>