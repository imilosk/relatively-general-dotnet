
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 569 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-5681">
            <a href="https://ayende.com/blog/4315/building-a-recommendation-engine-in-nhibernate" target="_blank">
                <h2 class="title mb-6" id="article-5681">Building a recommendation engine in NHibernate</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 07, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Well, it isn&#x2019;t really a recommendation engine, it is a sample of one, and I strongly recommend not using it, but I am getting ahead of myself.  In the 6th episode of the TekPub&#x2019;s NHibernate webcast, me &amp; Rob worked on creating statistical queries with NHibernate. To be totally honest, the reason that we did that is to show off NHibernate&#x2019;s querying capabilities, not so you would be able to make use of this in your applications. A recommendation engine is not something that you should run out of your OLTP store, so please take that under advisement.  The reason for this post is to explain in details how the final result works. Here is the NHibernate code:  var orderIDsContainingCurrentSku = DetachedCriteria.For&lt;OrderItem&gt;()&#xA;            .Add&lt;OrderItem&gt;(x=&gt;x.Product.SKU==sku)&#xA;            .SetProjection(Projections.Property(&quot;Order.id&quot;));&#xA;&#xA;var skusOfProductsAppearingInOrdersContainingCurrentSku = DetachedCriteria.For&lt;OrderItem&gt;()&#xA;    .SetProjection(Projections.GroupProperty(&quot;Product.id&quot;))&#xA;    .AddOrder(NHibernate.Criterion.Order.Desc(Projections.Count(&quot;Order.id&quot;)))&#xA;    .Add&lt;OrderItem&gt;(x=&gt;x.Product.SKU!=sku)&#xA;    .Add(Subqueries.PropertyIn(&quot;Order.id&quot;, orderIDsContainingCurrentSku))&#xA;    .SetMaxResults(15);&#xA;&#xA;&#xA;var recommended = _session.CreateCriteria&lt;Product&gt;()&#xA;    .SetFetchMode&lt;Product&gt;(x =&gt; x.Descriptors, FetchMode.Join)&#xA;    .Add(Subqueries.PropertyIn(&quot;id&quot;, skusOfProductsAppearingInOrdersContainingCurrentSku))&#xA;    .SetResultTransformer(Transformers.DistinctRootEntity)&#xA;    .List&lt;Product&gt;();&#xA;&#xA;&#xA;And here is the resulting SQL:&#xA;&#xA;SELECT this_.SKU                 as SKU1_1_,&#xA;       this_.ProductName         as ProductN2_1_1_,&#xA;       this_.BasePrice           as BasePrice1_1_,&#xA;       this_.WeightInPounds      as WeightIn4_1_1_,&#xA;       this_.DateAvailable       as DateAvai5_1_1_,&#xA;       this_.EstimatedDelivery   as Estimate6_1_1_,&#xA;       this_.AllowBackOrder      as AllowBac7_1_1_,&#xA;       this_.IsTaxable           as IsTaxable1_1_,&#xA;       this_.DefaultImageFile    as DefaultI9_1_1_,&#xA;       this_.AmountOnHand        as AmountO10_1_1_,&#xA;       this_.AllowPreOrder       as AllowPr11_1_1_,&#xA;       this_.DeliveryMethodID    as Deliver12_1_1_,&#xA;       this_.InventoryStatusID   as Invento13_1_1_,&#xA;       descriptor2_.SKU          as SKU3_,&#xA;       descriptor2_.DescriptorID as Descript1_3_,&#xA;       descriptor2_.DescriptorID as Descript1_4_0_,&#xA;       descriptor2_.Title        as Title4_0_,&#xA;       descriptor2_.Body         as Body4_0_&#xA;FROM   Products this_&#xA;       left outer join ProductDescriptors descriptor2_&#xA;         on this_.SKU = descriptor2_.SKU&#xA;WHERE  this_.SKU in (SELECT   top 15 this_0_.SKU as y0_&#xA;                     FROM     OrderItems this_0_&#xA;                     WHERE    not (this_0_.SKU = &#x27;Binoculars2&#x27; /* @p0 */)&#xA;                              and this_0_.OrderID in (SELECT this_0_0_.OrderID as y0_&#xA;                                                      FROM   OrderItems this_0_0_&#xA;                                                      WHERE  this_0_0_.SKU = &#x27;Binoculars2&#x27; /* @p1 */)&#xA;                     GROUP BY this_0_.SKU&#xA;                     ORDER BY count(this_0_.OrderID) desc)&#xA;&#xA;&#xA0;&#xA;&#xA;The problem is that both the NHibernate code and the SQL are pretty complicated, and mapping between the two might be pretty hard if you are not familiar with that. So let us take this in stages. First, let us understand the logic in the SQL itself. Most of the complexity happens in the where clause, so let us look at this in depth:&#xA;&#xA;WHERE  this_.SKU in (SELECT   top 15 this_0_.SKU as y0_&#xA; FROM     OrderItems this_0_&#xA; WHERE    not (this_0_.SKU = &#x27;Binoculars2&#x27; /* @p0 */)&#xA;          and this_0_.OrderID in (SELECT this_0_0_.OrderID as y0_&#xA;                  FROM   OrderItems this_0_0_&#xA;                  WHERE  this_0_0_.SKU = &#x27;Binoculars2&#x27; /* @p1 */)&#xA; GROUP BY this_0_.SKU&#xA; ORDER BY count(this_0_.OrderID) desc)&#xA;&#xA;&#xA;What exactly is going on in here?&#xA;&#xA;Let us look at the nested most select, this select the OrderId from an order that have a Binoculars item in it. That is then passed to the parent select, matching it to that OrderID and returning the SKU if it is not also a Binoculars.&#xA;&#xA;What we are actually saying here is: Give me all the items from orders that contains Binoculars, except for Binoculars. The logic is simple, you are very likely to buy something that someone else also bought in an order together with stuff that you bought (complimentary products, another book in the same series, etc). Next, we have the order by, we use that to find the stuff that you are most likely to buy. By ordering the items based on the number of orders they appear in, we try to find the most popular items (hence, the stuff that you are likely to buy as well).&#xA;&#xA;I think that this is fairly clear, and now that we have the logic of the statement, let us try to understand how that NHibernate code produced it. &#xA;&#xA;The answer is actually very simple, NHibernate&#x2019;s Criteria API is all about composability. We simply composed the query from all the tiny pieces. Let us look at each individual piece in detail:&#xA;&#xA;var orderIDsContainingCurrentSku = DetachedCriteria.For&lt;OrderItem&gt;()&#xA;            .Add&lt;OrderItem&gt;(x=&gt;x.Product.SKU==sku)&#xA;            .SetProjection(Projections.Property(&quot;Order.id&quot;));&#xA;&#xA;&#xA;This query is using DetachedCriteria, this is a way to generate a query (or a sub query, as we will soon see), without having a direct reference to the session. This is mostly useful in cases like this, where you want to compose several queries into a single one. &#xA;&#xA; In this case, it is pretty obvious what is going on, we ask NHibernate to select from OrderItems (by using the OrderItem entity), where the product sku is equal to the appropriate SKU (Binoculars2, in this case), and we don&#x2019;t want to get the entity back, instead, we want only a single field (this is what SetProjection is for), the order id. Note that OrderItem mapping is quite interesting:&#xA;&#xA;&lt;class name=&quot;OrderItem&quot; table=&quot;OrderItems&quot; &gt;&#xA;  &lt;composite-id&gt;&#xA;      &lt;key-many-to-one name=&quot;Product&quot; column=&quot;SKU&quot;/&gt;&#xA;      &lt;key-many-to-one name=&quot;Order&quot; column=&quot;OrderID&quot;/&gt;&#xA;  &lt;/composite-id&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&#xA;It is a class with a composite id, where each part of the PK is also a FK to a different table. With NHibernate, we map this using &lt;key-many-to-one/&gt; in a composite-id element.&#xA;&#xA;When we want to query on that, we can either use the usual many-to-one approach, or, if we want to refer to a particular column, we use the &#x201C;id&#x201D; (all lower case) keyword. In other words, &#x201C;Order.id&#x201D; refers to the OrderItems.OrderID column, while &#x201C;Product.id&#x201D; or &#x201C;Product.SKU&#x201D; refers to the &#x201C;OrderItems.SKU&#x201D; column. I think that you can figure out what is going on now, this query generate the following SQL:&#xA;&#xA;SELECT this_0_0_.OrderID as y0_&#xA;FROM   OrderItems this_0_0_&#xA;WHERE  this_0_0_.SKU = &#x27;Binoculars2&#x27; /* @p1 */&#xA;&#xA;&#xA;And I think that can see the direct correlation between the NHibernate query and the generated SQL.&#xA;&#xA;Next in line, and seemingly much more complicated, we have this:&#xA;&#xA;var skusOfProductsAppearingInOrdersContainingCurrentSku = DetachedCriteria.For&lt;OrderItem&gt;()&#xA;    .SetProjection(Projections.GroupProperty(&quot;Product.id&quot;))&#xA;    .AddOrder(NHibernate.Criterion.Order.Desc(Projections.Count(&quot;Order.id&quot;)))&#xA;    .Add&lt;OrderItem&gt;(x=&gt;x.Product.SKU!=sku)&#xA;    .Add(Subqueries.PropertyIn(&quot;Order.id&quot;, orderIDsContainingCurrentSku))&#xA;    .SetMaxResults(15);&#xA;&#xA;&#xA;But it isn&#x2019;t really complidated, let us look at this in details. The first line is already familiar for us, asking to select from OrderItems. Next, we use SetProjection again, to select just the &#x201C;Product.id&#x201D;, which is the OrderItems.SKU. Note that we are using something slightly different this time, where before we used Projections.Property, now we use Projections.GroupProperty. What is the difference between the two?&#xA;&#xA;Projection.Property instructs NHibernate to put the matching column in the select clause, while Projection.GroupProperty instructs NHibernate to put the matching column in the select clause and in the group by clause. This is required because on the next line, we are using an aggregate function in the order by clause, aggregate functions must be used in conjunction with the appropriate group by clause. That line also specify that we are using a descending order on the count of the &#x201C;Order.id&#x201D; (which matches OrderItems.OrderID).&#xA;&#xA;The following line is something we are already familiar with, we are adding a where clause to filter the current SKU. And now we get to the interesting part, we use a subquery to match the &#x201C;Order.id&#x201D; to the order ids containing the current SKU. Last, but not least, we limit the number of returned rows to 15. The resulting SQL is:&#xA;&#xA;SELECT   top 15 this_0_.SKU as y0_&#xA;FROM     OrderItems this_0_&#xA;WHERE    not (this_0_.SKU = &#x27;Binoculars2&#x27; /* @p0 */)&#xA;      and this_0_.OrderID in (/* orderIDsContainingCurrentSku */)&#xA;GROUP BY this_0_.SKU&#xA;ORDER BY count(this_0_.OrderID) desc&#xA;&#xA;&#xA;I think that again, once we have gone over this in details, you will agree that there is a pretty simple mapping between the query and the resulting SQL.&#xA;&#xA;Now, let us look at the actual query code, which make use of the previous two subqueries:&#xA;&#xA;var recommended = _session.CreateCriteria&lt;Product&gt;()&#xA;    .SetFetchMode&lt;Product&gt;(x =&gt; x.Descriptors, FetchMode.Join)&#xA;    .Add(Subqueries.PropertyIn(&quot;id&quot;, skusOfProductsAppearingInOrdersContainingCurrentSku))&#xA;    .SetResultTransformer(Transformers.DistinctRootEntity)&#xA;    .List&lt;Product&gt;();&#xA;&#xA;&#xA;We create a standard criteria query, ask it to eager load the Descriptors, then we perform a subquery, matching the product &#x201C;id&#x201D; (when specified using all lower case it is an NHibernate keyword referencing the current entity&#x2019;s PK column) to the skus of products that appear in orders contains the current sku. Because we used a join to eager load the descriptors, we need to specify SetResultTransofer so we will get only distinct root entities.&#xA;&#xA;All in all, when you break it up to pieces like that, I don&#x2019;t think that it is an overly complex process. The query we were trying to get to is by no means a simple one, but we didn&#x2019;t have any additional complexity when trying to create it using NHibernate.</p>
        </article>
        <article id="article-5682">
            <a href="https://ayende.com/blog/4314/resharper-is-amazing-take-n" target="_blank">
                <h2 class="title mb-6" id="article-5682">Resharper is amazing, take N</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 06, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am trying out R# 5.0, and I accidently stumbled upon an awesome feature.   Let us say that you Ctrl&#x2B;Click the int.ToString() method:     In previous versions of R#, that would take you to the Object Explorer, which is useful enough, but R# does something far more awesome.  I didn&#x2019;t realize at first what was going on, first it popped up this thingie:     And then it asked me to accept a license:     But then it actually showed me the real code that is behind int.ToString(). This is not Reflector trick, this is the real source code that made it into the framework:         Now, this is basically just integrating Symbol Server &amp; Source Server, both of which have been available for a while now, but making this so easy is something that is huge!</p>
        </article>
        <article id="article-5683">
            <a href="https://ayende.com/blog/4313/nhibernate-is-on-the-cover-of-msdn-magazine" target="_blank">
                <h2 class="title mb-6" id="article-5683">NHibernate is on the cover of MSDN Magazine</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 05, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A while ago I run a poll about what posts you would like me to do, and the most requested topic was handling NHibernate in a Desktop application. I started writing a blog post about it, but when it hit twenty pages, I thought better on that and decided that I might as well post that as an article. MSDN Magazine just did.  You can read the about Building a Desktop To-Do Application with NHibernate in the latest issue of MSDN Magazine.  And now that the article is out, I can start posting about other topic in the code base that are pretty interesting as well.</p>
        </article>
        <article id="article-5684">
            <a href="https://ayende.com/blog/4312/reading-frenzy" target="_blank">
                <h2 class="title mb-6" id="article-5684">Reading Frenzy</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 04, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I don&#x2019;t usually read non fiction books, I read some tech books, but that is work, more than anything else. I do read a lot, and I thought that I might post what I like, in hope to get recommendations for more stuff.   The following list is mixed between authors &amp; characters, depending on what I find more memorable. I only included authors / books that I read in the last 6 months or so.     Robert Jordan    Kris Longknife    Miles Vorkosigan    Jim C. Hines     David Weber          Honorverse       Safehold      Dahak       John Moore    Rachel Caine         Weather Warden      Outcast       Southern Vampire &#x2013; Charlaine Harris    The Lost Fleet &#x2013; Jack Campbell    Terry Prachett &#x2013; the entire Discworld series    Ilona Andrews         On the Edge      Kate Daniels       Votta War   Those aren&#x2019;t all of them, but that should be enough for now. Those are all that pop into mind as good reads.</p>
        </article>
        <article id="article-5685">
            <a href="https://ayende.com/blog/4311/uberprof-and-continuous-integration" target="_blank">
                <h2 class="title mb-6" id="article-5685">&#xDC;berProf and Continuous Integration</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 03, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the features that keep popping up for &#xDC;berProf is that people want to use that in CI scenarios, usually to be able to programmatically check that they don&#x2019;t have things like SELECT N&#x2B;1 popping up, etc.  With build 562 of &#xDC;berProf, this is now possible. How does this works? We now have a command line interface for &#xDC;berProf, with the following options:     /CmdLineMode[&#x2B;|-]         (short form /C)/File:&lt;string&gt;            (short form /F)/ReportFormat:{Xml|Html}  (short form /R)/Port:&lt;int&gt;               (short form /P)/Shutdown[&#x2B;|-]            (short form /S)&#xA;&#xA;  &#xA;&#xA;Starting up with no options will result in the usual UI showing up, but you have a new mode available for you. Let us say that you want to output the results of your integration tests into a format that you can easily work with programmatically. Here is how it can be done:&#xA;&#xA;&#xA;  nhprof.exe /CmdLineMode /File:Output.xml /ReportFormat:Xml &lt;-- starts listening to applicationsxunit.console.exe Northwind.IntegrationTests.dllnhprof.exe /Shutdown &lt;-- stop listening to applications and output the report&#xA;&#xA;  &#xA;&#xA;The example is using NH Prof, but the same holds for all the other variants.&#xA;&#xA;The way it works is very simple and should be pretty easy to integrate into your CI process. The XML output can give you programmatic access to the report, while the HTML version is human readable.&#xA;&#xA;One thing that you might want to be aware of, writing the report file is done in an async manner, so the shutdown command may return before writing the file is done. If you need to process the file as part of your build process, you need to wait until the first profiler instance is completed. Using PowerShell, this is done like this:&#xA;&#xA;&#xA;  nhprof.exe /CmdLineMode /File:Output.xml /ReportFormat:Xmlxunit.console.exe Northwind.IntegrationTests.dllnhprof.exe /Shutdownget-Process nhprof | where {$_.WaitForExit() } &lt;-- wait until the report export is completed&#xA;&#xA;  &#xA;&#xA;Please note that from a licensing perspective, the CI mode is the same as the normal GUI mode. On one hand, it means that you don&#x2019;t need to do anything if you have the profiler already. On the other, if you want to run it on a CI machine, you would need an additional license for that.</p>
        </article>
        <article id="article-5686">
            <a href="https://ayende.com/blog/4310/handling-production-errors-in-a-messaging-environment" target="_blank">
                <h2 class="title mb-6" id="article-5686">Handling production errors in a messaging environment</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 02, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">So, today I got the first L2S Prof order. As you can imagine, I was pretty excited about that. However, it turned out that I had actually missed something when I built the backend for handling L2S Prof ordering. The details about what actually went wrong aren&#x2019;t important (and are embarrassing).  But I logged into the server and checked out what was going on:     One of the major design criteria that I had with Rhino Service Bus is that it should be dead easy to handle production. As you can see in the screen shots, I have two messages of interest here, the first one is the actual message, and the second is the error information, which include the full stack trace. Using that, it was a piece of cake to isolate the problem, do the head slapping moment, and deploy a new version out. Once that was done, all I had to do is to move the message back to the processing queue, and I was done.  Just to give you an idea, here is how it looks like on my timeline:     I guarantee you that the customer in question didn&#x2019;t have any idea that there was something wrong with his order processing.  I am loving it.</p>
        </article>
        <article id="article-5687">
            <a href="https://ayende.com/blog/4309/what-should-i-talk-about-at-qcon-london" target="_blank">
                <h2 class="title mb-6" id="article-5687">What should I talk about at QCon London?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 02, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I might be speaking at QCon London, but I am not sure what about.   The requirements are:     This track intends to showcase some of the practitioners, tools and technologies to provide an awareness of something other than the Microsoft mantra for software development on .NET    Each talk should show at least one thing that is new or unusual for the masses on .NET to know or use and compare it to the status quo. It should provide some in depth examples or code around that comparison. In the cases where the speaker is the author of an OSS product also give a broader rationale and explanation of the tool and when it is best used.   My main issue is that there are too many topics to talk about, and I thought that I might put it on the blog and see what people are interested in.</p>
        </article>
        <article id="article-5688">
            <a href="https://ayende.com/blog/4308/nhprof-com-downtime-and-using-windows-as-a-server-system" target="_blank">
                <h2 class="title mb-6" id="article-5688">NHProf.com downtime, and using windows as a server system</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 30, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Yesterday nhprof.com was down, there was a YSOD and when I logged into the server to try to figure out what the problem was, I got this:     The server has been running with no issues for over a year, so it is not an issue with not activating after installation. This is a Windows 2008 Server, and I find it incovievable that a server would go down because of activation. To spread more salt on the wound, it wasn&#x2019;t a problem that could be fixed remotely, I had to call my host and ask them to fix that (they did in a remarkably short time).  Annoying!</p>
        </article>
        <article id="article-5689">
            <a href="https://ayende.com/blog/4307/can-you-hack-this-out-hint-1" target="_blank">
                <h2 class="title mb-6" id="article-5689">Can you hack this out? Hint #1</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 25, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Here is another challenge, smaller, this time, which can lead you the right path.&#xA0; And yes, it is a screwy one.  All you have to do is make the following assertion fail.     public class Program{    private static void Main(string[] args)    {        CanThisHappen&lt;MyFunnyType&gt;();       }    public static void CanThisHappen&lt;T&gt;() where T : class, new()    {        var instnace = new T();        Debug.Assert(instnace != null,&quot;How did we break the CLR?&quot;);    }}&#xA;&#xA;  &#xA;&#xA;&#xA;&#xA;The rules are simple, you are not allowed to do anything outside the current process. That means that profiling API, post compilation assembly rewrite, etc are forbidden. Anything else is a fair game. &#xA;&#xA;I will let you know that I can make the assertion fail in 4 lines of code :-)</p>
        </article>
        <article id="article-5690">
            <a href="https://ayende.com/blog/4306/advertisement-appreciation-day" target="_blank">
                <h2 class="title mb-6" id="article-5690">Advertisement appreciation day</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: November 24, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am trying to get some advertising to get people into Hibernate Profiler. And since I am doing most of the profiler work on the open, I thought I might as well put out the advertising as well.       Thanks so much for everyone who helped me out on twitter, but especially to Mark Nijhof, Glenn F. Henriksen and Ian Battersby.  Thoughts?</p>
        </article>
        <div class="button flex justify-between">
            <a href="568.html"><span class="back arrow"></span></a>

            <a href="570.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;🚀&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
