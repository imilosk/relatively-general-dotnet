
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Home â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<script>
    const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

    function getUserPref() {
        const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
        return storedTheme || (lightModePref.matches ? "light" : "dark");
    }

    function setTheme(newTheme) {
        if (newTheme !== "light" && newTheme !== "dark") {
            return console.warn(
                `Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
            );
        }

        const root = document.documentElement;

        // root already set to newTheme, exit early
        if (newTheme === root.getAttribute("data-theme")) {
            return;
        }

        root.setAttribute("data-theme", newTheme);

        const colorThemeMetaTag = document.querySelector("meta[name='theme-color']");
        const bgColour = getComputedStyle(document.body).getPropertyValue("--theme-bg");
        colorThemeMetaTag.setAttribute("content", `hsl(${bgColour})`);
        if (typeof localStorage !== "undefined") {
            localStorage.setItem("theme", newTheme);
        }
    }

    // initial setup
    setTheme(getUserPref());

    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("theme-toggle").addEventListener("click", () => {
            const theme = localStorage.getItem("theme");

            if (theme === "dark") {
                setTheme("light");
            } else {
                setTheme("dark");
            }
        });

        document.getElementById("toggle-navigation-menu").addEventListener("click", (e) => {
            const button = e.target;
            const ariaExpanded = button.getAttribute("aria-expanded");
            const header = document.getElementById("main-header");

            if (ariaExpanded === "true") {
                button.setAttribute("aria-expanded", "false");
                header.classList.remove("menu-open");
            } else {
                button.setAttribute("aria-expanded", "true");
                header.classList.add("menu-open");
            }
        });
    });
</script>

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <theme-toggle class="ms-auto">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main">
    <section aria-label="Blog post list">
        <a href="https://ardalis.com/walking-while-working/" target="_blank"><h1 class="title mb-6">Walking While Working</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 12, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">DSC_0031 - Cropped Staying in shape as a programmer can be difficult, but recent studies have shown that even if you&#x27;re among those in our&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ayende.com/blog/165571/time-series-feature-design-storage" target="_blank"><h1 class="title mb-6">Time series feature design</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 12, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In this post, we are going to talk about the actual design for a time series feature, from a storage perspective. For the purpose of the discussion, I am going to assume the low level Voron as the underlying storage engine. We are going to need to store the data in a series. And the actual data is going to be relatively ordered (time based, usually increasing). As such, I am going to model the data itself as a set of Voron trees, one tree per each series that is created. The actual data in each tree would be composed of key and value, that are each 8 bytes long.  Key (8 bytes): 100-nanosecond interval between Jan 1, 0001 to Dec 31, 9999. Val (8 bytes): 64 bits double precision floating point number. There can be do duplicate values for a specific time in a series. Since this represent one ten millionth of a second, that should be granular enough, I think. Reading from the storage will always be done on a series basis. The idea is to essentially use the code from this post, but to simplify to a smaller key.&#xA0; The idea is that we can store roughly 250 data points in each Voron page. Which should give us some really good performance for both reads &amp; writes. Note that we need to provide storage API to do bulk writes, since there are some systems that would require it. Those can either be systems with high refresh rates (a whole set of sensors with very low refresh rates) or, more likely, import scenarios. The import scenario can be either a one time (moving to a new system), or something like a nightly batch process where we get the aggregated data from multiple sources.  For our purposes, we aren&#x2019;t going to distinguish between the two. We are going to provide and API similar to:   void Add(IEnumerable&lt;Tuple&lt;string,IEnumerable&lt;Tuple&lt;DateTime, double&gt;&gt;&gt; data);&#xA;&#xA;&#xA;This ugly method can handle updates to multiple series at once. In human speak, this is an enumerable of updates to a series where each update is the time and value for that time. From the storage perspective, this creates a single transaction where all the changes are added at once, or not at all. It is the responsibility of higher level code to make sure that we optimize number of calls vs. in flight transaction data vs. size of transactions.&#xA;Adding data to a series that doesn&#x2019;t exists will create it.&#xA;We also assume that series names is up to printable Unicode characters of up to 256 bytes (UTF8).&#xA;The read API is going to be composed of:&#xA;&#xA;IEnumerable&lt;Tuple&lt;DateTime, double&gt;&gt; ScanRange(string series, DateTime start, DateTime end);&#xA;IEnumerable&lt;Tuple&lt;DateTime, double[]&gt;&gt; ScanRanges(string []series, DateTime start, DateTime end);&#xA;Anything else would have to be done at a higher level.&#xA;There is no facility for updates. You can just add again on the same time with a new value, and while this is supported, this isn&#x2019;t something that is expected.&#xA;Deleting data can be done using:&#xA;&#xA;void Delete(string series, DateTime start, DateTime end);&#xA;void DeleteAll(string series);&#xA;The first option will delete all the items in range. The second will delete the entire tree. The second is probably going to be much faster. We are probably better off checking to see if the max / min ranges for the tree are beyond the items for this series and falling to DeleteAll if we can. Explicit DeleteAll will also delete all the series tags. While implicit Delete(&#x201C;series-1&#x201D;, DateTime.MinValue, DateTime.MaxValue) for example will delete the series&#x2019; tree, but keep the series tags.&#xA;Series can have tags attached to it. Those can be any string up to 256 bytes (UTF8). By conventions, they would usually be in the form of &#x201C;key:val&#x201D;.&#xA;Series can be queried using:&#xA;&#xA;IEnumerable&lt;string&gt; GetSeries(string start = null);&#xA;IEnumerable&lt;string&gt; GetSeriesBy(string tag, string start = null);&#xA;IEnumerable&lt;string&gt; GetSeriesTags(string  series);&#xA;Series can be tagged using:&#xA;&#xA;void TagSeries(string series, string []tags);&#xA;There can be no duplicate tags.&#xA;In summary, the interface we intend to use for storage would look roughly like the following:&#xA;public interface ITimeSeriesStorage&#xA;{&#xA;    void Add(IEnumerable&lt;Tuple&lt;string,IEnumerable&lt;Tuple&lt;DateTime, double&gt;&gt;&gt; data);&#xA;    IEnumerable&lt;Tuple&lt;DateTime, double&gt;&gt; ScanRange(string series, DateTime start, DateTime end);&#xA;    IEnumerable&lt;Tuple&lt;DateTime, double[]&gt;&gt; ScanRanges(string []series, DateTime start, DateTime end);&#xA;    void Delete(string series, DateTime start, DateTime end);&#xA;    void DeleteAll(string series);&#xA;    IEnumerable&lt;string&gt; GetSeries(string start = null);&#xA;    IEnumerable&lt;string&gt; GetSeriesBy(string tag, string start = null);&#xA;    IEnumerable&lt;string&gt; GetSeriesTags(string series);&#xA;    void TagSeries(string series, string []tags);&#xA;}&#xA;Data sizes &#x2013; assume 1 value per minute per series, that gives us an update rate of 1,440 updates per day or 525,600 per year. That means that for 100,000 sensors (not an uncommon amount) we need to deal with 52,560,000,000 data items per year. This would probably end up being just over 3 GB or so. Assuming 1 value per second, that gives us 86,400 values per day, 31,536,000 per year and 3,153,600,000,000 values per year for the 100,000 sensors will user about 184 GB or so. Those seems to be eminently reasonable values for the data size that we are talking about here.&#xA0; &#xA;Next, we&#x2019;ll discuss how this is all going to look like over the wire&#x2026;</p>
        <a href="https://ayende.com/blog/165570/time-series-feature-design" target="_blank"><h1 class="title mb-6">Time series feature design</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 11, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I mentioned before that there is actually quite a lot that goes into a major feature, usually a lot more than would seem on the surface. I thought that this could serve as a pretty good example of a series of blog posts that we can use to show how we are actually sitting down and doing high level design of features in RavenDB. I&#x2019;ve actually already spoken, and we have seen an implementation of the backend, about time series data. But that was just the basic storage, and that was mostly to explore how to deal with Voron for more scenarios, to be honest. Now, allow me to expand that into a full pledged feature design. What we want: the ability to store time series data and work with it. Time series data is a value (double) that is recorded at a specific time for a specific series. A good explanation on that can be found here: https://tempo-db.com/docs/modeling-time-series-data/ We have a bunch of sensors that report data, and we want to store it, and get it back, and get rollups of the information, and probably do more, but that is enough for now. At first glance, we need to support the following operations:  Add data (time, value) to a series. Add bulk data to a set of series. Read data (time,value) from a series or a set of them in a given range. Read rollup (avg, mean, max, min) per period (minutes, hour, day, month) in a given range for a set of series. In the next few posts, I&#x2019;ll discuss storage, network, client api, user interface and distribution design for this. I would truly love to hear from you about any ideas you have.</p>
        <a href="https://ayende.com/blog/165569/death-by-70-000-facets" target="_blank"><h1 class="title mb-6">Death by 70,000 facets</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 10, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Just sit right back and you&#x27;ll hear a tale, a tale of a fateful bug. That started from a simple request, about a feature that was just a bit too snug. Okay, leaving aside my attempts at humor. This story is about a customer reporting an issue. &#x201C;Most of the time we have RavenDB running really fast, but sometimes we have high latency requests&#x201D;. After a while, we managed to narrow it down to the following scenario:  We have multiple concurrent requests. Those requests contains a Lazy request that has a facet query. The concurrent requests appears to all halt and then complete together. In other words, it looks like we had all those requests waiting on a lock, then when it is released, all of them are free to return. This makes sense, there is a cache lock in the facet code that should behave in this manner. But when we looked at that, we could see that this didn&#x2019;t really behave in the way we expected it to.  Eventually we got to test this out on the client data, and that is when we were able to pin point the issue. Usually, you have facets like this: The one of the left is when searching Amazon for HD, the one on the right is when you search Amazon for TV.   In RavenDB, you typically express this sort of query using:  session.Query&lt;Product&gt;().Search(&#x201C;Search&#x201D;, query).ToFacets(new Facet { Name = &#x201C;Brand&#x201D;} ); And we expect the number of facets that you have in a query to be in the order of a few dozens.  However, the client in question has done something a bit different. I think that this is because they brought the system over from a relational database. Each product in the system had a list of facets associated with it. It looked something like:  &#x201C;Facets&#x201D;: [13124,87324,32812,65743] Obvious, this means that this product belongs to the &#x201C;2,000 &#x2013; 3,500&#x201D; price range facet (electronics) the &#x201C;Red&#x201D; color facet (electronics, handheld) etc&#x2026; In total, we had over 70,000 facets in the database, and that is just something that we never really expected. Because we didn&#x2019;t expect it, we reacted&#x2026; poorly when we had to deal with it. In fact, what happened was that pattern of behavior meant that we effectively had worse than not having a cache, we would always have to do the work, and never really gain any benefit from it (there wasn&#x2019;t enough sharing to actually trigger the benefits of the cache). And because we did locks on the cache to ensure that we don&#x2019;t get into a giant mess&#x2026; Well, you can figure out how it went from there. The fix was to actually devolve the code in to a simpler method. Instead of trying to be smart and just figure out what we needed to compute for this query, we can be aggressive and load everything we needed. All the next requests will result in no wait time, because the data is already there. The code became much simpler.  Oh, and we got it deployed to production and saw a 400% decrease in the average request time, and no more sudden waits when we had requests piling up.</p>
        <a href="https://ayende.com/blog/165537/didja-know-ravendb-include-a-proxy-server" target="_blank"><h1 class="title mb-6">Didja know, RavenDB include a proxy server</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 07, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is one of those things that I had to read several times to realize what was actually going on. The code for that is here: https://github.com/ayende/ravendb/blob/c0c9ccf98011fb64b5eb5406a900ec1338ea78e4/Raven.Tests/Issues/RavenDB_1603.cs#L32 And it appears that along with every else, RavenDB also include a proxy server. Now, to be fair, this is required for our tests, to see what happens when we have a forced disconnect / timeout at the network level, so it make sense. And the whole thing is under 100 lines of code. This sort of thing explains why we really need to do a whole bunch of work on our tests. We want to get to a 500 &#x2013; 1000 tests (currently we have close to 3,200) that run in under 5 minutes.</p>
        <a href="https://ayende.com/blog/165506/all-the-pieces-of-a-feature" target="_blank"><h1 class="title mb-6">All the pieces of a feature</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 06, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the interesting* tidbits I learned is that just having an idea about a feature is far from being able to actually do something with it.&#xA0; Hell, even implementing the feature is just the first step in a very long road. * Read: annoying instead of interesting. Here are the things that you need to do just in order to actually call a feature Ready To Show (vs. Done **):  Implement backend.  Expose over the wire.  Write client API.  Create user interface. Distribution (replication/sharding) Those things are just what you need so you can actually show something meaningful, rather than a bunch of code and a lot of hand waving. This can be pretty annoying at times, mostly because it puts a lot of work that has to be done before we can actually show it to people. ** And just because people will ask, to get to done you need:  Logging  Monitoring  The ability to test easily  Performance trials  Longevity trails  Production proofing I&#x2019;m probably forgetting a bunch of stuff, but those are what pops to mind. The nice thing about getting to show something is that we can usually parallelize the work for the all of those by handing this to different people.</p>
        <a href="https://ayende.com/blog/165345/reviewing-metrics-net-project" target="_blank"><h1 class="title mb-6">Reviewing Metrics .NET project</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 05, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is a review of the Metrics.NET project (commit cb52da325c0a88336e09412638f72620d9ba7992). The project is supposed to give us a way to track metrics about our applications, and we want to make use of it in RavenDB instead of the highly unreliable performance counters. This is going to be a pretty short review, mostly because I don&#x2019;t really have much to say.&#xA0; There are a few things that I take issues with (async tasks using Thread.Sleep instead of Task.Delay, but that is probably because it is targeting .NET 4.5). Other than that, most of the code is actually doing crazy math stuff, and there are proper links to the explanations, and you can see why it is doing so. The impressive thing is that pretty much everything that I wanted to do was already there. Including an easy way to expose metrics over the wire, and that the whole things seems pretty seamless.  Very good work, all around. For our purposes, however, I think we&#x2019;ll need to do some other things. In particular, one of the major assumptions throughout the code is that there is always a type associated with a metric, which isn&#x2019;t the case for our purposes.&#xA0; More than that, the code now assumes a static and fixed set of metrics for the entire system. That doesn&#x2019;t work very well for us when we have different metrics for each database, so we&#x2019;ll probably need to change that as well. But I am very impressed, this looks like it could sort out a lot of the things that we need to do very quickly.</p>
        <a href="https://benfoster.io/blog/saaskit-multi-tenancy-made-easy/" target="_blank"><h1 class="title mb-6">Introducing SaasKit - Multi-tenancy made easy</h1></a>
        <p class="mb-2">by Ben Foster</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 05, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This post introduces SaasKit, a new project I&#x2019;m working on to help developers build SAAS based applications, covering common challenges such as Multi-tenancy.</p>
        <a href="https://ayende.com/blog/165249/self-flagellation-and-the-barbarians-are-at-the-gate" target="_blank"><h1 class="title mb-6">Self flagellation and the barbarians are at the gate</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 04, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">We got a report from a user about severe issues with RavenDB. It reports resource exhaustion with plenty of resources still available, and once that happens, it will refuse to even restart itself, forcing a process kill. As you can imagine, that was a pretty big deal for us, so we set out to investigate. And we found some interesting results. One of the things that we like to keep in mind with RavenDB is that it is a safe choice. Whenever we need to make a decision between various tradeoffs, we&#x2019;ll always chose the safe choice. That means, among other things, that we are pretty careful about the way that we approach external input. And in this case, we are actively protecting ourselves from the outside world. One of the ways we do that is by limiting the number of requests that we will concurrently process. The idea is that it is better to flat out reject requests than put such a load on the system that it will eventually crash. Indeed, that has been such a successful tactic that to this day, there has been exactly zero production issues with it. To my knowledge, it hasn&#x2019;t ever been even noticed by any of our users.  The actual issue is that we have an internal limit that is set by default to 256 concurrent transactions. And by default, we will accept up to 192 concurrent requests. Then I looked at the actual logs, and I found:  And that explains much, but not nearly all. We had this in our code base for roughly 8 months. There are still other things that protect us from those issues, not the least of which is that it is actually hard to generate that number of requests against us (you really have to try very hard, usually from multiple machines). But there was one scenario that we didn&#x2019;t consider for the purpose of protecting ourselves from the barbarians at the gate. Multi Get requests.  Multi Get requests allows you to package multiple requests to RavenDB into a single physical request. Those requests are going to cost you a single round trip to the server, and you can run as many of those as you want. In the dump we received, we could see 17 pending Multi Get request, and about 400 queries being executed, each of them requiring their own session. No wonder we got out of session errors. Final note: for what it is worth, I changed our limits to 1,024 concurrent sessions and 512 concurrent requests, which is more reasonable considering the kind of hardware we usually run on. Multi Get has another 192 sessions that it can utilize, and the rest are dedicated for background processes.</p>
        <a href="https://ayende.com/blog/165409/voron-time-series-data-getting-real-data-outputs" target="_blank"><h1 class="title mb-6">Voron &amp; time series data: Getting real data outputs</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: February 03, 2014
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">So far, we have just put the data in and out. And we have had a pretty good track record doing so. However, what do we do with the data now that we have it? As you can expect, we need to read it out. Usually by specific date ranges. The interesting thing is that we usually are not interested in just a single channel, we care about multiple channels. And for fun, those channel might be synchronized or not. An example of the first might be the current speed and the current engine temperature in a car. They are generally share the exact same timestamps. An example of out of sync is when you have a sensor on a rooftop measuring rainfall, and another sensor in the sewer measuring water flow rates. (Again, thanks to Dan for helping me with the domain). This is interesting, because it present quite a few interesting problems:  We need to merge different streams into a unified view. We need to handle both matching and non matching sequences. We need to handle erroneous data, what happens when we have two reading for the same time for the same sensor? Yes, that shouldn&#x2019;t happen, but it does. I solved this with the following API: public class RangeEntry&#xA;{&#xA;    public DateTime Timestamp;&#xA;    public double?[] Values;&#xA;}IEnumerable&lt;RangeEntry&gt; results = dts.ScanRanges(DateTime.MinValue, DateTime.MaxValue, new[]&#xA;                {&#xA;                    &quot;6febe146-e893-4f64-89f8-527f2dbaae9b&quot;,&#xA;                    &quot;707dcb42-c551-4f1a-9203-e4b0852516cf&quot;,&#xA;                    &quot;74d5bee8-9a7b-4d4e-bd85-5f92dfc22edb&quot;,&#xA;                    &quot;7ae29feb-6178-4930-bc38-a90adf99cfd3&quot;,&#xA;                });&#xA;&#xA;&#xA;This API gives me the results in the time order, with the same positions as the ids requested for the values. With nulls if there isn&#x2019;t a value matching the value from that time in that particular sensor channel.&#xA;The actual implementation relies on this method:&#xA;IEnumerable&lt;Entry&gt; ScanRange(DateTime start, DateTime end, string id)&#xA;&#xA;&#xA;All this does it provide the entries all the entries in a particular date range, for a particular channel. Let us see how we implement multi channel scanning on top of this:&#xA;private class PendingEnumerator&#xA;{&#xA;    public IEnumerator&lt;Entry&gt; Enumerator;&#xA;    public int Index;&#xA;}&#xA;&#xA;private class PendingEnumerators&#xA;{&#xA;    private readonly SortedDictionary&lt;DateTime, List&lt;PendingEnumerator&gt;&gt; _values =&#xA;        new SortedDictionary&lt;DateTime, List&lt;PendingEnumerator&gt;&gt;();&#xA;&#xA;    public void Enqueue(PendingEnumerator entry)&#xA;    {&#xA;        List&lt;PendingEnumerator&gt; list;&#xA;        var dateTime = entry.Enumerator.Current.Timestamp;&#xA;        if (_values.TryGetValue(dateTime, out list) == false)&#xA;        {&#xA;            _values.Add(dateTime, list = new List&lt;PendingEnumerator&gt;());&#xA;        }&#xA;        list.Add(entry);&#xA;    }&#xA;&#xA;    public bool IsEmpty { get { return _values.Count == 0; } }&#xA;&#xA;    public List&lt;PendingEnumerator&gt; Dequeue()&#xA;    {&#xA;        if (_values.Count == 0)&#xA;            return new List&lt;PendingEnumerator&gt;();&#xA;&#xA;        var kvp = _values.First();&#xA;        _values.Remove(kvp.Key);&#xA;        return kvp.Value;&#xA;    }&#xA;}&#xA;&#xA;public IEnumerable&lt;RangeEntry&gt; ScanRanges(DateTime start, DateTime end, string[] ids)&#xA;{&#xA;    if (ids == null || ids.Length == 0)&#xA;        yield break;&#xA;&#xA;    var pending = new PendingEnumerators();&#xA;    for (int i = 0; i &lt; ids.Length; i&#x2B;&#x2B;)&#xA;    {&#xA;        var enumerator = ScanRange(start, end, ids[i]).GetEnumerator();&#xA;        if(enumerator.MoveNext() == false)&#xA;            continue;&#xA;        pending.Enqueue(new PendingEnumerator&#xA;        {&#xA;            Enumerator = enumerator,&#xA;            Index = i&#xA;        });&#xA;    }&#xA;&#xA;    var result = new RangeEntry&#xA;    {&#xA;        Values = new double?[ids.Length]&#xA;    };&#xA;    while (pending.IsEmpty == false)&#xA;    {&#xA;        Array.Clear(result.Values,0,result.Values.Length);&#xA;        var entries = pending.Dequeue();&#xA;        if (entries.Count == 0)&#xA;            break;&#xA;        foreach (var entry in entries)&#xA;        {&#xA;            var current = entry.Enumerator.Current;&#xA;            result.Timestamp = current.Timestamp;&#xA;            result.Values[entry.Index] = current.Value;&#xA;            if(entry.Enumerator.MoveNext())&#xA;                pending.Enqueue(entry);&#xA;        }&#xA;        yield return result;&#xA;    }&#xA;}&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;We are getting a single entry from each channel into the pending enumerators. Then, we collate all the entries that share the same time into a single entry. &#xA;We use the Index property to track the actual expected index of the entry in the output. And we handle duplicate times in the same channel by outputting multiple entries.&#xA;Testing this on my 1.1 million records data set, we can get 185 thousands records back in 0.15 seconds.</p>
        <div class="button flex justify-between">
            <a href="277.html"><span class="back arrow"></span></a>

            <a href="279.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
</body>
</html>