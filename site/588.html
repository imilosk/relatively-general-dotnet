
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Home â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main">
    <section aria-label="Blog post list">
        <a href="https://ayende.com/blog/3938/nhibernate-mapping-many-to-one" target="_blank"><h1 class="title mb-6">NHibernate Mapping - &lt;many-to-one/&gt;</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 09, 2009
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Next up for inspection is the &lt;many-to-one/&gt; element. This element is defined as:     &lt;many-to-one&#xA;        name=&quot;PropertyName&quot;                                (1)&#xA;        column=&quot;column_name&quot;                               (2)&#xA;        class=&quot;ClassName&quot;                                  (3)&#xA;        cascade=&quot;all|none|save-update|delete&quot;              (4)&#xA;        fetch=&quot;join|select&quot;                                (5)&#xA;        update=&quot;true|false&quot;                                (6)&#xA;        insert=&quot;true|false&quot;                                (7)&#xA;        property-ref=&quot;PropertyNameFromAssociatedClass&quot;     (8)&#xA;        access=&quot;field|property|nosetter|ClassName&quot;         (9)&#xA;        unique=&quot;true|false&quot;                                (10)&#xA;        optimistic-lock=&quot;true|false&quot;                       (11)&#xA;        not-found=&quot;ignore|exception&quot;                       (12)&#xA;/&gt;&#xA;&#xA;&#xA;Much of the attributes on this element are identical to the ones that I outlined in the post about &lt;property/&gt;. 1, 2, 3, 6, 7, 9 and 11 are identical, and I am not going to cover them.&#xA;&#xA;4) cascade is interesting, it controls one of the more interesting NHibernate features, persistence by reachability.I outlined all the possible options in 2006, so I wouldn&#x2019;t repeat them again.&#xA;&#xA;5) fetch is really interesting. Let us take a look at an entity definition, and explore how modifying it can alter NHibernate&#x2019;s behavior.&#xA;&#xA;&#xA;  &lt;class name=&quot;Post&quot;&#xA;&#x9;&#x9; table=&quot;Posts&quot;&gt;&#xA;  &#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;identity&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;property name=&quot;Title&quot; /&gt;&#xA;&#x9;&lt;many-to-one name=&quot;Blog&quot; column=&quot;BlogId&quot;/&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&#xA;And we have the following code to exercise NHibernate:&#xA;&#xA;&#xA;  using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var post = session.Get&lt;Post&gt;(1);&#xA;&#x9;Console.WriteLine(post.Title);&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;This would result in the following SQL.&#xA;&#xA;&#xA0;&#xA;&#xA;But interesting things happen when we start playing with the fetch attribute. Note that by default the fetch attribute is defaulting to &#x201C;select&#x201D;, so setting it to that value is merely making things explicit, but setting it to fetch=&#x201D;join&#x201D;, like this:&#xA;&#xA;&#xA;  &lt;many-to-one name=&quot;Blog&quot; &#xA;&#x9;column=&quot;BlogId&quot;&#xA;&#x9;fetch=&quot;join&quot;/&gt;&#xA;&#xA;&#xA;Would result in the following SQL:&#xA;&#xA; &#xA;&#xA;&#xA;&#xA;We eagerly load the Blog association, in this case.&#xA;&#xA;8) property-ref is a legacy feature, it is meant to allow you to create many-to-one associations when the association is not done on the primary key of the association. In general, I would strongly suggest avoiding it.&#xA;&#xA;9) unique is relevant only if you use NHibernate to specify your schema. This would generate a unique constraint when we generate the DDL.&#xA;&#xA;12) not-found is another legacy feature, it controls how NHibernate behaves when it finds an invalid foreign key. That is, a value that points to an entity that doesn&#x2019;t exist. By default, this would trigger an error, as this generally indicate a problem with the database, but with legacy database, you can tell it to set the property value to null instead.</p>
        <a href="https://ayende.com/blog/3937/nhibernate-mapping-component" target="_blank"><h1 class="title mb-6">NHibernate Mapping - &lt;component/&gt;</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 08, 2009
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">&lt;component/&gt; is an interesting feature of NHibernate, which map more or less directly into the notion of a Value Type in DDD. This is a way to create an object model with higher granularity than the physical data model.  For example, let us take the following table:     And this object model:     They are quite different, where the physical data model put all the data in a single table, we want to treat them in our object model as two separate classes. This is where &lt;component/&gt; comes into play:  &lt;class name=&quot;Person&quot;&#xA;&#x9;table=&quot;People&quot;&gt;&#xA;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;identity&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;property name=&quot;Name&quot; /&gt;&#xA;&#x9;&lt;component name=&quot;Address&quot;&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;Line1&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;Line2&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;City&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;Country&quot;/&gt;&#xA;&#x9;&#x9;&lt;property name=&quot;ZipCode&quot;/&gt;&#xA;&#x9;&lt;/component&gt;&#xA;&lt;/class&gt;&#xA;&#xA;This mapping will translate between the physical data model and the object model. And the mapping is complete, so even queries are done in the way you would expect it:&#xA;&#xA; &#xA;&#xA;And then we let NHibernate sort it out and give us our pretty object graph.</p>
        <a href="https://ayende.com/blog/3936/nhibernate-mapping-property" target="_blank"><h1 class="title mb-6">NHibernate Mapping - &lt;property/&gt;</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 07, 2009
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am going to post a few things about NHibernate, going in depth into seemingly understood mapping. We will start with the most basic of them all: &lt;property/&gt; &lt;property&#xA;        name=&quot;propertyName&quot;                 (1)&#xA;        column=&quot;column_name&quot;                (2)&#xA;        type=&quot;typename&quot;                     (3)&#xA;        update=&quot;true|false&quot;                 (4)&#xA;        insert=&quot;true|false&quot;                 (4)&#xA;        formula=&quot;arbitrary SQL expression&quot;  (5)&#xA;        access=&quot;field|property|ClassName&quot;   (6)&#xA;        optimistic-lock=&quot;true|false&quot;        (7)&#xA;        generated=&quot;never|insert|always&quot;     (8)&#xA;/&gt;&#xA;1) is pretty obvious, it is the name of the property on the persistent class.&#xA;2) should be obvious as well, this is the column name in the database, which by default is the name of the property. This allows us to map a property to a column, and adds a small optimization if you have one to one mapping.&#xA;3) type is interesting. This is the CLR type of the property that we map, but it can also be used to customize the way that NHibernate works with our data types by specifying a custom IUserType.&#xA;4.1) should NHibernate update this property in the database when updating the object? Let us look at an example:&#xA;&lt;property name=&quot;Title&quot; update=&quot;false&quot;/&gt;&#xA;Given this mapping, and the following code:&#xA;using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var blog = session.Get&lt;Blog&gt;(6);&#xA;&#x9;blog.Title = &quot;changed&quot;;&#xA;&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;NHibernate will not try to update the row:&#xA; &#xA;Note that we have no update here, even though we updated the actual property value, and usually NHibernate will save that value.&#xA;4.2) insert behaves in much the same way, disabling inserts for a property. For example:&#xA;&lt;property name=&quot;AllowsComments&quot; insert=&quot;false&quot;/&gt;&#xA;And this code:&#xA;object id;&#xA;using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;id = session.Save(new Blog&#xA;&#x9;{&#xA;&#x9;&#x9;AllowsComments = true,&#xA;&#x9;&#x9;CreatedAt = DateTime.Now,&#xA;&#x9;&#x9;Subtitle = &quot;test&quot;,&#xA;&#x9;&#x9;Title = &quot;test&quot;&#xA;&#x9;});&#xA;&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;Produces:&#xA; &#xA;Note that we don&#x27;t insert the AllowComments column. And if we try to update this entity:&#xA;using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var blog = session.Get&lt;Blog&gt;(id);&#xA;&#x9;blog.AllowsComments = false;&#xA;&#x9;blog.Title = &quot;blah&quot;;&#xA;&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;We would get...&#xA; &#xA;An update of AllowComments, but not of Title.&#xA;5) formula is a way to specify any arbitrary SQL that we want to associate with a property. Obviously, this is a read only value, and it is something that we would use on fairly rare occasions. Nevertheless, it can be pretty useful at times. Let us take a look at the mapping:&#xA;&lt;property name=&quot;CountOfPosts&quot;&#xA;&#x9;formula=&quot;(select count(*) from Posts where Posts.Id = Id)&quot;/&gt;&#xA;And selecting an entity will now result in:&#xA;&#xA;Note that the formula was slightly preprocessed in order to make it work as a subquery.&#xA;6) access determines how we are going to actually set and get the actual value with NHibernate. We aren&#x27;t limited to a simple public property, in fact, we can use: private variables, private auto property variable, custom implementation, field, and many more. This isn&#x27;t actually very interesting at the moment to me, so I am just going to mention it and move on.&#xA;7) optimistic-lock is pretty complex, I am afraid. Mostly because it is a way to interact with the &lt;version/&gt; option of NHibernate. NHibernate has intrinsic support for optimistic concurrency, but sometimes there are reasons that you don&#x27;t want to change the value of the version of the entity if a particular value changed. This is the role that optimistic-lock plays. &#xA;It will probably be better when we see the code. Let us take the following entity definition:&#xA;&lt;class name=&quot;Blog&quot;&#xA;&#x9;   table=&quot;Blogs&quot;&gt;&#xA;  &#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;identity&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#x9;&lt;version name=&quot;Version&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;Title&quot; update=&quot;false&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;Subtitle&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;AllowsComments&quot; insert=&quot;false&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;CreatedAt&quot; /&gt;&#xA;&#x9;&lt;property name=&quot;CountOfPosts&quot;&#xA;&#x9;&#x9;formula=&quot;(select count(*) from Posts where Posts.Id = Id)&quot;/&gt;&#xA;&lt;/class&gt;&#xA;And now execute the following code:&#xA;using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;var blog = session.Get&lt;Blog&gt;(1);&#xA;&#x9;blog.Subtitle = &quot;new value 6&quot;;&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;The SQL that is going to be executed is:&#xA; &#xA;Note that we increment the value of the version column. But, if we specify optimistic-lock=&quot;false&quot;...&#xA;&lt;property name=&quot;Subtitle&quot;&#xA;&#x9;optimistic-lock=&quot;false&quot;/&gt;&#xA;We will get:&#xA; &#xA;Note that in this case, we do not increase the value of the version column.&#xA;8) generated is an instruction to NHibernate that the value of this property is set by the database, usually using a default value (in which case you&#x27;ll use &quot;insert&quot;) or a trigger (in which case you&#x27;ll use &quot;always&quot;).&#xA;When we use it like this:&#xA;&lt;property name=&quot;AllowsComments&quot; generated=&quot;insert&quot;/&gt;&#xA;And execute the following code:&#xA;using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;session.Save(new Blog&#xA;&#x9;{&#xA;&#x9;&#x9;CreatedAt = DateTime.Now,&#xA;&#x9;&#x9;Title = &quot;hello&quot;,&#xA;&#x9;&#x9;Subtitle = &quot;world&quot;,&#xA;&#x9;});&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;We will get an insert followed immediately by a select:&#xA; \&#xA;And the select is:&#xA; &#xA;So we have to get it back from the database before we can actually make any sort of use of it.&#xA;And that was my in depth tour into &lt;property/&gt;, more will probably follow...</p>
        <a href="https://ayende.com/blog/3935/reviewing-nchord-a-codebase-that-makes-me-twitch" target="_blank"><h1 class="title mb-6">Reviewing NChord: A codebase that makes me twitch</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 07, 2009
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I was referred to NChord by one of the comments, and it looked very interesting on the surface, so I downloaded the code and took a peek.  It is not typically my style to criticize code openly, especially after a very brief glance, but I thought that it&#xA0; might be a good idea to point some of the things that made me decide that the codebase isn&#x27;t worth the time to pursue in details. Single Responsibility Principle doesn&#x27;t apply to the file level   What you see here are no less than 11(!) files that are all parts of the same class. That is.. bad, from a whole lot of reasons, not least of which is that you have to jump through a lot of files to understand what is going on, and that ChordInstance is at least a demi-god, rapidly moving upward. Then we have things like this:   Now, this is a matter of taste more than anything else, but it strongly hints that there is lack of threading experience going on here. Indeed, a brief look at the code shows numerous potential race conditions.  Code like this really make me twitch:   All of that trend toward making me doubt the maturity and stability of the codebase. In short, after a very brief scan, I find numerous issues that I really didn&#x27;t like in the code base. And I am not willing to put up the effort to try to make headway into this with so many early warning signs already in place.</p>
        <a href="https://ardalis.com/speaking-at-kent-state-university-acm-chapter/" target="_blank"><h1 class="title mb-6">Speaking at Kent State University ACM Chapter</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 06, 2009
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x2019;m giving a talk this week at Kent State University on ASP.NET MVC and SOLID principles. It will be at 3:45pm on Wednesday, April 8th, in&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ardalis.com/where-are-the-developer-machines/" target="_blank"><h1 class="title mb-6">Where Are The Developer Machines?</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 06, 2009
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x27;m really tired of the fact that computer manufacturers in general have yet to recognize developers as a separate demographic. If you do a&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ardalis.com/use-httpapplication-completerequest-instead-of-response-end/" target="_blank"><h1 class="title mb-6">Use HttpApplication.CompleteRequest Instead of Response.End</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 06, 2009
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">HttpApplication.CompleteRequest is preferable to use for aborting a request in an ASP.NET application over Response.End, because it has&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ayende.com/blog/3934/designing-rhino-dht-a-fault-tolerant-dynamically-distributed-hash-table" target="_blank"><h1 class="title mb-6">Designing Rhino DHT - A fault tolerant, dynamically distributed, hash table</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 06, 2009
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">of the more interesting requirements that came my way recently was to redesign Rhino DHT to support dynamically distributed network of nodes. Currently, the DHT support a static network layout, and while it can handle node failure (and recovery) via replication, it cannot handle node additions on the fly.  That is a problem. But another problem is that the configuration for the DHT is getting complex very fast. And we start putting more and more requirements on top of it. This post is going to articulate the requirements we have for the DHT, how the current design for solving them.  Storage for the DHT is a solved problem, using Rhino Persistent Hash Table. Concurrency options for the DHT are those that are applicable for Rhino PHT.  Merge concurrency Optimistic concurrency Last write win - for unchanging values What we need to solve is how to generalize the PHT into a dynamic DHT, with failure tolerance and the ability to add and remove nodes to the network on the fly.  A DHT cluster may contain 1 or more nodes A DHT cluster allow to extend it by adding new nodes on the fly  Adding a node to a cluster is an expensive operation, requiring resharding of the data Removing a node is not explicitly supported, when a node is removed we assumed it is failed, and we reallocate its responsibilities A value on the DHT always have a master node, and replicated to 2 other machines A DHT node configuration includes:  DHT Cluster name DHT options:  max number of machines to replicate a value to The cluster topology is maintained in the DHT itself, and can be queried from any node Clients may receive a topology changed error when querying the DHT, and need to refresh their cached topology when this happens Working from this set of assumptions, let us see how we can handle a DHT node startup. For now, we assume that this is the first time that it has woken up, and that there are no other nodes alive. The DHT node publish a multicast UDP message on the network, announcing that it is up, and waits for replies. Since this is currently the only node, there are no replies and we are going to assume that we are the leader, and mark ourselves as such. A second node coming up is also going to announce itself on startup, and this time it is going to get a reply from the first node, telling it that the first node is the leader. This is where things gets... tricky. A new node coming up means that we need to reshard the system. Sharding means that we put the values on more than a single machines, and resharding means that we need to allocate previously assign data range from the existing machines to the new one. We handle this problem using the following approach: The DHT is a key value store. Setting a value requires a key (string). That key is going to be MD5 hashed, in order to get reliable hashing algorithm across machines, runtime versions and maybe even different platforms. Using the hash, we are usually going to simple index into the list of nodes in order to find the appropriate node responsible for this. In essence, this is the code most often used: nodes[ MD5_Hash(key) % nodes.length ].Send(key, val);&#xA;The problem with this approach is that adding/removing a node will invalidate the entire hashing strategy. In order to handle this problem, what we are going to do is to assume a 32 bits address space, giving us 4,294,967,296 distinct values. We are going to divide this address space into 1024 ranges, each of 4,194,304 values.&#xA;Each of those values is going to be assigned to a node. This gives us much more control on distributing the values across the network.&#xA;Back to the resharding issue. When we had a single node, it was the owner of all those ranges, and any value was set in that node. Now, we have to reallocate ranges, and we allocate half of them to the new node, giving us 512 ranges for each. Just reallocating the nodes isn&#x27;t as simple as it may sound, however, since we have possible values allocated in them.&#xA;The algorithm for doing that is:&#xA;&#xA;The leader allocate a set of ranges to the newly arrived node, and tell the new node about its new ranges, and the old nodes that were assigned those ranges.&#xA;The new node now access each old node and ask it to send it all the values in the ranges it was previously assigned. This is a somewhat complex procedure, since we need to keep the system alive while we do so. Internally, it is going to work as:&#xA;&#xA;Get all the values in the requested range and mark their timestamp&#xA;Send all the values to the new node&#xA;For all the sent values, check their timestamp and mark any that weren&#x27;t changed with &quot;forward to the new node&quot;, any request for that value would now generate an error saying that the client needs to go to the new node instead.&#xA;Repeat until there are no values that has been changed during the send process.&#xA;Mark the range as &quot;forward to this node&quot;, any request will generate an error saying that the new node should be used.&#xA;Once we get all the values in all the ranges allocated to us, we let the leader know about that.&#xA;The leader tell all the nodes to accept the new topology. Now, any queries for the deallocated values on the old nodes will generate a topology changed error, which would force the client to reload the topology. &#xA;&#xA;Note, there is a difference between a &quot;forward to this node&quot; error vs. &quot;topology changed&quot; error. The first is transient, the second is permanent.&#xA;There are two major problems with this algorithm. The first is that it totally ignore the possibility of failure, the second is that it ignores the replication topology as well.&#xA;We will start with the notion of failure first, if the new node fails during the initial load process, it is going to cause some problems, because any newly accepted values on it will be dead, while the node that gave it will continue redirecting to the now dead new node. This isn&#x27;t actually a problem, the standard failover mechanism will kick in, and we will query the node secondary (which hasn&#x27;t changed yet) for the actual value. If we try to set a value, it will generate a replication to the old primary node, resulting in the value effectively being &quot;resurrected&quot; in the old node.&#xA;Since we don&#x27;t expect this scenario to be very common, I think we can leave it as that, the situation will slowly correct itself over time, without us needing to do anything else.&#xA;A more interesting case is the failure of one of the old nodes during the copy process. Again, we will fail over to the range&#x27;s secondary node, and copy the values from there. There is an interesting race condition here if the old node manage to recover in time, but again, that is not something that I am overly concerned about. &#xA;Replication topology is a more interesting scenario. Let us go over the topology of a four node cluster:&#xA;&#xA;Node 1&#xA;&#xA;Leader&#xA;Primary for ranges 0 - 256&#xA;Secondary for ranges - 256 - 512&#xA;Tertiary for ranges - 512 - 768&#xA;Node 2&#xA;&#xA;Primary for ranges - 256 - 512&#xA;Secondary for ranges - 512 - 768&#xA;Tertiary for ranges 768 - 1024&#xA;Node 3 &#xA;&#xA;Primary for ranges - 512 - 768&#xA;Secondary for ranges - 768 - 1024&#xA;Tertiary for ranges 0 - 256&#xA;Node 4&#xA;&#xA;Primary for ranges - 768 - 1024&#xA;Secondary for ranges - 0 - 256&#xA;Tertiary for ranges - 256 - 512&#xA;This topology is stored in all the nodes, and can be queried from any of them. This means that it is very easy for any of the clients to know exactly which node is the master for any key. And in the case of a node failure, they also know which nodes to failover to.&#xA;Any node in the cluster is also aware of the secondary and tertiary replication backups for its ranges, and it used async messaging to let them know about new values. This keeps the node alive even when the replication nodes are down.&#xA;Changing the replication topology is done by the leader once the primary values has been successfully copy and we have a topology changeover for the primary. The process is identical to the way we handle the primary topology changeover.&#xA;So far, so good, but we haven&#x27;t handled two other scenarios, leader failure and long node failure. As it stands currently, restarting a node should not cause a change in the network topology. All the clients will automatically failover for the secondary or tertiary nodes, and on startup, the node is going to query its secondary and tertiary nodes for any new values they accepted in its name before is starts listening to incoming requests.&#xA;The problem is when we have a node that is going to be down for a long period of time, or forever. Since we are attempting to get a zero configuration system, we need to handle this ourselves. We give a failed node a timeout of 15 minutes to resume operation. This is being taken care of by the leader, which is going to listen to heartbeats from all the nodes. Assuming that 15 minutes have passed without getting a heartbeat from the node, we are going to assume that the node is down, and that we need to reallocate its ranges.&#xA;This is actually a fairly simple process, we bump the secondary node for its ranges to be the primary node and the tertiary to be the secondary. The next issue is then to do replication rebalancing, to make sure that each range has a secondary and tertiary nodes, but that is already resolved with the new node addition.&#xA;We have a few other edge cases to handle. The most important one is the failure of the leader. This one is pretty easy to handle, I think. The first node in the topology is always the leader, and the topology is always replicated to all the nodes. The second node in the topology is a watchdog for the leader, always pinging it to see that it is alive and responding for requests.&#xA;If the leader is down for a period of time (15 seconds, let us say), the watchdog takes over, and let everyone else know that it is now the leader. The next one in the chain is now the watchdog. When the old leader comes up again, it joins the cluster as a normal node. The data that the leader stores is subject to the same rules as any other nodes, and 15 minutes after the node is down it will go through the same rebalancing act by the new leader.&#xA;Thoughts?</p>
        <a href="https://ayende.com/blog/3933/rhino-queues-feature-detecting-message-failures" target="_blank"><h1 class="title mb-6">Rhino Queues feature: detecting message failures</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 06, 2009
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the more annoying problems with async messaging is that you have no way of knowing if the destination that you are sending to is up or not. Well, that is also one of the major advantages, of course. It gets annoying, however, when you need to be able to respond to node failure in a more proactive manner. There are ways around that, usually with message replies, heartbeats or timeouts, but they tend to be complex, and they also tend to be visible for the actual application. I just added a very small feature for Rhino Queues that would let you know whenever we have failed to send a message to its destination. Note that failing to send the message to the destination doesn&#x27;t really mean much, Rhino Queues will retry sending the message in increasing intervals for about 3 days. In fact, here is the retry schedule for a message before it is considered dead:     Retry  Delay  Time   0  0:00:00  4/6/2009 00:00:00   1  0:00:01  4/6/2009 00:00:01   2  0:00:04  4/6/2009 00:00:05   3  0:00:09  4/6/2009 00:00:14   4  0:00:16  4/6/2009 00:00:30   5  0:00:25  4/6/2009 00:00:55   6  0:00:36  4/6/2009 00:01:31   7  0:00:49  4/6/2009 00:02:20   8  0:01:04  4/6/2009 00:03:24   9  0:01:21  4/6/2009 00:04:45   10  0:01:40  4/6/2009 00:06:25   11  0:02:01  4/6/2009 00:08:26   12  0:02:24  4/6/2009 00:10:50   13  0:02:49  4/6/2009 00:13:39   14  0:03:16  4/6/2009 00:16:55   15  0:03:45  4/6/2009 00:20:40   16  0:04:16  4/6/2009 00:24:56   17  0:04:49  4/6/2009 00:29:45   18  0:05:24  4/6/2009 00:35:09   19  0:06:01  4/6/2009 00:41:10   20  0:06:40  4/6/2009 00:47:50   21  0:07:21  4/6/2009 00:55:11   22  0:08:04  4/6/2009 01:03:15   23  0:08:49  4/6/2009 01:12:04   24  0:09:36  4/6/2009 01:21:40   25  0:10:25  4/6/2009 01:32:05   26  0:11:16  4/6/2009 01:43:21   27  0:12:09  4/6/2009 01:55:30   28  0:13:04  4/6/2009 02:08:34   29  0:14:01  4/6/2009 02:22:35   30  0:15:00  4/6/2009 02:37:35   31  0:16:01  4/6/2009 02:53:36   32  0:17:04  4/6/2009 03:10:40   33  0:18:09  4/6/2009 03:28:49   34  0:19:16  4/6/2009 03:48:05   35  0:20:25  4/6/2009 04:08:30   36  0:21:36  4/6/2009 04:30:06   37  0:22:49  4/6/2009 04:52:55   38  0:24:04  4/6/2009 05:16:59   39  0:25:21  4/6/2009 05:42:20   40  0:26:40  4/6/2009 06:09:00   41  0:28:01  4/6/2009 06:37:01   42  0:29:24  4/6/2009 07:06:25   43  0:30:49  4/6/2009 07:37:14   44  0:32:16  4/6/2009 08:09:30   45  0:33:45  4/6/2009 08:43:15   46  0:35:16  4/6/2009 09:18:31   47  0:36:49  4/6/2009 09:55:20   48  0:38:24  4/6/2009 10:33:44   49  0:40:01  4/6/2009 11:13:45   50  0:41:40  4/6/2009 11:55:25   51  0:43:21  4/6/2009 12:38:46   52  0:45:04  4/6/2009 13:23:50   53  0:46:49  4/6/2009 14:10:39   54  0:48:36  4/6/2009 14:59:15   55  0:50:25  4/6/2009 15:49:40   56  0:52:16  4/6/2009 16:41:56   57  0:54:09  4/6/2009 17:36:05   58  0:56:04  4/6/2009 18:32:09   59  0:58:01  4/6/2009 19:30:10   60  1:00:00  4/6/2009 20:30:10   61  1:02:01  4/6/2009 21:32:11   62  1:04:04  4/6/2009 22:36:15   63  1:06:09  4/6/2009 23:42:24   64  1:08:16  4/7/2009 00:50:40   65  1:10:25  4/7/2009 02:01:05   66  1:12:36  4/7/2009 03:13:41   67  1:14:49  4/7/2009 04:28:30   68  1:17:04  4/7/2009 05:45:34   69  1:19:21  4/7/2009 07:04:55   70  1:21:40  4/7/2009 08:26:35   71  1:24:01  4/7/2009 09:50:36   72  1:26:24  4/7/2009 11:17:00   73  1:28:49  4/7/2009 12:45:49   74  1:31:16  4/7/2009 14:17:05   75  1:33:45  4/7/2009 15:50:50   76  1:36:16  4/7/2009 17:27:06   77  1:38:49  4/7/2009 19:05:55   78  1:41:24  4/7/2009 20:47:19   79  1:44:01  4/7/2009 22:31:20   80  1:46:40  4/8/2009 00:18:00   81  1:49:21  4/8/2009 02:07:21   82  1:52:04  4/8/2009 03:59:25   83  1:54:49  4/8/2009 05:54:14   84  1:57:36  4/8/2009 07:51:50   85  2:00:25  4/8/2009 09:52:15   86  2:03:16  4/8/2009 11:55:31   87  2:06:09  4/8/2009 14:01:40   88  2:09:04  4/8/2009 16:10:44   89  2:12:01  4/8/2009 18:22:45   90  2:15:00  4/8/2009 20:37:45   91  2:18:01  4/8/2009 22:55:46   92  2:21:04  4/9/2009 01:16:50   93  2:24:09  4/9/2009 03:40:59   94  2:27:16  4/9/2009 06:08:15   95  2:30:25  4/9/2009 08:38:40   96  2:33:36  4/9/2009 11:12:16   97  2:36:49  4/9/2009 13:49:05   98  2:40:04  4/9/2009 16:29:09   99  2:43:21  4/9/2009 19:12:30   100  2:46:40  4/9/2009 21:59:10 This new feature doesn&#x27;t impact this, it will simply tell you whenever a send failure has occurred. This lets you build more sophisticated error handling strategies around that. You will probably want to wait for several consecutive failures of the same endpoint before deciding to do something about it, of course, but the capability is there.</p>
        <a href="https://ayende.com/blog/3932/trying-to-get-friendly-peers" target="_blank"><h1 class="title mb-6">Trying to get friendly peers</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: April 05, 2009
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am spending way too much time on this stupid feature, so I might as well ask for help. The situation is simple, I am trying to rewrite the DHT implementation to configure itself dynamically and on the fly. That requires each DHT node to be able to publish its presence on the network. It looks simple, all you have to do is a UDP multicast over the network and then the real complexity starts (how to negotiate which node does what). The problem is that I can&#x27;t get it to work in a way that would allow two nodes to run on the same machine.  Now, I am pretty sure that I am missing something huge here, but this is pretty much my first foray into the world of UDP, and most of my knowledge is theoretical. What I am trying to do is to multicast a &quot;hello, I am here&quot; message, which can be picked up by any listening node on the network, including nodes that are running on the current machine. This is where I am running into the problem, I can&#x27;t figure out how to get two apps listening to the same port, or, how to send the multicast message to multiple ports.  Note that I am using UDP here because it is the thing that should gives me this facility with the least dependencies possible. I tried using System.Net.PeerToPeer, but I wasn&#x27;t able to get it to give me a list of peers and join notifications. Any ideas?</p>
        <div class="button flex justify-between">
            <a href="587.html"><span class="back arrow"></span></a>

            <a href="589.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>