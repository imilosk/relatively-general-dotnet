
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 906 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-9051">
            <a href="https://ayende.com/blog/1299/rude-advertising" target="_blank">
                <h2 class="title mb-6" id="article-9051">Rude Advertising</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 20, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Take a look at this suggestion from Phillips, it basically means that your TV will prevent you from skipping commericals (either via DVR or by changing the channel).    The comments are interesting, but I wonder how many of the same comments were made about the no-skip part of DVDs (I promise not to pirate the movie, not will you please skip the five minute if-you-copy-we-will-send-the-army-to-get-you movie that they stick there?) or about advertising in the movies (I got to a movie, and have to sit through 15 minutes or so of advertising before the movie begin. And they are the same advertising over and over and over and over again).    I&#x27;m starting to feel even better about my decision to avoid TV in general.</p>
        </article>
        <article id="article-9052">
            <a href="https://ayende.com/blog/1298/rhino-mocks-mailing-list-on-the-site" target="_blank">
                <h2 class="title mb-6" id="article-9052">Rhino Mocks Mailing List on the site</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 19, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just found out that my Rhino Mocks Mailing List&#xA0;(I use google for it) has an RSS feed. It was a matter of a couple of moment to add the RSS to the site, since Cuyahoga&#xA0;has a Remote Content module. This way you can see the last few messages when you are on the page.</p>
        </article>
        <article id="article-9053">
            <a href="https://ayende.com/blog/1297/stating-the-obvious" target="_blank">
                <h2 class="title mb-6" id="article-9053">Stating the Obvious</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 19, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x27;m pretty sure that you already what I&#x27;m going to say, but whatever.            If you are trying to achieve throughput, make sure that you turn logging off. Especially if you are using NHibernate, which is quite chatty in its logs (wonderful for tracking problems, really bad otherwise). I managed to get to 40,000 logged messages before I realized what was going on. P.S: It may be a good idea to create SqlBulkCopyAppender for log4net.            If you are trying to measure performance, be sure to use the performance counters, at the very least they will give you something to look at while the application is running.            The speed of the messaging pipeline is irrelevant if you have long processing to do on each message. I tried to push the throughput over the 10,000 messages a second limit on an empty pipeline, but I realized it was pointless before I put some processing into it. Right now it is processing ~250 messages a second (simulating work using Sleep()&#xA0;). I don&#x27;t think I need to worry about increasing the pipeline&#x27;s thourhgput right now.            Adding multithreading is definately worth all the effort that went to make sure that it is correct. The above numbers are for my computer (and the reason I spilled over the 2Gb limit), I expect them to grow considerably once I move them to a real server.            Don&#x27;t you believe &quot;SELECT COUNT(*) FROM BigTable&quot;, Sql Server will happily lie to you about the real size of the table. I believe it is a performance optimization that happens if you are a bozo and ask this question too often. Thinking about, I&#x27;m not a bozo, I don&#x27;t really need it, so I took it out. Still, this is a good thing to remember.            Related to both logging and performance counters. You can get quite a bit of information about the way an application behaves just from looking at what is going on the counters. And I don&#x27;t think that there has been anything in Windows that was optimized more throughfully than the performance counters, so they are just about free.</p>
        </article>
        <article id="article-9054">
            <a href="https://ayende.com/blog/1296/a-sad-event" target="_blank">
                <h2 class="title mb-6" id="article-9054">A Sad Event</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 18, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">It lasted several months, but I guess that eventually this sad day had to come.     I just managed to get my 2Gb computer to start swapping :-(</p>
        </article>
        <article id="article-9055">
            <a href="https://ayende.com/blog/1295/my-synchronization-primitive-waitforconsumersevent" target="_blank">
                <h2 class="title mb-6" id="article-9055">My synchronization primitive: WaitForConsumersEvent</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 18, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I mentioned that I had an issue with the producer having to wait for multiply consumers to finish consuming before it can continue producing. The amounts I&#x27;m talking about here is in the thousands, so WaitForMultiplyObjects or WaitHandle.WaitAll() are not applicable (both are limited to waiting on 64 items only.    For the record, I don&#x27;t usually write my own thread synchronization primitives, but it seems like there is no other good way to do this. This is a very simple wrapper to ManualResetEvent, which reset the internal event when it is set with more than zero consumers. When each of the consumers is called, the counter is decremented. When the counter reach zero, the event is set.            public class WaitForConsumersEvent : IDisposable                        {                        &#xA0;&#xA0;&#xA0; int numberOfConsumers;                        &#xA0;&#xA0;&#xA0; ManualResetEvent doneWaitingEvent;                                &#xA0;                        &#xA0;&#xA0;&#xA0; public WaitForConsumersEvent(int numberOfConsumers)                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; bool initialState = SetConsumers(numberOfConsumers);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; doneWaitingEvent = new ManualResetEvent(initialState);                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; public bool WaitOne()                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return doneWaitingEvent.WaitOne();                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; public bool WaitOne(TimeSpan timeout)                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return doneWaitingEvent.WaitOne(timeout, false);                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; public void Set()                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; int val = Interlocked.Decrement(ref numberOfConsumers);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (val == 0)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; doneWaitingEvent.Set();                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; public void Reset(int numberOfConsumers)                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (!SetConsumers(numberOfConsumers))                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; doneWaitingEvent.Reset();                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; public void Dispose()                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; doneWaitingEvent.Close();                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; private bool SetConsumers(int numberOfConsumers)                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (numberOfConsumers &lt; 0)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;throw new ArgumentOutOfRangeException(&quot;numberOfConsumers&quot;, numberOfConsumers, &quot;Should be zero or greater&quot;);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.numberOfConsumers = numberOfConsumers;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return numberOfConsumers == 0;                        &#xA0;&#xA0;&#xA0; }                        }</p>
        </article>
        <article id="article-9056">
            <a href="https://ayende.com/blog/1294/bulk-data-operations-using-nhibernate" target="_blank">
                <h2 class="title mb-6" id="article-9056">Bulk Data Operations Using NHibernate</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 18, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">If there is one thing that NHibernate (and most other O/RMs) are not very good at, it is bulk data operations. What does it mean? Well, let&#x27;s take a simple case of wanting to delete all the records in a table. (I&#x27;m going to use Active Record&#xA0;Blog Sample for the sample, it is much simpler). Let take this, for instance:Post.DeleteAll();    This will delete all the rows from the Posts table. Really easy to write or do, but what is the meaning here? What goes under the cover is something like:            Load all the posts            For each post:            Resolve the relationships between the post and other objects            According to the cascade options specified, delete / update all relating objects            Possibly recurse to the object child, etc    Delete the post    This is done this way since NHibernate will take charge of maintaining the integrity of the database (and because you don&#x27;t want to get foreign keys errors). In this case, it will make sure that all the comments for all the posts are deleted as well.&#xA0;In general, this is a Good Thing, since usually you don&#x27;t deal with massive amounts of data that need to be modified at once.     This is simple horrible when you start to deal with many records that you want to change at once. Case in point, I load several thousands objects to the application, process them, and then delete some of them. There is no order in the way I load the objects, and there is no order in which they will be deleted.     I am operating in batches, and a single batch may delete 10,000 rows. Because of the above mentioned behavior, this resolts in 10,000 queries in the unoptimized version. I think you can guess where my bottleneck was. Now, there are quite a few ways I can mitigate it. I could push all the updates into one Session Unit Of Work, and let NHibernate batch it appropriately, but even when it is batched, it is still 10,000 queries that you are talking about. Sure, it&#x27;s just &quot;DELETE FROM TableName Where Id = @p0&quot;, but that is still way too many queries for something that should happen many times a second.    Actually, since the work is being done on multiply threads, there is even more problems with it, since NHibernate&#x27;s Session is not thread safe. Problem, isn&#x27;t it?     NHibernate&#x27;s documentation warns against doing this kind of stuff, for the reasons I have just listed. In this case, NHibernate choose the approach of safe &amp; slow than fast &amp; wrong. I agree with this approach, wholeheartedly, but it is not doing me any good in this case.     Now, let us think about the problem first, and see what I want to happen. I want to be able to issue a delete statement like this:             DELETE     FROM TableName    WHERE Id In (@p0, @p1, @p2 ... @p9999)        I just tested it, and I can verify that the IN operator in SQL 2005 can have over 200,000 items in it, so I&#x27;m good to go, am I not? The query size can get big fast, and it&#x27;s not terribly efficent way to do it. Beisde, I don&#x27;t want to appear in the Daily WTF.    Here is what I ended up with, it is a two part solution. One part, in the database, is composed of a&#xA0;table and a procedure:            CREATE TABLE [dbo].[HelperTable_IdMarkedForDeletion](                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; [Id] [int] NOT NULL PRIMARY KEY CLUSTERED                                                                 )                GO                     &#xA0;                     CREATE PROCEDURE&#xA0; [dbo].[ClearIncomingFromRowsMarkedForDeletion]                        AS                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; BEGIN TRANSACTION                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; DELETE FROM TableName                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; WHERE Id IN (SELECT Id FROM HelperTable_IdMarkedForDeletion)                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; TRUNCATE TABLE HelperTable_IdMarkedForDeletion                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; COMMIT                                GO            This actually gives the Query Optimizer a chance to optimize the procedure and get an efficent result. Now, to the second part, which is the code. I just created this class:            public class BulkDeleter&lt;PkType, ItemType&gt;                        {                        &#xA0;&#xA0;&#xA0; DataTable table;                        &#xA0;&#xA0;&#xA0; string tempTable, procName;                        &#xA0;&#xA0;&#xA0; Func&lt;PkType, ItemType&gt; getPk;                                &#xA0;                        &#xA0;&#xA0;&#xA0; public BulkDeleter(string tempTableName, string procName, Func&lt;PkType, ItemType&gt; getPk)                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.tempTable = tempTableName;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.procName = procName;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.table = new DataTable(tempTable);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.table.Columns.Add(&quot;Id&quot;, typeof(PkType)).Unique = true;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; this.getPk = getPk;                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; public void RegisterForDeletion(ItemType item)                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; lock (table)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; table.Rows.Add(getPk(item));                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0; public void PerformDelete(IDbConnection connection)                        &#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; lock (table)                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; using (SqlBulkCopy bulkCopy = new SqlBulkCopy((SqlConnection)connection))                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; {                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; bulkCopy.DestinationTableName = tempTable;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; bulkCopy.WriteToServer(table);                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; table.Rows.Clear();                                &#xA0;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; using (IDbCommand command = connection.CreateCommand())                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;{                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; command.CommandText = procName;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; command.CommandType = CommandType.StoredProcedure;                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; command.ExecuteNonQuery();                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }                        &#xA0;&#xA0;&#xA0; }                                                        }                        On construction, it gets the table and procedure name, and a delegate that will extract the primary key from the items that are registered for deletion. Internally, it managed a DataTable of the primary keys, any time you register an object for deletion, it will store its primary key in the datatable. When you decide to perform the delete, it will bulk copy the content of the DataTable to the server, and then execute the stored procedure.     Bulk copying is very fast, and there is nothing like a stored procedure to handle bulk data operations. It is hard to measure timing correctly, since the work was spread across multiply threads, but I know that I reduced the number of queries the database has to deal with from thousands to two.As a note, if I was working on a project that required bulk data operations on more than just one or two cases, I would&#x27;ve probably created a custom persister for NHibernate, which would be able to make more assumtions about my model than NHibernate can. Right now this is a single scenario that I need to address, and this was the simplest thng that solved the problem (elegantly).</p>
        </article>
        <article id="article-9057">
            <a href="https://ayende.com/blog/1293/fun-with-threads" target="_blank">
                <h2 class="title mb-6" id="article-9057">Fun With Threads</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 18, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x27;m doing a project that is heavily multi-threaded now, so I got a chance to experiance the love :-)     A couple of pretty obvious things that you may want to remember:             If your tests execute multi threaded code, make sure that the code has finished running before the test complete. I got a couple of interesting bugs this way, and I wasn&#x27;t able to track them down until I realized that the test run, succeeded, and while the next test was being executed, stuff was happening that started in the previous test.                         It is probably not a good idea to do a thread.Join() on a ThreadPool thread :-)                 By the way, anyone knows of a way to wait until all the specified work was done? For instance, I got 10 pieces of work, and I queue them in the ThreadPool. I want to wait until all 10 are done, with a timeout. The exact opposite Semaphore, actually. I remember something like this from Win32, where there was a thread synchronization primivite like that, but I can remember which, and I can&#x27;t even be sure that I recall it correctly.     Right now I rolled my owned, which is a Bad Thing to do, I know.</p>
        </article>
        <article id="article-9058">
            <a href="https://ardalis.com/asp-net-2-0-provider-source-code-released/" target="_blank">
                <h2 class="title mb-6" id="article-9058">ASP.NET 2.0 Provider Source Code Released</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 17, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is very cool. The ASP.NET team has released the source code for the built in providers for the following: Membership Role Management&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-9059">
            <a href="https://ayende.com/blog/1292/on-comments-yet-again" target="_blank">
                <h2 class="title mb-6" id="article-9059">On Comments, Yet Again</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 17, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">After making such a point about commenting being mostly noise, and that code should be able to stand on its own, I found myself adding the following comment (related to this issue) to Rhino Mocks.             //This&#xA0;can&#xA0;happen&#xA0;only&#xA0;if&#xA0;a&#xA0;vritual&#xA0;method&#xA0;call&#xA0;originated&#xA0;from&#xA0;                //the&#xA0;constructor,&#xA0;before&#xA0;Rhino&#xA0;Mocks&#xA0;knows&#xA0;about&#xA0;the&#xA0;existance&#xA0;                //of&#xA0;this&#xA0;proxy.&#xA0;Those&#xA0;type&#xA0;of&#xA0;calls&#xA0;will&#xA0;be&#xA0;ignored&#xA0;and&#xA0;not&#xA0;count                //as&#xA0;expectations,&#xA0;since&#xA0;there&#xA0;is&#xA0;not&#xA0;way&#xA0;to&#xA0;relate&#xA0;them&#xA0;to&#xA0;the&#xA0;                //proper&#xA0;state.                if(proxies.ContainsKey(proxy)==false)&#xA0;return&#xA0;null;            There is just no way that&#xA0;I&#x27;ll remember in 2 week (let alone months) why this is important. Then again, the test for this piece of code is called &quot;MockClassWithVirtualMethodCallFromConstructor&quot;, so this should probably be good enough.    Damn, but I love to work on code that is covered with tests. It was a ten minutes affair from getting the test to fail to finding exactly where the problem is, and then it was a simple matter of escelating the call stack until I had a good enough view on what was happening. Two lines of code (and 5 lines of comments) later, I got a passing test.    Three minutes afterward, I was uploading a new release to the website. This is the best thing about doing TDD, I know that I can&#x27;t break the system without knowing about it. And if I do break something that I don&#x27;t have a test for, well, if I don&#x27;t have a test for it, then I&#x27;m probably not going to need it after all, so it wouldn&#x27;t bother me. Perfect :-)</p>
        </article>
        <article id="article-9060">
            <a href="https://ayende.com/blog/1291/rhino-mocks-2-7-1-virtual-calls-from-constructors" target="_blank">
                <h2 class="title mb-6" id="article-9060">Rhino Mocks 2.7.1: Virtual Calls From Constructors</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: April 17, 2006
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In many ways, I feel that I&#x27;m still a C/C&#x2B;&#x2B; programmer, despite 5 or so years of almost exclusive .Net work. I found myself playing with the scope of the variables inside a method, trying to make sure that they would only be allocated once. It&#x27;s only after I did it that I realized that it just doesn&#x27;t matter for the CLR, since local variables has the same lifetime as their method and are only allocated once.    Today I had a bug that came from the same C&#x2B;&#x2B; thinking, I didn&#x27;t consider what would happen if a mocked class constructor makes a virtual method call. I store all the state for the mocked objects&#x27;&#xA0;that a MockRepository generate in a hash table keyed to the object identity, and when a method call is intercepted, I uses the this pointer to find the correct state for the call.     The problem with a virtual method call from the constructor is that it calls the most derived override method, which is exactly opposite from how it is done in C&#x2B;&#x2B;, where the method table is changed as the object is being construct (or de-construct). I actually blogged about the subject not long ago.    Because the object has not finished initializing yet, it is not yet stored in the repository, and so it can&#x27;t find the state for the object, and then bad things happen :-)    Thanks for David for finding out the bug. I decided to ignore virtual method call from constructors, since I can&#x27;t really see a way that this will be useful. If you create an expectation in the constructor, how are you going to meet it?    Anyway, you probably already know that you can find the source and the binaries here, but only if you look hard.</p>
        </article>
        <div class="button flex justify-between">
            <a href="905.html"><span class="back arrow"></span></a>

            <a href="907.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>