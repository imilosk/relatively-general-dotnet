
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 778 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-7771">
            <a href="https://ayende.com/blog/2589/when-query-objects-are-a-first-level-concern" target="_blank">
                <h2 class="title mb-6" id="article-7771">When Query Objects are a first level concern</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 24, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I mentioned that&#xA0;I recently had a shift in my think about having services that return query objects. Now I have more interesting problems. How do I test such a thing? To be more accurate, how do you test such a thing in an accurate &amp; maintainable way? To say that queries can be complicated is an understatement. You can try to deconstruct the query, but is this a really good idea? Something as simple a inner vs. left join can have interesting implications. I guess that I am asking whatever&#xA0;this approach still allows for a Unit Test.  Right now I am testing that against an in memory database, so it mostly involved setting up the data, calling the service that returns the query, execute that and verify the results. Any thoughts?</p>
        </article>
        <article id="article-7772">
            <a href="https://ayende.com/blog/2588/natural-event-syntax-for-rhino-mocks" target="_blank">
                <h2 class="title mb-6" id="article-7772">Natural Event Syntax for Rhino Mocks</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 23, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I asked before, but didn&#x27;t get any conclusive answers, what do you think about this syntax for raising events in Rhino Mocks. I spiked the implementation, and the code blow works. As I said, I don&#x27;t like the awkward syntax of GetLastEventRaiser(), nor the reliance on EventRaiser.Create(mock, &quot;Load&quot;), because it relies on strings. Does it make sense? Readable? Maintainable? [Test]&#xA;public void Raise_FromEventRaiser_RaiseTheEvent()&#xA;{&#xA;    MockRepository mocks = new MockRepository();&#xA;    IWithCustomEvents withCustomEvents = mocks.DynamicMock&lt;IWithCustomEvents&gt;();&#xA;    mocks.ReplayAll();&#xA;    &#xA;    bool myEventCalled = false;&#xA;    withCustomEvents.MyEvent &#x2B;= delegate { myEventCalled = true; };&#xA;&#xA;    withCustomEvents.MyEvent &#x2B;= EventRaiser.Raise(this, EventArgs.Empty);&#xA;&#xA;    Assert.IsTrue(myEventCalled);&#xA;}&#xA;&#xA;I wanted to say that the implementation was simple, but it relies on emitting code at runtime, so is it simple?&#xA;Anyway, I am waiting for some additional responses</p>
        </article>
        <article id="article-7773">
            <a href="https://ayende.com/blog/2587/wish-distributable-windows-based-virtual-machines" target="_blank">
                <h2 class="title mb-6" id="article-7773">Wish</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 23, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Sahil Malik&#xA0;points out&#xA0;that Microsoft has found a way to distribute Virtual Machines for Windows by time bombing them. In fact, they now have quite a number of them available for download. Sahil has another request, to be able to do the same himself:  Extend that time bomb mechanism, so parties other than Microsoft can play. I should be able to create a solution based on MSFT technologies, and hand over a VHD for the world to play. That is something that I would like to see very much. My company has a lot of virtualization stuff going on, and I would be very interested in being able to legally distribute a VM that can be use to boot-and-go in various scenarios. I would like to add another request to that, not only do we need to be able to distribute time bombed VMs, we also need a way to white-list them, if we want to use the VM for more than the allowed period. My company has done several projects where deployment has consisted of xcopy the VM file to the VM server, and the booting. I spoke about it in the past, here</p>
        </article>
        <article id="article-7774">
            <a href="https://ayende.com/blog/2586/syntax-multi-something" target="_blank">
                <h2 class="title mb-6" id="article-7774">Syntax: Multi Something</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 22, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">As I have already explained, I am doing a lot of work with NHibernate&#x27;s MultiCriteria and MutliQuery. There are very powerful, but they are also mean that I am working at a level that has a lot of power, but a bit of a complex syntax. I want to improve that, but I am not sure what the best way to do it. Anything here is blog-code, meaning that I didn&#x27;t even verified that it has valid syntax. It is just some ideas about how this can go, I am looking for feedback. The idea here is to have a better way to use NHQG expressions, and to remove the need to manually correlate between the index of the added query and the index in the result set. It should also give you better syntax for queries that return a unique result.new CriteriaQueryBatch()&#xA; .Add(Where.Post.User.Name == &quot;Ayende&quot;, OrderBy.Post.PublishedDate.Desc)&#xA;   .Paging(0, 10)&#xA;   .OnRead(delegate(ICollection&lt;Post&gt; posts) { PropertyBag[&quot;posts&quot;] = posts; })&#xA; .Add(Where.Post.User.Name == &quot;Ayende&quot;)&#xA;   .Count()&#xA;   .OnRead(delegate(int count) { PropertyBag[&quot;countOfPosts&quot;] = count; })&#xA; .Execute();&#xA0;&#xA;Waiting for you thoughts...</p>
        </article>
        <article id="article-7775">
            <a href="https://ayende.com/blog/2585/you-really-want-to-rethink-your-localization" target="_blank">
                <h2 class="title mb-6" id="article-7775">You really want to rethink your localization</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 22, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is from a advertising brochure that my company has distribute, for a virtualization conference that we recently did. I have included the sponsorships part only, it says &quot;Gold Sponsor: IBM&quot;, &quot;Silver Sponsors: VMWare, FilesX&quot;. The problem is that in Hebrew, the word for Silver is the same word for Money.  This has the affect of me reading it as: &quot;Money Sponsors: VMWare, FilesX&quot;. That sounds... crass. The problem is actually not limited to my company&#x27;s conferences, but it actually wide spread in Israel. I really wish they would think about a different term.</p>
        </article>
        <article id="article-7776">
            <a href="https://ayende.com/blog/2584/query-building-in-the-domain-service-layers" target="_blank">
                <h2 class="title mb-6" id="article-7776">Query Building In The Domain / Service Layers</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 21, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Here is an interesting topic. My ideal data access pattern means that there is a single query per controller per request (a request may involve several controllers, though). That is for reading data, obviously, for writing, I will batch the calls if needed. I am making heavy use of the Multi Criteria/Query in order to make this happen. I have run into&#xA0;a snug with this approach, however. The problem is that some of the services also do data access*. So I may call to the authorization service to supply me with the current user and its customer, and the service will call the DB to find out about this information. I would rather that it would not do that, since that means extra round trips. Now, NHibernate has the idea of a DetachedCriteria, a query that has semi independent life, can be constructed at will and massaged to the right shape anywhere in the code.  Now, I have the following options. Use the normal method: ICollection&lt;Customer&gt; customers = AuthorizationService.GetAssociatedCustomers();&#xA;ICollection&lt;Policy&gt; policies = Repository&lt;Policy&gt;.FindAll(&#xA;&#x9;Where.Policy.Customer.In(customers)&#xA;  );&#xA;&#xA;PropertyBag[&quot;customers&quot;] = customers;&#xA;PropertyBag[&quot;policies&quot;] = policies;&#xA;Use DetachedCriteria as a first level building block:&#xA;DetachedCriteria customersCriteria = AuthorizationService.GetAssociatedCustomersQuery();&#xA;IList results = session.CreateMultiCriteria()&#xA;&#x9;.Add(customersCriteria)&#xA;&#x9;.Add(DetachedCriteria.For&lt;Policy&gt;()&#xA;&#x9;&#x9;.Add( Subqueries.PropertyIn(&quot;id&quot;, CriteriaTransformer.Clone(customersCriteria)                                                    .SetProjection(Projections.Id())                      ) )&#xA;&#x9;).List();&#xA;&#xA;ICollection&lt;Customer&gt; customers = Collection.ToArray&lt;Customer&gt;(results[0]);&#xA;ICollection&lt;Policy&gt; policies = Collection.ToArray&lt;Policy&gt;(results[1]);&#xA;PropertyBag[&quot;customers&quot;] = customers;&#xA;PropertyBag[&quot;policies&quot;] = policies;&#xA;Remember, I consider Querying a&#xA0;Business Concern, so I like the ability to move the query itself around. &#xA;Thoughts?&#xA;*&#xA0; By data access, I mean, they call something that eventually resolves in a DB call.</p>
        </article>
        <article id="article-7777">
            <a href="https://ayende.com/blog/2583/nhibernates-xml-in" target="_blank">
                <h2 class="title mb-6" id="article-7777">NHibernate&#x27;s Xml In</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 21, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I wrote it because of a particular problem that I have run into, which is not something that I have heard much discussion about. In my application, I need to query the database about a certain data, and the best way to do that would be using an in query. For the purpose of discussion, I want to find all the customers associated with the current user.    Unfortantely, I can&#x27;t do something as simple as &quot;Where.Customer.User == CurrentUser&quot;, because a customer may be associated to a user in many complex and interesting ways (the end result is a 3 pages query, btw). Therefor, I make the calculation of who are the relevant customers for a user when they login, and cache that.    So, I need to ask the database for all the customers assoicated with the user, and since I already know about the user&#x27;s customers. In() was a natrual way to go. The problem is that I actually began to run into SQL Server 2,100 parameters per query limit when important users (who has a lot of associations) started to use that.    Can you say, major stumbling block? There are several solutions for that, and the one I choose is to extend NHibernate to perform an IN query on an XML datatype, as described here. You can see the implementation here.    Why use an IN on XML instead of a join against the data? I can send it to the database using BulkCopy and then join against that very easily, no? (I describe one such way here)    Using Bulk Copy&#xA0;&amp; Join approach would probably turn out to be faster than an IN on an XPath (haven&#x27;t tested, though). But&#xA0;as it turn out, I had several reasons for that:            Using the BulkCopy&#xA0;&amp; Join approach would mean that I need to perform two DB Queries, instead of one.            Someone should be responsible for clearing the joined table at one point, that is another thing to deal with.            It requires a two steps process, with no easy way to back out of that if there is a small amount of items that we want to check.            Caching    Using the BulkCopy &amp; Join basically means that I have no real way to avoid hitting the database altogether. Using this approach, I am merely adding a (potentially large) parameter to the query, and let NHibernate deals with everything else.    The way you use this is simple:            session.CreateCriteria(typeof(Customer))        &#xA0;&#xA0;&#xA0; .Add(XmlIn.Create(&quot;id&quot;, potentiallyLargeAmount))        &#xA0;&#xA0;&#xA0; List();        It will automatically default to normal IN behavior if you are not running on SqlServer 2005 or if the amount of items that you are checking is smaller than 100.</p>
        </article>
        <article id="article-7778">
            <a href="https://ayende.com/blog/2582/hierarchical-containers" target="_blank">
                <h2 class="title mb-6" id="article-7778">Hierarchical Containers</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 21, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is somewhat of a specific scenario, but let us assume that you have an application where you want to specialize the services of the applications by the current user. If the user belongs to the Northwind customer, you want to have one behavior, and if it belongs to the Southsand customer, you want to have a different behavior. All users from all others customers get the default behavior. To make it simple, let us talk about NHibernate configuration. You have a default schema that you use for most customers, and you specialize that for those customers that wants extra. This means that you need to keep a session factory per customer, because you have different schema that in the default one (changing the connection string is not enough). To be clear, this is not about entity inheritance, this is about specialization of the entire application, which I just happened to demonstrate via NH configuration. Now, Windsor supports this ability by having a parent container and child containers, but Binsor didn&#x27;t expose this functionality easily, I did some work on it today, and the end result is that you can configure it like this: We have the global container (implicit to Binsor, since we created it before we run the Binsor script), then we run over the configuration files and create a container per each file. We register them in the ContainerSelector, which is an application level service (below). import HierarchicalContainers&#xA;import System.IO&#xA;&#xA;Component(&quot;nhibernate_unit_of_work&quot;, IUnitOfWorkFactory, NHibernateUnitOfWorkFactory,&#xA;&#x9;configurationFileName: &quot;&quot;&quot;..\..\hibernate.cfg.xml&quot;&quot;&quot;)&#xA;&#x9;&#xA;Component(&quot;nhibernate_repository&quot;, IRepository, NHRepository)&#xA;Component(&quot;container_selector&quot;, ContainerSelector)&#xA;&#xA;for configFile in Directory.GetFiles(&quot;&quot;&quot;..\..\Configurations&quot;&quot;&quot;, &quot;*.cfg.xml&quot;):&#xA;&#x9;continue if Path.GetFileName(configFile) == &quot;hibernate.cfg.xml&quot;&#xA;&#x9;print &quot;Build child configuration for ${configFile}&quot;&#xA;&#x9;child = RhinoContainer(IoC.Container)&#xA;&#x9;using IoC.UseLocalContainer(child):&#xA;&#x9;&#x9;Component(&quot;nhibernate_unit_of_work&quot;, IUnitOfWorkFactory, NHibernateUnitOfWorkFactory,&#xA;&#x9;&#x9;&#x9;configurationFileName: configFile)&#xA;&#x9;&#x9;Component(&quot;nhibernate_repository&quot;, IRepository, NHRepository)&#xA;&#x9;#need to remove both .cfg and .xml&#xA;&#x9;containerName = Path.GetFileNameWithoutExtension(Path.GetFileNameWithoutExtension(configFile))&#xA;&#x9;IoC.Container.Resolve(ContainerSelector).Register(containerName, child)&#xA;You can use it like this, and enter/leave the context of the a client at will:&#xA;RhinoContainer container = new RhinoContainer(&quot;Windsor.boo&quot;);&#xA;IoC.Initialize(container);&#xA;ContainerSelector containerSelector = IoC.Resolve&lt;ContainerSelector&gt;();&#xA;containerSelector.PrintChildContainers();&#xA;using(UnitOfWork.Start())&#xA;{&#xA;    Console.WriteLine(&#xA;        NHibernateUnitOfWorkFactory.CurrentNHibernateSession&#xA;            .Connection.ConnectionString&#xA;        );&#xA;}&#xA;using(containerSelector.Enter(&quot;Northwind&quot;))&#xA;{&#xA;    using (UnitOfWork.Start())&#xA;    {&#xA;        Console.WriteLine(&#xA;            NHibernateUnitOfWorkFactory.CurrentNHibernateSession&#xA;                .Connection.ConnectionString&#xA;            );&#xA;    }&#xA;}&#xA;using (containerSelector.Enter(&quot;Southsand&quot;))&#xA;{&#xA;    using (UnitOfWork.Start())&#xA;    {&#xA;        Console.WriteLine(&#xA;            NHibernateUnitOfWorkFactory.CurrentNHibernateSession&#xA;                .Connection.ConnectionString&#xA;            );&#xA;    }&#xA;}&#xA;&#xA;Because this is a fairly complex topic, I have created a simple reference implementation that you can get here:&#xA;https://rhino-tools.svn.sourceforge.net/svnroot/rhino-tools/trunk/SampleApplications/HierarchicalContainers</p>
        </article>
        <article id="article-7779">
            <a href="https://ayende.com/blog/2581/exceptions-usability" target="_blank">
                <h2 class="title mb-6" id="article-7779">Exceptions Usability</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 20, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just made a small change to the EnsureMaxNumberOfQueriesPerRequestModule, when it detects that the amount of queries performed goes beyond the specified value, it would also include the queries that it detected in the exception message. Very minor change, but the affect is that I can just scroll the page and say: &quot;Oh, I have a SELECT N&#x2B;1 here&quot;, directly off the exception page. On a side note, I am getting better at optimizing NHibernate based application, and I strongly suggest anyone using NHibernate to look at Multi Query in 1.2 (and Multi Criteria on the trunk) for those kind of things. It give you quite a bit of power. I run into several places today that we would read &amp; write large amount of data on a single request, and that triggered the max query limit. It took a while, but some interesting usage of both batching &amp; multi queries dropped the database roundtrips by an order of magnitude. Nice.</p>
        </article>
        <article id="article-7780">
            <a href="https://ayende.com/blog/2580/efficently-loading-deep-object-graphs" target="_blank">
                <h2 class="title mb-6" id="article-7780">Efficently loading deep object graphs</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: June 20, 2007
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Here is an interesting approach to get deep object graphs effectively.&#xA0; This will ensure that you will get all the relevant collections without having to lazy load them and without a huge cartesian product. Especially useful if you want to load a collection of items with the associated deep object graph.public Policy GetPolicyEagerly(int policyId)&#xA;{&#xA;&#x9;IList list = ActiveRecordUnitOfWorkFactory.CurrentSession.CreateMultiQuery()&#xA;&#x9;&#x9;.Add(@&quot;from Policy policy left join fetch policy.PolicyLeadAssociations                                  where policy.Id = :policyId&quot;)&#xA;&#x9;&#x9;.Add(@&quot;from Policy policy left join fetch policy.PolicyEmployeeAssociations                                  where policy.Id = :policyId&quot;)&#xA;&#x9;&#x9;.Add(@&quot;from Policy policy left join fetch policy.PolicyManagerAssociations                                  where policy.Id = :policyId&quot;)&#xA;&#x9;&#x9;.Add(@&quot;from Policy policy left join fetch policy.PolicyDepartmentAssociations                                  where policy.Id = :policyId&quot;)&#xA;&#x9;&#x9;.Add(@&quot;from Policy policy left join fetch policy.PolicyCustomerAssociations                                  where policy.Id = :policyId&quot;)&#xA;&#x9;&#x9;.SetEntity(&quot;policy&quot;, Policy)&#xA;&#x9;&#x9;.List();&#xA;&#x9;IList firstResultList = (IList) list[0];&#xA;&#x9;if(firstResultList.Count==0)&#xA;&#x9;&#x9;return null;&#xA;&#x9;return = (Policy) firstResultList [0];&#xA;}&#xA;The domain above is a fake one, by the way, don&#x27;t try to make any sense of it.</p>
        </article>
        <div class="button flex justify-between">
            <a href="777.html"><span class="back arrow"></span></a>

            <a href="779.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;🚀&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
