
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 571 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-5701">
            <a href="https://ayende.com/blog/4142/a-guide-into-or-m-implementation-challenges-mapping" target="_blank">
                <h2 class="title mb-6" id="article-5701">A guide into OR/M implementation challenges</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 24, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Continuing my shadowing of Davy&#x2019;s Build Your Own DAL series, this post is shadowing Davy&#x2019;s mapping post.&#xA0;  Looking at the mapping, it is fairly clear that Davy has (wisely) made a lot of design decisions along the way that drastically reduce the scope of work he had to deal with. The mapping model is attribute base and essentially supports a simple one to one relation between the classes and the tables. This make things far simpler to deal with internally.   The choice has been made to fix the following:     Only support SQL Server    Attributed model    Primary key is always:         Numeric      Identity      Single Key      Using those rules, Davy create a really slick implementation. About the only complaint that I can make about it is that he doesn&#x2019;t support having a limit clause of selects.  Take a look at the code he have, it should give you a good idea about what is involved in dealing with mapping between objects and classes.  The really fun part about redoing things that we are familiar with is that we get to ignore all the other things that we don&#x2019;t want to do which introduce complexity. Davy&#x2019;s solution works for his scenario, but I want to expand a bit on the additional features that NHibernate has at that layer. It should give you some understanding on the task that NHibernate is solving.     Inheritance, Davy&#x2019;s DAL is supporting only Table Per Class inheritance. NHibernate support 4 different inheritance model (&#x2B; mixed models that we won&#x2019;t get into here).    Eager loading, something that would add significantly to the complexity of the solution is the ability to load a Product with its Category. That requires that you&#x2019;ll be able to change the generated SQL dynamically, and more importantly, that you will be able to read it correctly. That is far from simple.    Property that spans multiple columns, it seems like a simple thing, but in actually it affects just about every part of the mapping layer, since it means that all property to column conversion has to take into account multiple columns. It is not so much complex as it is annoying. Especially since you have to either carry the column names or the column indexes all over the place.    Collections, they are complex enough on their own (try to think about the effort involved in syncing changes in a collection in an efficient manner) but the part that really kills with them is trying to do eager loading with them. Oh, but I forgot about one to many vs. many to many. And let us not get into the distinctions between different types of collections.    Optimistic Concurrency, this is actually a feature that would be relatively easy to add, I think. At least, if all you care about is a single type of versioning / optimistic concurrency. NHibernate supports several (detailed here).   I could probably go on, but I think the point was made. As I said before, the problem with taking on something like this is that it either take a day to get the basic functionality going or several months to really get it into shape to handle more than a single scenario.  This series of posts should give you a chance to appreciate what is going on behind the scenes, because you&#x2019;ll have Davy&#x2019;s effort at the base functionality, and my comments on what is required to take it to the next level.</p>
        </article>
        <article id="article-5702">
            <a href="https://ayende.com/blog/4141/nhibernate-rarities-sessionfactoryobjectfactory" target="_blank">
                <h2 class="title mb-6" id="article-5702">NHibernate rarities: SessionFactoryObjectFactory</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 24, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I had a discussion about session factory management in NHibernate just now, and I was asked why NHibernate isn&#x2019;t managing that internally.  Well&#x2026; it does, actually. As you can guess, SessionFactoryObjectFactory is the one responsible for that, and you can use GetNamedInstance() to get a specific session factory.  It isn&#x2019;t used much (as a matter of fact, I have never seen it used), I am not quite sure why. I think that it is easier to just manage it ourselves. There are very rare cases where you would need more than one or two session factories, and when you run into them, you usually want to do other things as well, such as lazy session factory initialization and de-initialization.</p>
        </article>
        <article id="article-5703">
            <a href="https://ayende.com/blog/4140/a-guide-into-or-m-implementation-challenges-reasoning" target="_blank">
                <h2 class="title mb-6" id="article-5703">A guide into OR/M implementation challenges</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 24, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Davy Brion, one of NHibernate&#x2019;s committers, is running a series of posts discussing building your own DAL. The reasons for doing so varies, in Davy&#x2019;s case, he has clients who are adamantly against using anything but the Naked CLR. I have run into similar situations before, sometimes it is institutional blindness, sometimes it is legal reasons, sometimes there are actually good reasons for it, although it is rare.  Davy&#x2019;s approach to the problem was quite sensible. Deprived of his usual toolset, he was unwilling to give up the advantages inherent to them, so he set up to build them. I did much the same when I worked on SvnBridge, I couldn&#x2019;t use one of the existing OSS containers, but I wasn&#x2019;t willing to build a large application without one, so I created one.  I touched about this topic in more details in the past. But basically, a single purpose framework is significantly simpler than a general purpose one. That sounds simple and obvious, right? But it is actually quite significant.  You might not get the same richness that you will get with the real deal, but you get enough to get you going. In fact, since you have only a single scenario to cover, it is quite easy to get the features that you need out the door. You are allowed to cheat, after all :-)  In Davy&#x2019;s case, he made the decision that using POCO and not worrying about persistence all over the place are the most important things, and he set out to get them.  I am going to shadow his posts in the series, talking about the implications of the choices made and the differences between Davy&#x2019;s approach and NHibernate. I think it would be a good approach to show the challenges inherit in building an OR/M.</p>
        </article>
        <article id="article-5704">
            <a href="https://ayende.com/blog/4139/nhibernate-documentation" target="_blank">
                <h2 class="title mb-6" id="article-5704">NHibernate Documentation</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 23, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I know that some people complain about the lack of documentation with NHibernate. That is something that I never truly could grasp. Leaving aside the excellent book, right there in NHibernate&#x2019;s site we have a huge amount of documentation.  I&#x2019;ll admit that the plot in the documentation is weak, but I think that reading this document is essential. It covers just about every aspect of NHibernate, and more importantly, it allows you to understand the design decisions and constraints that were used when building it.  Next time you wonder about NHibernate Documentation, just head over there and check. For that matter, I strongly suggest that you will read the whole thing start-to-finish if you are doing anything with NHibernate. It is an invaluable resource.</p>
        </article>
        <article id="article-5705">
            <a href="https://ayende.com/blog/4138/authors-review-david-weber-john-ringo" target="_blank">
                <h2 class="title mb-6" id="article-5705">Authors Review: David Weber &amp; John Ringo</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 23, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Well, this is going to be a tad different than my usual posts, instead of doing technical post, or maybe a SF book review, I am going to talk about two authors that I really like.  David Weber is the author of the Honor Harrington series, the Prince Roger (in conjunction with Ringo) series, the Dahak series and the Safehold series, as well as other assorted books.   John Ringo is the author of the Prince Roger series, the Posleen series, the Council Wars series and a bunch of other stuff.  Both are really good authors, although I much prefer Weber&#x2019;s books to Ringo&#x2019;s. Their Prince Roger series of book was flat out amazing, and it is only after I read a lot more of their material that I can truly grasp how much each author contributed to them.  Ringo is way better in portraying the actual details of military, especially marines, SpecOp, etc. Small teams with a lot of mayhem attached. Unfortunately, he seems to be concentrating almost solely on having stupid opponents. I am sorry, but fighting enemies whose tactic is to shout Charge! isn&#x2019;t a complex task. He is also way too attached to fighting scenes and a large percentage of his books are dedicated to that.  Well, he is Military SF writer, after all, but I think that he is not dedicating enough time to other stuff related to war. And his characters are sometimes unbelievable. The entire concept he base a lot of the Posleen series on is unbelievable in the extreme. No, not because it is SF. Because it goes against human nature to do some of the thing he portray them doing. The end of the Posleen war, for example, was one such case. The fleet comes back home, violating orders of supposedly friendly alien masters that want to see Earth destroyed by another bunch of aliens.  The problem is not that the fleet comes home in violation of orders, the problem is that it didn&#x2019;t do so much sooner than that. Humans are not wired for something like that, especially since it was made clear that long before the actual event the fleet was well aware of what is going on. I spent 4 years in a military prison, orders be damned, I know exactly how far you can stretch that. And you can&#x2019;t stretch it far at all. Not on a large scale with normal psych humans.  Or when one race of aliens is trying to subvert the war effort to help another race kill more humans. That is believable. What isn&#x2019;t believable that the moment it was made widely spread knowledge they weren&#x2019;t all exterminated. Instead, Ringo made them rulers. It makes for a good story, but I just didn&#x2019;t find it believable at all. The books are still good, but the belief suspension required to go on with the story is annoying.  On a more personal note, I think Ringo is also a right winged red necked nutcase. A great author, admittedly, but I find it hard sometimes to not get annoyed about some of the perspectives that I see in the book.   Weber, on the other hand, is great in portraying navies. And I love reading his fight scenes. Mostly because he knows where to put them and how much to stretch them. He also put an amazing amount of depth into the worlds he create in surprisingly little brush strokes.   He does have a few themes that I also find fairly annoying. Chief among them, while not as annoying as having stupid enemies (which he have to some amount as well), is having the &#x201C;good&#x201D; side have amazingly good information about the other. Or have one side significantly better armed than the other. Sure it make it easy to make the good guys win, but I like a more realistic scenario.  His recent books in the Honor Harrington universe has portrayed exactly such a scenario and have been a pleasure to read. Beyond anything else, he knows how to give a depth to his universe, and his characters are well polished and likable. I can&#x2019;t think of a scenario where a character has behaved in a way that I would consider wrong.   Weber is currently my favorite author, and I am eagerly waiting for Torch of Freedom in November.  But hands down, the best series is the Prince Roger series, on which they collaborated. This is a tale that has both Weber&#x2019;s depth in creating a universe and Ringo&#x2019;s touch for portraying military people. I wish there would be more books there.</p>
        </article>
        <article id="article-5706">
            <a href="https://ayende.com/blog/4137/nhibernate-perf-tricks" target="_blank">
                <h2 class="title mb-6" id="article-5706">NHibernate Perf Tricks</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 22, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I originally titled this post NHibernate Stupid Perf Tricks, but decided to remove that. The purpose of this post is to show some performance optimizations that you can take advantage of with NHibernate. This is not a benchmark, the results aren&#x2019;t useful for anything except comparing to one another. I would also like to remind you that NHibernate isn&#x2019;t intended for ETL scenarios, if you desire that, you probably want to look into ETL tools, rather than an OR/M developed for OLTP scenarios.  There is a wide scope for performance improvements outside what is shown here, for example, the database was not optimized, the machine was used throughout the benchmark, etc.  To start with, here is the context in which we are working. This will be used to execute the different scenarios that we will execute.  The initial system configuration was:     &lt;hibernate-configuration xmlns=&quot;urn:nhibernate-configuration-2.2&quot;&gt;&#xA;  &lt;session-factory&gt;&#xA;    &lt;property name=&quot;dialect&quot;&gt;NHibernate.Dialect.MsSql2000Dialect&lt;/property&gt;&#xA;    &lt;property name=&quot;connection.provider&quot;&gt;NHibernate.Connection.DriverConnectionProvider&lt;/property&gt;&#xA;    &lt;property name=&quot;connection.connection_string&quot;&gt;&#xA;      Server=(local);initial catalog=shalom_kita_alef;Integrated Security=SSPI&#xA;    &lt;/property&gt;&#xA;    &lt;property name=&#x27;proxyfactory.factory_class&#x27;&gt;&#xA;&#x9;NHibernate.ByteCode.Castle.ProxyFactoryFactory, NHibernate.ByteCode.Castle&#xA;     &lt;/property&gt;&#xA;    &lt;mapping assembly=&quot;PerfTricksForContrivedScenarios&quot; /&gt;&#xA;  &lt;/session-factory&gt;&#xA;&lt;/hibernate-configuration&gt;&#xA;&#xA;&#xA;The model used was:&#xA;&#xA;&#xA;  &#xA0;&#xA;&#xA;&#xA;And the mapping for this is:&#xA;&#xA;&#xA;  &lt;class name=&quot;User&quot;&#xA;&#x9;&#x9;&#x9; table=&quot;Users&quot;&gt;&#xA;&#x9;&lt;id name=&quot;Id&quot;&gt;&#xA;&#x9;&#x9;&lt;generator class=&quot;hilo&quot;/&gt;&#xA;&#x9;&lt;/id&gt;&#xA;&#xA;&#x9;&lt;property name=&quot;Password&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;Username&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;Email&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;CreatedAt&quot;/&gt;&#xA;&#x9;&lt;property name=&quot;Bio&quot;/&gt;&#xA;&#xA;&lt;/class&gt;&#xA;&#xA;&#xA;And each new user is created using:&#xA;&#xA;&#xA;  public static User GenerateUser(int salt)&#xA;{&#xA;&#x9;return new User&#xA;&#x9;{&#xA;&#x9;&#x9;Bio = new string(&#x27;*&#x27;, 128),&#xA;&#x9;&#x9;CreatedAt = DateTime.Now,&#xA;&#x9;&#x9;Email = salt &#x2B; &quot;@example.org&quot;,&#xA;&#x9;&#x9;Password = Guid.NewGuid().ToByteArray(),&#xA;&#x9;&#x9;Username = &quot;User &quot; &#x2B; salt&#xA;&#x9;};&#xA;}&#xA;&#xA;&#xA;Our first attempt is to simply check serial execution speed, and I wrote the following (very trivial) code to do so.&#xA;&#xA;&#xA;  const int count = 500 * 1000;&#xA;var configuration = new Configuration()&#xA;&#x9;.Configure(&quot;hibernate.cfg.xml&quot;);&#xA;new SchemaExport(configuration).Create(false, true);&#xA;var sessionFactory = configuration&#xA;&#x9;.BuildSessionFactory();&#xA;&#xA;var stopwatch = Stopwatch.StartNew();&#xA;&#xA;for (int i = 0; i &lt; count; i&#x2B;&#x2B;)&#xA;{&#xA;&#x9;using(var session = sessionFactory.OpenSession())&#xA;&#x9;using(var tx = session.BeginTransaction())&#xA;&#x9;{&#xA;&#x9;&#x9;session.Save(GenerateUser(i));&#xA;&#x9;&#x9;tx.Commit();&#xA;&#x9;}&#xA;&#xA;}&#xA;&#xA;Console.WriteLine(stopwatch.ElapsedMilliseconds);&#xA;&#xA;&#xA;Note that we create a separate session for each element. This is probably the slowest way of doing things, since it means that we significantly increase the number of connections open/close and transactions that we need to handle.&#xA;&#xA;This is here to give us a base line on how slow we can make things, to tell you the truth. Another thing to note that this is simply serial. This is just another example of how this is not a true representation of how things happen in the real world. In real world scenarios, we are usually handling small requests, like the one simulated above, but we do so in parallel. We are also using a local database vs. the far more common remote DB approach which skew results ever furhter.&#xA;&#xA;Anyway, the initial approach took: 21.1 minutes, or roughly a row every two and a half milliseconds, about 400 rows / second.&#xA;&#xA;I am pretty sure most of that time went into connection &amp; transaction management, though.&#xA;&#xA;So the first thing to try was to see what would happen if I would do that using a single session, that would remove the issue of opening and closing the connection and creating lots of new transactions.&#xA;&#xA;The code in question is:&#xA;&#xA;&#xA;  using (var session = sessionFactory.OpenSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;for (int i = 0; i &lt; count; i&#x2B;&#x2B;)&#xA;&#x9;{&#xA;&#x9;&#x9;session.Save(GenerateUser(i));&#xA;&#x9;}&#xA;&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;I expect that this will be much faster, but I have to explain something. It is usually not recommended to use the session for doing bulk operations, but this is a special case. We are only saving new instances, so the flush does no unnecessary work and we only commit once, so the save to the DB is done in a single continuous stream.&#xA;&#xA;This version run for 4.2 minutes, or roughly 2 rows per millisecond about 2,000 rows / second.&#xA;&#xA;Now, the next obvious step is to move to stateless session, which is intended for bulk scenarios. How much would this take?&#xA;&#xA;&#xA;  using (var session = sessionFactory.OpenStatelessSession())&#xA;using (var tx = session.BeginTransaction())&#xA;{&#xA;&#x9;for (int i = 0; i &lt; count; i&#x2B;&#x2B;)&#xA;&#x9;{&#xA;&#x9;&#x9;session.Insert(GenerateUser(i));&#xA;&#x9;}&#xA;&#x9;tx.Commit();&#xA;}&#xA;&#xA;&#xA;As you can see, the code is virtual identical. And I expect the performance to be slightly improved but on par with the previous version.&#xA;&#xA;This version run at 2.9 minutes, about 3 rows per millisecond and close to 2,800 rows / second.&#xA;&#xA;I am actually surprised, I expected it to be faster, but it was much faster.&#xA;&#xA;There are still performance optimizations that we can make, though. NHibernate has a rich batching system that we can enable in the configuration:&#xA;&#xA;&#xA;  &lt;property name=&#x27;adonet.batch_size&#x27;&gt;100&lt;/property&gt;&#xA;&#xA;&#xA;With this change, the same code (using stateless sessions) runs at: 2.5 minutes and at 3,200 rows / second.&#xA;&#xA;This doesn&#x2019;t show as much improvement as I hoped it would. This is an example of how a real world optimization is actually failing to show its promise in a contrived example. The purpose of batching is to create as few remote calls as possible, which dramatically improve performance. Since we are running on a local database, it isn&#x2019;t as noticeable.&#xA;&#xA;Just to give you some idea about the scope of what we did, we wrote 500,000 rows and 160MB of data in a few minutes. &#xA;&#xA;Now, remember, those aren&#x2019;t numbers you can take to the bank, their only usefulness is to know that by a few very simple acts we improved performance in a really contrived scenario by 90% or so. And yes, there are other tricks that you can utilize (preparing commands, increasing the batch size, parallelism, etc). I am not going to try to outline then, though. For the simple reason that performance should be quite enough for everything who is using an OR/M. That bring me back to me initial point, OR/M are not about bulk data manipulations, if you want to do that, there are better methods.&#xA;&#xA;For the scenario outlined here, you probably want to make use of SqlBulkCopy, or the equivalent for doing this. Just to give you an idea about why, here is the code:&#xA;&#xA;&#xA;  var dt = new DataTable(&quot;Users&quot;);&#xA;dt.Columns.Add(new DataColumn(&quot;Id&quot;, typeof(int)));&#xA;dt.Columns.Add(new DataColumn(&quot;Password&quot;, typeof(byte[])));&#xA;dt.Columns.Add(new DataColumn(&quot;Username&quot;));&#xA;dt.Columns.Add(new DataColumn(&quot;Email&quot;));&#xA;dt.Columns.Add(new DataColumn(&quot;CreatedAt&quot;, typeof(DateTime)));&#xA;dt.Columns.Add(new DataColumn(&quot;Bio&quot;));&#xA;&#xA;for (int i = 0; i &lt; count; i&#x2B;&#x2B;)&#xA;{&#xA;&#x9;var row = dt.NewRow();&#xA;&#x9;row[&quot;Id&quot;] = i;&#xA;&#x9;row[&quot;Password&quot;] = Guid.NewGuid().ToByteArray();&#xA;&#x9;row[&quot;Username&quot;] =&quot;User &quot; &#x2B; i;&#xA;&#x9;row[&quot;Email&quot;] = i &#x2B; &quot;@example.org&quot;;&#xA;&#x9;row[&quot;CreatedAt&quot;] =DateTime.Now;&#xA;&#x9;row[&quot;Bio&quot;] =  new string(&#x27;*&#x27;, 128);&#xA;&#x9;dt.Rows.Add(row);&#xA;}&#xA;&#xA;using (var connection = ((ISessionFactoryImplementor)sessionFactory).ConnectionProvider.GetConnection())&#xA;{&#xA;&#x9;var s = (SqlConnection)connection;&#xA;&#x9;var copy = new SqlBulkCopy(s);&#xA;&#x9;copy.BulkCopyTimeout = 10000;&#xA;&#x9;copy.DestinationTableName = &quot;Users&quot;;&#xA;&#x9;foreach (DataColumn column in dt.Columns)&#xA;&#x9;{&#xA;&#x9;&#x9;copy.ColumnMappings.Add(column.ColumnName, column.ColumnName);&#xA;&#x9;}&#xA;&#x9;copy.WriteToServer(dt);&#xA;}&#xA;&#xA;&#xA;And this ends up in 49 seconds, or about 10,000 rows / second.&#xA;&#xA;&#xA;&#xA;Use the appropriate tool for the task.&#xA;&#xA;But even so, getting to 1/3 of the speed of SqlBulkCopy (the absolute top speed you can get to) is nothing to sneeze at.</p>
        </article>
        <article id="article-5707">
            <a href="https://ayende.com/blog/4136/how-to-lose-respect-and-annoy-people" target="_blank">
                <h2 class="title mb-6" id="article-5707">How to lose respect and annoy people</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 21, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This post is going to be short, because I don&#x2019;t think that at my current state of mind, I should be posting anything that contain any opinions. This is a reply to a blog post from X-tensive titled: Why I don&#x27;t believe Oren Eini, which is a reply to my posts about the ORMBattle.NET nonsense benchmarks.  I will just say that if I was willing to let X-tensive enjoy the benefit of the doubt the reason they run the benchmarks the way they did, the post has made it all too clear that doubt shouldn&#x2019;t be entertained.  Here are a few quotes from the post that I will reply too.     I confirm this is achieved mainly because of automatic batching of CUD sequences. It allows us to outperform frameworks without this feature by 2-3 times on CUD tests. So I expect I will never see this feature implemented in NHibernate.   That is interesting, NHibernate has batching support since 2006. The tests that X-tensive did never even bother to configure NHibernate to use batching. For that matter, they didn&#x2019;t even bother to do the most cursory check. Googling NHibernate Batching gives you plenty of information about this feature.     Currently (i.e. after all the fixes) NHibernate is 8-10 times slower than EF, Lightspeed and our own product on this test.   Yes, for a test that was explicitly contrived to show that.     Since we track performance on our tests here, we&#x27;ll immediately see, if any of these conditions will be violated. And if this ever happen, I expect Oren must at least publicly apologize for his exceptional rhino obstinacy ;)   Um, no, I don&#x2019;t think so. Moreover, not that I think that it would do much good, but I still think that personal attacks are NOT cool. And no, a smiley isn&#x2019;t going to help, not is something like this:     P.S. Guys, nothing personal.</p>
        </article>
        <article id="article-5708">
            <a href="https://ayende.com/blog/4135/nh-prof-error-handling-continuous-integration-and-rtm-per-commit" target="_blank">
                <h2 class="title mb-6" id="article-5708">NH Prof, Error Handling, Continuous Integration and RTM per commit</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 21, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the nice things about NH Prof is the way that it is setup from an infrastructure stand point. Take a look at the following email:     I got this email, along with an additional one containing the actual crash information (this email is generated from the user&#x2019;s input about the reason for NH Prof crashing).  This isn&#x2019;t the first time that I get this bug (it is an annoying threading issue) but this time I was able to finally pinpoint the exact place where this is happening, trace it back to where it is used and get to the slap-fore-head-OMG-I-am-stupid moment.  Then it was adding a few locks, refactoring to make it clean, and commit.  At this point, my work is done. We have a CI infrastructure that will compile everything, run the tests and push it out as a released build.  With NH Prof, we take the stance that every single commit is a release. Sometimes we will do some work on branches, but most of the work is done on the trunk, and any commit to the trunk result in a new released build.  Out of close to 400 builds that we have so far, I believe that we had about 5 &#x2013; 10 lemons (builds that fail on user&#x2019;s machines). In all cases, it was fixed within a few hours.  The implications for me are huge. I don&#x2019;t have to worry about managing things. I set it up once (sometimes in December or November, if I recall correctly) and stopped worrying about releasing stuff.  And it means that I can literally fix a bug, commit and tell the user that they can pick up the changes as soon as it is done.</p>
        </article>
        <article id="article-5709">
            <a href="https://ayende.com/blog/4134/help-requests-that-make-me-want-to-cry" target="_blank">
                <h2 class="title mb-6" id="article-5709">Help requests that make me want to cry</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 21, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This showed up on my mail box, with the following text:     When i try to insert an item to db, VS gives a stackoverflow exception. is it because of that i am using generic classes??       I am not going to comment further, I am stepping away from the keyboard and going to have a lie down.</p>
        </article>
        <article id="article-5710">
            <a href="https://ayende.com/blog/4133/a-design-question-what-do-you-do-with-inaccurate-data" target="_blank">
                <h2 class="title mb-6" id="article-5710">A design question: What do you do with inaccurate data?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: August 20, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I intentionally don&#x2019;t intend to give out enough information about this problem, I want to see what your opinion is.  I have an application where a certain action invalidate some of the data that the user is shown. It is quite expensive to recalculate that data, so we can&#x2019;t just recalculate it right then and there, and in many cases, it will be the exact same data as the user is currently shown.  The question is, what should we do with this data?     Ignore the&#xA0; invalidation and just show the (possibly invalid) data to the user until the application refresh itself normally.    Remove the data all together. However, the lack of the data is already meaningful in the application.    Put some notification that the data is invalid.   I have my own opinions, but I would like to hear what you think we should do&#x2026;</p>
        </article>
        <div class="button flex justify-between">
            <a href="570.html"><span class="back arrow"></span></a>

            <a href="572.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>