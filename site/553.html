
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 553 â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="pagefind/pagefind-ui.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-5521">
            <a href="https://ayende.com/blog/4321/handling-complex-security-conditions-with-rhino-security" target="_blank">
                <h2 class="title mb-6" id="article-5521">Handling complex security conditions with Rhino Security</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 11, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I got an interesting question about handling complex security conditions that I thought would be perfect to illustrate the underlying design principles for Rhino Security.  The problem is securing surveys. A survey has a start date, an end date, can be marked as applicable to a specific population, may be public or private, etc. The specification says that a survey that the user does not own should only be visible to a user iff:     The survey is public     The survey is active     The survey has started     The survey has not ended     The survey is for a population that the user is a member of    Can you imagine the amount of work that is required to set up this sort of rule properly? And apply it consistently all over the application? It is exactly for those sort of scenarios that I created Rhino Security.  Let us see how we are going to design the security infrastructure for the application. We are going to specify the following:     The owning user for a survey is allowed access at a high level:      permissionsBuilderService&#xA;    .Allow(&quot;/Survey&quot;) // allow to do everything on a survey&#xA;    .For(survery.Owner)&#xA;    .On(survey)&#xA;    .Level(10)&#xA;    .Save();&#xA;&#xA;&#xA;  If the survey is for a particular population, that population is created as a user group, and we create a rule that allow that user group access to the survey: &#xA;    permissionsBuilderService&#xA;    .Allow(&quot;/Survey/Vote&quot;)&#xA;    .For(survery.Population.Name) // the user group name&#xA;    .On(survey)&#xA;    .Level(1)&#xA;    .Save();&#xA;   &#xA;&#xA;  The other permissions are specified globally, we need to do an and between all of them, and Rhino Security doesn&#x2019;t give us direct support for that. What we do get, however, is Deny and levels, so we specify those permissions using the following: &#xA;    permissionsBuilderService&#xA;    .Deny(&quot;/Survey/Vote&quot;)&#xA;    .For(&quot;Everyone&quot;) // all users&#xA;    .On(&quot;Inactive Surveys&quot;) // an entity group&#xA;    .Level(6)&#xA;    .Save();&#xA;&#xA;permissionsBuilderService&#xA;    .Deny(&quot;/Survey/Vote&quot;)&#xA;    .For(&quot;Everyone&quot;) // all users&#xA;    .On(&quot;Private Surveys&quot;) // an entity group&#xA;    .Level(6)&#xA;    .Save();&#xA;&#xA;permissionsBuilderService&#xA;    .Deny(&quot;/Survey/Vote&quot;)&#xA;    .For(&quot;Everyone&quot;) // all users&#xA;    .On(&quot;Completed Surveys&quot;) // an entity group&#xA;    .Level(6)&#xA;    .Save();&#xA;&#xA;permissionsBuilderService&#xA;    .Deny(&quot;/Survey/Vote&quot;)&#xA;    .For(&quot;Everyone&quot;) // all users&#xA;    .On(&quot;Unstarted Surveys&quot;) // an entity group&#xA;    .Level(6)&#xA;    .Save();&#xA;  &#xA;&#xA;&#xA;Now, that we have set it up, what we need to do now is to add and remove the survey to the appropriate entity groups, based on whatever business conditions that we have. Note that those are explicit state transitions. This isn&#x2019;t just us setting IsActive and IsPublic flag, or verifying date ranges. We have to take explicit action to add and remove the entities from the appropriate groups.&#xA;&#xA;There are two reasons of doing things in this way, the first, it make it significantly easier to handle security, since we don&#x2019;t have murky rules or implicit state transitions. Second, from a design standpoint, it leads to a situation where we don&#x2019;t work with just dump objects and queries, but meaningful transitions between states.&#xA;&#xA;Yes, that does implies that you would have to have some sort of a background process to move surveys between groups based on time. That is a good thing, but I talked about this in another post.</p>
        </article>
        <article id="article-5522">
            <a href="https://ayende.com/blog/4320/what-should-i-work-on-next" target="_blank">
                <h2 class="title mb-6" id="article-5522">What should I work on next?</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 10, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">As we near completion with EF Prof, I am starting to think about what the next project* would be. I got some ideas, but I would like to see what you think.    Note that I won&#x2019;t necessarily follow this, but it would be a good indication about where to proceed.   A small explanation about the choices:     Entity Framework Caching Layer is an idea about adding 2nd level caching (similar to the way NHibernate is doing this) to EF, giving you transparent caching integrated into Entity Framework.    Production Profiling means that you&#x2019;ll be able to connect to a production application with the profiler and see what statements it is executing, without paying any performance price when you are not connected.    LLBLGen Prof &#x2013; as the name says, adding a new profiler profile that would support LLBLGen    DAL Prof &#x2013; this is interesting, instead of supporting a specific product, this is meant for users who have a custom DAL, but still want to get the profiler benefits.   And anything else that you might want to suggest.     * Please note that all options discussed here are commercial ones.</p>
        </article>
        <article id="article-5523">
            <a href="https://ayende.com/blog/4319/entity-framework-profiler-the-new-look" target="_blank">
                <h2 class="title mb-6" id="article-5523">Entity Framework Profiler: The new look</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 10, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This is hot off the press (well, off of Christopher&#x2019;s desk, at the very least).     If all goes well, we will have it out in public beta shortly.</p>
        </article>
        <article id="article-5524">
            <a href="https://ayende.com/blog/4318/nh-prof-new-feature-filter-static-files" target="_blank">
                <h2 class="title mb-6" id="article-5524">NH Prof new feature</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 10, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">One of the most annoying things about doing the TekPub episodes is finding the right session, because NH Prof will detect any session opening. This means that it usually looks like this:     Which also means that it is pretty hard to figure out. I got annoyed enough with that to add a specific filter to filter all of those in one shot (you could already do it, but it meant creating several filters):        Which results in a much better experience:</p>
        </article>
        <article id="article-5525">
            <a href="https://ardalis.com/joining-the-code-project/" target="_blank">
                <h2 class="title mb-6" id="article-5525">Joining The Code Project</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 09, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Those of you who follow my blog (both of you) may have noticed an absence of posts of late. The reason for the lapse was simple: Michelle&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-5526">
            <a href="https://ayende.com/blog/4317/if-you-want-me-to-buy-something-i-want-a-queue-damn-it" target="_blank">
                <h2 class="title mb-6" id="article-5526">If you want me to buy something, I want a queue, damn it!</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 09, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">And no, I don&#x2019;t mean a queue in the technical sense, I don&#x2019;t care how you build your stuff. What I care about is the customer experience.  Here is a simple problem, I go to your site and see three things that I would like to buy, but I am only going to buy one thing right now. In most cases, I have no real way of putting away those things that I am interested at to a later time.  A common examples, both of which are really annoying: Amazon Kindle.  I usually buy books after spending some time looking for them, which takes time. But I generally don&#x2019;t buy more than one Kindle book at a time, simply because I often get distracted by something else and skip reading the second or third book in a particular order. So something that I would have loved to see is a way to put away a book for later. You know, something like a wish list? Except that those aren&#x2019;t available for Kindle for some strange reason (probably someone figured out that immediate satisfaction negates them).  I am left with tracking this sort of stuff externally, and that just add more work. If you want me to buy something, make it easier for me to do so. And I want to come back later, you really want to make it easier.</p>
        </article>
        <article id="article-5527">
            <a href="https://ayende.com/blog/4316/time-transitions-should-be-explicit" target="_blank">
                <h2 class="title mb-6" id="article-5527">Time transitions should be explicit</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 08, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Let us talk about time for a second, okay? We deal with in just about every application we write, but we treat it quite dismissively. But let me give an example first. We need to build a notification system, the system is based on timed notifications that should be displayed in a web page.   Thinking about it, I came up with the following design:     And this query:     SELECT TOP 3 Id, PublishAt, Title, Content FROM Notifications&#xA;WHERE PublishAt &gt; GETDATE()&#xA;ORDER BY PublishAt DESC&#xA;&#xA;&#xA;&#xA;That seems to satisfy the requirements, it is simple and it works. Done.&#xA;&#xA;Not quite, this system design suffer from a pretty important problem, the time transitions are implicit. But why is that important?&#xA;&#xA;Because the state transition from waiting-to-be-published and published is a meaningful transition in our domain. As a simple example, I can&#x2019;t post a notification to Twitter when a notification is published, simply because I have absolutely no idea when that is going to happen. In many real applications, silent state transitions are going to lead to a lot of hacks. Likely something like adding WasPublished flag that we can check and then do some action if we get a notification that wasn&#x2019;t published yet.&#xA;&#xA;A much better plan is to model things so that time is an explicit state transition, instead of just checking for PublishAt, we will check the IsPublished flag, and we have a background process that will check for the PublishAt and the current date and explicitly set the IsPublished flag. That is also the place where we will place logic relating to the state transition. It also means that we aren&#x2019;t depending on a side affect (someone viewing the page to cause the publication process) to make something important happen in our application.&#xA;&#xA;You might have noticed a theme here, I like making things explicit, it means that it is easier to handle them.</p>
        </article>
        <article id="article-5528">
            <a href="https://ayende.com/blog/4315/building-a-recommendation-engine-in-nhibernate" target="_blank">
                <h2 class="title mb-6" id="article-5528">Building a recommendation engine in NHibernate</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 07, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Well, it isn&#x2019;t really a recommendation engine, it is a sample of one, and I strongly recommend not using it, but I am getting ahead of myself.  In the 6th episode of the TekPub&#x2019;s NHibernate webcast, me &amp; Rob worked on creating statistical queries with NHibernate. To be totally honest, the reason that we did that is to show off NHibernate&#x2019;s querying capabilities, not so you would be able to make use of this in your applications. A recommendation engine is not something that you should run out of your OLTP store, so please take that under advisement.  The reason for this post is to explain in details how the final result works. Here is the NHibernate code:  var orderIDsContainingCurrentSku = DetachedCriteria.For&lt;OrderItem&gt;()&#xA;            .Add&lt;OrderItem&gt;(x=&gt;x.Product.SKU==sku)&#xA;            .SetProjection(Projections.Property(&quot;Order.id&quot;));&#xA;&#xA;var skusOfProductsAppearingInOrdersContainingCurrentSku = DetachedCriteria.For&lt;OrderItem&gt;()&#xA;    .SetProjection(Projections.GroupProperty(&quot;Product.id&quot;))&#xA;    .AddOrder(NHibernate.Criterion.Order.Desc(Projections.Count(&quot;Order.id&quot;)))&#xA;    .Add&lt;OrderItem&gt;(x=&gt;x.Product.SKU!=sku)&#xA;    .Add(Subqueries.PropertyIn(&quot;Order.id&quot;, orderIDsContainingCurrentSku))&#xA;    .SetMaxResults(15);&#xA;&#xA;&#xA;var recommended = _session.CreateCriteria&lt;Product&gt;()&#xA;    .SetFetchMode&lt;Product&gt;(x =&gt; x.Descriptors, FetchMode.Join)&#xA;    .Add(Subqueries.PropertyIn(&quot;id&quot;, skusOfProductsAppearingInOrdersContainingCurrentSku))&#xA;    .SetResultTransformer(Transformers.DistinctRootEntity)&#xA;    .List&lt;Product&gt;();&#xA;&#xA;&#xA;And here is the resulting SQL:&#xA;&#xA;SELECT this_.SKU                 as SKU1_1_,&#xA;       this_.ProductName         as ProductN2_1_1_,&#xA;       this_.BasePrice           as BasePrice1_1_,&#xA;       this_.WeightInPounds      as WeightIn4_1_1_,&#xA;       this_.DateAvailable       as DateAvai5_1_1_,&#xA;       this_.EstimatedDelivery   as Estimate6_1_1_,&#xA;       this_.AllowBackOrder      as AllowBac7_1_1_,&#xA;       this_.IsTaxable           as IsTaxable1_1_,&#xA;       this_.DefaultImageFile    as DefaultI9_1_1_,&#xA;       this_.AmountOnHand        as AmountO10_1_1_,&#xA;       this_.AllowPreOrder       as AllowPr11_1_1_,&#xA;       this_.DeliveryMethodID    as Deliver12_1_1_,&#xA;       this_.InventoryStatusID   as Invento13_1_1_,&#xA;       descriptor2_.SKU          as SKU3_,&#xA;       descriptor2_.DescriptorID as Descript1_3_,&#xA;       descriptor2_.DescriptorID as Descript1_4_0_,&#xA;       descriptor2_.Title        as Title4_0_,&#xA;       descriptor2_.Body         as Body4_0_&#xA;FROM   Products this_&#xA;       left outer join ProductDescriptors descriptor2_&#xA;         on this_.SKU = descriptor2_.SKU&#xA;WHERE  this_.SKU in (SELECT   top 15 this_0_.SKU as y0_&#xA;                     FROM     OrderItems this_0_&#xA;                     WHERE    not (this_0_.SKU = &#x27;Binoculars2&#x27; /* @p0 */)&#xA;                              and this_0_.OrderID in (SELECT this_0_0_.OrderID as y0_&#xA;                                                      FROM   OrderItems this_0_0_&#xA;                                                      WHERE  this_0_0_.SKU = &#x27;Binoculars2&#x27; /* @p1 */)&#xA;                     GROUP BY this_0_.SKU&#xA;                     ORDER BY count(this_0_.OrderID) desc)&#xA;&#xA;&#xA0;&#xA;&#xA;The problem is that both the NHibernate code and the SQL are pretty complicated, and mapping between the two might be pretty hard if you are not familiar with that. So let us take this in stages. First, let us understand the logic in the SQL itself. Most of the complexity happens in the where clause, so let us look at this in depth:&#xA;&#xA;WHERE  this_.SKU in (SELECT   top 15 this_0_.SKU as y0_&#xA; FROM     OrderItems this_0_&#xA; WHERE    not (this_0_.SKU = &#x27;Binoculars2&#x27; /* @p0 */)&#xA;          and this_0_.OrderID in (SELECT this_0_0_.OrderID as y0_&#xA;                  FROM   OrderItems this_0_0_&#xA;                  WHERE  this_0_0_.SKU = &#x27;Binoculars2&#x27; /* @p1 */)&#xA; GROUP BY this_0_.SKU&#xA; ORDER BY count(this_0_.OrderID) desc)&#xA;&#xA;&#xA;What exactly is going on in here?&#xA;&#xA;Let us look at the nested most select, this select the OrderId from an order that have a Binoculars item in it. That is then passed to the parent select, matching it to that OrderID and returning the SKU if it is not also a Binoculars.&#xA;&#xA;What we are actually saying here is: Give me all the items from orders that contains Binoculars, except for Binoculars. The logic is simple, you are very likely to buy something that someone else also bought in an order together with stuff that you bought (complimentary products, another book in the same series, etc). Next, we have the order by, we use that to find the stuff that you are most likely to buy. By ordering the items based on the number of orders they appear in, we try to find the most popular items (hence, the stuff that you are likely to buy as well).&#xA;&#xA;I think that this is fairly clear, and now that we have the logic of the statement, let us try to understand how that NHibernate code produced it. &#xA;&#xA;The answer is actually very simple, NHibernate&#x2019;s Criteria API is all about composability. We simply composed the query from all the tiny pieces. Let us look at each individual piece in detail:&#xA;&#xA;var orderIDsContainingCurrentSku = DetachedCriteria.For&lt;OrderItem&gt;()&#xA;            .Add&lt;OrderItem&gt;(x=&gt;x.Product.SKU==sku)&#xA;            .SetProjection(Projections.Property(&quot;Order.id&quot;));&#xA;&#xA;&#xA;This query is using DetachedCriteria, this is a way to generate a query (or a sub query, as we will soon see), without having a direct reference to the session. This is mostly useful in cases like this, where you want to compose several queries into a single one. &#xA;&#xA; In this case, it is pretty obvious what is going on, we ask NHibernate to select from OrderItems (by using the OrderItem entity), where the product sku is equal to the appropriate SKU (Binoculars2, in this case), and we don&#x2019;t want to get the entity back, instead, we want only a single field (this is what SetProjection is for), the order id. Note that OrderItem mapping is quite interesting:&#xA;&#xA;&lt;class name=&quot;OrderItem&quot; table=&quot;OrderItems&quot; &gt;&#xA;  &lt;composite-id&gt;&#xA;      &lt;key-many-to-one name=&quot;Product&quot; column=&quot;SKU&quot;/&gt;&#xA;      &lt;key-many-to-one name=&quot;Order&quot; column=&quot;OrderID&quot;/&gt;&#xA;  &lt;/composite-id&gt;&#xA;&lt;/class&gt;&#xA;&#xA;&#xA;It is a class with a composite id, where each part of the PK is also a FK to a different table. With NHibernate, we map this using &lt;key-many-to-one/&gt; in a composite-id element.&#xA;&#xA;When we want to query on that, we can either use the usual many-to-one approach, or, if we want to refer to a particular column, we use the &#x201C;id&#x201D; (all lower case) keyword. In other words, &#x201C;Order.id&#x201D; refers to the OrderItems.OrderID column, while &#x201C;Product.id&#x201D; or &#x201C;Product.SKU&#x201D; refers to the &#x201C;OrderItems.SKU&#x201D; column. I think that you can figure out what is going on now, this query generate the following SQL:&#xA;&#xA;SELECT this_0_0_.OrderID as y0_&#xA;FROM   OrderItems this_0_0_&#xA;WHERE  this_0_0_.SKU = &#x27;Binoculars2&#x27; /* @p1 */&#xA;&#xA;&#xA;And I think that can see the direct correlation between the NHibernate query and the generated SQL.&#xA;&#xA;Next in line, and seemingly much more complicated, we have this:&#xA;&#xA;var skusOfProductsAppearingInOrdersContainingCurrentSku = DetachedCriteria.For&lt;OrderItem&gt;()&#xA;    .SetProjection(Projections.GroupProperty(&quot;Product.id&quot;))&#xA;    .AddOrder(NHibernate.Criterion.Order.Desc(Projections.Count(&quot;Order.id&quot;)))&#xA;    .Add&lt;OrderItem&gt;(x=&gt;x.Product.SKU!=sku)&#xA;    .Add(Subqueries.PropertyIn(&quot;Order.id&quot;, orderIDsContainingCurrentSku))&#xA;    .SetMaxResults(15);&#xA;&#xA;&#xA;But it isn&#x2019;t really complidated, let us look at this in details. The first line is already familiar for us, asking to select from OrderItems. Next, we use SetProjection again, to select just the &#x201C;Product.id&#x201D;, which is the OrderItems.SKU. Note that we are using something slightly different this time, where before we used Projections.Property, now we use Projections.GroupProperty. What is the difference between the two?&#xA;&#xA;Projection.Property instructs NHibernate to put the matching column in the select clause, while Projection.GroupProperty instructs NHibernate to put the matching column in the select clause and in the group by clause. This is required because on the next line, we are using an aggregate function in the order by clause, aggregate functions must be used in conjunction with the appropriate group by clause. That line also specify that we are using a descending order on the count of the &#x201C;Order.id&#x201D; (which matches OrderItems.OrderID).&#xA;&#xA;The following line is something we are already familiar with, we are adding a where clause to filter the current SKU. And now we get to the interesting part, we use a subquery to match the &#x201C;Order.id&#x201D; to the order ids containing the current SKU. Last, but not least, we limit the number of returned rows to 15. The resulting SQL is:&#xA;&#xA;SELECT   top 15 this_0_.SKU as y0_&#xA;FROM     OrderItems this_0_&#xA;WHERE    not (this_0_.SKU = &#x27;Binoculars2&#x27; /* @p0 */)&#xA;      and this_0_.OrderID in (/* orderIDsContainingCurrentSku */)&#xA;GROUP BY this_0_.SKU&#xA;ORDER BY count(this_0_.OrderID) desc&#xA;&#xA;&#xA;I think that again, once we have gone over this in details, you will agree that there is a pretty simple mapping between the query and the resulting SQL.&#xA;&#xA;Now, let us look at the actual query code, which make use of the previous two subqueries:&#xA;&#xA;var recommended = _session.CreateCriteria&lt;Product&gt;()&#xA;    .SetFetchMode&lt;Product&gt;(x =&gt; x.Descriptors, FetchMode.Join)&#xA;    .Add(Subqueries.PropertyIn(&quot;id&quot;, skusOfProductsAppearingInOrdersContainingCurrentSku))&#xA;    .SetResultTransformer(Transformers.DistinctRootEntity)&#xA;    .List&lt;Product&gt;();&#xA;&#xA;&#xA;We create a standard criteria query, ask it to eager load the Descriptors, then we perform a subquery, matching the product &#x201C;id&#x201D; (when specified using all lower case it is an NHibernate keyword referencing the current entity&#x2019;s PK column) to the skus of products that appear in orders contains the current sku. Because we used a join to eager load the descriptors, we need to specify SetResultTransofer so we will get only distinct root entities.&#xA;&#xA;All in all, when you break it up to pieces like that, I don&#x2019;t think that it is an overly complex process. The query we were trying to get to is by no means a simple one, but we didn&#x2019;t have any additional complexity when trying to create it using NHibernate.</p>
        </article>
        <article id="article-5529">
            <a href="https://ayende.com/blog/4314/resharper-is-amazing-take-n" target="_blank">
                <h2 class="title mb-6" id="article-5529">Resharper is amazing, take N</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 06, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I am trying out R# 5.0, and I accidently stumbled upon an awesome feature.   Let us say that you Ctrl&#x2B;Click the int.ToString() method:     In previous versions of R#, that would take you to the Object Explorer, which is useful enough, but R# does something far more awesome.  I didn&#x2019;t realize at first what was going on, first it popped up this thingie:     And then it asked me to accept a license:     But then it actually showed me the real code that is behind int.ToString(). This is not Reflector trick, this is the real source code that made it into the framework:         Now, this is basically just integrating Symbol Server &amp; Source Server, both of which have been available for a while now, but making this so easy is something that is huge!</p>
        </article>
        <article id="article-5530">
            <a href="https://ayende.com/blog/4313/nhibernate-is-on-the-cover-of-msdn-magazine" target="_blank">
                <h2 class="title mb-6" id="article-5530">NHibernate is on the cover of MSDN Magazine</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: December 05, 2009
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A while ago I run a poll about what posts you would like me to do, and the most requested topic was handling NHibernate in a Desktop application. I started writing a blog post about it, but when it hit twenty pages, I thought better on that and decided that I might as well post that as an article. MSDN Magazine just did.  You can read the about Building a Desktop To-Do Application with NHibernate in the latest issue of MSDN Magazine.  And now that the article is out, I can start posting about other topic in the code base that are pretty interesting as well.</p>
        </article>
        <div class="button flex justify-between">
            <a href="552.html"><span class="back arrow"></span></a>

            <a href="554.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="pagefind/pagefind-ui.js"></script>
</body>
</html>