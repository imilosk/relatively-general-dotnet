
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Home â€¢ Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<script>
    const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

    function getUserPref() {
        const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
        return storedTheme || (lightModePref.matches ? "light" : "dark");
    }

    function setTheme(newTheme) {
        if (newTheme !== "light" && newTheme !== "dark") {
            return console.warn(
                `Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
            );
        }

        const root = document.documentElement;

        // root already set to newTheme, exit early
        if (newTheme === root.getAttribute("data-theme")) {
            return;
        }

        root.setAttribute("data-theme", newTheme);

        const colorThemeMetaTag = document.querySelector("meta[name='theme-color']");
        const bgColour = getComputedStyle(document.body).getPropertyValue("--theme-bg");
        colorThemeMetaTag.setAttribute("content", `hsl(${bgColour})`);
        if (typeof localStorage !== "undefined") {
            localStorage.setItem("theme", newTheme);
        }
    }

    // initial setup
    setTheme(getUserPref());

    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("theme-toggle").addEventListener("click", () => {
            const theme = localStorage.getItem("theme");

            if (theme === "dark") {
                setTheme("light");
            } else {
                setTheme("dark");
            }
        });

        document.getElementById("toggle-navigation-menu").addEventListener("click", (e) => {
            const button = e.target;
            const ariaExpanded = button.getAttribute("aria-expanded");
            const header = document.getElementById("main-header");

            if (ariaExpanded === "true") {
                button.setAttribute("aria-expanded", "false");
                header.classList.remove("menu-open");
            } else {
                button.setAttribute("aria-expanded", "true");
                header.classList.add("menu-open");
            }
        });
    });
</script>

<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
               href="index.html"> Home </a><a
                class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" href="/about/">
                About </a>
        </nav>
    </div>
    <theme-toggle class="ms-auto">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>
<main id="main">
    <section aria-label="Blog post list">
        <a href="https://ardalis.com/2013-software-craftsmanship-calendar/" target="_blank"><h1 class="title mb-6">2013 Software Craftsmanship Calendar</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: November 16, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">It&#x2019;s that time of year again when Software Craftsmanship wall calendars are shipping out of our Hudson office. A few things are different&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ayende.com/blog/159937/production-issue-asp-net-cache-kills-the-application" target="_blank"><h1 class="title mb-6">Production issue: ASP.Net Cache kills the application</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: November 16, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In one of our production deployments, we occasionally get a complete server process crash. Investigating the event log, we have this:&#xA;&#xA;&#x9;&#xA;&#x9;&#x9;Exception: System.InvalidOperationException&#xA;&#x9;&#xA;&#x9;&#x9;Message: Collection was modified; enumeration operation may not execute.&#xA;&#x9;&#xA;&#x9;&#x9;StackTrace:&#xA0;&#xA0;&#xA0; at System.Collections.Generic.Dictionary`2.KeyCollection.Enumerator.MoveNext()&#xA;&#x9;&#xA;&#x9;&#x9;&#xA0;&#xA0; at System.Web.Hosting.ObjectCacheHost.TrimCache(Int32 percent)&#xA;&#x9;&#xA;&#x9;&#x9;&#xA0;&#xA0; at System.Web.Hosting.HostingEnvironment.TrimCache(Int32 percent)&#xA;&#x9;&#xA;&#x9;&#x9;&#xA0;&#xA0; at System.Web.Hosting.HostingEnvironment.TrimCache(Int32 percent)&#xA;&#x9;&#xA;&#x9;&#x9;&#xA0;&#xA0; at System.Web.Hosting.ApplicationManager.TrimCaches(Int32 percent)&#xA;&#x9;&#xA;&#x9;&#x9;&#xA0;&#xA0; at System.Web.Hosting.CacheManager.CollectInfrequently(Int64 privateBytes)&#xA;&#x9;&#xA;&#x9;&#x9;&#xA0;&#xA0; at System.Web.Hosting.CacheManager.PBytesMonitorThread(Object state)&#xA;&#x9;&#xA;&#x9;&#x9;&#xA0;&#xA0; at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean ignoreSyncCtx)&#xA;&#x9;&#xA;&#x9;&#x9;&#xA0;&#xA0; at System.Threading._TimerCallback.PerformTimerCallback(Object state)&#xA;&#xA;&#xA;&#x9;As you can see, this is a case of what appears to be a run of the mill race condition, translated to a process killing exception because it was thrown from a separate thread.&#xA;&#xA;&#x9;This thread, by the way, is the ASP.Net Cache cleanup thread, and we have no control whatsoever over that. To make things worse, this application doesn&#x2019;t even use the ASP.NET Cache in any way shape or form.&#xA;&#xA;&#x9;Any ideas how to resolve this would be very welcome.</p>
        <a href="https://ayende.com/blog/159841/design-patterns-in-the-test-of-time-chain-of-responsibility" target="_blank"><h1 class="title mb-6">Design patterns in the test of time</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: November 16, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">The chain-of-responsibility pattern is a design pattern consisting of a source of command objects and a series of processing objects. Each processing object contains logic that defines the types of command objects that it can handle; the rest are passed to the next processing object in the chain. A mechanism also exists for adding new processing objects to the end of this chain.  More about this pattern. It is actually quite common to see this pattern now-a-days using events. Something like CancelEventArgs and a CancelEventHandler to handle the FormClosing event of a Form. We use Chain of Responsibility in RavenDB in several places, like this one: foreach (var requestResponderLazy in currentDatabase.Value.RequestResponders)&#xA;{&#xA;  var requestResponder = requestResponderLazy.Value;&#xA;  if (requestResponder.WillRespond(ctx))&#xA;  {&#xA;    var sp = Stopwatch.StartNew();&#xA;    requestResponder.Respond(ctx);&#xA;    sp.Stop();&#xA;    ctx.Response.AddHeader(&quot;Temp-Request-Time&quot;, sp.ElapsedMilliseconds.ToString(&quot;#,# ms&quot;, CultureInfo.InvariantCulture));&#xA;    return requestResponder.IsUserInterfaceRequest;&#xA;  }&#xA;}&#xA;&#xA;&#xA;Note that we have moved on the the behavioral patterns, and those tend to have withstand the test of time much better, in general.&#xA;Other places where Chain of Responsibility is used is request routing and error handling. A common approach is to also have this done by delegating, where I am handling what I can and passing on to the next object if I don&#x2019;t know how to handle a request.&#xA;Recommendation: This is still a very useful pattern. One thing to note is that it is effectively an O(N) operation with respect to the number of items in the chain that you have. As usual, do not overuse, but it is a really nice pattern.</p>
        <a href="https://ayende.com/blog/159809/design-patterns-in-the-test-of-time-proxy" target="_blank"><h1 class="title mb-6">Design patterns in the test of time</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: November 15, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A proxy, in its most general form, is a class functioning as an interface to something else. The proxy could interface to anything: a network connection, a large object in memory, a file, or some other resource that is expensive or impossible to duplicate.  More about this pattern. Proxies are just about everywhere. Whenever you use NHibernate, WCF or Remoting &#x2013; you are using proxies. In fact, proxies are such a success that they are literally baked into both the language and the platform. In .NET we have TransparentProxy and in Java has java.lang.reflect.Proxy. At any rate, proxies are really useful, especially when you think about dynamic proxies. I am far less fond of static proxies, although we use them as well. Dynamic proxies are quite useful to add behavior, especially cross cutting behavior, at very little cost. That said, one of the major issues that arises from using proxies is an inherit assumptions that the proxy is the same as its target. Commonly you see this happening with remote proxies, where it isn&#x2019;t obvious that actually making the call is expensive as hell. Proxies also tend to be used mostly for the infrastructure of your application, rather than for actual application code. In particular, business logic, rather than cross cutting concerns, is really hard to figure out / debug when you have it spread around in proxies. Recommendation: Use it for infrastructure or cross cutting concerns. Try doing so using dynamic proxies, rather than by generating proxies by hand. Avoid putting business logic there and be aware that by using proxies you are hiding what is going on (that is pretty much the point), so doing non obvious things should be avoided.</p>
        <a href="https://ayende.com/blog/159713/design-patterns-in-the-test-of-time-flyweight" target="_blank"><h1 class="title mb-6">Design patterns in the test of time</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: November 14, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A flyweight is an object that minimizes memory use by sharing as much data as possible with other similar objects; it is a way to use objects in large numbers when a simple repeated representation would use an unacceptable amount of memory.  More about this pattern. On the face of it, this patterns looks very much like something from the old ages. And indeed, most implementations of Flyweight are actually focused deeply on low memory conditions. I would actually argue that you need to consider very carefully when you want to do that. That said, it is actually used fairly often in high performance places. In the .NET framework, the notion of string interning is one way to get flywieghts (although the problem is that you need to start with a string to get the intern string sort of mess things up). In both the profilers and in RavenDB, we have used variations on the Flyweight pattern. In the profiler, we are mostly dealing with parsing data from the profiled system, and that means doing a lot of reading from a stream and creating objects. That created an unacceptable memory pressure on the system. We implemented a fairly complex system where we can read from the stream into a buffer, then get or create the string from it. We contributed the implementation back to the Protocol Buffers project. You can see the code here. In RavenDB, we deal a lot with documents, and many times we find it useful to be caching a document. The problem with doing that is that you need to return something from the cache, which means that you have to return something mutable. Instead of copying all of the data all the time, the internal RavenDB data structures supports copy-on-write semantics, which means that we can easily create clones at basically no cost. Recommendation: If you are in a perf optimization mode, and you worry about memory pressure, consider using this. Otherwise, like all optimizations, it should be left alone until you have profiler results that says you should consider this.</p>
        <a href="https://ayende.com/blog/159777/midbook-pattern-crisis-do-not-reach-for-that-pattern" target="_blank"><h1 class="title mb-6">Midbook pattern crisis: Do NOT reach for that pattern</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: November 13, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">From a question in the mailing list:  How do you do to &quot;rollback&quot; an entity state supposing the following scenario.public JsonResult Reschedule(string id, DateTime anotherDate)&#xA;{&#xA;            try&#xA;            {&#xA;                var dinner = session.Load&lt;Dinner&gt;(id);&#xA;                dinner.ChangeDate(anotherDate);&#xA;                schedulerService.Schedule(dinner); &#xA;&#xA;                return Json(new { Message = &quot;Bon apetit!&quot; });&#xA;            }&#xA;            catch (DinnerConcurrencyException ex) &#xA;            {&#xA;                return Json(new { Message = ex.Message });&#xA;            }&#xA;}&#xA;&#xA;// Base controller&#xA;protected void OnActionExecuted(ActionExecutedContext filterContext) &#xA;{&#xA;      if(filterContext.Exception != null)&#xA;            return;&#xA;      session.SaveChanges();&#xA;}&#xA;&#xA;&#xA;&#xA;The problem that I have is when the schedulerService throws a DinnerConcurrencyException, it is catched at the controller.&#xA;After all, the OnActionExecuted will call SaveChanges and persist the dinner with an invalid state.&#xA;The next post was:&#xA;&#xA;I have already tried to use Memento Pattern like this:try&#xA;{&#xA;    var dinner = session.Load&lt;Dinner&gt;(id);&#xA;    dinner.SaveState();&#xA;    dinner.ChangeDate(anotherDate);&#xA;    schedulerService.Schedule(dinner); &#xA;&#xA;    return Json(new { Message = &quot;Bon apetit!&quot; });&#xA;}&#xA;catch (DinnerConcurrencyException ex) &#xA;{&#xA;    dinner = dinner.RestoreState();&#xA;    return Json(new { Message = ex.Message });&#xA;}&#xA;&#xA;&#xA;But didn&#x27;t work, beacuse I think Raven has proxied my dinner instance.&#xA;And here is the Memento implementation:&#xA;[Serializable]&#xA;public abstract class Entity&#xA;{&#xA;    MemoryStream stream = new MemoryStream();&#xA;&#xA;    public void SaveState()&#xA;    {&#xA;        new BinaryFormatter().Serialize(stream, this);&#xA;    }&#xA;&#xA;    public T RestoreState&lt;T&gt;()&#xA;    {&#xA;        stream.Seek(0, SeekOrigin.Begin);&#xA;        object o = new BinaryFormatter().Deserialize(stream);&#xA;        stream.Close();&#xA;&#xA;        return (T)o;&#xA;    }&#xA;}&#xA;&#xA;&#xA;You might notice that this create a new instance when you call RestoreState, and that has no impact whatsoever on the actual instance that is managed by RavenDB.&#xA;The suggested solution?&#xA;catch (DinnerConcurrencyException ex) &#xA;{&#xA;    SkipCallingSaveChanges = true;&#xA;    return Json(new { Message = ex.Message });&#xA;}&#xA;&#xA;&#xA;No need for patterns here.</p>
        <a href="https://ayende.com/blog/159745/midbook-patterns-crisis-facade-is-and-aint" target="_blank"><h1 class="title mb-6">Midbook patterns crisis: Fa&#xE7;ade is and ain&#x2019;t</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: November 12, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I decided to comment to some of the comments in the blog in a full blown post, because they are quite important.  View Model is not a fa&#xE7;ade. It doesn&#x2019;t allow any operation, and it doesn&#x2019;t simplify things. It merely give you an easy access to aggregate information. No, every class is not a Fa&#xE7;ade. I don&#x2019;t care if &#x201C;it provides simplified interface to a larger body of code&#x201D;. If everything is a fa&#xE7;ade, then fa&#xE7;ade is meaningless.  No, Web Request is no a fa&#xE7;ade. Sure, it hides a lot of details about TCP, but that isn&#x2019;t its point. Web Request implements HTTP spec, and that isn&#x2019;t a fa&#xE7;ade at all.  Web Client / Tcp Client / Tcp Listener are facades &#x2013; they drastically simplify how to work with sockets. Good facades, too, because when you need to do more, they don&#x2019;t block you. NHibernate ain&#x2019;t a fa&#xE7;ade &#x2013; it hides ADO.NET, sure, but it also does a lot more then just that. The whole point of this series of posts was not to talk about patterns. If you want to do that, go ahead and read the books. My attempt is to go and talk about how the patterns are actually used. In practice, in real code.  Sure, in the real world, patterns aren&#x2019;t used as per their text book definition. That doesn&#x2019;t mean that we should look at the text book definition. That means that we need to look at how they are actually used! I am not writing a series of posts talking about the problems in the patterns, and that is important. I am writing about the problems in how people use them.</p>
        <a href="https://ardalis.com/javascript-the-good-parts-reviewed/" target="_blank"><h1 class="title mb-6">JavaScript The Good Parts Reviewed</h1></a>
        <p class="mb-2">by Ardalis</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: November 10, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Finished up Douglas Crockford&#x2019;s JavaScript: The Good Parts this week. It definitely helped me improve my understanding of JavaScript, which&#x2026;Keep Reading &#x2192;</p>
        <a href="https://ayende.com/blog/159681/design-patterns-in-the-test-of-time-facade" target="_blank"><h1 class="title mb-6">Design patterns in the test of time</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: November 09, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">A fa&#xE7;ade is an object that provides a simplified interface to a larger body of code, such as a class library.  More about this pattern. The intent of the fa&#xE7;ade was good: to wrap APIs that are poorly designed in something shiny and nice. In the real world, however, it is an evil pattern that is used to needlessly add abstractions for no particular reason. For example, look at this article. &#xA0; That sound you just heard is your architecture, it is hiding in the closet, weeping silent tears about emotional and physical abuse that just doesn&#x2019;t end. I have yet to see a real case were fa&#xE7;ade was actually used properly. In most cases, people built a fa&#xE7;ade because That Is How We Do Things. And because of that, they ended up with things like the one above. It adds exactly nothing, and it horrifyingly complicates the code. Recommendation: Avoid this, you really don&#x2019;t need to do this most of the time, and most implementations are bad.</p>
        <a href="https://ayende.com/blog/159649/ravendb-customers-stories" target="_blank"><h1 class="title mb-6">RavenDB Customers Stories</h1></a>
        <p class="mb-2">by Oren Eini</p>
        <p class="mb-6 flex gap-1.5">
                    <span>
                                    <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                                         xmlns="http://www.w3.org/2000/svg"><path
                                            xmlns="http://www.w3.org/2000/svg"
                                            d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
            posted on: November 08, 2012
        </p>
        <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I just got this from a customer, and I think that it is a great story:  Hi Oren,  I thought you might be interested in a little success story!  At the beginning of the year we began pre-financing a pepper factory in the [redacted]. In order to control the money that we were sending to the factory I created a little Excel spread sheet to keep a record of the payments that we were making. However, some payments were made directly from our head office to the factory, and some were made to us in [redacted] which we in turn transferred to the factory. So I added a few more columns to the spread sheet to record this.  However, the repayment calculations are different depending on whether we make the payment in [redacted] or whether it comes from head office. So I added a few more columns to the spread sheet to calculate this. When the money arrives in [redacted], we need to sell the USD at the Central Bank and convert them into [redacted]. So I added a few more columns to the spread sheet to record this.  However, some of the payments that we are transferring to the factory are from money that we borrow locally in [redacted]. So I added a few more columns to record this.&#xA0; The spread sheet is getting quite big now &#x2013; we&#x2019;re at about 30 columns and there&#x2019;s a lot of horizontal scrolling going on. However, we&#x2019;ve only done about 10 operations, so there are only 10 rows. No big deal if we have to scroll around a bit.  Now the factory has started to receive the product which we paid for in advance. Good idea if I add a column to record this. Shit &#x2013; every five minutes, someone comes to me and asks me to add another column for something or other.  OK &#x2013; these are all distinct operations. When the factory starts to ship out the goods, the first page of the spread sheet is at 45 columns, so I now create a new page in the spread sheet to control the shipments as we receive them. Hmm &#x2013; another 30 columns appear &#x2013; of which about a third of them are just references to the first page, and the rest new data.  Now I realize that it would be nice to control our margin on the entire operation. The spread sheet is shared on SkyDrive so that our offices in [redacted] and [redacted], our accountants, our lawyers, the factory and the freight forwarder can see what is going on. However, I can&#x2019;t allow all of these people to see information about our margins, so I create a new hidden page in the spread sheet.  Boy are we successful &#x2013; we&#x2019;ve now done 50 operations. Can&#x2019;t see the column or row headers any more. No worries, just freeze the columns/headers. Wait a minute &#x2013; who the hell copied and pasted the formulas to the new rows? The numbers aren&#x2019;t adding up any more. Duh &#x2013; why did you put the number for the currency contract in against contract 1234 &#x2013; it should have gone against 1235??  Now, I don&#x2019;t want to touch the spread sheet any more for fear of breaking something.  Business is great. We&#x2019;ve finally nailed how to run pre financing operations for pepper factories in [redacted]. We decide to expand our business, and start working with another factory. Since the data in the spread sheet has to be visible to the factory, I create a new spread sheet. However, some of the requirements are slightly different, so it has different columns to the first one.  Our spread sheet is now 85 columns and 60 rows, and the other one is 78 columns and 7 rows.&#xA0; Since the second spread sheet &#x201C;looks&#x201D; almost identical to the first spread sheet &#x2013; yup &#x2013; you guessed it - someone puts information into the wrong spread sheet!  Crisis point &#x2013; we&#x2019;ve got about [redacted, but in the millions US$] out in the field, and we can&#x2019;t work out where the hell the money is &#x2013; are the goods with the farmer, are they at the factory, are they at the port, are they already on board the vessel,&#xA0; has the vessel already left? Have we paid for them, if not, when do we need to pay for them?  All the data is in the spread sheet, but only one person in the entire company really understands it&#xA0; (I just wrote it &#x2013; I don&#x2019;t put the data in). So if I want to know something it&#x2019;s a scream over the desk &#x2013; &#x201C;Jonathan where the **** are the goods we were supposed to ship last week?&#x201D; Jonathan goes on holiday for three weeks.  [redacted] pepper production stops, while Jonathan is going up the Eiffel Tower in Paris. Even at this point &#x2013; if you can believe this &#x2013; I was waiting for him to come back so that we could continue operations.  I&#x2019;ve had enough of this &#x2013; RavenDB to the rescue! Two &#x2013; let me repeat that &#x2013; TWO - hours later, I&#x2019;ve written the scripts to read the spread sheet(s) and throw them into one document &#x2013; I&#x2019;ll repeat that again &#x2013; ONE document.&#xA0;  The document is nicely partitioned into logical groups &#x2013; i.e. classes for Payments, Currency contracts, Shipments etc. There is also a separate class that only does the calculations between the different logical groups. But all of this is stored in one document only. Since the calculations are all obviously read only, the results get persisted to the document.  Two indexes which give me all the information I need to control where the money is, where the stocks are. Three days to write the front end &#x2013; it only took that long because I&#x2019;m still learning MVC and javascript (I really wanted to use Backbone, but just couldn&#x2019;t get my head around it).  In the first analysis of the new application I found [redacted, hundreds of thousands US$] that we had been paid 30 days ago, that we had not sent to the factory, and was lying at the bank!  Now this is where it gets pretty amazing (for me at least). Our data is nicely partitioned, four pages that are simply different views onto the same data. The guys are getting all excited &#x2013; hey I want to control whether we paid the lawyer etc. Someone notices that some of the calculations are not correct &#x2013; so much for my edge case tests!  So I add a couple of new properties to the document, create a three line foreach loop to read all the data in the database and save it straight back again, and voila &#x2013; I&#x2019;ve &#x201C;patched&#x201D; the database. Migrations, shmigrations&#xA0; - who needs them! All the calculations are updated and stored back in the database, the new properties all appear. And this is all on live data. The minute I&#x2019;d got the raw data from the spread sheet into the database we stopped using Excel. And that made my day.</p>
        <div class="button flex justify-between">
            <a href="309.html"><span class="back arrow"></span></a>

            <a href="311.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>
<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">Â© Relatively General
                        .NET 2024<span
                            class="inline-block">&nbsp;ðŸš€&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/about/"> About </a>
    </nav>
</footer>
</body>
</html>