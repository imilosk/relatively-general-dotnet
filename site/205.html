
<!DOCTYPE html>
<html class="scroll-smooth" lang="en-US" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>Page 205 &#x2022; Relatively General .NET</title>
    <link href="favicon.ico" rel="icon" sizes="any">
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <meta content="hsl()" name="theme-color">
    <meta content="website" property="og:type">
    <meta content="Home" property="og:title">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
    <!-- Google Analytics -->
    <script>
        // Only load GA if consent is given
        function loadGA() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-MDFXJY3FCY';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-MDFXJY3FCY');
        }

        // Check if consent was previously given
        if (localStorage.getItem('cookieConsent') === 'accepted') {
            loadGA();
        }
    </script>
    <!-- End Google Analytics -->
</head>
<body class="mx-auto flex min-h-screen max-w-3xl flex-col bg-bgColor px-4 pt-16 font-mono text-sm font-normal text-textColor antialiased sm:px-8">
<a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">
    skip to content
</a>
<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
    <div class="flex sm:flex-col">
        <a aria-current="page" class="inline-flex items-center hover:filter-none sm:relative sm:inline-block"
           href="index.html">
            <img class="me-3 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-16 sm:w-16 w-16" src="images/giphy.gif"
                 alt=""/>
            <span class="text-xl font-bold sm:text-2xl">Relatively General .NET</span>
        </a>
        <nav aria-label="Main menu"
             class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
             id="navigation-menu">
            <a aria-current="page" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline underline"
               href="index.html"> Home </a><a
                aria-current="" class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline " href="about.html">
                About </a>
        </nav>
    </div>
    <site-search class="ms-auto" id="search">
        <button id="open-search"
                class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2"
                data-open-modal="">
            <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" stroke="none"></path>
                <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path>
            </svg>
        </button>
        <dialog aria-label="search"
                class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md">
            <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6">
                <button id="close-search"
                        class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700"
                        data-close-modal="">Close
                </button>
                <div class="search-container">
                    <div id="cactus__search"/>
                </div>
            </div>
        </dialog>
    </site-search>
    <theme-toggle class="ms-2 sm:ms-4">
        <button id="theme-toggle" class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2"
                type="button">
            <span class="sr-only">Dark Theme</span>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
                 fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
                 fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
                <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
                <path d="M19 11h2m-1 -1v2"></path>
            </svg>
        </button>
    </theme-toggle>
    <mobile-button>
        <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu"
                class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button">
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
                 fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <svg aria-hidden="true"
                 class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
                 fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </mobile-button>
</header>


<main id="main" data-pagefind-body>
    <section aria-label="Blog post list">
        <article id="article-2041">
            <a href="https://www.meziantou.net/writing-a-language-agnostic-roslyn-analyzer-using-ioperation.htm" target="_blank">
                <h2 class="title mb-6" id="article-2041">Writing language-agnostic Roslyn Analyzers using IOperation</h2>
            </a>
            <p class="mb-2">by G&#xE9;rald Barr&#xE9;</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 21, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">This post is part of the series &#x27;Roslyn Analyzers&#x27;. Be sure to check out the rest of the blog posts of the series!Writing a Roslyn analyzerWriting language-agnostic Roslyn Analyzers using IOperation (this post)Working with types in a Roslyn analyzerReferencing an analyzer from a projectPackaging a</p>
        </article>
        <article id="article-2042">
            <a href="https://ayende.com/blog/185922-A/the-role-of-domain-model-with-cqrs-event-sourcing" target="_blank">
                <h2 class="title mb-6" id="article-2042">The role of domain model with CQRS / Event Sourcing</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 18, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I had some really interesting discussions while I was in CodeMash, and a few of them touched on modeling concerns with non trivial architectures. In particular, I was asked about my opinion on the role of OR/M in systems that mostly do CQRS, event processing, etc.This is a deep question, because on first glance, your requirements from the database are pretty much just:INSERT INTO Events(EventId, AggregateId, Time, EventJson) VALUE (&#x2026;)There isn&#x2019;t really the need to do anything more interesting than that. The other size of that is a set of processes that operate on top of these event streams and produce read models that are very simple to consume as well. There isn&#x2019;t any complexity in the data architecture at all, and joy to world, etc, etc.This is true, to an extent. But this is only because you have moved a critical component of your system, the beating heart of your business. The logic, the rules, the thing that make a system more than just a dumb repository of strings and numbers.But first, let me make sure that we are on roughly the same page. In such a system, we have:Commands &#x2013; that cannot return a value (but will synchronously fail if invalid). These mutate the state of the system in some manner.Events &#x2013; represent something that has (already) happened. Cannot be rejected by the system, even if they represent invalid state. The state of the system can be completely rebuilt from replaying these events.Queries &#x2013; that cannot mutate the state I&#x2019;m mixing here two separate architectures, Command Query Responsibility Separation and Event Sourcing. They aren&#x2019;t the same, but they often go together hand in hand, and it make sense to talk about them together. And because it is always easier for me to talk in concrete, rather than abstract, terms, I want to discuss a system I worked on over a decade ago. That system was basically a clinic management system, and the part that I want to talk about today was the staff scheduling option.Scheduling shifts is a huge deal, even before we get to the part where it directly impacts how much money you get at the end of the month. There are a lot of rules, regulations, union contracts, agreement and bunch of other staff that relate to it. So this is a pretty complex area, and when you approach it, you need to do so with the due consideration that it deserves. When we want to apply CQRS/ES to it, we can consider the following factors:The aggregates that we have are:The open scheduled for two months for now. This is mutable, being worked on by the head nurse and constantly changes.The proposed scheduled for next month. This one is closed, changes only rarely and usually because of big stuff (something being fired, etc).The planned schedule for the current month, frozen, cannot be changed.The actual schedule for the current month. This is changed if someone doesn&#x2019;t show to their shift, is sick, etc. You can think of the first three as various stages of a PlannedScheduled, but the ActualSchedule is something different entirely. There are rules around how much divergence you can have between the planned and actual schedules, which impact compensation for the people involved, for example.Speaking of which, we haven&#x2019;t yet talked about:Nurses / doctors / staff &#x2013; which are being assigned to shifts.Clinics &#x2013; a nurse may work in several different locations at different times.There is a lot of other stuff that I&#x2019;m ignoring here, because it would complicate the picture even further, but that is enough for now. For example, regardless of the shifts that a person was assigned to and showed up, they may have worked more hours (had to come to a meeting, drove to a client) and that complicated payroll, but that doesn&#x2019;t matter for the scheduling.I want to focus on two actions in this domain. First, the act of the head nurse scheduling a staff member to a particular shift. And second, the ClockedOut event which happens when a staff member completes a shift.The ScheduleAt command place a nurse at a given shift in the schedule, which seems fairly simple on its face. However, the act of processing the command is actually really complex. Here are some of the things that you have to do:Ensure that this nurse isn&#x2019;t schedule to another shift, either concurrently or too close to another shift in a different address.Ensure that the nurse doesn&#x2019;t work with X (because issues).Ensure that the role the nurse has matches the required parameters for the schedule.Ensure that the number of double shifts in a time period is limited.The last one, in particular, is a sinkhole of time. Because at the same time, another business rule says that we must give each nurse N number of shifts in a time period, and yet another dictates how to deal with competing preferences, etc.So at this point, we have: ScheduleAtCommand.Execute() and we need to apply logic, complex, changing, business critical logic.And at this point, for that particular part of the system, I want to have a full domain, abstracted persistence and be able to just put my head down and focus on solving the business problem.The same applies for the ClockedOut event. Part of processing it means that we have to look at the nurse&#x2019;s employment contract, count the amount of overtime worked, compute total number of hours worked in a pay period, etc. Apply rules from the clinic to the time worked, apply clauses from the employment contract to the work, etc. Again, this gets very complex very fast. For example, if you have a shift from 10PM &#x2013; 6 AM, how do you compute overtime? For that matter, if this is on the last day of the month, when do you compute overtime? And what pay period do you apply it to?Here, too, I want to have a fully fleshed out model, which can operate in the problem space freely. In other words, a CQRS/ES architecture is going to have the domain model (and some sort of OR/M) in the middle, doing the most interesting things and tackling the heart o complexity.</p>
        </article>
        <article id="article-2043">
            <a href="https://ayende.com/blog/185764-A/using-tls-with-rust-authentication" target="_blank">
                <h2 class="title mb-6" id="article-2043">Using TLS with Rust</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 17, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">After running into a few hurdles, I managed to get rust openssl bindings to work, which means that this is now the time to actually wire things properly in my network protocol, let&#x2019;s see how that works, shall we?First, we have the OpenSSL setup:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          struct Server {&#xA;        &#xA;        &#xA;          &#xA;              tls_config: Arc&lt;openssl::ssl::SslAcceptor&gt;,&#xA;        &#xA;        &#xA;          &#xA;              tcp_listener: TcpListener,&#xA;        &#xA;        &#xA;          &#xA;              allowed_certs_thumbprints: HashSet&lt;String&gt;&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          impl Server {&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              fn new(cert_path: &amp;str, key_path: &amp;str, listen_uri: &amp;str, allowed_certs_thumbprints: &amp;[&amp;str]) -&gt; Result&lt;Server, ConnectionError&gt; {&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  let mut allowed = HashSet::new();&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  for thumbprint in allowed_certs_thumbprints {&#xA;        &#xA;        &#xA;          &#xA;                      allowed.insert(thumbprint.to_lowercase());&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  let mut sslb = openssl::ssl::SslAcceptor::mozilla_modern(openssl::ssl::SslMethod::tls())?;&#xA;        &#xA;        &#xA;          &#xA;                  sslb.set_private_key_file(key_path, openssl::ssl::SslFiletype::PEM)?;&#xA;        &#xA;        &#xA;          &#xA;                  sslb.set_certificate_chain_file(cert_path)?;&#xA;        &#xA;        &#xA;          &#xA;                  sslb.check_private_key()?;&#xA;        &#xA;        &#xA;          &#xA;                  // accept all certificates, we&#x27;ll do our own validation on them&#xA;        &#xA;        &#xA;          &#xA;                  sslb.set_verify_callback(openssl::ssl::SslVerifyMode::PEER, |_, _| true);&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  let listener = TcpListener::bind(listen_uri)?;&#xA;        &#xA;        &#xA;          &#xA;                 &#xA;        &#xA;        &#xA;          &#xA;                  Ok(Server { tls_config: Arc::new(sslb.build()), tcp_listener: listener, allowed_certs_thumbprints: allowed })&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          server.rs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;As you can see, this is pretty easy and there isn&#x2019;t really anything there that is of actual interest. It does feel a whole lot easier than dealing with OpenSSL directly in C, though.That said, when I started actually dealing with the client certificate, things got a lot more complicated. The first thing that I wanted to do is to do my authentication, which is defined as:Client present a client certificate (can be any client certificate).If a client doesn&#x2019;t give a certificate, we accept the connection, send a message (using the encrypted tunnel) and abort.If the client provide an certificate, it must be one that was previously registered in the server. That is what allowed_certs_thumbprints is for. If it isn&#x2019;t, we accept the connection, write an error and abort.If the client certificate has expired or is not yet valid, accept, write error &amp; abort.You get the gist. Here is what I had to do to implement the first part:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          fn authenticate_certificate(stream: &amp;mut openssl::ssl::SslStream&lt;TcpStream&gt;, server: &amp;Server) -&gt; Result&lt;bool, ConnectionError&gt; {&#xA;        &#xA;        &#xA;          &#xA;                  fn get_friendly_name(peer: &amp;openssl::x509::X509) -&gt; String {&#xA;        &#xA;        &#xA;          &#xA;                      peer.subject_name() // can&#x27;t figure out how to get the real friendly name&#xA;        &#xA;        &#xA;          &#xA;                          .entries()&#xA;        &#xA;        &#xA;          &#xA;                          .last()&#xA;        &#xA;        &#xA;          &#xA;                          .map( |it| it.data()&#xA;        &#xA;        &#xA;          &#xA;                                  .as_utf8()&#xA;        &#xA;        &#xA;          &#xA;                                  .and_then(|s| Ok(s.to_string()))&#xA;        &#xA;        &#xA;          &#xA;                                  .unwrap_or(&quot;&quot;.to_string()) &#xA;        &#xA;        &#xA;          &#xA;                          )&#xA;        &#xA;        &#xA;          &#xA;                          .unwrap_or(&quot;&lt;Unknown&gt;&quot;.to_string()) &#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;            &#xA;        &#xA;        &#xA;          &#xA;                  match stream.ssl().peer_certificate() {&#xA;        &#xA;        &#xA;          &#xA;                       None =&gt; {&#xA;        &#xA;        &#xA;          &#xA;                          stream.write(b&quot;ERR No certificate was provided\r\n&quot;)?;&#xA;        &#xA;        &#xA;          &#xA;                          return Ok(false);&#xA;        &#xA;        &#xA;          &#xA;                      }&#xA;        &#xA;        &#xA;          &#xA;                      Some(peer) =&gt; {&#xA;        &#xA;        &#xA;          &#xA;                          let thumbprint = hex::encode(peer.digest(openssl::hash::MessageDigest::sha1())?);&#xA;        &#xA;        &#xA;          &#xA;                          if server.allowed_certs_thumbprints.contains(&amp;thumbprint) == false {&#xA;        &#xA;        &#xA;          &#xA;                              let msg = format!(&quot;ERR certificate ({}) thumbprint &#x27;{}&#x27; is unknown\r\n&quot;,&#xA;        &#xA;        &#xA;          &#xA;                                  get_friendly_name(&amp;peer),&#xA;        &#xA;        &#xA;          &#xA;                                  thumbprint);&#xA;        &#xA;        &#xA;          &#xA;                              stream.write(msg.as_bytes())?;&#xA;        &#xA;        &#xA;          &#xA;                              return Ok(false);&#xA;        &#xA;        &#xA;          &#xA;                          }&#xA;        &#xA;        &#xA;          &#xA;                      }&#xA;        &#xA;        &#xA;          &#xA;                  };&#xA;        &#xA;        &#xA;          &#xA;                  return Ok(true);&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          fn handle_connection(socket: TcpStream, server: &amp;Server) -&gt; Result&lt;(), ConnectionError&gt; {&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              let acceptor = server.tls_config.clone();&#xA;        &#xA;        &#xA;          &#xA;              let mut stream = acceptor.accept(socket)?;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              if authenticate_certificate(&amp;mut stream, server)? == false{&#xA;        &#xA;        &#xA;          &#xA;                  return Ok(());// error already sent to client&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              stream.write(b&quot;OK\r\n&quot;)?;&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;              // connection established, do the rest from here&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          connection-auth.rs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;Most of the code, actually, is about generating proper and clear error messages, more than anything else. I&#x2019;m not sure how to get the friendly name from the certificate, but this seems to be a good enough stand-in for now. We validate that we have a certificate, or send an error back. We validate that the certificate presented is known to us, or we send an error back.The next part I wanted to implement was&#x2026; really far too hard than it should be. I just wanted to verify that the certificate not before/not after dates are valid. And the problem is that the rust bindings for OpenSSL do not expose that information. Luckily, because it is using OpenSSL, I can just call to OpenSSL directly. That led me to some interesting search into how Rust calls out to C, how foreign types work and a lot of &#x201C;fun&#x201D; like that. Given that I&#x2019;m doing this to learn, I suppose that this is a good thing, though.Here is what I ended up with (take a deep breath):&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;          fn authenticate_certificate(stream: &amp;mut openssl::ssl::SslStream&lt;TcpStream&gt;, server: &amp;Server) -&gt; Result&lt;bool, ConnectionError&gt; {&#xA;        &#xA;        &#xA;          &#xA;                  fn get_friendly_name(peer: &amp;openssl::x509::X509) -&gt; String {&#xA;        &#xA;        &#xA;          &#xA;                      // like before&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  extern &quot;C&quot; {&#xA;        &#xA;        &#xA;          &#xA;                      fn ASN1_TIME_diff(&#xA;        &#xA;        &#xA;          &#xA;                              pday: *mut std::os::raw::c_int, &#xA;        &#xA;        &#xA;          &#xA;                              psec: *mut std::os::raw::c_int, &#xA;        &#xA;        &#xA;          &#xA;                              from: *const openssl_sys::ASN1_TIME, &#xA;        &#xA;        &#xA;          &#xA;                              to: *const openssl_sys::ASN1_TIME) -&gt; std::os::raw::c_int;&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;                  &#xA;        &#xA;        &#xA;          &#xA;                  fn is_before(x: &amp;openssl::asn1::Asn1TimeRef, y: &amp;openssl::asn1::Asn1TimeRef) -&gt; Result&lt;bool, ConnectionError&gt; {&#xA;        &#xA;        &#xA;          &#xA;                      unsafe {&#xA;        &#xA;        &#xA;          &#xA;                          let mut day : std::os::raw::c_int = 0;&#xA;        &#xA;        &#xA;          &#xA;                          let mut sec : std::os::raw::c_int = 0;&#xA;        &#xA;        &#xA;          &#xA;                          match ASN1_TIME_diff(&amp;mut day, &amp;mut sec,  x.as_ptr(), y.as_ptr() ) {&#xA;        &#xA;        &#xA;          &#xA;                              0 =&gt; Err(ConnectionError::InvalidTimeFormat),&#xA;        &#xA;        &#xA;          &#xA;                              _ =&gt; Ok(day &gt; 0 || sec &gt; 0)&#xA;        &#xA;        &#xA;          &#xA;                          }&#xA;        &#xA;        &#xA;          &#xA;                      }&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  fn is_valid_time(peer: &amp;openssl::x509::X509) -&gt; Result&lt;(), ConnectionError&gt; {&#xA;        &#xA;        &#xA;          &#xA;                      let now = openssl::asn1::Asn1Time::days_from_now(0)?;&#xA;        &#xA;        &#xA;          &#xA;                 &#xA;        &#xA;        &#xA;          &#xA;                      if is_before(&amp;now, peer.not_before())? {&#xA;        &#xA;        &#xA;          &#xA;                          return Err(ConnectionError::ClientCertNotYetValid { date: peer.not_before().to_string() });&#xA;        &#xA;        &#xA;          &#xA;                      }&#xA;        &#xA;        &#xA;          &#xA;                      if is_before(peer.not_after(), &amp;now)? {&#xA;        &#xA;        &#xA;          &#xA;                          return Err(ConnectionError::ClientCertExpired { date: peer.not_after().to_string() } );   &#xA;        &#xA;        &#xA;          &#xA;                      }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                      Ok(())&#xA;        &#xA;        &#xA;          &#xA;                  }&#xA;        &#xA;        &#xA;          &#xA;          &#xA;&#xA;        &#xA;        &#xA;          &#xA;                  match stream.ssl().peer_certificate() {&#xA;        &#xA;        &#xA;          &#xA;                       None =&gt; {&#xA;        &#xA;        &#xA;          &#xA;                          stream.write(b&quot;ERR No certificate was provided\r\n&quot;)?;&#xA;        &#xA;        &#xA;          &#xA;                          return Ok(false);&#xA;        &#xA;        &#xA;          &#xA;                      }&#xA;        &#xA;        &#xA;          &#xA;                      Some(peer) =&gt; {&#xA;        &#xA;        &#xA;          &#xA;                          let thumbprint = hex::encode(peer.digest(openssl::hash::MessageDigest::sha1())?);&#xA;        &#xA;        &#xA;          &#xA;                          if server.allowed_certs_thumbprints.contains(&amp;thumbprint) == false {&#xA;        &#xA;        &#xA;          &#xA;                              let msg = format!(&quot;ERR certificate ({}) thumbprint &#x27;{}&#x27; is unknown\r\n&quot;,&#xA;        &#xA;        &#xA;          &#xA;                                  get_friendly_name(&amp;peer),&#xA;        &#xA;        &#xA;          &#xA;                                  thumbprint);&#xA;        &#xA;        &#xA;          &#xA;                              stream.write(msg.as_bytes())?;&#xA;        &#xA;        &#xA;          &#xA;                              return Ok(false);&#xA;        &#xA;        &#xA;          &#xA;                          }&#xA;        &#xA;        &#xA;          &#xA;                          &#xA;        &#xA;        &#xA;          &#xA;                          if let Err(e) =  is_valid_time(&amp;peer) {&#xA;        &#xA;        &#xA;          &#xA;                              let msg = format!(&quot;ERR certificate ({}) thumbprint &#x27;{}&#x27; cannot be used: {}\r\n&quot;,&#xA;        &#xA;        &#xA;          &#xA;                                  get_friendly_name(&amp;peer),&#xA;        &#xA;        &#xA;          &#xA;                                  thumbprint,&#xA;        &#xA;        &#xA;          &#xA;                                  e);&#xA;        &#xA;        &#xA;          &#xA;                              stream.write(msg.as_bytes())?;&#xA;        &#xA;        &#xA;          &#xA;                              return Ok(false);&#xA;        &#xA;        &#xA;          &#xA;                          }&#xA;        &#xA;        &#xA;          &#xA;                      }&#xA;        &#xA;        &#xA;          &#xA;                  };&#xA;        &#xA;        &#xA;          &#xA;                  return Ok(true);&#xA;        &#xA;        &#xA;          &#xA;          }&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          auth_cert_with_dates.rs&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;Notice that I&#x2019;m doing all of this (defining external function, defining helper functions) inside the authenticate_certificate function. Coming up with that was harder than expected, but I really liked the fact that it was possible, and that I can just shove this into a corner of my code and not have to make a Big Thing out of it.And with that, I the authentication portion of my network protocol in Rust done. The next stage is going to be implementing a server that can handle more than a single connection at a time .</p>
        </article>
        <article id="article-2044">
            <a href="https://ardalis.com/2018-year-in-review/" target="_blank">
                <h2 class="title mb-6" id="article-2044">2018 Year in Review</h2>
            </a>
            <p class="mb-2">by Ardalis</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 17, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Now that 2018&#x27;s been over for a few weeks, I&#x27;ve had a chance to compile some data from a variety of sources that I thought some people might&#x2026;Keep Reading &#x2192;</p>
        </article>
        <article id="article-2045">
            <a href="https://ayende.com/blog/185953-A/technical-presentation-delivery-notes" target="_blank">
                <h2 class="title mb-6" id="article-2045">Technical presentation delivery notes</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 16, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">I&#x2019;m writing this post as I&#x2019;m sitting in the airport, leaving the CodeMash conference. This has been my first &#x201C;true&#x201D; conference for a while, because I was able to not just speak and stand in a sponsor booth but actually participate in a lot of sessions and talk to a lot of people. I had a blast, and both the IRS and my wife consider this a work trip .I have been presenting in international conferences for over a decade now and I wanted to put in a few words for people who are speaking at a technical conference. None of this is new, mind. If you have been reading any recommendations about how to present in conferences, I&#x2019;m probably going to bore you. I&#x2019;m writing this because I saw several sessions that had technical issues in how they were delivered. That is, the content was great, but the way it was delivered could be improved.Probably the most important factor that I need to mention is: Make your content readable.When you are presenting, use big fonts everywhere. That means that (ahead of time) you should make sure that your PPT&#x2019;s content is readable from the end of the room, if you are presenting code in an IDE, make sure that you know how to increase the zoom so the code is readable. For that matter, syntax highlighting is not an optional feature when showing code.&#xA0; And use the default syntax highlighting for the language you are working with. And no dark themes.I&#x2019;m assuming that what you care about is the code, so you want to show that, in a way that the people in your talk are familiar with, so no new themes, aqua on pink color schemes, etc. Go with the default.But code is just one factor of it. If you are showing output, make sure that this is readable. That means that if you are writing to the console, make sure that the console font it big enough, use colors for emphasis, etc. If you are showing XML / JSON / data formats, make sure that they are pretty printed. If you dump something like this:The audience is going to be too busy parsing the text to actually pay attention to what you are saying.And if at all possible, use a console application and have no architecture. If you are actually talking about a React app, you can&#x2019;t do that, and if your talk is about architecture, you are going to need to show that. But for most cases, if you are showing off some new language feature, or talk about a particular service or API, you want to use a console app to demo it. This is because it allow you (and your audience) to focus solely on the problem at hand rather than look the the control &#x2013;&gt; service &#x2013;&gt; repository magic via DI that hides a lot of the backend details.&#xA0; In general, you want to strip away as much as possible that isn&#x2019;t directly core to your topic. Another thing that I noticed, when you want to show additional data (files, artifacts, etc), make sure that you have them already opened before you start.&#xA0; If you are doing a demo, have screen shots available for when / if the demo mess up.Everything I just mentioned might seem obvious, but you need to go over that before you go and present, it was surprising to see several speakers make some of these mistakes. Now, to be fair, that might sound like I&#x2019;m piling on people, but that isn&#x2019;t my intention. I&#x2019;m aggregating a lot of different small mistakes to point them out, they can detract from the presentation, but at least in the sessions that I was at, they didn&#x2019;t kill the presentation for me.</p>
        </article>
        <article id="article-2046">
            <a href="https://ayende.com/blog/185763-A/using-tls-with-rust-getting-openssl-to-work" target="_blank">
                <h2 class="title mb-6" id="article-2046">Using TLS with Rust&#x2013;Getting OpenSSL to work</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 15, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">After getting really frustrated with the state of Rust &amp; TLS, and I decided to sit down and figure out what it would take to make the OpenSSL crate actually build successfully. Even though the crate claims to support vcpkg, it seems that there were issues there. I started from a clean slate, and checked that I have openssl via vcpkg installed:I then got into a rabbit hole of errors in the build, first:This seems like it wants to statically link to them by default, but when I set the env variable, I got:Looking closely at the error (always read the error message), you can see that it is looking for a 64 bits build, but I&#x2019;ve a x86 build.That very likely explains the issues that I previously had. I tried to point it to the SSL build directory, and I&#x2019;m pretty sure that I used the 32bits directory. It rejected the attempted link, but didn&#x2019;t bother to tell me about it.To be fair, this isn&#x2019;t Rust&#x2019;s fault, it is link.exe&#x2019;s fault for not providing a clear error about this case. Actually, this is the case where you are going to invest some time writing a feature whose only purpose is to get good errors when the user messed up. But that kind of attention to detail make a world of difference.Here is what fixed this for me. And with that, I can build using:Hurray! That is enough for now, I guess. I&#x2019;ll get things actually working in another post.</p>
        </article>
        <article id="article-2047">
            <a href="https://andrewlock.net/running-async-tasks-on-app-startup-in-asp-net-core-part-2/" target="_blank">
                <h2 class="title mb-6" id="article-2047">Two approaches for running async tasks</h2>
            </a>
            <p class="mb-2">by Andrew Lock</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 15, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Running async tasks on app startup in ASP.NET Core - Part 2</p>
        </article>
        <article id="article-2048">
            <a href="https://ayende.com/blog/185921-A/data-modeling-with-indexes-predicting-the-future" target="_blank">
                <h2 class="title mb-6" id="article-2048">Data modeling with indexes</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 14, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">Computation during indexes open up some nice&#xA0; features when we are talking about data modeling and working with your data. In this post, I want to discuss predicting the future with it. Let&#x2019;s see how we can do that, shall we?Consider the following document, representing a (simplified) customer model:We have a customer that is making monthly payments. This is a pretty straightforward model, right?We can do a lot with this kind of data. We can obviously compute the lifetime value of a customer, based on how much they paid us. We already did something very similar in a previous post, so that isn&#x2019;t very interesting.What is interesting is looking into the future. Let&#x2019;s see how we can start simple, but figuring out what is the next charge rate for this customer. For now, the logic is about as simple as it can be. Monthly customers pay by month, basically. Here is the index:I&#x2019;m using Linq instead of JS here because I&#x2019;m dealing with dates and JS support for dates is&#x2026; poor. As you can see, we are simply looking at the last date and the subscription, figuring out how much we paid the last three times and use that as the expected next payment amount. That can allow us to do nice things, obviously. We can now do queries on the future. So finding out how many customers will (probably) pay us more than 100$ on the 1st of Feb both easy and cheap. We can actually take this further, though. Instead of using a simple index, we can use a map/reduce one. Here is what this looks like:And the reduce:This may seem a bit dense at first, so let&#x2019;s de-cypher it, shall we?We take the last payment date and compute the average of the last three payments, just as we did before. The fun part now is that we don&#x2019;t compute just the single next payment, but the next three. We then output all the payments, both existing (that already happened) and projected (that will happen in the future) from the map function. The reduce function is a lot simpler, and simply sum up the amounts per month. This allows us to effectively project data into the future, and this map reduce index can be used to calculate expected income. Note that this is aggregated across all customers, so we can get a pretty good picture of what is going to happen. A real system would probably have some uncertainty factor, but that touches on business strategy more than modeling, so I don&#x2019;t think we need to go into that here.</p>
        </article>
        <article id="article-2049">
            <a href="https://ayende.com/blog/185762-A/using-tls-with-rust-part-iii-will-native-tls-do-the-trick" target="_blank">
                <h2 class="title mb-6" id="article-2049">Using TLS with Rust</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 11, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">After trying (and failing) to use rustls to handle client authentication, I tried to use rust-openssl bindings. It crapped out on me with a really scary link error. I spent some time trying to figure out what was going on, but given that it said that I wanted to write Rust code, not deal with link errors, I decided to see if the final alternative in the Rust eco system will work, native-tls package. And&#x2026; that is a no go as well. Which is sad, because the actual API was quite nice. The reason it isn&#x2019;t going to work? The native-tls package just has no support for client certificate authentication when running as a server, so not usable for me.That leaves me with strike three out of three:rustls &#x2013; native Rust API, easy to work with, but doesn&#x2019;t allow to accept arbitrary client certificates, only ones from known issuers.rust-openssl &#x2013; I have build this on top of OpenSSL before, so I know it works. However, trying to build it on Windows resulted in link errors, so that was out.native-tls &#x2013; doesn&#x2019;t have support for client certificates, so not usable.I think that at this point, I have three paths available to me:Give up and maybe try doing something else with Rust.Fork rustls and add support for accepting arbitrary client certificates. I&#x2019;m not happy with this because it requires changing not just rustls but also probably webpki package and I&#x2019;m unsure if the changes I have in mind will not hurt the security of the system.Try to fix the OpneSSL link issue.I think that I&#x2019;ll go with the third option, but this is really annoying.</p>
        </article>
        <article id="article-2050">
            <a href="https://ayende.com/blog/185761-A/data-modeling-with-indexes-business-rules" target="_blank">
                <h2 class="title mb-6" id="article-2050">Data modeling with indexes</h2>
            </a>
            <p class="mb-2">by Oren Eini</p>
            <p class="mb-6 flex gap-1.5">
                    <span>
                        <svg width="1.25rem" fill="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg"><path
                                xmlns="http://www.w3.org/2000/svg"
                                d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM12 6C12.5523 6 13 6.44772 13 7V11.5858L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L11.2929 12.7071C11.1054 12.5196 11 12.2652 11 12V7C11 6.44772 11.4477 6 12 6Z"></path></svg>
                    </span>
                posted on: January 10, 2019
            </p>
            <p class="max-w-full w-full line-clamp-5 text-justify mb-20">In my last post on the topic, I showed how we can define a simple computation during the indexing process. That was easy enough, for sure, but it turns out that there are quite a few use cases for this feature that go quite far from what you would expect. For example, we can use this feature as part of defining and working with business rules in our domain.For example, let&#x2019;s say that we have some logic that determine whatever a product is offered with a warranty (and for how long that warranty is valid). This is an important piece of information, obviously, but it is the kind of thing that changes on a fairly regular basis. For example, consider the following feature description:As a user, I want to be able to see the offered warranty on the products, as well as to filter searches based on the warranty status. Warranty rules are:For new products made in house, full warranty for 24 months.For new products from 3rd parties, parts only warranty for 6 months.Refurbished products by us, full warranty, for half of new warranty duration.Refurbished 3rd parties products, parts only warranty, 3 months.Used products, parts only, 1 month.Just from reading the description, you can see that this is a business rule, which means that it is subject to many changes over time. We can obviously create a couple of fields on the document to hold the warranty information, but that means that whenever the warranty rules change, we&#x2019;ll have to go through all of them again. We&#x2019;ll also need to ensure that any business logic that touches the document will re-run the logic to apply the warranty computation (to be fair, these sort of things are usually done as a subscription in RavenDB, which alleviate that need).Without further ado, here is the index to implement the logic above:&#xA;    &#xA;      &#xA;        &#xA;  &#xA;    &#xA;    &#xA;&#xA;        &#xA;&#xA;&#xA;  &#xA;  &#xA;  &#xA;    &#xA;&#xA;    &#xA;      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.&#xA;      Learn more about bidirectional Unicode characters&#xA;    &#xA;&#xA;&#xA;              Show hidden characters&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;    &#xA;    &#xA;&#xA;&#xA;&#xA;  &#xA;        &#xA;          &#xA;          map(&quot;Products&quot;, prod =&gt; {&#xA;        &#xA;        &#xA;          &#xA;              var result = { Warranty: &quot;Parts&quot;, Duration: 1 };&#xA;        &#xA;        &#xA;          &#xA;              if(prod.Mode == &quot;Used&quot;)&#xA;        &#xA;        &#xA;          &#xA;                  return result;&#xA;        &#xA;        &#xA;          &#xA;                  &#xA;        &#xA;        &#xA;          &#xA;              if (prod.Manufacturer ==  &quot;ACME&quot;){  // our product&#xA;        &#xA;        &#xA;          &#xA;                  result.Warranty = &quot;Full&quot;;&#xA;        &#xA;        &#xA;          &#xA;                  result.Duration = 24;&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;              else { // 3rd party&#xA;        &#xA;        &#xA;          &#xA;                  result.Warranty = &quot;Parts&quot;;&#xA;        &#xA;        &#xA;          &#xA;                  result.Duration = 6;&#xA;        &#xA;        &#xA;          &#xA;              }&#xA;        &#xA;        &#xA;          &#xA;              &#xA;        &#xA;        &#xA;          &#xA;              if(prod.Mode == &quot;Refurbished&quot;)&#xA;        &#xA;        &#xA;          &#xA;                  result.Duration/=2;&#xA;        &#xA;        &#xA;          &#xA;                  &#xA;        &#xA;        &#xA;          &#xA;              return result;&#xA;        &#xA;        &#xA;          &#xA;          });&#xA;        &#xA;  &#xA;&#xA;&#xA;&#xA;    &#xA;&#xA;  &#xA;&#xA;&#xA;      &#xA;      &#xA;        view raw&#xA;        &#xA;          warranty-index.js&#xA;        &#xA;        hosted with &#x2764; by GitHub&#xA;      &#xA;    &#xA;&#xA;You can now query over the warranty types and it&#x2019;s duration, project them from the index, etc. Whenever a document is updates, we&#x2019;ll re-compute the warranty status and update the index. This saves you from having additional fields in your model and greatly diminish the cost of queries that need to filter on warranty or its duration (since you don&#x2019;t need to do this computation during the query, only once, during indexing).If the business rule definition changes, you can update the index definition and RavenDB will effectively roll out your change to the entire dataset. That is nice, but even though I&#x2019;m writing about cool RavenDB features, there are some words of cautions that I want to mention.Putting queryable business rules in the database can greatly ease your life, but be wary of putting too much business logic in there. In general, you want your business logic to reside right next to the rest of your application code, not running in a different server in a mode that is much harder to debug, version and diagnose. And if the level of complexity involved in the business rule exceed some level (hard to define, but easy to know when you hit it), you should probably move from defining the business rules in an index to a subscription.A RavenDB subscription allow you to get all changes to documents and apply your own logic in response. This is a reliable way to process data in RavenDB, this runs in your own code, under your own terms, so it can enjoy all the usual benefits of&#x2026; well, being your code, and not mine. You can read more about them in this post and of course, the documentation.</p>
        </article>
        <div class="button flex justify-between">
            <a href="204.html"><span class="back arrow"></span></a>

            <a href="206.html"><span class="next arrow"></span></a>
        </div>
    </section>
</main>

<footer
    class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs">
    <div class="me-0 sm:me-4">
        <div class="flex flex-wrap items-end gap-x-2">
            <ul class="flex flex-1 items-center gap-x-2 sm:flex-initial">
                <li class="flex">
                    <p class="flex items-end gap-2 justify-center flex-wrap	">© Relatively General
                        .NET 2025<span
                            class="inline-block">&nbsp;🚀&nbsp;Theme: Astro Cactus</span>

                        <a class="inline-block sm:hover:text-link" href="https://github.com/chrismwilliams/astro-cactus"
                           rel="noopener noreferrer " target="_blank">
                            <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6"
                                 focusable="false" data-icon="mdi:github">
                                <symbol id="ai:mdi:github">
                                    <path fill="currentColor"
                                          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path>
                                </symbol>
                                <use xlink:href="#ai:mdi:github"></use>
                            </svg>
                            <span class="sr-only">Github</span>
                        </a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
        <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="index.html"> Home </a><a
            class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="about.html"> About </a>
    </nav>
</footer>
<script src="js/script.js?id=af8f4559935e7bf5bf6015373793411d"></script>
<script src="/pagefind/pagefind-ui.js"></script>

<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookieConsent">
    <div>
        <p class="text-sm">We use cookies to analyze our website traffic and provide a better browsing experience. By
            continuing to use our site, you agree to our use of cookies.</p>
    </div>
    <div class="cookie-consent-buttons">
        <button class="cookie-consent-decline" onclick="declineCookies()">Decline</button>
        <button class="cookie-consent-accept" onclick="acceptCookies()">Accept</button>
    </div>
</div>

<script>
    // Cookie consent management
    function showCookieConsent() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            document.getElementById('cookieConsent').classList.add('show');
        }
    }

    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').classList.remove('show');
        loadGA(); // Load Google Analytics after consent
    }

    function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').classList.remove('show');
    }

    // Show the consent banner only for EU visitors (you can add more country codes as needed)
    fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
                if (euCountries.includes(data.country_code)) {
                    showCookieConsent();
                } else {
                    // For non-EU visitors, automatically load GA
                    if (!localStorage.getItem('cookieConsent')) {
                        localStorage.setItem('cookieConsent', 'accepted');
                        loadGA();
                    }
                }
            })
            .catch(() => {
                // If we can't determine location, show the consent banner to be safe
                showCookieConsent();
            });
</script>
</body>
</html>
